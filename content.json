{"meta":{"title":"TinyChen's Studio","subtitle":"DO or DIE","description":" ","author":"TinyChen","url":"https://tinychen.com","root":"/"},"pages":[{"title":"tags","date":"2019-11-23T02:24:18.000Z","updated":"2019-11-23T02:24:18.000Z","comments":false,"path":"tags/index.html","permalink":"https://tinychen.com/tags/index.html","excerpt":"","text":""},{"title":"categories","date":"2019-11-23T02:24:28.000Z","updated":"2019-11-23T02:24:28.000Z","comments":false,"path":"categories/index.html","permalink":"https://tinychen.com/categories/index.html","excerpt":"","text":""},{"title":"about","date":"2021-05-28T02:11:14.000Z","updated":"2021-05-28T02:11:14.000Z","comments":false,"path":"about/index.html","permalink":"https://tinychen.com/about/index.html","excerpt":"","text":""}],"posts":[{"title":"k8sç³»åˆ—04-kubeadméƒ¨ç½²ciliumç½‘ç»œçš„k8sé›†ç¾¤","slug":"20220510-k8s-04-deploy-k8s-with-cilium","date":"2022-05-10T05:00:00.000Z","updated":"2022-05-10T05:00:00.000Z","comments":true,"path":"20220510-k8s-04-deploy-k8s-with-cilium/","link":"","permalink":"https://tinychen.com/20220510-k8s-04-deploy-k8s-with-cilium/","excerpt":"æœ¬æ–‡ä¸»è¦åœ¨centos7ç³»ç»Ÿä¸ŠåŸºäºdockerå’Œciliumç»„ä»¶éƒ¨ç½²v1.23.6ç‰ˆæœ¬çš„k8såŸç”Ÿé›†ç¾¤ï¼Œç”±äºé›†ç¾¤ä¸»è¦ç”¨äºè‡ªå·±å¹³æ—¶å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨ï¼ŒåŠ ä¸Šèµ„æºæœ‰é™ï¼Œæš‚ä¸æ¶‰åŠé«˜å¯ç”¨éƒ¨ç½²ã€‚ æ­¤å‰å†™çš„ä¸€äº›å…³äºk8såŸºç¡€çŸ¥è¯†å’Œé›†ç¾¤æ­å»ºçš„ä¸€äº›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ã€‚","text":"æœ¬æ–‡ä¸»è¦åœ¨centos7ç³»ç»Ÿä¸ŠåŸºäºdockerå’Œciliumç»„ä»¶éƒ¨ç½²v1.23.6ç‰ˆæœ¬çš„k8såŸç”Ÿé›†ç¾¤ï¼Œç”±äºé›†ç¾¤ä¸»è¦ç”¨äºè‡ªå·±å¹³æ—¶å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨ï¼ŒåŠ ä¸Šèµ„æºæœ‰é™ï¼Œæš‚ä¸æ¶‰åŠé«˜å¯ç”¨éƒ¨ç½²ã€‚ æ­¤å‰å†™çš„ä¸€äº›å…³äºk8såŸºç¡€çŸ¥è¯†å’Œé›†ç¾¤æ­å»ºçš„ä¸€äº›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ã€‚ 1ã€å‡†å¤‡å·¥ä½œ1.1 cilium-é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯æœºå™¨å‡ä¸º8C8Gçš„è™šæ‹Ÿæœºï¼Œç¡¬ç›˜ä¸º100Gã€‚ IP Hostname 10.31.188.1 tiny-cilium-master-188-1.k8s.tcinternal 10.31.188.11 tiny-cilium-worker-188-11.k8s.tcinternal 10.31.188.12 tiny-cilium-worker-188-12.k8s.tcinternal 10.188.0.0/18 serviceSubnet 1.2 æ£€æŸ¥macå’Œproduct_uuidåŒä¸€ä¸ªk8sé›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹éœ€è¦ç¡®ä¿macåœ°å€å’Œproduct_uuidå‡å”¯ä¸€ï¼Œå¼€å§‹é›†ç¾¤åˆå§‹åŒ–ä¹‹å‰éœ€è¦æ£€æŸ¥ç›¸å…³ä¿¡æ¯ 123456# æ£€æŸ¥macåœ°å€ip link ifconfig -a# æ£€æŸ¥product_uuidsudo cat /sys/class/dmi/id/product_uuid 1.3 é…ç½®sshå…å¯†ç™»å½•ï¼ˆå¯é€‰ï¼‰å¦‚æœk8sé›†ç¾¤çš„èŠ‚ç‚¹æœ‰å¤šä¸ªç½‘å¡ï¼Œç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹èƒ½é€šè¿‡æ­£ç¡®çš„ç½‘å¡äº’è”è®¿é—® 123456789101112131415161718192021222324252627# åœ¨rootç”¨æˆ·ä¸‹é¢ç”Ÿæˆä¸€ä¸ªå…¬ç”¨çš„keyï¼Œå¹¶é…ç½®å¯ä»¥ä½¿ç”¨è¯¥keyå…å¯†ç™»å½•su rootssh-keygencd /root/.ssh/cat id_rsa.pub &gt;&gt; authorized_keyschmod 600 authorized_keyscat &gt;&gt; ~/.ssh/config &lt;&lt;EOFHost tiny-cilium-master-188-1.k8s.tcinternal HostName 10.31.188.1 User root Port 22 IdentityFile ~/.ssh/id_rsaHost tiny-cilium-worker-188-11.k8s.tcinternal HostName 10.31.188.11 User root Port 22 IdentityFile ~/.ssh/id_rsaHost tiny-cilium-worker-188-12.k8s.tcinternal HostName 10.31.188.12 User root Port 22 IdentityFile ~/.ssh/id_rsaEOF 1.4 ä¿®æ”¹hostsæ–‡ä»¶12345cat &gt;&gt; /etc/hosts &lt;&lt;EOF10.31.188.1 tiny-cilium-master-188-1 tiny-cilium-master-188-1.k8s.tcinternal10.31.188.11 tiny-cilium-worker-188-11 tiny-cilium-worker-188-11.k8s.tcinternal10.31.188.12 tiny-cilium-worker-188-12 tiny-cilium-worker-188-12.k8s.tcinternalEOF 1.5 å…³é—­swapå†…å­˜1234# ä½¿ç”¨å‘½ä»¤ç›´æ¥å…³é—­swapå†…å­˜swapoff -a# ä¿®æ”¹fstabæ–‡ä»¶ç¦æ­¢å¼€æœºè‡ªåŠ¨æŒ‚è½½swapåˆ†åŒºsed -i &#x27;/swap / s/^\\(.*\\)$/#\\1/g&#x27; /etc/fstab 1.6 é…ç½®æ—¶é—´åŒæ­¥è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯é€‰æ‹©ntpæˆ–è€…æ˜¯chronyåŒæ­¥å‡å¯ï¼ŒåŒæ­¥çš„æ—¶é—´æºæœåŠ¡å™¨å¯ä»¥é€‰æ‹©é˜¿é‡Œäº‘çš„ntp1.aliyun.comæˆ–è€…æ˜¯å›½å®¶æ—¶é—´ä¸­å¿ƒçš„ntp.ntsc.ac.cnã€‚ ä½¿ç”¨ntpåŒæ­¥12345678# ä½¿ç”¨yumå®‰è£…ntpdateå·¥å…·yum install ntpdate -y# ä½¿ç”¨å›½å®¶æ—¶é—´ä¸­å¿ƒçš„æºåŒæ­¥æ—¶é—´ntpdate ntp.ntsc.ac.cn# æœ€åæŸ¥çœ‹ä¸€ä¸‹æ—¶é—´hwclock ä½¿ç”¨chronyåŒæ­¥12345678910111213141516171819202122232425262728293031# ä½¿ç”¨yumå®‰è£…chronyyum install chrony -y# è®¾ç½®å¼€æœºå¯åŠ¨å¹¶å¼€å¯chonyå¹¶æŸ¥çœ‹è¿è¡ŒçŠ¶æ€systemctl enable chronyd.servicesystemctl start chronyd.servicesystemctl status chronyd.service# å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ—¶é—´æœåŠ¡å™¨vim /etc/chrony.conf# ä¿®æ”¹å‰[root@localhost ~]# grep server /etc/chrony.conf# Use public servers from the pool.ntp.org project.server 0.centos.pool.ntp.org iburstserver 1.centos.pool.ntp.org iburstserver 2.centos.pool.ntp.org iburstserver 3.centos.pool.ntp.org iburst# ä¿®æ”¹å[root@localhost ~]# grep server /etc/chrony.conf# Use public servers from the pool.ntp.org project.server ntp.ntsc.ac.cn iburst# é‡å¯æœåŠ¡ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆsystemctl restart chronyd.service# æŸ¥çœ‹chronyçš„ntpæœåŠ¡å™¨çŠ¶æ€chronyc sourcestats -vchronyc sources -v 1.7 å…³é—­selinux12345# ä½¿ç”¨å‘½ä»¤ç›´æ¥å…³é—­setenforce 0# ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹/etc/selinux/configæ–‡ä»¶sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=disabled/&#x27; /etc/selinux/config 1.8 é…ç½®é˜²ç«å¢™k8sé›†ç¾¤ä¹‹é—´é€šä¿¡å’ŒæœåŠ¡æš´éœ²éœ€è¦ä½¿ç”¨è¾ƒå¤šç«¯å£ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥ç¦ç”¨é˜²ç«å¢™ 12# centos7ä½¿ç”¨systemctlç¦ç”¨é»˜è®¤çš„firewalldæœåŠ¡systemctl disable firewalld.service 1.9 é…ç½®netfilterå‚æ•°è¿™é‡Œä¸»è¦æ˜¯éœ€è¦é…ç½®å†…æ ¸åŠ è½½br_netfilterå’Œiptablesæ”¾è¡Œipv6å’Œipv4çš„æµé‡ï¼Œç¡®ä¿é›†ç¾¤å†…çš„å®¹å™¨èƒ½å¤Ÿæ­£å¸¸é€šä¿¡ã€‚ 123456789cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.confbr_netfilterEOFcat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.confnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1EOFsudo sysctl --system 1.10 å…³é—­IPV6ï¼ˆä¸å»ºè®®ï¼‰å’Œä¹‹å‰éƒ¨ç½²å…¶ä»–çš„CNIä¸ä¸€æ ·ï¼Œciliumå¾ˆå¤šæœåŠ¡ç›‘å¬é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯åŒæ ˆçš„ï¼Œå› æ­¤å»ºè®®å¼€å¯ç³»ç»Ÿçš„IPV6ç½‘ç»œæ”¯æŒï¼ˆå³ä½¿æ²¡æœ‰å¯ç”¨çš„IPV6è·¯ç”±ä¹Ÿå¯ä»¥ï¼‰ 1.11 é…ç½®IPVSï¼ˆå»ºè®®ï¼‰IPVSæ˜¯ä¸“é—¨è®¾è®¡ç”¨æ¥åº”å¯¹è´Ÿè½½å‡è¡¡åœºæ™¯çš„ç»„ä»¶ï¼Œkube-proxy ä¸­çš„ IPVS å®ç°é€šè¿‡å‡å°‘å¯¹ iptables çš„ä½¿ç”¨æ¥å¢åŠ å¯æ‰©å±•æ€§ã€‚åœ¨ iptables è¾“å…¥é“¾ä¸­ä¸ä½¿ç”¨ PREROUTINGï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªå‡çš„æ¥å£ï¼Œå«åš kube-ipvs0ï¼Œå½“k8sé›†ç¾¤ä¸­çš„è´Ÿè½½å‡è¡¡é…ç½®å˜å¤šçš„æ—¶å€™ï¼ŒIPVSèƒ½å®ç°æ¯”iptablesæ›´é«˜æ•ˆçš„è½¬å‘æ€§èƒ½ã€‚ å› ä¸ºciliuméœ€è¦å‡çº§ç³»ç»Ÿå†…æ ¸ï¼Œå› æ­¤è¿™é‡Œçš„å†…æ ¸ç‰ˆæœ¬é«˜äº4.19 æ³¨æ„åœ¨4.19ä¹‹åçš„å†…æ ¸ç‰ˆæœ¬ä¸­ä½¿ç”¨nf_conntrackæ¨¡å—æ¥æ›¿æ¢äº†åŸæœ‰çš„nf_conntrack_ipv4æ¨¡å— (Notes: use nf_conntrack instead of nf_conntrack_ipv4 for Linux kernel 4.19 and later) 12345678910111213141516171819202122232425262728293031323334353637383940# åœ¨ä½¿ç”¨ipvsæ¨¡å¼ä¹‹å‰ç¡®ä¿å®‰è£…äº†ipsetå’Œipvsadmsudo yum install ipset ipvsadm -y# æ‰‹åŠ¨åŠ è½½ipvsç›¸å…³æ¨¡å—modprobe -- ip_vsmodprobe -- ip_vs_rrmodprobe -- ip_vs_wrrmodprobe -- ip_vs_shmodprobe -- nf_conntrack# é…ç½®å¼€æœºè‡ªåŠ¨åŠ è½½ipvsç›¸å…³æ¨¡å—cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/ipvs.confip_vsip_vs_rrip_vs_wrrip_vs_shnf_conntrackEOFsudo sysctl --system# æœ€å¥½é‡å¯ä¸€éç³»ç»Ÿç¡®å®šæ˜¯å¦ç”Ÿæ•ˆ[root@tiny-cilium-master-188-1 tiny-cilium]# lsmod | grep -e ip_vs -e nf_conntracknf_conntrack_netlink 49152 0nfnetlink 20480 2 nf_conntrack_netlinkip_vs_sh 16384 0ip_vs_wrr 16384 0ip_vs_rr 16384 0ip_vs 159744 6 ip_vs_rr,ip_vs_sh,ip_vs_wrrnf_conntrack 159744 5 xt_conntrack,nf_nat,nf_conntrack_netlink,xt_MASQUERADE,ip_vsnf_defrag_ipv4 16384 1 nf_conntracknf_defrag_ipv6 24576 2 nf_conntrack,ip_vslibcrc32c 16384 4 nf_conntrack,nf_nat,xfs,ip_vs[root@tiny-cilium-master-188-1 tiny-cilium]# cut -f1 -d &quot; &quot; /proc/modules | grep -e ip_vs -e nf_conntracknf_conntrack_netlinkip_vs_ship_vs_wrrip_vs_rrip_vsnf_conntrack 1.12 é…ç½®Linuxå†…æ ¸ï¼ˆciliumå¿…é€‰ï¼‰ciliumå’Œå…¶ä»–çš„cniç»„ä»¶æœ€å¤§çš„ä¸åŒåœ¨äºå…¶åº•å±‚ä½¿ç”¨äº†ebpfæŠ€æœ¯ï¼Œè€Œè¯¥æŠ€æœ¯å¯¹äºLinuxçš„ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬æœ‰è¾ƒé«˜çš„è¦æ±‚ï¼Œå®Œæˆçš„è¦æ±‚å¯ä»¥æŸ¥çœ‹å®˜ç½‘çš„è¯¦ç»†é“¾æ¥ï¼Œè¿™é‡Œæˆ‘ä»¬ç€é‡çœ‹å†…æ ¸ç‰ˆæœ¬ã€å†…æ ¸å‚æ•°è¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚ Linuxå†…æ ¸ç‰ˆæœ¬é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å‚è€ƒciliumå®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªç³»ç»Ÿè¦æ±‚æ€»ç»“ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨k8sé›†ç¾¤ä¸­éƒ¨ç½²ï¼ˆä½¿ç”¨å®¹å™¨ï¼‰ï¼Œå› æ­¤åªéœ€è¦å…³æ³¨Linuxå†…æ ¸ç‰ˆæœ¬å’Œetcdç‰ˆæœ¬å³å¯ã€‚æ ¹æ®å‰é¢éƒ¨ç½²çš„ç»éªŒæˆ‘ä»¬å¯ä»¥çŸ¥é“1.23.6ç‰ˆæœ¬çš„k8sé»˜è®¤ä½¿ç”¨çš„etcdç‰ˆæœ¬æ˜¯3.5.+ï¼Œå› æ­¤é‡ç‚¹å°±æ¥åˆ°äº†Linuxå†…æ ¸ç‰ˆæœ¬è¿™é‡Œã€‚ Requirement Minimum Version In cilium container Linux kernel &gt;= 4.9.17 no Key-Value store (etcd) &gt;= 3.1.0 no clang+LLVM &gt;= 10.0 yes iproute2 &gt;= 5.9.0 yes This requirement is only needed if you run cilium-agent natively. If you are using the Cilium container image cilium/cilium, clang+LLVM is included in the container image. iproute2 is only needed if you run cilium-agent directly on the host machine. iproute2 is included in the cilium/cilium container image. æ¯«æ— ç–‘é—®CentOS7å†…ç½®çš„é»˜è®¤å†…æ ¸ç‰ˆæœ¬3.10.xç‰ˆæœ¬çš„å†…æ ¸æ˜¯æ— æ³•æ»¡è¶³éœ€æ±‚çš„ï¼Œä½†æ˜¯åœ¨å‡çº§å†…æ ¸ä¹‹å‰ï¼Œæˆ‘ä»¬å†çœ‹çœ‹å…¶ä»–çš„ä¸€äº›è¦æ±‚ã€‚ ciliumå®˜æ–¹è¿˜ç»™å‡ºäº†ä¸€ä»½åˆ—è¡¨æè¿°äº†å„é¡¹é«˜çº§åŠŸèƒ½å¯¹å†…æ ¸ç‰ˆæœ¬çš„è¦æ±‚ï¼š Cilium Feature Minimum Kernel Version IPv4 fragment handling &gt;= 4.10 Restrictions on unique prefix lengths for CIDR policy rules &gt;= 4.11 IPsec Transparent Encryption in tunneling mode &gt;= 4.19 WireGuard Transparent Encryption &gt;= 5.6 Host-Reachable Services &gt;= 4.19.57, &gt;= 5.1.16, &gt;= 5.2 Kubernetes Without kube-proxy &gt;= 4.19.57, &gt;= 5.1.16, &gt;= 5.2 Bandwidth Manager &gt;= 5.1 Local Redirect Policy (beta) &gt;= 4.19.57, &gt;= 5.1.16, &gt;= 5.2 Full support for Session Affinity &gt;= 5.7 BPF-based proxy redirection &gt;= 5.7 BPF-based host routing &gt;= 5.10 Socket-level LB bypass in pod netns &gt;= 5.7 Egress Gateway (beta) &gt;= 5.2 VXLAN Tunnel Endpoint (VTEP) Integration &gt;= 5.2 å¯ä»¥çœ‹åˆ°å¦‚æœéœ€è¦æ»¡è¶³ä¸Šé¢æ‰€æœ‰éœ€æ±‚çš„è¯ï¼Œéœ€è¦å†…æ ¸ç‰ˆæœ¬é«˜äº5.10ï¼Œæœ¬ç€å­¦ä¹ æµ‹è¯•ç ”ç©¶ä½œæ­»çš„ç²¾ç¥ï¼Œåæ­£éƒ½å‡çº§äº†ï¼Œå¹²è„†å°±å‡çº§åˆ°æ–°ä¸€äº›çš„ç‰ˆæœ¬å§ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨elrepoæºæ¥å‡çº§å†…æ ¸åˆ°è¾ƒæ–°çš„å†…æ ¸ç‰ˆæœ¬ã€‚ 1234567891011121314151617181920212223242526272829303132333435# æŸ¥çœ‹elrepoæºä¸­æ”¯æŒçš„å†…æ ¸ç‰ˆæœ¬[root@tiny-cilium-master-188-1 ~]# yum --disablerepo=&quot;*&quot; --enablerepo=&quot;elrepo-kernel&quot; list availableLoaded plugins: fastestmirrorLoading mirror speeds from cached hostfileAvailable Packageselrepo-release.noarch 7.0-5.el7.elrepo elrepo-kernelkernel-lt.x86_64 5.4.192-1.el7.elrepo elrepo-kernelkernel-lt-devel.x86_64 5.4.192-1.el7.elrepo elrepo-kernelkernel-lt-doc.noarch 5.4.192-1.el7.elrepo elrepo-kernelkernel-lt-headers.x86_64 5.4.192-1.el7.elrepo elrepo-kernelkernel-lt-tools.x86_64 5.4.192-1.el7.elrepo elrepo-kernelkernel-lt-tools-libs.x86_64 5.4.192-1.el7.elrepo elrepo-kernelkernel-lt-tools-libs-devel.x86_64 5.4.192-1.el7.elrepo elrepo-kernelkernel-ml.x86_64 5.17.6-1.el7.elrepo elrepo-kernelkernel-ml-devel.x86_64 5.17.6-1.el7.elrepo elrepo-kernelkernel-ml-doc.noarch 5.17.6-1.el7.elrepo elrepo-kernelkernel-ml-headers.x86_64 5.17.6-1.el7.elrepo elrepo-kernelkernel-ml-tools.x86_64 5.17.6-1.el7.elrepo elrepo-kernelkernel-ml-tools-libs.x86_64 5.17.6-1.el7.elrepo elrepo-kernelkernel-ml-tools-libs-devel.x86_64 5.17.6-1.el7.elrepo elrepo-kernelperf.x86_64 5.17.6-1.el7.elrepo elrepo-kernelpython-perf.x86_64 5.17.6-1.el7.elrepo elrepo-kernel# çœ‹èµ·æ¥mlç‰ˆæœ¬çš„å†…æ ¸æ¯”è¾ƒæ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚,ç›´æ¥ä½¿ç”¨yumè¿›è¡Œå®‰è£…sudo yum --enablerepo=elrepo-kernel install kernel-ml -y# ä½¿ç”¨grubbyå·¥å…·æŸ¥çœ‹ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯sudo grubby --info=ALL# è®¾ç½®æ–°å®‰è£…çš„5.17.6ç‰ˆæœ¬å†…æ ¸ä¸ºé»˜è®¤å†…æ ¸ç‰ˆæœ¬ï¼Œæ­¤å¤„çš„index=0è¦å’Œä¸Šé¢æŸ¥çœ‹çš„å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯ä¸€è‡´sudo grubby --set-default-index=0# æŸ¥çœ‹é»˜è®¤å†…æ ¸æ˜¯å¦ä¿®æ”¹æˆåŠŸsudo grubby --default-kernel# é‡å¯ç³»ç»Ÿåˆ‡æ¢åˆ°æ–°å†…æ ¸init 6# é‡å¯åæ£€æŸ¥å†…æ ¸ç‰ˆæœ¬æ˜¯å¦ä¸ºæ–°çš„5.17.6uname -a Linuxå†…æ ¸å‚æ•°é¦–å…ˆæˆ‘ä»¬æŸ¥çœ‹è‡ªå·±å½“å‰å†…æ ¸ç‰ˆæœ¬çš„å‚æ•°ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åˆ†ä¸ºyã€nã€mä¸‰ä¸ªé€‰é¡¹ yï¼šyesï¼ŒBuild directly into the kernel. è¡¨ç¤ºè¯¥åŠŸèƒ½è¢«ç¼–è¯‘è¿›å†…æ ¸ä¸­ï¼Œé»˜è®¤å¯ç”¨ nï¼šnoï¼ŒLeave entirely out of the kernel. è¡¨ç¤ºè¯¥åŠŸèƒ½æœªè¢«ç¼–è¯‘è¿›å†…æ ¸ä¸­ï¼Œä¸å¯ç”¨ mï¼šmoduleï¼ŒBuild as a module, to be loaded if needed. è¡¨ç¤ºè¯¥åŠŸèƒ½è¢«ç¼–è¯‘ä¸ºæ¨¡å—ï¼ŒæŒ‰éœ€å¯ç”¨ 12# æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬çš„ç¼–è¯‘å‚æ•°cat /boot/config-$(uname -r) ciliumå®˜æ–¹å¯¹å„é¡¹åŠŸèƒ½æ‰€éœ€è¦å¼€å¯çš„å†…æ ¸å‚æ•°åˆ—ä¸¾å¦‚ä¸‹ï¼š In order for the eBPF feature to be enabled properly, the following kernel configuration options must be enabled. This is typically the case with distribution kernels. When an option can be built as a module or statically linked, either choice is valid. ä¸ºäº†æ­£ç¡®å¯ç”¨ eBPF åŠŸèƒ½ï¼Œå¿…é¡»å¯ç”¨ä»¥ä¸‹å†…æ ¸é…ç½®é€‰é¡¹ã€‚è¿™é€šå¸¸å› å†…æ ¸ç‰ˆæœ¬æƒ…å†µè€Œå¼‚ã€‚ä»»ä½•ä¸€ä¸ªé€‰é¡¹éƒ½å¯ä»¥æ„å»ºä¸ºæ¨¡å—æˆ–é™æ€é“¾æ¥ï¼Œä¸¤ä¸ªé€‰æ‹©éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ æˆ‘ä»¬æš‚æ—¶åªçœ‹æœ€åŸºæœ¬çš„Base Requirements 12345678910CONFIG_BPF=yCONFIG_BPF_SYSCALL=yCONFIG_NET_CLS_BPF=yCONFIG_BPF_JIT=yCONFIG_NET_CLS_ACT=yCONFIG_NET_SCH_INGRESS=yCONFIG_CRYPTO_SHA1=yCONFIG_CRYPTO_USER_API_HASH=yCONFIG_CGROUPS=yCONFIG_CGROUP_BPF=y å¯¹æ¯”æˆ‘ä»¬ä½¿ç”¨çš„5.17.6-1.el7.elrepo.x86_64å†…æ ¸å¯ä»¥å‘ç°æœ‰ä¸¤ä¸ªæ¨¡å—æ˜¯ä¸ºm 1234567891011[root@tiny-cilium-master-188-1 boot]# egrep &quot;^CONFIG_BPF=|^CONFIG_BPF_SYSCALL=|^CONFIG_NET_CLS_BPF=|^CONFIG_BPF_JIT=|^CONFIG_NET_CLS_ACT=|^CONFIG_NET_SCH_INGRESS=|^CONFIG_CRYPTO_SHA1=|^CONFIG_CRYPTO_USER_API_HASH=|^CONFIG_CGROUPS=|^CONFIG_CGROUP_BPF=&quot; /boot/config-5.17.6-1.el7.elrepo.x86_64CONFIG_BPF=yCONFIG_BPF_SYSCALL=yCONFIG_BPF_JIT=yCONFIG_CGROUPS=yCONFIG_CGROUP_BPF=yCONFIG_NET_SCH_INGRESS=mCONFIG_NET_CLS_BPF=mCONFIG_NET_CLS_ACT=yCONFIG_CRYPTO_SHA1=yCONFIG_CRYPTO_USER_API_HASH=y ç¼ºå°‘çš„è¿™ä¸¤ä¸ªæ¨¡å—æˆ‘ä»¬å¯ä»¥åœ¨/usr/lib/modules/$(uname -r)ç›®å½•ä¸‹é¢æ‰¾åˆ°å®ƒä»¬ï¼š 1234[root@tiny-cilium-master-188-1 5.17.6-1.el7.elrepo.x86_64]# realpath ./kernel/net/sched/sch_ingress.ko/usr/lib/modules/5.17.6-1.el7.elrepo.x86_64/kernel/net/sched/sch_ingress.ko[root@tiny-cilium-master-188-1 5.17.6-1.el7.elrepo.x86_64]# realpath ./kernel/net/sched/cls_bpf.ko/usr/lib/modules/5.17.6-1.el7.elrepo.x86_64/kernel/net/sched/cls_bpf.ko ç¡®è®¤ç›¸å…³å†…æ ¸æ¨¡å—å­˜åœ¨æˆ‘ä»¬ç›´æ¥åŠ è½½å†…æ ¸å³å¯ï¼š 123456789101112# ç›´æ¥ä½¿ç”¨modprobeå‘½ä»¤åŠ è½½[root@tiny-cilium-master-188-1 5.17.6-1.el7.elrepo.x86_64]# modprobe cls_bpf[root@tiny-cilium-master-188-1 5.17.6-1.el7.elrepo.x86_64]# modprobe sch_ingress[root@tiny-cilium-master-188-1 5.17.6-1.el7.elrepo.x86_64]# lsmod | egrep &quot;cls_bpf|sch_ingress&quot;sch_ingress 16384 0cls_bpf 24576 0# é…ç½®å¼€æœºè‡ªåŠ¨åŠ è½½ciliumæ‰€éœ€ç›¸å…³æ¨¡å—cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/cilium-base-requirements.confcls_bpfsch_ingressEOF å…¶ä»–ciliumé«˜çº§åŠŸèƒ½æ‰€éœ€è¦çš„å†…æ ¸åŠŸèƒ½ä¹Ÿç±»ä¼¼ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚ 2ã€å®‰è£…container runtime2.1 å®‰è£…dockerè¯¦ç»†çš„å®˜æ–¹æ–‡æ¡£å¯ä»¥å‚è€ƒè¿™é‡Œï¼Œç”±äºåœ¨åˆšå‘å¸ƒçš„1.24ç‰ˆæœ¬ä¸­ç§»é™¤äº†docker-shimï¼Œå› æ­¤å®‰è£…çš„ç‰ˆæœ¬â‰¥1.24çš„æ—¶å€™éœ€è¦æ³¨æ„å®¹å™¨è¿è¡Œæ—¶çš„é€‰æ‹©ã€‚è¿™é‡Œæˆ‘ä»¬å®‰è£…çš„ç‰ˆæœ¬ä½äº1.24ï¼Œå› æ­¤æˆ‘ä»¬ç»§ç»­ä½¿ç”¨dockerã€‚ dockerçš„å…·ä½“å®‰è£…å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚ 123456# å®‰è£…å¿…è¦çš„ä¾èµ–ç»„ä»¶å¹¶ä¸”å¯¼å…¥dockerå®˜æ–¹æä¾›çš„yumæºsudo yum install -y yum-utils device-mapper-persistent-data lvm2sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo# æˆ‘ä»¬ç›´æ¥å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„dockeryum install docker-ce docker-ce-cli containerd.io 2.2 é…ç½®cgroup driversCentOS7ä½¿ç”¨çš„æ˜¯systemdæ¥åˆå§‹åŒ–ç³»ç»Ÿå¹¶ç®¡ç†è¿›ç¨‹ï¼Œåˆå§‹åŒ–è¿›ç¨‹ä¼šç”Ÿæˆå¹¶ä½¿ç”¨ä¸€ä¸ª root æ§åˆ¶ç»„ (cgroup), å¹¶å……å½“ cgroup ç®¡ç†å™¨ã€‚ Systemd ä¸ cgroup é›†æˆç´§å¯†ï¼Œå¹¶å°†ä¸ºæ¯ä¸ª systemd å•å…ƒåˆ†é…ä¸€ä¸ª cgroupã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½®å®¹å™¨è¿è¡Œæ—¶å’Œ kubelet ä½¿ç”¨ cgroupfsã€‚ è¿åŒ systemd ä¸€èµ·ä½¿ç”¨ cgroupfs æ„å‘³ç€å°†æœ‰ä¸¤ä¸ªä¸åŒçš„ cgroup ç®¡ç†å™¨ã€‚è€Œå½“ä¸€ä¸ªç³»ç»Ÿä¸­åŒæ—¶å­˜åœ¨cgroupfså’Œsystemdä¸¤è€…æ—¶ï¼Œå®¹æ˜“å˜å¾—ä¸ç¨³å®šï¼Œå› æ­¤æœ€å¥½æ›´æ”¹è®¾ç½®ï¼Œä»¤å®¹å™¨è¿è¡Œæ—¶å’Œ kubelet ä½¿ç”¨ systemd ä½œä¸º cgroup é©±åŠ¨ï¼Œä»¥æ­¤ä½¿ç³»ç»Ÿæ›´ä¸ºç¨³å®šã€‚ å¯¹äº Docker, éœ€è¦è®¾ç½® native.cgroupdriver=systemd å‚æ•°ã€‚ å‚è€ƒå®˜æ–¹çš„è¯´æ˜æ–‡æ¡£ï¼š https://kubernetes.io/docs/setup/production-environment/container-runtimes/#cgroup-drivers å‚è€ƒé…ç½®è¯´æ˜æ–‡æ¡£ https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker 1234567891011121314151617181920sudo mkdir /etc/dockercat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json&#123; &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;], &quot;log-driver&quot;: &quot;json-file&quot;, &quot;log-opts&quot;: &#123; &quot;max-size&quot;: &quot;100m&quot; &#125;, &quot;storage-driver&quot;: &quot;overlay2&quot;&#125;EOFsudo systemctl enable dockersudo systemctl daemon-reloadsudo systemctl restart docker# æœ€åæ£€æŸ¥ä¸€ä¸‹Cgroup Driveræ˜¯å¦ä¸ºsystemd[root@tiny-calico-master-88-1 ~]# docker info | grep systemd Cgroup Driver: systemd 2.3 å…³äºkubeletçš„cgroup driverk8så®˜æ–¹æœ‰è¯¦ç»†çš„æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•è®¾ç½®kubeletçš„cgroup driverï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œåœ¨1.22ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨è®¾ç½®kubeletçš„cgroup driverï¼Œé‚£ä¹ˆé»˜è®¤ä¼šè®¾ç½®ä¸ºsystemd Note: In v1.22, if the user is not setting the cgroupDriver field under KubeletConfiguration, kubeadm will default it to systemd. ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æŒ‡å®škubeletçš„cgroup driverçš„æ–¹æ³•å°±æ˜¯åœ¨kubeadm-config.yamlåŠ å…¥cgroupDriverå­—æ®µ 12345678# kubeadm-config.yamlkind: ClusterConfigurationapiVersion: kubeadm.k8s.io/v1beta3kubernetesVersion: v1.21.0---kind: KubeletConfigurationapiVersion: kubelet.config.k8s.io/v1beta1cgroupDriver: systemd æˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥çœ‹configmapsæ¥æŸ¥çœ‹åˆå§‹åŒ–ä¹‹åé›†ç¾¤çš„kubeadm-configé…ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435[root@tiny-calico-master-88-1 tiny-calico]# kubectl describe configmaps kubeadm-config -n kube-systemName: kubeadm-configNamespace: kube-systemLabels: &lt;none&gt;Annotations: &lt;none&gt;Data====ClusterConfiguration:----apiServer: extraArgs: authorization-mode: Node,RBAC timeoutForControlPlane: 4m0sapiVersion: kubeadm.k8s.io/v1beta3certificatesDir: /etc/kubernetes/pkiclusterName: kubernetescontrollerManager: &#123;&#125;dns: &#123;&#125;etcd: local: dataDir: /var/lib/etcdimageRepository: registry.aliyuncs.com/google_containerskind: ClusterConfigurationkubernetesVersion: v1.23.6networking: dnsDomain: cali-cluster.tclocal serviceSubnet: 10.88.0.0/18scheduler: &#123;&#125;BinaryData====Events: &lt;none&gt; å½“ç„¶å› ä¸ºæˆ‘ä»¬éœ€è¦å®‰è£…çš„ç‰ˆæœ¬é«˜äº1.22.0å¹¶ä¸”ä½¿ç”¨çš„å°±æ˜¯systemdï¼Œå› æ­¤å¯ä»¥ä¸ç”¨å†é‡å¤é…ç½®ã€‚ 3ã€å®‰è£…kubeä¸‰ä»¶å¥— å¯¹åº”çš„å®˜æ–¹æ–‡æ¡£å¯ä»¥å‚è€ƒè¿™é‡Œ https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl kubeä¸‰ä»¶å¥—å°±æ˜¯kubeadmã€kubelet å’Œ kubectlï¼Œä¸‰è€…çš„å…·ä½“åŠŸèƒ½å’Œä½œç”¨å¦‚ä¸‹ï¼š kubeadmï¼šç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤ã€‚ kubeletï¼šåœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ Pod å’Œå®¹å™¨ç­‰ã€‚ kubectlï¼šç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š kubeadmä¸ä¼šå¸®åŠ©æˆ‘ä»¬ç®¡ç†kubeletå’Œkubectlï¼Œå…¶ä»–ä¸¤è€…ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸‰è€…æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå¹¶ä¸å­˜åœ¨è°ç®¡ç†è°çš„æƒ…å†µï¼› kubeletçš„ç‰ˆæœ¬å¿…é¡»å°äºç­‰äºAPI-serverçš„ç‰ˆæœ¬ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°å…¼å®¹æ€§çš„é—®é¢˜ï¼› kubectlå¹¶ä¸æ˜¯é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦å®‰è£…ï¼Œä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šè¦å®‰è£…åœ¨é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼Œå¯ä»¥å•ç‹¬å®‰è£…åœ¨è‡ªå·±æœ¬åœ°çš„æœºå™¨ç¯å¢ƒä¸Šé¢ï¼Œç„¶åé…åˆkubeconfigæ–‡ä»¶å³å¯ä½¿ç”¨kubectlå‘½ä»¤æ¥è¿œç¨‹ç®¡ç†å¯¹åº”çš„k8sé›†ç¾¤ï¼› CentOS7çš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„yumæºå³å¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œéœ€è¦è®¾ç½®selinuxçš„çŠ¶æ€ï¼Œä½†æ˜¯å‰é¢æˆ‘ä»¬å·²ç»å…³é—­äº†selinuxï¼Œå› æ­¤è¿™é‡Œç•¥è¿‡è¿™æ­¥ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041# ç›´æ¥å¯¼å…¥è°·æ­Œå®˜æ–¹çš„yumæºcat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearchenabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpgexclude=kubelet kubeadm kubectlEOF# å½“ç„¶å¦‚æœè¿ä¸ä¸Šè°·æ­Œçš„æºï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å›½å†…çš„é˜¿é‡Œé•œåƒæºcat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/enabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpgEOF# æ¥ä¸‹æ¥ç›´æ¥å®‰è£…ä¸‰ä»¶å¥—å³å¯sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes# å¦‚æœç½‘ç»œç¯å¢ƒä¸å¥½å‡ºç°gpgcheckéªŒè¯å¤±è´¥å¯¼è‡´æ— æ³•æ­£å¸¸è¯»å–yumæºï¼Œå¯ä»¥è€ƒè™‘å…³é—­è¯¥yumæºçš„repo_gpgchecksed -i &#x27;s/repo_gpgcheck=1/repo_gpgcheck=0/g&#x27; /etc/yum.repos.d/kubernetes.repo# æˆ–è€…åœ¨å®‰è£…çš„æ—¶å€™ç¦ç”¨gpgchecksudo yum install -y kubelet kubeadm kubectl --nogpgcheck --disableexcludes=kubernetes# å¦‚æœæƒ³è¦å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹ç›¸å…³ç‰ˆæœ¬çš„ä¿¡æ¯sudo yum list --nogpgcheck kubelet kubeadm kubectl --showduplicates --disableexcludes=kubernetes# è¿™é‡Œæˆ‘ä»¬ä¸ºäº†ä¿ç•™ä½¿ç”¨docker-shimï¼Œå› æ­¤æˆ‘ä»¬æŒ‰ç…§1.24.0ç‰ˆæœ¬çš„å‰ä¸€ä¸ªç‰ˆæœ¬1.23.6sudo yum install -y kubelet-1.23.6-0 kubeadm-1.23.6-0 kubectl-1.23.6-0 --nogpgcheck --disableexcludes=kubernetes# å®‰è£…å®Œæˆåé…ç½®å¼€æœºè‡ªå¯kubeletsudo systemctl enable --now kubelet 4ã€åˆå§‹åŒ–é›†ç¾¤4.1 ç¼–å†™é…ç½®æ–‡ä»¶åœ¨é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œå®Œä¸Šé¢çš„ä¸‰ç‚¹æ“ä½œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹åˆ›å»ºk8sé›†ç¾¤äº†ã€‚å› ä¸ºæˆ‘ä»¬è¿™æ¬¡ä¸æ¶‰åŠé«˜å¯ç”¨éƒ¨ç½²ï¼Œå› æ­¤åˆå§‹åŒ–çš„æ—¶å€™ç›´æ¥åœ¨æˆ‘ä»¬çš„ç›®æ ‡masterèŠ‚ç‚¹ä¸Šé¢æ“ä½œå³å¯ã€‚ 123456789101112131415# æˆ‘ä»¬å…ˆä½¿ç”¨kubeadmå‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ä¸»è¦çš„å‡ ä¸ªé•œåƒç‰ˆæœ¬# å› ä¸ºæˆ‘ä»¬æ­¤å‰æŒ‡å®šå®‰è£…äº†æ—§çš„1.23.6ç‰ˆæœ¬ï¼Œè¿™é‡Œçš„apiserveré•œåƒç‰ˆæœ¬ä¹Ÿä¼šéšä¹‹å›æ»š[root@tiny-cilium-master-188-1 ~]# kubeadm config images listI0509 12:06:03.036544 3593 version.go:255] remote version is much newer: v1.24.0; falling back to: stable-1.23k8s.gcr.io/kube-apiserver:v1.23.6k8s.gcr.io/kube-controller-manager:v1.23.6k8s.gcr.io/kube-scheduler:v1.23.6k8s.gcr.io/kube-proxy:v1.23.6k8s.gcr.io/pause:3.6k8s.gcr.io/etcd:3.5.1-0k8s.gcr.io/coredns/coredns:v1.8.6# ä¸ºäº†æ–¹ä¾¿ç¼–è¾‘å’Œç®¡ç†ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŠŠåˆå§‹åŒ–å‚æ•°å¯¼å‡ºæˆé…ç½®æ–‡ä»¶[root@tiny-cilium-master-188-1 tiny-cilium]# kubeadm config print init-defaults &gt; kubeadm-cilium.conf è€ƒè™‘åˆ°å¤§å¤šæ•°æƒ…å†µä¸‹å›½å†…çš„ç½‘ç»œæ— æ³•ä½¿ç”¨è°·æ­Œçš„k8s.gcr.ioé•œåƒæºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹imageRepositoryå‚æ•°ä¸ºé˜¿é‡Œçš„é•œåƒæº kubernetesVersionå­—æ®µç”¨æ¥æŒ‡å®šæˆ‘ä»¬è¦å®‰è£…çš„k8sç‰ˆæœ¬ localAPIEndpointå‚æ•°éœ€è¦ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„masterèŠ‚ç‚¹çš„IPå’Œç«¯å£ï¼Œåˆå§‹åŒ–ä¹‹åçš„k8sé›†ç¾¤çš„apiserveråœ°å€å°±æ˜¯è¿™ä¸ª podSubnetã€serviceSubnetå’ŒdnsDomainä¸¤ä¸ªå‚æ•°é»˜è®¤æƒ…å†µä¸‹å¯ä»¥ä¸ç”¨ä¿®æ”¹ï¼Œè¿™é‡Œæˆ‘æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚è¿›è¡Œäº†å˜æ›´ nodeRegistrationé‡Œé¢çš„nameå‚æ•°ä¿®æ”¹ä¸ºå¯¹åº”masterèŠ‚ç‚¹çš„hostname æ–°å¢é…ç½®å—ä½¿ç”¨ipvsï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ 1234567891011121314151617181920212223242526272829303132333435363738394041apiVersion: kubeadm.k8s.io/v1beta3bootstrapTokens:- groups: - system:bootstrappers:kubeadm:default-node-token token: abcdef.0123456789abcdef ttl: 24h0m0s usages: - signing - authenticationkind: InitConfigurationlocalAPIEndpoint: advertiseAddress: 10.31.188.1 bindPort: 6443nodeRegistration: criSocket: /var/run/dockershim.sock imagePullPolicy: IfNotPresent name: tiny-cilium-master-188-1.k8s.tcinternal taints: null---apiServer: timeoutForControlPlane: 4m0sapiVersion: kubeadm.k8s.io/v1beta3certificatesDir: /etc/kubernetes/pkiclusterName: kubernetescontrollerManager: &#123;&#125;dns: &#123;&#125;etcd: local: dataDir: /var/lib/etcdimageRepository: registry.aliyuncs.com/google_containerskind: ClusterConfigurationkubernetesVersion: 1.23.6networking: dnsDomain: cili-cluster.tclocal serviceSubnet: 10.188.0.0/18 podSubnet: 10.188.64.0/18scheduler: &#123;&#125;---apiVersion: kubeproxy.config.k8s.io/v1alpha1kind: KubeProxyConfigurationmode: ipvs 4.2 åˆå§‹åŒ–é›†ç¾¤æ­¤æ—¶æˆ‘ä»¬å†æŸ¥çœ‹å¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­çš„é•œåƒç‰ˆæœ¬ï¼Œå°±ä¼šå‘ç°å·²ç»å˜æˆäº†å¯¹åº”é˜¿é‡Œäº‘é•œåƒæºçš„ç‰ˆæœ¬ 12345678910111213141516171819202122232425262728# æŸ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„é•œåƒç‰ˆæœ¬ï¼Œç¡®å®šé…ç½®æ–‡ä»¶æ˜¯å¦ç”Ÿæ•ˆ[root@tiny-cilium-master-188-1 tiny-cilium]# kubeadm config images list --config kubeadm-cilium.confregistry.aliyuncs.com/google_containers/kube-apiserver:v1.23.6registry.aliyuncs.com/google_containers/kube-controller-manager:v1.23.6registry.aliyuncs.com/google_containers/kube-scheduler:v1.23.6registry.aliyuncs.com/google_containers/kube-proxy:v1.23.6registry.aliyuncs.com/google_containers/pause:3.6registry.aliyuncs.com/google_containers/etcd:3.5.1-0registry.aliyuncs.com/google_containers/coredns:v1.8.6# ç¡®è®¤æ²¡é—®é¢˜ä¹‹åæˆ‘ä»¬ç›´æ¥æ‹‰å–é•œåƒ[root@tiny-cilium-master-188-1 tiny-cilium]# kubeadm config images pull --config kubeadm-cilium.conf[config/images] Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/pause:3.6[config/images] Pulled registry.aliyuncs.com/google_containers/etcd:3.5.1-0[config/images] Pulled registry.aliyuncs.com/google_containers/coredns:v1.8.6# åˆå§‹åŒ–[root@tiny-cilium-master-188-1 tiny-cilium]# kubeadm init --config kubeadm-cilium.conf[init] Using Kubernetes version: v1.23.6[preflight] Running pre-flight checks[preflight] Pulling images required for setting up a Kubernetes cluster[preflight] This might take a minute or two, depending on the speed of your internet connection[preflight] You can also perform this action in beforehand using &#x27;kubeadm config images pull&#x27;...æ­¤å¤„ç•¥å»ä¸€å †è¾“å‡º... å½“æˆ‘ä»¬çœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡ºç»“æœçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„é›†ç¾¤å°±ç®—æ˜¯åˆå§‹åŒ–æˆåŠŸäº†ã€‚ 1234567891011121314151617181920Your Kubernetes control-plane has initialized successfully!To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/configAlternatively, if you are the root user, you can run: export KUBECONFIG=/etc/kubernetes/admin.confYou should now deploy a pod network to the cluster.Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/Then you can join any number of worker nodes by running the following on each as root:kubeadm join 10.31.188.1:6443 --token abcdef.0123456789abcdef \\ --discovery-token-ca-cert-hash sha256:fbe33f0dbda199b487a78948a4c693660d742d0dfc270bad2963a035b4971ade 4.3 é…ç½®kubeconfigåˆšåˆå§‹åŒ–æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬è¿˜æ²¡åŠæ³•é©¬ä¸ŠæŸ¥çœ‹k8sé›†ç¾¤ä¿¡æ¯ï¼Œéœ€è¦é…ç½®kubeconfigç›¸å…³å‚æ•°æ‰èƒ½æ­£å¸¸ä½¿ç”¨kubectlè¿æ¥apiserverè¯»å–é›†ç¾¤ä¿¡æ¯ã€‚ 12345678910# å¯¹äºérootç”¨æˆ·ï¼Œå¯ä»¥è¿™æ ·æ“ä½œmkdir -p $HOME/.kubesudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configsudo chown $(id -u):$(id -g) $HOME/.kube/config# å¦‚æœæ˜¯rootç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥å¯¼å…¥ç¯å¢ƒå˜é‡export KUBECONFIG=/etc/kubernetes/admin.conf# æ·»åŠ kubectlçš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc å‰é¢æˆ‘ä»¬æåˆ°è¿‡kubectlä¸ä¸€å®šè¦å®‰è£…åœ¨é›†ç¾¤å†…ï¼Œå®é™…ä¸Šåªè¦æ˜¯ä»»ä½•ä¸€å°èƒ½è¿æ¥åˆ°apiserverçš„æœºå™¨ä¸Šé¢éƒ½å¯ä»¥å®‰è£…kubectlå¹¶ä¸”æ ¹æ®æ­¥éª¤é…ç½®kubeconfigï¼Œå°±å¯ä»¥ä½¿ç”¨kubectlå‘½ä»¤è¡Œæ¥ç®¡ç†å¯¹åº”çš„k8sé›†ç¾¤ã€‚ é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å†æ‰§è¡Œç›¸å…³å‘½ä»¤å°±å¯ä»¥æŸ¥çœ‹é›†ç¾¤çš„ä¿¡æ¯äº†ã€‚ 1234567891011121314151617181920[root@tiny-cilium-master-188-1 tiny-cilium]# kubectl cluster-infoKubernetes control plane is running at https://10.31.188.1:6443CoreDNS is running at https://10.31.188.1:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxyTo further debug and diagnose cluster problems, use &#x27;kubectl cluster-info dump&#x27;.[root@tiny-cilium-master-188-1 tiny-cilium]# kubectl get nodes -o wideNAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIMEtiny-cilium-master-188-1.k8s.tcinternal NotReady control-plane,master 84s v1.23.6 10.31.188.1 &lt;none&gt; CentOS Linux 7 (Core) 5.17.6-1.el7.elrepo.x86_64 docker://20.10.14[root@tiny-cilium-master-188-1 tiny-cilium]# kubectl get pods -A -o wideNAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESkube-system coredns-6d8c4cb4d-285cl 0/1 Pending 0 78s &lt;none&gt; &lt;none&gt; &lt;none&gt; &lt;none&gt;kube-system coredns-6d8c4cb4d-6zntv 0/1 Pending 0 78s &lt;none&gt; &lt;none&gt; &lt;none&gt; &lt;none&gt;kube-system etcd-tiny-cilium-master-188-1.k8s.tcinternal 1/1 Running 0 90s 10.31.188.1 tiny-cilium-master-188-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-apiserver-tiny-cilium-master-188-1.k8s.tcinternal 1/1 Running 0 92s 10.31.188.1 tiny-cilium-master-188-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-controller-manager-tiny-cilium-master-188-1.k8s.tcinternal 1/1 Running 0 90s 10.31.188.1 tiny-cilium-master-188-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-proxy-m7q5n 1/1 Running 0 78s 10.31.188.1 tiny-cilium-master-188-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-scheduler-tiny-cilium-master-188-1.k8s.tcinternal 1/1 Running 0 91s 10.31.188.1 tiny-cilium-master-188-1.k8s.tcinternal &lt;none&gt; &lt;none&gt; 4.4 æ·»åŠ workerèŠ‚ç‚¹è¿™æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­æ·»åŠ å‰©ä¸‹çš„ä¸¤ä¸ªèŠ‚ç‚¹ä½œä¸ºworkerèŠ‚ç‚¹è¿è¡Œè´Ÿè½½ï¼Œç›´æ¥åœ¨å‰©ä¸‹çš„èŠ‚ç‚¹ä¸Šé¢è¿è¡Œé›†ç¾¤åˆå§‹åŒ–æˆåŠŸæ—¶è¾“å‡ºçš„å‘½ä»¤å°±å¯ä»¥æˆåŠŸåŠ å…¥é›†ç¾¤ã€‚ 123456789101112131415[root@tiny-cilium-worker-188-11 ~]# kubeadm join 10.31.188.1:6443 --token abcdef.0123456789abcdef \\&gt; --discovery-token-ca-cert-hash sha256:fbe33f0dbda199b487a78948a4c693660d742d0dfc270bad2963a035b4971ade[preflight] Running pre-flight checks[preflight] Reading configuration from the cluster...[preflight] FYI: You can look at this config file with &#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;[kubelet-start] Starting the kubelet[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...This node has joined the cluster:* Certificate signing request was sent to apiserver and a response was received.* The Kubelet was informed of the new secure connection details.Run &#x27;kubectl get nodes&#x27; on the control-plane to see this node join the cluster. å¦‚æœä¸å°å¿ƒæ²¡ä¿å­˜åˆå§‹åŒ–æˆåŠŸçš„è¾“å‡ºä¿¡æ¯ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨kubectlå·¥å…·æŸ¥çœ‹æˆ–è€…ç”Ÿæˆtoken 12345678910111213141516# æŸ¥çœ‹ç°æœ‰çš„tokenåˆ—è¡¨[root@tiny-cilium-master-188-1 tiny-cilium]# kubeadm token listTOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPSabcdef.0123456789abcdef 23h 2022-05-10T05:46:11Z authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-token# å¦‚æœtokenå·²ç»å¤±æ•ˆï¼Œé‚£å°±å†åˆ›å»ºä¸€ä¸ªæ–°çš„token[root@tiny-cilium-master-188-1 tiny-cilium]# kubeadm token createxd468t.co8ye3su70bojo2k[root@tiny-cilium-master-188-1 tiny-cilium]# kubeadm token listTOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPSabcdef.0123456789abcdef 23h 2022-05-10T05:46:11Z authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-tokenxd468t.co8ye3su70bojo2k 23h 2022-05-10T05:58:40Z authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-token# å¦‚æœæ‰¾ä¸åˆ°--discovery-token-ca-cert-hashå‚æ•°ï¼Œåˆ™å¯ä»¥åœ¨masterèŠ‚ç‚¹ä¸Šä½¿ç”¨opensslå·¥å…·æ¥è·å–[root@tiny-cilium-master-188-1 tiny-cilium]# openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#x27;s/^.* //&#x27;0d68339d3e5a045dc093470321f8f6334223e97f360542477c4f480bda34d72a æ·»åŠ å®Œæˆä¹‹åæˆ‘ä»¬å†æŸ¥çœ‹é›†ç¾¤çš„èŠ‚ç‚¹å¯ä»¥å‘ç°è¿™æ—¶å€™å·²ç»å¤šäº†ä¸¤ä¸ªnodeï¼Œä½†æ˜¯æ­¤æ—¶èŠ‚ç‚¹çš„çŠ¶æ€è¿˜æ˜¯NotReadyï¼Œæ¥ä¸‹æ¥å°±éœ€è¦éƒ¨ç½²CNIäº†ã€‚ 12345[root@tiny-cilium-master-188-1 tiny-cilium]# kubectl get nodesNAME STATUS ROLES AGE VERSIONtiny-cilium-master-188-1.k8s.tcinternal NotReady control-plane,master 2m47s v1.23.6tiny-cilium-worker-188-11.k8s.tcinternal NotReady &lt;none&gt; 41s v1.23.6tiny-cilium-worker-188-12.k8s.tcinternal NotReady &lt;none&gt; 30s v1.23.6 5ã€å®‰è£…CNI5.1 å®‰è£…ciliumå¿«é€Ÿå®‰è£…çš„æ•™ç¨‹å¯ä»¥å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼ŒåŸºæœ¬çš„å®‰è£…æ€è·¯å°±æ˜¯å…ˆä¸‹è½½ciliumå®˜æ–¹çš„cliå·¥å…·ï¼Œç„¶åä½¿ç”¨cliå·¥å…·è¿›è¡Œå®‰è£…ã€‚ è¿™ç§å®‰è£…æ–¹å¼çš„ä¼˜åŠ¿å°±æ˜¯ç®€å•å¿«æ·ï¼Œç¼ºç‚¹å°±æ˜¯ç¼ºå°‘è‡ªå®šä¹‰å‚æ•°é…ç½®çš„åŠŸèƒ½ï¼Œåªèƒ½ä½¿ç”¨å®˜æ–¹åŸå…ˆè®¾ç½®çš„é»˜è®¤å‚æ•°ï¼Œæ¯”è¾ƒé€‚åˆå¿«é€Ÿåˆå§‹åŒ–æ­å»ºå¯ç”¨ç¯å¢ƒç”¨æ¥å­¦ä¹ å’Œæµ‹è¯•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142# ciliumçš„cliå·¥å…·æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„å¯æ‰§è¡Œæ–‡ä»¶[root@tiny-cilium-master-188-1 tiny-cilium]# curl -L --remote-name-all https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz&#123;,.sha256sum&#125;[root@tiny-cilium-master-188-1 tiny-cilium]# sha256sum --check cilium-linux-amd64.tar.gz.sha256sumcilium-linux-amd64.tar.gz: OK[root@tiny-cilium-master-188-1 tiny-cilium]# sudo tar xzvfC cilium-linux-amd64.tar.gz /usr/local/bincilium# ä½¿ç”¨è¯¥å‘½ä»¤å³å¯å®Œæˆciliumçš„å®‰è£…[root@tiny-cilium-master-188-1 tiny-cilium]# cilium installâ„¹ï¸ using Cilium version &quot;v1.11.3&quot;ğŸ”® Auto-detected cluster name: kubernetesğŸ”® Auto-detected IPAM mode: cluster-poolâ„¹ï¸ helm template --namespace kube-system cilium cilium/cilium --version 1.11.3 --set cluster.id=0,cluster.name=kubernetes,encryption.nodeEncryption=false,ipam.mode=cluster-pool,kubeProxyReplacement=disabled,operator.replicas=1,serviceAccounts.cilium.name=cilium,serviceAccounts.operator.name=cilium-operatorâ„¹ï¸ Storing helm values file in kube-system/cilium-cli-helm-values SecretğŸ”‘ Created CA in secret cilium-cağŸ”‘ Generating certificates for Hubble...ğŸš€ Creating Service accounts...ğŸš€ Creating Cluster roles...ğŸš€ Creating ConfigMap for Cilium version 1.11.3...ğŸš€ Creating Agent DaemonSet...level=warning msg=&quot;spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[1].matchExpressions[0].key: beta.kubernetes.io/os is deprecated since v1.14; use \\&quot;kubernetes.io/os\\&quot; instead&quot; subsys=kloglevel=warning msg=&quot;spec.template.metadata.annotations[scheduler.alpha.kubernetes.io/critical-pod]: non-functional in v1.16+; use the \\&quot;priorityClassName\\&quot; field instead&quot; subsys=klogğŸš€ Creating Operator Deployment...âŒ› Waiting for Cilium to be installed and ready...âœ… Cilium was successfully installed! Run &#x27;cilium status&#x27; to view installation health# æŸ¥çœ‹ciliumçš„çŠ¶æ€[root@tiny-cilium-master-188-1 tiny-cilium]# cilium status /Â¯Â¯\\ /Â¯Â¯\\__/Â¯Â¯\\ Cilium: OK \\__/Â¯Â¯\\__/ Operator: OK /Â¯Â¯\\__/Â¯Â¯\\ Hubble: disabled \\__/Â¯Â¯\\__/ ClusterMesh: disabled \\__/DaemonSet cilium Desired: 3, Ready: 3/3, Available: 3/3Deployment cilium-operator Desired: 1, Ready: 1/1, Available: 1/1Containers: cilium-operator Running: 1 cilium Running: 3Cluster Pods: 2/2 managed by CiliumImage versions cilium quay.io/cilium/cilium:v1.11.3@sha256:cb6aac121e348abd61a692c435a90a6e2ad3f25baa9915346be7b333de8a767f: 3 cilium-operator quay.io/cilium/operator-generic:v1.11.3@sha256:5b81db7a32cb7e2d00bb3cf332277ec2b3be239d9e94a8d979915f4e6648c787: 1 5.2 é…ç½®hubble1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283# æˆ‘ä»¬å…ˆä½¿ç”¨cilium-cliå·¥å…·åœ¨k8sé›†ç¾¤ä¸­éƒ¨ç½²hubbleï¼Œåªéœ€è¦ä¸‹é¢ä¸€æ¡å‘½ä»¤å³å¯[root@tiny-cilium-master-188-1 tiny-cilium]# cilium hubble enableğŸ”‘ Found CA in secret cilium-caâ„¹ï¸ helm template --namespace kube-system cilium cilium/cilium --version 1.11.3 --set cluster.id=0,cluster.name=kubernetes,encryption.nodeEncryption=false,hubble.enabled=true,hubble.relay.enabled=true,hubble.tls.ca.cert=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNGRENDQWJxZ0F3SUJBZ0lVSDRQcit1UU0xSXZtdWQvVlV3YWlycGllSEZBd0NnWUlLb1pJemowRUF3SXcKYURFTE1Ba0dBMVVFQmhNQ1ZWTXhGakFVQmdOVkJBZ1REVk5oYmlCR2NtRnVZMmx6WTI4eEN6QUpCZ05WQkFjVApBa05CTVE4d0RRWURWUVFLRXdaRGFXeHBkVzB4RHpBTkJnTlZCQXNUQmtOcGJHbDFiVEVTTUJBR0ExVUVBeE1KClEybHNhWFZ0SUVOQk1CNFhEVEl5TURVd09UQTVNREF3TUZvWERUSTNNRFV3T0RBNU1EQXdNRm93YURFTE1Ba0cKQTFVRUJoTUNWVk14RmpBVUJnTlZCQWdURFZOaGJpQkdjbUZ1WTJselkyOHhDekFKQmdOVkJBY1RBa05CTVE4dwpEUVlEVlFRS0V3WkRhV3hwZFcweER6QU5CZ05WQkFzVEJrTnBiR2wxYlRFU01CQUdBMVVFQXhNSlEybHNhWFZ0CklFTkJNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUU3Z21EQ05WOERseEIxS3VYYzhEdndCeUoKWUxuSENZNjVDWUhBb3ZBY3FUM3drcitLVVNwelcyVjN0QW9IaFdZV0UyQ2lUNjNIOXZLV1ZRY3pHeXp1T0tOQwpNRUF3RGdZRFZSMFBBUUgvQkFRREFnRUdNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGQmMrClNDb3F1Y0JBc09sdDBWaEVCbkwyYjEyNE1Bb0dDQ3FHU000OUJBTUNBMGdBTUVVQ0lRRDJsNWVqaDVLVTkySysKSHJJUXIweUwrL05pZ3NSUHRBblA5T3lDcHExbFJBSWdYeGY5a2t5N2xYU0pOYmpkREFjbnBrNlJFTFp2eEkzbQpKaG9JRkRlbER0dz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=,hubble.tls.ca.key=[--- REDACTED WHEN PRINTING TO TERMINAL (USE --redact-helm-certificate-keys=false TO PRINT) ---],ipam.mode=cluster-pool,kubeProxyReplacement=disabled,operator.replicas=1,serviceAccounts.cilium.name=cilium,serviceAccounts.operator.name=cilium-operatorâœ¨ Patching ConfigMap cilium-config to enable Hubble...ğŸš€ Creating ConfigMap for Cilium version 1.11.3...â™»ï¸ Restarted Cilium podsâŒ› Waiting for Cilium to become ready before deploying other Hubble component(s)...âœ¨ Generating certificates...ğŸ”‘ Generating certificates for Relay...âœ¨ Deploying Relay...âŒ› Waiting for Hubble to be installed...â„¹ï¸ Storing helm values file in kube-system/cilium-cli-helm-values Secretâœ… Hubble was successfully enabled!# å®‰è£…hubble-cliå·¥å…·ï¼Œå®‰è£…é€»è¾‘å’Œcilium-cliçš„é€»è¾‘ç›¸ä¼¼[root@tiny-cilium-master-188-1 tiny-cilium]# export HUBBLE_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/hubble/master/stable.txt)[root@tiny-cilium-master-188-1 tiny-cilium]# curl -L --remote-name-all https://github.com/cilium/hubble/releases/download/$HUBBLE_VERSION/hubble-linux-amd64.tar.gz&#123;,.sha256sum&#125;[root@tiny-cilium-master-188-1 tiny-cilium]# sha256sum --check hubble-linux-amd64.tar.gz.sha256sumhubble-linux-amd64.tar.gz: OK[root@tiny-cilium-master-188-1 tiny-cilium]# sudo tar xzvfC hubble-linux-amd64.tar.gz /usr/local/binhubble# é¦–å…ˆæˆ‘ä»¬è¦å¼€å¯hubbleçš„apiï¼Œä½¿ç”¨cilium-cliå¼€å¯è½¬å‘[root@tiny-cilium-master-188-1 ~]# cilium hubble port-forward&amp;[1] 15512[root@tiny-cilium-master-188-1 ~]# kubectl get svc -n kube-systemNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEhubble-relay ClusterIP 10.188.55.197 &lt;none&gt; 80/TCP 16hhubble-ui ClusterIP 10.188.17.78 &lt;none&gt; 80/TCP 16hkube-dns ClusterIP 10.188.0.10 &lt;none&gt; 53/UDP,53/TCP,9153/TCP 17h[root@tiny-cilium-master-188-1 ~]# netstat -ntulp | grep 4245tcp 0 0 0.0.0.0:4245 0.0.0.0:* LISTEN 15527/kubectltcp6 0 0 :::4245 :::* LISTEN 15527/kubectl# å®é™…ä¸Šæ‰§è¡Œçš„æ“ä½œç­‰åŒäºä¸‹é¢è¿™ä¸ªå‘½ä»¤# kubectl port-forward -n kube-system svc/hubble-relay --address 0.0.0.0 --address :: 4245:80# æµ‹è¯•å’Œhubble-apiçš„è¿é€šæ€§[root@tiny-cilium-master-188-1 ~]# hubble statusHealthcheck (via localhost:4245): OkCurrent/Max Flows: 12,285/12,285 (100.00%)Flows/s: 28.58Connected Nodes: 3/3# ä½¿ç”¨hubbleå‘½ä»¤æŸ¥çœ‹æ•°æ®çš„è½¬å‘æƒ…å†µ[root@tiny-cilium-master-188-1 tiny-cilium]# hubble observeHandling connection for 4245May 9 09:33:25.861: 10.0.1.47:44484 -&gt; cilium-test/echo-same-node-5767b7b99d-xhzpb:8080 to-endpoint FORWARDED (TCP Flags: ACK, PSH)May 9 09:33:25.863: 10.0.1.47:44484 &lt;- cilium-test/echo-same-node-5767b7b99d-xhzpb:8080 to-stack FORWARDED (TCP Flags: ACK, PSH)May 9 09:33:25.864: 10.0.1.47:44484 -&gt; cilium-test/echo-same-node-5767b7b99d-xhzpb:8080 to-endpoint FORWARDED (TCP Flags: ACK, FIN)...æ­¤å¤„ç•¥å»ä¸€å †è¾“å‡º...# å¼€å¯hubble uiç»„ä»¶[root@tiny-cilium-master-188-1 tiny-cilium]# cilium hubble enable --uiğŸ”‘ Found CA in secret cilium-caâ„¹ï¸ helm template --namespace kube-system cilium cilium/cilium --version 1.11.3 --set cluster.id=0,cluster.name=kubernetes,encryption.nodeEncryption=false,hubble.enabled=true,hubble.relay.enabled=true,hubble.tls.ca.cert=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNGRENDQWJxZ0F3SUJBZ0lVSDRQcit1UU0xSXZtdWQvVlV3YWlycGllSEZBd0NnWUlLb1pJemowRUF3SXcKYURFTE1Ba0dBMVVFQmhNQ1ZWTXhGakFVQmdOVkJBZ1REVk5oYmlCR2NtRnVZMmx6WTI4eEN6QUpCZ05WQkFjVApBa05CTVE4d0RRWURWUVFLRXdaRGFXeHBkVzB4RHpBTkJnTlZCQXNUQmtOcGJHbDFiVEVTTUJBR0ExVUVBeE1KClEybHNhWFZ0SUVOQk1CNFhEVEl5TURVd09UQTVNREF3TUZvWERUSTNNRFV3T0RBNU1EQXdNRm93YURFTE1Ba0cKQTFVRUJoTUNWVk14RmpBVUJnTlZCQWdURFZOaGJpQkdjbUZ1WTJselkyOHhDekFKQmdOVkJBY1RBa05CTVE4dwpEUVlEVlFRS0V3WkRhV3hwZFcweER6QU5CZ05WQkFzVEJrTnBiR2wxYlRFU01CQUdBMVVFQXhNSlEybHNhWFZ0CklFTkJNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUU3Z21EQ05WOERseEIxS3VYYzhEdndCeUoKWUxuSENZNjVDWUhBb3ZBY3FUM3drcitLVVNwelcyVjN0QW9IaFdZV0UyQ2lUNjNIOXZLV1ZRY3pHeXp1T0tOQwpNRUF3RGdZRFZSMFBBUUgvQkFRREFnRUdNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGQmMrClNDb3F1Y0JBc09sdDBWaEVCbkwyYjEyNE1Bb0dDQ3FHU000OUJBTUNBMGdBTUVVQ0lRRDJsNWVqaDVLVTkySysKSHJJUXIweUwrL05pZ3NSUHRBblA5T3lDcHExbFJBSWdYeGY5a2t5N2xYU0pOYmpkREFjbnBrNlJFTFp2eEkzbQpKaG9JRkRlbER0dz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=,hubble.tls.ca.key=[--- REDACTED WHEN PRINTING TO TERMINAL (USE --redact-helm-certificate-keys=false TO PRINT) ---],hubble.ui.enabled=true,hubble.ui.securityContext.enabled=false,ipam.mode=cluster-pool,kubeProxyReplacement=disabled,operator.replicas=1,serviceAccounts.cilium.name=cilium,serviceAccounts.operator.name=cilium-operatorâœ¨ Patching ConfigMap cilium-config to enable Hubble...ğŸš€ Creating ConfigMap for Cilium version 1.11.3...â™»ï¸ Restarted Cilium podsâŒ› Waiting for Cilium to become ready before deploying other Hubble component(s)...âœ… Relay is already deployedâœ¨ Deploying Hubble UI and Hubble UI Backend...âŒ› Waiting for Hubble to be installed...â„¹ï¸ Storing helm values file in kube-system/cilium-cli-helm-values Secretâœ… Hubble was successfully enabled!# å®é™…ä¸Šè¿™æ—¶å€™æˆ‘ä»¬å†æŸ¥çœ‹k8sé›†ç¾¤çš„çŠ¶æ€å¯ä»¥çœ‹åˆ°éƒ¨ç½²äº†ä¸€ä¸ªåä¸ºhubble-uiçš„deployment[root@tiny-cilium-master-188-1 ~]# kubectl get deployment -n kube-system | grep hubblehubble-relay 1/1 1 1 17hhubble-ui 1/1 1 1 17h[root@tiny-cilium-master-188-1 ~]# kubectl get svc -n kube-system | grep hubblehubble-relay ClusterIP 10.188.55.197 &lt;none&gt; 80/TCP 17hhubble-ui ClusterIP 10.188.17.78 &lt;none&gt; 80/TCP 17h# å°†hubble-uiè¿™ä¸ªæœåŠ¡çš„80ç«¯å£æš´éœ²åˆ°å®¿ä¸»æœºä¸Šé¢çš„12000ç«¯å£ä¸Šé¢[root@tiny-cilium-master-188-1 ~]# cilium hubble ui&amp;[2] 5809â„¹ï¸ Opening &quot;http://localhost:12000&quot; in your browser...# å®é™…ä¸Šæ‰§è¡Œçš„æ“ä½œç­‰åŒäºä¸‹é¢è¿™ä¸ªå‘½ä»¤# kubectl port-forward -n kube-system svc/hubble-ui --address 0.0.0.0 --address :: 12000:80 è®¿é—®k8så®¿ä¸»æœºèŠ‚ç‚¹çš„IP+ç«¯å£å°±å¯ä»¥çœ‹åˆ°hubble-uiçš„ç•Œé¢äº† æœ€åæ‰€æœ‰çš„ç›¸å…³æœåŠ¡éƒ½éƒ¨ç½²å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†æ£€æŸ¥ä¸€ä¸‹æ•´ä¸ªciliumçš„çŠ¶æ€ 1234567891011121314151617181920212223[root@tiny-cilium-master-188-1 tiny-cilium]# cilium status /Â¯Â¯\\ /Â¯Â¯\\__/Â¯Â¯\\ Cilium: OK \\__/Â¯Â¯\\__/ Operator: OK /Â¯Â¯\\__/Â¯Â¯\\ Hubble: OK \\__/Â¯Â¯\\__/ ClusterMesh: disabled \\__/Deployment cilium-operator Desired: 1, Ready: 1/1, Available: 1/1Deployment hubble-relay Desired: 1, Ready: 1/1, Available: 1/1Deployment hubble-ui Desired: 1, Ready: 1/1, Available: 1/1DaemonSet cilium Desired: 3, Ready: 3/3, Available: 3/3Containers: cilium Running: 3 cilium-operator Running: 1 hubble-relay Running: 1 hubble-ui Running: 1Cluster Pods: 8/8 managed by CiliumImage versions cilium quay.io/cilium/cilium:v1.11.3@sha256:cb6aac121e348abd61a692c435a90a6e2ad3f25baa9915346be7b333de8a767f: 3 cilium-operator quay.io/cilium/operator-generic:v1.11.3@sha256:5b81db7a32cb7e2d00bb3cf332277ec2b3be239d9e94a8d979915f4e6648c787: 1 hubble-relay quay.io/cilium/hubble-relay:v1.11.3@sha256:7256ec111259a79b4f0e0f80ba4256ea23bd472e1fc3f0865975c2ed113ccb97: 1 hubble-ui quay.io/cilium/hubble-ui:v0.8.5@sha256:4eaca1ec1741043cfba6066a165b3bf251590cf4ac66371c4f63fbed2224ebb4: 1 hubble-ui quay.io/cilium/hubble-ui-backend:v0.8.5@sha256:2bce50cf6c32719d072706f7ceccad654bfa907b2745a496da99610776fe31ed: 1 hubble-ui docker.io/envoyproxy/envoy:v1.18.4@sha256:e5c2bb2870d0e59ce917a5100311813b4ede96ce4eb0c6bfa879e3fbe3e83935: 1 6ã€éƒ¨ç½²æµ‹è¯•ç”¨ä¾‹é›†ç¾¤éƒ¨ç½²å®Œæˆä¹‹åæˆ‘ä»¬åœ¨k8sé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªnginxæµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºnginx-quicçš„å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ï¼Œç„¶ååœ¨è¿™ä¸ªå‘½åç©ºé—´å†…åˆ›å»ºä¸€ä¸ªåä¸ºnginx-quic-deploymentçš„deploymentç”¨æ¥éƒ¨ç½²podï¼Œæœ€åå†åˆ›å»ºä¸€ä¸ªserviceç”¨æ¥æš´éœ²æœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨nodeportçš„æ–¹å¼æš´éœ²ç«¯å£æ–¹ä¾¿æµ‹è¯•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[root@tiny-calico-master-88-1 tiny-calico]# cat nginx-quic.yamlapiVersion: v1kind: Namespacemetadata: name: nginx-quic---apiVersion: apps/v1kind: Deploymentmetadata: name: nginx-quic-deployment namespace: nginx-quicspec: selector: matchLabels: app: nginx-quic replicas: 4 template: metadata: labels: app: nginx-quic spec: containers: - name: nginx-quic image: tinychen777/nginx-quic:latest imagePullPolicy: IfNotPresent ports: - containerPort: 80---apiVersion: v1kind: Servicemetadata: name: nginx-quic-service namespace: nginx-quicspec: externalTrafficPolicy: Cluster selector: app: nginx-quic ports: - protocol: TCP port: 8080 # match for service access port targetPort: 80 # match for pod access port nodePort: 30088 # match for external access port type: NodePort éƒ¨ç½²å®Œæˆåæˆ‘ä»¬ç›´æ¥æŸ¥çœ‹çŠ¶æ€ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849# ç›´æ¥éƒ¨ç½²[root@tiny-cilium-master-188-1 tiny-cilium]# kubectl apply -f nginx-quic.yamlnamespace/nginx-quic createddeployment.apps/nginx-quic-deployment createdservice/nginx-quic-service created# æŸ¥çœ‹deploymentçš„è¿è¡ŒçŠ¶æ€[root@tiny-cilium-master-188-1 tiny-cilium]# kubectl get deployment -o wide -n nginx-quicNAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTORnginx-quic-deployment 4/4 4 4 17h nginx-quic tinychen777/nginx-quic:latest app=nginx-quic# æŸ¥çœ‹serviceçš„è¿è¡ŒçŠ¶æ€[root@tiny-cilium-master-188-1 tiny-cilium]# kubectl get service -o wide -n nginx-quicNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORnginx-quic-service NodePort 10.188.0.200 &lt;none&gt; 8080:30088/TCP 17h app=nginx-quic# æŸ¥çœ‹podçš„è¿è¡ŒçŠ¶æ€[root@tiny-cilium-master-188-1 tiny-cilium]# kubectl get pods -o wide -n nginx-quicNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESnginx-quic-deployment-696d959797-26dzh 1/1 Running 1 (17h ago) 17h 10.0.2.58 tiny-cilium-worker-188-12.k8s.tcinternal &lt;none&gt; &lt;none&gt;nginx-quic-deployment-696d959797-kw6bn 1/1 Running 1 (17h ago) 17h 10.0.2.207 tiny-cilium-worker-188-12.k8s.tcinternal &lt;none&gt; &lt;none&gt;nginx-quic-deployment-696d959797-mdw99 1/1 Running 1 (17h ago) 17h 10.0.1.247 tiny-cilium-worker-188-11.k8s.tcinternal &lt;none&gt; &lt;none&gt;nginx-quic-deployment-696d959797-x42zn 1/1 Running 1 (17h ago) 17h 10.0.1.60 tiny-cilium-worker-188-11.k8s.tcinternal &lt;none&gt; &lt;none&gt;# æŸ¥çœ‹IPVSè§„åˆ™[root@tiny-cilium-master-188-1 tiny-cilium]# ipvsadm -lnIP Virtual Server version 1.2.1 (size=4096)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 172.17.0.1:30088 rr -&gt; 10.0.1.60:80 Masq 1 0 0 -&gt; 10.0.1.247:80 Masq 1 0 0 -&gt; 10.0.2.58:80 Masq 1 0 0 -&gt; 10.0.2.207:80 Masq 1 0 0TCP 10.0.0.226:30088 rr -&gt; 10.0.1.60:80 Masq 1 0 0 -&gt; 10.0.1.247:80 Masq 1 0 0 -&gt; 10.0.2.58:80 Masq 1 0 0 -&gt; 10.0.2.207:80 Masq 1 0 0TCP 10.31.188.1:30088 rr -&gt; 10.0.1.60:80 Masq 1 0 0 -&gt; 10.0.1.247:80 Masq 1 0 0 -&gt; 10.0.2.58:80 Masq 1 0 0 -&gt; 10.0.2.207:80 Masq 1 0 0TCP 10.188.0.200:8080 rr -&gt; 10.0.1.60:80 Masq 1 0 0 -&gt; 10.0.1.247:80 Masq 1 0 0 -&gt; 10.0.2.58:80 Masq 1 0 0 -&gt; 10.0.2.207:80 Masq 1 0 0 æœ€åæˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼Œè¿™ä¸ªnginx-quicçš„é•œåƒé»˜è®¤æƒ…å†µä¸‹ä¼šè¿”å›åœ¨nginxå®¹å™¨ä¸­è·å¾—çš„ç”¨æˆ·è¯·æ±‚çš„IPå’Œç«¯å£ 123456789101112131415161718192021222324252627282930313233# é¦–å…ˆæˆ‘ä»¬åœ¨é›†ç¾¤å†…è¿›è¡Œæµ‹è¯•# ç›´æ¥è®¿é—®pod[root@tiny-cilium-master-188-1 tiny-cilium]# curl 10.0.2.58:8010.0.0.226:52312# ç›´æ¥è®¿é—®serviceçš„ClusterIPï¼Œè¿™æ—¶è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°podä¸­[root@tiny-cilium-master-188-1 tiny-cilium]# curl 10.188.0.200:808010.0.0.226:36228# ç›´æ¥è®¿é—®nodeportï¼Œè¿™æ—¶è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°podä¸­ï¼Œä¸ä¼šç»è¿‡ClusterIP# æ­¤æ—¶å®é™…è¿”å›çš„IPè¦å–å†³äºè¢«è½¬å‘åˆ°çš„åç«¯podæ˜¯å¦åœ¨å½“å‰çš„k8sèŠ‚ç‚¹ä¸Š[root@tiny-cilium-master-188-1 tiny-cilium]# curl 10.31.188.1:3008810.0.0.226:38034[root@tiny-cilium-master-188-1 tiny-cilium]# curl 10.31.188.11:3008810.31.188.11:24371[root@tiny-cilium-master-188-1 tiny-cilium]# curl 10.31.188.12:3008810.31.188.12:56919[root@tiny-cilium-master-188-1 tiny-cilium]# curl 10.31.188.12:3008810.0.2.151:49222# æ¥ç€æˆ‘ä»¬åœ¨é›†ç¾¤å¤–è¿›è¡Œæµ‹è¯•# ç›´æ¥è®¿é—®ä¸‰ä¸ªèŠ‚ç‚¹çš„nodeportï¼Œè¿™æ—¶è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°podä¸­ï¼Œä¸ä¼šç»è¿‡ClusterIP# æ­¤æ—¶å®é™…è¿”å›çš„IPè¦å–å†³äºè¢«è½¬å‘åˆ°çš„åç«¯podæ˜¯å¦åœ¨å½“å‰çš„k8sèŠ‚ç‚¹ä¸Š[tinychen /root]# curl 10.31.188.11:3008810.0.1.47:6318[tinychen /root]# curl 10.31.188.11:3008810.31.188.11:63944[tinychen /root]# curl 10.31.188.12:3008810.31.188.12:53882[tinychen /root]# curl 10.31.188.12:3008810.0.2.151:6366[tinychen /root]# curl 10.31.188.12:3008810.0.2.151:6368[tinychen /root]# curl 10.31.188.12:3008810.31.188.12:48174","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"},{"name":"docker","slug":"docker","permalink":"https://tinychen.com/tags/docker/"},{"name":"cilium","slug":"cilium","permalink":"https://tinychen.com/tags/cilium/"}]},{"title":"k8sç³»åˆ—03-kubeadméƒ¨ç½²calicoç½‘ç»œçš„k8sé›†ç¾¤","slug":"20220508-k8s-03-deploy-k8s-with-calico","date":"2022-05-08T05:00:00.000Z","updated":"2022-05-08T05:00:00.000Z","comments":true,"path":"20220508-k8s-03-deploy-k8s-with-calico/","link":"","permalink":"https://tinychen.com/20220508-k8s-03-deploy-k8s-with-calico/","excerpt":"æœ¬æ–‡ä¸»è¦åœ¨centos7ç³»ç»Ÿä¸ŠåŸºäºdockerå’Œcalicoç»„ä»¶éƒ¨ç½²v1.23.6ç‰ˆæœ¬çš„k8såŸç”Ÿé›†ç¾¤ï¼Œç”±äºé›†ç¾¤ä¸»è¦ç”¨äºè‡ªå·±å¹³æ—¶å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨ï¼ŒåŠ ä¸Šèµ„æºæœ‰é™ï¼Œæš‚ä¸æ¶‰åŠé«˜å¯ç”¨éƒ¨ç½²ã€‚ æ­¤å‰å†™çš„ä¸€äº›å…³äºk8såŸºç¡€çŸ¥è¯†å’Œé›†ç¾¤æ­å»ºçš„ä¸€äº›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ã€‚","text":"æœ¬æ–‡ä¸»è¦åœ¨centos7ç³»ç»Ÿä¸ŠåŸºäºdockerå’Œcalicoç»„ä»¶éƒ¨ç½²v1.23.6ç‰ˆæœ¬çš„k8såŸç”Ÿé›†ç¾¤ï¼Œç”±äºé›†ç¾¤ä¸»è¦ç”¨äºè‡ªå·±å¹³æ—¶å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨ï¼ŒåŠ ä¸Šèµ„æºæœ‰é™ï¼Œæš‚ä¸æ¶‰åŠé«˜å¯ç”¨éƒ¨ç½²ã€‚ æ­¤å‰å†™çš„ä¸€äº›å…³äºk8såŸºç¡€çŸ¥è¯†å’Œé›†ç¾¤æ­å»ºçš„ä¸€äº›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ã€‚ 1ã€å‡†å¤‡å·¥ä½œ1.1 calico-é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯æœºå™¨å‡ä¸º8C8Gçš„è™šæ‹Ÿæœºï¼Œç¡¬ç›˜ä¸º100Gã€‚ IP Hostname 10.31.88.1 tiny-calico-master-88-1.k8s.tcinternal 10.31.88.11 tiny-calico-worker-88-11.k8s.tcinternal 10.31.88.12 tiny-calico-worker-88-12.k8s.tcinternal 10.88.64.0/18 podSubnet 10.88.0.0/18 serviceSubnet 1.2 æ£€æŸ¥macå’Œproduct_uuidåŒä¸€ä¸ªk8sé›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹éœ€è¦ç¡®ä¿macåœ°å€å’Œproduct_uuidå‡å”¯ä¸€ï¼Œå¼€å§‹é›†ç¾¤åˆå§‹åŒ–ä¹‹å‰éœ€è¦æ£€æŸ¥ç›¸å…³ä¿¡æ¯ 123456# æ£€æŸ¥macåœ°å€ip link ifconfig -a# æ£€æŸ¥product_uuidsudo cat /sys/class/dmi/id/product_uuid 1.3 é…ç½®sshå…å¯†ç™»å½•ï¼ˆå¯é€‰ï¼‰å¦‚æœk8sé›†ç¾¤çš„èŠ‚ç‚¹æœ‰å¤šä¸ªç½‘å¡ï¼Œç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹èƒ½é€šè¿‡æ­£ç¡®çš„ç½‘å¡äº’è”è®¿é—® 123456789101112131415161718192021222324252627# åœ¨rootç”¨æˆ·ä¸‹é¢ç”Ÿæˆä¸€ä¸ªå…¬ç”¨çš„keyï¼Œå¹¶é…ç½®å¯ä»¥ä½¿ç”¨è¯¥keyå…å¯†ç™»å½•su rootssh-keygencd /root/.ssh/cat id_rsa.pub &gt;&gt; authorized_keyschmod 600 authorized_keyscat &gt;&gt; ~/.ssh/config &lt;&lt;EOFHost tiny-calico-master-88-1.k8s.tcinternal HostName 10.31.88.1 User root Port 22 IdentityFile ~/.ssh/id_rsaHost tiny-calico-worker-88-11.k8s.tcinternal HostName 10.31.88.11 User root Port 22 IdentityFile ~/.ssh/id_rsaHost tiny-calico-worker-88-12.k8s.tcinternal HostName 10.31.88.12 User root Port 22 IdentityFile ~/.ssh/id_rsaEOF 1.4 ä¿®æ”¹hostsæ–‡ä»¶12345cat &gt;&gt; /etc/hosts &lt;&lt;EOF10.31.88.1 tiny-calico-master-88-1 tiny-calico-master-88-1.k8s.tcinternal10.31.88.11 tiny-calico-worker-88-11 tiny-calico-worker-88-11.k8s.tcinternal10.31.88.12 tiny-calico-worker-88-12 tiny-calico-worker-88-12.k8s.tcinternalEOF 1.5 å…³é—­swapå†…å­˜1234# ä½¿ç”¨å‘½ä»¤ç›´æ¥å…³é—­swapå†…å­˜swapoff -a# ä¿®æ”¹fstabæ–‡ä»¶ç¦æ­¢å¼€æœºè‡ªåŠ¨æŒ‚è½½swapåˆ†åŒºsed -i &#x27;/swap / s/^\\(.*\\)$/#\\1/g&#x27; /etc/fstab 1.6 é…ç½®æ—¶é—´åŒæ­¥è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯é€‰æ‹©ntpæˆ–è€…æ˜¯chronyåŒæ­¥å‡å¯ï¼ŒåŒæ­¥çš„æ—¶é—´æºæœåŠ¡å™¨å¯ä»¥é€‰æ‹©é˜¿é‡Œäº‘çš„ntp1.aliyun.comæˆ–è€…æ˜¯å›½å®¶æ—¶é—´ä¸­å¿ƒçš„ntp.ntsc.ac.cnã€‚ ä½¿ç”¨ntpåŒæ­¥12345678# ä½¿ç”¨yumå®‰è£…ntpdateå·¥å…·yum install ntpdate -y# ä½¿ç”¨å›½å®¶æ—¶é—´ä¸­å¿ƒçš„æºåŒæ­¥æ—¶é—´ntpdate ntp.ntsc.ac.cn# æœ€åæŸ¥çœ‹ä¸€ä¸‹æ—¶é—´hwclock ä½¿ç”¨chronyåŒæ­¥12345678910111213141516171819202122232425262728293031# ä½¿ç”¨yumå®‰è£…chronyyum install chrony -y# è®¾ç½®å¼€æœºå¯åŠ¨å¹¶å¼€å¯chonyå¹¶æŸ¥çœ‹è¿è¡ŒçŠ¶æ€systemctl enable chronyd.servicesystemctl start chronyd.servicesystemctl status chronyd.service# å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ—¶é—´æœåŠ¡å™¨vim /etc/chrony.conf# ä¿®æ”¹å‰[root@localhost ~]# grep server /etc/chrony.conf# Use public servers from the pool.ntp.org project.server 0.centos.pool.ntp.org iburstserver 1.centos.pool.ntp.org iburstserver 2.centos.pool.ntp.org iburstserver 3.centos.pool.ntp.org iburst# ä¿®æ”¹å[root@localhost ~]# grep server /etc/chrony.conf# Use public servers from the pool.ntp.org project.server ntp.ntsc.ac.cn iburst# é‡å¯æœåŠ¡ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆsystemctl restart chronyd.service# æŸ¥çœ‹chronyçš„ntpæœåŠ¡å™¨çŠ¶æ€chronyc sourcestats -vchronyc sources -v 1.7 å…³é—­selinux12345# ä½¿ç”¨å‘½ä»¤ç›´æ¥å…³é—­setenforce 0# ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹/etc/selinux/configæ–‡ä»¶sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=disabled/&#x27; /etc/selinux/config 1.8 é…ç½®é˜²ç«å¢™k8sé›†ç¾¤ä¹‹é—´é€šä¿¡å’ŒæœåŠ¡æš´éœ²éœ€è¦ä½¿ç”¨è¾ƒå¤šç«¯å£ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥ç¦ç”¨é˜²ç«å¢™ 12# centos7ä½¿ç”¨systemctlç¦ç”¨é»˜è®¤çš„firewalldæœåŠ¡systemctl disable firewalld.service 1.9 é…ç½®netfilterå‚æ•°è¿™é‡Œä¸»è¦æ˜¯éœ€è¦é…ç½®å†…æ ¸åŠ è½½br_netfilterå’Œiptablesæ”¾è¡Œipv6å’Œipv4çš„æµé‡ï¼Œç¡®ä¿é›†ç¾¤å†…çš„å®¹å™¨èƒ½å¤Ÿæ­£å¸¸é€šä¿¡ã€‚ 123456789cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.confbr_netfilterEOFcat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.confnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1EOFsudo sysctl --system 1.10 å…³é—­IPV6ï¼ˆå¯é€‰ï¼‰è™½ç„¶æ–°ç‰ˆæœ¬çš„k8så·²ç»æ”¯æŒåŒæ ˆç½‘ç»œï¼Œä½†æ˜¯æœ¬æ¬¡çš„é›†ç¾¤éƒ¨ç½²è¿‡ç¨‹å¹¶ä¸æ¶‰åŠIPv6ç½‘ç»œçš„é€šä¿¡ï¼Œå› æ­¤å…³é—­IPv6ç½‘ç»œæ”¯æŒ 12# ç›´æ¥åœ¨å†…æ ¸ä¸­æ·»åŠ ipv6ç¦ç”¨å‚æ•°grubby --update-kernel=ALL --args=ipv6.disable=1 1.11 é…ç½®IPVSï¼ˆå¯é€‰ï¼‰IPVSæ˜¯ä¸“é—¨è®¾è®¡ç”¨æ¥åº”å¯¹è´Ÿè½½å‡è¡¡åœºæ™¯çš„ç»„ä»¶ï¼Œkube-proxy ä¸­çš„ IPVS å®ç°é€šè¿‡å‡å°‘å¯¹ iptables çš„ä½¿ç”¨æ¥å¢åŠ å¯æ‰©å±•æ€§ã€‚åœ¨ iptables è¾“å…¥é“¾ä¸­ä¸ä½¿ç”¨ PREROUTINGï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªå‡çš„æ¥å£ï¼Œå«åš kube-ipvs0ï¼Œå½“k8sé›†ç¾¤ä¸­çš„è´Ÿè½½å‡è¡¡é…ç½®å˜å¤šçš„æ—¶å€™ï¼ŒIPVSèƒ½å®ç°æ¯”iptablesæ›´é«˜æ•ˆçš„è½¬å‘æ€§èƒ½ã€‚ æ³¨æ„åœ¨4.19ä¹‹åçš„å†…æ ¸ç‰ˆæœ¬ä¸­ä½¿ç”¨nf_conntrackæ¨¡å—æ¥æ›¿æ¢äº†åŸæœ‰çš„nf_conntrack_ipv4æ¨¡å— (Notes: use nf_conntrack instead of nf_conntrack_ipv4 for Linux kernel 4.19 and later) 12345678910111213141516171819202122232425262728293031323334353637# åœ¨ä½¿ç”¨ipvsæ¨¡å¼ä¹‹å‰ç¡®ä¿å®‰è£…äº†ipsetå’Œipvsadmsudo yum install ipset ipvsadm -y# æ‰‹åŠ¨åŠ è½½ipvsç›¸å…³æ¨¡å—modprobe -- ip_vsmodprobe -- ip_vs_rrmodprobe -- ip_vs_wrrmodprobe -- ip_vs_shmodprobe -- nf_conntrack_ipv4# é…ç½®å¼€æœºè‡ªåŠ¨åŠ è½½ipvsç›¸å…³æ¨¡å—cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/ipvs.confip_vsip_vs_rrip_vs_wrrip_vs_shnf_conntrack_ipv4EOFsudo sysctl --system# æœ€å¥½é‡å¯ä¸€éç³»ç»Ÿç¡®å®šæ˜¯å¦ç”Ÿæ•ˆ[root@tiny-calico-master-88-1 ~]# lsmod | grep -e ip_vs -e nf_conntrack_ipv4ip_vs_sh 12688 0ip_vs_wrr 12697 0ip_vs_rr 12600 0ip_vs 145458 6 ip_vs_rr,ip_vs_sh,ip_vs_wrrnf_conntrack_ipv4 15053 2nf_defrag_ipv4 12729 1 nf_conntrack_ipv4nf_conntrack 139264 7 ip_vs,nf_nat,nf_nat_ipv4,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_netlink,nf_conntrack_ipv4libcrc32c 12644 4 xfs,ip_vs,nf_nat,nf_conntrack[root@tiny-calico-master-88-1 ~]# cut -f1 -d &quot; &quot; /proc/modules | grep -e ip_vs -e nf_conntrack_ipv4ip_vs_ship_vs_wrrip_vs_rrip_vsnf_conntrack_ipv4 2ã€å®‰è£…container runtime2.1 å®‰è£…dockerè¯¦ç»†çš„å®˜æ–¹æ–‡æ¡£å¯ä»¥å‚è€ƒè¿™é‡Œï¼Œç”±äºåœ¨åˆšå‘å¸ƒçš„1.24ç‰ˆæœ¬ä¸­ç§»é™¤äº†docker-shimï¼Œå› æ­¤å®‰è£…çš„ç‰ˆæœ¬â‰¥1.24çš„æ—¶å€™éœ€è¦æ³¨æ„å®¹å™¨è¿è¡Œæ—¶çš„é€‰æ‹©ã€‚è¿™é‡Œæˆ‘ä»¬å®‰è£…çš„ç‰ˆæœ¬ä½äº1.24ï¼Œå› æ­¤æˆ‘ä»¬ç»§ç»­ä½¿ç”¨dockerã€‚ dockerçš„å…·ä½“å®‰è£…å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚ 123456# å®‰è£…å¿…è¦çš„ä¾èµ–ç»„ä»¶å¹¶ä¸”å¯¼å…¥dockerå®˜æ–¹æä¾›çš„yumæºsudo yum install -y yum-utils device-mapper-persistent-data lvm2sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo# æˆ‘ä»¬ç›´æ¥å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„dockeryum install docker-ce docker-ce-cli containerd.io 2.2 é…ç½®cgroup driversCentOS7ä½¿ç”¨çš„æ˜¯systemdæ¥åˆå§‹åŒ–ç³»ç»Ÿå¹¶ç®¡ç†è¿›ç¨‹ï¼Œåˆå§‹åŒ–è¿›ç¨‹ä¼šç”Ÿæˆå¹¶ä½¿ç”¨ä¸€ä¸ª root æ§åˆ¶ç»„ (cgroup), å¹¶å……å½“ cgroup ç®¡ç†å™¨ã€‚ Systemd ä¸ cgroup é›†æˆç´§å¯†ï¼Œå¹¶å°†ä¸ºæ¯ä¸ª systemd å•å…ƒåˆ†é…ä¸€ä¸ª cgroupã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½®å®¹å™¨è¿è¡Œæ—¶å’Œ kubelet ä½¿ç”¨ cgroupfsã€‚ è¿åŒ systemd ä¸€èµ·ä½¿ç”¨ cgroupfs æ„å‘³ç€å°†æœ‰ä¸¤ä¸ªä¸åŒçš„ cgroup ç®¡ç†å™¨ã€‚è€Œå½“ä¸€ä¸ªç³»ç»Ÿä¸­åŒæ—¶å­˜åœ¨cgroupfså’Œsystemdä¸¤è€…æ—¶ï¼Œå®¹æ˜“å˜å¾—ä¸ç¨³å®šï¼Œå› æ­¤æœ€å¥½æ›´æ”¹è®¾ç½®ï¼Œä»¤å®¹å™¨è¿è¡Œæ—¶å’Œ kubelet ä½¿ç”¨ systemd ä½œä¸º cgroup é©±åŠ¨ï¼Œä»¥æ­¤ä½¿ç³»ç»Ÿæ›´ä¸ºç¨³å®šã€‚ å¯¹äº Docker, éœ€è¦è®¾ç½® native.cgroupdriver=systemd å‚æ•°ã€‚ å‚è€ƒå®˜æ–¹çš„è¯´æ˜æ–‡æ¡£ï¼š https://kubernetes.io/docs/setup/production-environment/container-runtimes/#cgroup-drivers å‚è€ƒé…ç½®è¯´æ˜æ–‡æ¡£ https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker 1234567891011121314151617181920sudo mkdir /etc/dockercat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json&#123; &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;], &quot;log-driver&quot;: &quot;json-file&quot;, &quot;log-opts&quot;: &#123; &quot;max-size&quot;: &quot;100m&quot; &#125;, &quot;storage-driver&quot;: &quot;overlay2&quot;&#125;EOFsudo systemctl enable dockersudo systemctl daemon-reloadsudo systemctl restart docker# æœ€åæ£€æŸ¥ä¸€ä¸‹Cgroup Driveræ˜¯å¦ä¸ºsystemd[root@tiny-calico-master-88-1 ~]# docker info | grep systemd Cgroup Driver: systemd 2.3 å…³äºkubeletçš„cgroup driverk8så®˜æ–¹æœ‰è¯¦ç»†çš„æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•è®¾ç½®kubeletçš„cgroup driverï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œåœ¨1.22ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨è®¾ç½®kubeletçš„cgroup driverï¼Œé‚£ä¹ˆé»˜è®¤ä¼šè®¾ç½®ä¸ºsystemd Note: In v1.22, if the user is not setting the cgroupDriver field under KubeletConfiguration, kubeadm will default it to systemd. ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æŒ‡å®škubeletçš„cgroup driverçš„æ–¹æ³•å°±æ˜¯åœ¨kubeadm-config.yamlåŠ å…¥cgroupDriverå­—æ®µ 12345678# kubeadm-config.yamlkind: ClusterConfigurationapiVersion: kubeadm.k8s.io/v1beta3kubernetesVersion: v1.21.0---kind: KubeletConfigurationapiVersion: kubelet.config.k8s.io/v1beta1cgroupDriver: systemd æˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥çœ‹configmapsæ¥æŸ¥çœ‹åˆå§‹åŒ–ä¹‹åé›†ç¾¤çš„kubeadm-configé…ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435[root@tiny-calico-master-88-1 tiny-calico]# kubectl describe configmaps kubeadm-config -n kube-systemName: kubeadm-configNamespace: kube-systemLabels: &lt;none&gt;Annotations: &lt;none&gt;Data====ClusterConfiguration:----apiServer: extraArgs: authorization-mode: Node,RBAC timeoutForControlPlane: 4m0sapiVersion: kubeadm.k8s.io/v1beta3certificatesDir: /etc/kubernetes/pkiclusterName: kubernetescontrollerManager: &#123;&#125;dns: &#123;&#125;etcd: local: dataDir: /var/lib/etcdimageRepository: registry.aliyuncs.com/google_containerskind: ClusterConfigurationkubernetesVersion: v1.23.6networking: dnsDomain: cali-cluster.tclocal serviceSubnet: 10.88.0.0/18scheduler: &#123;&#125;BinaryData====Events: &lt;none&gt; å½“ç„¶å› ä¸ºæˆ‘ä»¬éœ€è¦å®‰è£…çš„ç‰ˆæœ¬é«˜äº1.22.0å¹¶ä¸”ä½¿ç”¨çš„å°±æ˜¯systemdï¼Œå› æ­¤å¯ä»¥ä¸ç”¨å†é‡å¤é…ç½®ã€‚ 3ã€å®‰è£…kubeä¸‰ä»¶å¥— å¯¹åº”çš„å®˜æ–¹æ–‡æ¡£å¯ä»¥å‚è€ƒè¿™é‡Œ https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl kubeä¸‰ä»¶å¥—å°±æ˜¯kubeadmã€kubelet å’Œ kubectlï¼Œä¸‰è€…çš„å…·ä½“åŠŸèƒ½å’Œä½œç”¨å¦‚ä¸‹ï¼š kubeadmï¼šç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤ã€‚ kubeletï¼šåœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ Pod å’Œå®¹å™¨ç­‰ã€‚ kubectlï¼šç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š kubeadmä¸ä¼šå¸®åŠ©æˆ‘ä»¬ç®¡ç†kubeletå’Œkubectlï¼Œå…¶ä»–ä¸¤è€…ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸‰è€…æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå¹¶ä¸å­˜åœ¨è°ç®¡ç†è°çš„æƒ…å†µï¼› kubeletçš„ç‰ˆæœ¬å¿…é¡»å°äºç­‰äºAPI-serverçš„ç‰ˆæœ¬ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°å…¼å®¹æ€§çš„é—®é¢˜ï¼› kubectlå¹¶ä¸æ˜¯é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦å®‰è£…ï¼Œä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šè¦å®‰è£…åœ¨é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼Œå¯ä»¥å•ç‹¬å®‰è£…åœ¨è‡ªå·±æœ¬åœ°çš„æœºå™¨ç¯å¢ƒä¸Šé¢ï¼Œç„¶åé…åˆkubeconfigæ–‡ä»¶å³å¯ä½¿ç”¨kubectlå‘½ä»¤æ¥è¿œç¨‹ç®¡ç†å¯¹åº”çš„k8sé›†ç¾¤ï¼› CentOS7çš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„yumæºå³å¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œéœ€è¦è®¾ç½®selinuxçš„çŠ¶æ€ï¼Œä½†æ˜¯å‰é¢æˆ‘ä»¬å·²ç»å…³é—­äº†selinuxï¼Œå› æ­¤è¿™é‡Œç•¥è¿‡è¿™æ­¥ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041# ç›´æ¥å¯¼å…¥è°·æ­Œå®˜æ–¹çš„yumæºcat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearchenabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpgexclude=kubelet kubeadm kubectlEOF# å½“ç„¶å¦‚æœè¿ä¸ä¸Šè°·æ­Œçš„æºï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å›½å†…çš„é˜¿é‡Œé•œåƒæºcat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/enabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpgEOF# æ¥ä¸‹æ¥ç›´æ¥å®‰è£…ä¸‰ä»¶å¥—å³å¯sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes# å¦‚æœç½‘ç»œç¯å¢ƒä¸å¥½å‡ºç°gpgcheckéªŒè¯å¤±è´¥å¯¼è‡´æ— æ³•æ­£å¸¸è¯»å–yumæºï¼Œå¯ä»¥è€ƒè™‘å…³é—­è¯¥yumæºçš„repo_gpgchecksed -i &#x27;s/repo_gpgcheck=1/repo_gpgcheck=0/g&#x27; /etc/yum.repos.d/kubernetes.repo# æˆ–è€…åœ¨å®‰è£…çš„æ—¶å€™ç¦ç”¨gpgchecksudo yum install -y kubelet kubeadm kubectl --nogpgcheck --disableexcludes=kubernetes# å¦‚æœæƒ³è¦å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹ç›¸å…³ç‰ˆæœ¬çš„ä¿¡æ¯sudo yum list --nogpgcheck kubelet kubeadm kubectl --showduplicates --disableexcludes=kubernetes# è¿™é‡Œæˆ‘ä»¬ä¸ºäº†ä¿ç•™ä½¿ç”¨docker-shimï¼Œå› æ­¤æˆ‘ä»¬æŒ‰ç…§1.24.0ç‰ˆæœ¬çš„å‰ä¸€ä¸ªç‰ˆæœ¬1.23.6sudo yum install -y kubelet-1.23.6-0 kubeadm-1.23.6-0 kubectl-1.23.6-0 --nogpgcheck --disableexcludes=kubernetes# å®‰è£…å®Œæˆåé…ç½®å¼€æœºè‡ªå¯kubeletsudo systemctl enable --now kubelet 4ã€åˆå§‹åŒ–é›†ç¾¤4.1 ç¼–å†™é…ç½®æ–‡ä»¶åœ¨é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œå®Œä¸Šé¢çš„ä¸‰ç‚¹æ“ä½œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹åˆ›å»ºk8sé›†ç¾¤äº†ã€‚å› ä¸ºæˆ‘ä»¬è¿™æ¬¡ä¸æ¶‰åŠé«˜å¯ç”¨éƒ¨ç½²ï¼Œå› æ­¤åˆå§‹åŒ–çš„æ—¶å€™ç›´æ¥åœ¨æˆ‘ä»¬çš„ç›®æ ‡masterèŠ‚ç‚¹ä¸Šé¢æ“ä½œå³å¯ã€‚ 123456789101112131415# æˆ‘ä»¬å…ˆä½¿ç”¨kubeadmå‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ä¸»è¦çš„å‡ ä¸ªé•œåƒç‰ˆæœ¬# å› ä¸ºæˆ‘ä»¬æ­¤å‰æŒ‡å®šå®‰è£…äº†æ—§çš„1.23.6ç‰ˆæœ¬ï¼Œè¿™é‡Œçš„apiserveré•œåƒç‰ˆæœ¬ä¹Ÿä¼šéšä¹‹å›æ»š[root@tiny-calico-master-88-1 ~]# kubeadm config images listI0506 11:24:17.061315 16055 version.go:255] remote version is much newer: v1.24.0; falling back to: stable-1.23k8s.gcr.io/kube-apiserver:v1.23.6k8s.gcr.io/kube-controller-manager:v1.23.6k8s.gcr.io/kube-scheduler:v1.23.6k8s.gcr.io/kube-proxy:v1.23.6k8s.gcr.io/pause:3.6k8s.gcr.io/etcd:3.5.1-0k8s.gcr.io/coredns/coredns:v1.8.6# ä¸ºäº†æ–¹ä¾¿ç¼–è¾‘å’Œç®¡ç†ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŠŠåˆå§‹åŒ–å‚æ•°å¯¼å‡ºæˆé…ç½®æ–‡ä»¶[root@tiny-calico-master-88-1 ~]# kubeadm config print init-defaults &gt; kubeadm-calico.conf è€ƒè™‘åˆ°å¤§å¤šæ•°æƒ…å†µä¸‹å›½å†…çš„ç½‘ç»œæ— æ³•ä½¿ç”¨è°·æ­Œçš„k8s.gcr.ioé•œåƒæºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹imageRepositoryå‚æ•°ä¸ºé˜¿é‡Œçš„é•œåƒæº kubernetesVersionå­—æ®µç”¨æ¥æŒ‡å®šæˆ‘ä»¬è¦å®‰è£…çš„k8sç‰ˆæœ¬ localAPIEndpointå‚æ•°éœ€è¦ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„masterèŠ‚ç‚¹çš„IPå’Œç«¯å£ï¼Œåˆå§‹åŒ–ä¹‹åçš„k8sé›†ç¾¤çš„apiserveråœ°å€å°±æ˜¯è¿™ä¸ª serviceSubnetå’ŒdnsDomainä¸¤ä¸ªå‚æ•°é»˜è®¤æƒ…å†µä¸‹å¯ä»¥ä¸ç”¨ä¿®æ”¹ï¼Œè¿™é‡Œæˆ‘æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚è¿›è¡Œäº†å˜æ›´ nodeRegistrationé‡Œé¢çš„nameå‚æ•°ä¿®æ”¹ä¸ºå¯¹åº”masterèŠ‚ç‚¹çš„hostname æ–°å¢é…ç½®å—ä½¿ç”¨ipvsï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ 12345678910111213141516171819202122232425262728293031323334353637383940apiVersion: kubeadm.k8s.io/v1beta3bootstrapTokens:- groups: - system:bootstrappers:kubeadm:default-node-token token: abcdef.0123456789abcdef ttl: 24h0m0s usages: - signing - authenticationkind: InitConfigurationlocalAPIEndpoint: advertiseAddress: 10.31.88.1 bindPort: 6443nodeRegistration: criSocket: /var/run/dockershim.sock imagePullPolicy: IfNotPresent name: tiny-calico-master-88-1.k8s.tcinternal taints: null---apiServer: timeoutForControlPlane: 4m0sapiVersion: kubeadm.k8s.io/v1beta3certificatesDir: /etc/kubernetes/pkiclusterName: kubernetescontrollerManager: &#123;&#125;dns: &#123;&#125;etcd: local: dataDir: /var/lib/etcdimageRepository: registry.aliyuncs.com/google_containerskind: ClusterConfigurationkubernetesVersion: 1.23.6networking: dnsDomain: cali-cluster.tclocal serviceSubnet: 10.88.0.0/18scheduler: &#123;&#125;---apiVersion: kubeproxy.config.k8s.io/v1alpha1kind: KubeProxyConfigurationmode: ipvs 4.2 åˆå§‹åŒ–é›†ç¾¤æ­¤æ—¶æˆ‘ä»¬å†æŸ¥çœ‹å¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­çš„é•œåƒç‰ˆæœ¬ï¼Œå°±ä¼šå‘ç°å·²ç»å˜æˆäº†å¯¹åº”é˜¿é‡Œäº‘é•œåƒæºçš„ç‰ˆæœ¬ 12345678910111213141516171819202122232425262728# æŸ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„é•œåƒç‰ˆæœ¬ï¼Œç¡®å®šé…ç½®æ–‡ä»¶æ˜¯å¦ç”Ÿæ•ˆ[root@tiny-calico-master-88-1 ~]# kubeadm config images list --config kubeadm-calico.confregistry.aliyuncs.com/google_containers/kube-apiserver:v1.23.6registry.aliyuncs.com/google_containers/kube-controller-manager:v1.23.6registry.aliyuncs.com/google_containers/kube-scheduler:v1.23.6registry.aliyuncs.com/google_containers/kube-proxy:v1.23.6registry.aliyuncs.com/google_containers/pause:3.6registry.aliyuncs.com/google_containers/etcd:3.5.1-0registry.aliyuncs.com/google_containers/coredns:v1.8.6# ç¡®è®¤æ²¡é—®é¢˜ä¹‹åæˆ‘ä»¬ç›´æ¥æ‹‰å–é•œåƒ[root@tiny-calico-master-88-1 ~]# kubeadm config images pull --config kubeadm-calico.conf[config/images] Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/pause:3.6[config/images] Pulled registry.aliyuncs.com/google_containers/etcd:3.5.1-0[config/images] Pulled registry.aliyuncs.com/google_containers/coredns:v1.8.6# åˆå§‹åŒ–[root@tiny-calico-master-88-1 ~]# kubeadm init --config kubeadm-calico.conf[init] Using Kubernetes version: v1.23.6[preflight] Running pre-flight checks[preflight] Pulling images required for setting up a Kubernetes cluster[preflight] This might take a minute or two, depending on the speed of your internet connection[preflight] You can also perform this action in beforehand using &#x27;kubeadm config images pull&#x27;...æ­¤å¤„ç•¥å»ä¸€å †è¾“å‡º... å½“æˆ‘ä»¬çœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡ºç»“æœçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„é›†ç¾¤å°±ç®—æ˜¯åˆå§‹åŒ–æˆåŠŸäº†ã€‚ 123456789101112131415161718192021Your Kubernetes control-plane has initialized successfully!To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/configAlternatively, if you are the root user, you can run: export KUBECONFIG=/etc/kubernetes/admin.confYou should now deploy a pod network to the cluster.Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/Then you can join any number of worker nodes by running the following on each as root:kubeadm join 10.31.88.1:6443 --token abcdef.0123456789abcdef \\ --discovery-token-ca-cert-hash sha256:a4189d36d164a865be540d48fcd10ff13e2f90ed6e901201b6ea2baf96dae0ae 4.3 é…ç½®kubeconfigåˆšåˆå§‹åŒ–æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬è¿˜æ²¡åŠæ³•é©¬ä¸ŠæŸ¥çœ‹k8sé›†ç¾¤ä¿¡æ¯ï¼Œéœ€è¦é…ç½®kubeconfigç›¸å…³å‚æ•°æ‰èƒ½æ­£å¸¸ä½¿ç”¨kubectlè¿æ¥apiserverè¯»å–é›†ç¾¤ä¿¡æ¯ã€‚ 12345678910# å¯¹äºérootç”¨æˆ·ï¼Œå¯ä»¥è¿™æ ·æ“ä½œmkdir -p $HOME/.kubesudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configsudo chown $(id -u):$(id -g) $HOME/.kube/config# å¦‚æœæ˜¯rootç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥å¯¼å…¥ç¯å¢ƒå˜é‡export KUBECONFIG=/etc/kubernetes/admin.conf# æ·»åŠ kubectlçš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc å‰é¢æˆ‘ä»¬æåˆ°è¿‡kubectlä¸ä¸€å®šè¦å®‰è£…åœ¨é›†ç¾¤å†…ï¼Œå®é™…ä¸Šåªè¦æ˜¯ä»»ä½•ä¸€å°èƒ½è¿æ¥åˆ°apiserverçš„æœºå™¨ä¸Šé¢éƒ½å¯ä»¥å®‰è£…kubectlå¹¶ä¸”æ ¹æ®æ­¥éª¤é…ç½®kubeconfigï¼Œå°±å¯ä»¥ä½¿ç”¨kubectlå‘½ä»¤è¡Œæ¥ç®¡ç†å¯¹åº”çš„k8sé›†ç¾¤ã€‚ é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å†æ‰§è¡Œç›¸å…³å‘½ä»¤å°±å¯ä»¥æŸ¥çœ‹é›†ç¾¤çš„ä¿¡æ¯äº†ã€‚ 12345678910111213141516171819[root@tiny-calico-master-88-1 ~]# kubectl cluster-infoKubernetes control plane is running at https://10.31.88.1:6443CoreDNS is running at https://10.31.88.1:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxyTo further debug and diagnose cluster problems, use &#x27;kubectl cluster-info dump&#x27;[root@tiny-calico-master-88-1 ~]# kubectl get nodes -o wideNAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIMEtiny-calico-master-88-1.k8s.tcinternal NotReady control-plane,master 4m15s v1.23.6 10.31.88.1 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-1160.62.1.el7.x86_64 docker://20.10.14[root@tiny-calico-master-88-1 ~]# kubectl get pods -A -o wideNAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESkube-system coredns-6d8c4cb4d-r8r9q 0/1 Pending 0 4m20s &lt;none&gt; &lt;none&gt; &lt;none&gt; &lt;none&gt;kube-system coredns-6d8c4cb4d-ztq6w 0/1 Pending 0 4m20s &lt;none&gt; &lt;none&gt; &lt;none&gt; &lt;none&gt;kube-system etcd-tiny-calico-master-88-1.k8s.tcinternal 1/1 Running 0 4m25s 10.31.88.1 tiny-calico-master-88-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-apiserver-tiny-calico-master-88-1.k8s.tcinternal 1/1 Running 0 4m26s 10.31.88.1 tiny-calico-master-88-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-controller-manager-tiny-calico-master-88-1.k8s.tcinternal 1/1 Running 0 4m27s 10.31.88.1 tiny-calico-master-88-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-proxy-v6cg9 1/1 Running 0 4m20s 10.31.88.1 tiny-calico-master-88-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-scheduler-tiny-calico-master-88-1.k8s.tcinternal 1/1 Running 0 4m25s 10.31.88.1 tiny-calico-master-88-1.k8s.tcinternal &lt;none&gt; &lt;none&gt; 4.4 æ·»åŠ workerèŠ‚ç‚¹è¿™æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­æ·»åŠ å‰©ä¸‹çš„ä¸¤ä¸ªèŠ‚ç‚¹ä½œä¸ºworkerèŠ‚ç‚¹è¿è¡Œè´Ÿè½½ï¼Œç›´æ¥åœ¨å‰©ä¸‹çš„èŠ‚ç‚¹ä¸Šé¢è¿è¡Œé›†ç¾¤åˆå§‹åŒ–æˆåŠŸæ—¶è¾“å‡ºçš„å‘½ä»¤å°±å¯ä»¥æˆåŠŸåŠ å…¥é›†ç¾¤ï¼š 123456789101112131415[root@tiny-calico-worker-88-11 ~]# kubeadm join 10.31.88.1:6443 --token abcdef.0123456789abcdef \\&gt; --discovery-token-ca-cert-hash sha256:a4189d36d164a865be540d48fcd10ff13e2f90ed6e901201b6ea2baf96dae0ae[preflight] Running pre-flight checks[preflight] Reading configuration from the cluster...[preflight] FYI: You can look at this config file with &#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;[kubelet-start] Starting the kubelet[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...This node has joined the cluster:* Certificate signing request was sent to apiserver and a response was received.* The Kubelet was informed of the new secure connection details.Run &#x27;kubectl get nodes&#x27; on the control-plane to see this node join the cluster. å¦‚æœä¸å°å¿ƒæ²¡ä¿å­˜åˆå§‹åŒ–æˆåŠŸçš„è¾“å‡ºä¿¡æ¯ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨kubectlå·¥å…·æŸ¥çœ‹æˆ–è€…ç”Ÿæˆtoken 12345678910111213141516# æŸ¥çœ‹ç°æœ‰çš„tokenåˆ—è¡¨[root@tiny-calico-master-88-1 ~]# kubeadm token listTOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPSabcdef.0123456789abcdef 23h 2022-05-07T05:19:08Z authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-token# å¦‚æœtokenå·²ç»å¤±æ•ˆï¼Œé‚£å°±å†åˆ›å»ºä¸€ä¸ªæ–°çš„token[root@tiny-calico-master-88-1 ~]# kubeadm token createe31cv1.lbtrzwp6mzon78ue[root@tiny-calico-master-88-1 ~]# kubeadm token listTOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPSabcdef.0123456789abcdef 23h 2022-05-07T05:19:08Z authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-tokene31cv1.lbtrzwp6mzon78ue 23h 2022-05-07T05:51:40Z authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-token# å¦‚æœæ‰¾ä¸åˆ°--discovery-token-ca-cert-hashå‚æ•°ï¼Œåˆ™å¯ä»¥åœ¨masterèŠ‚ç‚¹ä¸Šä½¿ç”¨opensslå·¥å…·æ¥è·å–[root@tiny-calico-master-88-1 ~]# openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#x27;s/^.* //&#x27;a4189d36d164a865be540d48fcd10ff13e2f90ed6e901201b6ea2baf96dae0ae æ·»åŠ å®Œæˆä¹‹åæˆ‘ä»¬å†æŸ¥çœ‹é›†ç¾¤çš„èŠ‚ç‚¹å¯ä»¥å‘ç°è¿™æ—¶å€™å·²ç»å¤šäº†ä¸¤ä¸ªnodeï¼Œä½†æ˜¯æ­¤æ—¶èŠ‚ç‚¹çš„çŠ¶æ€è¿˜æ˜¯NotReadyï¼Œæ¥ä¸‹æ¥å°±éœ€è¦éƒ¨ç½²CNIäº†ã€‚ 12345[root@tiny-calico-master-88-1 ~]# kubectl get nodesNAME STATUS ROLES AGE VERSIONtiny-calico-master-88-1.k8s.tcinternal NotReady control-plane,master 20m v1.23.6tiny-calico-worker-88-11.k8s.tcinternal NotReady &lt;none&gt; 105s v1.23.6tiny-calico-worker-88-12.k8s.tcinternal NotReady &lt;none&gt; 35s v1.23.6 5ã€å®‰è£…CNI5.1 ç¼–å†™manifestæ–‡ä»¶calicoçš„å®‰è£…ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå®˜æ–¹æä¾›äº†å¤šç§å®‰è£…æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨yamlï¼ˆè‡ªå®šä¹‰manifestsï¼‰è¿›è¡Œå®‰è£…ï¼Œå¹¶ä¸”ä½¿ç”¨etcdä½œä¸ºdatastoreã€‚ 12# æˆ‘ä»¬å…ˆæŠŠå®˜æ–¹çš„yamlæ¨¡æ¿ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åå¯¹å…³é”®å­—æ®µé€ä¸ªä¿®æ”¹curl https://projectcalico.docs.tigera.io/manifests/calico-etcd.yaml -O é’ˆå¯¹calico-etcd.yamlæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€äº›å‚æ•°ä»¥é€‚é…æˆ‘ä»¬çš„é›†ç¾¤ï¼š CALICO_IPV4POOL_CIDRå‚æ•°ï¼Œé…ç½®çš„æ˜¯podçš„ç½‘æ®µï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ­¤å‰è®¡åˆ’å¥½çš„10.88.64.0/18ï¼›CALICO_IPV4POOL_BLOCK_SIZEå‚æ•°ï¼Œé…ç½®çš„æ˜¯åˆ†é…å­ç½‘çš„å¤§å°ï¼Œé»˜è®¤æ˜¯26 1234567# The default IPv4 pool to create on startup if none exists. Pod IPs will be# chosen from this range. Changing this value after installation will have# no effect. This should fall within `--cluster-cidr`.- name: CALICO_IPV4POOL_CIDR value: &quot;10.88.64.0/18&quot;- name: CALICO_IPV4POOL_BLOCK_SIZE value: &quot;26&quot; CALICO_IPV4POOL_IPIPå‚æ•°ï¼Œæ§åˆ¶æ˜¯å¦å¯ç”¨ip-ipæ¨¡å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯Alwaysï¼Œç”±äºæˆ‘ä»¬çš„èŠ‚ç‚¹éƒ½åœ¨åŒä¸€ä¸ªäºŒå±‚ç½‘ç»œï¼Œè¿™é‡Œä¿®æ”¹ä¸ºNeveræˆ–è€…æ˜¯CrossSubnetéƒ½å¯ä»¥ã€‚ å…¶ä¸­Neverè¡¨ç¤ºä¸å¯ç”¨ip-ipæ¨¡å¼ï¼Œè€ŒCrossSubnetåˆ™è¡¨ç¤ºä»…å½“è·¨å­ç½‘çš„æ—¶å€™æ‰å¯ç”¨ip-ipæ¨¡å¼ 123# Enable IPIP- name: CALICO_IPV4POOL_IPIP value: &quot;Never&quot; ConfigMapé‡Œé¢çš„etcd_endpointså˜é‡é…ç½®etcdçš„è¿æ¥ç«¯å£å’Œåœ°å€ï¼Œä¸ºäº†å®‰å…¨æˆ‘ä»¬è¿™é‡Œå¼€å¯TLSè®¤è¯ï¼Œå½“ç„¶å¦‚æœä¸æƒ³é…ç½®è¯ä¹¦çš„ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨TLSï¼Œç„¶åè¿™ä¸‰ä¸ªå­—æ®µç›´æ¥ç•™ç©ºä¸åšä¿®æ”¹ 1234567891011121314151617kind: ConfigMapapiVersion: v1metadata: name: calico-config namespace: kube-systemdata: # Configure this with the location of your etcd cluster. # etcd_endpoints: &quot;http://&lt;ETCD_IP&gt;:&lt;ETCD_PORT&gt;&quot; # If you&#x27;re using TLS enabled etcd uncomment the following. # You must also populate the Secret below with these files. # etcd_ca: &quot;&quot; # &quot;/calico-secrets/etcd-ca&quot; # etcd_cert: &quot;&quot; # &quot;/calico-secrets/etcd-cert&quot; # etcd_key: &quot;&quot; # &quot;/calico-secrets/etcd-key&quot; etcd_endpoints: &quot;https://10.31.88.1:2379&quot; etcd_ca: &quot;/etc/kubernetes/pki/etcd/ca.crt&quot; etcd_cert: &quot;/etc/kubernetes/pki/etcd/server.crt&quot; etcd_key: &quot;/etc/kubernetes/pki/etcd/server.key&quot; Secreté‡Œé¢çš„ name: calico-etcd-secretsä¸‹é¢çš„dataå­—æ®µï¼Œéœ€è¦æŠŠä¸Šé¢çš„ä¸‰ä¸ªè¯ä¹¦å†…å®¹ä½¿ç”¨è¯¥å‘½ä»¤cat &lt;file&gt; | base64 -w 0è½¬æˆbase64ç¼–ç æ ¼å¼ 12345678910111213141516171819---# Source: calico/templates/calico-etcd-secrets.yaml# The following contains k8s Secrets for use with a TLS enabled etcd cluster.# For information on populating Secrets, see http://kubernetes.io/docs/user-guide/secrets/apiVersion: v1kind: Secrettype: Opaquemetadata: name: calico-etcd-secrets namespace: kube-systemdata: # Populate the following with etcd TLS configuration if desired, but leave blank if # not using TLS for etcd. # The keys below should be uncommented and the values populated with the base64 # encoded contents of each file that would be associated with the TLS data. # Example command for encoding a file contents: cat &lt;file&gt; | base64 -w 0 etcd-key: LS0tLS1CRUdJTi......tLS0tCg== etcd-cert: LS0tLS1CRUdJT......tLS0tLQo= etcd-ca: LS0tLS1CRUdJTiB......FLS0tLS0K 5.2 éƒ¨ç½²calicoä¿®æ”¹å®Œæˆä¹‹åæˆ‘ä»¬ç›´æ¥éƒ¨ç½²å³å¯ 123456789101112131415161718192021222324252627282930313233[root@tiny-calico-master-88-1 ~]# kubectl apply -f calico-etcd.yamlsecret/calico-etcd-secrets createdconfigmap/calico-config createdclusterrole.rbac.authorization.k8s.io/calico-kube-controllers createdclusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers createdclusterrole.rbac.authorization.k8s.io/calico-node createdclusterrolebinding.rbac.authorization.k8s.io/calico-node createddaemonset.apps/calico-node createdserviceaccount/calico-node createddeployment.apps/calico-kube-controllers createdserviceaccount/calico-kube-controllers createdWarning: policy/v1beta1 PodDisruptionBudget is deprecated in v1.21+, unavailable in v1.25+; use policy/v1 PodDisruptionBudgetpoddisruptionbudget.policy/calico-kube-controllers created# æŸ¥çœ‹podæ˜¯å¦æ­£å¸¸è¿è¡Œ[root@tiny-calico-master-88-1 ~]# kubectl get pods -ANAMESPACE NAME READY STATUS RESTARTS AGEkube-system calico-kube-controllers-5c4bd49f9b-6b2gr 1/1 Running 5 (3m18s ago) 6m18skube-system calico-node-bgsfs 1/1 Running 5 (2m55s ago) 6m18skube-system calico-node-tr88g 1/1 Running 5 (3m19s ago) 6m18skube-system calico-node-w59pc 1/1 Running 5 (2m36s ago) 6m18skube-system coredns-6d8c4cb4d-r8r9q 1/1 Running 0 3h8mkube-system coredns-6d8c4cb4d-ztq6w 1/1 Running 0 3h8mkube-system etcd-tiny-calico-master-88-1.k8s.tcinternal 1/1 Running 0 3h8mkube-system kube-apiserver-tiny-calico-master-88-1.k8s.tcinternal 1/1 Running 0 3h8mkube-system kube-controller-manager-tiny-calico-master-88-1.k8s.tcinternal 1/1 Running 0 3h8mkube-system kube-proxy-n65sb 1/1 Running 0 169mkube-system kube-proxy-qmxhp 1/1 Running 0 168mkube-system kube-proxy-v6cg9 1/1 Running 0 3h8mkube-system kube-scheduler-tiny-calico-master-88-1.k8s.tcinternal 1/1 Running 0 3h8m# æŸ¥çœ‹calico-kube-controllersçš„podæ—¥å¿—æ˜¯å¦æœ‰æŠ¥é”™[root@tiny-calico-master-88-1 ~]# kubectl logs -f calico-kube-controllers-5c4bd49f9b-6b2gr -n kube-system 5.3 podå®‰è£…calicoctlcalicoctlæ˜¯ç”¨æ¥æŸ¥çœ‹ç®¡ç†calicoçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®šä½ä¸Šæœ‰ç‚¹ç±»ä¼¼äºcalicoç‰ˆæœ¬çš„kubectlï¼Œå› ä¸ºæˆ‘ä»¬å‰é¢ä½¿ç”¨äº†etcdä½œä¸ºcalicoçš„datastoreï¼Œè¿™é‡Œç›´æ¥é€‰æ‹©åœ¨k8sé›†ç¾¤ä¸­ä»¥podçš„å½¢å¼éƒ¨ç½²calicoctlçš„æ–¹å¼æ›´åŠ ç®€å•ã€‚ calicoctlçš„ç‰ˆæœ¬æœ€å¥½å’Œéƒ¨ç½²çš„calicoä¸€è‡´ï¼Œè¿™é‡Œå‡ä¸ºv3.22.2 calicoctlçš„etcdé…ç½®æœ€å¥½å’Œéƒ¨ç½²çš„calicoä¸€è‡´ï¼Œå› ä¸ºå‰é¢éƒ¨ç½²calicoçš„æ—¶å€™etcdå¼€å¯äº†TLSï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬ä¹Ÿè¦ä¿®æ”¹yamlæ–‡ä»¶å¼€å¯TLS 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859# ä¸ºäº†æ–¹ä¾¿åæœŸç®¡ç†ï¼Œæˆ‘ä»¬å…ˆæŠŠcalicoctl.yamlä¸‹è½½åˆ°æœ¬åœ°å†è¿›è¡Œéƒ¨ç½²[root@tiny-calico-master-88-1 calico]# wget https://projectcalico.docs.tigera.io/manifests/calicoctl-etcd.yaml[root@tiny-calico-master-88-1 calico]# cat calicoctl-etcd.yaml# Calico Version v3.22.2# https://projectcalico.docs.tigera.io/releases#v3.22.2# This manifest includes the following component versions:# calico/ctl:v3.22.2apiVersion: v1kind: Podmetadata: name: calicoctl namespace: kube-systemspec: nodeSelector: kubernetes.io/os: linux hostNetwork: true containers: - name: calicoctl image: calico/ctl:v3.22.2 command: - /calicoctl args: - version - --poll=1m env: - name: ETCD_ENDPOINTS valueFrom: configMapKeyRef: name: calico-config key: etcd_endpoints # If you&#x27;re using TLS enabled etcd uncomment the following. # Location of the CA certificate for etcd. - name: ETCD_CA_CERT_FILE valueFrom: configMapKeyRef: name: calico-config key: etcd_ca # Location of the client key for etcd. - name: ETCD_KEY_FILE valueFrom: configMapKeyRef: name: calico-config key: etcd_key # Location of the client certificate for etcd. - name: ETCD_CERT_FILE valueFrom: configMapKeyRef: name: calico-config key: etcd_cert volumeMounts: - mountPath: /calico-secrets name: etcd-certs volumes: # If you&#x27;re using TLS enabled etcd uncomment the following. - name: etcd-certs secret: secretName: calico-etcd-secrets ä¿®æ”¹å®Œæˆä¹‹åæˆ‘ä»¬ç›´æ¥éƒ¨ç½²å³å¯ä½¿ç”¨ 12345678910111213141516171819202122232425262728293031323334353637[root@tiny-calico-master-88-1 calico]# kubectl apply -f calicoctl-etcd.yamlpod/calicoctl created# åˆ›å»ºå®Œæˆåæˆ‘ä»¬æŸ¥çœ‹calicoctlçš„è¿è¡ŒçŠ¶æ€[root@tiny-calico-master-88-1 calico]# kubectl get pods -A | grep calicoctlkube-system calicoctl 1/1 Running 0 9s# æ£€éªŒä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ[root@tiny-calico-master-88-1 ~]# kubectl exec -ti -n kube-system calicoctl -- /calicoctl get nodesNAMEtiny-calico-master-88-1.k8s.tcinternaltiny-calico-worker-88-11.k8s.tcinternaltiny-calico-worker-88-12.k8s.tcinternal[root@tiny-calico-master-88-1 ~]# kubectl exec -ti -n kube-system calicoctl -- /calicoctl get profiles -o wideNAME LABELSprojectcalico-default-allowkns.default pcns.kubernetes.io/metadata.name=default,pcns.projectcalico.org/name=defaultkns.kube-node-lease pcns.kubernetes.io/metadata.name=kube-node-lease,pcns.projectcalico.org/name=kube-node-leasekns.kube-public pcns.kubernetes.io/metadata.name=kube-public,pcns.projectcalico.org/name=kube-publickns.kube-system pcns.kubernetes.io/metadata.name=kube-system,pcns.projectcalico.org/name=kube-system...æ­¤å¤„ç•¥å»ä¸€å †è¾“å‡º...# æŸ¥çœ‹ipamçš„åˆ†é…æƒ…å†µ[root@tiny-calico-master-88-1 calico]# calicoctl ipam show+----------+---------------+-----------+------------+--------------+| GROUPING | CIDR | IPS TOTAL | IPS IN USE | IPS FREE |+----------+---------------+-----------+------------+--------------+| IP Pool | 10.88.64.0/18 | 16384 | 2 (0%) | 16382 (100%) |+----------+---------------+-----------+------------+--------------+# ä¸ºäº†æ–¹ä¾¿å¯ä»¥åœ¨bashrcä¸­è®¾ç½®aliascat &gt;&gt; ~/.bashrc &lt;&lt;EOFalias calicoctl=&quot;kubectl exec -i -n kube-system calicoctl -- /calicoctl&quot;EOF å®Œæ•´ç‰ˆæœ¬calicoctlå‘½ä»¤å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ 5.4 binaryå®‰è£…calicoctlä½¿ç”¨podæ–¹å¼éƒ¨ç½²calicoctlè™½ç„¶ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜å°±æ˜¯æ— æ³•ä½¿ç”¨calicoctl nodeå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦è®¿é—®éƒ¨åˆ†å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚å› æ­¤è¿™é‡Œæˆ‘ä»¬å†äºŒè¿›åˆ¶éƒ¨ç½²ä¸€ä¸ªcalicoctlã€‚ Note that if you run calicoctl in a container, calicoctl node ... commands will not work (they need access to parts of the host filesystem). 1234# ç›´æ¥ä¸‹çº¿äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ä½¿ç”¨[root@tiny-calico-master-88-1 calico]# cd /usr/local/bin/[root@tiny-calico-master-88-1 bin]# curl -L https://github.com/projectcalico/calico/releases/download/v3.22.2/calicoctl-linux-amd64 -o calicoctl[root@tiny-calico-master-88-1 bin]# chmod +x ./calicoctl äºŒè¿›åˆ¶çš„calicoctlä¼šä¼˜å…ˆè¯»å–é…ç½®æ–‡ä»¶ï¼Œå½“æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶çš„æ—¶å€™æ‰ä¼šå»è¯»å–ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥é…ç½®/etc/calico/calicoctl.cfgï¼Œæ³¨æ„etcdçš„è¯ä¹¦ç›´æ¥å’Œå‰é¢éƒ¨ç½²calicoæ—¶ä½¿ç”¨çš„è¯ä¹¦æ–‡ä»¶ä¸€è‡´å³å¯ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879# é…ç½®calicoctlçš„é…ç½®æ–‡ä»¶[root@tiny-calico-master-88-1 calico]# mkdir /etc/calico[root@tiny-calico-master-88-1 calico]# cat /etc/calico/calicoctl.cfgapiVersion: projectcalico.org/v3kind: CalicoAPIConfigmetadata:spec: datastoreType: etcdv3 etcdEndpoints: &quot;https://10.31.88.1:2379&quot; etcdCACert: | -----BEGIN CERTIFICATE----- MIIC9TCCAd2gAwIBAgIBADANBgkqhkiG9w0BAQsFADASMRAwDgYDVQQDEwdldGNk LWNhMB4XDTIyMDUwNjA1MTg1OVoXDTMyMDUwMzA1MTg1OVowEjEQMA4GA1UEAxMH ZXRjZC1jYTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBANFFqq4Mk3DE 6UW581xnZPFrHqQWlGr/KptEywKH56Bp24OAnDIAkSz7KAMrJzL+OiVsj9YJV59F 9qH/YzU+bppctDnfk1yCuavkcXgLSd9O6EBhM2LkGtF9AdWMnFw9ui2jNhFC/QXj zCvq0I1c9o9gulbFmSHwIw2GLQd7ogO+PpfLsubRscJdKkCUWVFV0mb8opccmXoF vXynRX0VW3wpN+v66bD+HTdMSNK1JljfBngh9LAkibjUx7bMrHvu/GOalNCSWrtG lss/hhWkzwV7Y7AIXgvxxcmDdfswe5lUYLvW2CP4e+tXfB3i2wg10fErc8z63lix v9BWkIIalScCAwEAAaNWMFQwDgYDVR0PAQH/BAQDAgKkMA8GA1UdEwEB/wQFMAMB Af8wHQYDVR0OBBYEFH49PpnJYxze8aq0PVwgpY4Fo6djMBIGA1UdEQQLMAmCB2V0 Y2QtY2EwDQYJKoZIhvcNAQELBQADggEBAAGL6KwN80YEK6gZcL+7RI9bkMKk7UWW V48154CgN8w9GKvNTm4l0tZKvsWCnR61hiJtLQcG0S8HYHAvL1DBjOXw11bNilLy vaVM+wqOOIxPsXLU//F46z3V9z1uV0v/yLLlg320c0wtG+OLZZIn8O+yUhtOHM09 K0JSAF2/KhtNxhrc0owCTOzS+DKsb0w1SzQmS0t/tflyLfc3oJZ/2V4Tqd72j7iI cDBa36lGqtUBf8MXu+Xza0cdhy/f19AqkeM2fe+/DrbzR4zDVmZ7l4dqYGLbKHYo XaLn8bSToYQq4dlA/oAlyyH0ekB5v0DyYiHwlqgZgiu4qcR3Gw8azVk= -----END CERTIFICATE----- etcdCert: | -----BEGIN CERTIFICATE----- MIIDgzCCAmugAwIBAgIIePiBSOdMGwcwDQYJKoZIhvcNAQELBQAwEjEQMA4GA1UE AxMHZXRjZC1jYTAeFw0yMjA1MDYwNTE4NTlaFw0yMzA1MDYwNTE4NTlaMDExLzAt BgNVBAMTJnRpbnktY2FsaWNvLW1hc3Rlci04OC0xLms4cy50Y2ludGVybmFsMIIB IjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqZM/jBrdXLR3ctee7LVJhGSA 4usg/JQXGyOAd52OkkOLYwn3fvwqeo0Z0cX0q4mqaF0cnrPYc4eExX/3fJpF3Fxy D6vdpEZ/FrnzCAkibEYtK/UVhTKuV7n/VdbjFPGl8CpppuGVs6o+4NFZxffW7em0 8m/FK/7SDkV2qXCyG94kOaUCeDEgdBKE3cPCZQ4maFuwXi08bYs2CiTfbfa4dsT5 3yzaoQVX9BaBqE9IGmsHDFuxp1X8gkJXs+7wwHQX39o1oXmci6T4IVxVHA5GRbTv pCDG5Wye7QqKgnxO1KRF42FKs1Nif7UJ0iR35Ydpa7cat7Fr0M7l+rZLCDTJgwID AQABo4G9MIG6MA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYI KwYBBQUHAwIwDAYDVR0TAQH/BAIwADAfBgNVHSMEGDAWgBR+PT6ZyWMc3vGqtD1c IKWOBaOnYzBaBgNVHREEUzBRgglsb2NhbGhvc3SCJnRpbnktY2FsaWNvLW1hc3Rl ci04OC0xLms4cy50Y2ludGVybmFshwQKH1gBhwR/AAABhxAAAAAAAAAAAAAAAAAA AAABMA0GCSqGSIb3DQEBCwUAA4IBAQC+pyH14/+US5Svz04Vi8QIduY/DVx1HOQq hfrIZKOZCH2iKU7fZ4o9QpQZh7D9B8hgpXM6dNuFpd98c0MVPr+LesShu4BHVjHl gPvUWEVB2XD5x51HqnMV2OkhMKooyAUIzI0P0YKN29SFEyJGD1XDu4UtqvBADqf7 COvAuqj4VbRgF/iQwNstjqZ47rSzvyp6rIwqFoHRP+Zi+8KL1qmozGjI3+H+TZFM Gv3b5DRx2pmfY+kGVLO5bjl3zxylRPjCDHaRlQUWiOYSWS8OHYRCBZuSLvW4tht0 JjWjUAh4hF8+3lyNrfx8moz7tfm5SG2q01pO1vjkhrhxhINAwaac -----END CERTIFICATE----- etcdKey: | -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAqZM/jBrdXLR3ctee7LVJhGSA4usg/JQXGyOAd52OkkOLYwn3 fvwqeo0Z0cX0q4mqaF0cnrPYc4eExX/3fJpF3FxyD6vdpEZ/FrnzCAkibEYtK/UV hTKuV7n/VdbjFPGl8CpppuGVs6o+4NFZxffW7em08m/FK/7SDkV2qXCyG94kOaUC eDEgdBKE3cPCZQ4maFuwXi08bYs2CiTfbfa4dsT53yzaoQVX9BaBqE9IGmsHDFux p1X8gkJXs+7wwHQX39o1oXmci6T4IVxVHA5GRbTvpCDG5Wye7QqKgnxO1KRF42FK s1Nif7UJ0iR35Ydpa7cat7Fr0M7l+rZLCDTJgwIDAQABAoIBAE1gMw7q8zbp4dc1 K/82eWU/ts/UGikmKaTofiYWboeu6ls2oQgAaCGjYLSnbw0Ws/sLAZQo3AtbOuoj ifoBKv9x71nXQjtDL5pfHtX71QkyvEniev9cMNE2vZudgeB8owsDT1ImfPiOJkLP Q/dhL2E/0qEM/xskGxUH/S0zjxHHfPZZsYODhkVPWc6Z+XEDll48fRCFn4/48FTN 9GbRvo7dv34EHmNYA20K4DMHbZUdrPqSZpKWzAPJXnDlgZbpvUeAYOJxqZHQtCm1 zbSOyM1Ql6K0Ayro0L5GAzap+0yGuk79OWiPnEsdPneVsATKG7dT7RZIL/INrOqQ 0wjUmQECgYEA02OHdT1K5Au6wtiTqKD99WweltnvFd4C/Z3dobEj8M8qN6uiKCca PievWahnxAlJEah3RiOgtarwA+0E/Jgsw99Qutp5BR/XdD3llTNczkPkg/RkWpve 2f/4DlZQrxuIem7UNLl+5BacfmF691DQQoX2RoIkvQxYJGTUNXvrSUkCgYEAzVyz mvN+dvSwzAlm0gkfVP5Ez3DFESUrWd0FR2v1HR6qHQy/dkgkkic6zRGCJtGeT5V7 N0kbVSHsz+wi6aQkFy0Sp0TbgZzjPhSwNtk+2JsBRvMp0CYczgrfyvWuAQ3gbXGc N8IkcZSSOv8TuigCnnYf2Xaz8LM50AivScnb6GsCgYEAyq4ScgnLpa3NawbnRPbf qRH6nl7lC01sBqn3mBHVSQ4JB4msF92uHsxEJ639mAvjIGgrvHdqnuT/7nOypVJv EXsr14ykHpKyLQUv/Idbw3V7RD3ufqYW3WS8/VorUEoQ6HsdQlRc4ur/L3ndwgWd OTtir6YW/aA5XuPCSGnBZekCgYB6VtlgW+Jg91BDnO41/d0+guN3ONUNa7kxpau5 aqTxHg11lNySmFPBBcHP3LhOa94FxyVKQDEaPEWZcDE0QuaFMALGxwyFYHM3zpdT dYQtAdp26/Fi4PGUBYJgpI9ubVffmyjXRr7zMvESWFbmNWOqBvDeWgrEP+EW/7V9 HdX11QKBgE1czchlibgQ/bhAl8BatKRr1X/UHvblWhmyApudOfFeGOILR6u/lWvY SS+Rg0y8nnZ4hTRSXbd/sSEsUJcSmoBc1TivWzl32eVuqe9CcrUZY0JSLtoj1KiP adRcCZtVDETXbW326Hvgz+MnqrIgzx+Zgy4tNtoAAbTv0q83j45I -----END RSA PRIVATE KEY----- é…ç½®å®Œæˆä¹‹åæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æ•ˆæœ 1234567891011121314151617181920212223242526[root@tiny-calico-master-88-1 ~]# calicoctl node statusCalico process is running.IPv4 BGP status+--------------+-------------------+-------+----------+-------------+| PEER ADDRESS | PEER TYPE | STATE | SINCE | INFO |+--------------+-------------------+-------+----------+-------------+| 10.31.88.11 | node-to-node mesh | up | 08:26:30 | Established || 10.31.88.12 | node-to-node mesh | up | 08:26:30 | Established |+--------------+-------------------+-------+----------+-------------+IPv6 BGP statusNo IPv6 peers found.[root@tiny-calico-master-88-1 ~]# calicoctl get nodesNAMEtiny-calico-master-88-1.k8s.tcinternaltiny-calico-worker-88-11.k8s.tcinternaltiny-calico-worker-88-12.k8s.tcinternal[root@tiny-calico-master-88-1 ~]# calicoctl ipam show+----------+---------------+-----------+------------+--------------+| GROUPING | CIDR | IPS TOTAL | IPS IN USE | IPS FREE |+----------+---------------+-----------+------------+--------------+| IP Pool | 10.88.64.0/18 | 16384 | 2 (0%) | 16382 (100%) |+----------+---------------+-----------+------------+--------------+ 6ã€éƒ¨ç½²æµ‹è¯•ç”¨ä¾‹é›†ç¾¤éƒ¨ç½²å®Œæˆä¹‹åæˆ‘ä»¬åœ¨k8sé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªnginxæµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºnginx-quicçš„å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ï¼Œç„¶ååœ¨è¿™ä¸ªå‘½åç©ºé—´å†…åˆ›å»ºä¸€ä¸ªåä¸ºnginx-quic-deploymentçš„deploymentç”¨æ¥éƒ¨ç½²podï¼Œæœ€åå†åˆ›å»ºä¸€ä¸ªserviceç”¨æ¥æš´éœ²æœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨nodeportçš„æ–¹å¼æš´éœ²ç«¯å£æ–¹ä¾¿æµ‹è¯•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546[root@tiny-calico-master-88-1 tiny-calico]# cat nginx-quic.yamlapiVersion: v1kind: Namespacemetadata: name: nginx-quic---apiVersion: apps/v1kind: Deploymentmetadata: name: nginx-quic-deployment namespace: nginx-quicspec: selector: matchLabels: app: nginx-quic replicas: 4 template: metadata: labels: app: nginx-quic spec: containers: - name: nginx-quic image: tinychen777/nginx-quic:latest imagePullPolicy: IfNotPresent ports: - containerPort: 80---apiVersion: v1kind: Servicemetadata: name: nginx-quic-service namespace: nginx-quicspec: selector: app: nginx-quic ports: - protocol: TCP port: 8080 # match for service access port targetPort: 80 # match for pod access port nodePort: 30088 # match for external access port type: NodePort éƒ¨ç½²å®Œæˆåæˆ‘ä»¬ç›´æ¥æŸ¥çœ‹çŠ¶æ€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445# ç›´æ¥éƒ¨ç½²[root@tiny-calico-master-88-1 tiny-calico]# kubectl apply -f nginx-quic.yamlnamespace/nginx-quic createddeployment.apps/nginx-quic-deployment createdservice/nginx-quic-service created# æŸ¥çœ‹deploymentçš„è¿è¡ŒçŠ¶æ€[root@tiny-calico-master-88-1 tiny-calico]# kubectl get deployment -o wide -n nginx-quicNAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTORnginx-quic-deployment 4/4 4 4 55s nginx-quic tinychen777/nginx-quic:latest app=nginx-quic# æŸ¥çœ‹serviceçš„è¿è¡ŒçŠ¶æ€[root@tiny-calico-master-88-1 tiny-calico]# kubectl get service -o wide -n nginx-quicNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORnginx-quic-service NodePort 10.88.52.168 &lt;none&gt; 8080:30088/TCP 66s app=nginx-quic# æŸ¥çœ‹podçš„è¿è¡ŒçŠ¶æ€[root@tiny-calico-master-88-1 tiny-calico]# kubectl get pods -o wide -n nginx-quicNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESnginx-quic-deployment-7457f4d579-24q9z 1/1 Running 0 75s 10.88.120.72 tiny-calico-worker-88-12.k8s.tcinternal &lt;none&gt; &lt;none&gt;nginx-quic-deployment-7457f4d579-4svv9 1/1 Running 0 75s 10.88.84.68 tiny-calico-worker-88-11.k8s.tcinternal &lt;none&gt; &lt;none&gt;nginx-quic-deployment-7457f4d579-btrjj 1/1 Running 0 75s 10.88.120.71 tiny-calico-worker-88-12.k8s.tcinternal &lt;none&gt; &lt;none&gt;nginx-quic-deployment-7457f4d579-lvh6x 1/1 Running 0 75s 10.88.84.69 tiny-calico-worker-88-11.k8s.tcinternal &lt;none&gt; &lt;none&gt;# æŸ¥çœ‹IPVSè§„åˆ™[root@tiny-calico-master-88-1 tiny-calico]# ipvsadm -lnIP Virtual Server version 1.2.1 (size=4096)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 172.17.0.1:30088 rr -&gt; 10.88.84.68:80 Masq 1 0 0 -&gt; 10.88.84.69:80 Masq 1 0 0 -&gt; 10.88.120.71:80 Masq 1 0 0 -&gt; 10.88.120.72:80 Masq 1 0 0TCP 10.31.88.1:30088 rr -&gt; 10.88.84.68:80 Masq 1 0 0 -&gt; 10.88.84.69:80 Masq 1 0 0 -&gt; 10.88.120.71:80 Masq 1 0 0 -&gt; 10.88.120.72:80 Masq 1 0 0TCP 10.88.52.168:8080 rr -&gt; 10.88.84.68:80 Masq 1 0 0 -&gt; 10.88.84.69:80 Masq 1 0 0 -&gt; 10.88.120.71:80 Masq 1 0 0 -&gt; 10.88.120.72:80 Masq 1 0 0 æœ€åæˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼Œè¿™ä¸ªnginx-quicçš„é•œåƒé»˜è®¤æƒ…å†µä¸‹ä¼šè¿”å›åœ¨nginxå®¹å™¨ä¸­è·å¾—çš„ç”¨æˆ·è¯·æ±‚çš„IPå’Œç«¯å£ 1234567891011121314151617181920# é¦–å…ˆæˆ‘ä»¬åœ¨é›†ç¾¤å†…è¿›è¡Œæµ‹è¯•# ç›´æ¥è®¿é—®pod[root@tiny-calico-master-88-1 tiny-calico]# curl 10.88.84.68:8010.31.88.1:34612# ç›´æ¥è®¿é—®serviceçš„ClusterIPï¼Œè¿™æ—¶è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°podä¸­[root@tiny-calico-master-88-1 tiny-calico]# curl 10.88.52.168:808010.31.88.1:58978# ç›´æ¥è®¿é—®nodeportï¼Œè¿™æ—¶è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°podä¸­ï¼Œä¸ä¼šç»è¿‡ClusterIP[root@tiny-calico-master-88-1 tiny-calico]# curl 10.31.88.1:3008810.31.88.1:56595# æ¥ç€æˆ‘ä»¬åœ¨é›†ç¾¤å¤–è¿›è¡Œæµ‹è¯•# ç›´æ¥è®¿é—®ä¸‰ä¸ªèŠ‚ç‚¹çš„nodeportï¼Œè¿™æ—¶è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°podä¸­ï¼Œä¸ä¼šç»è¿‡ClusterIP# ç”±äºexternalTrafficPolicyé»˜è®¤ä¸ºClusterï¼Œå› æ­¤nginxæ‹¿åˆ°çš„IPå°±æ˜¯æˆ‘ä»¬è®¿é—®çš„èŠ‚ç‚¹çš„IPï¼Œè€Œéå®¢æˆ·ç«¯IP[tinychen /root]# curl 10.31.88.1:3008810.31.88.1:27851[tinychen /root]# curl 10.31.88.11:3008810.31.88.11:16540[tinychen /root]# curl 10.31.88.12:3008810.31.88.12:5767","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"},{"name":"docker","slug":"docker","permalink":"https://tinychen.com/tags/docker/"},{"name":"calico","slug":"calico","permalink":"https://tinychen.com/tags/calico/"}]},{"title":"k8sç³»åˆ—02-kubeadméƒ¨ç½²flannelç½‘ç»œçš„k8sé›†ç¾¤","slug":"20220507-k8s-02-deploy-k8s-with-flannel","date":"2022-05-07T05:00:00.000Z","updated":"2022-05-07T05:00:00.000Z","comments":true,"path":"20220507-k8s-02-deploy-k8s-with-flannel/","link":"","permalink":"https://tinychen.com/20220507-k8s-02-deploy-k8s-with-flannel/","excerpt":"æœ¬æ–‡ä¸»è¦åœ¨centos7ç³»ç»Ÿä¸ŠåŸºäºdockerå’Œflannelç»„ä»¶éƒ¨ç½²v1.23.6ç‰ˆæœ¬çš„k8såŸç”Ÿé›†ç¾¤ï¼Œç”±äºé›†ç¾¤ä¸»è¦ç”¨äºè‡ªå·±å¹³æ—¶å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨ï¼ŒåŠ ä¸Šèµ„æºæœ‰é™ï¼Œæš‚ä¸æ¶‰åŠé«˜å¯ç”¨éƒ¨ç½²ã€‚ æ­¤å‰å†™çš„ä¸€äº›å…³äºk8såŸºç¡€çŸ¥è¯†å’Œé›†ç¾¤æ­å»ºçš„ä¸€äº›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ã€‚","text":"æœ¬æ–‡ä¸»è¦åœ¨centos7ç³»ç»Ÿä¸ŠåŸºäºdockerå’Œflannelç»„ä»¶éƒ¨ç½²v1.23.6ç‰ˆæœ¬çš„k8såŸç”Ÿé›†ç¾¤ï¼Œç”±äºé›†ç¾¤ä¸»è¦ç”¨äºè‡ªå·±å¹³æ—¶å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨ï¼ŒåŠ ä¸Šèµ„æºæœ‰é™ï¼Œæš‚ä¸æ¶‰åŠé«˜å¯ç”¨éƒ¨ç½²ã€‚ æ­¤å‰å†™çš„ä¸€äº›å…³äºk8såŸºç¡€çŸ¥è¯†å’Œé›†ç¾¤æ­å»ºçš„ä¸€äº›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ã€‚ 1ã€å‡†å¤‡å·¥ä½œ1.1 flannel-é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯æœºå™¨å‡ä¸º8C8Gçš„è™šæ‹Ÿæœºï¼Œç¡¬ç›˜ä¸º100Gã€‚ IP Hostname 10.31.8.1 tiny-flannel-master-8-1.k8s.tcinternal 10.31.8.11 tiny-flannel-worker-8-11.k8s.tcinternal 10.31.8.12 tiny-flannel-worker-8-12.k8s.tcinternal 10.8.64.0/18 podSubnet 10.8.0.0/18 serviceSubnet 1.2 æ£€æŸ¥macå’Œproduct_uuidåŒä¸€ä¸ªk8sé›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹éœ€è¦ç¡®ä¿macåœ°å€å’Œproduct_uuidå‡å”¯ä¸€ï¼Œå¼€å§‹é›†ç¾¤åˆå§‹åŒ–ä¹‹å‰éœ€è¦æ£€æŸ¥ç›¸å…³ä¿¡æ¯ 123456# æ£€æŸ¥macåœ°å€ip link ifconfig -a# æ£€æŸ¥product_uuidsudo cat /sys/class/dmi/id/product_uuid 1.3 é…ç½®sshå…å¯†ç™»å½•ï¼ˆå¯é€‰ï¼‰å¦‚æœk8sé›†ç¾¤çš„èŠ‚ç‚¹æœ‰å¤šä¸ªç½‘å¡ï¼Œç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹èƒ½é€šè¿‡æ­£ç¡®çš„ç½‘å¡äº’è”è®¿é—® 123456789101112131415161718192021222324252627# åœ¨rootç”¨æˆ·ä¸‹é¢ç”Ÿæˆä¸€ä¸ªå…¬ç”¨çš„keyï¼Œå¹¶é…ç½®å¯ä»¥ä½¿ç”¨è¯¥keyå…å¯†ç™»å½•su rootssh-keygencd /root/.ssh/cat id_rsa.pub &gt;&gt; authorized_keyschmod 600 authorized_keyscat &gt;&gt; ~/.ssh/config &lt;&lt;EOFHost tiny-flannel-master-8-1.k8s.tcinternal HostName 10.31.8.1 User root Port 22 IdentityFile ~/.ssh/id_rsaHost tiny-flannel-worker-8-11.k8s.tcinternal HostName 10.31.8.11 User root Port 22 IdentityFile ~/.ssh/id_rsaHost tiny-flannel-worker-8-12.k8s.tcinternal HostName 10.31.8.12 User root Port 22 IdentityFile ~/.ssh/id_rsaEOF 1.4 ä¿®æ”¹hostsæ–‡ä»¶12345cat &gt;&gt; /etc/hosts &lt;&lt;EOF10.31.8.1 tiny-flannel-master-8-1 tiny-flannel-master-8-1.k8s.tcinternal10.31.8.11 tiny-flannel-worker-8-11 tiny-flannel-worker-8-11.k8s.tcinternal10.31.8.12 tiny-flannel-worker-8-12 tiny-flannel-worker-8-12.k8s.tcinternalEOF 1.5 å…³é—­swapå†…å­˜1234# ä½¿ç”¨å‘½ä»¤ç›´æ¥å…³é—­swapå†…å­˜swapoff -a# ä¿®æ”¹fstabæ–‡ä»¶ç¦æ­¢å¼€æœºè‡ªåŠ¨æŒ‚è½½swapåˆ†åŒºsed -i &#x27;/swap / s/^\\(.*\\)$/#\\1/g&#x27; /etc/fstab 1.6 é…ç½®æ—¶é—´åŒæ­¥è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯é€‰æ‹©ntpæˆ–è€…æ˜¯chronyåŒæ­¥å‡å¯ï¼ŒåŒæ­¥çš„æ—¶é—´æºæœåŠ¡å™¨å¯ä»¥é€‰æ‹©é˜¿é‡Œäº‘çš„ntp1.aliyun.comæˆ–è€…æ˜¯å›½å®¶æ—¶é—´ä¸­å¿ƒçš„ntp.ntsc.ac.cnã€‚ ä½¿ç”¨ntpåŒæ­¥12345678# ä½¿ç”¨yumå®‰è£…ntpdateå·¥å…·yum install ntpdate -y# ä½¿ç”¨å›½å®¶æ—¶é—´ä¸­å¿ƒçš„æºåŒæ­¥æ—¶é—´ntpdate ntp.ntsc.ac.cn# æœ€åæŸ¥çœ‹ä¸€ä¸‹æ—¶é—´hwclock ä½¿ç”¨chronyåŒæ­¥12345678910111213141516171819202122232425262728293031# ä½¿ç”¨yumå®‰è£…chronyyum install chrony -y# è®¾ç½®å¼€æœºå¯åŠ¨å¹¶å¼€å¯chonyå¹¶æŸ¥çœ‹è¿è¡ŒçŠ¶æ€systemctl enable chronyd.servicesystemctl start chronyd.servicesystemctl status chronyd.service# å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ—¶é—´æœåŠ¡å™¨vim /etc/chrony.conf# ä¿®æ”¹å‰[root@localhost ~]# grep server /etc/chrony.conf# Use public servers from the pool.ntp.org project.server 0.centos.pool.ntp.org iburstserver 1.centos.pool.ntp.org iburstserver 2.centos.pool.ntp.org iburstserver 3.centos.pool.ntp.org iburst# ä¿®æ”¹å[root@localhost ~]# grep server /etc/chrony.conf# Use public servers from the pool.ntp.org project.server ntp.ntsc.ac.cn iburst# é‡å¯æœåŠ¡ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆsystemctl restart chronyd.service# æŸ¥çœ‹chronyçš„ntpæœåŠ¡å™¨çŠ¶æ€chronyc sourcestats -vchronyc sources -v 1.7 å…³é—­selinux12345# ä½¿ç”¨å‘½ä»¤ç›´æ¥å…³é—­setenforce 0# ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹/etc/selinux/configæ–‡ä»¶sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=disabled/&#x27; /etc/selinux/config 1.8 é…ç½®é˜²ç«å¢™k8sé›†ç¾¤ä¹‹é—´é€šä¿¡å’ŒæœåŠ¡æš´éœ²éœ€è¦ä½¿ç”¨è¾ƒå¤šç«¯å£ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥ç¦ç”¨é˜²ç«å¢™ 12# centos7ä½¿ç”¨systemctlç¦ç”¨é»˜è®¤çš„firewalldæœåŠ¡systemctl disable firewalld.service 1.9 é…ç½®netfilterå‚æ•°è¿™é‡Œä¸»è¦æ˜¯éœ€è¦é…ç½®å†…æ ¸åŠ è½½br_netfilterå’Œiptablesæ”¾è¡Œipv6å’Œipv4çš„æµé‡ï¼Œç¡®ä¿é›†ç¾¤å†…çš„å®¹å™¨èƒ½å¤Ÿæ­£å¸¸é€šä¿¡ã€‚ 123456789cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.confbr_netfilterEOFcat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.confnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1EOFsudo sysctl --system 1.10 å…³é—­IPV6ï¼ˆå¯é€‰ï¼‰è™½ç„¶æ–°ç‰ˆæœ¬çš„k8så·²ç»æ”¯æŒåŒæ ˆç½‘ç»œï¼Œä½†æ˜¯æœ¬æ¬¡çš„é›†ç¾¤éƒ¨ç½²è¿‡ç¨‹å¹¶ä¸æ¶‰åŠIPv6ç½‘ç»œçš„é€šä¿¡ï¼Œå› æ­¤å…³é—­IPv6ç½‘ç»œæ”¯æŒ 12# ç›´æ¥åœ¨å†…æ ¸ä¸­æ·»åŠ ipv6ç¦ç”¨å‚æ•°grubby --update-kernel=ALL --args=ipv6.disable=1 1.11 é…ç½®IPVSï¼ˆå¯é€‰ï¼‰IPVSæ˜¯ä¸“é—¨è®¾è®¡ç”¨æ¥åº”å¯¹è´Ÿè½½å‡è¡¡åœºæ™¯çš„ç»„ä»¶ï¼Œkube-proxy ä¸­çš„ IPVS å®ç°é€šè¿‡å‡å°‘å¯¹ iptables çš„ä½¿ç”¨æ¥å¢åŠ å¯æ‰©å±•æ€§ã€‚åœ¨ iptables è¾“å…¥é“¾ä¸­ä¸ä½¿ç”¨ PREROUTINGï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªå‡çš„æ¥å£ï¼Œå«åš kube-ipvs0ï¼Œå½“k8sé›†ç¾¤ä¸­çš„è´Ÿè½½å‡è¡¡é…ç½®å˜å¤šçš„æ—¶å€™ï¼ŒIPVSèƒ½å®ç°æ¯”iptablesæ›´é«˜æ•ˆçš„è½¬å‘æ€§èƒ½ã€‚ æ³¨æ„åœ¨4.19ä¹‹åçš„å†…æ ¸ç‰ˆæœ¬ä¸­ä½¿ç”¨nf_conntrackæ¨¡å—æ¥æ›¿æ¢äº†åŸæœ‰çš„nf_conntrack_ipv4æ¨¡å— (Notes: use nf_conntrack instead of nf_conntrack_ipv4 for Linux kernel 4.19 and later) 12345678910111213141516171819202122232425262728293031323334353637# åœ¨ä½¿ç”¨ipvsæ¨¡å¼ä¹‹å‰ç¡®ä¿å®‰è£…äº†ipsetå’Œipvsadmsudo yum install ipset ipvsadm -y# æ‰‹åŠ¨åŠ è½½ipvsç›¸å…³æ¨¡å—modprobe -- ip_vsmodprobe -- ip_vs_rrmodprobe -- ip_vs_wrrmodprobe -- ip_vs_shmodprobe -- nf_conntrack_ipv4# é…ç½®å¼€æœºè‡ªåŠ¨åŠ è½½ipvsç›¸å…³æ¨¡å—cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/ipvs.confip_vsip_vs_rrip_vs_wrrip_vs_shnf_conntrack_ipv4EOFsudo sysctl --system# æœ€å¥½é‡å¯ä¸€éç³»ç»Ÿç¡®å®šæ˜¯å¦ç”Ÿæ•ˆ[root@tiny-flannel-master-8-1 tiny-flannel]# lsmod | grep -e ip_vs -e nf_conntrack_ipv4ip_vs_sh 12688 0ip_vs_wrr 12697 0ip_vs_rr 12600 0ip_vs 145458 6 ip_vs_rr,ip_vs_sh,ip_vs_wrrnf_conntrack_ipv4 15053 2nf_defrag_ipv4 12729 1 nf_conntrack_ipv4nf_conntrack 139264 7 ip_vs,nf_nat,nf_nat_ipv4,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_netlink,nf_conntrack_ipv4libcrc32c 12644 4 xfs,ip_vs,nf_nat,nf_conntrack[root@tiny-flannel-master-8-1 tiny-flannel]# cut -f1 -d &quot; &quot; /proc/modules | grep -e ip_vs -e nf_conntrack_ipv4ip_vs_ship_vs_wrrip_vs_rrip_vsnf_conntrack_ipv4 2ã€å®‰è£…container runtime2.1 å®‰è£…dockerè¯¦ç»†çš„å®˜æ–¹æ–‡æ¡£å¯ä»¥å‚è€ƒè¿™é‡Œï¼Œç”±äºåœ¨åˆšå‘å¸ƒçš„1.24ç‰ˆæœ¬ä¸­ç§»é™¤äº†docker-shimï¼Œå› æ­¤å®‰è£…çš„ç‰ˆæœ¬â‰¥1.24çš„æ—¶å€™éœ€è¦æ³¨æ„å®¹å™¨è¿è¡Œæ—¶çš„é€‰æ‹©ã€‚è¿™é‡Œæˆ‘ä»¬å®‰è£…çš„ç‰ˆæœ¬ä½äº1.24ï¼Œå› æ­¤æˆ‘ä»¬ç»§ç»­ä½¿ç”¨dockerã€‚ dockerçš„å…·ä½“å®‰è£…å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚ 123456# å®‰è£…å¿…è¦çš„ä¾èµ–ç»„ä»¶å¹¶ä¸”å¯¼å…¥dockerå®˜æ–¹æä¾›çš„yumæºsudo yum install -y yum-utils device-mapper-persistent-data lvm2sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo# æˆ‘ä»¬ç›´æ¥å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„dockeryum install docker-ce docker-ce-cli containerd.io 2.2 é…ç½®cgroup driversCentOS7ä½¿ç”¨çš„æ˜¯systemdæ¥åˆå§‹åŒ–ç³»ç»Ÿå¹¶ç®¡ç†è¿›ç¨‹ï¼Œåˆå§‹åŒ–è¿›ç¨‹ä¼šç”Ÿæˆå¹¶ä½¿ç”¨ä¸€ä¸ª root æ§åˆ¶ç»„ (cgroup), å¹¶å……å½“ cgroup ç®¡ç†å™¨ã€‚ Systemd ä¸ cgroup é›†æˆç´§å¯†ï¼Œå¹¶å°†ä¸ºæ¯ä¸ª systemd å•å…ƒåˆ†é…ä¸€ä¸ª cgroupã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½®å®¹å™¨è¿è¡Œæ—¶å’Œ kubelet ä½¿ç”¨ cgroupfsã€‚ è¿åŒ systemd ä¸€èµ·ä½¿ç”¨ cgroupfs æ„å‘³ç€å°†æœ‰ä¸¤ä¸ªä¸åŒçš„ cgroup ç®¡ç†å™¨ã€‚è€Œå½“ä¸€ä¸ªç³»ç»Ÿä¸­åŒæ—¶å­˜åœ¨cgroupfså’Œsystemdä¸¤è€…æ—¶ï¼Œå®¹æ˜“å˜å¾—ä¸ç¨³å®šï¼Œå› æ­¤æœ€å¥½æ›´æ”¹è®¾ç½®ï¼Œä»¤å®¹å™¨è¿è¡Œæ—¶å’Œ kubelet ä½¿ç”¨ systemd ä½œä¸º cgroup é©±åŠ¨ï¼Œä»¥æ­¤ä½¿ç³»ç»Ÿæ›´ä¸ºç¨³å®šã€‚ å¯¹äº Docker, éœ€è¦è®¾ç½® native.cgroupdriver=systemd å‚æ•°ã€‚ å‚è€ƒå®˜æ–¹çš„è¯´æ˜æ–‡æ¡£ï¼š https://kubernetes.io/docs/setup/production-environment/container-runtimes/#cgroup-drivers å‚è€ƒé…ç½®è¯´æ˜æ–‡æ¡£ https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker 1234567891011121314151617181920sudo mkdir /etc/dockercat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json&#123; &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;], &quot;log-driver&quot;: &quot;json-file&quot;, &quot;log-opts&quot;: &#123; &quot;max-size&quot;: &quot;100m&quot; &#125;, &quot;storage-driver&quot;: &quot;overlay2&quot;&#125;EOFsudo systemctl enable dockersudo systemctl daemon-reloadsudo systemctl restart docker# æœ€åæ£€æŸ¥ä¸€ä¸‹Cgroup Driveræ˜¯å¦ä¸ºsystemd[root@tiny-calico-master-88-1 ~]# docker info | grep systemd Cgroup Driver: systemd 2.3 å…³äºkubeletçš„cgroup driverk8så®˜æ–¹æœ‰è¯¦ç»†çš„æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•è®¾ç½®kubeletçš„cgroup driverï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œåœ¨1.22ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨è®¾ç½®kubeletçš„cgroup driverï¼Œé‚£ä¹ˆé»˜è®¤ä¼šè®¾ç½®ä¸ºsystemd Note: In v1.22, if the user is not setting the cgroupDriver field under KubeletConfiguration, kubeadm will default it to systemd. ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æŒ‡å®škubeletçš„cgroup driverçš„æ–¹æ³•å°±æ˜¯åœ¨kubeadm-config.yamlåŠ å…¥cgroupDriverå­—æ®µ 12345678# kubeadm-config.yamlkind: ClusterConfigurationapiVersion: kubeadm.k8s.io/v1beta3kubernetesVersion: v1.21.0---kind: KubeletConfigurationapiVersion: kubelet.config.k8s.io/v1beta1cgroupDriver: systemd æˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥çœ‹configmapsæ¥æŸ¥çœ‹åˆå§‹åŒ–ä¹‹åé›†ç¾¤çš„kubeadm-configé…ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435[root@tiny-calico-master-88-1 tiny-calico]# kubectl describe configmaps kubeadm-config -n kube-systemName: kubeadm-configNamespace: kube-systemLabels: &lt;none&gt;Annotations: &lt;none&gt;Data====ClusterConfiguration:----apiServer: extraArgs: authorization-mode: Node,RBAC timeoutForControlPlane: 4m0sapiVersion: kubeadm.k8s.io/v1beta3certificatesDir: /etc/kubernetes/pkiclusterName: kubernetescontrollerManager: &#123;&#125;dns: &#123;&#125;etcd: local: dataDir: /var/lib/etcdimageRepository: registry.aliyuncs.com/google_containerskind: ClusterConfigurationkubernetesVersion: v1.23.6networking: dnsDomain: cali-cluster.tclocal serviceSubnet: 10.88.0.0/18scheduler: &#123;&#125;BinaryData====Events: &lt;none&gt; å½“ç„¶å› ä¸ºæˆ‘ä»¬éœ€è¦å®‰è£…çš„ç‰ˆæœ¬é«˜äº1.22.0å¹¶ä¸”ä½¿ç”¨çš„å°±æ˜¯systemdï¼Œå› æ­¤å¯ä»¥ä¸ç”¨å†é‡å¤é…ç½®ã€‚ 3ã€å®‰è£…kubeä¸‰ä»¶å¥— å¯¹åº”çš„å®˜æ–¹æ–‡æ¡£å¯ä»¥å‚è€ƒè¿™é‡Œ https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl kubeä¸‰ä»¶å¥—å°±æ˜¯kubeadmã€kubelet å’Œ kubectlï¼Œä¸‰è€…çš„å…·ä½“åŠŸèƒ½å’Œä½œç”¨å¦‚ä¸‹ï¼š kubeadmï¼šç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤ã€‚ kubeletï¼šåœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ Pod å’Œå®¹å™¨ç­‰ã€‚ kubectlï¼šç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š kubeadmä¸ä¼šå¸®åŠ©æˆ‘ä»¬ç®¡ç†kubeletå’Œkubectlï¼Œå…¶ä»–ä¸¤è€…ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸‰è€…æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå¹¶ä¸å­˜åœ¨è°ç®¡ç†è°çš„æƒ…å†µï¼› kubeletçš„ç‰ˆæœ¬å¿…é¡»å°äºç­‰äºAPI-serverçš„ç‰ˆæœ¬ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°å…¼å®¹æ€§çš„é—®é¢˜ï¼› kubectlå¹¶ä¸æ˜¯é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦å®‰è£…ï¼Œä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šè¦å®‰è£…åœ¨é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼Œå¯ä»¥å•ç‹¬å®‰è£…åœ¨è‡ªå·±æœ¬åœ°çš„æœºå™¨ç¯å¢ƒä¸Šé¢ï¼Œç„¶åé…åˆkubeconfigæ–‡ä»¶å³å¯ä½¿ç”¨kubectlå‘½ä»¤æ¥è¿œç¨‹ç®¡ç†å¯¹åº”çš„k8sé›†ç¾¤ï¼› CentOS7çš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„yumæºå³å¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œéœ€è¦è®¾ç½®selinuxçš„çŠ¶æ€ï¼Œä½†æ˜¯å‰é¢æˆ‘ä»¬å·²ç»å…³é—­äº†selinuxï¼Œå› æ­¤è¿™é‡Œç•¥è¿‡è¿™æ­¥ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041# ç›´æ¥å¯¼å…¥è°·æ­Œå®˜æ–¹çš„yumæºcat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearchenabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpgexclude=kubelet kubeadm kubectlEOF# å½“ç„¶å¦‚æœè¿ä¸ä¸Šè°·æ­Œçš„æºï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å›½å†…çš„é˜¿é‡Œé•œåƒæºcat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/enabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpgEOF# æ¥ä¸‹æ¥ç›´æ¥å®‰è£…ä¸‰ä»¶å¥—å³å¯sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes# å¦‚æœç½‘ç»œç¯å¢ƒä¸å¥½å‡ºç°gpgcheckéªŒè¯å¤±è´¥å¯¼è‡´æ— æ³•æ­£å¸¸è¯»å–yumæºï¼Œå¯ä»¥è€ƒè™‘å…³é—­è¯¥yumæºçš„repo_gpgchecksed -i &#x27;s/repo_gpgcheck=1/repo_gpgcheck=0/g&#x27; /etc/yum.repos.d/kubernetes.repo# æˆ–è€…åœ¨å®‰è£…çš„æ—¶å€™ç¦ç”¨gpgchecksudo yum install -y kubelet kubeadm kubectl --nogpgcheck --disableexcludes=kubernetes# å¦‚æœæƒ³è¦å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹ç›¸å…³ç‰ˆæœ¬çš„ä¿¡æ¯sudo yum list --nogpgcheck kubelet kubeadm kubectl --showduplicates --disableexcludes=kubernetes# è¿™é‡Œæˆ‘ä»¬ä¸ºäº†ä¿ç•™ä½¿ç”¨docker-shimï¼Œå› æ­¤æˆ‘ä»¬æŒ‰ç…§1.24.0ç‰ˆæœ¬çš„å‰ä¸€ä¸ªç‰ˆæœ¬1.23.6sudo yum install -y kubelet-1.23.6-0 kubeadm-1.23.6-0 kubectl-1.23.6-0 --nogpgcheck --disableexcludes=kubernetes# å®‰è£…å®Œæˆåé…ç½®å¼€æœºè‡ªå¯kubeletsudo systemctl enable --now kubelet 4ã€åˆå§‹åŒ–é›†ç¾¤4.1 ç¼–å†™é…ç½®æ–‡ä»¶åœ¨é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œå®Œä¸Šé¢çš„ä¸‰ç‚¹æ“ä½œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹åˆ›å»ºk8sé›†ç¾¤äº†ã€‚å› ä¸ºæˆ‘ä»¬è¿™æ¬¡ä¸æ¶‰åŠé«˜å¯ç”¨éƒ¨ç½²ï¼Œå› æ­¤åˆå§‹åŒ–çš„æ—¶å€™ç›´æ¥åœ¨æˆ‘ä»¬çš„ç›®æ ‡masterèŠ‚ç‚¹ä¸Šé¢æ“ä½œå³å¯ã€‚ 123456789101112131415# æˆ‘ä»¬å…ˆä½¿ç”¨kubeadmå‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ä¸»è¦çš„å‡ ä¸ªé•œåƒç‰ˆæœ¬# å› ä¸ºæˆ‘ä»¬æ­¤å‰æŒ‡å®šå®‰è£…äº†æ—§çš„1.23.6ç‰ˆæœ¬ï¼Œè¿™é‡Œçš„apiserveré•œåƒç‰ˆæœ¬ä¹Ÿä¼šéšä¹‹å›æ»š[root@tiny-flannel-master-8-1 tiny-flannel]# kubeadm config images listI0507 14:14:34.992275 20038 version.go:255] remote version is much newer: v1.24.0; falling back to: stable-1.23k8s.gcr.io/kube-apiserver:v1.23.6k8s.gcr.io/kube-controller-manager:v1.23.6k8s.gcr.io/kube-scheduler:v1.23.6k8s.gcr.io/kube-proxy:v1.23.6k8s.gcr.io/pause:3.6k8s.gcr.io/etcd:3.5.1-0k8s.gcr.io/coredns/coredns:v1.8.6# ä¸ºäº†æ–¹ä¾¿ç¼–è¾‘å’Œç®¡ç†ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŠŠåˆå§‹åŒ–å‚æ•°å¯¼å‡ºæˆé…ç½®æ–‡ä»¶[root@tiny-flannel-master-8-1 tiny-flannel]# kubeadm config print init-defaults &gt; kubeadm-flannel.conf è€ƒè™‘åˆ°å¤§å¤šæ•°æƒ…å†µä¸‹å›½å†…çš„ç½‘ç»œæ— æ³•ä½¿ç”¨è°·æ­Œçš„k8s.gcr.ioé•œåƒæºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹imageRepositoryå‚æ•°ä¸ºé˜¿é‡Œçš„é•œåƒæº kubernetesVersionå­—æ®µç”¨æ¥æŒ‡å®šæˆ‘ä»¬è¦å®‰è£…çš„k8sç‰ˆæœ¬ localAPIEndpointå‚æ•°éœ€è¦ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„masterèŠ‚ç‚¹çš„IPå’Œç«¯å£ï¼Œåˆå§‹åŒ–ä¹‹åçš„k8sé›†ç¾¤çš„apiserveråœ°å€å°±æ˜¯è¿™ä¸ª serviceSubnetå’ŒdnsDomainä¸¤ä¸ªå‚æ•°é»˜è®¤æƒ…å†µä¸‹å¯ä»¥ä¸ç”¨ä¿®æ”¹ï¼Œè¿™é‡Œæˆ‘æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚è¿›è¡Œäº†å˜æ›´ nodeRegistrationé‡Œé¢çš„nameå‚æ•°ä¿®æ”¹ä¸ºå¯¹åº”masterèŠ‚ç‚¹çš„hostname æ–°å¢é…ç½®å—ä½¿ç”¨ipvsï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ 123456789101112131415161718192021222324252627282930313233343536373839404142apiVersion: kubeadm.k8s.io/v1beta3bootstrapTokens:- groups: - system:bootstrappers:kubeadm:default-node-token token: abcdef.0123456789abcdef ttl: 24h0m0s usages: - signing - authenticationkind: InitConfigurationlocalAPIEndpoint: advertiseAddress: 10.31.8.1 bindPort: 6443nodeRegistration: criSocket: /var/run/dockershim.sock imagePullPolicy: IfNotPresent name: tiny-flannel-master-8-1.k8s.tcinternal taints: null---apiServer: timeoutForControlPlane: 4m0sapiVersion: kubeadm.k8s.io/v1beta3certificatesDir: /etc/kubernetes/pkiclusterName: kubernetescontrollerManager: &#123;&#125;dns: &#123;&#125;etcd: local: dataDir: /var/lib/etcdimageRepository: registry.aliyuncs.com/google_containerskind: ClusterConfigurationkubernetesVersion: 1.23.6networking: dnsDomain: flan-cluster.tclocal serviceSubnet: 10.8.0.0/18 podSubnet: 10.8.64.0/18scheduler: &#123;&#125;---apiVersion: kubeproxy.config.k8s.io/v1alpha1kind: KubeProxyConfigurationmode: ipvs 4.2 åˆå§‹åŒ–é›†ç¾¤æ­¤æ—¶æˆ‘ä»¬å†æŸ¥çœ‹å¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­çš„é•œåƒç‰ˆæœ¬ï¼Œå°±ä¼šå‘ç°å·²ç»å˜æˆäº†å¯¹åº”é˜¿é‡Œäº‘é•œåƒæºçš„ç‰ˆæœ¬ 12345678910111213141516171819202122232425262728# æŸ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„é•œåƒç‰ˆæœ¬ï¼Œç¡®å®šé…ç½®æ–‡ä»¶æ˜¯å¦ç”Ÿæ•ˆ[root@tiny-flannel-master-8-1 tiny-flannel]# kubeadm config images list --config kubeadm-flannel.confregistry.aliyuncs.com/google_containers/kube-apiserver:v1.23.6registry.aliyuncs.com/google_containers/kube-controller-manager:v1.23.6registry.aliyuncs.com/google_containers/kube-scheduler:v1.23.6registry.aliyuncs.com/google_containers/kube-proxy:v1.23.6registry.aliyuncs.com/google_containers/pause:3.6registry.aliyuncs.com/google_containers/etcd:3.5.1-0registry.aliyuncs.com/google_containers/coredns:v1.8.6# ç¡®è®¤æ²¡é—®é¢˜ä¹‹åæˆ‘ä»¬ç›´æ¥æ‹‰å–é•œåƒ[root@tiny-flannel-master-8-1 tiny-flannel]# kubeadm config images pull --config kubeadm-flannel.conf[config/images] Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.23.6[config/images] Pulled registry.aliyuncs.com/google_containers/pause:3.6[config/images] Pulled registry.aliyuncs.com/google_containers/etcd:3.5.1-0[config/images] Pulled registry.aliyuncs.com/google_containers/coredns:v1.8.6# åˆå§‹åŒ–[root@tiny-flannel-master-8-1 tiny-flannel]# kubeadm init --config kubeadm-flannel.conf[init] Using Kubernetes version: v1.23.6[preflight] Running pre-flight checks[preflight] Pulling images required for setting up a Kubernetes cluster[preflight] This might take a minute or two, depending on the speed of your internet connection[preflight] You can also perform this action in beforehand using &#x27;kubeadm config images pull&#x27;...æ­¤å¤„ç•¥å»ä¸€å †è¾“å‡º... å½“æˆ‘ä»¬çœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡ºç»“æœçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„é›†ç¾¤å°±ç®—æ˜¯åˆå§‹åŒ–æˆåŠŸäº†ã€‚ 123456789101112131415161718192021Your Kubernetes control-plane has initialized successfully!To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/configAlternatively, if you are the root user, you can run: export KUBECONFIG=/etc/kubernetes/admin.confYou should now deploy a pod network to the cluster.Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/Then you can join any number of worker nodes by running the following on each as root:kubeadm join 10.31.8.1:6443 --token abcdef.0123456789abcdef \\ --discovery-token-ca-cert-hash sha256:d7160866920c0331731ad3c1c31a6e5b6c788b5682f86971cacaa940211db9ab 4.3 é…ç½®kubeconfigåˆšåˆå§‹åŒ–æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬è¿˜æ²¡åŠæ³•é©¬ä¸ŠæŸ¥çœ‹k8sé›†ç¾¤ä¿¡æ¯ï¼Œéœ€è¦é…ç½®kubeconfigç›¸å…³å‚æ•°æ‰èƒ½æ­£å¸¸ä½¿ç”¨kubectlè¿æ¥apiserverè¯»å–é›†ç¾¤ä¿¡æ¯ã€‚ 12345678910# å¯¹äºérootç”¨æˆ·ï¼Œå¯ä»¥è¿™æ ·æ“ä½œmkdir -p $HOME/.kubesudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configsudo chown $(id -u):$(id -g) $HOME/.kube/config# å¦‚æœæ˜¯rootç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥å¯¼å…¥ç¯å¢ƒå˜é‡export KUBECONFIG=/etc/kubernetes/admin.conf# æ·»åŠ kubectlçš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc å‰é¢æˆ‘ä»¬æåˆ°è¿‡kubectlä¸ä¸€å®šè¦å®‰è£…åœ¨é›†ç¾¤å†…ï¼Œå®é™…ä¸Šåªè¦æ˜¯ä»»ä½•ä¸€å°èƒ½è¿æ¥åˆ°apiserverçš„æœºå™¨ä¸Šé¢éƒ½å¯ä»¥å®‰è£…kubectlå¹¶ä¸”æ ¹æ®æ­¥éª¤é…ç½®kubeconfigï¼Œå°±å¯ä»¥ä½¿ç”¨kubectlå‘½ä»¤è¡Œæ¥ç®¡ç†å¯¹åº”çš„k8sé›†ç¾¤ã€‚ é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å†æ‰§è¡Œç›¸å…³å‘½ä»¤å°±å¯ä»¥æŸ¥çœ‹é›†ç¾¤çš„ä¿¡æ¯äº†ã€‚ 12345678910111213141516171819[root@tiny-flannel-master-8-1 tiny-flannel]# kubectl cluster-infoKubernetes control plane is running at https://10.31.8.1:6443CoreDNS is running at https://10.31.8.1:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxyTo further debug and diagnose cluster problems, use &#x27;kubectl cluster-info dump&#x27;.[root@tiny-flannel-master-8-1 tiny-flannel]# kubectl get nodes -o wideNAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIMEtiny-flannel-master-8-1.k8s.tcinternal NotReady control-plane,master 79s v1.23.6 10.31.8.1 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-1160.62.1.el7.x86_64 docker://20.10.14[root@tiny-flannel-master-8-1 tiny-flannel]# kubectl get pods -A -o wideNAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESkube-system coredns-6d8c4cb4d-2clkj 0/1 Pending 0 86s &lt;none&gt; &lt;none&gt; &lt;none&gt; &lt;none&gt;kube-system coredns-6d8c4cb4d-8mznz 0/1 Pending 0 86s &lt;none&gt; &lt;none&gt; &lt;none&gt; &lt;none&gt;kube-system etcd-tiny-flannel-master-8-1.k8s.tcinternal 1/1 Running 0 91s 10.31.8.1 tiny-flannel-master-8-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-apiserver-tiny-flannel-master-8-1.k8s.tcinternal 1/1 Running 0 92s 10.31.8.1 tiny-flannel-master-8-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-controller-manager-tiny-flannel-master-8-1.k8s.tcinternal 1/1 Running 0 90s 10.31.8.1 tiny-flannel-master-8-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-proxy-dkvrn 1/1 Running 0 86s 10.31.8.1 tiny-flannel-master-8-1.k8s.tcinternal &lt;none&gt; &lt;none&gt;kube-system kube-scheduler-tiny-flannel-master-8-1.k8s.tcinternal 1/1 Running 0 92s 10.31.8.1 tiny-flannel-master-8-1.k8s.tcinternal &lt;none&gt; &lt;none&gt; 4.4 æ·»åŠ workerèŠ‚ç‚¹è¿™æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­æ·»åŠ å‰©ä¸‹çš„ä¸¤ä¸ªèŠ‚ç‚¹ä½œä¸ºworkerèŠ‚ç‚¹è¿è¡Œè´Ÿè½½ï¼Œç›´æ¥åœ¨å‰©ä¸‹çš„èŠ‚ç‚¹ä¸Šé¢è¿è¡Œé›†ç¾¤åˆå§‹åŒ–æˆåŠŸæ—¶è¾“å‡ºçš„å‘½ä»¤å°±å¯ä»¥æˆåŠŸåŠ å…¥é›†ç¾¤ï¼š 1234567891011121314[root@tiny-flannel-worker-8-11 ~]# kubeadm join 10.31.8.1:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:d7160866920c0331731ad3c1c31a6e5b6c788b5682f86971cacaa940211db9ab[preflight] Running pre-flight checks[preflight] Reading configuration from the cluster...[preflight] FYI: You can look at this config file with &#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;[kubelet-start] Starting the kubelet[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...This node has joined the cluster:* Certificate signing request was sent to apiserver and a response was received.* The Kubelet was informed of the new secure connection details.Run &#x27;kubectl get nodes&#x27; on the control-plane to see this node join the cluster. å¦‚æœä¸å°å¿ƒæ²¡ä¿å­˜åˆå§‹åŒ–æˆåŠŸçš„è¾“å‡ºä¿¡æ¯ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨kubectlå·¥å…·æŸ¥çœ‹æˆ–è€…ç”Ÿæˆtoken 12345678910111213141516# æŸ¥çœ‹ç°æœ‰çš„tokenåˆ—è¡¨[root@tiny-flannel-master-8-1 tiny-flannel]# kubeadm token listTOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPSabcdef.0123456789abcdef 23h 2022-05-08T06:27:34Z authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-token# å¦‚æœtokenå·²ç»å¤±æ•ˆï¼Œé‚£å°±å†åˆ›å»ºä¸€ä¸ªæ–°çš„token[root@tiny-flannel-master-8-1 tiny-flannel]# kubeadm token createpyab3u.j1a9ld7vk03znbk8[root@tiny-flannel-master-8-1 tiny-flannel]# kubeadm token listTOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPSabcdef.0123456789abcdef 23h 2022-05-08T06:27:34Z authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-tokenpyab3u.j1a9ld7vk03znbk8 23h 2022-05-08T06:34:28Z authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-token# å¦‚æœæ‰¾ä¸åˆ°--discovery-token-ca-cert-hashå‚æ•°ï¼Œåˆ™å¯ä»¥åœ¨masterèŠ‚ç‚¹ä¸Šä½¿ç”¨opensslå·¥å…·æ¥è·å–[root@tiny-flannel-master-8-1 tiny-flannel]# openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#x27;s/^.* //&#x27;d6cdc5a3bc40cbb0ae85776eb4fcdc1854942e2dd394470ae0f2f97714dd9fb9 æ·»åŠ å®Œæˆä¹‹åæˆ‘ä»¬å†æŸ¥çœ‹é›†ç¾¤çš„èŠ‚ç‚¹å¯ä»¥å‘ç°è¿™æ—¶å€™å·²ç»å¤šäº†ä¸¤ä¸ªnodeï¼Œä½†æ˜¯æ­¤æ—¶èŠ‚ç‚¹çš„çŠ¶æ€è¿˜æ˜¯NotReadyï¼Œæ¥ä¸‹æ¥å°±éœ€è¦éƒ¨ç½²CNIäº†ã€‚ 12345[root@tiny-flannel-master-8-1 tiny-flannel]# kubectl get nodesNAME STATUS ROLES AGE VERSIONtiny-flannel-master-8-1.k8s.tcinternal NotReady control-plane,master 7m49s v1.23.6tiny-flannel-worker-8-11.k8s.tcinternal NotReady &lt;none&gt; 2m58s v1.23.6tiny-flannel-worker-8-12.k8s.tcinternal NotReady &lt;none&gt; 102s v1.23.6 5ã€å®‰è£…CNI5.1 ç¼–å†™manifestæ–‡ä»¶flannelåº”è¯¥æ˜¯ä¼—å¤šå¼€æºçš„CNIæ’ä»¶ä¸­å…¥é—¨é—¨æ§›æœ€ä½çš„CNIä¹‹ä¸€äº†ï¼Œéƒ¨ç½²ç®€å•ï¼ŒåŸç†æ˜“æ‡‚ï¼Œä¸”ç›¸å…³çš„æ–‡æ¡£åœ¨ç½‘ç»œä¸Šä¹Ÿéå¸¸ä¸°å¯Œã€‚ 12# æˆ‘ä»¬å…ˆæŠŠå®˜æ–¹çš„yamlæ¨¡æ¿ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åå¯¹å…³é”®å­—æ®µé€ä¸ªä¿®æ”¹[root@tiny-flannel-master-8-1 flannel]# wget https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml é’ˆå¯¹kube-flannel.ymlæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€äº›å‚æ•°ä»¥é€‚é…æˆ‘ä»¬çš„é›†ç¾¤ï¼š net-conf.jsonå‚æ•°ï¼Œé…ç½®çš„æ˜¯podçš„ç½‘æ®µï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ­¤å‰è®¡åˆ’å¥½çš„10.8.64.0/18 1234567net-conf.json: | &#123; &quot;Network&quot;: &quot;10.8.64.0/18&quot;, &quot;Backend&quot;: &#123; &quot;Type&quot;: &quot;vxlan&quot; &#125; &#125; 5.2 éƒ¨ç½²flannelä¿®æ”¹å®Œæˆä¹‹åæˆ‘ä»¬ç›´æ¥éƒ¨ç½²å³å¯ 123456789101112131415161718192021222324252627[root@tiny-flannel-master-8-1 flannel]# kubectl apply -f kube-flannel.ymlWarning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+podsecuritypolicy.policy/psp.flannel.unprivileged createdclusterrole.rbac.authorization.k8s.io/flannel createdclusterrolebinding.rbac.authorization.k8s.io/flannel createdserviceaccount/flannel createdconfigmap/kube-flannel-cfg createddaemonset.apps/kube-flannel-ds created# æŸ¥çœ‹podæ˜¯å¦æ­£å¸¸è¿è¡Œ[root@tiny-flannel-master-8-1 flannel]# kubectl get pods -ANAMESPACE NAME READY STATUS RESTARTS AGEkube-system coredns-6d8c4cb4d-np7q2 1/1 Running 0 14mkube-system coredns-6d8c4cb4d-z8f5b 1/1 Running 0 14mkube-system etcd-tiny-flannel-master-8-1.k8s.tcinternal 1/1 Running 0 14mkube-system kube-apiserver-tiny-flannel-master-8-1.k8s.tcinternal 1/1 Running 0 14mkube-system kube-controller-manager-tiny-flannel-master-8-1.k8s.tcinternal 1/1 Running 0 14mkube-system kube-flannel-ds-9fq4z 1/1 Running 0 12mkube-system kube-flannel-ds-ckstx 1/1 Running 0 7m18skube-system kube-flannel-ds-qj55x 1/1 Running 0 8m25skube-system kube-proxy-bncfl 1/1 Running 0 14mkube-system kube-proxy-lslcm 1/1 Running 0 7m18skube-system kube-proxy-pmwhf 1/1 Running 0 8m25skube-system kube-scheduler-tiny-flannel-master-8-1.k8s.tcinternal 1/1 Running 0 14m# æŸ¥çœ‹flannelçš„podæ—¥å¿—æ˜¯å¦æœ‰æŠ¥é”™[root@tiny-flannel-master-8-1 flannel]# kubectl logs -f -l app=flannel -n kube-system 6ã€éƒ¨ç½²æµ‹è¯•ç”¨ä¾‹é›†ç¾¤éƒ¨ç½²å®Œæˆä¹‹åæˆ‘ä»¬åœ¨k8sé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªnginxæµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºnginx-quicçš„å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ï¼Œç„¶ååœ¨è¿™ä¸ªå‘½åç©ºé—´å†…åˆ›å»ºä¸€ä¸ªåä¸ºnginx-quic-deploymentçš„deploymentç”¨æ¥éƒ¨ç½²podï¼Œæœ€åå†åˆ›å»ºä¸€ä¸ªserviceç”¨æ¥æš´éœ²æœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨nodeportçš„æ–¹å¼æš´éœ²ç«¯å£æ–¹ä¾¿æµ‹è¯•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546[root@tiny-flannel-master-8-1 tiny-flannel]# cat nginx-quic.yamlapiVersion: v1kind: Namespacemetadata: name: nginx-quic---apiVersion: apps/v1kind: Deploymentmetadata: name: nginx-quic-deployment namespace: nginx-quicspec: selector: matchLabels: app: nginx-quic replicas: 2 template: metadata: labels: app: nginx-quic spec: containers: - name: nginx-quic image: tinychen777/nginx-quic:latest imagePullPolicy: IfNotPresent ports: - containerPort: 80---apiVersion: v1kind: Servicemetadata: name: nginx-quic-service namespace: nginx-quicspec: selector: app: nginx-quic ports: - protocol: TCP port: 8080 # match for service access port targetPort: 80 # match for pod access port nodePort: 30088 # match for external access port type: NodePort éƒ¨ç½²å®Œæˆåæˆ‘ä»¬ç›´æ¥æŸ¥çœ‹çŠ¶æ€ 12345678910111213141516171819202122232425262728293031323334353637383940414243# ç›´æ¥éƒ¨ç½²[root@tiny-flannel-master-8-1 tiny-flannel]# kubectl apply -f nginx-quic.yamlnamespace/nginx-quic createddeployment.apps/nginx-quic-deployment createdservice/nginx-quic-service created# æŸ¥çœ‹deploymentçš„è¿è¡ŒçŠ¶æ€[root@tiny-flannel-master-8-1 tiny-flannel]# kubectl get deployment -o wide -n nginx-quicNAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTORnginx-quic-deployment 2/2 2 2 48s nginx-quic tinychen777/nginx-quic:latest app=nginx-quic# æŸ¥çœ‹serviceçš„è¿è¡ŒçŠ¶æ€[root@tiny-flannel-master-8-1 tiny-flannel]# kubectl get service -o wide -n nginx-quicNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORnginx-quic-service NodePort 10.8.4.218 &lt;none&gt; 8080:30088/TCP 62s app=nginx-quic# æŸ¥çœ‹podçš„è¿è¡ŒçŠ¶æ€[root@tiny-flannel-master-8-1 tiny-flannel]# kubectl get pods -o wide -n nginx-quicNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESnginx-quic-deployment-696d959797-jm8w5 1/1 Running 0 73s 10.8.66.2 tiny-flannel-worker-8-12.k8s.tcinternal &lt;none&gt; &lt;none&gt;nginx-quic-deployment-696d959797-lwcqz 1/1 Running 0 73s 10.8.65.2 tiny-flannel-worker-8-11.k8s.tcinternal &lt;none&gt; &lt;none&gt;# æŸ¥çœ‹IPVSè§„åˆ™[root@tiny-flannel-master-8-1 tiny-flannel]# ipvsadm -lnIP Virtual Server version 1.2.1 (size=4096)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 172.17.0.1:30088 rr -&gt; 10.8.65.2:80 Masq 1 0 0 -&gt; 10.8.66.2:80 Masq 1 0 0TCP 10.8.4.218:8080 rr -&gt; 10.8.65.2:80 Masq 1 0 0 -&gt; 10.8.66.2:80 Masq 1 0 0TCP 10.8.64.0:30088 rr -&gt; 10.8.65.2:80 Masq 1 0 0 -&gt; 10.8.66.2:80 Masq 1 0 0TCP 10.8.64.1:30088 rr -&gt; 10.8.65.2:80 Masq 1 0 0 -&gt; 10.8.66.2:80 Masq 1 0 0TCP 10.31.8.1:30088 rr -&gt; 10.8.65.2:80 Masq 1 0 0 -&gt; 10.8.66.2:80 Masq 1 0 0 æœ€åæˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼Œè¿™ä¸ªnginx-quicçš„é•œåƒé»˜è®¤æƒ…å†µä¸‹ä¼šè¿”å›åœ¨nginxå®¹å™¨ä¸­è·å¾—çš„ç”¨æˆ·è¯·æ±‚çš„IPå’Œç«¯å£ 12345678910111213141516171819202122# é¦–å…ˆæˆ‘ä»¬åœ¨é›†ç¾¤å†…è¿›è¡Œæµ‹è¯•# ç›´æ¥è®¿é—®podï¼Œè¿™æ—¶å€™æ˜¾ç¤ºçš„IPæ˜¯masterèŠ‚ç‚¹ä¸Šé¢çš„flannel.1ç½‘å¡çš„IP[root@tiny-flannel-master-8-1 tiny-flannel]# curl 10.8.66.2:8010.8.64.0:38958[root@tiny-flannel-master-8-1 tiny-flannel]# curl 10.8.65.2:8010.8.64.0:46484# ç›´æ¥è®¿é—®serviceçš„ClusterIPï¼Œè¿™æ—¶è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°podä¸­[root@tiny-flannel-master-8-1 tiny-flannel]# curl 10.8.4.218:808010.8.64.0:26305# ç›´æ¥è®¿é—®nodeportï¼Œè¿™æ—¶è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°podä¸­ï¼Œä¸ä¼šç»è¿‡ClusterIP[root@tiny-flannel-master-8-1 tiny-flannel]# curl 10.31.8.1:3008810.8.64.0:6519# æ¥ç€æˆ‘ä»¬åœ¨é›†ç¾¤å¤–è¿›è¡Œæµ‹è¯•# ç›´æ¥è®¿é—®ä¸‰ä¸ªèŠ‚ç‚¹çš„nodeportï¼Œè¿™æ—¶è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°podä¸­ï¼Œä¸ä¼šç»è¿‡ClusterIP# ç”±äºexternalTrafficPolicyé»˜è®¤ä¸ºClusterï¼Œnginxæ‹¿åˆ°çš„IPå°±æ˜¯æˆ‘ä»¬è®¿é—®çš„èŠ‚ç‚¹çš„flannel.1ç½‘å¡çš„IP[tinychen /root]# curl 10.31.8.1:3008810.8.64.0:50688[tinychen /root]# curl 10.31.8.11:3008810.8.65.1:41032[tinychen /root]# curl 10.31.8.12:3008810.8.66.0:11422","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"},{"name":"docker","slug":"docker","permalink":"https://tinychen.com/tags/docker/"},{"name":"flannel","slug":"flannel","permalink":"https://tinychen.com/tags/flannel/"}]},{"title":"CoreDNSç¯‡7-æ€§èƒ½å‹æµ‹","slug":"20220221-dns-10-coredns-07-queryperf-performance-testing","date":"2022-02-21T03:00:00.000Z","updated":"2022-02-21T03:00:00.000Z","comments":true,"path":"20220221-dns-10-coredns-07-queryperf-performance-testing/","link":"","permalink":"https://tinychen.com/20220221-dns-10-coredns-07-queryperf-performance-testing/","excerpt":"æœ¬æ–‡ä¸»è¦ç”¨äºä»‹ç»å¦‚ä½•ç¼–è¯‘å®‰è£…queryperfæ¥å¯¹DNSæœåŠ¡å™¨è¿›è¡Œå‹æµ‹ï¼Œä»¥åŠCoreDNSå¸¸è§çš„å‡ ç§é…ç½®ä¸‹çš„å‹æµ‹æ€§èƒ½è¡¨ç°ã€‚","text":"æœ¬æ–‡ä¸»è¦ç”¨äºä»‹ç»å¦‚ä½•ç¼–è¯‘å®‰è£…queryperfæ¥å¯¹DNSæœåŠ¡å™¨è¿›è¡Œå‹æµ‹ï¼Œä»¥åŠCoreDNSå¸¸è§çš„å‡ ç§é…ç½®ä¸‹çš„å‹æµ‹æ€§èƒ½è¡¨ç°ã€‚ 1ã€queryperf1.1 ç¼–è¯‘å®‰è£…queryperfæ˜¯bind9å‡ºå“çš„ä¸€æ¬¾æµ‹è¯•dnsæœåŠ¡å™¨æ€§èƒ½çš„å·¥å…·ï¼Œç›®å‰åœ¨9.12.4ç‰ˆæœ¬çš„bindæºç ä¸­è¿˜å­˜åœ¨ï¼Œå†å¾€åçš„æ–°ç‰ˆæœ¬å°±æ²¡çœ‹åˆ°æœ‰queryperfäº†ã€‚ 1234567[root@coredns1 home]# wget https://ftp.isc.org/isc/bind9/9.12.4/bind-9.12.4.tar.gz[root@coredns1 home]# tar -zxvf bind-9.12.4.tar.gz[root@coredns1 home]# cd bind-9.12.4/contrib/queryperf[root@coredns1 queryperf]# ./configure[root@coredns1 queryperf]# make[root@coredns1 queryperf]# file queryperfqueryperf: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.32, not stripped 1.2 å¸¸ç”¨æ“ä½œ123456789101112131415161718192021222324252627282930313233343536# å°†ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ç›´æ¥å¤åˆ¶åˆ°ç³»ç»Ÿçš„binç›®å½•ä¸­å³å¯å…¨å±€æ“ä½œ[root@coredns1 queryperf]# cp queryperf /usr/local/bin/[root@coredns1 home]# queryperf -hDNS Query Performance Testing ToolVersion: $Id: queryperf.c,v 1.12 2007/09/05 07:36:04 marka Exp $Usage: queryperf [-d datafile] [-s server_addr] [-p port] [-q num_queries] [-b bufsize] [-t timeout] [-n] [-l limit] [-f family] [-1] [-i interval] [-r arraysize] [-u unit] [-H histfile] [-T qps] [-e] [-D] [-R] [-c] [-v] [-h] -d specifies the input data file (default: stdin) -s sets the server to query (default: 127.0.0.1) -p sets the port on which to query the server (default: 53) -q specifies the maximum number of queries outstanding (default: 20) -t specifies the timeout for query completion in seconds (default: 5) -n causes configuration changes to be ignored -l specifies how a limit for how long to run tests in seconds (no default) -1 run through input only once (default: multiple iff limit given) -b set input/output buffer size in kilobytes (default: 32 k) -i specifies interval of intermediate outputs in seconds (default: 0=none) -f specify address family of DNS transport, inet or inet6 (default: any) -r set RTT statistics array size (default: 50000) -u set RTT statistics time unit in usec (default: 100) -H specifies RTT histogram data file (default: none) -T specify the target qps (default: 0=unspecified) -e enable EDNS 0 -D set the DNSSEC OK bit (implies EDNS) -R disable recursion -c print the number of packets with each rcode -v verbose: report the RCODE of each response on stdout -h print this usage åœ¨å‹æµ‹ä¹‹å‰éœ€è¦æˆ‘ä»¬è‡ªå·±å‡†å¤‡å‹æµ‹çš„æµ‹è¯•æ•°æ®ï¼Œæ ¼å¼ä¸ºåŸŸå æŸ¥è¯¢ç±»å‹ï¼Œå¦‚ï¼š 12345tinychen.com Atiny777.com Atinychen.com MXtiny777.com MXtinychen777.com AAAA å¸¸ç”¨çš„æ“ä½œå‘½ä»¤æœ‰ï¼š 1234567891011# å¯¹192.168.1.1è¿›è¡Œå‹æµ‹ï¼ŒæŸ¥è¯¢åŸŸåä¸ºæ–‡ä»¶query.domain.listçš„å†…å®¹queryperf -s 192.168.1.1 -d query.domain.list# å¯¹192.168.1.1çš„5353ç«¯å£è¿›è¡Œå‹æµ‹ï¼ŒæŸ¥è¯¢åŸŸåä¸ºæ–‡ä»¶query.domain.listçš„å†…å®¹queryperf -s 192.168.1.1 -p 5353 -d query.domain.list# å¯¹192.168.1.1çš„5353ç«¯å£è¿›è¡Œå‹æµ‹ï¼ŒæŸ¥è¯¢åŸŸåä¸ºæ–‡ä»¶query.domain.listçš„å†…å®¹ï¼Œå‹æµ‹å‹åŠ›ä¸º1000qpsqueryperf -s 192.168.1.1 -p 5353 -d query.domain.list -T 1000# å¯¹192.168.1.1çš„5353ç«¯å£è¿›è¡Œå‹æµ‹ï¼ŒæŸ¥è¯¢åŸŸåä¸ºæ–‡ä»¶query.domain.listçš„å†…å®¹ï¼Œå‹æµ‹å‹åŠ›ä¸º1000qpsï¼Œæ¯æ¬¡æŸ¥è¯¢è¶…æ—¶æ—¶é—´ä¸º3squeryperf -s 192.168.1.1 -p 5353 -d query.domain.list -T 1000 -t 3 2ã€å‹æµ‹æ•°æ®2.1 æœºå™¨ç¡¬ä»¶é…ç½® è™šæ‹Ÿæœºä¸º16æ ¸16Gé…ç½®ï¼Œå®¿ä¸»æœºä¸ºR730ï¼Œé…ç½®æ˜¯åŒè·¯E5-2640 v4+82599ä¸‡å…†ç½‘å¡ ç‰©ç†æœºä¸ºR640ï¼Œé…ç½®æ˜¯åŒè·¯é“¶ç‰ŒSilver 4114+128Gå†…å­˜+x710ä¸‡å…†ä¸‡å¡ è¿™é‡Œéœ€è¦é¢å¤–æä¸€ä¸‹ï¼ŒCoreDNSæ¯”è¾ƒåƒç½‘å¡å’ŒCPUï¼Œå¯¹äºç¡¬ç›˜IOçš„è¦æ±‚å¹¶ä¸ç®—ç‰¹åˆ«é«˜ï¼ˆä¸»è¦å–å†³äºå†™æ—¥å¿—çš„é‡ï¼‰ï¼Œå¯¹å†…å­˜å ç”¨è¾ƒä½ 2.2 CoreDNSé…ç½®CoreDNSé…ç½®çš„å¤æ‚ç¨‹åº¦ä¼šç›´æ¥å½±å“å…·ä½“å®ä¾‹çš„æ€§èƒ½è¡¨ç°ï¼Œç®€å•æ¥è¯´å°±æ˜¯å¯ç”¨çš„æ’ä»¶è¶Šå¤šï¼Œæ€§èƒ½è¡¨ç°è¶Šå·®ï¼›æ¯”è¾ƒå½±å“æ€§èƒ½è¡¨ç°çš„æ’ä»¶ä¸»è¦æ˜¯æ—¥å¿—ç›¸å…³çš„æ’ä»¶ï¼Œå¦‚logæ’ä»¶å¼€å¯å…¨é‡æ—¥å¿—è®°å½•ï¼Œæˆ‘ä»¬æµ‹è¯•å¯ç”¨çš„æ’ä»¶ä¸»è¦æœ‰ï¼šlogã€errorsã€bindã€reloadã€readyã€prometheusã€loadbalanceã€cacheã€aclã€secondaryã€transferã€hostsã€forwardã€importã€fileã€kubernetesã€‚ 2.3 æ•°æ®æ±‡æ€» æœºå™¨é…ç½® CoreDNSé…ç½® æ€§èƒ½è¡¨ç° è™šæ‹Ÿæœº å¤šæ’ä»¶é…ç½®+å…¨é‡æ—¥å¿—è®°å½• 30K qps ç‰©ç†æœº å¤šæ’ä»¶é…ç½®+å…¨é‡æ—¥å¿—è®°å½• 55K qps ç‰©ç†æœº å¤šæ’ä»¶é…ç½®+å…³é—­logå’Œerroræ’ä»¶ 70K qps ç‰©ç†æœº æœ€å°‘æ’ä»¶é…ç½® 75K qps 2.4 Q&amp;A è™šæ‹Ÿæœºå’Œç‰©ç†æœºæ•°æ®å·®è·å¹¶ä¸ç®—ç‰¹åˆ«å¤§ï¼Ÿ é¦–å…ˆè¦æ˜ç¡®ï¼šCoreDNSå¹¶æ²¡æœ‰å®Œå…¨åƒæ»¡ç‰©ç†æœºä¸Šé¢çš„æ‰€æœ‰ç¡¬ä»¶é…ç½®ï¼Œå› æ­¤åœ¨ç‰©ç†æœºè¿™é‡Œçš„æ€§èƒ½è¡¨ç°ç“¶é¢ˆå¤„äºCoreDNSæœ¬èº«ï¼Œè€Œè™šæ‹Ÿæœºçš„æ€§èƒ½è¡¨ç°ç“¶é¢ˆæ‰æ˜¯ç¡¬ä»¶é…ç½®ï¼› å…¶æ¬¡è¦çŸ¥é“ï¼šæˆ‘ä»¬çš„è™šæ‹Ÿæœºç›¸äº’ä¹‹é—´çš„å½±å“æ¯”è¾ƒä¸¥é‡ï¼Œ30K qpsçš„æ€§èƒ½è¡¨ç°æ˜¯åŒå®¿ä¸»æœºä¸Šé¢çš„å…¶ä»–è™šæ‹ŸæœºåŸºæœ¬å¤„äºæ‘¸é±¼çŠ¶æ€ï¼Œç”±äºå®¿ä¸»æœºèµ„æºè¶…å”®ä¸¥é‡ï¼Œä¸€æ—¦å…¶ä»–è™šæ‹Ÿæœºåˆ©ç”¨ç‡è¿‡é«˜ï¼Œå¿…ç„¶ä¼šå½±å“æ€§èƒ½è¡¨ç°ï¼›è€Œä½¿ç”¨ç‰©ç†æœºåˆ™ä¸ç”¨æ‹…å¿ƒè¿™ç±»é—®é¢˜ï¼› logæ’ä»¶å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ logæ’ä»¶å¯¹æ€§èƒ½çš„å½±å“ç¡®å®è¾ƒå¤§ï¼Œä½†æ˜¯ä»…é™äºå…¨é‡å†™å…¥æŸ¥è¯¢æ—¥å¿—çš„æ—¶å€™ï¼Œå¦‚æœå¯¹æ™®é€šçš„æŸ¥è¯¢æ—¥å¿—çš„éœ€æ±‚ä½äºæ€§èƒ½éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘åªé…ç½®éƒ¨åˆ†ç‰¹æ®Šç±»å‹æ—¥å¿—ï¼Œå¦‚åªè®°å½•é”™è¯¯æ—¥å¿—log denial errorï¼› è¿˜æœ‰äº›åŒå­¦å¯èƒ½ä¼šæ‹…å¿ƒæ—¥å¿—è½ç›˜é€Ÿåº¦æ…¢æ˜¯å¦ä¼šå½±å“æŸ¥è¯¢å“åº”é€Ÿåº¦ï¼Œå®æµ‹åœ¨ä½¿ç”¨rsyslogè®°å½•æ—¥å¿—çš„æ—¶å€™ï¼Œæ‰€æœ‰æŸ¥è¯¢è¯·æ±‚å‡å“åº”å®Œä¹‹åä¸€æ®µæ—¶å€™å†…ï¼Œrsyslogè¿˜åœ¨è½ç›˜ç›¸å…³æ—¥å¿—ï¼Œå› æ­¤å¯ä»¥ç¡®å®šé€»è¾‘ä¸Šå¹¶éæ˜¯å¿…é¡»è¦ç­‰æ—¥å¿—è½ç›˜ç»“æŸåæ‰å“åº”è¯·æ±‚ï¼› Prometheusæ’ä»¶é‡‡é›†åˆ°çš„æ•°æ®å’Œqueryperfçš„æ•°æ®ä¸ä¸€è‡´ï¼Ÿ å¦‚æœå‹æµ‹çš„æ—¶é—´å¤ªçŸ­ï¼ˆå‡ ç§’åˆ°å‡ åˆ†é’Ÿä¸ç­‰ï¼‰ï¼Œä¼šå¯¼è‡´é«˜å³°æ—¶é—´æŒç»­å¤ªçŸ­è€ŒPrometheusæ’ä»¶æ— æ³•å‡†ç¡®æš´éœ²æ•°æ®ï¼ŒåŒæ—¶è¿˜è¦è€ƒè™‘PrometheusæœåŠ¡ç«¯çš„é‡‡é›†é¢‘ç‡å·²ç»Grafanaé¢æ¿çš„æ˜¾ç¤ºè®¾ç½®ç­‰ï¼›æœ€å¥½çš„æ–¹å¼æ˜¯è¿›è¡Œä¸€æ®µæ—¶é—´è¾ƒé•¿çš„å‹æµ‹ï¼Œå¦‚ä¸‰ååˆ†é’Ÿä»¥ä¸Šï¼›","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"coredns","slug":"coredns","permalink":"https://tinychen.com/tags/coredns/"},{"name":"queryperf","slug":"queryperf","permalink":"https://tinychen.com/tags/queryperf/"}]},{"title":"CoreDNSç¯‡6-é€’å½’æœåŠ¡å™¨","slug":"20220220-dns-09-coredns-06-recursive-dns","date":"2022-02-20T15:00:00.000Z","updated":"2022-02-20T15:00:00.000Z","comments":true,"path":"20220220-dns-09-coredns-06-recursive-dns/","link":"","permalink":"https://tinychen.com/20220220-dns-09-coredns-06-recursive-dns/","excerpt":"æœ¬æ–‡ä¸»è¦ç”¨äºä»‹ç»CoreDNSå®ç°é€’å½’æœåŠ¡å™¨çš„å‡ ç§æ–¹å¼ä»¥åŠåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚","text":"æœ¬æ–‡ä¸»è¦ç”¨äºä»‹ç»CoreDNSå®ç°é€’å½’æœåŠ¡å™¨çš„å‡ ç§æ–¹å¼ä»¥åŠåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚ åœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€äº›å…³äºCoreDNSçš„åŸºæœ¬çŸ¥è¯†ï¼šCoreDNSæœ¬èº«æ˜¯æ²¡æœ‰èƒ½åŠ›ä½œä¸ºä¸€ä¸ªé€’å½’æŸ¥è¯¢çš„DNSæœåŠ¡å™¨ï¼ˆRecursive DNSï¼‰ï¼Œä½†æ˜¯å®ƒæœ‰ç€ä¼—å¤šçš„æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶æ¥å®ç°å¯¹åŸŸåçš„é€’å½’æŸ¥è¯¢å’Œç¼“å­˜ç­‰åŠŸèƒ½ä»è€ŒåŠ é€Ÿå®¢æˆ·ç«¯çš„DNSæŸ¥è¯¢æ€§èƒ½ã€‚è¿™é‡Œä¸»è¦å®ç°çš„æ’ä»¶æœ‰å†…éƒ¨æ’ä»¶ï¼ˆPluginsï¼‰forwardæˆ–å¤–éƒ¨æ’ä»¶ï¼ˆExternal Pluginsï¼‰unboundã€‚ CoreDNSå®˜æ–¹å¯¹External Pluginsçš„æè¿°ä¸ºï¼š Out of tree plugins for CoreDNS. A plugin listed here is not automatically endorsed by the CoreDNS team. Issues should be reported to owner(s) of the plugin. æˆ‘ä»¬å¯ä»¥å°†CoreDNSçš„External Pluginsç®€å•ç†è§£ä¸ºç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œä½†æ˜¯å…¶ä¸­å°‘éƒ¨åˆ†ä¼šæœ‰å®˜æ–¹çš„ç»´æŠ¤æ”¯æŒæˆ–è€…æ˜¯ç›´æ¥é»˜è®¤å†…ç½®åœ¨å®˜æ–¹ç¼–è¯‘å¥½çš„ç‰ˆæœ¬ä¸­ã€‚ 1ã€unboundæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä¸ä¾é å¤–éƒ¨ç¨‹åºå®ç°é€’å½’æŸ¥è¯¢åŠŸèƒ½çš„unboundæ’ä»¶ï¼Œunboundæ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„DNSè½¯ä»¶ï¼Œä¸“æ³¨äºé€’å½’æŸ¥è¯¢å’Œç¼“å­˜ï¼Œä½†å¯¹äºæƒå¨DNSæœåŠ¡å™¨è¿™æ–¹é¢çš„åŠŸèƒ½ç¨æ˜¾ä¸è¶³ï¼Œå› æ­¤ç†è®ºä¸Šå°†unboundå’ŒCoreDNSç»“åˆå°±å¯ä»¥å¾ˆå¥½çš„å¼¥è¡¥ä¸¤è€…çš„ä¸è¶³ã€‚ 1.1 ç¼–è¯‘å®‰è£…unboundæ’ä»¶çš„ç¼–è¯‘å®‰è£…ç¨æ˜¾éº»çƒ¦ï¼Œæ­¤å‰çš„æ–‡ç« ä¸­æœ‰è¯¦ç»†ä»‹ç»æ“ä½œæ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ç¼–è¯‘å®‰è£…äº†unboundæ’ä»¶çš„CoreDNSä¼šä»åŸæ¥çš„é™æ€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå˜æˆäº†éœ€è¦åŠ¨æ€åŠ è½½ä¾èµ–åº“ã€‚å› æ­¤å¦‚æœéœ€è¦æå‰ç¼–è¯‘ç„¶åå¤§èŒƒå›´ä½¿ç”¨ï¼Œæœ€å¥½ä¿è¯ç¼–è¯‘ç¯å¢ƒçš„ç³»ç»Ÿå’Œæœ€ç»ˆçš„ä½¿ç”¨ç¯å¢ƒç³»ç»Ÿä¸€è‡´æˆ–å…¨å…¼å®¹ã€‚ 1.2 ä¸€äº›é—®é¢˜unboundæ’ä»¶å·²ç»å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰æ›´æ–°ç»´æŠ¤äº†ï¼Œå°½ç®¡å®ƒæœ‰Maintained by CoreDNSçš„æ ‡æ³¨ï¼Œå› æ­¤å¦‚æœä½¿ç”¨è¾ƒæ–°ç‰ˆæœ¬çš„goç¼–è¯‘ä¹‹åï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šæœ‰æŠ¥è­¦ã€‚ 1Jan 18 02:29:16 coredns1 coredns: [WARNING] An external plugin (/home/gopath/pkg/mod/github.com/coredns/unbound@v0.0.7/setup.go line 63) is using the deprecated function Normalize. This will be removed in a future versions of CoreDNS. The plugin should be updated to use OriginsFromArgsOrServerBlock or NormalizeExact instead. å¦å¤–å°±æ˜¯åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¼šå‡ºç°panicå¼‚å¸¸ï¼Œä¸€å¼€å§‹æ€€ç–‘æ˜¯å’Œè´Ÿè½½æœ‰å…³ï¼Œåé¢æµ‹è¯•å‘ç°å½“è¯·æ±‚é‡æä½ï¼ˆä¸ªä½æ•°qpsï¼‰çš„æ—¶å€™ä¹Ÿä¼šå‡ºç°æ­¤ç±»å¼‚å¸¸ã€‚ 1234567891011[tinychen /home/coredns]# ./coredns -dns.port=53 -conf /home/coredns/corefile.:53 on 0.0.0.0CoreDNS-1.8.3linux/amd64, go1.16.4, 7b43d042-dirty[INFO] 127.0.0.1:46007 - 37929 &quot;A IN baidu.com. udp 50 false 4096&quot; NOERROR qr,rd,ra 484 0.614542s[INFO] 127.0.0.1:32946 - 43201 &quot;A IN baidu.com. udp 50 false 4096&quot; NOERROR qr,aa,rd,ra 484 0.0000971s[INFO] 127.0.0.1:38201 - 44652 &quot;A IN baidu.com. udp 50 false 4096&quot; NOERROR qr,aa,rd,ra 484 0.0001522s[INFO] 127.0.0.1:50863 - 63692 &quot;A IN tinychen.com. udp 53 false 4096&quot; NOERROR qr,rd,ra 58 0.3613896s[ERROR] Recovered from panic in server: &quot;dns://0.0.0.0:53&quot;[ERROR] Recovered from panic in server: &quot;dns://0.0.0.0:53&quot;[ERROR] Recovered from panic in server: &quot;dns://0.0.0.0:53&quot; ç»è¿‡å¤šæ¬¡æµ‹è¯•ä¹‹åï¼Œæˆ‘ä»¬å‘ç°é’ˆå¯¹unboundæ’ä»¶å‡ºç°panicçš„æƒ…å†µå’Œè¯·æ±‚çš„é¢‘ç‡æ— å…³ï¼Œè€Œæ˜¯å’Œè¯·æ±‚çš„å†…å®¹æœ‰å…³ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼šå½“è¯·æ±‚çš„åŸŸåæœ¬èº«å°±ä¸å­˜åœ¨è§£æçš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘panicå¼‚å¸¸ï¼›å½“ç„¶è¿˜å¯ä»¥å†è¿›ä¸€æ­¥ï¼šå½“CoreDNSæœåŠ¡ç«¯æœ¬èº«æ— æ³•å’Œæ ¹åŸŸåæœåŠ¡å™¨å»ºç«‹è¿æ¥è½¬å‘æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¹Ÿä¼šå‡ºç°panicå¼‚å¸¸ã€‚ 2ã€forward2.1 é…ç½®ä½¿ç”¨forwardæ’ä»¶ä¸»è¦çš„ä½œç”¨å°±æ˜¯æŠŠDNSè¯·æ±‚è½¬å‘ç»™ä¸Šæ¸¸çš„upstreamæœåŠ¡å™¨ã€‚forwardæ’ä»¶æœ¬èº«å¹¶ä¸æ”¯æŒä»»ä½•çš„DNSè§£æåŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥å°†ç›¸åº”çš„è¯·æ±‚è½¬å‘åˆ°é€’å½’æœåŠ¡å™¨ä¸Šï¼Œå†ç»“åˆcacheæ’ä»¶åšç¼“å­˜ï¼Œä»è€Œå®ç°é€’å½’æŸ¥è¯¢è§£æç¼“å­˜çš„åŠŸèƒ½ã€‚ 12345678910111213.:53 &#123; forward . 114.114.114.114 114.114.115.115 &#123; health_check 5s &#125; log errors ready prometheus cache &#123; success 10240 600 60 denial 5120 60 5 &#125;&#125; forwardå¯¹åº”çš„upstreamæœºå™¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ç°æœ‰çš„å…¬å…±DNSï¼Œå¦‚å›½å†…å¸¸è§çš„114ã€è°·æ­Œçš„8888ç­‰å…è´¹DNSï¼Œæˆ–è€…é€‰æ‹©è‡ªå·±ä½¿ç”¨unboundã€bind9ä¹‹ç±»çš„DNSæœåŠ¡å™¨å•ç‹¬æ­å»ºä¸€ä¸ªä¸“é—¨ç”¨æ¥åšé€’å½’æŸ¥è¯¢çš„DNSæœåŠ¡ã€‚ 2.2 ä¸€äº›é—®é¢˜1Jan 18 05:29:16 coredns1 coredns: [ERROR] plugin/errors: 2 nonexist.test.tinychen.com. A: read udp 127.0.0.1:7522-&gt;114.114.114.114:53: i/o timeout å½“æŸ¥è¯¢çš„åŸŸåè§£æè®°å½•ä¸å­˜åœ¨æˆ–è€…æ˜¯ç½‘ç»œé—®é¢˜ä¸å¯è¾¾çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè§¦å‘upstreamçš„è¶…æ—¶æ—¶é—´é™åˆ¶ï¼Œå¯¼è‡´æŠ¥é”™i/o timeoutï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨erroræ’ä»¶çš„consolidateæŒ‡ä»¤å¯¹è¿™ç±»æŠ¥è­¦è¿›è¡Œç»Ÿä¸€å¤„ç†å¹¶ä¿®æ”¹æŠ¥è­¦ç­‰çº§ 123errors &#123; consolidate 5m &quot;.* i/o timeout$&quot; warning&#125;","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"coredns","slug":"coredns","permalink":"https://tinychen.com/tags/coredns/"},{"name":"unbound","slug":"unbound","permalink":"https://tinychen.com/tags/unbound/"}]},{"title":"CoreDNSç¯‡5-æ—¥å¿—å¤„ç†","slug":"20220114-dns-08-coredns-05-log","date":"2022-01-14T03:00:00.000Z","updated":"2022-01-14T03:00:00.000Z","comments":true,"path":"20220114-dns-08-coredns-05-log/","link":"","permalink":"https://tinychen.com/20220114-dns-08-coredns-05-log/","excerpt":"æœ¬æ–‡ä¸»è¦ç”¨äºä»‹ç»CoreDNSç”¨æ¥è®°å½•æ—¥å¿—çš„å‡ ç§æ–¹å¼ä»¥åŠåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚","text":"æœ¬æ–‡ä¸»è¦ç”¨äºä»‹ç»CoreDNSç”¨æ¥è®°å½•æ—¥å¿—çš„å‡ ç§æ–¹å¼ä»¥åŠåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚ 1ã€logæ’ä»¶corednsçš„æ—¥å¿—è¾“å‡ºå¹¶ä¸å¦‚nginxé‚£ä¹ˆå®Œå–„ï¼ˆå¹¶ä¸èƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶ç›®å½•ï¼Œä½†æ˜¯å¯ä»¥æŒ‡å®šæ—¥å¿—çš„æ ¼å¼ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸è®ºæ˜¯logæ’ä»¶è¿˜æ˜¯erroræ’ä»¶éƒ½ä¼šæŠŠæ‰€æœ‰çš„ç›¸å…³æ—¥å¿—è¾“å‡ºåˆ°ç¨‹åºçš„standard outputä¸­ã€‚ä½¿ç”¨systemdæ¥ç®¡ç†corednsä¹‹åï¼Œé»˜è®¤æƒ…å†µä¸‹åŸºæœ¬å°±æ˜¯ç”±rsyslogå’Œsystemd-journaldè¿™ä¸¤ä¸ªæœåŠ¡æ¥ç®¡ç†æ—¥å¿—ã€‚ 1.1 logæ’ä»¶é…ç½®å‰é¢çš„æ–‡ç« é‡Œæˆ‘ä»¬æœ‰ç®€å•çš„ä»‹ç»è¿‡corednsçš„æ—¥å¿—å¤„ç†ï¼Œå¯¹äºlogæ’ä»¶ä¹Ÿæ˜¯ç±»ä¼¼çš„æ“ä½œã€‚è€ƒè™‘åˆ°CentOS8å·²ç»ç»“æŸæ”¯æŒï¼Œè¿™é‡Œä»…ä»‹ç»CentOS7çš„é…ç½®æ–¹æ³•ï¼Œæ›´é«˜ç‰ˆæœ¬çš„systemdå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ã€‚ å¯¹äºcentos7ç­‰ç³»ç»Ÿè€Œè¨€ï¼Œæ˜¯ä¸æ”¯æŒåœ¨é«˜ç‰ˆæœ¬çš„systemdä¸­çš„unitæ–‡ä»¶ä¸­ä½¿ç”¨appendå’Œfileä¸¤ä¸ªå‚æ•°çš„ï¼Œå¹¶ä¸”å¯¹äºè¿™ç§æ–¹å¼è¾“å‡ºçš„æ—¥å¿—ç¼ºå°‘äº†å‰é¢çš„æ—¶é—´å’Œä¸»æœºåç­‰ä¿¡æ¯ï¼Œç›¸å¯¹è€Œè¨€è¿˜æ˜¯ä¿®æ”¹rsyslogçš„æ–¹å¼è¦æ›´åŠ çš„å¯é ã€‚é‚£ä¹ˆåœ¨å¼€å¯äº†rsyslog.serviceæœåŠ¡çš„æƒ…å†µä¸‹ï¼Œæ—¥å¿—å°±ä¼šè¾“å‡ºåˆ°/var/log/messagesæ–‡ä»¶ä¸­ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨journalctl -u corednså‘½ä»¤æ¥æŸ¥çœ‹å…¨éƒ¨çš„æ—¥å¿—ã€‚ å¦‚æœæƒ³è¦å°†corednsçš„æ—¥å¿—å…¨éƒ¨é›†ä¸­åˆ°ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è´Ÿè´£ç®¡ç†systemdçš„æ—¥å¿—çš„rsyslogæœåŠ¡çš„é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œç„¶åå†é‡å¯rsyslogæœåŠ¡å³å¯ç”Ÿæ•ˆã€‚ 1234567# æ³¨æ„è¿™æ®µé…ç½®éœ€è¦æ·»åŠ åœ¨å…¶ä»–æ—¥å¿—é…ç½®è§„åˆ™ä¹‹å‰# å¦åˆ™æ—¥å¿—ä¼šåœ¨/var/log/messageså’Œ/home/coredns/logs/coredns.logéƒ½å†™å…¥ä¸€ä»½[root@tiny-server coredns]# vim /etc/rsyslog.confif $programname == &#x27;coredns&#x27; then /home/coredns/logs/coredns.log&amp; stop[root@tiny-server coredns]# systemctl restart rsyslog.service ä½†æ˜¯æœ‰ä¸¤ç‚¹éœ€è¦é¢å¤–æ³¨æ„ï¼š CoreDNSåœ¨å¼€å¯æ—¥å¿—è®°å½•ä¹‹åçš„æ€§èƒ½è¦å·®äºä¸å¼€å¯æ—¥å¿—è®°å½•ï¼Œè¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºè®°å½•æ—¥å¿—éœ€è¦è€—è´¹é¢å¤–çš„èµ„æºï¼Œå°¤å…¶æ˜¯å½“QPSå¢å¤§ä¹‹åï¼Œè®°å½•æ—¥å¿—ç»„ä»¶çš„å‹åŠ›ä¹Ÿä¼šå¢å¤§ï¼Œéœ€è¦æ³¨æ„ä¸¤ä¸ªæœåŠ¡å¯¹èµ„æºçš„æŠ¢å å’Œåˆ†é…æ˜¯å¦åˆç†ï¼›å¦‚æœé‡åˆ°å†™å…¥æ—¥å¿—å ç”¨å¤§é‡èµ„æºçš„æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘å°†å…¶é…ç½®ä¸ºåªå†™å…¥éƒ¨åˆ†ç±»å‹æ—¥å¿—ï¼ˆå¦‚åªå†™å…¥é”™è¯¯æ—¥å¿—ï¼‰ rsyslogå’Œsystemd-journaldè¿™ä¸¤ä¸ªæœåŠ¡é»˜è®¤æƒ…å†µä¸‹éƒ½ä¼šå¯¹æ—¥å¿—çš„å†™å…¥é¢‘ç‡è¿›è¡Œé™åˆ¶ï¼Œå½“QPSå¢å¤§ä¹‹åï¼Œè®°å½•çš„æ—¥å¿—ä¼šä¸å®Œæ•´ï¼›å½“ç„¶è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡è°ƒæ•´rsyslogçš„å‚æ•°è§£å†³ 1.2 rsyslogé…ç½®ä¸‹é¢å…·ä½“ä»‹ç»ä¸€ä¸‹å¦‚ä½•é…ç½®rsyslogå’Œsystemd-journaldè§£é™¤ç›¸å…³çš„æ—¥å¿—é™åˆ¶ã€‚ é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬æŸ¥çœ‹systemd-journald.serviceçš„æ—¥å¿—æˆ–è€…æ˜¯æŸ¥çœ‹/var/log/messagesæ–‡ä»¶ï¼Œå¦‚æœçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„æç¤ºä¿¡æ¯ï¼Œå°±è¯´æ˜æ—¥å¿—çš„è¾“å‡ºé¢‘ç‡å¤ªé«˜è¢«æŠ‘åˆ¶äº† 123456789101112131415161718192021222324[root@tiny-server coredns]# systemctl status systemd-journald.serviceâ— systemd-journald.service - Journal Service Loaded: loaded (/usr/lib/systemd/system/systemd-journald.service; static; vendor preset: disabled) Active: active (running) since Wed 2021-12-01 09:30:03 CST; 3 weeks 6 days ago Docs: man:systemd-journald.service(8) man:journald.conf(5) Main PID: 709 (systemd-journal) Status: &quot;Processing requests...&quot; CGroup: /system.slice/systemd-journald.service â””â”€709 /usr/lib/systemd/systemd-journaldDec 28 15:36:27 tiny-server systemd-journal[709]: Suppressed 13174 messages from /system.slice/coredns.serviceDec 28 15:36:57 tiny-server systemd-journal[709]: Suppressed 13185 messages from /system.slice/coredns.serviceDec 28 15:37:27 tiny-server systemd-journal[709]: Suppressed 11600 messages from /system.slice/coredns.serviceDec 28 15:37:57 tiny-server systemd-journal[709]: Suppressed 13896 messages from /system.slice/coredns.serviceDec 28 15:38:27 tiny-server systemd-journal[709]: Suppressed 13653 messages from /system.slice/coredns.serviceDec 28 15:38:57 tiny-server systemd-journal[709]: Suppressed 16503 messages from /system.slice/coredns.serviceDec 28 15:39:27 tiny-server systemd-journal[709]: Suppressed 13300 messages from /system.slice/coredns.serviceDec 28 15:39:57 tiny-server systemd-journal[709]: Suppressed 10491 messages from /system.slice/coredns.serviceDec 28 15:40:27 tiny-server systemd-journal[709]: Suppressed 12079 messages from /system.slice/coredns.serviceDec 28 15:40:57 tiny-server systemd-journal[709]: Suppressed 17182 messages from /system.slice/coredns.service[root@tiny-server coredns]# tail -f /var/log/messagesDec 28 15:43:55 tiny-server rsyslogd: imjournal: begin to drop messages due to rate-limiting è§£å†³æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªæœåŠ¡çš„é…ç½®å‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œå°†é™åˆ¶æ—¥å¿—å†™å…¥é¢‘ç‡å’Œå†™å…¥æ—¶é—´é—´éš”éƒ½è®¾ä¸º0ï¼ˆå³ä¸åšé™åˆ¶ï¼‰ï¼Œç„¶åé‡å¯æœåŠ¡å³å¯ã€‚ 1234567echo &quot;RateLimitInterval=0&quot; &gt;&gt; /etc/systemd/journald.confecho &quot;RateLimitBurst=0&quot; &gt;&gt; /etc/systemd/journald.confsystemctl restart systemd-journald.service echo &quot;\\$imjournalRatelimitInterval 0&quot; &gt;&gt; /etc/rsyslog.confecho &quot;\\$imjournalRatelimitBurst 0&quot; &gt;&gt; /etc/rsyslog.confsystemctl restart rsyslog.service éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šä¸Šè¿°ä¸¤ä¸ªå‚æ•°å¯¹æ‰€æœ‰ä½¿ç”¨rsyslogçš„æœåŠ¡éƒ½ä¼šç”Ÿæ•ˆï¼Œå¦‚æœæœ‰å…¶ä»–å¤§é‡å†™å…¥æ—¥å¿—çš„æœåŠ¡ï¼Œå»ºè®®è°ƒæ•´æ—¥å¿—æ–‡ä»¶è¾“å‡ºç›®å½•ï¼ŒåŒæ—¶å…³æ³¨/var/logç­‰ç›®å½•çš„ç¡¬ç›˜ç©ºé—´æƒ…å†µã€‚ 2ã€dnstapæ’ä»¶CoreDNSçš„åŸç”Ÿæ—¥å¿—åŠŸèƒ½å¯¹äºä¸€ä¸ªDNSæœåŠ¡å™¨çš„ç»å¤§éƒ¨åˆ†åº”ç”¨åœºæ™¯æ¥è¯´æ˜¯è¶³å¤Ÿä½¿ç”¨çš„ï¼Œå¦‚æœæœ‰æ›´è¿›é˜¶çš„éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨dnstapæ’ä»¶æ¥å®ç°ã€‚ dnstapæ˜¯ä¸€ä¸ªåŸºäºè°·æ­Œçš„ç¼“å†²åŒºåè®®ï¼ˆProtocol buffersï¼‰å®ç°çš„ç”¨äºDNSçš„çµæ´»çš„ã€ç»“æ„åŒ–çš„ã€äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼è®°å½•è½¯ä»¶ï¼Œç›®å‰å·²ç»è·å¾—äº†bind9ã€unboundã€corednsã€knotç­‰å‡ ä¹æ‰€æœ‰ä¸»æµdnsè½¯ä»¶çš„æ”¯æŒã€‚dnstapç›®å‰æ”¯æŒäºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ã€textæ—¥å¿—æ ¼å¼ã€yamlæ—¥å¿—æ ¼å¼å’Œjsonæ—¥å¿—æ ¼å¼ã€‚ CoreDNSå®˜ç½‘å¯¹äºdnstapæ’ä»¶çš„ä»‹ç»æ¯”è¾ƒç®€å•ï¼Œä¸è¿‡å®˜ç½‘é¡µé¢æœ‰æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ã€‚ dnstap is a flexible, structured binary log format for DNS software. It uses Protocol Buffers to encode events that occur inside DNS software in an implementation-neutral format. Currently dnstap can only encode wire-format DNS messages. It is planned to support additional types of DNS log information. Protocol buffers are Googleâ€™s language-neutral, platform-neutral, extensible mechanism for serializing structured data â€“ think XML, but smaller, faster, and simpler. You define how you want your data to be structured once, then you can use special generated source code to easily write and read your structured data to and from a variety of data streams and using a variety of languages. ç¼“å†²åŒºåè®®ï¼ˆProtocol buffersï¼‰æ˜¯ Google ç”¨äºåºåˆ—åŒ–ç»“æ„æ•°æ®çš„è¯­è¨€ä¸­ç«‹ã€å¹³å°ä¸­ç«‹ã€å¯æ‰©å±•æœºåˆ¶ã€‚å¯ä»¥å°†å…¶å’ŒXMLç›¸å¯¹æ¯”ï¼Œä½†Protocol buffersæ›´å°ã€æ›´å¿«ã€æ›´ç®€å•ã€‚ ä½¿ç”¨è€…åªéœ€å®šä¹‰ä¸€æ¬¡æ•°æ®çš„ç»“æ„åŒ–æ–¹å¼ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨ç‰¹æ®Šç”Ÿæˆçš„æºä»£ç è½»æ¾åœ°å°†ç»“æ„åŒ–æ•°æ®å†™å…¥å’Œè¯»å–å„ç§æ•°æ®æµï¼Œå¹¶ä½¿ç”¨å„ç§è¯­è¨€ã€‚ è¿™é‡Œéœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯ï¼š dnstapå’ŒCoreDNSåŸç”Ÿçš„logç­‰æ—¥å¿—è®°å½•æ’ä»¶å¯ä»¥åŒæ—¶ä½¿ç”¨ å°½ç®¡CoreDNSé»˜è®¤å†…ç½®dnstapæ’ä»¶ï¼Œä½†æ˜¯è¦ä½¿ç”¨dnstapè¿˜æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å®‰è£…dnstapï¼Œå†åˆ°corefileä¸­é…ç½®dnstapçš„socketè·¯å¾„æˆ–è€…é€šä¿¡ç«¯å£æ‰èƒ½ä½¿ç”¨ 2.1 dnstapå®‰è£…dnstapå®˜æ–¹åœ¨githubä¸Šé¢å¼€æºäº†ä¸€ä¸ªgolang-dnstapçš„é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨goæ¥å¿«é€Ÿå®‰è£…dnstap 12345678910111213# golangçš„å®‰è£…é…ç½®æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä»https://go.dev/dl/ç›´æ¥ä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬å³å¯ã€‚wget https://go.dev/dl/go1.17.5.linux-amd64.tar.gztar -zxvf go1.17.5.linux-amd64.tar.gz -C /usr/local# ä¿®æ”¹ç³»ç»Ÿé»˜è®¤çš„goæ–‡ä»¶ln -s /usr/local/go/bin/go /usr/bin/go# æ¥ä¸‹æ¥çš„goç¯å¢ƒå˜é‡åŒå­¦ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚è¿›è¡Œé…ç½®ã€‚# å¯¹äºæˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘ç›´æ¥åœ¨/etc/profileä¸­æ·»åŠ ä¸‹é¢çš„é…ç½®ç„¶åsourceç”Ÿæ•ˆå³å¯ã€‚export GOROOT=/usr/local/goexport GOBIN=$GOROOT/binexport PATH=$PATH:$GOBINexport GOPATH=/home/gopath æ‰§è¡Œgo versionå‘½ä»¤ç¡®å®šgoå®‰è£…æ— è¯¯ä¹‹åå°±å¯ä»¥ç›´æ¥å®‰è£…dnstapï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142# æ¥ç€å°±å¯ä»¥ä½¿ç”¨goå‘½ä»¤æ¥å¿«é€Ÿå®‰è£…dnstapgo get -u github.com/dnstap/golang-dnstap/dnstap# goç‰ˆæœ¬é«˜äºv1.16å»ºè®®ä½¿ç”¨ä¸‹é¢è¿™æ¡æŒ‡ä»¤# å…³äºgo getå’Œgo installçš„åŒºåˆ«å¯ä»¥æŸ¥çœ‹goçš„å®˜æ–¹æ–‡æ¡£https://golang.org/doc/go-get-install-deprecationgo install github.com/dnstap/golang-dnstap/dnstap@latest # å¦‚æœä¸ç¡®å®šæ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å®‰è£…ä¿¡æ¯è¿›è¡Œç¡®å®š[root@coredns2 home]# dnstap --helpUsage: dnstap [OPTION]... -T value write dnstap payloads to tcp/ip address -U value write dnstap payloads to unix socket -a append to the given file, do not overwrite. valid only when outputting a text or YAML file. -j use verbose JSON output -l value read dnstap payloads from tcp/ip -q use quiet text output -r value read dnstap payloads from file -t duration I/O timeout for tcp/ip and unix domain sockets -u value read dnstap payloads from unix socket -w string write output to file -y use verbose YAML outputQuiet text output format mnemonics: AQ: AUTH_QUERY AR: AUTH_RESPONSE RQ: RESOLVER_QUERY RR: RESOLVER_RESPONSE CQ: CLIENT_QUERY CR: CLIENT_RESPONSE FQ: FORWARDER_QUERY FR: FORWARDER_RESPONSE SQ: STUB_QUERY SR: STUB_RESPONSE TQ: TOOL_QUERY TR: TOOL_RESPONSE 2.2 corednsé…ç½®corednsä¸­å¯¹dnstapçš„é…ç½®éå¸¸ç®€å•ï¼Œå¯ä»¥é€‰æ‹©é…ç½®socketé€šä¿¡æˆ–è€…æ˜¯tcpé€šä¿¡ï¼Œfullå‚æ•°åˆ™æ˜¯å¯ä»¥è®°å½•æ›´å¤šçš„å‚æ•°ä¿¡æ¯ï¼Œå¦‚åŒæ ·çš„ä¸€æ¬¡æŸ¥è¯¢ï¼Œçº¢æ¡†æ˜¯å¼€å¯äº†fullå‚æ•°ï¼Œè€Œç»¿æ¡†åˆ™æ˜¯ä¸å¼€å¯ï¼Œä¸¤è€…ç›¸å·®è¾ƒå¤§ã€‚ 1234# ä½¿ç”¨tcpé€šä¿¡dnstap tcp://127.0.0.1:6000 full# ä½¿ç”¨socketé€šä¿¡dnstap unix:///tmp/dnstap.sock full 2.3 dnstapé…ç½®dnstapçš„é…ç½®ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š æŒ‡å®šé€šä¿¡æ–¹å¼ï¼šå¦‚-u /tmp/dnstap.sockæˆ–è€…-l 127.0.0.1:6000 æŒ‡å®šæ—¥å¿—æ–‡ä»¶ï¼šå¦‚-w /home/coredns/logs/dnstap.log æŒ‡å®šæ—¥å¿—æ ¼å¼ï¼šé»˜è®¤ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œ-qä¸ºtextæ–‡æœ¬ï¼Œ-yä¸ºyamlæ ¼å¼ï¼Œ-jä¸ºjsonæ ¼å¼ å…¶ä»–å‚æ•°ï¼šå¦‚-aè¿½åŠ å†™å…¥å†…å®¹åˆ°æ—¥å¿—æ–‡ä»¶ä¸­è€Œéè¦†ç›–åŸæœ‰çš„æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133# ä½¿ç”¨socketé€šä¿¡ï¼Œå¹¶ä»¥é»˜è®¤çš„äºŒè¿›åˆ¶æ ¼å¼è®°å½•åˆ°/home/coredns/logs/dnstap.logæ–‡ä»¶ä¸­dnstap -u /tmp/dnstap.sock -w /home/coredns/logs/dnstap.log# æ­¤æ—¶æ— æ³•ç›´æ¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¸­çš„å†…å®¹[root@coredns2 logs]# tail -f /home/coredns/logs/dnstap.log&quot;\u0002\u0001\u0016protobuf:dnstap.Dnstap^C# ä½¿ç”¨socketé€šä¿¡ï¼Œå¹¶ä»¥textæ–‡æœ¬æ ¼å¼è¿½åŠ è®°å½•åˆ°/home/coredns/logs/dnstap.logæ–‡ä»¶ä¸­dnstap -u /tmp/dnstap.sock -w /home/coredns/logs/dnstap.log -q -a# è¿™é‡Œçš„corednså¯¹tinychen.comçš„æŸ¥è¯¢ä¼šforwardå‡ºå»ï¼Œ# å› æ­¤æ—¥å¿—ä¸­ä¼šæœ‰CLIENT_QUERY CLIENT_RESPONSE FORWARDER_QUERY FORWARDER_RESPONSEå››æ¡è®°å½•[root@coredns2 logs]# tail -f /home/coredns/logs/dnstap.log16:14:39.329430 CQ 10.31.100.100 UDP 53b &quot;tinychen.com.&quot; IN A16:14:39.329546 FQ 127.0.0.1 UDP 53b &quot;tinychen.com.&quot; IN A16:14:39.330241 FR 127.0.0.1 UDP 69b &quot;tinychen.com.&quot; IN A16:14:39.330441 CR 10.31.100.100 UDP 81b &quot;tinychen.com.&quot; IN A# ä½¿ç”¨socketé€šä¿¡ï¼Œå¹¶ä»¥yamlæ ¼å¼è¿½åŠ è®°å½•åˆ°/home/coredns/logs/dnstap.logæ–‡ä»¶ä¸­dnstap -u /tmp/dnstap.sock -w /home/coredns/logs/dnstap.log -y -a# è¿™é‡Œçš„corednså¯¹tinychen.comçš„æŸ¥è¯¢ä¼šforwardå‡ºå»ï¼Œ# å› æ­¤æ—¥å¿—ä¸­ä¼šæœ‰CLIENT_QUERY CLIENT_RESPONSE FORWARDER_QUERY FORWARDER_RESPONSEå››æ¡è®°å½•[root@coredns2 logs]# tail -f /home/coredns/logs/dnstap.logtype: MESSAGEmessage: type: CLIENT_QUERY query_time: !!timestamp 2022-01-12 08:23:25.211126656 socket_family: INET socket_protocol: UDP query_address: 10.31.100.100 query_port: 58562 query_message: | ;; opcode: QUERY, status: NOERROR, id: 30286 ;; flags: rd ad; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1 ;; QUESTION SECTION: ;tinychen.com. IN A ;; ADDITIONAL SECTION: ;; OPT PSEUDOSECTION: ; EDNS: version 0; flags: ; udp: 4096 ; COOKIE: 22c8a1e55b27c1b9---type: MESSAGEmessage: type: FORWARDER_QUERY query_time: !!timestamp 2022-01-12 08:23:25.211208675 socket_family: INET socket_protocol: UDP query_address: 10.31.100.100 response_address: 127.0.0.1 query_port: 58562 response_port: 35353 query_message: | ;; opcode: QUERY, status: NOERROR, id: 30286 ;; flags: rd ad; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1 ;; QUESTION SECTION: ;tinychen.com. IN A ;; ADDITIONAL SECTION: ;; OPT PSEUDOSECTION: ; EDNS: version 0; flags: do; udp: 2048 ; COOKIE: 22c8a1e55b27c1b9---type: MESSAGEmessage: type: FORWARDER_RESPONSE query_time: !!timestamp 2022-01-12 08:23:25.211208675 response_time: !!timestamp 2022-01-12 08:23:25.243335638 socket_family: INET socket_protocol: UDP query_address: 10.31.100.100 response_address: 127.0.0.1 query_port: 58562 response_port: 35353 response_message: | ;; opcode: QUERY, status: NOERROR, id: 30286 ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; QUESTION SECTION: ;tinychen.com. IN A ;; ANSWER SECTION: tinychen.com. 589 IN A 1.12.217.55 ;; ADDITIONAL SECTION: ;; OPT PSEUDOSECTION: ; EDNS: version 0; flags: do; udp: 1232---type: MESSAGEmessage: type: CLIENT_RESPONSE query_time: !!timestamp 2022-01-12 08:23:25.211126656 response_time: !!timestamp 2022-01-12 08:23:25.243503207 socket_family: INET socket_protocol: UDP query_address: 10.31.100.100 query_port: 58562 response_message: | ;; opcode: QUERY, status: NOERROR, id: 30286 ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; QUESTION SECTION: ;tinychen.com. IN A ;; ANSWER SECTION: tinychen.com. 589 IN A 1.12.217.55 ;; ADDITIONAL SECTION: ;; OPT PSEUDOSECTION: ; EDNS: version 0; flags: ; udp: 4096 ; COOKIE: 22c8a1e55b27c1b9---# ä½¿ç”¨socketé€šä¿¡ï¼Œå¹¶ä»¥yamlæ ¼å¼è¿½åŠ è®°å½•åˆ°/home/coredns/logs/dnstap.logæ–‡ä»¶ä¸­dnstap -u /tmp/dnstap.sock -w /home/coredns/logs/dnstap.log -j -a# è¿™é‡Œçš„corednså¯¹tinychen.comçš„æŸ¥è¯¢ä¼šforwardå‡ºå»ï¼Œ# å› æ­¤æ—¥å¿—ä¸­ä¼šæœ‰CLIENT_QUERY CLIENT_RESPONSE FORWARDER_QUERY FORWARDER_RESPONSEå››æ¡è®°å½•[root@coredns2 logs]# tail -f /home/coredns/logs/dnstap.log&#123;&quot;type&quot;:&quot;MESSAGE&quot;,&quot;message&quot;:&#123;&quot;type&quot;:&quot;CLIENT_QUERY&quot;,&quot;query_time&quot;:&quot;2022-01-12T08:36:41.745130199Z&quot;,&quot;socket_family&quot;:&quot;INET&quot;,&quot;socket_protocol&quot;:&quot;UDP&quot;,&quot;query_address&quot;:&quot;10.31.100.100&quot;,&quot;query_port&quot;:58561,&quot;query_message&quot;:&quot;;; opcode: QUERY, status: NOERROR, id: 5835\\n;; flags: rd ad; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\\n\\n;; QUESTION SECTION:\\n;tinychen.com.\\tIN\\t A\\n\\n;; ADDITIONAL SECTION:\\n\\n;; OPT PSEUDOSECTION:\\n; EDNS: version 0; flags: ; udp: 4096\\n; COOKIE: fd6716688b43710a\\n&quot;&#125;&#125;&#123;&quot;type&quot;:&quot;MESSAGE&quot;,&quot;message&quot;:&#123;&quot;type&quot;:&quot;FORWARDER_QUERY&quot;,&quot;query_time&quot;:&quot;2022-01-12T08:36:41.745243809Z&quot;,&quot;socket_family&quot;:&quot;INET&quot;,&quot;socket_protocol&quot;:&quot;UDP&quot;,&quot;query_address&quot;:&quot;10.31.100.100&quot;,&quot;response_address&quot;:&quot;127.0.0.1&quot;,&quot;query_port&quot;:58561,&quot;response_port&quot;:35353,&quot;query_message&quot;:&quot;;; opcode: QUERY, status: NOERROR, id: 5835\\n;; flags: rd ad; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\\n\\n;; QUESTION SECTION:\\n;tinychen.com.\\tIN\\t A\\n\\n;; ADDITIONAL SECTION:\\n\\n;; OPT PSEUDOSECTION:\\n; EDNS: version 0; flags: do; udp: 2048\\n; COOKIE: fd6716688b43710a\\n&quot;&#125;&#125;&#123;&quot;type&quot;:&quot;MESSAGE&quot;,&quot;message&quot;:&#123;&quot;type&quot;:&quot;FORWARDER_RESPONSE&quot;,&quot;query_time&quot;:&quot;2022-01-12T08:36:41.745243809Z&quot;,&quot;response_time&quot;:&quot;2022-01-12T08:36:41.83691354Z&quot;,&quot;socket_family&quot;:&quot;INET&quot;,&quot;socket_protocol&quot;:&quot;UDP&quot;,&quot;query_address&quot;:&quot;10.31.100.100&quot;,&quot;response_address&quot;:&quot;127.0.0.1&quot;,&quot;query_port&quot;:58561,&quot;response_port&quot;:35353,&quot;response_message&quot;:&quot;;; opcode: QUERY, status: SERVFAIL, id: 5835\\n;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\\n\\n;; QUESTION SECTION:\\n;tinychen.com.\\tIN\\t A\\n\\n;; ADDITIONAL SECTION:\\n\\n;; OPT PSEUDOSECTION:\\n; EDNS: version 0; flags: do; udp: 1232\\n&quot;&#125;&#125;&#123;&quot;type&quot;:&quot;MESSAGE&quot;,&quot;message&quot;:&#123;&quot;type&quot;:&quot;CLIENT_RESPONSE&quot;,&quot;query_time&quot;:&quot;2022-01-12T08:36:41.745130199Z&quot;,&quot;response_time&quot;:&quot;2022-01-12T08:36:41.837144129Z&quot;,&quot;socket_family&quot;:&quot;INET&quot;,&quot;socket_protocol&quot;:&quot;UDP&quot;,&quot;query_address&quot;:&quot;10.31.100.100&quot;,&quot;query_port&quot;:58561,&quot;response_message&quot;:&quot;;; opcode: QUERY, status: SERVFAIL, id: 5835\\n;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\\n\\n;; QUESTION SECTION:\\n;tinychen.com.\\tIN\\t A\\n\\n;; ADDITIONAL SECTION:\\n\\n;; OPT PSEUDOSECTION:\\n; EDNS: version 0; flags: ; udp: 4096\\n; COOKIE: fd6716688b43710a\\n&quot;&#125;&#125; 2.4 å…¶ä»–é—®é¢˜ç›®å‰åœ¨ä½¿ç”¨dnstapçš„è¿‡ç¨‹ä¸­å‘ç°äº†ä¸¤ä¸ªå°é—®é¢˜ï¼š dnstapæ—¥å¿—è®°å½•æ—¶é—´ä½¿ç”¨çš„æ˜¯UTCæ—¶é—´è®°å½•ï¼Œå¯¹äºå›½å†…çš„ç”¨æˆ·ï¼Œæ—¶é—´ä¸Šå°±æœ‰å…«ä¸ªå°æ—¶çš„å·®è· dnstapé™åˆ¶ç¼“å†²åŒºçš„æ¶ˆæ¯æ¡æ•°ä¸º10000æ¡ï¼Œè¶…å‡ºé™åˆ¶çš„æ¶ˆæ¯ä¸ä¼šè¢«å†™å…¥dnstapä¸­ 1234567891011121314Jan 13 20:41:56 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 196Jan 13 20:41:56 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 680Jan 13 20:41:58 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 1900Jan 13 20:41:58 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 10118Jan 13 20:41:59 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 1472Jan 13 20:41:59 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 9430Jan 13 20:42:02 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 3669Jan 13 20:42:02 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 23351Jan 13 20:42:06 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 5776Jan 13 20:42:06 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 35511Jan 13 20:42:17 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 13161Jan 13 20:42:17 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 81395Jan 13 20:42:41 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 29500Jan 13 20:42:41 coredns2 coredns: [WARNING] plugin/dnstap: Dropped dnstap messages: 180877 å¦‚æœæƒ³è¦çªç ´è¿™ä¸ªé™åˆ¶ï¼Œå¯ä»¥è€ƒè™‘åœ¨ç¼–è¯‘çš„æ—¶å€™ä¿®æ”¹æºç  12345678910# githubåœ°å€# https://github.com/coredns/coredns/blob/master/plugin/dnstap/io.goconst ( tcpWriteBufSize = 1024 * 1024 // there is no good explanation for why this number has this value. queueSize = 10000 // idem. tcpTimeout = 4 * time.Second flushTimeout = 1 * time.Second) 3ã€errorsæ’ä»¶3.1 errorsæ’ä»¶ç®€ä»‹CoreDNSå®˜æ–¹æœ‰å¯¹errorsæ’ä»¶æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»å’Œä½¿ç”¨è¯´æ˜ï¼Œç®€å•æ¥è¯´errorsæ’ä»¶å°±æ˜¯ä¸“é—¨ç”¨æ¥è®°å½•é”™è¯¯ä¿¡æ¯æ—¥å¿—çš„ä¸€ä¸ªç»„ä»¶ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š å¹¶ä¸æ˜¯ä¸ä½¿ç”¨errorsæ’ä»¶ï¼Œæ—¥å¿—ä¸­å°±ä¸ä¼šè¾“å‡º[ERROR]çº§åˆ«çš„æ—¥å¿—ï¼›å…¶ä»–çš„æ’ä»¶å’ŒCoreDNSæœ¬èº«ä¹Ÿæ˜¯å¯ä»¥è¾“å‡º[ERROR]çº§åˆ«çš„æ—¥å¿— errorsæ’ä»¶é»˜è®¤æƒ…å†µä¸‹è¾“å‡ºçš„æ—¥å¿—çº§åˆ«éƒ½æ˜¯[ERROR]ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡consolidateå‘½ä»¤è¿›è¡Œå®šä¹‰ 3.2 errorsæ’ä»¶é…ç½®errorsçš„é…ç½®éå¸¸ç®€å•ï¼Œä½ç½®å’Œlogæ’ä»¶ä¸€æ · 12345678910.:53 &#123; forward . 127.0.0.1:35353 log errors cache &#123; success 10240 600 60 denial 5120 60 5 &#125;&#125; å¼€å¯å‰åçš„å¯¹æ¯”å¦‚ä¸‹ï¼š 123456# ä¸å¼€å¯erroræ’ä»¶Jan 14 11:50:12 coredns2 coredns: [INFO] 10.31.53.2:36586 - 34882 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 1.001413555s# å¼€å¯erroræ’ä»¶Jan 14 11:50:33 coredns2 coredns: [INFO] 10.31.53.2:33796 - 62387 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 1.001076641sJan 14 11:50:33 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:57591-&gt;127.0.0.1:35353: read: connection refused å½“ç„¶è¿˜å¯ä»¥æœ‰ç±»ä¼¼æ­£åˆ™çš„é…ç½®æ–¹å¼å¯ä»¥ç®€åŒ–æ—¥å¿—è¾“å‡ºï¼ŒåŒæ—¶å®šä¹‰ 12345errors &#123; consolidate 30s &quot;.* connection refused$&quot; warning consolidate 5m &quot;.* i/o timeout$&quot; warning consolidate 30s &quot;^Failed to .+&quot;&#125; è¿™æ ·å­å¯ä»¥æŠŠå¤šæ¡é”™è¯¯æ—¥å¿—åˆå¹¶è¾“å‡ºï¼Œç»“æœå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# åˆå¹¶é”™è¯¯æ—¥å¿—ä¹‹å‰ï¼Œæ¯æ¬¡é”™è¯¯æ—¥å¿—éƒ½ä¼šå•ç‹¬è¾“å‡ºï¼Œæ—¥å¿—çº§åˆ«é»˜è®¤å‡ä¸º[ERROR]Jan 14 14:29:31 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:53697-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:32 coredns2 coredns: [INFO] 10.31.53.2:38422 - 21429 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000386185sJan 14 14:29:32 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:34774-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:33 coredns2 coredns: [INFO] 10.31.53.2:44775 - 40543 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000418209sJan 14 14:29:33 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:51575-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:33 coredns2 coredns: [INFO] 10.31.53.2:41858 - 30773 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000285244sJan 14 14:29:33 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:54027-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:34 coredns2 coredns: [INFO] 10.31.53.2:56657 - 31457 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000280881sJan 14 14:29:34 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:59189-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:34 coredns2 coredns: [INFO] 10.31.53.2:48445 - 29130 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000399419sJan 14 14:29:34 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:35171-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:35 coredns2 coredns: [INFO] 10.31.53.2:42290 - 310 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000359849sJan 14 14:29:35 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:40662-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:36 coredns2 coredns: [INFO] 10.31.53.2:33545 - 28529 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000456204sJan 14 14:29:36 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:37439-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:36 coredns2 coredns: [INFO] 10.31.53.2:53167 - 18372 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000426039sJan 14 14:29:36 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:45881-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:37 coredns2 coredns: [INFO] 10.31.53.2:44851 - 52388 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000264627sJan 14 14:29:37 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:58678-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:37 coredns2 coredns: [INFO] 10.31.53.2:59500 - 19169 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000385832sJan 14 14:29:37 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:36355-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:38 coredns2 coredns: [INFO] 10.31.53.2:48272 - 35987 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000359493sJan 14 14:29:38 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:52055-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:39 coredns2 coredns: [INFO] 10.31.53.2:55974 - 48529 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.00035554sJan 14 14:29:39 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:51253-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:39 coredns2 coredns: [INFO] 10.31.53.2:40670 - 43374 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.00024835sJan 14 14:29:39 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:41919-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:40 coredns2 coredns: [INFO] 10.31.53.2:42067 - 780 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000257447sJan 14 14:29:40 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:49359-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:40 coredns2 coredns: [INFO] 10.31.53.2:56758 - 62500 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000338204sJan 14 14:29:40 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:44658-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:41 coredns2 coredns: [INFO] 10.31.53.2:36149 - 32955 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000400937sJan 14 14:29:41 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:33750-&gt;127.0.0.1:35353: read: connection refusedJan 14 14:29:41 coredns2 coredns: [INFO] 10.31.53.2:60504 - 49021 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000272807sJan 14 14:29:41 coredns2 coredns: [ERROR] plugin/errors: 2 tinychen.com. A: read udp 127.0.0.1:41003-&gt;127.0.0.1:35353: read: connection refused# åˆå¹¶é”™è¯¯æ—¥å¿—ä¹‹å,åˆå¹¶è¾“å‡º30så†…ç¬¦åˆæ¡ä»¶çš„é”™è¯¯æ—¥å¿—æ€»æ•°ï¼Œå¹¶ä¸”æ—¥å¿—çº§åˆ«å˜ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„[WARNING]Jan 14 14:32:48 coredns2 coredns: [INFO] 10.31.53.2:60095 - 763 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000389099sJan 14 14:33:10 coredns2 coredns: [INFO] 10.31.53.2:44256 - 21788 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000556023sJan 14 14:33:11 coredns2 coredns: [INFO] 10.31.53.2:39654 - 18638 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000394553sJan 14 14:33:11 coredns2 coredns: [INFO] 10.31.53.2:46340 - 23770 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000405404sJan 14 14:33:12 coredns2 coredns: [INFO] 10.31.53.2:56168 - 59588 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000351365sJan 14 14:33:13 coredns2 coredns: [INFO] 10.31.53.2:52337 - 28311 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.00033022sJan 14 14:33:14 coredns2 coredns: [INFO] 10.31.53.2:55564 - 52773 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.0002756sJan 14 14:33:14 coredns2 coredns: [INFO] 10.31.53.2:36233 - 21289 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000307114sJan 14 14:33:15 coredns2 coredns: [INFO] 10.31.53.2:41822 - 41368 &quot;A IN tinychen.com. udp 38 false 4096&quot; - - 0 0.000379377sJan 14 14:33:18 coredns2 coredns: [WARNING] plugin/errors: 9 errors like &#x27;.* connection refused$&#x27; occurred in last 30s","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"coredns","slug":"coredns","permalink":"https://tinychen.com/tags/coredns/"},{"name":"dnstap","slug":"dnstap","permalink":"https://tinychen.com/tags/dnstap/"}]},{"title":"DPVS-FullNATæ¨¡å¼keepalivedç¯‡","slug":"20211203-dpvs-fullnat-keepalived","date":"2021-12-03T09:00:00.000Z","updated":"2021-12-03T09:00:00.000Z","comments":true,"path":"20211203-dpvs-fullnat-keepalived/","link":"","permalink":"https://tinychen.com/20211203-dpvs-fullnat-keepalived/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»åŸºäºCentOS7.9ç³»ç»Ÿéƒ¨ç½²DPVSçš„FullNATæ¨¡å¼åœ¨ä½¿ç”¨keepalivedè¿›è¡Œä¸»å¤‡æ¨¡å¼é…ç½®é«˜å¯ç”¨é›†ç¾¤åœ¨çº¿ä¸Šç”Ÿäº§ç¯å¢ƒè½åœ°å®è·µæ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œå¤„ç†çš„æ€è·¯ã€‚ æ–‡ä¸­æ‰€æœ‰IPåœ°å€ã€ä¸»æœºåã€MACåœ°å€ä¿¡æ¯å‡å·²è¿›è¡Œè„±æ•æˆ–é­”æ”¹å¤„ç†ï¼Œå®¢æˆ·ç«¯IPä½¿ç”¨æ¨¡æ‹Ÿå™¨ç”Ÿæˆï¼Œä½†ä¸å½±å“é˜…è¯»ä½“éªŒã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»åŸºäºCentOS7.9ç³»ç»Ÿéƒ¨ç½²DPVSçš„FullNATæ¨¡å¼åœ¨ä½¿ç”¨keepalivedè¿›è¡Œä¸»å¤‡æ¨¡å¼é…ç½®é«˜å¯ç”¨é›†ç¾¤åœ¨çº¿ä¸Šç”Ÿäº§ç¯å¢ƒè½åœ°å®è·µæ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œå¤„ç†çš„æ€è·¯ã€‚ æ–‡ä¸­æ‰€æœ‰IPåœ°å€ã€ä¸»æœºåã€MACåœ°å€ä¿¡æ¯å‡å·²è¿›è¡Œè„±æ•æˆ–é­”æ”¹å¤„ç†ï¼Œå®¢æˆ·ç«¯IPä½¿ç”¨æ¨¡æ‹Ÿå™¨ç”Ÿæˆï¼Œä½†ä¸å½±å“é˜…è¯»ä½“éªŒã€‚ 1ã€keepalivedæ¶æ„1.1 å•æœºæ¶æ„å›¾ ä¸ºäº†æ–¹ä¾¿ç†è§£æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„æ¶æ„å›¾åˆ†ä¸ºDPVSç½‘ç»œæ ˆã€Linuxç½‘ç»œæ ˆã€RSé›†ç¾¤å’Œä½¿ç”¨è€…ï¼ˆSAå’ŒUsersï¼‰è¿™å››å¤§éƒ¨åˆ†ã€‚åœ¨Linuxç½‘ç»œæ ˆä¸­çš„ç‰©ç†ç½‘å¡ä½¿ç”¨ethè¡¨ç¤ºï¼Œåœ¨DPVSç½‘ç»œæ ˆä¸­çš„ç‰©ç†ç½‘å¡ä½¿ç”¨dpdkè¡¨ç¤ºï¼ŒDPVSç½‘ç»œæ ˆä¸­çš„ç½‘å¡è™šæ‹Ÿåˆ°Linuxç½‘ç»œæ ˆä¸­åˆ™ä½¿ç”¨kniåç¼€è¡¨ç¤ºï¼Œåœ¨ä¸¤ä¸ªç½‘ç»œæ ˆä¸­åšäº†bondingçš„ç½‘å¡éƒ½ä½¿ç”¨BONDè¡¨ç¤ºã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºæ‰€æœ‰çš„kniç½‘å¡æ¥è¯´ï¼Œå®ƒä»¬çš„æµé‡éƒ½ä¼šè¢«DPVSç¨‹åºåŠ«æŒã€‚ 1.2 ç½‘å¡ç”¨é€”keepalivedåŒè‡‚æ¨¡å¼æ¶æ„ä¸‹ï¼Œæ¯å°DPVSæœºå™¨æœ€å°‘éœ€è¦ä¸‰ç»„ç½‘å¡ï¼Œbondingå¯åšå¯ä¸åšï¼Œä¸å½±å“è¯¥æ¶æ„å›¾ã€‚ä¸Šå›¾ä¸ºåšäº†bonding4çš„ç½‘å¡æ¶æ„ï¼Œå› æ­¤ç½‘å¡åç§°ä½¿ç”¨bond0ã€1ã€2æ¥è¡¨ç¤ºï¼Œåªè¦ç†è§£æ¸…æ¥šæ¯ä¸€ç»„ç½‘å¡çš„ä½œç”¨ï¼Œå°±èƒ½å¾ˆå®¹æ˜“ç†è§£å›¾ä¸­çš„æ¶æ„ã€‚ bond0ï¼š**bond0ç½‘å¡ä¸»è¦ç”¨äºè¿ç»´äººå‘˜ç®¡ç†æœºå™¨ä»¥åŠkeepalivedç¨‹åºå¯¹åç«¯çš„RSèŠ‚ç‚¹è¿›è¡Œæ¢æ´»** åªå­˜åœ¨äºLinuxç½‘ç»œæ ˆä¸­çš„ç½‘å¡ï¼Œå› ä¸ºDPVSç½‘ç»œæ ˆçš„ç½‘å¡ï¼ˆåŒ…æ‹¬å…¶è™šæ‹Ÿå‡ºçš„kniç½‘å¡ï¼‰éƒ½æ˜¯éšç€DPVSç¨‹åºçš„å­˜åœ¨è€Œå­˜åœ¨çš„ï¼Œå› æ­¤å¿…é¡»æœ‰ä¸€ä¸ªç‹¬ç«‹äºDPVSè¿›ç¨‹ä¹‹å¤–çš„ç½‘å¡ç”¨äºç®¡ç†æœºå™¨ï¼ˆæœºå™¨ä¿¡æ¯ç›‘æ§æŠ¥è­¦ï¼Œsshç™»å½•æ“ä½œç­‰ï¼‰ã€‚ keepalivedç¨‹åºå¯¹åç«¯çš„RSèŠ‚ç‚¹æ¢æ´»çš„æ—¶å€™åªèƒ½ä½¿ç”¨Linuxç½‘ç»œæ ˆï¼Œå› æ­¤åœ¨ä¸Šå›¾çš„æ¶æ„ä¸­ï¼Œæ­£å¥½ä¹Ÿæ˜¯ä½¿ç”¨bond0ç½‘å¡è¿›è¡Œæ¢æ´»æ“ä½œï¼Œå¦‚æœæœ‰å¤šä¸ªLinuxç½‘ç»œæ ˆçš„å†…ç½‘ç½‘å¡ï¼Œåˆ™æ ¹æ®Linuxç³»ç»Ÿä¸­çš„è·¯ç”±æ¥åˆ¤æ–­ï¼ˆå•å¼ ç½‘å¡çš„æ—¶å€™ä¹Ÿæ˜¯æ ¹æ®è·¯ç”±åˆ¤æ–­ï¼‰ã€‚ bond1.kniï¼š**bond1.kniåœ¨ä¸Šè¿°æ¶æ„æ­£å¸¸è¿è¡Œçš„æ—¶å€™æ˜¯æ²¡æœ‰ä»»ä½•ä½œç”¨çš„** bond1.kniä½œä¸ºDPVSä¸­çš„bond1ç½‘å¡åœ¨Linuxç½‘ç»œæ ˆä¸­çš„è™šæ‹Ÿç½‘å¡ï¼Œåœ¨å®šä½ä¸Šå’Œbond0æ˜¯å‡ ä¹å®Œæˆé‡åˆçš„ï¼Œå› æ­¤æœ€å¥½å°†å…¶å…³é—­é¿å…å¯¹bond0äº§ç”Ÿå¹²æ‰°ã€‚ ä¹‹æ‰€ä»¥ä¸å°†å…¶å½»åº•åˆ é™¤ï¼Œæ˜¯å› ä¸ºå½“DPVSç¨‹åºè¿è¡Œå¼‚å¸¸æˆ–è€…éœ€è¦å¯¹bond1æŠ“åŒ…çš„æ—¶å€™ï¼Œå¯ä»¥å°†bond1çš„æµé‡forwardåˆ°bond1.kniè¿›è¡Œæ“ä½œã€‚ bond2.kniï¼šbond2.kniä¸»è¦ç”¨äºåˆ·æ–°VIPçš„MACåœ°å€ kniç½‘å¡çš„macåœ°å€å’ŒDPVSä¸­çš„bondç½‘å¡çš„macåœ°å€æ˜¯ä¸€è‡´çš„ï¼Œç”±äºæˆ‘ä»¬å¸¸ç”¨çš„pingå’Œarpingç­‰å‘½ä»¤æ— æ³•å¯¹DPVSä¸­çš„ç½‘å¡æ“ä½œï¼Œå› æ­¤å½“æˆ‘ä»¬éœ€è¦å‘é€garpæ•°æ®åŒ…æˆ–è€…æ˜¯gnaæ•°æ®åŒ…æ¥åˆ·æ–°IPv4æˆ–è€…IPv6çš„VIPåœ°å€åœ¨äº¤æ¢æœºä¸­çš„MACåœ°å€çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡DPVSç½‘å¡å¯¹åº”çš„kniç½‘å¡æ¥è¿›è¡Œæ“ä½œã€‚ bond1ï¼šä¸šåŠ¡æµé‡ç½‘å¡ï¼Œä¸»è¦ç”¨äºåŠ è½½LIPã€ä¸RSå»ºç«‹è¿æ¥å¹¶è½¬å‘è¯·æ±‚ local_address_groupè¿™ä¸ªå­—æ®µé…ç½®çš„LIPä¸€èˆ¬å°±æ˜¯é…ç½®åœ¨bond1ç½‘å¡ã€‚ bond2ï¼šä¸šåŠ¡æµé‡ç½‘å¡ï¼Œä¸»è¦ç”¨äºåŠ è½½VIPã€ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥å¹¶è½¬å‘è¯·æ±‚ dpdk_interfaceè¿™ä¸ªå­—æ®µå°±æ˜¯DPVSå®šåˆ¶ç‰ˆçš„keepalivedç¨‹åºç‰¹æœ‰çš„å­—æ®µï¼Œèƒ½å¤Ÿå°†VIPé…ç½®åˆ°dpvsç½‘å¡ä¸Šã€‚ æ³¨æ„ï¼škeepalivedä¸»å¤‡èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å¿…é¡»ä½¿ç”¨Linuxç½‘ç»œæ ˆå†…çš„ç½‘å¡ï¼Œåœ¨è¿™ä¸ªæ¶æ„ä¸­å¯ä»¥æ˜¯bond0æˆ–è€…æ˜¯bond2.kniç½‘å¡ 2ã€dpdkç½‘å¡ç›¸å…³2.1 åŸç†åˆ†æDPVSä¸­çš„ç½‘å¡å‘½åæ˜¯æŒ‰ç…§PCIeç¼–å·çš„é¡ºåºæ¥å‘½åçš„ï¼Œä½¿ç”¨dpdk-devbindå·¥å…·æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç½‘å¡å¯¹åº”çš„PCIeç¼–å·å’ŒLinuxç½‘ç»œæ ˆä¸­çš„ç½‘å¡åç§°ã€‚ å¦‚æœLinuxç³»ç»Ÿçš„ç½‘å¡å‘½åæ˜¯ä½¿ç”¨eth*çš„å‘½åæ–¹å¼å¹¶ä¸”åœ¨/etc/udev/rules.d/70-persistent-net.rulesæ–‡ä»¶ä¸­å›ºåŒ–äº†MACåœ°å€å’Œç½‘å¡åç§°çš„å¯¹åº”å…³ç³»ï¼Œé‚£ä¹ˆå°±éœ€è¦ç‰¹åˆ«æ³¨æ„PCIeç¼–å·ã€DPVSç½‘å¡åã€MACåœ°å€ã€Linuxç½‘å¡åå››è€…ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ å°¤å…¶æ˜¯å½“æœºå™¨å­˜åœ¨å¤šä¸ªç½‘æ®µçš„ç½‘å¡ä¸”åšäº†bondingçš„æ—¶å€™ï¼ŒLinuxç½‘å¡ä¸­çš„eth*å’ŒDPVSç½‘å¡ä¸­çš„dpdk*å¹¶ä¸ä¸€å®šèƒ½ä¸€ä¸€å¯¹åº”ï¼Œæ­¤æ—¶æœ€å¥½èƒ½ä¿®æ”¹ç›¸å…³é…ç½®å¹¶ä¸”è®©æœºæˆ¿çš„åŒå­¦è°ƒæ•´ç½‘å¡æ¥çº¿ï¼ˆå½“ç„¶ç›´æ¥åœ¨dpvsçš„é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹å¯¹åº”çš„ç½‘å¡é¡ºåºä¹Ÿå¯ä»¥ï¼‰ã€‚ 2.2 è§£å†³æ–¹æ¡ˆä¸‹é¢çš„æ¡ˆä¾‹æ˜¯ä¸€ä¸ªä»…ä¾›å‚è€ƒçš„æ¯”è¾ƒä¸å®¹æ˜“å‡ºé—®é¢˜çš„ç»„åˆï¼Œethç½‘å¡æ ¹æ®å¯¹åº”çš„PCIeç¼–å·å‡åºè¿›è¡Œå‘½åï¼Œå’Œdpdkç½‘å¡çš„å‘½åè§„åˆ™ä¸€è‡´ï¼ŒåŒæ—¶eth[0-3]ä¸ºå†…ç½‘ç½‘å¡ï¼Œeth[4-5]ä¸ºå¤–ç½‘ç½‘å¡ï¼Œä¸æœ¬æ–‡çš„æ¶æ„å›¾å¯¹åº”ï¼Œä¸å®¹æ˜“å‡ºé”™ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[root@dpvs dpvs]# dpdk-devbind --status-dev netNetwork devices using DPDK-compatible driver============================================0000:04:00.0 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; drv=igb_uio unused=ixgbe0000:04:00.1 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; drv=igb_uio unused=ixgbe0000:82:00.0 &#x27;Ethernet 10G 2P X520 Adapter 154d&#x27; drv=igb_uio unused=ixgbe0000:82:00.1 &#x27;Ethernet 10G 2P X520 Adapter 154d&#x27; drv=igb_uio unused=ixgbeNetwork devices using kernel driver===================================0000:01:00.0 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth0 drv=ixgbe unused=igb_uio0000:01:00.1 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth1 drv=ixgbe unused=igb_uio[root@dpvs dpvs]# cat /etc/udev/rules.d/70-persistent-net.rulesSUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;28:6e:45:c4:0e:48&quot;, NAME=&quot;eth0&quot;SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;28:6e:45:c4:0e:4a&quot;, NAME=&quot;eth1&quot;SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;38:e2:ba:1c:dd:74&quot;, NAME=&quot;eth2&quot;SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;38:e2:ba:1c:dd:76&quot;, NAME=&quot;eth3&quot;SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;b4:45:99:18:6c:5c&quot;, NAME=&quot;eth4&quot;SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;b4:45:99:18:6c:5e&quot;, NAME=&quot;eth5&quot;[root@dpvs dpvs]# dpip link -v show | grep -A4 dpdk1: dpdk0: socket 0 mtu 1500 rx-queue 16 tx-queue 16 UP 10000 Mbps full-duplex auto-nego promisc addr 38:E2:BA:1C:DD:74 OF_RX_IP_CSUM OF_TX_IP_CSUM OF_TX_TCP_CSUM OF_TX_UDP_CSUM pci_addr driver_name 0000:04:00:0 net_ixgbe--2: dpdk1: socket 0 mtu 1500 rx-queue 16 tx-queue 16 UP 10000 Mbps full-duplex auto-nego promisc addr 38:E2:BA:1C:DD:76 OF_RX_IP_CSUM OF_TX_IP_CSUM OF_TX_TCP_CSUM OF_TX_UDP_CSUM pci_addr driver_name 0000:04:00:1 net_ixgbe--3: dpdk2: socket 0 mtu 1500 rx-queue 16 tx-queue 16 UP 10000 Mbps full-duplex auto-nego promisc addr B4:45:99:18:6C:5C OF_RX_IP_CSUM OF_TX_IP_CSUM OF_TX_TCP_CSUM OF_TX_UDP_CSUM pci_addr driver_name 0000:82:00:0 net_ixgbe--4: dpdk3: socket 0 mtu 1500 rx-queue 16 tx-queue 16 UP 10000 Mbps full-duplex auto-nego promisc addr B4:45:99:18:6C:5E OF_RX_IP_CSUM OF_TX_IP_CSUM OF_TX_TCP_CSUM OF_TX_UDP_CSUM pci_addr driver_name 0000:82:00:1 net_ixgbe 2.3 æŠ“åŒ…æ’éšœæ­£å¸¸æƒ…å†µä¸‹ï¼ŒDPVSç½‘ç»œæ ˆä¼šåŠ«æŒå¯¹åº”DPVSç½‘å¡çš„å…¨éƒ¨æµé‡åˆ°DPVSç½‘ç»œæ ˆä¸­ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨tcpdumpå·¥å…·å¯¹ç›¸åº”çš„kniç½‘å¡è¿›è¡ŒæŠ“åŒ…æ˜¯æ²¡åŠæ³•æŠ“åˆ°ç›¸å…³çš„æ•°æ®åŒ…çš„ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨dpipç›¸å…³å‘½ä»¤æŠŠdpvsç½‘å¡çš„æµé‡forwardåˆ°å¯¹åº”çš„kniç½‘å¡ä¸Šï¼Œå†å¯¹kniç½‘å¡è¿›è¡ŒæŠ“åŒ…ã€‚ 12dpip link set &lt;port&gt; forward2kni on # enable forward2kni on &lt;port&gt;dpip link set &lt;port&gt; forward2kni off # disable forward2kni on &lt;port&gt; å¯¹äºæœ¬æ–‡æ¶æ„å›¾ä¸­çš„dpvsèŠ‚ç‚¹ï¼Œå‘½ä»¤ä¸­çš„&lt;port&gt;ä¸€èˆ¬ä¸ºä½¿ç”¨dpipå‘½ä»¤æŸ¥çœ‹åˆ°çš„bond1ç½‘å¡å’Œbond2ç½‘å¡ã€‚ ä¹Ÿå¯ä»¥æŸ¥çœ‹ä¸‹é¢è¿™ä¸ªå®˜æ–¹çš„å‚è€ƒé“¾æ¥ï¼š https://github.com/iqiyi/dpvs/blob/master/doc/tutorial.md#packet-capture-and-tcpdump æ³¨æ„ï¼šforward2kniæ“ä½œéå¸¸å½±å“æ€§èƒ½ï¼Œè¯·ä¸è¦åœ¨çº¿ä¸ŠæœåŠ¡èŠ‚ç‚¹è¿›è¡Œæ­¤æ“ä½œï¼ 3ã€kniç½‘å¡ç›¸å…³è¿™é‡Œä¸»è¦æ‰¿æ¥ä¸Šé¢ä»‹ç»kniç½‘å¡çš„ä½œç”¨ä»¥åŠç›¸å…³çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ€è·¯ 3.1 kniç½‘å¡çš„ä½œç”¨ä¸€èˆ¬æ¥è¯´DPVSçš„ç½‘å¡éƒ½ä¼šåœ¨Linuxç½‘ç»œæ ˆä¸­è™šæ‹Ÿä¸€ä¸ªå¯¹åº”çš„kniç½‘å¡ï¼Œè€ƒè™‘åˆ°é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºæ‰€æœ‰çš„kniç½‘å¡æ¥è¯´ï¼Œå®ƒä»¬çš„æµé‡éƒ½ä¼šè¢«DPVSç¨‹åºåŠ«æŒã€‚åœ¨æœ¬æ–‡çš„æ¶æ„ä¸­ï¼Œkniç½‘å¡çš„ä¸»è¦ä½œç”¨è¿˜æ˜¯è¾…åŠ©å®šä½æ•…éšœä»¥åŠåšå°‘é‡è¡¥å……å·¥ä½œã€‚ å½“dpvsç½‘å¡å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥æŠŠæµé‡forwardåˆ°kniç½‘å¡è¿›è¡ŒDEBUGï¼Œå½“VIPå‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨äºåˆ·æ–°VIPçš„MACåœ°å€ kniç½‘å¡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè™šæ‹Ÿç½‘å¡ï¼Œåªæ˜¯æ‰€æœ‰æµé‡éƒ½è¢«DPVSåŠ«æŒï¼Œå¯ä»¥åœ¨DPVSä¸­é…ç½®è·¯ç”±æ”¾è¡Œç‰¹å®šçš„æµé‡åˆ°kniç½‘å¡å®ç°è¡¥å……å·¥ä½œï¼Œå¦‚DPVSèŠ‚ç‚¹å¶å°”éœ€è¦è¿æ¥å¤–ç½‘çš„æ—¶å€™å¯ä»¥é€šè¿‡bond2.kniæ”¾è¡Œè¯¥å¤–ç½‘IPç„¶åè®¿é—®å¤–ç½‘ 3.2 kniç½‘å¡è·¯ç”±å¹²æ‰°3.2.1 æ¡ˆä¾‹å¤ç°åœ¨æœ¬å›¾çš„æ¶æ„ä¸­ï¼Œbond1.kniå’Œbond0ç½‘å¡åœ¨å®šä½ä¸Šéƒ½æ˜¯å±äºå†…ç½‘ç½‘å¡ï¼Œå¦‚æœä¸¤ä¸ªç½‘å¡éƒ½æ˜¯åŒä¸€ä¸ªç½‘æ®µçš„è¯ï¼Œå°±éœ€è¦å°¤å…¶æ³¨æ„å†…ç½‘æµé‡è¿›å‡ºç½‘å¡çš„æƒ…å†µã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€å°è™šæ‹Ÿæœºè¿›è¡Œç¤ºä¾‹ï¼š 12345678910111213141516[root@tiny-centos7 ~]# ip a...2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 52:54:00:66:3b:08 brd ff:ff:ff:ff:ff:ff inet 10.31.100.2/16 brd 10.31.255.255 scope global noprefixroute eth0 valid_lft forever preferred_lft forever3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 52:54:00:47:37:3e brd ff:ff:ff:ff:ff:ff inet 10.31.100.22/16 brd 10.31.255.255 scope global noprefixroute eth1 valid_lft forever preferred_lft forever...[root@tiny-centos7 ~]# ip r...10.31.0.0/16 dev eth0 proto kernel scope link src 10.31.100.2 metric 10010.31.0.0/16 dev eth1 proto kernel scope link src 10.31.100.22 metric 101... ä¸Šé¢çš„è¿™å°è™šæ‹Ÿæœºæœ‰ä¸¤ä¸ªå¤„äº10.31.0.0/16ç½‘æ®µçš„ç½‘å¡ï¼Œåˆ†åˆ«æ˜¯eth0ï¼ˆ10.31.100.2ï¼‰å’Œeth1ï¼ˆ10.31.100.22ï¼‰ï¼ŒæŸ¥çœ‹è·¯ç”±è¡¨çš„æ—¶å€™å¯ä»¥çœ‹åˆ°å¯¹10.31.0.0/16è¿™ä¸ªç½‘æ®µæœ‰ä¸¤æ¡è·¯ç”±åˆ†åˆ«æŒ‡å‘eth0å’Œeth1çš„IPï¼Œä¸åŒçš„æ˜¯ä¸¤è€…çš„metricã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åšä¸ªæµ‹è¯•ï¼š é¦–å…ˆæˆ‘ä»¬åœ¨10.31.100.1è¿™å°æœºå™¨ä¸Šé¢pingè¿™å°è™šæ‹Ÿæœºçš„eth1ï¼ˆ10.31.100.22ï¼‰ï¼Œç„¶åç›´æ¥ä½¿ç”¨tcpdumpè¿›è¡ŒæŠ“åŒ… 1234567891011121314151617181920212223242526# å¯¹eth1ï¼ˆ10.31.100.22ï¼‰ç½‘å¡è¿›è¡ŒæŠ“åŒ…çš„æ—¶å€™æŠ“ä¸åˆ°å¯¹åº”çš„icmpåŒ…[root@tiny-centos7 ~]# tcpdump -A -n -vv -i eth1 icmptcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes^C0 packets captured0 packets received by filter0 packets dropped by kernel# æ¥ç€æˆ‘ä»¬å¯¹eth0ï¼ˆ10.31.100.2ï¼‰ç½‘å¡è¿›è¡ŒæŠ“åŒ…çš„æ—¶å€™å‘ç°èƒ½å¤ŸæŠ“åˆ°å¤–éƒ¨æœºå™¨ï¼ˆ10.31.100.1ï¼‰å¯¹eth1ï¼ˆ10.31.100.22ï¼‰ç½‘å¡çš„icmpæ•°æ®åŒ…[root@tiny-centos7 ~]# tcpdump -A -n -vv -i eth0 icmptcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes16:29:44.789831 IP (tos 0x0, ttl 64, id 1197, offset 0, flags [DF], proto ICMP (1), length 84) 10.31.100.1 &gt; 10.31.100.22: ICMP echo request, id 16846, seq 54, length 64E..T..@.@.Y..d..d...VSA..6y2.a....yA...................... !&quot;#$%&amp;&#x27;()*+,-./0123456716:29:44.789898 IP (tos 0x0, ttl 64, id 16187, offset 0, flags [none], proto ICMP (1), length 84) 10.31.100.22 &gt; 10.31.100.1: ICMP echo reply, id 16846, seq 54, length 64E..T?;..@._..d..d...^SA..6y2.a....yA...................... !&quot;#$%&amp;&#x27;()*+,-./0123456716:29:45.813740 IP (tos 0x0, ttl 64, id 1891, offset 0, flags [DF], proto ICMP (1), length 84) 10.31.100.1 &gt; 10.31.100.22: ICMP echo request, id 16846, seq 55, length 64E..T.c@.@.V..d. 3.2.2 åŸç†åˆ†æåˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼šå°½ç®¡10.31.100.22æ˜¯åœ¨eth1ä¸Šé¢ï¼Œä½†æ˜¯å®é™…ä¸Šæµé‡æ˜¯ç»è¿‡eth0ï¼Œä¹Ÿå°±æ˜¯è¯´eth1ä¸Šé¢å®é™…å¹¶æ²¡æœ‰æµé‡ã€‚è¿™ä¹Ÿå°±å¾ˆå¥½åœ°å¯¹åº”äº†è·¯ç”±è¡¨ä¸­10.31.100.2 metric 100è¦å°äº10.31.100.22 metric 101ï¼Œç¬¦åˆmetricè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜çš„åŸåˆ™ã€‚ å°†ä¸Šé¢çš„æƒ…å†µå¥—ç”¨åˆ°bond0å’Œbond1.kniç½‘å¡ä¸Šï¼Œä¹Ÿä¼šå­˜åœ¨ç›¸ä¼¼çš„é—®é¢˜ï¼Œå¦‚æœå¼€å¯äº†IPv6ç½‘ç»œï¼Œè¿˜éœ€è¦è€ƒè™‘æ˜¯å¦ä¼šæœ‰bond1.kniç½‘å¡åœ¨IPv6ç½‘ç»œè·¯ç”±é€šå‘Šä¸‹å‘é»˜è®¤ç½‘å…³è·¯ç”±ã€‚è¿™æ ·ä¸€æ¥å°±å®¹æ˜“å­˜åœ¨è·¯ç”±æµé‡å¯èƒ½èµ°bond0ä¹Ÿå¯èƒ½èµ°bond1.kniçš„é—®é¢˜ï¼ŒæŠ›å¼€ä¸¤è€…ç‰©ç†ç½‘å¡å’Œè™šæ‹Ÿç½‘å¡çš„æ€§èƒ½å·®è·å…ˆä¸è°ˆï¼Œæ›´é‡è¦çš„æ˜¯ï¼š é»˜è®¤æƒ…å†µä¸‹bond1.kniç½‘å¡çš„æµé‡éƒ½ä¼šè¢«DPVSç¨‹åºåŠ«æŒï¼Œæ‰€ä»¥èµ°bond1.kniç½‘å¡çš„è¯·æ±‚éƒ½ä¼šä¸æ­£å¸¸ï¼› è€Œæ°å¥½RSèŠ‚ç‚¹çš„æ¢æ´»æ˜¯é€šè¿‡Linuxç½‘ç»œæ ˆå®ç°çš„ï¼Œå¦‚æœè¿™æ—¶å€™åˆ°RSèŠ‚ç‚¹çš„è·¯ç”±æ˜¯èµ°bond1.kniç½‘å¡ï¼Œå°±ä¼šè®©keepalivedè¯¯è®¤ä¸ºè¯¥åç«¯RSèŠ‚ç‚¹å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œä»è€Œå°†å…¶weighté™ä¸º0ï¼› å¦‚æœæ•´ä¸ªé›†ç¾¤çš„RSéƒ½æ˜¯å¦‚æ­¤ï¼Œå°±ä¼šå¯¼è‡´è¿™ä¸ªé›†ç¾¤çš„VIPåæ— å¯ç”¨RSï¼ˆweightå‡ä¸º0ï¼‰ï¼Œæœ€ç»ˆçš„ç»“æœå°±æ˜¯è¯·æ±‚æ— æ³•æ­£å¸¸è½¬å‘åˆ°RSå¯¼è‡´æœåŠ¡å½»åº•ä¸å¯ç”¨ã€‚ 3.2.3 è§£å†³æ€è·¯å› æ­¤åœ¨è¿™é‡Œæœ€æ–¹ä¾¿çš„ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯ç›´æ¥å…³é—­bond1.kniï¼Œç›´æ¥ç¦ç”¨ï¼Œä»…å½“éœ€è¦DEBUGçš„æ—¶å€™å†å¯ç”¨ï¼Œå°±å¯ä»¥æœ‰æ•ˆåœ°é¿å…è¿™ç±»é—®é¢˜ã€‚ 3.3 kniç½‘å¡IPä¸é€š3.3.1 åŸç†åˆ†æå› ä¸ºLinuxç½‘ç»œæ ˆä¸­çš„kniç½‘å¡å’ŒDPVSç½‘ç»œæ ˆä¸­çš„ç½‘å¡å®é™…ä¸Šå¯¹åº”çš„æ˜¯ä¸€ä¸ªç‰©ç†ç½‘å¡ï¼ˆæˆ–ä¸€ç»„ç‰©ç†ç½‘å¡ï¼‰ï¼Œæµç»è¿™ä¸ªç½‘å¡çš„ç½‘ç»œæµé‡åªèƒ½ç”±ä¸€ä¸ªç½‘ç»œæ ˆå¤„ç†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºæ‰€æœ‰çš„kniç½‘å¡æ¥è¯´ï¼Œå®ƒä»¬çš„æµé‡éƒ½ä¼šè¢«DPVSç¨‹åºåŠ«æŒã€‚è¿™ä¹Ÿå°±æ„å‘³ç€bond2.kniç½‘å¡ä¸Šçš„IPä¸ä»…æ˜¯æ— æ³•pingé€šï¼Œä¹Ÿæ— æ³•è¿›è¡Œå…¶ä»–çš„æ­£å¸¸è®¿é—®æ“ä½œã€‚ä½†æ˜¯DPVSç¨‹åºæ”¯æŒé’ˆå¯¹ç‰¹å®šçš„IPæ”¾è¡Œç›¸å…³çš„æµé‡åˆ°Linuxç½‘ç»œæ ˆä¸­ï¼ˆé€šè¿‡kni_hostè·¯ç”±å®ç°ï¼‰ï¼Œå°±å¯ä»¥å®ç°è¯¥IPçš„æ­£å¸¸è®¿é—®ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šä¸€ç»„x520ç½‘å¡ç»„bondingï¼Œåœ¨Linuxç½‘ç»œæ ˆä¸­æ˜¾ç¤ºä¸ºbond2.kniï¼Œåœ¨DPVSç½‘ç»œä¸­æ˜¾ç¤ºä¸ºbond2ï¼Œè€Œå¦å¤–çš„bond0ç½‘å¡åˆ™åªæ˜¯ä¸€ä¸ªåœ¨linuxç½‘ç»œæ ˆä¸­çš„bondingç½‘å¡ï¼Œä¸DPVSæ— å…³ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€äº›ç®€å•çš„å‘½ä»¤æ¥è¿›è¡Œå¯¹æ¯”ï¼š ä½¿ç”¨ethtoolå·¥å…·æŸ¥çœ‹ï¼Œbond0ç½‘å¡èƒ½æ­£å¸¸è·å–ç½‘å¡é€Ÿç‡ç­‰ä¿¡æ¯ï¼Œè€Œkniç½‘å¡åˆ™å®Œå…¨æ— æ³•è·å–ä»»ä½•æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒæ—¶åœ¨DPVSç½‘ç»œæ ˆä¸­ä½¿ç”¨dpipå‘½ä»¤åˆ™èƒ½å¤Ÿçœ‹åˆ°è¯¥bond2ç½‘å¡éå¸¸è¯¦ç»†çš„ç‰©ç†ç¡¬ä»¶ä¿¡æ¯ã€‚ ä½¿ç”¨lspci -nnvå‘½ä»¤æŸ¥çœ‹ä¸¤ç»„ç½‘å¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°bond0ç½‘å¡ä½¿ç”¨çš„æ˜¯Linuxçš„ç½‘å¡é©±åŠ¨ixgbeï¼Œè€Œbond2ç½‘å¡ä½¿ç”¨çš„æ˜¯DPVSçš„PMDigb_uioã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889[root@dpvs dpvs]# ethtool bond0Settings for bond0: Supported ports: [ ] Supported link modes: Not reported Supported pause frame use: No Supports auto-negotiation: No Supported FEC modes: Not reported Advertised link modes: Not reported Advertised pause frame use: No Advertised auto-negotiation: No Advertised FEC modes: Not reported Speed: 20000Mb/s Duplex: Full Port: Other PHYAD: 0 Transceiver: internal Auto-negotiation: off Link detected: yes[root@dpvs dpvs]# ethtool bond2.kniSettings for bond2.kni:No data available[root@dpvs dpvs]# dpip -s -v link show bond23: bond2: socket 0 mtu 1500 rx-queue 16 tx-queue 16 UP 20000 Mbps full-duplex auto-nego addr 00:1C:34:EE:46:E4 ipackets opackets ibytes obytes 15451492 31306 6110603685 4922260 ierrors oerrors imissed rx_nombuf 0 0 0 0 mbuf-avail mbuf-inuse 1012315 36260 pci_addr driver_name net_bonding if_index min_rx_bufsize max_rx_pktlen max_mac_addrs 0 0 15872 16 max_rx_queues max_tx_queues max_hash_addrs max_vfs 127 63 0 0 max_vmdq_pools rx_ol_capa tx_ol_capa reta_size 0 0x1AE9F 0x2A03F 128 hash_key_size flowtype_rss_ol vmdq_que_base vmdq_que_num 0 0x38D34 0 0 rx_desc_max rx_desc_min rx_desc_align vmdq_pool_base 4096 0 1 0 tx_desc_max tx_desc_min tx_desc_align speed_capa 4096 0 1 0 Queue Configuration: rx0-tx0 cpu1-cpu1 rx1-tx1 cpu2-cpu2 rx2-tx2 cpu3-cpu3 rx3-tx3 cpu4-cpu4 rx4-tx4 cpu5-cpu5 rx5-tx5 cpu6-cpu6 rx6-tx6 cpu7-cpu7 rx7-tx7 cpu8-cpu8 rx8-tx8 cpu9-cpu9 rx9-tx9 cpu10-cpu10 rx10-tx10 cpu11-cpu11 rx11-tx11 cpu12-cpu12 rx12-tx12 cpu13-cpu13 rx13-tx13 cpu14-cpu14 rx14-tx14 cpu15-cpu15 rx15-tx15 cpu16-cpu16 HW mcast list: link 33:33:00:00:00:01 link 33:33:00:00:00:02 link 01:80:c2:00:00:0e link 01:80:c2:00:00:03 link 01:80:c2:00:00:00 link 01:00:5e:00:00:01 link 33:33:ff:bf:43:e4 [root@dpvs dpvs]# lspci -nnv...01:00.0 Ethernet controller [0200]: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection [8086:10fb] (rev 01)... Kernel driver in use: ixgbe Kernel modules: ixgbe...81:00.0 Ethernet controller [0200]: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection [8086:10fb] (rev 01)... Kernel driver in use: igb_uio Kernel modules: ixgbe 3.3.2 è§£å†³æ€è·¯å¦‚æœæƒ³è¦bond2.kniçš„ç½‘å¡ä¸Šé¢çš„IPç›¸å…³æ“ä½œæ­£å¸¸ï¼Œå¯ä»¥é’ˆå¯¹è¯¥IPæ·»åŠ kni_hostè·¯ç”±ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š 123456# bond2.kni_ipå¯ä»¥æ›¿æ¢ä¸ºä»»æ„çš„ä¸€ä¸ªIPdpip route add &lt;bond2.kni_ip&gt;/32 scope kni_host dev bond2dpip route del &lt;bond2.kni_ip&gt;/32 scope kni_host dev bond2# ipv6ç½‘ç»œæ“ä½œä¹Ÿæ˜¯ä¸€æ ·dpip route -6 add &lt;bond2.kni_ip&gt;/128 scope kni_host dev bond2dpip route -6 del &lt;bond2.kni_ip&gt;/128 scope kni_host dev bond2 æ³¨æ„ï¼šæ”¾è¡Œçš„æ—¶å€™ä¸€å®šè¦ä¸€ä¸ªIPä¸€ä¸ªIPæ”¾è¡Œï¼Œæ©ç ä¸€å®šè¦æ˜¯32æˆ–è€…æ˜¯128ï¼Œä¸€æ¬¡æ‰¹é‡æ”¾è¡Œå¤šä¸ªIPä¼šéå¸¸å½±å“æ€§èƒ½ï¼ 3.4 VIPèƒ½pingé€šä½†httpè¯·æ±‚å¼‚å¸¸å¯¹äºDPVSæ¥è¯´ï¼Œpingè¯·æ±‚å’Œhttpè¯·æ±‚çš„å¤„ç†é€»è¾‘æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚å¯¹äºpingè¯·æ±‚çš„icmpå’Œicmpv6æ•°æ®åŒ…ï¼Œéƒ½æ˜¯ç”±DPVSç½‘ç»œæ ˆæœ¬èº«æ¥è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸ä¼šæ¶‰åŠåˆ°åé¢çš„RSèŠ‚ç‚¹ã€‚ èƒ½pingé€šåˆ™è¯´æ˜DPVSç¨‹åºå·¥ä½œæ­£å¸¸ï¼Œhttpè¯·æ±‚å¼‚å¸¸åˆ™è¯´æ˜åç«¯çš„RSèŠ‚ç‚¹çŠ¶æ€å¼‚å¸¸ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯LIPå’ŒRSä¹‹é—´çš„é€šä¿¡å‡ºç°äº†é—®é¢˜å¯¼è‡´æ•°æ®åŒ…æ— æ³•é¡ºåˆ©åˆ°è¾¾ã€‚ å½“ç„¶è¿˜æœ‰ä¸€ç§å¯èƒ½å°±æ˜¯ï¼šLIPå’ŒRSä¹‹é—´çš„é€šä¿¡æ­£å¸¸ï¼Œä½†æ˜¯ç”¨æ¥RSæ¢æ´»çš„ç½‘å¡å’ŒRSä¹‹é—´çš„é€šä¿¡å¼‚å¸¸å¯¼è‡´keepalivedè¿›ç¨‹è¯¯è®¤ä¸ºRSèŠ‚ç‚¹å‡ºç°äº†é—®é¢˜ä»è€Œå°†weighté™ä¸º0ã€‚ è¿™ç§æƒ…å†µçš„ä¸€ä¸ªå¸¸è§æ¡ˆä¾‹å°±æ˜¯IPv6ç½‘ç»œä¸‹çš„DPVSèŠ‚ç‚¹å’ŒRSèŠ‚ç‚¹è·¨ç½‘æ®µé€šä¿¡ï¼Œè€ŒDPVSèŠ‚ç‚¹ä¸Šé¢æ²¡æœ‰æ·»åŠ ipv6çš„è·¨ç½‘æ®µè·¯ç”±ã€‚ 4ã€keepalivedç›¸å…³keepalivedå‡ºç°çš„é—®é¢˜ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢ï¼šè„‘è£‚å’Œä¸»å¤‡åˆ‡æ¢ã€‚ 4.1 è„‘è£‚ä¸€èˆ¬æ¥è¯´ï¼Œkeepalivedè„‘è£‚çš„æœ€æ ¹æœ¬åŸå› å°±æ˜¯ä¸¤å°æœºå™¨éƒ½ä»¥ä¸ºè‡ªå·±æ˜¯è€å¤§ï¼ˆmasterï¼‰ï¼Œé€ æˆè¿™ç§æƒ…å†µçš„åŸå› ä¸»è¦æœ‰ä¸¤ä¸ªï¼šç½‘ç»œä¸é€šæˆ–è€…é…ç½®æ–‡ä»¶é”™è¯¯ã€‚è¿™ä¸¤ç§æ•…éšœåŸå› å’Œæ’æŸ¥æ€è·¯åœ¨ç½‘ä¸Šå¾ˆå¤šå¸–å­éƒ½ååˆ†å¸¸è§ï¼Œæ­¤å¤„ä¸åšèµ˜è¿°ã€‚æ¯”è¾ƒå°‘è§çš„æ˜¯ä¸€ç§ç”±äºäº¤æ¢æœºå­˜åœ¨BUGï¼Œä½¿å¾—åŒä¸€ä¸ªvlanå†…å‡ºç°ä¸¤ç»„ä¸åŒçš„vrrp_instanceä½¿ç”¨ç›¸åŒçš„virtual_router_idå¼•å‘çš„è„‘è£‚ã€‚ 4.1.1 äº¤æ¢æœºBUGå¯¼è‡´è„‘è£‚å½“ä½¿ç”¨ç»„æ’­é€šä¿¡çš„æ—¶å€™ï¼Œå¯¹äºéƒ¨åˆ†æœ‰BUGçš„äº¤æ¢æœºï¼Œä¸åŒçš„vrrp_instanceä¹‹é—´å¦‚æœvirtual_router_idä¸€è‡´ä¹Ÿæœ‰å¯èƒ½ä¼šå‡ºç°è„‘è£‚ã€‚æ³¨æ„è¿™é‡Œè¯´çš„virtual_router_idä¸€è‡´æŒ‡çš„æ˜¯ä»…ä»…virtual_router_idè¿™ä¸€ä¸ªå‚æ•°ä¸€æ ·ï¼Œå°±ç®—authenticationé…ç½®ä¸åŒçš„å¯†ç ï¼Œä¹Ÿæ˜¯ä¼šæ”¶åˆ°å¯¹æ–¹çš„ç»„æ’­åŒ…ï¼Œä½†æ˜¯åªæ˜¯ä¼šæŠ¥é”™æç¤ºreceived an invalid passwdï¼Œå¹¶ä¸ä¼šå‡ºç°è„‘è£‚ï¼ˆå› ä¸ºè¿™é‡Œæ˜¯ä¸åŒçš„vrrp_instanceè€Œä¸æ˜¯åŒä¸€ä¸ªvrrp_instanceå†…çš„ä¸åŒèŠ‚ç‚¹ï¼‰ã€‚ ä¸€èˆ¬æ¥è¯´virtual_router_idçš„èŒƒå›´æ˜¯1-255ï¼Œå¾ˆæ˜æ˜¾è¿™ä¸ªå˜é‡è®¾è®¡ä¹‹åˆå°±æ˜¯å‡å®šä¸€ä¸ªvlanå†…çš„IPæ•°é‡ä¸è¦è¶…è¿‡ä¸€ä¸ªCï¼Œè¿™æ ·virtual_router_idå°±å¯ä»¥ç›´æ¥ä½¿ç”¨IPçš„æœ€åä¸€æˆªã€‚å®é™…ä¸Šå¦‚æœvlanåˆ’åˆ†åˆç†æˆ–è€…è§„åˆ’å¾—å½“çš„è¯ä¸å¤ªå®¹æ˜“é‡åˆ°è¿™ç§é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæœºæˆ¿ç½‘ç»œçš„vlanåˆ’åˆ†è¿‡å¤§ï¼Œåˆæˆ–è€…æ˜¯æœºæˆ¿ç½‘ç»œè´¨é‡å·®ã€äº¤æ¢æœºè€æ—§çš„æ—¶å€™ï¼Œå°±éœ€è¦é¢å¤–æ³¨æ„virtual_router_idå†²çªçš„é—®é¢˜ã€‚ ä¸‹é¢æ‘˜å½•ä¸€æ®µkeepalivedå®˜ç½‘çš„ç›¸å…³æè¿°ï¼š arbitrary unique number from 1 to 255 used to differentiate multiple instances of vrrpd running on the same network interface and address family (and hence same socket). Note: using the same virtual_router_id with the same address family on different interfaces has been known to cause problems with some network switches; if you are experiencing problems with using the same virtual_router_id on different interfaces, but the problems are resolved by not duplicating virtual_router_ids, the your network switches are probably not functioning correctly. 4.1.2 è§£å†³æ€è·¯ç»„æ’­keepalivedä¸»å¤‡èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡é»˜è®¤æƒ…å†µä¸‹æ˜¯é€šè¿‡ç»„æ’­æ¥è¿›è¡Œçš„ï¼Œç»„æ’­çš„åŸç†è¿™é‡Œä¸èµ˜è¿°ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸è®ºæ˜¯IPv4è¿˜æ˜¯IPv6éƒ½ä¼šä½¿ç”¨ä¸€ä¸ªç»„æ’­åœ°å€ï¼Œå¯¹äºä¸€äº›å¸¸è§çš„å¦‚BGPã€VRRPåè®®çš„æ•°æ®åŒ…ï¼ŒRFCæ˜¯æœ‰æå‰å®šä¹‰åˆ’åˆ†å¥½ç›¸å¯¹åº”çš„ç»„æ’­åœ°å€ä¾›å…¶ä½¿ç”¨ï¼Œkeepalivedå®˜æ–¹ä½¿ç”¨çš„ç»„æ’­åœ°å€éµå¾ªå®šä¹‰è§„èŒƒï¼Œå…·ä½“å¦‚ä¸‹ï¼š Multicast Group to use for IPv4 VRRP adverts Defaults to the RFC5798 IANA assigned VRRP multicast address 224.0.0.18 which You typically do not want to change. vrrp_mcast_group4 224.0.0.18 Multicast Group to use for IPv6 VRRP adverts (default: ff02::12) vrrp_mcast_group6 ff02::12 å¦‚æœæˆ‘ä»¬æ²¡åŠæ³•ç¡®è®¤èŠ‚ç‚¹æ‰€å¤„ç½‘ç»œä¸­æ˜¯å¦æœ‰ä½¿ç”¨äº†è¯¥virtual_router_idçš„vrrp_instanceï¼Œå¯ä»¥å°è¯•ä¿®æ”¹ç»„æ’­åœ°å€æ¥é¿å…å†²çªã€‚ å•æ’­è¿˜æœ‰ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸ä½¿ç”¨ç»„æ’­ï¼Œæ”¹ä¸ºä½¿ç”¨å•æ’­ã€‚å•æ’­ä¸ä»…åœ¨ç½‘ç»œé€šä¿¡è´¨é‡ä¸Šå¾€å¾€æ¯”ç»„æ’­æ›´å¥½ï¼Œè€Œä¸”ä¹Ÿå¾ˆéš¾å‡ºç°virtual_router_idå†²çªçš„é—®é¢˜ã€‚åŒæ ·çš„ï¼Œå¦‚æœkeepalivedé›†ç¾¤ä¹‹é—´å‡ºç°å› ä¸ºä¸»å¤‡èŠ‚ç‚¹ä¹‹é—´ç»„æ’­é€šä¿¡è´¨é‡å·®å¯¼è‡´é¢‘ç¹å‡ºç°ä¸»å¤‡åˆ‡æ¢ï¼Œé™¤äº†æ”¹å–„èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ç½‘ç»œè´¨é‡ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥å°è¯•ä¿®æ”¹é€šä¿¡æ–¹å¼ä¸ºå•æ’­ã€‚ 1234567891011# ipv4ç½‘ç»œé…ç½®å•æ’­unicast_src_ip 192.168.229.1unicast_peer &#123; 192.168.229.2&#125;# ipv6ç½‘ç»œé…ç½®å•æ’­unicast_src_ip 2000::1unicast_peer &#123; 2000::2&#125; ä¸Šå›¾ä¸­çš„unicast_src_ipæ˜¯æœ¬æœºçš„IPï¼Œè€Œunicast_peeråˆ™æ˜¯å¯¹ç«¯çš„IPï¼Œæ³¨æ„è¿™é‡Œçš„unicast_peeræ˜¯å¯ä»¥æœ‰å¤šä¸ªIPçš„ï¼ˆå¯¹åº”ä¸€ä¸»ä¸€å¤‡å’Œä¸€ä¸»å¤šå¤‡æˆ–è€…å¤šå¤‡æŠ¢å ç­‰æƒ…å†µï¼‰ã€‚ å•æ’­è™½ç„¶åœ¨ç¨³å®šæ€§ä¸Šçš„è¡¨ç°æ›´åŠ ä¼˜ç§€ï¼Œä½†æ˜¯ç›¸åº”çš„é…ç½®é‡ä¹Ÿå¤§å¤§å¢åŠ ï¼Œéœ€è¦è¿ç»´åŒå­¦åœ¨æ¯ä¸€ç»„vrrp_instanceéƒ½å¢åŠ å¯¹åº”çš„å•æ’­é…ç½®ï¼Œå¹¶ä¸”ä¸»å¤‡èŠ‚ç‚¹ä¹‹é—´çš„é…ç½®å†…å®¹ä¹Ÿä¸åŒï¼ˆä¸€èˆ¬éƒ½æ˜¯unicast_src_ipå’Œunicast_peerå¯¹è°ƒï¼‰ã€‚å¹¶ä¸”å•æ’­ç›¸å…³é…ç½®ä¸€æ—¦æ”¹é”™å‡ ä¹å°±ä¼šå‘ç”Ÿè„‘è£‚ï¼Œè¿™å°±å¯¹é…ç½®ç®¡ç†æ£€æŸ¥å’Œåˆ†å‘æå‡ºäº†æ›´é«˜çš„è¦æ±‚ã€‚ 4.2 ä¸»å¤‡åˆ‡æ¢keepalivedä¸»å¤‡åˆ‡æ¢çš„æ—¶å€™å®¹æ˜“å‡ºç°çš„é—®é¢˜ä¸»è¦æ˜¯å½“IPå·²ç»åˆ‡æ¢åˆ°äº†å¦ä¸€å°æœºå™¨ï¼Œä½†æ˜¯å¯¹åº”äº¤æ¢æœºä¸Šé¢çš„MACåœ°å€è¡¨è®°å½•çš„VIPå¯¹åº”çš„MACåœ°å€è¿˜æ²¡æœ‰æ›´æ–°ã€‚è¿™ç§æƒ…å†µå¸¸è§çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨arpingï¼ˆIPv4ï¼‰æ“ä½œæˆ–è€…æ˜¯ping6ï¼ˆIPv6ï¼‰æ¥å¿«é€Ÿæ‰‹åŠ¨åˆ·æ–°MACè®°å½•æˆ–è€…æ˜¯é…ç½®keepalivedæ¥è‡ªåŠ¨æŒç»­åˆ·æ–°MACè®°å½•ã€‚ 4.2.1 æ‰‹åŠ¨åˆ·æ–°MACå¯¹äºDPVSç¨‹åºï¼Œåˆ·æ–°IPv4çš„VIPçš„MACåœ°å€æ—¶ï¼Œå¦‚æœVIPå’Œå¯¹åº”çš„kniç½‘å¡ä¸Šçš„IPæ˜¯åŒä¸€ä¸ªç½‘æ®µï¼Œåˆ™å¯ä»¥ç›´æ¥å¯¹kniç½‘å¡ä½¿ç”¨arpingå‘½ä»¤æ¥åˆ·æ–°MACåœ°å€ï¼ˆkniç½‘å¡å’ŒDPVSç½‘å¡çš„MACåœ°å€ä¸€è‡´ï¼‰ï¼›ä½†æ˜¯IPv6ç½‘ç»œå¹¶æ²¡æœ‰arpè¿™ä¸ªä¸œè¥¿ï¼Œåˆ·æ–°MACè®°å½•éœ€è¦ä½¿ç”¨ping6å‘½ä»¤ï¼Œè€Œè¿™åœ¨DPVSçš„kniç½‘å¡ä¸­æ˜¯è¡Œä¸é€šçš„ã€‚ä¸ªäººå»ºè®®ä½¿ç”¨pythonæˆ–goä¹‹ç±»çš„èƒ½å¤Ÿç½‘ç»œç¼–ç¨‹çš„è¯­è¨€ç¼–å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºå®ç°å‘é€gnaæ•°æ®åŒ…ï¼Œç„¶ååœ¨keepalivedä¸­é…ç½®è„šæœ¬å½“è¿›å…¥masterçŠ¶æ€çš„æ—¶å€™å°±æ‰§è¡Œè„šæœ¬åˆ·æ–°MACåœ°å€ï¼Œå³å¯è§£å†³IPv6ä¸‹VIPåˆ‡æ¢çš„MACåœ°å€æ›´æ–°é—®é¢˜ã€‚ 4.2.2 keepalivedåˆ·æ–°MACè¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯é…ç½®keepalivedï¼Œè®©keepalivedè‡ªå·±å‘é€garpå’Œgnaæ•°æ®åŒ…ï¼Œkeepalivedé…ç½®ä¸­æœ‰æ¯”è¾ƒå¤šçš„vrrp_garp*ç›¸å…³çš„é…ç½®å¯ä»¥è°ƒæ•´å‘é€garpå’Œgnaæ•°æ®åŒ…çš„å‚æ•° 12345678# å‘é€garp/gnaæ•°æ®åŒ…çš„é—´éš”ã€‚è¿™é‡Œæ˜¯æ¯10ç§’å‘é€ä¸€è½®vrrp_garp_master_refresh 10# æ¯æ¬¡å‘é€ä¸‰ä¸ªgarp/gnaæ•°æ®åŒ…vrrp_garp_master_refresh_repeat 3# æ¯ä¸ªgarpæ•°æ®åŒ…çš„å‘é€é—´éš”ä¸º0.001ç§’vrrp_garp_interval 0.001# æ¯ä¸ªgnaæ•°æ®åŒ…çš„å‘é€é—´éš”ä¸º0.001ç§’vrrp_gna_interval 0.001 ä¸è¿‡ä½¿ç”¨keepalivedé…ç½®è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼š keepalivedå‘é€garp/gnaæ•°æ®åŒ…çš„ç½‘å¡æ˜¯interfaceå‚æ•°æŒ‡å®šçš„ç½‘å¡ï¼Œä¹Ÿå°±æ˜¯ä¸»å¤‡èŠ‚ç‚¹ç”¨æ¥é€šä¿¡çš„ç½‘å¡ keepalivedå‘é€çš„garp/gnaæ•°æ®åŒ…æƒ³è¦ç”Ÿæ•ˆå¿…é¡»è¦æ˜¯VIPæ‰€åœ¨çš„DPVSä¸­çš„ç½‘å¡æˆ–è€…æ˜¯å¯¹åº”çš„kniç½‘å¡ å› æ­¤å¦‚æœæƒ³è®©keepalivedæ¥åˆ·æ–°VIPçš„MACåœ°å€ï¼Œéœ€è¦å°†è¿™ä¸ªç½‘å¡ä¿®æ”¹ä¸ºæœ¬æ–‡æ¶æ„å›¾ä¸­çš„bond2.kniç½‘å¡ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”åŒè‡‚ç½‘ç»œæ¶æ„æ¨¡å¼ä¸‹çš„å¤–ç½‘ç½‘å¡ï¼ŒåŒæ—¶å¦‚æœä½¿ç”¨å•æ’­é€šä¿¡çš„è¯è¿˜éœ€è¦åŠ ä¸Šå¯¹åº”èŠ‚ç‚¹çš„kni_hostè·¯ç”±ä»¥ç¡®ä¿å•æ’­èƒ½æ­£å¸¸é€šä¿¡ã€‚ 4.2.3 å°ç»“ä»¥ä¸Šä¸¤ç§æ–¹æ¡ˆå„æœ‰ä¼˜åŠ£ï¼Œéœ€è¦ç»“åˆå†…å¤–ç½‘ç½‘ç»œè´¨é‡ã€ä½¿ç”¨å•æ’­è¿˜æ˜¯å¤šæ’­ã€ç½‘ç»œè·¯ç”±é…ç½®ç®¡ç†ã€keepalivedæ–‡ä»¶ç®¡ç†ç­‰å¤šä¸ªå› ç´ è€ƒè™‘ã€‚ 5ã€é›†ç¾¤æœ€å¤§è¿æ¥æ•°è¿™éƒ¨åˆ†ä¸»è¦æ˜¯åˆ†æå¯¹æ¯”ä¼ ç»Ÿçš„LVS-DRæ¨¡å¼å’ŒDPVS-FNATæ¨¡å¼ä¸‹ä¸¤è€…çš„æœ€å¤§TCPè¿æ¥æ•°æ€§èƒ½é™åˆ¶ç“¶é¢ˆã€‚ 5.1 LVS-DRæ¨¡å¼é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ä¼ ç»Ÿçš„LVS-DRæ¨¡å¼ä¸‹çš„è¿æ¥è¡¨ 1234567891011[root@lvs]# ipvsadm -lnc | head | column -tIPVS connection entriespro expire state source virtual destinationTCP 00:16 FIN_WAIT 44.73.152.152:54300 10.0.96.104:80 192.168.229.111:80TCP 00:34 FIN_WAIT 225.155.149.221:55182 10.0.96.104:80 192.168.229.117:80TCP 00:22 ESTABLISHED 99.251.37.22:53601 10.0.96.104:80 192.168.229.116:80TCP 01:05 FIN_WAIT 107.111.180.141:15997 10.0.96.104:80 192.168.229.117:80TCP 00:46 FIN_WAIT 44.108.145.205:57801 10.0.96.104:80 192.168.229.116:80TCP 12:01 ESTABLISHED 236.231.219.215:36811 10.0.96.104:80 192.168.229.111:80TCP 01:36 FIN_WAIT 91.90.162.249:52287 10.0.96.104:80 192.168.229.116:80TCP 01:41 FIN_WAIT 85.35.41.0:44148 10.0.96.104:80 192.168.229.112:80 ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºDPVSçš„è¿æ¥è¡¨å’ŒLVSçš„è¿æ¥è¡¨åŸºæœ¬ä¸Šå¤§åŒå°å¼‚ï¼ŒDPVSå¤šäº†ä¸€åˆ—CPUæ ¸å¿ƒæ•°å’ŒLIPä¿¡æ¯ï¼Œä½†æ˜¯ä»åŸç†ä¸Šæœ‰ç€æå¤§çš„åŒºåˆ«ã€‚ ä»¥ä¸‹åˆ†æå‡å®šå…¶ä»–æ€§èƒ½é™åˆ¶æ¡ä»¶æ— ç“¶é¢ˆ é¦–å…ˆå¯¹äºLVS-DRæ¨¡å¼è€Œè¨€ï¼Œæˆ‘ä»¬çŸ¥é“Clientæ˜¯ç›´æ¥å’ŒRSå»ºç«‹è¿æ¥çš„ï¼ŒLVSåœ¨æ­¤è¿‡ç¨‹ä¸­æ˜¯åªåšæ•°æ®åŒ…è½¬å‘çš„å·¥ä½œï¼Œä¸æ¶‰åŠå»ºç«‹è¿æ¥è¿™ä¸ªæ­¥éª¤ï¼Œé‚£ä¹ˆå½±å“è¿æ¥æ•°é‡çš„å°±æ˜¯Protocolã€CIP:Portã€RIP:Portè¿™äº”ä¸ªå˜é‡ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„äº”å…ƒç»„ã€‚ 1Protocol CIP:Port RIP:Port è€ƒè™‘åˆ°Protocolä¸æ˜¯TCPå°±æ˜¯UDPï¼Œå¯ä»¥å°†å…¶è§†ä¸ºå¸¸é‡ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹LVS-DRè€Œè¨€ï¼šçœŸæ­£å½±å“TCPè¿æ¥æ•°çš„æ˜¯CIP:Portï¼ˆRIP:Portå¾€å¾€æ˜¯å›ºå®šçš„ï¼‰ï¼Œä½†æ˜¯ç”±äºCIP:Portç†è®ºä¸Šæ˜¯å¯ä»¥è¶³å¤Ÿå¤šçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™TCPè¿æ¥æ•°çš„æœ€å¤§é™åˆ¶å¾€å¾€æ˜¯åœ¨RSä¸Šé¢ï¼Œä¹Ÿå°±æ˜¯RSçš„æ•°é‡å’ŒRSçš„æ€§èƒ½å†³å®šäº†æ•´ä¸ªLVS-DRé›†ç¾¤çš„æœ€å¤§TCPè¿æ¥æ•°ã€‚ 5.2 DPVS-FNATæ¨¡å¼æ¥ç€æˆ‘ä»¬ä½¿ç”¨ipvsadm -lncå‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸‹FNATæ¨¡å¼ä¸‹çš„Client&lt;--&gt;DPVS&lt;--&gt;RSä¹‹é—´çš„è¿æ¥æƒ…å†µï¼š 12345678910111213141516171819202122[root@dpvs dpvs]# ipvsadm -lnc | head[1]tcp 90s TCP_EST 197.194.123.33:56058 10.0.96.216:443 192.168.228.1:41136 192.168.229.80:443[1]tcp 7s TIME_WAIT 26.251.198.234:21164 10.0.96.216:80 192.168.228.1:44896 192.168.229.89:80[1]tcp 7s TIME_WAIT 181.112.211.168:46863 10.0.96.216:80 192.168.228.1:62976 192.168.229.50:80[1]tcp 90s TCP_EST 242.73.154.166:9611 10.0.96.216:443 192.168.228.1:29552 192.168.229.87:443[1]tcp 3s TCP_CLOSE 173.137.182.178:53264 10.0.96.216:443 192.168.228.1:8512 192.168.229.87:443[1]tcp 90s TCP_EST 14.53.6.35:23820 10.0.96.216:443 192.168.228.1:44000 192.168.229.50:443[1]tcp 3s TCP_CLOSE 35.13.251.48:15348 10.0.96.216:443 192.168.228.1:16672 192.168.229.79:443[1]tcp 90s TCP_EST 249.109.242.104:5566 10.0.96.216:443 192.168.228.1:10112 192.168.229.77:443[1]tcp 3s TCP_CLOSE 20.145.41.157:6179 10.0.96.216:443 192.168.228.1:15136 192.168.229.86:443[1]tcp 90s TCP_EST 123.34.92.153:15118 10.0.96.216:443 192.168.228.1:9232 192.168.229.87:443[root@dpvs dpvs]# ipvsadm -lnc | tail[16]tcp 90s TCP_EST 89.99.59.41:65197 10.0.96.216:443 192.168.228.1:7023 192.168.229.50:443[16]tcp 3s TCP_CLOSE 185.97.221.45:18862 10.0.96.216:443 192.168.228.1:48159 192.168.229.50:443[16]tcp 90s TCP_EST 108.240.236.85:64013 10.0.96.216:443 192.168.228.1:49199 192.168.229.50:443[16]tcp 90s TCP_EST 85.173.18.255:53586 10.0.96.216:443 192.168.228.1:63007 192.168.229.87:443[16]tcp 90s TCP_EST 182.123.32.10:5912 10.0.96.216:443 192.168.228.1:19263 192.168.229.77:443[16]tcp 90s TCP_EST 135.35.212.181:51666 10.0.96.216:443 192.168.228.1:22223 192.168.229.88:443[16]tcp 90s TCP_EST 134.210.227.47:29393 10.0.96.216:443 192.168.228.1:26975 192.168.229.90:443[16]tcp 7s TIME_WAIT 110.140.221.121:54046 10.0.96.216:443 192.168.228.1:5967 192.168.229.84:443[16]tcp 3s TCP_CLOSE 123.129.23.120:18550 10.0.96.216:443 192.168.228.1:7567 192.168.229.83:443[16]tcp 90s TCP_EST 72.250.60.207:33043 10.0.96.216:443 192.168.228.1:53279 192.168.229.86:443 ç„¶åæˆ‘ä»¬é€ä¸ªåˆ†æè¿™äº›å­—æ®µçš„å«ä¹‰ï¼š [1]ï¼šè¿™ä¸ªæ•°å­—è¡¨ç¤ºçš„æ˜¯CPUæ ¸å¿ƒæ•°ï¼Œå¯¹åº”æˆ‘ä»¬åœ¨dpvs.confä¸­é…ç½®çš„worker cpuçš„cpu_idï¼Œä»è¿™ä¸ªå­—æ®µå¯ä»¥çœ‹åˆ°æ¯ä¸ªDPVSè¿›ç¨‹çš„workerçº¿ç¨‹å·¥ä½œçš„è´Ÿè½½æƒ…å†µ tcpï¼štcpæˆ–è€…udpï¼Œå¯¹åº”è¿™ä¸€æ¡è¿æ¥çš„ç±»å‹ï¼Œè¿™ä¸ªæ— éœ€è§£é‡Š 90sã€30sã€7sã€3sï¼šå¯¹åº”è¿™ä¸€æ¡è¿æ¥çš„æ—¶é—´ CLOSE_WAITã€FIN_WAITã€SYN_RECVã€TCP_CLOSEã€TCP_ESTã€TIME_WAITï¼šå¯¹åº”è¿™ä¸€æ¡tcpè¿æ¥çš„çŠ¶æ€ æœ€åè¿™ä¸€ç»„å››ä¸ªIP+Portçš„ç»„åˆå°±æ˜¯Client&lt;--&gt;DPVS&lt;--&gt;RSçš„å¯¹åº”å…³ç³»ï¼š 1CIP:Port VIP:Port LIP:Port RIP:Port é‚£ä¹ˆå¯¹äºDPVS-FNATæ¨¡å¼æ¥è¯´ï¼ŒåŠ å…¥äº†LIPä¹‹åå˜æˆäº†å››ç»„IP+Portçš„ç»„åˆï¼Œå†åŠ ä¸Šå‰é¢çš„cpu_idå’ŒProtocolå°±æ˜¯å½±å“è¿æ¥æ•°çš„åå…ƒç»„ã€‚ 1cpu_id Protocol CIP:Port VIP:Port LIP:Port RIP:Port å¼€å§‹åˆ†æä¹‹å‰æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸Šé¢çš„è¿™å››ç»„IP+Portçš„ç»„åˆå®é™…ä¸Šæ˜¯åˆ†ä¸ºä¸¤ä¸ªå››å…ƒç»„ï¼Œå³CIP:Port VIP:Portä¸ºä¸€ä¸ªå››å…ƒç»„ï¼ŒLIP:Port RIP:Portä¸ºä¸€ä¸ªå››å…ƒç»„ï¼Œä¸¤ä¸ªå››å…ƒç»„ä¹‹é—´ä¸ºä¸€ä¸€å¯¹åº”å…³ç³» é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯æ’é™¤æ‰Protocolã€VIP:Portå’ŒRIP:Portï¼Œå› ä¸ºè¿™ä¸‰ç»„äº”ä¸ªå˜é‡åŸºæœ¬ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œå¯ä»¥è§†ä¸ºå¸¸é‡ æ¥ç€æ˜¯CIP:Portç†è®ºä¸Šæ˜¯å¯ä»¥è¶³å¤Ÿå¤šçš„ï¼Œä¸ä¼šå¯¹æˆ‘ä»¬çš„é›†ç¾¤æœ€å¤§TCPè¿æ¥æ•°äº§ç”Ÿå½±å“ ç„¶åæ˜¯cpu_idï¼Œè™½ç„¶ä¸€å°æœºå™¨æœ€å¤šå¯ä»¥æœ‰16ä¸ªwork cpuï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€åå…ƒç»„çš„æœ€å¤§è¿æ¥æ•°=é™¤cpu_idå¤–çš„ä¹å…ƒç»„çš„æœ€å¤§è¿æ¥æ•°*16ï¼ŒDPVSç¨‹åºä¼šæŠŠcpu_idæ ¹æ®LIPçš„ç«¯å£å·è¿›è¡Œåˆ†é…ï¼Œä»è€Œå°½å¯èƒ½åœ°æŠŠè´Ÿè½½å‡åˆ†åˆ°æ‰€æœ‰çš„CPUä¸Šé¢ã€‚æ‰€ä»¥è¿™é‡Œçš„cpu_idå’ŒLIPçš„ç«¯å£å·ä¹Ÿæ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³» æœ€åæ˜¯LIP:Portï¼Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªIPå¯ä»¥ä½¿ç”¨çš„ç«¯å£æ•°é‡æœ€å¤šä¸è¶…è¿‡65536ä¸ªï¼Œç”±äºRIP:Portæ˜¯å›ºå®šçš„ï¼Œå› æ­¤è¿™ä¸ªå››å…ƒç»„çš„æœ€å¤§TCPè¿æ¥æ•°&lt;=LIPæ•°é‡*65536*RIPæ•°é‡ åˆå› ä¸ºä¸¤ä¸ªå››å…ƒç»„ä¹‹é—´ä¸ºä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œcpu_idå’ŒLIPçš„ç«¯å£å·ä¹Ÿæ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œæ‰€ä»¥å¯¹äºDPVS-FNATæ¨¡å¼æ¥è¯´ï¼ŒLIPçš„æ•°é‡å¾€å¾€æ‰æ˜¯é™åˆ¶æ•´ä¸ªé›†ç¾¤æœ€å¤§è¿æ¥æ•°çš„å…³é”®ï¼Œå¦‚æœé›†ç¾¤æœ‰å¤šè¿æ¥æ•°çš„éœ€æ±‚ï¼Œå»ºè®®åœ¨è§„åˆ’ä¹‹åˆå°±è¦é¢„ç•™è¶³å¤Ÿæ•°é‡çš„IPç»™LIPä½¿ç”¨ã€‚ è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£å’Œå®æµ‹ï¼Œx520/82599ã€x710ç½‘å¡åœ¨ä½¿ç”¨igb_uioè¿™ä¸ªPMDçš„æ—¶å€™ï¼Œåœ¨ipv6ç½‘ç»œä¸‹fdirä¸æ”¯æŒperfectæ¨¡å¼ï¼Œå»ºè®®ä½¿ç”¨signatureæ¨¡å¼ï¼Œä½†æ˜¯æ³¨æ„è¿™ä¸ªæ¨¡å¼ä¸‹ä»…å¯ä½¿ç”¨ä¸€ä¸ªLIPï¼Œä¼šå¯¹é›†ç¾¤çš„æœ€å¤§è¿æ¥æ•°æœ‰é™åˆ¶ã€‚ å®˜æ–¹æ–‡æ¡£é“¾æ¥å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚ We found there exists some NICs do not (fully) support Flow Control of IPv6 required by IPv6. For example, the rte_flow of 82599 10GE Controller (ixgbe PMD) relies on an old fashion flow type flow director (fdir), which doesnâ€™t support IPv6 in its perfect mode, and support only one local IPv4 or IPv6 in its signature mode. DPVS supports the fdir mode config for compatibility. 6ã€å†™åœ¨æœ€åDPVSç¡®å®åœ¨æ€§èƒ½å’ŒåŠŸèƒ½æ–¹é¢éƒ½æœ‰ç€éå¸¸ä¼˜ç§€çš„è¡¨ç°ï¼Œä¹Ÿç¡®å®åœ¨è½åœ°åˆæœŸä¼šè¸©å¾ˆå¤šå‘ï¼Œå»ºè®®å¤šçœ‹æ–‡æ¡£ï¼Œå¤šæŸ¥èµ„æ–™ï¼Œå¤šçœ‹æºç ï¼Œç­‰åˆ°çœŸæ­£ç”¨èµ·æ¥ä¹‹åä¹Ÿç¡®å®ä¼šç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤šçš„æƒŠå–œå’Œæ”¶è·ã€‚æœ€åé¡ºä¾¿æä¸€å¥ï¼Œå¦‚æœåªæƒ³æ­å»ºä¸€ä¸ªå°è§„æ¨¡é›†ç¾¤å°å°é²œï¼Œæ™®é€šçš„IPv4ç½‘ç»œå’Œå¸¸è§çš„x520ç½‘å¡å°±è¶³å¤Ÿäº†ï¼Œå½“ç„¶æœ‰æ¡ä»¶çš„åŒå­¦å¯ä»¥å°è¯•ä½¿ç”¨ECMPæ¶æ„å’Œä¸€äº›æ¯”è¾ƒå¥½çš„ç½‘å¡ï¼ˆå¦‚Mellanoxï¼‰ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"},{"name":"nat","slug":"nat","permalink":"https://tinychen.com/tags/nat/"},{"name":"lvs","slug":"lvs","permalink":"https://tinychen.com/tags/lvs/"},{"name":"keepalived","slug":"keepalived","permalink":"https://tinychen.com/tags/keepalived/"},{"name":"dpdk","slug":"dpdk","permalink":"https://tinychen.com/tags/dpdk/"},{"name":"dpvs","slug":"dpvs","permalink":"https://tinychen.com/tags/dpvs/"}]},{"title":"DPVS-FullNATæ¨¡å¼ç®¡ç†ç¯‡","slug":"20210810-dpvs-fullnat-management","date":"2021-08-10T09:00:00.000Z","updated":"2021-08-10T09:00:00.000Z","comments":true,"path":"20210810-dpvs-fullnat-management/","link":"","permalink":"https://tinychen.com/20210810-dpvs-fullnat-management/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»åŸºäºCentOS7.9ç³»ç»Ÿéƒ¨ç½²DPVSçš„FullNATæ¨¡å¼çš„å„ç§éƒ¨ç½²æ–¹å¼å’Œé…ç½®ç®¡ç†ï¼ŒåŒ…æ‹¬IPv4-IPv4ã€bondingã€IPv6-IPv6ã€IPv6-IPv4ï¼ˆNAT64ï¼‰å’Œkeepalivedæ¨¡å¼è¿™äº”ç§æ–¹æ¡ˆã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»åŸºäºCentOS7.9ç³»ç»Ÿéƒ¨ç½²DPVSçš„FullNATæ¨¡å¼çš„å„ç§éƒ¨ç½²æ–¹å¼å’Œé…ç½®ç®¡ç†ï¼ŒåŒ…æ‹¬IPv4-IPv4ã€bondingã€IPv6-IPv6ã€IPv6-IPv4ï¼ˆNAT64ï¼‰å’Œkeepalivedæ¨¡å¼è¿™äº”ç§æ–¹æ¡ˆã€‚ ä»¥ä¸‹çš„é…ç½®å…¨éƒ¨åŸºäºåŒè‡‚æ¨¡å¼ï¼Œå¹¶ä¸”RSæœºå™¨ä¸Šé¢å·²ç»å®‰è£…äº†DPVSç›¸åº”çš„toaæ¨¡å—ã€‚æˆ‘ä»¬å…ˆä»å•ä¸ªç½‘å¡çš„IPv4ç®€å•é…ç½®å¼€å§‹ï¼Œæ¥ç€å†åšbondingé…ç½®ï¼Œç„¶åå†è¿›è¡ŒIPv6ç®€å•é…ç½®ï¼ŒNAT64é…ç½®ä»¥åŠæœ€åä½¿ç”¨keepalivedé…ç½®ä¸»å¤‡æ¨¡å¼ã€‚ æœ¬æ–‡ä¸­å®‰è£…çš„DPVSç‰ˆæœ¬ä¸º1.8-10ï¼Œdpdkç‰ˆæœ¬ä¸º18.11.2ï¼Œè¯¦ç»†å®‰è£…è¿‡ç¨‹å·²åœ¨ä¹‹å‰çš„æ–‡ç« DPVS-FullNATæ¨¡å¼éƒ¨ç½²ç¯‡ - TinyChenâ€™s Studioä¸­å™è¿°è¿‡ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚ 1ã€IPv4ç®€å•é…ç½®1.1 æ¶æ„å›¾é¦–å…ˆæ˜¯æœ€ç®€å•çš„é…ç½®æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ipvsadmçš„å‘½ä»¤è¡Œæ“ä½œæ¥å®ç°ä¸€ä¸ªIPv4ç½‘ç»œçš„FullNatæ¨¡å¼ï¼Œæ¶æ„å›¾å¦‚ä¸‹ï¼š è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨dpdk2ç½‘å¡ä½œä¸ºwanå£ï¼Œdpdk0ç½‘å¡ä½œä¸ºlanå£ 1.2 é…ç½®è¿‡ç¨‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# é¦–å…ˆæˆ‘ä»¬æŠŠVIP 10.0.96.204 åŠ åˆ°dpdk2ç½‘å¡ï¼ˆwanï¼‰ä¸Š$ dpip addr add 10.0.96.204/32 dev dpdk2# æ¥ç€æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸¤æ¡è·¯ç”±ï¼Œåˆ†ä¸ºæ˜¯wanå£ç½‘æ®µçš„è·¯ç”±å’Œåˆ°RSæœºå™¨ç½‘æ®µçš„è·¯ç”±$ dpip route add 10.0.96.0/24 dev dpdk2$ dpip route add 192.168.229.0/24 dev dpdk0# æœ€å¥½å†åŠ ä¸€æ¡åˆ°ç½‘å…³çš„é»˜è®¤è·¯ç”±ä¿è¯ICMPæ•°æ®åŒ…çš„å›åŒ…èƒ½è·‘é€š$ dpip route add default via 10.0.96.254 dev dpdk2# ä½¿ç”¨RRç®—æ³•å»ºç«‹è½¬å‘è§„åˆ™# add service &lt;VIP:vport&gt; to forwarding, scheduling mode is RR.# use ipvsadm --help for more info.$ ipvsadm -A -t 10.0.96.204:80 -s rr# è¿™é‡Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•æˆ‘ä»¬åªæ·»åŠ ä¸€å°RS# add two RS for service, forwarding mode is FNAT (-b)$ ipvsadm -a -t 10.0.96.204:80 -r 192.168.229.1 -b# æ·»åŠ LocalIPåˆ°ç½‘ç»œä¸­ï¼ŒFNATæ¨¡å¼è¿™é‡Œéœ€è¦# add at least one Local-IP (LIP) for FNAT on LAN interface$ ipvsadm --add-laddr -z 192.168.229.204 -t 10.0.96.204:80 -F dpdk0# ç„¶åæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ•ˆæœ$ dpip route showinet 192.168.229.204/32 via 0.0.0.0 src 0.0.0.0 dev dpdk0 mtu 1500 tos 0 scope host metric 0 proto autoinet 10.0.96.204/32 via 0.0.0.0 src 0.0.0.0 dev dpdk2 mtu 1500 tos 0 scope host metric 0 proto autoinet 10.0.96.0/24 via 0.0.0.0 src 0.0.0.0 dev dpdk2 mtu 1500 tos 0 scope link metric 0 proto autoinet 192.168.229.0/24 via 0.0.0.0 src 0.0.0.0 dev dpdk0 mtu 1500 tos 0 scope link metric 0 proto autoinet 0.0.0.0/0 via 10.0.96.254 src 0.0.0.0 dev dpdk2 mtu 1500 tos 0 scope global metric 0 proto auto$ dpip addr showinet 10.0.96.204/32 scope global dpdk2 valid_lft forever preferred_lft foreverinet 192.168.229.204/32 scope global dpdk0 valid_lft forever preferred_lft forever$ ipvsadm -lnIP Virtual Server version 0.0.0 (size=0)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 10.0.96.204:80 rr -&gt; 192.168.229.1:80 FullNat 1 0 0$ ipvsadm -GVIP:VPORT TOTAL SNAT_IP CONFLICTS CONNS10.0.96.204:80 1 192.168.229.204 0 0 ç„¶åæˆ‘ä»¬åœ¨RSä¸Šé¢å¯åŠ¨ä¸€ä¸ªnginxï¼Œè®¾ç½®è¿”å›IPå’Œç«¯å£å·ï¼Œç„¶åç›´æ¥å¯¹VIPä½¿ç”¨pingå’Œcurlå‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼š 12345678910111213$ ping -c4 10.0.96.204PING 10.0.96.204 (10.0.96.204) 56(84) bytes of data.64 bytes from 10.0.96.204: icmp_seq=1 ttl=54 time=47.2 ms64 bytes from 10.0.96.204: icmp_seq=2 ttl=54 time=48.10 ms64 bytes from 10.0.96.204: icmp_seq=3 ttl=54 time=48.5 ms64 bytes from 10.0.96.204: icmp_seq=4 ttl=54 time=48.5 ms--- 10.0.96.204 ping statistics ---4 packets transmitted, 4 received, 0% packet loss, time 8msrtt min/avg/max/mdev = 47.235/48.311/48.969/0.684 ms$ curl 10.0.96.204Your IP and port is 172.16.0.1:62844 1.3 å°ç»“è¯¥æ¨¡å¼éå¸¸çš„ç®€å•ï¼Œå¯ä»¥å¿«é€Ÿé…ç½®æ£€éªŒè‡ªå·±æœºå™¨ä¸Šçš„DPVSèƒ½å¦æ­£å¸¸å·¥ä½œï¼Œä¸è¿‡ç”±äºæ˜¯å•ç‚¹ï¼Œå¾€å¾€è¾ƒå°‘ä½¿ç”¨ã€‚ 2ã€bondingé…ç½®ç›®å‰DPVSæ”¯æŒé…ç½®bonding4å’Œbonding0ï¼Œä¸¤è€…çš„é…ç½®åŸºæœ¬ç›¸åŒï¼Œé…ç½®æ–¹å¼å¯ä»¥å‚è€ƒdpvs/conf/dpvs.conf.single-bond.sampleè¿™ä¸ªæ–‡ä»¶ã€‚ é…ç½®bondingæ¨¡å¼çš„æ—¶å€™ï¼Œä¸éœ€è¦å¯¹slaveç½‘å¡ï¼ˆå¦‚dpdk0ç­‰ï¼‰æŒ‡å®škni_nameè¿™ä¸ªå‚æ•°ï¼Œè€Œæ˜¯è¦åœ¨bondingä¸­æŒ‡å®šå¯¹åº”çš„kni_nameï¼ŒåŒæ—¶è¿˜è¦æ³¨æ„primaryå‚æ•°æŒ‡å®šçš„ç½‘å¡çš„MACåœ°å€ä¸€èˆ¬å°±æ˜¯bondingç½‘å¡çš„MACåœ°å€ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109! netif confignetif_defs &#123; &lt;init&gt; pktpool_size 1048575 &lt;init&gt; pktpool_cache 256 &lt;init&gt; device dpdk0 &#123; rx &#123; max_burst_size 32 queue_number 16 descriptor_number 1024 rss all &#125; tx &#123; max_burst_size 32 queue_number 16 descriptor_number 1024 &#125; fdir &#123; mode perfect pballoc 64k status matched &#125; ! mtu 1500 ! promisc_mode ! kni_name dpdk0.kni &#125; &lt;init&gt; device dpdk1 &#123; rx &#123; max_burst_size 32 queue_number 16 descriptor_number 1024 rss all &#125; tx &#123; max_burst_size 32 queue_number 16 descriptor_number 1024 &#125; fdir &#123; mode perfect pballoc 64k status matched &#125; ! mtu 1500 ! promisc_mode ! kni_name dpdk1.kni &#125; &lt;init&gt; device dpdk2 &#123; rx &#123; max_burst_size 32 queue_number 16 descriptor_number 1024 rss all &#125; tx &#123; max_burst_size 32 queue_number 16 descriptor_number 1024 &#125; fdir &#123; mode perfect pballoc 64k status matched &#125; ! mtu 1500 ! promisc_mode ! kni_name dpdk2.kni &#125; &lt;init&gt; device dpdk3 &#123; rx &#123; max_burst_size 32 queue_number 16 descriptor_number 1024 rss all &#125; tx &#123; max_burst_size 32 queue_number 16 descriptor_number 1024 &#125; fdir &#123; mode perfect pballoc 64k status matched &#125; ! mtu 1500 ! promisc_mode ! kni_name dpdk3.kni &#125; &lt;init&gt; bonding bond1 &#123; mode 4 slave dpdk0 slave dpdk1 primary dpdk0 kni_name bond1.kni &#125; &lt;init&gt; bonding bond2 &#123; mode 4 slave dpdk2 slave dpdk3 primary dpdk2 kni_name bond2.kni &#125;&#125; éšååœ¨é…ç½®æ¯ä¸ªworker-cpuçš„æ—¶å€™è¦æ³¨æ„portè¦é€‰æ‹©å¯¹åº”çš„bondç½‘å¡ 123456789101112&lt;init&gt; worker cpu1 &#123; type slave cpu_id 1 port bond1 &#123; rx_queue_ids 0 tx_queue_ids 0 &#125; port bond2 &#123; rx_queue_ids 0 tx_queue_ids 0 &#125;&#125; DPVSçš„bondingé…ç½®å’Œåœ¨Linuxä¸­ç›´æ¥æ“ä½œä¸€æ ·ã€‚bondingé…ç½®æˆåŠŸååªéœ€è¦å¯¹ç”Ÿæˆçš„bondingç½‘å¡æ“ä½œå³å¯ï¼Œä½¿ç”¨dpipå‘½ä»¤å¯ä»¥æŸ¥çœ‹å¯¹åº”ç½‘å¡çš„å·¥ä½œçŠ¶æ€ï¼šå¦‚ä¸‹é¢çš„ç½‘å¡å°±å·¥ä½œåœ¨å…¨åŒå·¥ã€20000 Mbpsé€Ÿç‡çš„æ¨¡å¼ä¸‹ï¼ŒMTUä¸º1500ï¼Œå¹¶ä¸”åœ¨DPVSä¸­é…ç½®äº†16ä¸ªæ”¶å‘é˜Ÿåˆ—ã€‚ 1234567$ dpip link show5: bond1: socket 0 mtu 1500 rx-queue 15 tx-queue 16 UP 20000 Mbps full-duplex auto-nego addr AA:BB:CC:11:22:336: bond2: socket 0 mtu 1500 rx-queue 15 tx-queue 16 UP 20000 Mbps full-duplex auto-nego addr AA:BB:CC:12:34:56 3ã€IPv6ç®€å•é…ç½®3.1 DPVSé…ç½®è¿‡ç¨‹IPv6çš„ç®€å•é…ç½®æ–¹æ³•å’ŒIPv4ä¸€æ ·ï¼Œåªæ˜¯æŠŠå¯¹åº”çš„IPv4åœ°å€æ¢æˆäº†IPv6åœ°å€ï¼ŒåŒæ—¶è¿˜éœ€è¦é¢å¤–æ³¨æ„ä¸€ä¸‹IPv6åœ°å€æŒ‡å®šç«¯å£çš„æ—¶å€™éœ€è¦ä½¿ç”¨[]å°†IPåœ°å€æ‹¬èµ·æ¥ã€‚ 123456789101112131415161718192021222324252627282930313233343536# æ·»åŠ VIPå’Œç›¸å…³è·¯ç”±$ dpip addr add 2001::201/128 dev bond2$ dpip route -6 add 2001::/64 dev bond2$ dpip route -6 add 2407::/64 dev bond1$ dpip route -6 add default via 2001::1 dev bond2# é…ç½®ipvsadmå’ŒRS$ ipvsadm -A -t [2001::201]:80 -s rr$ ipvsadm -a -t [2001::201]:80 -r [2407::1]:80 -b$ ipvsadm -a -t [2001::201]:80 -r [2407::2]:80 -b# æ·»åŠ IPv6 LIP$ ipvsadm --add-laddr -z 2407::201 -t [2001::201]:80 -F bond1$ dpip addr showinet6 2407::201/128 scope global bond1 valid_lft forever preferred_lft foreverinet6 2001::201/128 scope global bond2 valid_lft forever preferred_lft forever $ dpip route -6 showinet6 2001::201/128 dev bond2 mtu 1500 scope hostinet6 2407::201/128 dev bond1 mtu 1500 scope hostinet6 2407::/64 dev bond1 mtu 1500 scope linkinet6 2001::/64 dev bond2 mtu 1500 scope linkinet6 default via 2001::1 dev bond2 mtu 1500 scope global$ ipvsadm -LnIP Virtual Server version 0.0.0 (size=0)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP [2001::201]:80 rr -&gt; [2407::1]:80 FullNat 1 0 0 -&gt; [2407::2]:80 FullNat 1 0 0 3.2 æ•ˆæœæ£€éªŒæµ‹è¯•æ•ˆæœï¼Œç¡®è®¤RSä¸Šé¢çš„nginxèƒ½å¤Ÿæ­£å¸¸è¿”å›ç”¨æˆ·ç«¯çš„çœŸå®IPå’Œç«¯å£ï¼Œåˆ™è¡¨æ˜é…ç½®æ­£å¸¸ã€‚ 12$ curl -6 &quot;http://\\[2001::201\\]&quot;Your IP and port is [2408::1]:38383 4ã€NAT64é…ç½®4.1 DPVSé…ç½®è¿‡ç¨‹æ¶æ„å›¾ä¸Šå’Œä¹‹å‰çš„ä¸¤ä¸ªå¹¶æ²¡å¤ªå¤§çš„ä¸åŒï¼Œåªæ˜¯IPç•¥æœ‰å·®å¼‚ 12345678910111213141516171819202122232425262728293031323334353637# æ·»åŠ VIPå’Œç›¸å…³è·¯ç”±$ dpip addr add 2001::201/128 dev bond2$ dpip route -6 add 2001::/64 dev bond2$ dpip route add 192.168.229.0/23 dev bond1$ dpip route -6 add default via 2001::1 dev bond2# é…ç½®ipvsadmå’ŒRS$ ipvsadm -A -t [2001::201]:80 -s rr$ ipvsadm -a -t [2001::201]:80 -r 192.168.229.1:80 -b$ ipvsadm -a -t [2001::201]:80 -r 192.168.229.2:80 -b# æ·»åŠ IPv6 LIP$ ipvsadm --add-laddr -z 192.168.229.201 -t [2001::201]:80 -F bond1$ dpip addr showinet6 2001::201/128 scope global bond2 valid_lft forever preferred_lft foreverinet 192.168.229.201/32 scope global bond1 valid_lft forever preferred_lft forever $ dpip route showinet 192.168.229.201/32 via 0.0.0.0 src 0.0.0.0 dev bond1 mtu 1500 tos 0 scope host metric 0 proto autoinet 192.168.229.0/23 via 0.0.0.0 src 0.0.0.0 dev bond1 mtu 1500 tos 0 scope link metric 0 proto auto$ dpip route -6 showinet6 2001::201/128 dev bond2 mtu 1500 scope hostinet6 2001::/64 dev bond2 mtu 1500 scope linkinet6 default via 2001::1 dev bond2 mtu 1500 scope global$ ipvsadm -lnIP Virtual Server version 0.0.0 (size=0)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP [2001::201]:80 rr -&gt; 192.168.229.1:80 FullNat 1 0 0 -&gt; 192.168.229.2:80 FullNat 1 0 0 æµ‹è¯•æ•ˆæœ 12$ curl -6 &quot;http://\\[2001::201\\]&quot;Your IP and port is 192.168.229.201:1035 ä»ä¸Šé¢çš„æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œå³ä½¿æ˜¯å®‰è£…äº†TOAæ¨¡å—ï¼Œä¹Ÿæ— æ³•è·å–NAT64æ¨¡å¼ä¸‹å®¢æˆ·ç«¯çš„æºIPåœ°å€ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯IPå’Œç«¯å£éƒ½ä¼šå˜æˆLIPè½¬å‘è¿‡æ¥çš„æ—¶å€™çš„IPå’Œç«¯å£ã€‚å¦‚æœæ˜¯å¯¹æºIPæ²¡éœ€æ±‚çš„è¯å¯ä»¥å¿½ç•¥è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ‰éœ€æ±‚çš„è¯åˆ™éœ€è¦æ›´æ”¹RSä¸Šé¢çš„å®¢æˆ·ç«¯ç¨‹åºï¼Œä¸‹é¢æˆ‘ä»¬ä»¥nginxä¸ºä¾‹ã€‚ 4.2 NGINXæ”¯æŒNAT64dpvsè¿˜ä¸ºnginxæä¾›äº†ä¸€ä¸ªnat64çš„toaæ¨¡å—ï¼Œå½“VIPä¸ºipv6è€ŒRSä¸ºipv4çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¨¡å—åœ¨nginxä¸­è·å–ç”¨æˆ·çœŸå®çš„ipv6åœ°å€ï¼Œéœ€è¦æˆ‘ä»¬åœ¨æºç ç¼–è¯‘å®‰è£…nginxä¹‹å‰å…ˆæ‰“ä¸Šè¿™ä¸ªè¡¥ä¸ã€‚ ä»å®˜æ–¹çš„æ–‡ä»¶åæˆ‘ä»¬å¯ä»¥çœ‹å‡ºåº”è¯¥æ˜¯åŸºäº1.14.0ç‰ˆæœ¬åˆ¶ä½œçš„patchï¼Œé¦–å…ˆæˆ‘ä»¬ä½¿ç”¨æ—§ç‰ˆçš„1.14.0ç‰ˆæœ¬èƒ½å¤Ÿæ­£å¸¸æ‰“ä¸Šè¡¥ä¸ï¼Œåç»­çš„ç¼–è¯‘å®‰è£…ä¹Ÿèƒ½æ­£å¸¸è¿›è¡Œ 12345678910[root@tiny-centos7 nginx-1.14.0]# pwd/home/nginx-1.14.0[root@tiny-centos7 nginx-1.14.0]# lsauto CHANGES CHANGES.ru conf configure contrib html LICENSE man nginx-1.14.0-nat64-toa.patch README src[root@tiny-centos7 nginx-1.14.0]# cp /home/dpvs/kmod/toa/example_nat64/nginx/nginx-1.14.0-nat64-toa.patch ./[root@tiny-centos7 nginx-1.14.0]# patch -p 1 &lt; nginx-1.14.0-nat64-toa.patchpatching file src/core/ngx_connection.hpatching file src/core/ngx_inet.hpatching file src/event/ngx_event_accept.cpatching file src/http/ngx_http_variables.c ä½¿ç”¨æœ€æ–°çš„nginx-1.21.1ç‰ˆæœ¬çš„æ—¶å€™ä¼šæœ‰æŠ¥é”™ 1234567891011121314151617181920[root@tiny-centos7 nginx-1.21.1]# cp /home/dpvs/kmod/toa/example_nat64/nginx/nginx-1.14.0-nat64-toa.patch ./[root@tiny-centos7 nginx-1.21.1]# pwd/home/nginx-1.21.1[root@tiny-centos7 nginx-1.21.1]# lsauto CHANGES CHANGES.ru conf configure contrib html LICENSE man nginx-1.14.0-nat64-toa.patch README src[root@tiny-centos7 nginx-1.21.1]# patch -p 1 &lt; nginx-1.14.0-nat64-toa.patchpatching file src/core/ngx_connection.hHunk #1 FAILED at 144.1 out of 1 hunk FAILED -- saving rejects to file src/core/ngx_connection.h.rejpatching file src/core/ngx_inet.hHunk #1 succeeded at 128 with fuzz 2 (offset 2 lines).patching file src/event/ngx_event_accept.cHunk #1 succeeded at 17 (offset -5 lines).Hunk #2 succeeded at 30 (offset -5 lines).Hunk #3 succeeded at 172 (offset -5 lines).patching file src/http/ngx_http_variables.cHunk #1 succeeded at 145 (offset 2 lines).Hunk #2 succeeded at 398 (offset 15 lines).Hunk #3 succeeded at 1311 (offset -11 lines). ä»”ç»†æŸ¥çœ‹patchæ–‡ä»¶å†…å®¹å¯ä»¥å‘ç°å‡ºç°é”™è¯¯æ˜¯å› ä¸º1.21.1ç‰ˆæœ¬ä¸­å¯¹åº”éƒ¨åˆ†ç§»é™¤äº†å‡ è¡Œä»£ç å¯¼è‡´patchæ— æ³•åŒ¹é…ï¼Œæˆ‘ä»¬æ‰‹åŠ¨å°†é‚£ä¸€è¡Œä»£ç åŠ ä¸Šå» éšåå°±èƒ½æ­£å¸¸ç¼–è¯‘å®‰è£…äº†ï¼Œå®Œæˆä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨æ—¥å¿—ä¸­åŠ å…¥$toa_remote_addrå’Œ$toa_remote_portè¿™ä¸¤ä¸ªå˜é‡æ¥è·å–NAT64æ¨¡å¼ä¸‹çš„å®¢æˆ·ç«¯çœŸå®IPã€‚ 4.3 æ•ˆæœæ£€éªŒå†æ¬¡æµ‹è¯•å‘ç°èƒ½å¤Ÿæ˜¾ç¤ºçœŸæ­£çš„å®¢æˆ·ç«¯æºIPåœ°å€å’Œç«¯å£å·ã€‚ 123456$ curl -6 &quot;http://\\[2001::201\\]&quot;Your remote_addr and remote_port is 192.168.229.201:1030Your toa_remote_addr and toa_remote_port is [2408::1]:64920# åŒæ—¶åœ¨nginxçš„æ—¥å¿—ä¸­ä¹Ÿèƒ½çœ‹åˆ°å¯¹åº”çš„å­—æ®µtoa_remote_addr=2408::1 | toa_remote_port=64920 | remote_addr=192.168.229.201 | remote_port=1030 5ã€keepalivedé…ç½®5.1 æ¶æ„å›¾ä½¿ç”¨keepalivedé…ç½®æœ‰ä¸¤å¤§å¥½å¤„ï¼š VIPã€LIPã€RSç­‰é…ç½®å‚æ•°å¯ä»¥å›ºåŒ–åœ¨keepalivedçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ— éœ€æ¯æ¬¡éƒ½ä½¿ç”¨å‘½ä»¤æˆ–è„šæœ¬æ‰‹åŠ¨æ“ä½œ keepalivedå¯ä»¥ä½¿ç”¨VRRPåè®®é…ç½®ä¸»å¤‡æ¨¡å¼ï¼ˆmaster-backupï¼‰ï¼Œé¿å…äº†å•ç‚¹é—®é¢˜ å®˜æ–¹çš„keepalivedé…ç½®ç½‘ç»œæ‹“æ‰‘ä½¿ç”¨çš„æ˜¯å•è‡‚æ¨¡å¼ï¼Œè¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸ºåŒè‡‚æ¨¡å¼ï¼›åŒæ—¶éœ€è¦æ³¨æ„DPVSä½¿ç”¨çš„keepalivedæ˜¯ä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ï¼Œå’ŒåŸç”Ÿç‰ˆæœ¬çš„keepalivedåœ¨é…ç½®è¯­æ³•å’Œå‚æ•°ä¸Šç¨æœ‰ä¸åŒã€‚ å’Œå‰é¢æåˆ°çš„ä¸€æ ·ï¼Œkeepalivedä¹Ÿæ”¯æŒIPv4-IPv4æ¨¡å¼ã€IPv6-IPv6æ¨¡å¼å’ŒNAT64æ¨¡å¼ï¼ˆIPv6-IPv4ï¼‰è¿™ä¸‰ç§æ¨¡å¼ï¼Œä¸‰è€…çš„ä¸åŒåªæ˜¯åœ¨äºè·¯ç”±çš„ä¸åŒå’Œkeepalivedçš„é…ç½®æ–‡ä»¶ç•¥æœ‰å·®å¼‚ã€‚ 5.2 é…ç½®kniç½‘å¡keepalivedçš„é…ç½®éœ€è¦åœ¨æ­£å¸¸çš„Linuxç½‘ç»œæ ˆï¼ˆéDPVSå®ç°çš„ç®€å•ç”¨æˆ·æ€ç½‘ç»œæ ˆï¼‰ä¸­æœ‰ä¸€ä¸ªèƒ½è¿›è¡Œæ­£å¸¸ç½‘ç»œé€šä¿¡çš„kniç½‘å¡ã€‚kniç½‘å¡çš„é…ç½®å’Œæ™®é€šç½‘å¡çš„é…ç½®æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªéœ€è¦å°†é…ç½®æ–‡ä»¶ä¸­çš„DEVICEæ”¹ä¸ºå¯¹åº”çš„kniç½‘å¡å³å¯ã€‚ kniç½‘å¡çš„å­˜åœ¨ä¾èµ–äºdpvsè¿›ç¨‹çš„å­˜åœ¨ï¼Œå¦‚æœdpvsè¿›ç¨‹é‡å¯äº†ï¼Œé‚£ä¹ˆkniç½‘å¡ä¸ä¼šè·Ÿç€é‡å¯ï¼Œè€Œæ˜¯å¤„äºDOWNçŠ¶æ€ç›´è‡³æˆ‘ä»¬æ‰‹åŠ¨å°†å…¶å¯ç”¨ï¼ˆifupï¼‰ 123456789101112131415$ cat /etc/sysconfig/network-scripts/ifcfg-bond2.kniDEVICE=bond2.kniBOOTPROTO=staticONBOOT=yesIPADDR=10.0.96.200NETMASK=255.255.255.0GATEWAY=10.0.96.254$ ip a32: bond2.kni: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether a0:36:9f:f0:e4:c0 brd ff:ff:ff:ff:ff:ff inet 10.0.96.200/24 brd 10.0.96.255 scope global bond2.kni valid_lft forever preferred_lft forever inet6 fe80::a236:9fff:fef0:e4c0/64 scope link valid_lft forever preferred_lft forever å‰é¢æˆ‘ä»¬çš„dpvs.confé…ç½®æ–‡ä»¶ä¸­ä¼šå¯¹æ¯ä¸ªdpdkç½‘å¡æˆ–è€…æ˜¯bondç½‘å¡é…ç½®ä¸€ä¸ªkniç½‘å¡ï¼ˆä¸€èˆ¬å‘½åä¸ºdpdk0.kniæˆ–bond0.kniç­‰ï¼‰ï¼Œåœ¨å‰é¢çš„ç®€å•é…ç½®æ­¥éª¤ä¸­æˆ‘ä»¬éƒ½æ˜¯ç›´æ¥æŠŠVIPåŠ åˆ°DPDKçš„ç½‘å¡ä¸Šï¼Œä½†æ˜¯è¿™æ ·æ— æ³•å®ç°VIPçš„ä¸»å¤‡åˆ‡æ¢ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†VIPäº¤ç”±keepalivedç¨‹åºæ§åˆ¶ã€‚ 5.3 é…ç½®è·¯ç”±keepalivedæ¨¡å¼ä¸‹ï¼Œå¯¹äºåŒè‡‚ç½‘ç»œæ¨¡å¼çš„FullNATï¼Œæˆ‘ä»¬éœ€è¦åŠ çš„è·¯ç”±ä¸€èˆ¬æ¥è¯´å¯ä»¥ç›´è§‚åœ°åˆ†ä¸ºä¸‰å¤§éƒ¨åˆ†ï¼šVIPç½‘æ®µçš„è·¯ç”±ï¼ŒRS/LIPç½‘æ®µçš„è·¯ç”±ï¼Œé»˜è®¤è·¯ç”±ã€‚ 123456789101112131415# IPv4ç½‘ç»œæ¨¡å¼$ dpip route add 10.0.96.0/24 dev bond2 # VIPç½‘æ®µçš„è·¯ç”±$ dpip route add 192.168.229.0/23 dev bond1 # RS/LIPç½‘æ®µçš„è·¯ç”±$ dpip route add default via 10.0.96.254 dev bond2 # é»˜è®¤è·¯ç”±# IPv6ç½‘ç»œæ¨¡å¼$ dpip route -6 add 2001::/64 dev bond2 # VIPç½‘æ®µçš„è·¯ç”±$ dpip route -6 add 2407::/64 dev bond1 # RS/LIPç½‘æ®µçš„è·¯ç”±$ dpip route -6 add default via 2001::1 dev bond2 # é»˜è®¤è·¯ç”±# NAT64æ¨¡å¼ï¼ˆIPv6-IPv4ï¼‰# æ­¤æ¨¡å¼çš„åŒºåˆ«åœ¨äºRSè¦æ¢ä¸ºIPv4ç½‘æ®µçš„è·¯ç”±$ dpip route -6 add 2001::/64 dev bond2 # VIPç½‘æ®µçš„è·¯ç”±$ dpip route add 192.168.229.0/23 dev bond1 # RS/LIPç½‘æ®µçš„è·¯ç”±$ dpip route -6 add default via 2001::1 dev bond2 # é»˜è®¤è·¯ç”± 5.4 é…ç½®keepalivedé¦–å…ˆæˆ‘ä»¬ä½¿ç”¨systemctlå°†keepalivedç®¡ç†èµ·æ¥ï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ªunitæ–‡ä»¶ï¼Œé…ç½®ä¸­çš„è·¯å¾„è¦æ›¿æ¢æˆDPVSå®šåˆ¶ç‰ˆçš„keepalivedäºŒè¿›åˆ¶æ–‡ä»¶ä»¥åŠkeepalivedé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼ˆå»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼‰ 1234567891011121314$ cat /usr/lib/systemd/system/keepalived.service[Unit]Description=DPVS modify version keepalivedAfter=syslog.target network-online.target[Service]Type=forkingPIDFile=/var/run/keepalived.pidKillMode=processExecStart=/path/to/dpvs/bin/keepalived -f /etc/keepalived/keepalived.conf -D -d -S 0ExecReload=/bin/kill -HUP $MAINPID[Install]WantedBy=multi-user.target éšåæˆ‘ä»¬ä¿®æ”¹keepalivedçš„æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­æ–¹ä¾¿æˆ‘ä»¬å®šä½é—®é¢˜ 12# å¯¹äºç³»ç»Ÿä½¿ç”¨rsyslogæœåŠ¡æ¥ç®¡ç†æ—¥å¿—çš„ï¼Œå¯ä»¥ä¿®æ”¹ /etc/rsyslog.conf åŠ å…¥ä¸‹åˆ—çš„é…ç½®local0.* /path/to/keepalived.log æœ€åæˆ‘ä»¬é‡å¯ç›¸å…³çš„rsyslogæ—¥å¿—æœåŠ¡å’Œkeepalived 123$ systemctl daemon-reload$ systemctl enable rsyslog.service$ systemctl restart rsyslog.service 5.5 keepalived.confæ³¨æ„å³ä½¿RSç›¸åŒï¼ŒNAT64æ¨¡å¼å’Œæ™®é€šçš„IPv4æ¨¡å¼ä¹Ÿä¸èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªvrrp_instanceä¸­åŒæ—¶å®šä¹‰IPv4åœ°å€å’ŒIPv6åœ°å€ï¼Œå› ä¸ºä¸¤è€…ä½¿ç”¨çš„VRRPåè®®ç‰ˆæœ¬ä¸åŒï¼ˆVRRPå’ŒVRRP6ï¼‰ ä»¥ä¸‹ä»¥NAT64å’ŒIPv4ç½‘ç»œä¸¤ç§é…ç½®ä¸ºä¾‹ï¼Œæˆªå–éƒ¨åˆ†é‡ç‚¹é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127! Configuration File for keepalivedglobal_defs &#123; router_id DPVS_TEST&#125;# é…ç½®LOCAL IP# ç½‘å¡ä½¿ç”¨DPDKçš„lanç½‘æ®µç½‘å¡local_address_group laddr_g1 &#123; 192.168.229.201 bond1 &#125;# é…ç½®IPv4æ¨¡å¼çš„VIPvrrp_instance VI_1 &#123; # ç¡®å®šè¯¥VIPçš„çŠ¶æ€ä¸ºMASTERæˆ–è€…æ˜¯BACKUP state MASTER # interfaceæŒ‡å®šä¸ºLinuxç½‘ç»œæ ˆèƒ½è¯†åˆ«åˆ°çš„ã€ç”±dpvsè™šæ‹Ÿå‡ºæ¥çš„kniç½‘å¡ # keepalivedæ¨¡å¼éœ€è¦ç¡®ä¿è¯¥kniç½‘å¡å¤„äºupçŠ¶æ€ï¼Œæ­¤å‰çš„ç®€å•é…ç½®å‡ä¸éœ€è¦ interface bond2.kni # dpdk_interfaceæŒ‡å®šä¸ºwanå£ç½‘å¡ï¼Œå³VIPæ‰€åœ¨çš„dpdkç½‘å¡ dpdk_interface bond2 # è™šæ‹Ÿè·¯ç”±IDï¼Œéœ€è¦å…¨å±€å”¯ä¸€ virtual_router_id 201 priority 100 advert_int 1 authentication &#123; auth_type PASS auth_pass dpvstest &#125; # é…ç½®VIPï¼Œå¯ä»¥å¤šä¸ªä¸€ç»„ï¼Œä½†æ˜¯ä¸å¯IPv6å’ŒIPv4æ··ç”¨ virtual_ipaddress &#123; 10.0.96.201 10.0.96.202 &#125;&#125;# é…ç½®IPv6æ¨¡å¼çš„VIPvrrp_instance VI_2 &#123; state MASTER interface bond2.kni dpdk_interface bond2 virtual_router_id 202 priority 100 advert_int 1 authentication &#123; auth_type PASS auth_pass dpvstest &#125; virtual_ipaddress &#123; 2001::201 2001::202 &#125;&#125;# é…ç½®å¯¹åº”çš„VIPå’ŒRSvirtual_server_group 10.0.96.201-80 &#123; 10.0.96.201 80 10.0.96.202 80&#125;virtual_server group 10.0.96.201-80 &#123; delay_loop 3 lb_algo rr lb_kind FNAT protocol TCP laddr_group_name laddr_g1 real_server 192.168.229.1 80 &#123; weight 100 inhibit_on_failure TCP_CHECK &#123; nb_sock_retry 2 connect_timeout 3 connect_port 80 &#125; &#125; real_server 192.168.229.2 80 &#123; weight 100 inhibit_on_failure TCP_CHECK &#123; nb_sock_retry 2 connect_timeout 3 connect_port 80 &#125; &#125;&#125;virtual_server_group 10.0.96.201-80-6 &#123; 2001::201 80 2001::202 80&#125;virtual_server group 10.0.96.201-80-6 &#123; delay_loop 3 lb_algo rr lb_kind FNAT protocol TCP laddr_group_name laddr_g1 real_server 192.168.229.1 80 &#123; weight 100 inhibit_on_failure TCP_CHECK &#123; nb_sock_retry 2 connect_timeout 3 connect_port 80 &#125; &#125; real_server 192.168.229.2 80 &#123; weight 100 inhibit_on_failure TCP_CHECK &#123; nb_sock_retry 2 connect_timeout 3 connect_port 80 &#125; &#125;&#125; keepalivedå¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨dpipå‘½ä»¤æŸ¥çœ‹åˆ°å„ä¸ªå®šä¹‰çš„VIPï¼Œipvsadmå‘½ä»¤ä¸­åº”è¯¥å¯ä»¥çœ‹åˆ°å„ç»„RSçŠ¶æ€æ­£å¸¸ ä½†æ˜¯éœ€è¦ç¡®ä¿åœ¨keepalivedè¿è¡Œè¿‡ç¨‹ä¸­dpvså¿…é¡»å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”é…ç½®æ–‡ä»¶ä¸­interfaceå‚æ•°æŒ‡å®šçš„kniç½‘å¡å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ æ¯ä¸ªç½‘å¡å’Œç½‘æ®µçš„ç›¸å…³è·¯ç”±è¿˜æ˜¯éœ€è¦è‡ªå·±æ‰‹åŠ¨æ·»åŠ ï¼ˆIPv4ã€IPv6ï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051# æ£€æŸ¥é…ç½®çš„å„ä¸ªVIPå’ŒLIPæ˜¯å¦ç”Ÿæ•ˆ$ dpip addr showinet 10.0.96.202/32 scope global bond2 valid_lft forever preferred_lft foreverinet6 2001::202/128 scope global bond2 valid_lft forever preferred_lft foreverinet6 2001::201/128 scope global bond2 valid_lft forever preferred_lft foreverinet 10.0.96.201/32 scope global bond2 valid_lft forever preferred_lft foreverinet 192.168.229.201/32 scope global bond1 valid_lft forever preferred_lft forever# æ£€æŸ¥å„ç»„RSæœåŠ¡æ˜¯å¦æ­£å¸¸$ ipvsadm -lnIP Virtual Server version 0.0.0 (size=0)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 10.0.96.201:80 rr -&gt; 192.168.229.1:80 FullNat 100 0 0 -&gt; 192.168.229.2:80 FullNat 100 0 0TCP 10.0.96.201:443 rr -&gt; 192.168.229.1:443 FullNat 100 0 0 -&gt; 192.168.229.2:443 FullNat 100 0 0TCP 10.0.96.202:80 rr -&gt; 192.168.229.1:80 FullNat 100 0 0 -&gt; 192.168.229.2:80 FullNat 100 0 0TCP 10.0.96.202:443 rr -&gt; 192.168.229.1:443 FullNat 100 0 0 -&gt; 192.168.229.2:443 FullNat 100 0 0TCP [2001::201]:80 rr -&gt; 192.168.229.1:80 FullNat 100 0 0 -&gt; 192.168.229.2:80 FullNat 100 0 0TCP [2001::201]:443 rr -&gt; 192.168.229.1:443 FullNat 100 0 0 -&gt; 192.168.229.2:443 FullNat 100 0 0TCP [2001::202]:80 rr -&gt; 192.168.229.1:80 FullNat 100 0 0 -&gt; 192.168.229.2:80 FullNat 100 0 0TCP [2001::202]:443 rr -&gt; 192.168.229.1:443 FullNat 100 0 0 -&gt; 192.168.229.2:443 FullNat 100 0 0# ä½¿ç”¨curlæµ‹è¯•IPv6æœåŠ¡æ˜¯å¦èƒ½å¤Ÿèµ°é€š$ curl -6 &quot;http://\\[2001::202\\]&quot;Your remote_addr and remote_port is 192.168.229.201:1034Your toa_remote_addr and toa_remote_port is [2408::1]:9684# ä½¿ç”¨curlæµ‹è¯•IPv4æœåŠ¡æ˜¯å¦èƒ½å¤Ÿèµ°é€š$ curl 10.0.96.201Your remote_addr and remote_port is 172.16.0.1:42254Your toa_remote_addr and toa_remote_port is -:- æœ€åéœ€è¦æé†’çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº†NAT64æ¨¡å¼ï¼Œé‚£ä¹ˆnginxæ˜¯æ²¡åŠæ³•ç›´æ¥è·å–çœŸå®çš„æºç«¯IPçš„ï¼Œéœ€è¦å¯¹XFFå¤´è¿›è¡Œè®¾ç½®ï¼Œä¾‹å¦‚ï¼š 123456789101112proxy_set_header X-Forwarded-For &quot;$real_remote_addr,$proxy_add_x_forwarded_for&quot;; map $toa_remote_addr $real_remote_addr &#123; default $toa_remote_addr; &#x27;-&#x27; $remote_addr; &#125; map $toa_remote_port $real_remote_port &#123; default $toa_remote_port; &#x27;-&#x27; $remote_port; &#125; 6ã€æ€»ç»“ä»¥ä¸Šçš„å¤šç§é…ç½®ä¸­ï¼ŒåŸºæœ¬ä¸Šèƒ½åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„æœ€å¥½å°±æ˜¯keepalivedçš„ä¸»å¤‡æ¨¡å¼ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€ä¸ªéœ€è¦äº¤æ¢æœºæ”¯æŒECMPçš„å¤šä¸»æ¨¡å¼è¿™é‡Œå› ä¸ºæ¡ä»¶æœ‰é™æš‚æ—¶æ²¡æœ‰æµ‹è¯•åˆ°ï¼Œåé¢æœ‰æ¡ä»¶äº†å†è¡¥ä¸Šã€‚ è‡³äºNAT64æ¨¡å¼å’ŒIPv6-IPv6æ¨¡å¼çš„é€‰æ‹©ï¼Œå¦‚æœRSæ˜¯nginxï¼Œé‚£ä¹ˆä¸¤ç§æ¨¡å¼çš„åŒºåˆ«åœ¨äºæ˜¯åœ¨nginxä¸Šåšå…¼å®¹è¿˜æ˜¯åœ¨RSä¸Šé¢é…ç½®IPv6ç½‘ç»œï¼Œå…·ä½“çœ‹å®é™…çš„ç½‘ç»œæ¡ä»¶å’Œè¿ç»´ç®¡ç†å·¥å…·æ¥åˆ¤æ–­ï¼›å¦‚æœRSæ˜¯å…¶ä»–çš„ç¬¬ä¸‰æ–¹ç¨‹åºï¼Œä¸æƒ³å¯¹æºä»£ç è¿›è¡Œå¤ªå¤šçš„ä¾µå…¥å˜æ›´ï¼Œæœ€å¥½å°±æ˜¯ç›´æ¥ä½¿ç”¨IPv6-IPv6æ¨¡å¼ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"},{"name":"nat","slug":"nat","permalink":"https://tinychen.com/tags/nat/"},{"name":"lvs","slug":"lvs","permalink":"https://tinychen.com/tags/lvs/"},{"name":"dpdk","slug":"dpdk","permalink":"https://tinychen.com/tags/dpdk/"},{"name":"dpvs","slug":"dpvs","permalink":"https://tinychen.com/tags/dpvs/"}]},{"title":"DPVS-FullNATæ¨¡å¼éƒ¨ç½²ç¯‡","slug":"20210728-dpvs-fullnat-deploy","date":"2021-07-28T09:00:00.000Z","updated":"2021-07-28T09:00:00.000Z","comments":true,"path":"20210728-dpvs-fullnat-deploy/","link":"","permalink":"https://tinychen.com/20210728-dpvs-fullnat-deploy/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨CentOS7.9ç³»ç»Ÿä¸Šéƒ¨ç½²DPVSçš„FullNATæ¨¡å¼å’Œåœ¨RealServerä¸Šå®‰è£…toaæ¨¡å—è·å–å®¢æˆ·ç«¯çš„çœŸå®IPã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨CentOS7.9ç³»ç»Ÿä¸Šéƒ¨ç½²DPVSçš„FullNATæ¨¡å¼å’Œåœ¨RealServerä¸Šå®‰è£…toaæ¨¡å—è·å–å®¢æˆ·ç«¯çš„çœŸå®IPã€‚ æ­¤å‰çš„æ–‡ç« å·²ç»ä»‹ç»è¿‡DPVSç®€ä»‹ä¸éƒ¨ç½²ä»¥åŠDPDKåœ¨DPVSä¸­çš„åº”ç”¨åŠåŸç†åˆ†æï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥å…ˆè¡¥ä¸€ä¸‹ç›¸å…³çš„å†…å®¹ã€‚ç”±äºä¹‹å‰çš„æ–‡ç« ä¸­çš„éƒ¨ç½²æ­¥éª¤åªä»‹ç»åˆ°äº†DPVSçš„éƒ¨ç½²ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠç›¸å…³çš„å„ç§è´Ÿè½½å‡è¡¡æ¨¡å¼çš„é…ç½®ï¼Œä»¥åŠæ—¶é—´è¿‡å»å¤§åŠå¹´ä¹‹åï¼ŒDPVSçš„ç‰ˆæœ¬å’Œå¯¹åº”çš„DPDKç‰ˆæœ¬éƒ½æœ‰æ‰€æ›´æ–°ï¼Œå› æ­¤è¿™é‡Œå†é‡æ–°è¯¦ç»†å†™ä¸€ç¯‡æ–°çš„éƒ¨ç½²æ•™ç¨‹ã€‚ æœ¬æ–‡ä¸­å®‰è£…çš„DPVSç‰ˆæœ¬ä¸º1.8-10ï¼Œdpdkç‰ˆæœ¬ä¸º18.11.2ï¼Œå’Œå‰æ–‡ä¸åŒï¼Œå®‰è£…æ­¥éª¤å’Œæ“ä½œä¹Ÿæœ‰å·®å¼‚ã€‚ 1ã€å‡†å¤‡å·¥ä½œåœ¨æ­£å¼å¼€å§‹å®‰è£…ä¹‹åæˆ‘ä»¬éœ€è¦å…ˆå¯¹æœºå™¨çš„ç¡¬ä»¶å‚æ•°è¿›è¡Œä¸€äº›è°ƒæ•´ï¼ŒDPVSå®˜æ–¹å¯¹ç¡¬ä»¶æœ‰ä¸€å®šçš„è¦æ±‚ï¼ˆä¸»è¦æ˜¯å› ä¸ºåº•å±‚ä½¿ç”¨çš„DPDKï¼‰ï¼Œdpdkå®˜æ–¹ç»™å‡ºäº†ä¸€ä»½æ”¯æŒåˆ—è¡¨ï¼Œè™½ç„¶æ”¯æŒæ€§åˆ—è¡¨ä¸Šé¢çš„å¹³å°æ”¯æŒå¾—å¾ˆå¹¿æ³›ï¼Œä½†æ˜¯å®é™…ä¸Šå…¼å®¹æ€§å’Œè¡¨ç°æœ€å¥½çš„ä¼¼ä¹è¿˜æ˜¯è¦Intelçš„ç¡¬ä»¶å¹³å°ã€‚ 1.1 ç¡¬ä»¶éƒ¨åˆ†1.1.1 ç¡¬ä»¶å‚æ•° æœºå™¨å‹å·ï¼š PowerEdge R630 CPUï¼šä¸¤é¢— Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz å†…å­˜ï¼š16G*8 DDR4-2400 MT/sï¼ˆConfigured in 2133 MT/sï¼‰ï¼Œæ¯ä¸ªCPU64Gï¼Œå…±è®¡128G ç½‘å¡1ï¼šIntel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01) ç½‘å¡2ï¼šIntel Corporation Ethernet 10G 2P X520 Adapter (rev 01) ç³»ç»Ÿï¼šCentOS Linux release 7.9.2009 (Core) å†…æ ¸ï¼š3.10.0-1160.36.2.el7.x86_64 1.1.2 BIOSè®¾ç½®å¼€å§‹ä¹‹å‰ï¼Œå…ˆè¿›å…¥BIOSä¸­å…³é—­è¶…çº¿ç¨‹å’Œå¯ç”¨NUMAç­–ç•¥ã€‚å…¶ä¸­DPVSæ˜¯éå¸¸å…¸å‹çš„CPUç¹å¿™å‹åº”ç”¨ï¼ˆè¿›ç¨‹æ‰€åœ¨çš„CPUä½¿ç”¨ç‡ä¸€ç›´éƒ½æ˜¯100%ï¼‰ï¼Œä¸ºäº†ä¿è¯æ€§èƒ½ï¼Œå»ºè®®å…³é—­CPUçš„è¶…çº¿ç¨‹è®¾ç½®ã€‚åŒæ—¶å› ä¸ºDPVSä½¿ç”¨çš„æ˜¯æˆ‘ä»¬æ‰‹åŠ¨åˆ†é…çš„å¤§é¡µå†…å­˜ï¼Œä¸ºäº†ä¿è¯CPUäº²å’Œæ€§ï¼Œæœ€å¥½åœ¨BIOSä¸­ç›´æ¥æ‰“å¼€NUMAç­–ç•¥ã€‚ 1.1.3 ç½‘å¡PCI IDä½¿ç”¨dpvsçš„PMDé©±åŠ¨æ¥ç®¡ç½‘å¡ä¹‹åï¼Œå¦‚æœç½‘å¡çš„æ•°é‡è¾ƒå¤šï¼Œå®¹æ˜“ææ··ï¼Œæœ€å¥½æå‰è®°å½•ä¸‹å¯¹åº”çš„ç½‘å¡åã€MACåœ°å€å’ŒPCI IDï¼Œé¿å…åé¢æ“ä½œçš„æ—¶å€™ææ··ã€‚ ä½¿ç”¨lspciå‘½ä»¤å¯ä»¥æŸ¥çœ‹å¯¹åº”ç½‘å¡çš„PCI IDï¼Œæ¥ç€æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹/sys/class/net/è¿™ä¸ªç›®å½•ä¸‹å¯¹åº”ç½‘å¡åç›®å½•ä¸‹çš„deviceæ–‡ä»¶ï¼Œå°±èƒ½å¤Ÿå¾—çŸ¥ç½‘å¡å¯¹åº”çš„PCI IDã€‚æœ€åå°±å¯ä»¥æŠŠç½‘å¡å-MACåœ°å€-PCI IDä¸‰ä¸ªå‚æ•°ä¸²èµ·æ¥ã€‚ 123456$ lspci | grep -i net01:00.0 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01)01:00.1 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01)$ file /sys/class/net/eth0/device/sys/class/net/eth0/device: symbolic link to `../../../0000:01:00.0&#x27; 1.2 è½¯ä»¶éƒ¨åˆ†1.2.1 ç³»ç»Ÿè½¯ä»¶1234567891011121314151617# ç¼–è¯‘å®‰è£…dpvséœ€è¦ä½¿ç”¨çš„å·¥å…·ä»¥åŠæŸ¥çœ‹CPU NUMAä¿¡æ¯çš„å·¥å…·$ yum group install &quot;Development Tools&quot; $ yum install patch libnuma* numactl numactl-devel kernel-devel openssl* popt* libpcap-devel -y# å¦‚æœéœ€è¦ipvsadmæ”¯æŒipv6éœ€è¦å®‰è£…libnl3-devel$ yum install libnl libnl-devel libnl3 libnl3-devel -y# æ³¨æ„kernelä»¥åŠç›¸åº”çš„kernelç»„ä»¶çš„ç‰ˆæœ¬éœ€è¦å’Œç°åœ¨ä½¿ç”¨çš„kernelç‰ˆæœ¬ç›¸å¯¹åº”$ uname -r3.10.0-1160.36.2.el7.x86_64$ rpm -qa | grep kernel | grep &quot;3.10.0-1160.36.2&quot;kernel-3.10.0-1160.36.2.el7.x86_64kernel-devel-3.10.0-1160.36.2.el7.x86_64kernel-tools-libs-3.10.0-1160.36.2.el7.x86_64kernel-debug-devel-3.10.0-1160.36.2.el7.x86_64kernel-tools-3.10.0-1160.36.2.el7.x86_64kernel-headers-3.10.0-1160.36.2.el7.x86_64 1.2.2 dpvså’Œdpdk123456# dpvsæˆ‘ä»¬ç›´æ¥ä½¿ç”¨gitä»githubæ‹‰å–æœ€æ–°çš„ç‰ˆæœ¬$ git clone https://github.com/iqiyi/dpvs.git# dpdkæˆ‘ä»¬ä»å®˜ç½‘ä¸‹è½½18.11.2ç‰ˆæœ¬ï¼Œæ”¾åˆ°dpvsç›®å½•ä¸‹æ–¹ä¾¿æ“ä½œ$ cd dpvs/$ wget https://fast.dpdk.org/rel/dpdk-18.11.2.tar.xz$ tar -Jxvf dpdk-18.11.2.tar.xz å®Œæˆä¸Šè¿°æ­¥éª¤ä¹‹åå°±å¯ä»¥å¼€å§‹ä¸‹é¢çš„å®‰è£…äº†ã€‚ 2ã€å®‰è£…æ­¥éª¤2.1 DPDKå®‰è£…2.1.1 å®‰è£…dpdk-patchåœ¨dpvsæ–‡ä»¶å¤¹çš„patchç›®å½•ä¸‹é¢æœ‰å¯¹åº”æ”¯æŒçš„dpdkç‰ˆæœ¬çš„patchè¡¥ä¸ï¼Œå¦‚æœä¸æ¸…æ¥šè‡ªå·±åˆ°åº•éœ€è¦å“ªä¸ªè¡¥ä¸ï¼Œå®˜æ–¹çš„å»ºè®®æ˜¯å…¨éƒ¨å®‰è£… 12345678$ ll dpvs/patch/dpdk-stable-18.11.2total 44-rw-r--r-- 1 root root 4185 Jul 22 12:47 0001-kni-use-netlink-event-for-multicast-driver-part.patch-rw-r--r-- 1 root root 1771 Jul 22 12:47 0002-net-support-variable-IP-header-len-for-checksum-API.patch-rw-r--r-- 1 root root 1130 Jul 22 12:47 0003-driver-kni-enable-flow_item-type-comparsion-in-flow_.patch-rw-r--r-- 1 root root 1706 Jul 22 12:47 0004-rm-rte_experimental-attribute-of-rte_memseg_walk.patch-rw-r--r-- 1 root root 16538 Jul 22 12:47 0005-enable-pdump-and-change-dpdk-pdump-tool-for-dpvs.patch-rw-r--r-- 1 root root 2189 Jul 22 12:47 0006-enable-dpdk-eal-memory-debug.patch å®‰è£…patchçš„æ“ä½œä¹Ÿéå¸¸çš„ç®€å• 1234567891011121314151617181920212223# æˆ‘ä»¬é¦–å…ˆæŠŠæ‰€æœ‰çš„patchå¤åˆ¶åˆ°dpdkçš„æ ¹ç›®å½•ä¸‹é¢$ cp dpvs/patch/dpdk-stable-18.11.2/*patch dpvs/dpdk-stable-18.11.2/$ cd dpvs/dpdk-stable-18.11.2/# ç„¶åæˆ‘ä»¬æŒ‰ç…§patchçš„æ–‡ä»¶åé¡ºåºä¾æ¬¡è¿›è¡Œå®‰è£…$ patch -p 1 &lt; 0001-kni-use-netlink-event-for-multicast-driver-part.patchpatching file kernel/linux/kni/kni_net.c$ patch -p 1 &lt; 0002-net-support-variable-IP-header-len-for-checksum-API.patchpatching file lib/librte_net/rte_ip.h$ patch -p 1 &lt; 0003-driver-kni-enable-flow_item-type-comparsion-in-flow_.patchpatching file drivers/net/mlx5/mlx5_flow.c$ patch -p 1 &lt; 0004-rm-rte_experimental-attribute-of-rte_memseg_walk.patchpatching file lib/librte_eal/common/eal_common_memory.cHunk #1 succeeded at 606 (offset 5 lines).patching file lib/librte_eal/common/include/rte_memory.h$ patch -p 1 &lt; 0005-enable-pdump-and-change-dpdk-pdump-tool-for-dpvs.patchpatching file app/pdump/main.cpatching file config/common_basepatching file lib/librte_pdump/rte_pdump.cpatching file lib/librte_pdump/rte_pdump.h$ patch -p 1 &lt; 0006-enable-dpdk-eal-memory-debug.patchpatching file config/common_basepatching file lib/librte_eal/common/include/rte_malloc.hpatching file lib/librte_eal/common/rte_malloc.c 2.1.2 dpdkç¼–è¯‘å®‰è£…12345678$ cd dpvs/dpdk-stable-18.11.2$ make config T=x86_64-native-linuxapp-gcc$ make # å‡ºç°Build complete [x86_64-native-linuxapp-gcc]çš„å­—æ ·å°±è¯´æ˜makeæˆåŠŸ$ export RTE_SDK=$PWD$ export RTE_TARGET=build è¿™é‡Œç¼–è¯‘å®‰è£…çš„è¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç°ä¹‹å‰ä½¿ç”¨dpdk17.11.2ç‰ˆæœ¬å‡ºç°çš„ndo_change_mtué—®é¢˜ 2.1.3 é…ç½®hugepageå’Œå…¶ä»–çš„ä¸€èˆ¬ç¨‹åºä¸åŒï¼Œdpvsä½¿ç”¨çš„dpdkå¹¶ä¸æ˜¯ä»æ“ä½œç³»ç»Ÿä¸­ç´¢è¦å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨å¤§é¡µå†…å­˜ï¼ˆhugepageï¼‰ï¼Œæå¤§åœ°æé«˜äº†å†…å­˜åˆ†é…çš„æ•ˆç‡ã€‚hugepageçš„é…ç½®æ¯”è¾ƒç®€å•ï¼Œå®˜æ–¹çš„é…ç½®è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯2MBçš„å¤§é¡µå†…å­˜ï¼Œè¿™é‡Œçš„28672æŒ‡çš„æ˜¯åˆ†é…äº†28672ä¸ª2MBçš„å¤§é¡µå†…å­˜ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªnodeå¯¹åº”56GBçš„å†…å­˜ï¼Œä¸€å…±åˆ†é…äº†112GBçš„å†…å­˜ï¼Œè¿™é‡Œçš„å†…å­˜å¯ä»¥æ ¹æ®æœºå™¨çš„å¤§å°æ¥è‡ªè¡Œè°ƒæ•´ã€‚ä½†æ˜¯å¦‚æœå°äº1GBå¯èƒ½ä¼šå¯¼è‡´å¯åŠ¨æŠ¥é”™ã€‚ å•ä¸ªCPUçš„ç³»ç»Ÿå¯ä»¥å‚è€ƒdpdkçš„å®˜æ–¹æ–‡æ¡£ 123456789101112131415161718192021222324252627282930# for NUMA machine$ echo 28672 &gt; /sys/devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages$ echo 28672 &gt; /sys/devices/system/node/node1/hugepages/hugepages-2048kB/nr_hugepages$ mkdir /mnt/huge$ mount -t hugetlbfs nodev /mnt/huge# éœ€è¦å¼€æœºè‡ªåŠ¨æŒ‚è½½çš„è¯å¯ä»¥åœ¨$ echo &quot;nodev /mnt/huge hugetlbfs defaults 0 0&quot; &gt;&gt; /etc/fstab# é…ç½®å®Œæˆåæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å†…å­˜çš„ä½¿ç”¨ç‡ç«‹é©¬ä¸Šå‡äº†$ free -g # é…ç½®å‰ total used free shared buff/cache availableMem: 125 1 122 0 1 123$ free -g # é…ç½®å total used free shared buff/cache availableMem: 125 113 10 0 1 11# ä½¿ç”¨numactlæŸ¥çœ‹å†…å­˜çŠ¶æ€ä¹Ÿå¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯ä¸¤è¾¹çš„CPUå†…å­˜å„åˆ†é…äº†56G$ numactl -Havailable: 2 nodes (0-1)node 0 cpus: 0 2 4 6 8 10 12 14 16 18node 0 size: 64184 MBnode 0 free: 4687 MBnode 1 cpus: 1 3 5 7 9 11 13 15 17 19node 1 size: 64494 MBnode 1 free: 5759 MBnode distances:node 0 1 0: 10 21 1: 21 10 2.1.4 é…ç½®ulimité»˜è®¤æƒ…å†µä¸‹ç³»ç»Ÿçš„ulimité™åˆ¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡å¦‚æœå¤ªå°ä¼šå½±å“dpvsæ­£å¸¸è¿è¡Œï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶è°ƒå¤§ä¸€äº›ï¼š 123$ ulimit -n 655350$ echo &quot;ulimit -n 655350&quot; &gt;&gt; /etc/rc.local$ chmod a+x /etc/rc.local 2.2 æŒ‚è½½é©±åŠ¨æ¨¡å—é¦–å…ˆæˆ‘ä»¬éœ€è¦è®©ç³»ç»ŸæŒ‚è½½æˆ‘ä»¬å·²ç»ç¼–è¯‘å¥½çš„dpdké©±åŠ¨ï¼ˆPMDé©±åŠ¨ï¼‰ï¼Œç„¶åå†å°†ç½‘å¡ä½¿ç”¨çš„é»˜è®¤é©±åŠ¨æ¢ä¸ºæˆ‘ä»¬è¿™é‡Œç¼–è¯‘å¥½çš„PMDé©±åŠ¨ 123$ modprobe uio$ insmod /path/to/dpdk-stable-18.11.2/build/kmod/igb_uio.ko$ insmod /path/to/dpdk-stable-18.11.2/build/kmod/rte_kni.ko carrier=on éœ€è¦æ³¨æ„çš„æ˜¯carrierå‚æ•°æ˜¯ä»DPDK v18.11ç‰ˆæœ¬å¼€å§‹æ–°å¢çš„ï¼Œé»˜è®¤å€¼ä¸ºoffã€‚æˆ‘ä»¬éœ€è¦åœ¨åŠ è½½rte_kni.koæ¨¡å—çš„æ—¶å€™å¸¦ä¸Šcarrier=onå‚æ•°æ‰èƒ½å¤Ÿä½¿KNIè®¾å¤‡å·¥ä½œæ­£å¸¸ã€‚ åœ¨dpdk-stable-18.11.2/usertoolsç›®å½•ä¸‹æœ‰ä¸€äº›è¾…åŠ©æˆ‘ä»¬å®‰è£…ä½¿ç”¨dpdkçš„è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒä»¬æ¥é™ä½é…ç½®çš„å¤æ‚åº¦ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨dpdk-devbind.pyè„šæœ¬æ¥å˜æ›´ç½‘å¡çš„é©±åŠ¨ 1234567891011# é¦–å…ˆæˆ‘ä»¬å…³é—­æˆ‘ä»¬éœ€è¦åŠ è½½PMDé©±åŠ¨çš„ç½‘å¡$ ifdown eth&#123;2,3,4,5&#125;# æŸ¥çœ‹ç½‘å¡çŠ¶æ€ï¼Œæ³¨æ„è¦ç‰¹åˆ«å…³æ³¨ç½‘å¡å¯¹åº”çš„PCI IDï¼Œä¸‹é¢åªæˆªå–éƒ¨åˆ†æœ‰ç”¨çš„è¾“å‡ºç»“æœ$ ./usertools/dpdk-devbind.py --statusNetwork devices using kernel driver===================================0000:04:00.0 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth2 drv=ixgbe unused=igb_uio0000:04:00.1 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth3 drv=ixgbe unused=igb_uio0000:82:00.0 &#x27;Ethernet 10G 2P X520 Adapter 154d&#x27; if=eth4 drv=ixgbe unused=igb_uio0000:82:00.1 &#x27;Ethernet 10G 2P X520 Adapter 154d&#x27; if=eth5 drv=ixgbe unused=igb_uio ä»ä¸Šé¢çš„è¾“å‡ºç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›®å‰çš„ç½‘å¡ä½¿ç”¨çš„æ˜¯ixgbeé©±åŠ¨ï¼Œè€Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©å…¶ä½¿ç”¨igb_uioé©±åŠ¨ã€‚æ³¨æ„å¦‚æœè¿™ä¸ªæ—¶å€™ç³»ç»Ÿçš„ç½‘å¡å¤ªå¤šï¼Œå‰é¢æˆ‘ä»¬è®°å½•ä¸‹æ¥çš„ç½‘å¡å-MACåœ°å€-PCI IDä¸‰ä¸ªå‚æ•°å°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ã€‚ 1234567891011121314# å¯¹éœ€è¦ä½¿ç”¨dpvsçš„ç½‘å¡åŠ è½½ç‰¹å®šçš„é©±åŠ¨$ ./usertools/dpdk-devbind.py -b igb_uio 0000:04:00.0$ ./usertools/dpdk-devbind.py -b igb_uio 0000:04:00.1$ ./usertools/dpdk-devbind.py -b igb_uio 0000:82:00.0$ ./usertools/dpdk-devbind.py -b igb_uio 0000:82:00.1# å†æ¬¡æ£€æŸ¥æ˜¯å¦åŠ è½½æˆåŠŸï¼Œä¸‹é¢åªæˆªå–éƒ¨åˆ†æœ‰ç”¨çš„è¾“å‡ºç»“æœ$ ./usertools/dpdk-devbind.py --statusNetwork devices using DPDK-compatible driver============================================0000:04:00.0 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; drv=igb_uio unused=ixgbe0000:04:00.1 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; drv=igb_uio unused=ixgbe0000:82:00.0 &#x27;Ethernet 10G 2P X520 Adapter 154d&#x27; drv=igb_uio unused=ixgbe0000:82:00.1 &#x27;Ethernet 10G 2P X520 Adapter 154d&#x27; drv=igb_uio unused=ixgbe 2.3 DPVSå®‰è£…12345678910111213141516171819202122232425262728293031323334$ cd /path/to/dpdk-stable-18.11.2/$ export RTE_SDK=$PWD$ cd /path/to/dpvs$ make $ make install# æŸ¥çœ‹binç›®å½•ä¸‹çš„äºŒè¿›åˆ¶æ–‡ä»¶$ ls /path/to/dpvs/bin/dpip dpvs ipvsadm keepalived# æ³¨æ„æŸ¥çœ‹makeè¿‡ç¨‹ä¸­çš„æç¤ºä¿¡æ¯ï¼Œå°¤å…¶æ˜¯keepalivedéƒ¨åˆ†ï¼Œå¦‚æœå‡ºç°ä¸‹é¢çš„éƒ¨åˆ†åˆ™è¡¨ç¤ºIPVSæ”¯æŒIPv6Keepalived configuration------------------------Keepalived version : 2.0.19Compiler : gccPreprocessor flags : -D_GNU_SOURCE -I/usr/include/libnl3Compiler flags : -g -g -O2 -fPIE -Wformat -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -O2Linker flags : -pie -Wl,-z,relro -Wl,-z,nowExtra Lib : -lm -lcrypto -lssl -lnl-genl-3 -lnl-3Use IPVS Framework : YesIPVS use libnl : YesIPVS syncd attributes : NoIPVS 64 bit stats : No# ä¸ºäº†æ–¹ä¾¿ç®¡ç†å¯ä»¥å°†ç›¸å…³çš„æ“ä½œå‘½ä»¤è½¯é“¾æ¥åˆ°/sbinä¸‹æ–¹ä¾¿å…¨å±€æ‰§è¡Œ$ ln -s /path/to/dpvs/bin/dpvs /sbin/dpvs$ ln -s /path/to/dpvs/bin/dpip /sbin/dpip$ ln -s /path/to/dpvs/bin/ipvsadm /sbin/ipvsadm$ ln -s /path/to/dpvs/bin/keepalived /sbin/keepalived# æ£€æŸ¥dpvsç›¸å…³å‘½ä»¤èƒ½å¦æ­£å¸¸å·¥ä½œ,æ³¨æ„å…¶ä»–å‘½ä»¤è¦åœ¨dpvsè¿›ç¨‹å¯åŠ¨åæ‰èƒ½æ­£å¸¸ä½¿ç”¨$ dpvs -vdpvs version: 1.8-10, build on 2021.07.26.15:34:26 2.4 é…ç½®dpvs.confåœ¨dpvs/confç›®å½•ä¸‹é¢æœ‰ç€å„ç§é…ç½®æ–¹å¼çš„dpvsé…ç½®æ–‡ä»¶èŒƒä¾‹ï¼ŒåŒæ—¶åœ¨dpvs.conf.itemsæ–‡ä»¶ä¸­è®°å½•äº†æ‰€æœ‰çš„å‚æ•°ï¼Œå»ºè®®åŒå­¦ä»¬å…¨éƒ¨é˜…è¯»ä¸€éäº†è§£äº†åŸºæœ¬è¯­æ³•ä¹‹åå†è¿›è¡Œé…ç½®ã€‚é»˜è®¤çš„dpvså¯åŠ¨çš„é…ç½®æ–‡ä»¶çš„æ˜¯/etc/dpvs.confã€‚ è¿™é‡Œç®€å•æ‘˜å‡ ä¸ªéƒ¨åˆ†å‡ºæ¥è¯´ä¸€ä¸‹ï¼ˆ!ä¸ºæ³¨é‡Šç¬¦å·ï¼‰ï¼š æ—¥å¿—çš„æ ¼å¼å¯ä»¥æ‰‹åŠ¨è°ƒæˆDEBUGå¹¶ä¸”ä¿®æ”¹æ—¥å¿—è¾“å‡ºçš„ä½ç½®æ–¹ä¾¿å®šä½é—®é¢˜ 1234global_defs &#123; log_level DEBUG log_file /path/to/dpvs/logs/dpvs.log&#125; å¦‚æœéœ€è¦å®šä¹‰å¤šä¸ªç½‘å¡ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªé…ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677netif_defs &#123; &lt;init&gt; pktpool_size 1048575 &lt;init&gt; pktpool_cache 256 &lt;init&gt; device dpdk0 &#123; rx &#123; queue_number 16 descriptor_number 1024 rss all &#125; tx &#123; queue_number 16 descriptor_number 1024 &#125; fdir &#123; mode perfect pballoc 64k status matched &#125; kni_name dpdk0.kni &#125; &lt;init&gt; device dpdk1 &#123; rx &#123; queue_number 16 descriptor_number 1024 rss all &#125; tx &#123; queue_number 16 descriptor_number 1024 &#125; fdir &#123; mode perfect pballoc 64k status matched &#125; kni_name dpdk1.kni &#125; &lt;init&gt; device dpdk2 &#123; rx &#123; queue_number 16 descriptor_number 1024 rss all &#125; tx &#123; queue_number 16 descriptor_number 1024 &#125; fdir &#123; mode perfect pballoc 64k status matched &#125; kni_name dpdk2.kni &#125; &lt;init&gt; device dpdk3 &#123; rx &#123; queue_number 16 descriptor_number 1024 rss all &#125; tx &#123; queue_number 16 descriptor_number 1024 &#125; fdir &#123; mode perfect pballoc 64k status matched &#125; kni_name dpdk3.kni &#125;&#125; å¤šä¸ªç½‘å¡çš„åŒä¸€ä¸ªæ”¶å‘é˜Ÿåˆ—å…±ç”¨åŒä¸€ä¸ªCPU 1234567891011121314151617181920&lt;init&gt; worker cpu1 &#123; type slave cpu_id 1 port dpdk0 &#123; rx_queue_ids 0 tx_queue_ids 0 &#125; port dpdk1 &#123; rx_queue_ids 0 tx_queue_ids 0 &#125; port dpdk2 &#123; rx_queue_ids 0 tx_queue_ids 0 &#125; port dpdk3 &#123; rx_queue_ids 0 tx_queue_ids 0 &#125;&#125; å¦‚æœéœ€è¦å•ç‹¬æŒ‡å®šæŸä¸ªCPUæ¥å¤„ç†ICMPæ•°æ®åŒ…ï¼Œå¯ä»¥åœ¨è¯¥workerçš„å‚æ•°ä¸­æ·»åŠ icmp_redirect_core 123456789&lt;init&gt; worker cpu16 &#123; type slave cpu_id 16 icmp_redirect_core port dpdk0 &#123; rx_queue_ids 15 tx_queue_ids 15 &#125;&#125; DPVSè¿›ç¨‹å¯åŠ¨åå¯ä»¥ç›´æ¥åœ¨Linuxç³»ç»Ÿçš„ç½‘ç»œé…ç½®æ–‡ä»¶ä¸­å¯¹ç›¸åº”çš„ç½‘å¡è¿›è¡Œé…ç½®ï¼Œä½¿ç”¨èµ·æ¥å’Œå…¶ä»–çš„eth0ä¹‹ç±»çš„ç½‘å¡æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ è¿è¡ŒæˆåŠŸä¹‹åï¼Œä½¿ç”¨dpipå‘½ä»¤å’Œæ­£å¸¸çš„ipã€ifconfigå‘½ä»¤éƒ½èƒ½å¤Ÿçœ‹åˆ°å¯¹åº”çš„dpdkç½‘å¡ï¼ŒIPv4å’ŒIPv6ç½‘ç»œéƒ½èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚ä¸‹å›¾åªæˆªå–éƒ¨åˆ†ä¿¡æ¯ï¼ŒIPå’ŒMACä¿¡æ¯å·²è„±æ•ï¼ŒIPv6ä¿¡æ¯å·²æ‘˜é™¤ã€‚ 12345678910111213141516171819$ dpip link show1: dpdk0: socket 0 mtu 1500 rx-queue 16 tx-queue 16 UP 10000 Mbps full-duplex auto-nego addr AA:BB:CC:23:33:33 OF_RX_IP_CSUM OF_TX_IP_CSUM OF_TX_TCP_CSUM OF_TX_UDP_CSUM$ ip a67: dpdk0.kni: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether AA:BB:CC:23:33:33 brd ff:ff:ff:ff:ff:ff inet 1.1.1.1/24 brd 1.1.1.255 scope global dpdk0.kni valid_lft forever preferred_lft forever $ ifconfig dpdk0.knidpdk0.kni: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 1.1.1.1 netmask 255.255.254.0 broadcast 1.1.1.255 ether AA:BB:CC:23:33:33 txqueuelen 1000 (Ethernet) RX packets 1790 bytes 136602 (133.4 KiB) RX errors 0 dropped 52 overruns 0 frame 0 TX packets 115 bytes 24290 (23.7 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 3ã€é…ç½®FullNatä¸ºäº†æ ¡éªŒæˆ‘ä»¬çš„DPVSèƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œè¿™é‡Œæˆ‘ä»¬å‚è€ƒå®˜æ–¹çš„é…ç½®æ–‡æ¡£ï¼Œå…ˆé…ç½®ä¸€ä¸ªæœ€ç®€å•çš„åŒè‡‚æ¨¡å¼çš„FNATã€‚å‚è€ƒå®˜æ–¹çš„æ¶æ„å›¾å¹¶ä¿®æ”¹å…¶ä¸­çš„IPåœ°å€ä¿¡æ¯æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç®€å•æ¶æ„å›¾ã€‚ è¯¥æ¨¡å¼ä¸‹ä¸éœ€è¦ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ipã€ifconfigç­‰å·¥å…·å¯¹DPVSè™šæ‹Ÿå‡ºçš„kniç½‘å¡è¿›è¡Œé…ç½® è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨dpdk2ç½‘å¡ä½œä¸ºwanå£ï¼Œdpdk0ç½‘å¡ä½œä¸ºlanå£ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# é¦–å…ˆæˆ‘ä»¬æŠŠVIP 10.0.96.204 åŠ åˆ°dpdk2ç½‘å¡ï¼ˆwanï¼‰ä¸Š$ dpip addr add 10.0.96.204/32 dev dpdk2# æ¥ç€æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸¤æ¡è·¯ç”±ï¼Œåˆ†ä¸ºæ˜¯wanå£ç½‘æ®µçš„è·¯ç”±å’Œåˆ°RSæœºå™¨ç½‘æ®µçš„è·¯ç”±$ dpip route add 10.0.96.0/24 dev dpdk2$ dpip route add 192.168.229.0/24 dev dpdk0# æœ€å¥½å†åŠ ä¸€æ¡åˆ°ç½‘å…³çš„é»˜è®¤è·¯ç”±ä¿è¯ICMPæ•°æ®åŒ…çš„å›åŒ…èƒ½è·‘é€š$ dpip route add default via 10.0.96.254 dev dpdk2# ä½¿ç”¨RRç®—æ³•å»ºç«‹è½¬å‘è§„åˆ™# add service &lt;VIP:vport&gt; to forwarding, scheduling mode is RR.# use ipvsadm --help for more info.$ ipvsadm -A -t 10.0.96.204:80 -s rr# è¿™é‡Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•æˆ‘ä»¬åªæ·»åŠ ä¸€å°RS# add two RS for service, forwarding mode is FNAT (-b)$ ipvsadm -a -t 10.0.96.204:80 -r 192.168.229.1 -b# æ·»åŠ LocalIPåˆ°ç½‘ç»œä¸­ï¼ŒFNATæ¨¡å¼è¿™é‡Œéœ€è¦# add at least one Local-IP (LIP) for FNAT on LAN interface$ ipvsadm --add-laddr -z 192.168.229.204 -t 10.0.96.204:80 -F dpdk0# ç„¶åæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ•ˆæœ$ dpip route showinet 192.168.229.204/32 via 0.0.0.0 src 0.0.0.0 dev dpdk0 mtu 1500 tos 0 scope host metric 0 proto autoinet 10.0.96.204/32 via 0.0.0.0 src 0.0.0.0 dev dpdk2 mtu 1500 tos 0 scope host metric 0 proto autoinet 10.0.96.0/24 via 0.0.0.0 src 0.0.0.0 dev dpdk2 mtu 1500 tos 0 scope link metric 0 proto autoinet 192.168.229.0/24 via 0.0.0.0 src 0.0.0.0 dev dpdk0 mtu 1500 tos 0 scope link metric 0 proto autoinet 0.0.0.0/0 via 10.0.96.254 src 0.0.0.0 dev dpdk2 mtu 1500 tos 0 scope global metric 0 proto auto$ dpip addr showinet 10.0.96.204/32 scope global dpdk2 valid_lft forever preferred_lft foreverinet 192.168.229.204/32 scope global dpdk0 valid_lft forever preferred_lft forever$ ipvsadm -lnIP Virtual Server version 0.0.0 (size=0)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 10.0.96.204:80 rr -&gt; 192.168.229.1:80 FullNat 1 0 0$ ipvsadm -GVIP:VPORT TOTAL SNAT_IP CONFLICTS CONNS10.0.96.204:80 1 192.168.229.204 0 0 ç„¶åæˆ‘ä»¬åœ¨RSä¸Šé¢å¯åŠ¨ä¸€ä¸ªnginxï¼Œè®¾ç½®è¿”å›IPå’Œç«¯å£å·ï¼Œçœ‹çœ‹æ•ˆæœï¼š 123456789server &#123; listen 80 default; location / &#123; default_type text/plain; return 200 &quot;Your IP and port is $remote_addr:$remote_port\\n&quot;; &#125;&#125; ç›´æ¥å¯¹VIPä½¿ç”¨pingå’Œcurlå‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼š 12345678910111213$ ping -c4 10.0.96.204PING 10.0.96.204 (10.0.96.204) 56(84) bytes of data.64 bytes from 10.0.96.204: icmp_seq=1 ttl=54 time=47.2 ms64 bytes from 10.0.96.204: icmp_seq=2 ttl=54 time=48.10 ms64 bytes from 10.0.96.204: icmp_seq=3 ttl=54 time=48.5 ms64 bytes from 10.0.96.204: icmp_seq=4 ttl=54 time=48.5 ms--- 10.0.96.204 ping statistics ---4 packets transmitted, 4 received, 0% packet loss, time 8msrtt min/avg/max/mdev = 47.235/48.311/48.969/0.684 ms$ curl 10.0.96.204Your IP and port is 192.168.229.204:1033 å¯ä»¥å‘ç°ä¸ç®¡åœ¨ä»€ä¹ˆæœºå™¨ä¸Šé¢éƒ½åªä¼šè¿”å›LIPçš„IPå’Œç«¯å£å·ï¼Œå¦‚æœéœ€è¦è·å–ç”¨æˆ·çš„çœŸå®IPï¼Œé‚£ä¹ˆå°±éœ€è¦å®‰è£…TOAæ¨¡å— 4ã€RSå®‰è£…TOAæ¨¡å—ç›®å‰å¼€æºç¤¾åŒºæä¾›toaæ¨¡å—çš„ç‰ˆæœ¬æ¯”è¾ƒå¤šï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ºäº†ä¿è¯å…¼å®¹æ€§ï¼Œç›´æ¥ä½¿ç”¨dpvså®˜æ–¹æä¾›çš„toaå’Œuoaæ¨¡å—ï¼Œæ ¹æ®ä»–ä»¬çš„å®˜æ–¹æè¿°ï¼Œä»–ä»¬çš„toaæ¨¡å—æ˜¯ä»Alibaba TOAä¸­å‰¥ç¦»å‡ºæ¥ TOA source code is included into DPVS project(in directory kmod/toa) since v1.7 to support IPv6 and NAT64. It is derived from the Alibaba TOA. For IPv6 applications which need clientâ€™s real IP address, we suggest to use this TOA version. ç”±äºæˆ‘ä»¬è¿™é‡Œçš„RSæœºå™¨å’ŒDPVSæœºå™¨éƒ½æ˜¯ä½¿ç”¨ç‰ˆæœ¬çš„CentOS7ç³»ç»Ÿï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨DPVSæœºå™¨ä¸Šé¢ç¼–è¯‘toaæ¨¡å—ï¼Œå†å¤åˆ¶åˆ°å„ä¸ªRSæœºå™¨ä¸Šä½¿ç”¨ 12$ cd /path/to/dpvs/kmod/toa/$ make é¡ºåˆ©ç¼–è¯‘å®Œæˆä¹‹åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªtoa.koæ¨¡å—æ–‡ä»¶ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨insmodå‘½ä»¤åŠ è½½æ¨¡å—ç„¶åæ£€æŸ¥ 123$ insmod toa.ko$ lsmod | grep toatoa 279641 0 ç¡®ä¿å¼€æœºåŠ è½½æ¨¡å—ï¼Œå¯ä»¥åœ¨rc.localæ–‡ä»¶ä¸­åŠ å…¥ä¸‹é¢çš„æŒ‡ä»¤ 123/usr/sbin/insmod /path/to/toa.ko# for exampleï¼š# /usr/sbin/insmod /home/dpvs/kmod/toa/toa.ko é™¤äº†toaæ¨¡å—ä¹‹å¤–ï¼Œè¿˜æœ‰é’ˆå¯¹UDPåè®®çš„uoaæ¨¡å—ï¼Œå’Œä¸Šé¢çš„toaæ¨¡å—ç¼–è¯‘å®‰è£…è¿‡ç¨‹å®Œå…¨ä¸€è‡´ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ åœ¨RSæœºå™¨ä¸Šé¢åŠ è½½äº†toaæ¨¡å—åæˆ‘ä»¬å†æ¬¡ä½¿ç”¨curlæµ‹è¯•æ•ˆæœï¼š 12$ curl 10.0.96.204Your IP and port is 172.16.0.1:62844 è‡³æ­¤ï¼Œæ•´ä¸ªDPVSçš„FullNatæ¨¡å¼å°±ç®—æ˜¯éƒ¨ç½²å®Œæˆå¹¶ä¸”èƒ½å¤Ÿæ­£å¸¸å·¥ä½œäº†ã€‚ç”±äºDPVSæ”¯æŒéå¸¸å¤šçš„é…ç½®ç»„åˆï¼Œåé¢ä¼šå†ä¸“é—¨å†™ä¸€ç¯‡å…³äºIPv6ã€nat64ã€keepalivedã€bondingã€Master/Backupæ¨¡å¼çš„é…ç½®ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"},{"name":"nat","slug":"nat","permalink":"https://tinychen.com/tags/nat/"},{"name":"lvs","slug":"lvs","permalink":"https://tinychen.com/tags/lvs/"},{"name":"dpdk","slug":"dpdk","permalink":"https://tinychen.com/tags/dpdk/"},{"name":"dpvs","slug":"dpvs","permalink":"https://tinychen.com/tags/dpvs/"}]},{"title":"CoreDNSç¯‡4-ç¼–è¯‘å®‰è£…unbound","slug":"20210713-dns-07-coredns-04-unbound","date":"2021-07-13T03:00:00.000Z","updated":"2021-07-13T03:00:00.000Z","comments":true,"path":"20210713-dns-07-coredns-04-unbound/","link":"","permalink":"https://tinychen.com/20210713-dns-07-coredns-04-unbound/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»corednsçš„unboundæ’ä»¶è¿›è¡Œç¼–è¯‘å®‰è£…çš„è¿‡ç¨‹åŠå¸¸ç”¨çš„é…ç½®æ–¹æ³•ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»corednsçš„unboundæ’ä»¶è¿›è¡Œç¼–è¯‘å®‰è£…çš„è¿‡ç¨‹åŠå¸¸ç”¨çš„é…ç½®æ–¹æ³•ã€‚ corednså®˜æ–¹çš„unboundæ–‡æ¡£unbound (coredns.io)ï¼Œä»¥åŠunboundæ’ä»¶çš„githubåœ°å€coredns/unbound: CoreDNS plugin that performs recursive queries using libunbound (github.com)ï¼Œæ­¤å‰å·²ç»ä»‹ç»è¿‡corednsç¼–è¯‘å…¶ä»–æ’ä»¶çš„æ–¹æ³•ï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥å…ˆå›é¡¾ä¸€ä¸‹ã€‚ æ­¤å¤–ï¼Œunboundæ’ä»¶è™½ç„¶æ˜¯corednsä¸­çš„External Pluginsï¼Œä½†æ˜¯ä»è¯¦æƒ…é¡µé¢ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Maintained by CoreDNS: CoreDNS maintainers take care of this plugin.ï¼Œè¯´æ˜è¿™ä¸ªæ’ä»¶æ˜¯å®˜æ–¹ç»´æŠ¤çš„ï¼Œåœ¨ç¨³å®šæ€§å¯é æ€§ä»¥åŠåç»­æ›´æ–°ç»´æŠ¤ä¸Šéƒ½æœ‰ä¸é”™çš„ä¿è¯ï¼Œåº”è¯¥æ˜¯å¯ä»¥æ”¾å¿ƒä½¿ç”¨çš„ã€‚ 1ã€é…ç½®ç¯å¢ƒè¦ä½¿ç”¨CGOç‰¹æ€§ï¼Œéœ€è¦å®‰è£…C/C++æ„å»ºå·¥å…·é“¾ï¼Œåœ¨macOSå’ŒLinuxä¸‹æ˜¯è¦å®‰è£…GCCï¼Œåœ¨windowsä¸‹æ˜¯éœ€è¦å®‰è£…MinGWå·¥å…·ã€‚åŒæ—¶éœ€è¦ä¿è¯ç¯å¢ƒå˜é‡CGO_ENABLEDè¢«è®¾ç½®ä¸º1ï¼Œè¿™è¡¨ç¤ºCGOæ˜¯è¢«å¯ç”¨çš„çŠ¶æ€ã€‚åœ¨æœ¬åœ°æ„å»ºæ—¶CGO_ENABLEDé»˜è®¤æ˜¯å¯ç”¨çš„ï¼Œå½“äº¤å‰æ„å»ºæ—¶CGOé»˜è®¤æ˜¯ç¦æ­¢çš„ã€‚æ¯”å¦‚è¦äº¤å‰æ„å»ºARMç¯å¢ƒè¿è¡Œçš„Goç¨‹åºï¼Œéœ€è¦æ‰‹å·¥è®¾ç½®å¥½C/C++äº¤å‰æ„å»ºçš„å·¥å…·é“¾ï¼ŒåŒæ—¶å¼€å¯CGO_ENABLEDç¯å¢ƒå˜é‡ã€‚ ä»¥CentOS8ä¸ºä¾‹ï¼Œæœ€å¥½æå‰å®‰è£…å¥½gccã€unbound-develå’Œunbound-libs 123456789101112131415[/home/coredns]# cat /etc/redhat-releaseCentOS Linux release 8.2.2004 (Core)[/home/coredns]# go env | grep &quot;CGO_ENABLED&quot;CGO_ENABLED=&quot;1&quot;[/home/coredns]# rpm -qa | grep gcclibgcc-8.4.1-1.el8.x86_64gcc-8.4.1-1.el8.x86_64gcc-c++-8.4.1-1.el8.x86_64gcc-gdb-plugin-8.4.1-1.el8.x86_64[/home/coredns]# rpm -qa | grep unboundunbound-devel-1.7.3-15.el8.x86_64unbound-libs-1.7.3-15.el8.x86_64 å¦‚æœåœ¨ä½¿ç”¨go getå‘½ä»¤è·å–unboundæ’ä»¶çš„æ—¶å€™é‡åˆ°ä¸‹é¢çš„è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªissueçš„è§£å†³æ–¹æ¡ˆï¼šHow to fix the issue: unbound.h: No such file or directory Â· Issue #3 Â· miekg/unbound (github.com) 123456[/home/coredns]# go get github.com/coredns/unbound# github.com/miekg/unbound../gopath/pkg/mod/github.com/miekg/unbound@v0.0.0-20210309082708-dbeefb4cdb29/unbound.go:36:10: fatal error: unbound.h: No such file or directory 36 | #include &lt;unbound.h&gt; | ^~~~~~~~~~~compilation terminated. å¯¹äºçº¢å¸½ç³»çš„Linuxå¯ä»¥ç›´æ¥å®‰è£…unbound-develï¼Œdebianç³»çš„è§£å†³æ–¹æ¡ˆç±»ä¼¼ï¼Œåªæ˜¯è½¯ä»¶åŒ…åå¯èƒ½ç•¥æœ‰ä¸åŒï¼ˆlibunbound-devï¼‰ã€‚ 1yum install -y unbound-devel éšåæµ‹è¯•å‘ç°æ­£å¸¸ 123[/home/coredns]# go get github.com/coredns/unboundgo get: added github.com/coredns/unbound v0.0.7go get: added github.com/miekg/unbound v0.0.0-20210309082708-dbeefb4cdb29 2ã€ç¼–è¯‘å®‰è£…è™½ç„¶æˆ‘ä»¬goçš„ç¯å¢ƒå˜é‡è®¾ç½®å¯ç”¨äº†CGOï¼Œä½†æ˜¯corednsçš„Makefileæ–‡ä»¶é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå› æ­¤éœ€è¦å°†é‡Œé¢çš„CGO_ENABLEDå‚æ•°ä»é»˜è®¤çš„0æ”¹ä¸º1ï¼Œä»è€Œæ‰èƒ½å¯ç”¨CGOã€‚ 12[/home/coredns]# grep &quot;CGO_ENABLED&quot; MakefileCGO_ENABLED:=1 éšåè¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œå®‰è£…å®ŒæˆåæŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„corednsäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦åŒ…å«unboundæ’ä»¶æ¥ç¡®å®šæ˜¯å¦é¡ºåˆ©ç¼–è¯‘å®‰è£…å®Œæˆã€‚ 1234567[/home/coredns]# echo &quot;unbound:github.com/coredns/unbound&quot; &gt;&gt; plugin.cfg[/home/coredns]# go generate[/home/coredns]# go build[/home/coredns]# makeCGO_ENABLED=1 go build -v -ldflags=&quot;-s -w -X github.com/coredns/coredns/coremain.GitCommit=7b43d042-dirty&quot; -o coredns[/home/coredns]# ./coredns -plugins | grep unbound dns.unbound å¯¹æ¯”æ˜¯å¦ç¼–è¯‘å®‰è£…äº†unboundæ’ä»¶çš„corednsï¼Œå¯ä»¥å‘ç°ä»åŸæ¥çš„é™æ€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå˜æˆäº†éœ€è¦åŠ¨æ€åŠ è½½ä¾èµ–åº“ã€‚å› æ­¤å¦‚æœéœ€è¦æå‰ç¼–è¯‘ç„¶åå¤§èŒƒå›´ä½¿ç”¨ï¼Œæœ€å¥½ä¿è¯ç¼–è¯‘ç¯å¢ƒçš„ç³»ç»Ÿå’Œæœ€ç»ˆçš„ä½¿ç”¨ç¯å¢ƒç³»ç»Ÿä¸€è‡´æˆ–å…¨å…¼å®¹ï¼ˆæœ¬æ–‡çš„ç¼–è¯‘ç¯å¢ƒä¸ºCentOS8.2ï¼Œä½¿ç”¨ç¯å¢ƒä¸ºRockyLinux8.4ï¼‰ã€‚ 123456789[root@tiny-rockylinux coredns]# file coredns.staticcoredns.static: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, stripped[root@tiny-rockylinux coredns]# file corednscoredns: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, stripped[root@tiny-rockylinux coredns]# file /lib64/ld-linux-x86-64.so.2/lib64/ld-linux-x86-64.so.2: symbolic link to ld-2.28.so[root@tiny-rockylinux coredns]# file /lib64/ld-2.28.so/lib64/ld-2.28.so: ELF 64-bit LSB shared object, x86-64, version 1 (GNU/Linux), dynamically linked, BuildID[sha1]=04c0b62c6350fa6ec9158369de8b5b489e3d084b, not stripped å¦‚æœåœ¨è¿è¡Œçš„æœºå™¨ä¸Šé¢é‡åˆ°ä¸‹é¢çš„æŠ¥é”™ï¼Œåˆ™éœ€è¦å®‰è£…ä¸Šé¢æåˆ°çš„unbound-develã€‚ 12[root@coredns sbin]# ./coredns./coredns: error while loading shared libraries: libunbound.so.2: cannot open shared object file: No such file or directory 3ã€é…ç½®ä½¿ç”¨è¯­æ³•é…ç½®1234unbound [FROM] &#123; except IGNORED_NAMES... option NAME VALUE&#125; FROM æŒ‡çš„æ˜¯å®¢æˆ·ç«¯è¯·æ±‚éœ€è¦è§£æçš„åŸŸåï¼Œä¾‹å¦‚blog.tinychen.comå’Œtinychen.comè¿™ä¸¤ä¸ªçš„FROMéƒ½æ˜¯tinychen.com IGNORED_NAMES å’Œexceptæ­é…ä½¿ç”¨ï¼ŒæŒ‡å®šä¸ä½¿ç”¨unboundçš„zone option å¯ä»¥æ·»åŠ unboundæœ¬èº«æ”¯æŒçš„ä¸€äº›å‚æ•°ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹unbound.confçš„manæ–‡æ¡£æˆ–è€…ç›´æ¥æŸ¥çœ‹å®˜ç½‘çš„æ–‡æ¡£ prometheusç›‘æ§unboundæ’ä»¶æä¾›äº†ä¸¤ä¸ªç›‘æ§æŒ‡æ ‡ï¼Œåªè¦å¯¹åº”çš„zoneä¸­å¯ç”¨äº†Prometheusæ’ä»¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥åŒæ—¶å¯ç”¨è¿™ä¸¤ä¸ªæŒ‡æ ‡(å…¶ä»–æ’ä»¶çš„ç›‘æ§æŒ‡æ ‡ä¹Ÿä¸€æ ·)ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š coredns_unbound_request_duration_seconds&#123;server&#125; - duration per query. coredns_unbound_response_rcode_count_total&#123;server, rcode&#125; - count of RCODEs. è¿™ä¸¤ä¸ªç›‘æ§æŒ‡æ ‡çš„æ•°æ®æ ¼å¼å’Œå†…å®¹ä¸corednsåŸç”Ÿçš„coredns_dns_request_duration_secondså’Œcoredns_dns_response_rcode_count_totalä¸€è‡´ï¼Œå› æ­¤ç›¸å…³çš„ç›‘æ§å›¾è¡¨åªéœ€è¦å¥—ç”¨åŸæœ‰çš„è¿›è¡Œç®€å•ä¿®æ”¹åå°±èƒ½ç›´æ¥ä½¿ç”¨ã€‚ èŒƒä¾‹é™¤äº†tinychen.comè¿™ä¸ªåŸŸåå…¶ä»–çš„éƒ½ä½¿ç”¨unboundï¼Œå¹¶å¼€å¯DNSæœ€å°åŒ–æŸ¥è¯¢åŠŸèƒ½ï¼ˆDNS Query Name Minimisationï¼‰ 1234567891011121314. &#123; unbound &#123; except tinychen.com option qname-minimisation yes &#125; log errors prometheus 0.0.0.0:9253 bind 0.0.0.0 cache &#123; success 10240 600 60 denial 5120 60 5 &#125;&#125;","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"coredns","slug":"coredns","permalink":"https://tinychen.com/tags/coredns/"}]},{"title":"nginxç¯‡12-é™é€Ÿä¸‰å‰‘å®¢ä¹‹limit_rate","slug":"20210712-nginx-12-triple-rate-limiting-limit-rate","date":"2021-07-12T07:00:00.000Z","updated":"2021-07-12T07:00:00.000Z","comments":true,"path":"20210712-nginx-12-triple-rate-limiting-limit-rate/","link":"","permalink":"https://tinychen.com/20210712-nginx-12-triple-rate-limiting-limit-rate/","excerpt":"æœ¬æ–‡ä¸»è¦æ˜¯å¯¹nginxå®˜æ–¹limit_rateç›¸å…³æŒ‡ä»¤çš„ç”¨æ³•è§£é‡Šå’Œä¸€äº›ä¸ªäººç†è§£ï¼Œlimit_rateä¸»è¦ç”¨äºé™åˆ¶ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œæœ€å¸¸ç”¨çš„åœºæ™¯å¯èƒ½å°±æ˜¯ä¸‹è½½/ä¸Šä¼ é™é€Ÿï¼Œåœ¨å¦‚ä»Šç”¨æˆ·ç½‘é€Ÿæ™®éå¤§å¹…æå‡çš„æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€äº›æ–‡ä»¶ä¼ è¾“ã€è§†é¢‘æµåª’ä½“ä¼ è¾“ç­‰æœåŠ¡è¿˜æ˜¯æœ‰ç€ä¸€å®šçš„åº”ç”¨åœºæ™¯çš„ã€‚","text":"æœ¬æ–‡ä¸»è¦æ˜¯å¯¹nginxå®˜æ–¹limit_rateç›¸å…³æŒ‡ä»¤çš„ç”¨æ³•è§£é‡Šå’Œä¸€äº›ä¸ªäººç†è§£ï¼Œlimit_rateä¸»è¦ç”¨äºé™åˆ¶ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œæœ€å¸¸ç”¨çš„åœºæ™¯å¯èƒ½å°±æ˜¯ä¸‹è½½/ä¸Šä¼ é™é€Ÿï¼Œåœ¨å¦‚ä»Šç”¨æˆ·ç½‘é€Ÿæ™®éå¤§å¹…æå‡çš„æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€äº›æ–‡ä»¶ä¼ è¾“ã€è§†é¢‘æµåª’ä½“ä¼ è¾“ç­‰æœåŠ¡è¿˜æ˜¯æœ‰ç€ä¸€å®šçš„åº”ç”¨åœºæ™¯çš„ã€‚ å’Œæˆ‘ä»¬å‰é¢æè¿‡çš„limit_reqæ¨¡å—å’Œlimit_connæ¨¡å—ä¸ä¸€æ ·çš„æ˜¯ï¼Œlimit_rateå¹¶æ²¡æœ‰å•ç‹¬çš„ä¸€ä¸ªæ¨¡å—ï¼Œè€Œæ˜¯åœ¨ngx_http_core_moduleä¸­ï¼ŒåŒæ—¶å®ƒçš„ç›¸å…³æŒ‡ä»¤ä¹Ÿæ¯”è¾ƒå°‘ï¼Œåªæœ‰limit_rateå’Œlimit_rate_afterè¿™ä¸¤ä¸ªæŒ‡ä»¤ã€‚ 1ã€limit_rate1234567# è¯­æ³•é…ç½®Syntax: limit_rate rate;Default: limit_rate 0;Context: http, server, location, if in location# ç¤ºä¾‹limit_rate 4k; limit_rateçš„ç”¨æ³•éå¸¸ç®€å•ï¼Œåé¢è·Ÿéšçš„rateå°±æ˜¯å…·ä½“é™é€Ÿçš„é˜ˆå€¼ æ³¨æ„é»˜è®¤çš„å•ä½æ˜¯bytes/sï¼Œä¹Ÿå°±æ˜¯æ¯ç§’ä¼ è¾“çš„å­—èŠ‚æ•°Bytesè€Œä¸æ˜¯æ¯”ç‰¹æ•°bits rateå¯ä»¥è®¾ç½®ä¸ºå˜é‡ï¼Œä»è€Œå¯ä»¥å®ç°åŠ¨æ€é™é€Ÿï¼Œåé¢æˆ‘ä»¬å†è¯¦ç»†ä»‹ç» é™é€ŸæŒ‡ä»¤çš„ç”Ÿæ•ˆèŒƒå›´æ˜¯æ ¹æ®æ¯ä¸ªè¿æ¥ç¡®å®šçš„ï¼Œä¾‹å¦‚ä¸Šé¢é™å®šæ¯ä¸ªè¿æ¥çš„é€Ÿç‡ä¸º4kï¼Œä¹Ÿå°±æ˜¯å½“å®¢æˆ·ç«¯å‘èµ·ä¸¤ä¸ªè¿æ¥çš„æ—¶å€™ï¼Œé€Ÿç‡å°±å¯ä»¥å˜ä¸º8k 2ã€limit_rate_after123456789101112# è¯­æ³•é…ç½®Syntax: limit_rate_after size;Default: limit_rate_after 0;Context: http, server, location, if in locationThis directive appeared in version 0.8.0.# ç¤ºä¾‹location /flv/ &#123; flv; limit_rate_after 500k; limit_rate 50k;&#125; limit_rate_afterå…è®¸åœ¨ä¼ è¾“äº†ä¸€éƒ¨åˆ†æ•°æ®ä¹‹åå†è¿›è¡Œé™é€Ÿï¼Œä¾‹å¦‚ä¸Šé¢çš„é…ç½®ä¸­å°±æ˜¯ä¼ è¾“çš„å‰500kbyteæ•°æ®ä¸é™é€Ÿï¼Œ500kä¹‹åå†è¿›è¡Œé™é€Ÿã€‚æ¯”è¾ƒå¸¸è§çš„åº”ç”¨åœºæ™¯å¦‚åˆ†æ®µä¸‹è½½é™é€Ÿï¼Œè¶…è¿‡æŒ‡å®šå¤§å°çš„éƒ¨åˆ†å†è¿›è¡Œé™é€Ÿï¼›åˆæˆ–è€…æ˜¯æµåª’ä½“è§†é¢‘ç½‘ç«™ä¸€èˆ¬ä¸ºäº†ä¿è¯ç”¨æˆ·ä½“éªŒè€Œä¸ä¼šå¯¹ç¬¬ä¸€ä¸ªç”»é¢è¿›è¡Œé™é€Ÿï¼Œç¡®ä¿å…¶èƒ½å¤Ÿå°½å¿«åŠ è½½å‡ºæ¥ï¼Œç­‰ç”¨æˆ·å¼€å§‹è§‚çœ‹è§†é¢‘ä¹‹åï¼Œå†æŠŠå¸¦å®½é™åˆ¶åœ¨åˆç†çš„èŒƒå›´å†…ï¼Œä»è€Œé™ä½å› å®¢æˆ·ç«¯ç½‘é€Ÿè¿‡å¿«å¯¼è‡´æå‰åŠ è½½è¿‡å¤šå†…å®¹å¸¦æ¥çš„é¢å¤–æˆæœ¬ã€‚ 3ã€proxy_limit_rateproxy_limit_rateçš„åŸºæœ¬åŸç†å’Œç”¨æ³•ä¸limit_rateå‡ ä¹ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯proxy_limit_rateæ˜¯é™åˆ¶nginxå’Œåç«¯upstreamæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥é€Ÿç‡è€Œlimit_rateé™åˆ¶çš„æ˜¯nginxå’Œå®¢æˆ·ç«¯ä¹‹é—´çš„è¿æ¥é€Ÿç‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯proxy_limit_rateéœ€è¦å¼€å¯äº†proxy_bufferingè¿™ä¸ªæŒ‡ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚ 1234Syntax: proxy_limit_rate rate;Default: proxy_limit_rate 0;Context: http, server, locationThis directive appeared in version 1.7.7. 4ã€åŠ¨æ€é™é€Ÿlimit_rateçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯èƒ½å¤Ÿä½¿ç”¨å˜é‡ï¼Œè¿™å°±æ„å‘³ç€å’ŒmapæŒ‡ä»¤ä¹‹ç±»çš„è¿›è¡Œç»„åˆå°±å¯ä»¥å®ç°åŠ¨æ€é™é€ŸåŠŸèƒ½ï¼Œè¿™é‡Œåªåˆ—å‡ ä¸ªç®€å•çš„ç¤ºèŒƒ 4.1 åŸºäºæ—¶é—´åŠ¨æ€é™é€Ÿè¿™é‡Œå¼•å…¥äº†nginxå†…ç½®çš„ä¸€ä¸ªssiæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—æœ‰ä¸¤ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„æ—¶é—´å˜é‡ï¼š$date_localå’Œ$date_gmtï¼Œåˆ†åˆ«å¯¹åº”å½“å‰æ—¶é—´å’ŒGMTæ—¶é—´ Module ngx_http_ssi_module (nginx.org) Embedded Variables The ngx_http_ssi_module module supports two embedded variables: $date_local current time in the local time zone. The format is set by the config command with the timefmt parameter. $date_gmt current time in GMT. The format is set by the config command with the timefmt parameter. è¿™é‡Œä½¿ç”¨å˜é‡å’ŒmapæŒ‡ä»¤ç»„åˆçš„æ–¹å¼ï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸åŒçš„æ—¶é—´æ®µï¼Œå†ç»“åˆmapå˜é‡å°†ä¸åŒæ—¶é—´æ®µå’Œä¸åŒçš„é™é€Ÿå¯¹åº”èµ·æ¥ã€‚ 12345678map $date_local $limit_rate_time &#123; default 4K; ~(00:|01:|02:|03:|04:|05:|06:|07:).*:.* 16K; ~(08:|12:|13:|18:).*:.* 8K; ~(19:|20:|21:|22:|23:).*:.* 16K;&#125;limit_rate $limit_rate_time 4.2 åŸºäºå˜é‡åŠ¨æ€é™é€Ÿæœ‰äº›æœåŠ¡å¯èƒ½ä¼šå¯¹ä¸ç”¨çš„ç”¨æˆ·è¿›è¡Œä¸åŒçš„é™é€Ÿï¼Œä¾‹å¦‚VIPç”¨æˆ·çš„é€Ÿåº¦è¦æ›´å¿«ä¸€äº›ç­‰ï¼Œä¾‹å¦‚ä¸‹é¢å¯ä»¥é’ˆå¯¹ä¸åŒçš„cookieè¿›è¡Œé™é€Ÿ 12345678map $cookie_User $limit_rate_cookie &#123; gold 64K; silver 32K; copper 16K; iron 8K;&#125;limit_rate $limit_rate_cookie å½“ç„¶è¿˜å¯ä»¥ä½¿ç”¨GeoIPæ¨¡å—ç­‰å…¶ä»–æ¨¡å—é’ˆå¯¹å¦‚ä¸åŒçš„IPè¿›è¡Œé™é€Ÿç­‰æ“ä½œï¼Œç”¨æ³•å’Œé…ç½®åŸºæœ¬ä¸Šéƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"nginxç¯‡11-é™é€Ÿä¸‰å‰‘å®¢ä¹‹limit_conn","slug":"20210708-nginx-11-triple-rate-limiting-limit-conn","date":"2021-07-08T10:00:00.000Z","updated":"2021-07-08T10:00:00.000Z","comments":true,"path":"20210708-nginx-11-triple-rate-limiting-limit-conn/","link":"","permalink":"https://tinychen.com/20210708-nginx-11-triple-rate-limiting-limit-conn/","excerpt":"æœ¬æ–‡ä¸»è¦æ˜¯å¯¹nginxå®˜æ–¹limit_connç›¸å…³æ¨¡å—çš„é…ç½®ç”¨æ³•å’Œä¸€äº›ä¸ªäººç†è§£ï¼Œlimit_connä¸»è¦ç”¨äºé™åˆ¶ç”¨æˆ·çš„è¿æ¥æ•°ï¼Œåœ¨å¦‚ä»Šå¤šçº¿ç¨‹å¹¶å‘è¯·æ±‚å¤§é‡æ™®åŠçš„æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€äº›ç‰¹æ®Šçš„åœºæ™¯è¿˜æ˜¯æœ‰ç€ä¸€å®šçš„ç”¨å¤„çš„ã€‚","text":"æœ¬æ–‡ä¸»è¦æ˜¯å¯¹nginxå®˜æ–¹limit_connç›¸å…³æ¨¡å—çš„é…ç½®ç”¨æ³•å’Œä¸€äº›ä¸ªäººç†è§£ï¼Œlimit_connä¸»è¦ç”¨äºé™åˆ¶ç”¨æˆ·çš„è¿æ¥æ•°ï¼Œåœ¨å¦‚ä»Šå¤šçº¿ç¨‹å¹¶å‘è¯·æ±‚å¤§é‡æ™®åŠçš„æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€äº›ç‰¹æ®Šçš„åœºæ™¯è¿˜æ˜¯æœ‰ç€ä¸€å®šçš„ç”¨å¤„çš„ã€‚ 1ã€èƒŒæ™¯ç›®å‰æ¥è¯´åœ¨nginxä¸Šé¢æˆ‘ä»¬å¸¸è§çš„ä¸‰ç§é™é€Ÿæ“ä½œåˆ†åˆ«æ˜¯ï¼šé™åˆ¶è¯·æ±‚æ•°(request)ã€é™åˆ¶è¿æ¥æ•°(connection)ã€é™åˆ¶å“åº”é€Ÿåº¦(rate)ï¼Œå¯¹åº”åœ¨nginxçš„æ¨¡å—ç›¸å…³æŒ‡ä»¤åˆ†åˆ«æ˜¯limit_reqã€limit_connå’Œlimit_rateä¸‰ä¸ªç³»åˆ—ã€‚limit_connæ¨¡å—å’Œlimit_reqæ¨¡å—ç±»ä¼¼ï¼Œæœ‰ç€è®¸å¤šä¸ªæŒ‡ä»¤ç»„æˆä¸€ä¸ªå¤§çš„æ¨¡å—ï¼Œä¸¤ä¸ªæ¨¡å—ä¹‹é—´æœ‰å¾ˆå¤šæŒ‡ä»¤çš„å‘½åæ–¹å¼å’Œç”¨æ³•ä¹Ÿå¤§åŒå°å¼‚ï¼Œå¯¹limit_reqæ¨¡å—æœ‰å…´è¶£çš„å¯ä»¥ç‚¹è¿™é‡ŒæŸ¥çœ‹ä¹‹å‰çš„æ–‡ç« ã€‚ ngx_http_limit_conn_module æ¨¡å—ä¸»è¦æ˜¯ç”¨äºæ ¹æ®ç‰¹å®šçš„keyæ¥é™åˆ¶è¿æ¥çš„æ•°é‡ï¼Œä¾‹å¦‚æ ¹æ®IPåœ°å€æ¥é™åˆ¶è¿æ¥æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿æ¥éƒ½ä¼šè¢«ç®—å…¥å…¶ä¸­ï¼Œåªæœ‰å½“ä¸€ä¸ªè¿æ¥çš„æ•´ä¸ªè¯·æ±‚å¤´è¢«è¯»å–å¹¶ä¸”å·²ç»è¢«nginxæœåŠ¡å™¨å¤„ç†çš„æ—¶å€™æ‰ä¼šç®—å…¥é™åˆ¶ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬é‡ç‚¹ä»‹ç»çš„è¿˜æ˜¯limit_connå’Œlimit_conn_zoneè¿™ä¸¤ä¸ªæŒ‡ä»¤ã€‚ 2ã€limit_conn_zoneæŒ‡ä»¤1234567# è¯­æ³•é…ç½®Syntax: limit_conn_zone key zone=name:size;Default: â€”Context: http# ç¤ºä¾‹limit_conn_zone $binary_remote_addr zone=addr:10m; limit_conn_zoneåªèƒ½å¤Ÿåœ¨httpå—ä¸­ä½¿ç”¨ keyå°±æ˜¯ç”¨æ¥åˆ¤å®šè¿æ¥æ•°çš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡å¯ä»¥æ˜¯æ–‡æœ¬ã€å˜é‡æˆ–å®ƒä»¬çš„ç»„åˆï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨IPåœ°å€+cookieç­‰å…¶ä»–å¤æ‚çš„ç»„åˆæ¥æ›´ç²¾ç¡®åœ°é™å®šèŒƒå›´ nameå°±æ˜¯è¿™ä¸ªzoneçš„å‘½åï¼Œç»è¿‡å®æµ‹nameéœ€è¦å…¨å±€å”¯ä¸€ï¼Œä¸å¯ä»¥å’Œå…¶ä»–çš„limit_conn_zoneçš„ç›¸åŒï¼Œæ¯•ç«Ÿåé¢çš„limit_connå‘½ä»¤éœ€è¦æ ¹æ®è¿™ä¸ªnameæ¥æŸ¥æ‰¾å¯¹åº”çš„zoneè¿›è¡Œç›¸åº”é™åˆ¶è§„åˆ™çš„åŒ¹é… sizeå®šä¹‰äº†è¿™ä¸ªzoneçš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯nginxä¼šåœ¨å†…å­˜ä¸­å¼€è¾Ÿå¤šå¤§çš„ç©ºé—´æ¥å­˜å‚¨è¿™ä¸ªzoneçš„ç›¸å…³ä¿¡æ¯ï¼Œä¸»è¦å’Œå‰é¢å®šä¹‰çš„keyçš„å¤§å°æœ‰å…³ç³»ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å†…å­˜å¤§å°è€—å°½çš„æ—¶å€™ï¼Œnginxä¼šç›´æ¥è¿”å›é”™è¯¯ç limit_conn_statusç»™åç»­çš„è¯·æ±‚ If the zone storage is exhausted, the server will return the error to all further requests. 3ã€limit_connæŒ‡ä»¤123456789101112# è¯­æ³•é…ç½®Syntax: limit_conn zone number;Default: â€”Context: http, server, location# ç¤ºä¾‹limit_conn_zone $binary_remote_addr zone=addr:10m;server &#123; location /download/ &#123; limit_conn addr 1; &#125; limit_connèƒ½åœ¨http ã€serverã€ locationä¸‰ä¸ªå—ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯è¦æ­é…å‰é¢æåŠçš„limit_conn_zone limit_connæŒ‡ä»¤çš„å˜é‡åªæœ‰zoneå’Œnumberä¸¤ä¸ª å…¶ä¸­zoneå°±æ˜¯å‰é¢çš„limit_conn_zoneä¸­çš„nameå˜é‡ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€å…¨å±€å”¯ä¸€çš„zoneï¼Œè´Ÿè´£ç¡®å®šé™åˆ¶è¿æ¥æ•°çš„ä¾æ® å…¶ä¸­numberå°±æ˜¯é™åˆ¶çš„è¿æ¥æ•°ï¼Œzoneå’Œnumberç»„åˆå°±å¯ä»¥å®Œæˆè¿æ¥æ•°çš„é™å®šåŠŸèƒ½ï¼Œæ³¨æ„è¿™é‡Œçš„numberå¿…é¡»ä½¿ç”¨æ•°å­—è€Œä¸èƒ½ä½¿ç”¨å˜é‡ å¯¹äºå¼€å¯äº†HTTP2çš„è¯·æ±‚æ¥è¯´ï¼Œæ¯ä¸ªå¹¶å‘è¯·æ±‚éƒ½ä¼šè¢«å½“ä½œä¸€ä¸ªå•ç‹¬çš„è¿æ¥ In HTTP/2 and SPDY, each concurrent request is considered a separate connection. 4ã€å…¶ä»–æŒ‡ä»¤å…¶ä»–çš„ä¸€äº›æŒ‡ä»¤ç”¨æ³•ç›¸å¯¹ç®€å•ï¼Œè¿™é‡Œç®€å•æè¿°ä¸€ä¸‹ 4.1 limit_zone(å·²å¼ƒç”¨)123Syntax: limit_zone name $variable size;Default: â€”Context: http ç”Ÿäº1.1.8ç‰ˆæœ¬ï¼Œå’äº1.7.6ç‰ˆæœ¬ 4.2 limit_conn_status1234Syntax: limit_conn_status code;Default: limit_conn_status 503;Context: http, server, locationThis directive appeared in version 1.3.15. limit_conn_statusè¿™ä¸ªæŒ‡ä»¤æ˜¯ç”¨æ¥æŒ‡å®šnginxå›å¤é‚£äº›è¢«ç¦ç”¨çš„è¿æ¥è¯·æ±‚æ—¶çš„çŠ¶æ€ç ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯503ï¼ˆService Unavailable æœåŠ¡ä¸å¯ç”¨ï¼‰ï¼Œå¦‚æœæ˜¯ä¸€äº›æœ‰ç‰¹æ®Šéœ€æ±‚çš„åœºæ™¯ï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒæ•´ä¸º403ä¹‹ç±»çš„çŠ¶æ€ç ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„çŠ¶æ€ç éƒ½å¯ä»¥ä½¿ç”¨ï¼Œnginxå®˜æ–¹é™å®šçŠ¶æ€ç å¿…é¡»åœ¨400åˆ°599ä¹‹é—´ã€‚ 4.3 limit_conn_dry_run1234Syntax: limit_conn_dry_run on | off;Default: limit_conn_dry_run off;Context: http, server, locationThis directive appeared in version 1.17.6. dry_runæ¨¡å¼çš„æ„ä¹‰åœ¨äºè¯•è¿è¡Œè€Œä¸å¯¹çº¿ä¸Šä¸šåŠ¡é€ æˆå½±å“ã€‚è®¾ç½®ä¸ºonä¹‹åï¼Œå‰é¢çš„limit_connæŒ‡ä»¤å¹¶ä¸ä¼šçœŸæ­£ç”Ÿæ•ˆï¼Œä½†æ˜¯limit_conn_zoneæŒ‡ä»¤ä¼šç”Ÿæ•ˆï¼Œnginxä¼šåœ¨å†…å­˜ä¸­å­˜å‚¨è®¡ç®—ç›¸å…³çš„æ•°æ®ã€‚ 4.4 limit_conn_log_level1234Syntax: limit_conn_log_level info | notice | warn | error;Default: limit_conn_log_level error;Context: http, server, locationThis directive appeared in version 0.8.18. ç”¨æ¥è°ƒè¯•çš„æ—¥å¿—ï¼Œä»æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œä¼šè¾“å‡ºåˆ°error.logä¸­è€Œä¸æ˜¯access.logï¼Œè°ƒæˆinfoçš„è¯ä¼šæœ‰è¾ƒå¤šçš„æ—¥å¿—è¾“å‡ºï¼Œéœ€è¦é¢å¤–æ³¨æ„ç¡¬ç›˜å®¹é‡ç­‰ç›¸å…³é—®é¢˜ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"RockyLinuxç®€å•å®‰è£…ä¸Šæ‰‹ä½“éªŒ","slug":"20210705-rockylinux-quick-start-experience","date":"2021-07-05T07:00:00.000Z","updated":"2021-07-05T07:00:00.000Z","comments":true,"path":"20210705-rockylinux-quick-start-experience/","link":"","permalink":"https://tinychen.com/20210705-rockylinux-quick-start-experience/","excerpt":"Rocky Linux â€” A community-driven effort to bring you enterprise-grade, production-ready Linux.","text":"Rocky Linux â€” A community-driven effort to bring you enterprise-grade, production-ready Linux. 1ã€èƒŒæ™¯ä»‹ç»è¿™é‡Œæ‘˜å½•ä¸€æ®µå®˜ç½‘çš„ç®€ä»‹ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è®¿é—®å®˜ç½‘è·å–æ›´å¤šä¿¡æ¯ï¼Œå®˜ç½‘æä¾›äº†å¤šç§è¯­è¨€æ”¯æŒï¼Œåœ¨ä½“éªŒä¸Šè¿˜æ˜¯ç›¸å½“ä¸é”™çš„ã€‚ Rocky Linux æ˜¯ä¸€ä¸ªç¤¾åŒºåŒ–çš„ä¼ä¸šçº§æ“ä½œç³»ç»Ÿã€‚å…¶è®¾è®¡ä¸ºçš„æ˜¯ä¸ç¾å›½é¡¶çº§ä¼ä¸š Linux å‘è¡Œç‰ˆå®ç° 100ï¼… Bug çº§å…¼å®¹ï¼Œè€ŒåŸå› æ˜¯åè€…çš„ä¸‹æ¸¸åˆä½œä¼™ä¼´è½¬ç§»äº†å‘å±•æ–¹å‘ã€‚ç›®å‰ç¤¾åŒºæ­£åœ¨é›†ä¸­åŠ›é‡å‘å±•æœ‰å…³è®¾æ–½ã€‚Rocky Linux ç”± CentOS é¡¹ç›®çš„åˆ›å§‹äºº Gregory Kurtzer é¢†å¯¼ã€‚ Rocky Linux ä»8.2ç‰ˆæœ¬å¼€å§‹å†…æµ‹ï¼Œéšå8.3ç‰ˆæœ¬å¼€å§‹RCï¼Œ8.4ç‰ˆæœ¬å¼€å§‹GAï¼Œæ•ˆç‡ä¸Šè¿˜æ˜¯ç›¸å½“é«˜çš„ã€‚æˆ‘ä»¬è¿™é‡Œä»¥8.4ç‰ˆæœ¬ä¸ºä¾‹è¿›è¡Œå®‰è£…ä½“éªŒã€‚å€¼å¾—é¡ºä¾¿ä¸€æçš„æ˜¯ï¼Œé™¤äº†å¸¸è§„çš„å®‰è£…é•œåƒï¼ŒRocky Linux è¿˜æä¾›äº†WSLç›¸å…³çš„å®‰è£…åŒ…ï¼Œå„ç§ç‰ˆæœ¬çš„æ”¯æŒéƒ½ç›¸å½“å…¨é¢ï¼Œç›®å‰çœ‹æ¥ç¡®å®ç»™äººæ„Ÿè§‰æ¯”è¾ƒé è°±ã€‚ 2ã€å®‰è£…ä½“éªŒè¿™é‡Œä½¿ç”¨kvmè™šæ‹Ÿæœºæ¥è¿›è¡Œå®‰è£…ä½“éªŒã€‚Rocky Linux çš„æ•´ä½“å®‰è£…è¿‡ç¨‹å’Œcentos8å¹¶æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œå†…ç½®çš„ä¸€äº›è½¯ä»¶ä¹ŸåŸºæœ¬ä¸€è‡´ã€‚é™¤äº†ä¸€äº›å…³é”®çš„åç§°å’Œlogoã€å›¾ç‰‡ç­‰è¿›è¡Œäº†å˜æ›´ï¼Œæ›´åŠ å¥‘åˆRocky Linux æœ¬èº«çš„å½¢è±¡æ°”è´¨ã€‚ 3ã€å¸¸ç”¨è½¯ä»¶123456789101112131415161718192021222324252627282930313233[root@tiny-rockylinux ~]# uname -r4.18.0-305.3.1.el8_4.x86_64[root@tiny-rockylinux ~]# lsb_release -aLSB Version: :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarchDistributor ID: RockyDescription: Rocky Linux release 8.4 (Green Obsidian)Release: 8.4Codename: GreenObsidian[root@tiny-rockylinux ~]# rpm -qa | grep glibcglibc-2.28-151.el8.x86_64[root@tiny-rockylinux ~]# yum --version4.4.2 Installed: dnf-0:4.4.2-11.el8.noarch at Mon 05 Jul 2021 07:46:22 AM GMT Built : infrastructure@rockylinux.org at Tue 25 May 2021 07:59:44 PM GMT Installed: rpm-0:4.14.3-14.el8_4.x86_64 at Mon 05 Jul 2021 08:22:57 AM GMT Built : infrastructure@rockylinux.org at Tue 29 Jun 2021 05:33:33 PM GMT [root@tiny-rockylinux ~]# dnf --version4.4.2 Installed: dnf-0:4.4.2-11.el8.noarch at Mon 05 Jul 2021 07:46:22 AM GMT Built : infrastructure@rockylinux.org at Tue 25 May 2021 07:59:44 PM GMT Installed: rpm-0:4.14.3-14.el8_4.x86_64 at Mon 05 Jul 2021 08:22:57 AM GMT Built : infrastructure@rockylinux.org at Tue 29 Jun 2021 05:33:33 PM GMT [root@tiny-rockylinux ~]# rpm --versionRPM version 4.14.3 4ã€yumæºæ”¯æŒä½¿ç”¨centos8åŒæ ·çš„epelã€elrepoå’Œdockeræºï¼Œå‘ç°éƒ½èƒ½å¤Ÿå…¼å®¹å®‰è£…å¹¶ä¸”æ­£å¸¸ä½¿ç”¨ã€‚è¿™ä¹Ÿæ„å‘³ç€ä½¿ç”¨å›½å†…çš„é•œåƒæºä¹Ÿæ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸­ç§‘å¤§çš„é•œåƒæºï¼Œä½¿ç”¨èµ·æ¥å®Œå…¨æ­£å¸¸ã€‚ 1234567891011121314151617181920[root@tiny-rockylinux yum.repos.d]# lltotal 72-rw-r--r--. 1 root root 1919 Jul 5 16:38 docker-ce.repo-rw-r--r--. 1 root root 1906 Jun 16 2020 elrepo.repo-rw-r--r--. 1 root root 1177 Dec 6 2020 epel-modular.repo-rw-r--r--. 1 root root 1259 Dec 6 2020 epel-playground.repo-rw-r--r--. 1 root root 1114 Dec 6 2020 epel.repo-rw-r--r--. 1 root root 1276 Dec 6 2020 epel-testing-modular.repo-rw-r--r--. 1 root root 1213 Dec 6 2020 epel-testing.repo-rw-r--r--. 1 root root 700 Jun 19 22:20 Rocky-AppStream.repo-rw-r--r--. 1 root root 685 Jun 19 22:20 Rocky-BaseOS.repo-rw-r--r--. 1 root root 713 Jun 19 22:20 Rocky-Devel.repo-rw-r--r--. 1 root root 685 Jun 19 22:20 Rocky-Extras.repo-rw-r--r--. 1 root root 721 Jun 19 22:20 Rocky-HighAvailability.repo-rw-r--r--. 1 root root 680 Jun 19 22:20 Rocky-Media.repo-rw-r--r--. 1 root root 685 Jun 19 22:20 Rocky-Plus.repo-rw-r--r--. 1 root root 705 Jun 19 22:20 Rocky-PowerTools.repo-rw-r--r--. 1 root root 736 Jun 19 22:20 Rocky-ResilientStorage.repo-rw-r--r--. 1 root root 671 Jun 19 22:20 Rocky-RT.repo-rw-r--r--. 1 root root 2407 Jun 19 22:20 Rocky-Sources.repo 4.1 epelæº 4.2 elrepoæº 4.3 dockeræº å°è¯•å®‰è£…dockerçš„æ—¶å€™æŠ¥è½¯ä»¶å†²çªé”™è¯¯ï¼š çœ‹èµ·æ¥æ˜¯å·²ç»å†…ç½®çš„podmanã€buildahå’Œè¦å®‰è£…çš„dockerå¥—ä»¶å†²çªäº†ï¼Œå¸è½½å†²çªçš„è½¯ä»¶åå†è¿›è¡Œé‡æ–°å®‰è£…å³å¯æ­£å¸¸è¿è¡Œäº† 4.4 é»˜è®¤æºæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹Rocky Linuxçš„é»˜è®¤æºï¼Œè·³è½¬åˆ°å¯¹åº”çš„ç½‘å€å¯ä»¥çœ‹åˆ°ç›¸å¯¹åº”çš„é•œåƒ 123456789101112131415161718[root@tiny-rockylinux yum.repos.d]# cat Rocky-BaseOS.repo# Rocky-BaseOS.repo## The mirrorlist system uses the connecting IP address of the client and the# update status of each mirror to pick current mirrors that are geographically# close to the client. You should use this for Rocky updates unless you are# manually picking other mirrors.## If the mirrorlist does not work for you, you can try the commented out# baseurl line instead.[baseos]name=Rocky Linux $releasever - BaseOSmirrorlist=https://mirrors.rockylinux.org/mirrorlist?arch=$basearch&amp;repo=BaseOS-$releasever#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/BaseOS/$basearch/os/gpgcheck=1enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial ç®€å•æŸ¥çœ‹äº†ä¸€ä¸‹å‘ç°å›½å†…çš„é•œåƒæºè¿˜ä¸å°‘ï¼Œå±±ä¸œå¤§å­¦ã€é‡åº†å¤§å­¦ã€ä¸Šæµ·äº¤é€šå¤§å­¦ç­‰éƒ½æœ‰é•œåƒæºï¼Œç›®å‰æ¥çœ‹æ»¡è¶³æ­£å¸¸ä½¿ç”¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ 5ã€å‘å±•å‰æ™¯Rocky Linuxçš„ç›®æ ‡å°±æ˜¯ä¸ºäº†æ¥æ›¿CentOSçš„ä½ç½®ï¼Œæˆä¸ºå¼€æºç¤¾åŒºçš„ä¸€ä¸ªç‹¬ç«‹çš„ç¨³å®šå¯é çš„Linuxå‘è¡Œç‰ˆï¼ŒåŒæ—¶ä¼š100%å…¼å®¹RHELï¼Œåœ¨RHELçš„ä¸‹æ¸¸è¿›è¡Œæ›´æ–°æ“ä½œï¼ŒåŒæ—¶åˆ›å§‹äººç›®å‰è¡¨ç¤ºä¸ºäº†è®©Rocky Linuxä¸å†æˆä¸ºä¸‹ä¸€ä¸ªCentOSï¼ˆæŒ‡è¢«æ”¶è´­åä¸§å¤±ç¤¾åŒºæ§åˆ¶æƒä»RHELçš„ä¸‹æ¸¸è½¬åˆ°ä¸Šæ¸¸ï¼‰åšäº†è®¸å¤šå·¥ä½œï¼Œé™¤äº†æ‹‰äº†éå¸¸å¤šå‰å®³çš„èµåŠ©å•†ä¹‹å¤–ï¼Œè¿˜ä¸“é—¨æˆç«‹äº†Rocky Enterprise Software Foundation (RESF) åŸºé‡‘ä¼šï¼ŒåŒæ—¶åˆ¶è®¢äº†å¼€æºç¤¾åŒºç« ç¨‹ï¼Œè¿˜åœ¨è§„åˆ’æ›´å¥½çš„æ–‡æ¡£ç¤¾åŒºï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½éå¸¸çš„ä¸é”™ã€‚ å°½ç®¡åˆæ¥ä¹åˆ°ï¼ŒRocky Linux é¡¹ç›®è¿˜æ˜¯æ‹¥æœ‰ç›¸å½“é«˜çš„äººæ°”å’Œæ¨åŠ¨åŠ›ã€‚æœ‰æŠ¥é“ç§°ï¼Œåœ¨å‘å¸ƒä¼šå 72 å°æ—¶å†…ï¼Œç”± Fastly æä¾›çš„ Tier0 é•œåƒå°±è¿æ¥äº†å°†è¿‘ 70000 æ¬¡çš„ä¸‹è½½é‡ï¼Œæ­¤å¤– torrent ä¸­å­æ–‡ä»¶çš„ä¸‹è½½é‡ä¹Ÿæœ‰å°†å¤§çº¦ 10000 æ¬¡ã€‚ Summarized, the Rocky Enterprise Software Foundation (RESF) is a Public Benefit Corporation (PBC) formed in Delaware (file number 4429978), backed by a board of advisors with access control policies that utilize the principle of least privilege and separation of duty to ensure that no action can be taken unilaterally (not even by the legal owner, Gregory Kurtzer). For more information, see our Organizational Structure. ç›®å‰çœ‹æ¥Rocky Linuxçš„èµåŠ©å•†é˜µå®¹è¿˜æ˜¯ç›¸å¯¹ä¸é”™çš„ï¼ŒCIQä½œä¸ºåˆ›å§‹èµåŠ©å•†ï¼ˆå®˜ç½‘é¦–é¡µå®£ä¼ ä¸Šäº†Rocky Linuxï¼‰ï¼Œ45Drivesä½œä¸ºå­˜å‚¨èµåŠ©å•†ï¼Œè¿˜æœ‰å›½å¤–çš„äº‘è®¡ç®—ä¸‰å·¨å¤´å¾®è½¯è°·æ­Œäºšé©¬é€Šä¹Ÿè¡¨ç¤ºä¼šæŠŠRocky Linuxç³»ç»ŸåŠ å…¥åˆ°å®ƒä»¬çš„äº‘æœåŠ¡å™¨ç³»ç»Ÿé•œåƒåˆ—è¡¨ä¸­ã€‚æ­¤å¤–Rocky Linux 8.4 GAç‰ˆæœ¬å‘å¸ƒåçš„ä¸‹è½½é‡ä¹Ÿæ˜¯ç›¸å½“ä¸é”™ï¼Œæ®ç§å­æ–‡ä»¶çš„ç»Ÿè®¡å¤§æ¦‚åœ¨72å°æ—¶å†…è¾¾åˆ°äº†å…«ä¸‡æ¬¡å·¦å³ï¼Œè¡¨æ˜ç¤¾åŒºæœŸç›¼å€¼æ˜¯ç›¸å½“é«˜çš„ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œå¦‚æœèƒ½å¤ŸæŒ‰ç…§ç›®å‰è¿™ä¸ªåŠ¿å¤´å‘å±•ä¸‹å»ï¼ŒRocky Linuxç¡®å®æœªæ¥å¯æœŸã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"rockylinux","slug":"rockylinux","permalink":"https://tinychen.com/tags/rockylinux/"}]},{"title":"CoreDNSç¯‡3-æ¥å…¥prometheusç›‘æ§","slug":"20210623-dns-06-coredns-03-prometheus","date":"2021-06-24T09:00:00.000Z","updated":"2021-06-24T09:00:00.000Z","comments":true,"path":"20210623-dns-06-coredns-03-prometheus/","link":"","permalink":"https://tinychen.com/20210623-dns-06-coredns-03-prometheus/","excerpt":"æœ¬æ–‡ä¸»è¦å¯¹corednsçš„prometheusç›‘æ§è¿›è¡Œä»‹ç»ï¼Œä»¥åŠå¯¹grafanaä¸­é…ç½®corednsçš„dashboardè¿›è¡Œåˆ†äº«ã€‚","text":"æœ¬æ–‡ä¸»è¦å¯¹corednsçš„prometheusç›‘æ§è¿›è¡Œä»‹ç»ï¼Œä»¥åŠå¯¹grafanaä¸­é…ç½®corednsçš„dashboardè¿›è¡Œåˆ†äº«ã€‚ 0ã€èƒŒæ™¯Prometheusæ’ä»¶ä½œä¸ºcorednsçš„Pluginsï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å†…ç½®åœ¨corednsä¸­ï¼Œå¦‚æœæ˜¯è‡ªå·±ç¼–è¯‘å®‰è£…çš„ç‰ˆæœ¬ï¼Œéœ€è¦æ³¨æ„åœ¨ç¼–è¯‘å®‰è£…çš„æ—¶å€™çš„plugin.cfgæ–‡ä»¶ä¸­æ·»åŠ äº†prometheus:metricsï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿ç¼–è¯‘æˆåŠŸã€‚ 123# é¦–å…ˆæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹è¿è¡Œçš„ç‰ˆæœ¬[root@tiny-server coredns]# ./coredns -plugins | grep prometheus dns.prometheus 1ã€ç®€ä»‹prometheus æ’ä»¶ä¸»è¦ç”¨äºæš´éœ²CoreDNSç›¸å…³çš„ç›‘æ§æ•°æ®ï¼Œé™¤äº†corednsæœ¬èº«å¤–ï¼Œå…¶ä»–æ”¯æŒprometheusçš„æ’ä»¶ï¼ˆå¦‚cacheæ’ä»¶ï¼‰åœ¨å¯ç”¨çš„æ—¶å€™ä¹Ÿå¯ä»¥é€šè¿‡prometheusæ’ä»¶æš´éœ²å‡ºç›¸å…³çš„ç›‘æ§ä¿¡æ¯ï¼Œé»˜è®¤æƒ…å†µä¸‹æš´éœ²å‡ºçš„ç›‘æ§æ•°æ®åœ¨localhost:9153ï¼Œè·¯å¾„ä¸º/metricsï¼Œé…ç½®æ–‡ä»¶ä¸­çš„æ¯ä¸ªserverå—åªèƒ½ä½¿ç”¨ä¸€æ¬¡prometheusã€‚ä¸‹é¢æ˜¯ä¸€äº›corednsè‡ªèº«ç›¸å…³çš„æŒ‡æ ‡ï¼š coredns_build_info&#123;version, revision, goversion&#125; - å…³äº CoreDNS æœ¬èº«çš„ä¿¡æ¯ coredns_panics_total&#123;&#125; - panicsçš„æ€»æ•° coredns_dns_requests_total&#123;server, zone, proto, family, type&#125; - æ€»æŸ¥è¯¢æ¬¡æ•° coredns_dns_request_duration_seconds&#123;server, zone, type&#125; - å¤„ç†æ¯ä¸ªæŸ¥è¯¢çš„è€—æ—¶ coredns_dns_request_size_bytes&#123;server, zone, proto&#125; - è¯·æ±‚çš„å¤§å°ï¼ˆä»¥bytesä¸ºå•ä½ï¼‰ coredns_dns_do_requests_total&#123;server, zone&#125; - è®¾ç½®äº† DO ä½çš„æŸ¥è¯¢ï¼ˆqueries that have the DO bit setï¼‰ coredns_dns_response_size_bytes&#123;server, zone, proto&#125; - å“åº”çš„å¤§å°ï¼ˆä»¥bytesä¸ºå•ä½ï¼‰ coredns_dns_responses_total&#123;server, zone, rcode&#125; - æ¯ä¸ªzoneçš„å“åº”ç å’Œæ•°é‡ coredns_plugin_enabled&#123;server, zone, name&#125; - æ¯ä¸ªzoneä¸Šé¢çš„å„ä¸ªæ’ä»¶æ˜¯å¦è¢«å¯ç”¨ éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šé¢é¢‘ç¹å‡ºç°çš„å‡ ä¸ªæ ‡ç­¾(label)ï¼Œè¿™é‡Œé¢å¤–åšä¸€äº›è§£é‡Šï¼š zoneï¼šæ¯ä¸ªrequest/responseç›¸å…³çš„æŒ‡æ ‡éƒ½ä¼šæœ‰ä¸€ä¸ªzoneçš„æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°çš„å¤§å¤šæ•°ç›‘æ§æŒ‡æ ‡éƒ½æ˜¯å¯ä»¥ç»†åŒ–åˆ°æ¯ä¸€ä¸ªzoneçš„ã€‚è¿™å¯¹äºéœ€è¦å…·ä½“ç»Ÿè®¡ç›¸å…³æ•°æ®å’Œç›‘æ§æ’æŸ¥é—®é¢˜çš„æ—¶å€™æ˜¯éå¸¸æœ‰ç”¨çš„ serverï¼šæ˜¯ç”¨æ¥æ ‡å¿—æ­£åœ¨å¤„ç†è¿™ä¸ªå¯¹åº”è¯·æ±‚çš„æœåŠ¡å™¨ï¼Œä¸€èˆ¬çš„æ ¼å¼ä¸º&lt;scheme&gt;://[&lt;bind&gt;]:&lt;port&gt;ï¼Œé»˜è®¤æƒ…å†µä¸‹åº”è¯¥æ˜¯dns://:53ï¼Œå¦‚æœä½¿ç”¨äº†bindæ’ä»¶æŒ‡å®šç›‘å¬çš„IPï¼Œé‚£ä¹ˆå°±å¯èƒ½æ˜¯dns://127.0.0.53:53è¿™ä¸ªæ ·å­ protoï¼šæŒ‡ä»£çš„å°±æ˜¯ä¼ è¾“çš„åè®®ï¼Œä¸€èˆ¬å°±æ˜¯udpæˆ–tcp familyï¼šæŒ‡ä»£çš„æ˜¯ä¼ è¾“çš„IPåè®®ä»£æ•°ï¼Œ(1 = IP (IP version 4), 2 = IP6 (IP version 6)) typeï¼šæŒ‡ä»£çš„æ˜¯DNSæŸ¥è¯¢çš„ç±»å‹ï¼Œè¿™é‡Œè¢«åˆ†ä¸ºå¸¸è§çš„å¦‚(A, AAAA, MX, SOA, CNAME, PTR, TXT, NS, SRV, DS, DNSKEY, RRSIG, NSEC, NSEC3, IXFR, AXFR and ANY) å’Œå…¶ä»–ç±»å‹ â€œotherâ€ If monitoring is enabled, queries that do not enter the plugin chain are exported under the fake name â€œdroppedâ€ (without a closing dot - this is never a valid domain name). 2ã€é…ç½®corednsä¸­æƒ³è¦å¯ç”¨prometheusæ’ä»¶ï¼Œåªéœ€è¦åœ¨å¯¹åº”çš„zoneä¸­åŠ ä¸Šè¿™ä¸€è¡Œé…ç½®å³å¯ï¼Œé»˜è®¤ç›‘å¬çš„æ˜¯æœ¬æœº127.0.0.1çš„9153ç«¯å£ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ›´æ”¹ç›‘å¬çš„ç½‘å¡å’Œç«¯å£ã€‚ Syntax1prometheus [ADDRESS] æˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸€æ®µé…ç½®ï¼š 12345678910111213tinychen.com:53 &#123; forward tinychen.com 47.107.188.168 prometheus&#125;google.com:53 &#123; forward google.com 8.8.8.8 9.9.9.9 prometheus 192.168.100.100:9253&#125;example.org &#123; file /home/coredns/conf/example.org&#125; prometheusçš„ç”Ÿæ•ˆèŒƒå›´æ˜¯æŒ‰ç…§zoneæ¥åˆ’åˆ†çš„ï¼Œåœ¨ä¸Šé¢çš„è¿™ä¸ªé…ç½®ä¸­ï¼š tinychen.com:53è¿™ä¸ªåŸŸä½¿ç”¨çš„æ˜¯Prometheusçš„é»˜è®¤é…ç½®ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„ç›‘å¬æƒ…å†µå°±æ˜¯é»˜è®¤çš„127.0.0.1çš„9153ç«¯å£ï¼Œè¯·æ±‚http://127.0.0.1:9153/metrics/è¿™ä¸ªåœ°å€å°±èƒ½å¤Ÿè·å–åˆ°tinychen.com:53è¿™ä¸ªåŸŸçš„ç›‘æ§ä¿¡æ¯ åŒç†åœ¨http://192.168.100.100:9253/metrics/è¿™ä¸ªåœ°å€èƒ½å¤Ÿè·å–åˆ°google.com:53è¿™ä¸ªåŸŸçš„ç›‘æ§ä¿¡æ¯ example.org è¿™ä¸ªåŸŸå› ä¸ºæ²¡æœ‰æ·»åŠ prometheusæŒ‡ä»¤ï¼Œæ‰€ä»¥åœ¨ä»»ä½•åœ°å€éƒ½ä¸ä¼šæš´éœ²ç›¸å…³çš„ç›‘æ§ä¿¡æ¯ å¦‚æœæœ‰å¤šä¸ªzoneï¼Œæ¯ä¸ªzoneéƒ½æœ‰ç›¸åŒçš„åŸºç¡€é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨importæŒ‡ä»¤ï¼Œå¦‚ï¼š 1234567891011121314151617181920212223242526272829303132333435363738tinychen.com:53 &#123; forward tinychen.com 47.107.188.168 log whoami errors prometheus 192.168.100.100:9253 bind 192.168.100.100 cache &#123; success 10240 600 60 denial 5120 60 5 &#125;&#125;google.com:53 &#123; forward google.com 8.8.8.8 9.9.9.9 log whoami errors prometheus 192.168.100.100:9253 bind 192.168.100.100 cache &#123; success 10240 600 60 denial 5120 60 5 &#125;&#125;example.org &#123; file /home/coredns/conf/example.org log whoami errors prometheus 192.168.100.100:9253 bind 192.168.100.100 cache &#123; success 10240 600 60 denial 5120 60 5 &#125;&#125; å¯ä»¥ç®€åŒ–æˆè¿™æ ·ï¼š 1234567891011121314151617181920212223242526(basesnip) &#123; log whoami errors prometheus 192.168.100.100:9253 bind 192.168.100.100 cache &#123; success 10240 600 60 denial 5120 60 5 &#125;&#125;tinychen.com:53 &#123; forward tinychen.com 47.107.188.168 import basesnip&#125;google.com:53 &#123; forward google.com 8.8.8.8 9.9.9.9 import basesnip&#125;example.org &#123; file /home/coredns/conf/example.org import basesnip&#125; 3ã€grafanaé…ç½®dashboardcorednsåŸç”Ÿæ”¯æŒçš„prometheusæŒ‡æ ‡æ•°é‡å’Œä¸°å¯Œç¨‹åº¦åœ¨ä¼—å¤šDNSç³»ç»Ÿä¸­å¯ä»¥è¯´æ˜¯é¦–å±ˆä¸€æŒ‡çš„ï¼Œæ­¤å¤–åœ¨grafanaçš„å®˜ç½‘ä¸Šä¹Ÿæœ‰ç€ä¼—å¤šç°æˆçš„dashboardå¯ç”¨ï¼Œå¹¶ä¸”ç”±äºç»å¤§å¤šæ•°æŒ‡æ ‡éƒ½æ˜¯é€šç”¨çš„ï¼Œå¤šä¸ªä¸åŒçš„dashboardä¹‹é—´çš„panelå¯ä»¥éšæ„å¤åˆ¶æ‹–æ‹½ç»„åˆæˆæ–°çš„dashboardå¹¶ä¸”ä¸ç”¨æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚é…ç½®å¯¹åº”çš„æƒå¨/é€’å½’/ç»„åˆDNSç›¸å…³çš„ç›‘æ§é¡¹ã€‚ å¦‚ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°èƒ½å¤Ÿç›‘æ§å‡ºä¸åŒDNSç±»å‹çš„è¯·æ±‚æ•°é‡ä»¥åŠä¸åŒçš„zoneå„è‡ªçš„è¯·æ±‚æ•°é‡ï¼Œè¿˜æœ‰å…¶ä»–çš„ç±»ä¼¼è¯·æ±‚å»¶è¿Ÿã€è¯·æ±‚æ€»æ•°ç­‰ç­‰å„é¡¹å‚æ•°éƒ½èƒ½å®Œå–„åœ°ç›‘æ§èµ·æ¥ã€‚ å¦‚ä¸Šå›¾æˆ‘ä»¬èƒ½çœ‹åˆ°å¯ä»¥ç›‘æ§åˆ°ä¸åŒçš„è¯·æ±‚çš„ä¼ è¾“å±‚åè®®çŠ¶æ€ï¼Œç¼“å­˜çš„å¤§å°çŠ¶æ€å’Œå‘½ä¸­æƒ…å†µç­‰å„ç§ä¿¡æ¯ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"prometheus","slug":"prometheus","permalink":"https://tinychen.com/tags/prometheus/"},{"name":"coredns","slug":"coredns","permalink":"https://tinychen.com/tags/coredns/"}]},{"title":"nginxç¯‡10-é™é€Ÿä¸‰å‰‘å®¢ä¹‹limit_req","slug":"20210616-nginx-10-triple-rate-limiting-limit-req","date":"2021-06-16T04:00:00.000Z","updated":"2021-06-16T04:00:00.000Z","comments":true,"path":"20210616-nginx-10-triple-rate-limiting-limit-req/","link":"","permalink":"https://tinychen.com/20210616-nginx-10-triple-rate-limiting-limit-req/","excerpt":"æœ¬æ–‡ä¸»è¦æ˜¯å¯¹nginxå®˜æ–¹limit_reqç›¸å…³æ¨¡å—çš„é™é€ŸåŸç†çš„è§£é‡Šå’Œä¸€äº›ä¸ªäººç†è§£ï¼Œä¸»è¦å‚è€ƒçš„æ–‡ç« ä¸ºRate Limiting with NGINX and NGINX Pluså’Œnginxçš„ngx_http_limit_req_moduleçš„è¯¦ç»†è¯´æ˜ã€‚","text":"æœ¬æ–‡ä¸»è¦æ˜¯å¯¹nginxå®˜æ–¹limit_reqç›¸å…³æ¨¡å—çš„é™é€ŸåŸç†çš„è§£é‡Šå’Œä¸€äº›ä¸ªäººç†è§£ï¼Œä¸»è¦å‚è€ƒçš„æ–‡ç« ä¸ºRate Limiting with NGINX and NGINX Pluså’Œnginxçš„ngx_http_limit_req_moduleçš„è¯¦ç»†è¯´æ˜ã€‚ ç›®å‰æ¥è¯´åœ¨nginxä¸Šé¢æˆ‘ä»¬å¸¸è§çš„ä¸‰ç§é™é€Ÿæ“ä½œåˆ†åˆ«æ˜¯ï¼šé™åˆ¶è¯·æ±‚æ•°(request)ã€é™åˆ¶è¿æ¥æ•°(connection)ã€é™åˆ¶å“åº”é€Ÿåº¦(rate)ï¼Œå¯¹åº”åœ¨nginxçš„æ¨¡å—ç›¸å…³æŒ‡ä»¤åˆ†åˆ«æ˜¯limit_reqã€limit_connå’Œlimit_rateä¸‰ä¸ªç³»åˆ—ã€‚ 1ã€å‰è¨€é™é€Ÿï¼ˆrate limitingï¼‰æ˜¯NGINXä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨ä½†æ˜¯ç»å¸¸è¢«è¯¯è§£ä¸”è¯¯ç”¨çš„åŠŸèƒ½ç‰¹æ€§ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥é™åˆ¶åœ¨ä¸€æ®µæ—¶é—´å†…çš„HTTPè¯·æ±‚çš„æ•°é‡ï¼Œè¿™äº›è¯·æ±‚å¯ä»¥æ˜¯å¦‚GETè¿™æ ·çš„ç®€å•è¯·æ±‚åˆæˆ–è€…æ˜¯ç”¨æ¥å¡«å……ç™»å½•è¡¨å•çš„POSTè¯·æ±‚ã€‚ é™é€Ÿè¿˜å¯ä»¥ç”¨äºå®‰å…¨é˜²æŠ¤ç”¨é€”ï¼Œä¾‹å¦‚é™åˆ¶å¯†ç æ’åº“æš´åŠ›ç ´è§£ç­‰æ“ä½œçš„é¢‘ç‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŠŠè¯·æ±‚é¢‘ç‡é™åˆ¶åœ¨ä¸€ä¸ªæ­£å¸¸èŒƒå›´æ¥æŠµå¾¡DDoSæ”»å‡»ã€‚ä¸è¿‡æ›´å¸¸è§çš„ä½¿ç”¨æƒ…å†µæ˜¯é€šè¿‡é™åˆ¶è¯·æ±‚çš„æ•°é‡æ¥ç¡®ä¿åç«¯çš„upstreamæœåŠ¡å™¨ä¸ä¼šåœ¨çŸ­æ—¶é—´å†…é­å—åˆ°å¤§é‡çš„æµé‡è®¿é—®ä»è€Œå¯¼è‡´æœåŠ¡å¼‚å¸¸ã€‚ æœ¬æ–‡ä¼šå°½é‡è¦†ç›–nginxä¸­é™é€Ÿï¼ˆrate limitingï¼‰çš„åŸºæœ¬æ¦‚å¿µä¹Ÿç›¸å…³çŸ¥è¯†åŒæ—¶ä¼šé¡ºå¸¦å°½å¯èƒ½å¤šçš„æä¸€ä¸‹ç›¸å…³çš„è¿›é˜¶é…ç½®æ–¹æ³•ã€‚é™é€Ÿï¼ˆrate limitingï¼‰åœ¨ä»˜è´¹ç‰ˆæœ¬çš„nginxï¼ˆNginx Plusï¼‰ä¸­ä¹Ÿæ˜¯åŒæ ·å¯ä»¥ä½¿ç”¨çš„ã€‚ NGINX Plus R16 åŠä¹‹åçš„ç‰ˆæœ¬æ”¯æŒâ€œå…¨å±€é™é€Ÿï¼ˆglobal rate limitingï¼‰â€ï¼Œå¯ä»¥åœ¨ä¸€æ•´ä¸ªnginxé›†ç¾¤ä¸­å¯¹æŸä¸ªç”¨æˆ·æˆ–è€…è¿æ¥è¿›è¡Œé™é€ŸçŠ¶æ€çš„åŒæ­¥ã€‚åŸç†åŸºæœ¬ä¸Šç±»ä¼¼äºopenresty+redisçš„å·¥ä½œæ¨¡å¼ï¼Œå°†é™é€Ÿçš„çŠ¶æ€å­˜å‚¨åˆ°ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œå½“éœ€è¦é™é€Ÿæ“ä½œçš„æ—¶å€™å°±å»é›†ç¾¤ä¸­è¯»å–ç›¸å…³å‚æ•°ï¼ŒFor details, see our blog and the NGINX Plus Admin Guide. 2ã€å·¥ä½œåŸç†nginxä¸­é™é€Ÿï¼ˆrate limitingï¼‰çš„ä¸»è¦ç®—æ³•åŸç†å°±æ˜¯åŸºäºåœ¨è®¡ç®—æœºç½‘ç»œä¸­å½“å¸¦å®½æ˜¯æœ‰é™æ—¶ååˆ†å¸¸ç”¨çš„æ¼æ¡¶ç®—æ³•ã€‚åŸºæœ¬åŸç†å°±æ˜¯ï¼šä»¥æ¼æ¡¶ä¸ºä¾‹ï¼Œæ°´ä»é¡¶éƒ¨å€’å…¥ï¼Œä»åº•ä¸‹æ¼å‡ºã€‚è¿™é‡Œçš„å‡ ä¸ªæ¦‚å¿µåˆ†åˆ«æ˜¯ï¼š æ¼æ¡¶å¯¹åº”æˆ‘ä»¬æœåŠ¡å™¨çš„å¸¦å®½æˆ–è€…æ˜¯å¤„ç†è¯·æ±‚çš„èƒ½åŠ›æˆ–è€…æ˜¯ä¸€ä¸ªé˜Ÿåˆ— æ°´è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ å€’å…¥çš„æ°´åˆ™ä»£è¡¨å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ä½†å°šæœªè¿›è¡Œå¤„ç†çš„è¯·æ±‚ï¼Œæ­¤æ—¶è¯·æ±‚ä»åœ¨é˜Ÿåˆ—ï¼ˆåœ¨æ¡¶å†…ï¼‰ æ¼å‡ºçš„æ°´åˆ™ä»£è¡¨ä»é˜Ÿåˆ—ä¸­å‡ºæ¥å³å°†å‘é€ç»™æœåŠ¡å™¨ç«¯å¤„ç†çš„è¯·æ±‚ï¼Œæ­¤æ—¶è¯·æ±‚å·²ç»ç¦»å¼€äº†é˜Ÿåˆ—ï¼ˆåœ¨æ¡¶å¤–ï¼‰ æ¼æ¡¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ä»£è¡¨æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ï¼Œè¯·æ±‚æ ¹æ®å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰è°ƒåº¦ç®—æ³•ç­‰å¾…å¤„ç†ã€‚å¦‚æœå€’å…¥æ°´çš„é€Ÿåº¦å°äºæ¼æ°´çš„é€Ÿåº¦ï¼Œå¯ä»¥ç†è§£ä¸ºæœåŠ¡å™¨èƒ½å¤Ÿå¤„ç†å®Œæ‰€æœ‰çš„è¯·æ±‚ï¼Œæ­¤æ—¶æ•´ä½“æœåŠ¡è¡¨ç°æ­£å¸¸ã€‚å¦‚æœå€’å…¥æ°´çš„é€Ÿåº¦å¤§äºæ¼æ°´çš„é€Ÿåº¦ï¼Œé‚£ä¹ˆæ°´æ¡¶å†…çš„æ°´ä¼šä¸æ–­å¢åŠ ç›´åˆ°æœ€åæº¢å‡ºï¼Œè¿™ç§æƒ…å†µä¸‹åœ¨æ°´æ¡¶ä¸­çš„æ°´å¯ä»¥ç†è§£ä¸ºåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…çš„è¯·æ±‚ï¼Œè€Œæº¢å‡ºçš„æ°´åˆ™è¡¨ç¤ºç›´æ¥è¢«ä¸¢å¼ƒä¸å¤„ç†çš„è¯·æ±‚ã€‚ 3ã€åŸºç¡€é…ç½®ä¸‹é¢è¿™é‡Œæˆ‘ä»¬åˆ—ä¸¾ä¸€ä¸ªç®€å•çš„nginxé™é€Ÿé…ç½®ï¼š 123456789limit_req_zone $binary_remote_addr zone=mylimit:10m rate=10r/s; server &#123; location /login/ &#123; limit_req zone=mylimit; proxy_pass http://my_upstream; &#125;&#125; è¿™é‡Œé¦–å…ˆä½¿ç”¨äº†limit_req_zoneæŒ‡ä»¤å®šä¹‰äº†ä¸€ä¸ªé™é€Ÿzoneï¼Œåä¸ºmylimitï¼Œå¤§å°ä¸º10MBï¼Œå¯¹åº”çš„å˜é‡æ˜¯$binary_remote_addrï¼Œé™åˆ¶çš„è¯·æ±‚é€Ÿç‡æ˜¯æ¯ç§’é™åˆ¶10ä¸ªè¯·æ±‚ï¼ˆ10requests/secendsï¼‰ï¼Œåœ¨loginè¿™ä¸ªlocationä¸­ä½¿ç”¨limit_reqæŒ‡ä»¤æŒ‡å®šäº†é™åˆ¶çš„zoneã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†è§£æä¸€ä¸‹æ•´ä¸ªé™é€Ÿçš„è¿‡ç¨‹ï¼š é¦–å…ˆæ˜¯limit_req_zoneæŒ‡ä»¤ä¸»è¦ç”¨äºå®šä¹‰é€Ÿåº¦é™åˆ¶ç›¸å…³çš„å‚æ•°ï¼Œè€Œlimit_reqæŒ‡ä»¤åˆ™æ˜¯ç”¨äºå¯ç”¨å®šä¹‰çš„é™é€Ÿå‚æ•°ï¼ˆå¦‚è¿™é‡Œæ˜¯åœ¨loginä¸­å¯ç”¨ï¼‰ limit_req_zone æŒ‡ä»¤ä¸€èˆ¬ç”¨äºhttpå—ä¸­ï¼Œä½¿å…¶å¯ä»¥åœ¨å¤šä¸ªç›¸å…³serverã€locationç­‰contextsä¸­ä½¿ç”¨ï¼Œä¸€èˆ¬æ¥è¯´å®ƒéœ€è¦å®šä¹‰ä¸‹é¢ä¸‰ä¸ªå¿…è¦å‚æ•°ï¼š Syntaxï¼šlimit_req_zone key zone=name:size rate=rate [sync]; Syntax: limit_req zone=name [burst=number] [nodelay | delay=number]; keyï¼šå®šä¹‰ç”¨äºé™åˆ¶è¯·æ±‚çš„å˜é‡ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ˜¯NGINXçš„è‡ªå¸¦å˜é‡$binary_remote_addrï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºIPåœ°å€ï¼Œå¦‚123.183.224.65è¿™ä¸ªIPåœ¨$remote_addrä¸­æ˜¾ç¤ºä¸º123.183.224.65ï¼Œåœ¨$binary_remote_addrè¡¨ç¤ºä¸º&#123;\\xB7\\xE0Aï¼Œå› æ­¤$binary_remote_addrå ç”¨çš„ç©ºé—´è¦æ¯”$remote_addræ›´å°‘ã€‚ä½¿ç”¨$binary_remote_addråˆ™æ„å‘³ç€å°†æ¯ä¸ªå”¯ä¸€çš„ç”¨æˆ·IPä½œä¸ºé™åˆ¶é€Ÿç‡çš„åˆ¤æ–­ä¾æ®ã€‚ zoneï¼šå®šä¹‰ç”¨äºå­˜å‚¨å‰é¢å®šä¹‰çš„keyå˜é‡å’Œé™åˆ¶å…¶è®¿é—®è¯·æ±‚é¢‘ç‡rateå˜é‡çš„å…±äº«å†…å­˜ç©ºé—´ï¼Œå°†ä¿¡æ¯ä¿å­˜åœ¨å…±äº«å†…å­˜ä¸­çš„å¥½å¤„æ˜¯èƒ½å¤Ÿåœ¨å¤šä¸ªworkerè¿›ç¨‹ä¸­å…±äº«ã€‚å­˜å‚¨ç©ºé—´çš„å®šä¹‰ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šzone=åé¢çš„åç§°ä»¥åŠå†’å·åé¢çš„å¤§å°ï¼Œå¦‚zone=mylimit:10m å°±æ˜¯ä¸€ä¸ªåä¸ºmylimitçš„å¤§å°ä¸º10mçš„å…±äº«å†…å­˜ç©ºé—´ã€‚ä»¥$binary_remote_addr å˜é‡ä¸ºä¾‹ï¼Œå®ƒä½¿ç”¨4 bytesæ¥å­˜å‚¨IPv4 åœ°å€æˆ–è€…æ˜¯ä½¿ç”¨16 bytesæ¥å­˜å‚¨IPv6åœ°å€ã€‚å­˜å‚¨çŠ¶æ€å§‹ç»ˆåœ¨32ä½å¹³å°ä¸Šå ç”¨64ä¸ªå­—èŠ‚ï¼Œå¹¶åœ¨64ä½å¹³å°ä¸Šå ç”¨128ä¸ªå­—èŠ‚ã€‚è€ƒè™‘åˆ°ç°åœ¨çš„æœåŠ¡å™¨ç»å¤§å¤šæ•°éƒ½æ˜¯64ä½çš„æ“ä½œç³»ç»Ÿï¼Œ1Mçš„å¤§å°å¯ä»¥ä¿ç•™å¤§çº¦8192ä¸ª128å­—èŠ‚çš„çŠ¶æ€ã€‚ å½“å­˜å‚¨ç©ºé—´è€—å°½çš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦è®°å½•æ–°çš„å€¼ï¼Œé‚£ä¹ˆå°±ä¼šé€šè¿‡LRUç®—æ³•ç§»é™¤æ—§çš„å˜é‡æ¥è…¾å‡ºç©ºé—´ï¼Œå¦‚æœè¿™æ ·è…¾å‡ºæ¥çš„ç©ºé—´è¿˜æ˜¯ä¸è¶³ä»¥æ¥çº³æ–°çš„è®°å½•å€¼ï¼Œé‚£ä¹ˆnginxå°±ä¼šè¿”å›çŠ¶æ€ç 503 (Service Temporarily Unavailable)ã€‚æ­¤å¤–ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜è€—å°½ï¼Œnginxæ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°è®°å½•å€¼çš„æ—¶å€™å°±ä¼šæ¸…ç†æ‰ä¸¤ä¸ª60ç§’å†…æ²¡è¢«ä½¿ç”¨è¿‡çš„æ—§è®°å½•å€¼ã€‚ If the zone storage is exhausted, the least recently used state is removed. If even after that a new state cannot be created, the request is terminated with an error. rateï¼šè®¾å®šå…è®¸çš„æœ€å¤§è¯·æ±‚é€Ÿç‡ã€‚ä¸Šé¢çš„ä¾‹å­æ˜¯æ¯ç§’åä¸ªè¯·æ±‚(10r/s)ã€‚nginxå®ç°çš„æ˜¯æ¯«ç§’çº§åˆ«çš„æ§åˆ¶ç²’åº¦ï¼Œ10r/så¯¹åº”çš„å°±æ˜¯1r/100msï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€åœ¨æ²¡æœ‰è®¾ç½®burstsçš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚æ¥å—å¤„ç†ä¹‹åçš„100mså†…å‡ºç°ç¬¬äºŒä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«æ‹’ç»å¤„ç†ã€‚ limit_req_zoneæŒ‡ä»¤è®¾ç½®äº†é€Ÿç‡é™åˆ¶å’Œå…±äº«å†…å­˜åŒºåŸŸçš„å‚æ•°ï¼Œä½†å®ƒå®é™…ä¸Šå¹¶ä¸é™åˆ¶è¯·æ±‚é€Ÿç‡ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡åœ¨contextsä¸­ä½¿ç”¨limit_reqæŒ‡ä»¤æ¥å°†å…¶é™åˆ¶åº”ç”¨äºç‰¹å®šlocationæˆ–serverå—ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬å°†è¯·æ±‚é€Ÿç‡é™åˆ¶åœ¨/login/è¿™ä¸ªlocationå—ä¸­ã€‚å› æ­¤ç°åœ¨æ¯ä¸ªå”¯ä¸€çš„ IP åœ°å€è¢«é™åˆ¶ä¸ºæ¯ç§’ 10 ä¸ª**/login/**è¯·æ±‚ï¼Œæˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼Œä¸èƒ½åœ¨å‰ä¸€ä¸ª URL è¯·æ±‚çš„ 100 æ¯«ç§’å†…å‘å‡ºå¯¹è¯¥ URL çš„ç¬¬äºŒæ¬¡è¯·æ±‚ã€‚ 4ã€çªå‘è¯·æ±‚å¤„ç†(Bursts)ä¸Šé¢çš„åŸºç¡€é…ç½®åªèƒ½å¤„ç†æœ€ç®€å•çš„ç†æƒ³æƒ…å†µï¼Œä½†æ˜¯å¦‚æœæœåŠ¡å™¨åœ¨100æ¯«ç§’å†…æ”¶åˆ°äº†2ä¸ªåŠä»¥ä¸Šçš„è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œnginxå°±ä¼šå‘ç¬¬1ä¸ªè¯·æ±‚ä¹‹åçš„æ‰€æœ‰å®¢æˆ·ç«¯è¿”å›503ä»£ç ã€‚è€ƒè™‘åˆ°å¹¶å‘æ˜¯ç¨‹åºçš„å¤©ç„¶å±æ€§ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯åŒä¸€æ—¶é—´å†…æ¶Œå…¥å¤§é‡çš„è¯·æ±‚ï¼Œå› æ­¤è¿™æ˜¾ç„¶å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å¤„ç†æ–¹æ¡ˆï¼Œæˆ‘ä»¬æƒ³è¦çš„åº”è¯¥æ˜¯å°½å¯èƒ½â€œå‡åŒ€å¹³æ»‘â€åœ°å¤„ç†æ‰€æœ‰çš„è¯·æ±‚è€Œä¸æ˜¯ç›´æ¥æ‹’ç»æ‰å®ƒä»¬ã€‚å› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨burstå‚æ•°è®¾ç½®çªå‘é˜ˆå€¼ï¼Œå…è®¸å¹¶å‘æƒ…å†µçš„å¤„ç†ã€‚ 1234location /login/ &#123; limit_req zone=mylimit burst=20; proxy_pass http://my_upstream;&#125; ä¸Šé¢è¿™æ®µé…ç½®ä¸­æˆ‘ä»¬è®¾ç½®äº†burst=20ï¼Œè¯¥é…ç½®å®šä¹‰äº†å®¢æˆ·ç«¯å¯ä»¥è¶…è¿‡åŒºåŸŸæŒ‡å®šé€Ÿç‡çš„è¯·æ±‚æ•°ï¼ˆå¯¹äºæˆ‘ä»¬å‰é¢å®šä¹‰çš„mylimitåŒºåŸŸï¼Œè¯·æ±‚é€Ÿç‡é™åˆ¶ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚å³æ¯ 100 æ¯«ç§’ 1 ä¸ªï¼‰ã€‚åœ¨å‰ä¸€ä¸ªè¯·æ±‚ä¹‹å 100 æ¯«ç§’å†…åˆ°è¾¾çš„è¯·æ±‚ä¼šè¢«æ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œè¿™é‡Œæˆ‘ä»¬å°†é˜Ÿåˆ—å¤§å°è®¾ç½®ä¸º 20ã€‚ ä¹Ÿå°±æ˜¯è¯´å¦‚æœæœ‰22ä¸ªè¯·æ±‚åŒæ—¶å‘é€è¿‡æ¥ï¼Œé‚£ä¹ˆNGINXä¼šé©¬ä¸ŠæŠŠç¬¬1ä¸ªè¯·æ±‚æ ¹æ®ç›¸å…³è§„åˆ™è½¬å‘ç»™upstreamæœåŠ¡å™¨ï¼Œç„¶åæŠŠæ¥ä¸‹æ¥çš„ç¬¬2åˆ°21å…±è®¡20ä¸ªè¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œæ¥ç€ç›´æ¥è¿”å›503ä»£ç ç»™ç¬¬22ä¸ªè¯·æ±‚ï¼Œéšåçš„2ç§’æ—¶é—´å†…ï¼Œæ¯100æ¯«ç§’ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªè¯·æ±‚å‘é€ç»™upstreamæœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚ 5ã€æ— å»¶è¿Ÿé˜Ÿåˆ—(Queueing with No Delay)ä¸Šé¢çš„æ–¹æ³•è™½ç„¶ä½¿å¾—è¯·æ±‚çš„æµé‡å˜å¾—â€œå‡åŒ€å¹³æ»‘â€ï¼Œä½†æ˜¯ç¡®å¾ˆå¤§ç¨‹åº¦ä¸Šå¢åŠ äº†å“åº”æ—¶é—´ï¼Œæ’åœ¨é˜Ÿåˆ—è¶Šåé¢çš„è¯·æ±‚çš„ç­‰å¾…æ—¶é—´è¶Šé•¿ï¼Œè¿™å°±å¯¼è‡´äº†å®ƒä»¬çš„å“åº”æ—¶é—´å¹³ç™½æ— æ•…åœ°å¢åŠ äº†è®¸å¤šï¼Œè¿‡é•¿çš„å“åº”æ—¶é—´ç”šè‡³å¯èƒ½ä¼šå¯¼è‡´å®¢æˆ·ç«¯è®¤ä¸ºè¯·æ±‚å¼‚å¸¸æˆ–è€…ç›´æ¥å¯¼è‡´è¯·æ±‚è¶…æ—¶ã€‚ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨brustå‚æ•°åé¢åŠ ä¸Šnodelayå‚æ•°ã€‚ 1234location /login/ &#123; limit_req zone=mylimit burst=20 nodelay; proxy_pass http://my_upstream;&#125; åŠ ä¸Šäº†nodelayå‚æ•°ä¹‹åï¼Œnginxçš„å¤„ç†æ–¹å¼å’Œä¸Šé¢åŸºæœ¬ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼šå½“nginxæ¥å—äº†ç¬¬2åˆ°21å…±è®¡20ä¸ªè¯·æ±‚ä¹‹åï¼Œä¸ä¼šæŠŠå®ƒä»¬æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯ç›´æ¥å°†å®ƒä»¬è½¬å‘ç»™upstreamæœåŠ¡å™¨ï¼ŒåŒæ—¶æ ‡è®°é˜Ÿåˆ—ä¸­çš„è¿™20ä¸ªæ’æ§½(slot)ä¸ºå·²ä½¿ç”¨ï¼Œç„¶åæŠŠå‰©ä¸‹çš„å…¨éƒ¨è¯·æ±‚éƒ½503æ‹’ç»æ‰ï¼Œæ¥ç€æ¯è¿‡100æ¯«ç§’å†é‡Šæ”¾ä¸€ä¸ªæ–°çš„slotè®©æ–°çš„è¯·æ±‚è¿›æ¥ã€‚ With the nodelay parameter, NGINX still allocates slots in the queue according to the burst parameter and imposes the configured rate limit, but not by spacing out the forwarding of queued requests. Instead, when a request arrives â€œtoo soonâ€, NGINX forwards it immediately as long as there is a slot available for it in the queue. It marks that slot as â€œtakenâ€ and does not free it for use by another request until the appropriate time has passed (in our example, after 100ms). ç°åœ¨å‡è®¾åœ¨ç¬¬ä¸€ç»„è¯·æ±‚è½¬å‘å 101 æ¯«ç§’ï¼Œå¦å¤– 20 ä¸ªè¯·æ±‚åŒæ—¶åˆ°è¾¾ã€‚é˜Ÿåˆ—ä¸­åªæœ‰ 1 ä¸ªæ’æ§½å·²è¢«é‡Šæ”¾ï¼Œå› æ­¤ NGINX è½¬å‘ 1 ä¸ªè¯·æ±‚ç»™upstreamæœåŠ¡å™¨å¹¶ä»¥ status 503 æ‹’ç»å…¶ä»– 19 ä¸ªè¯·æ±‚ã€‚å¦‚æœåœ¨ 20 ä¸ªæ–°è¯·æ±‚åˆ°è¾¾ä¹‹å‰ å·²ç»è¿‡å»äº†501æ¯«ç§’è€Œä¸æ˜¯101æ¯«ç§’ï¼Œåˆ™æœ‰ 5 ä¸ªç©ºé—²æ§½ï¼Œå› æ­¤ NGINX ç«‹å³è½¬å‘ 5 ä¸ªè¯·æ±‚upstreamæœåŠ¡å™¨å¹¶æ‹’ç»å‰©ä½™15 ä¸ªè¯·æ±‚ã€‚è¿™æ ·æœ€ç»ˆçš„æ•ˆæœç›¸å½“äºæ¯ç§’ 10 ä¸ªè¯·æ±‚çš„é€Ÿç‡é™åˆ¶ï¼Œåªä¸è¿‡æ²¡æœ‰äº†å‰é¢çš„â€œå‡åŒ€å¹³æ»‘â€çš„ç‰¹æ€§ï¼Œä½†æ˜¯å´æœ‰æ•ˆé™ä½äº†å“åº”æ—¶é—´ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ä¸é™åˆ¶æ¯ä¸ªè¯·æ±‚ä¹‹é—´çš„æ—¶é—´é—´éš”çš„æƒ…å†µä¸‹é™åˆ¶è¯·æ±‚é€Ÿç‡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨nodelayå‚æ•°ã€‚ Note: For most deployments, we recommend including the burst and nodelay parameters to the limit_req directive. 6ã€ä¸¤æ®µé™é€Ÿ(Two-Stage Rate Limiting)6.1 åŸç†è§£æç®€å•æ¥è¯´ï¼Œæ‰€è°“çš„åˆ†æ®µé™é€Ÿå°±æ˜¯å…è®¸å®¢æˆ·ç«¯åœ¨åˆšå¼€å§‹çš„æ—¶å€™æœ‰ä¸€å®šçš„çªå‘è¯·æ±‚ï¼Œåé¢å†è¿›å…¥åˆ°å¹³ç¨³çš„é™é€Ÿä¸­ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨NGINX Plus R17æˆ–è€…æ˜¯NGINX 1.15.7ä½¿ç”¨limit_req æŒ‡ä»¤å’Œdelayå‚æ•°æ¥å®ç°ä¸¤æ®µé™é€Ÿï¼Œdelayå‚æ•°å°†nginxé…ç½®ä¸ºå…è®¸çªå‘è¯·æ±‚ä»¥é€‚åº”å…¸å‹çš„ Web æµè§ˆå™¨è¯·æ±‚æ¨¡å¼ï¼Œç„¶åå°†é¢å¤–çš„è¿‡åº¦è¯·æ±‚é™åˆ¶åˆ°ä¸€å®šç¨‹åº¦ï¼Œè¶…è¿‡è¯¥ç‚¹çš„é¢å¤–è¿‡åº¦è¯·æ±‚å°†è¢«æ‹’ç»ã€‚ è¿™é‡Œæˆ‘ä»¬ä»¥5r/sçš„é™åˆ¶é€Ÿç‡ä¸ºä¾‹ï¼Œä¸€èˆ¬æ¥è¯´ç½‘ç«™é€šå¸¸æ¯ä¸ªé¡µé¢æœ‰ 4 åˆ° 6 ä¸ªèµ„æºï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šè¶…è¿‡ 12 ä¸ªèµ„æºã€‚è¯¥é…ç½®å…è®¸æœ€å¤š 12 ä¸ªè¯·æ±‚çš„çªå‘ï¼Œå…¶ä¸­å‰ 8 ä¸ªè¯·æ±‚ä¼šè¢«ç›´æ¥è½¬å‘ç»™upstreamå¤„ç†ã€‚åœ¨è¾¾åˆ°5r/sçš„è¯·æ±‚é™åˆ¶ä¹‹åï¼Œç¬¬6åˆ°ç¬¬13ä¸ªè¯·æ±‚ä¼šè¢«æ·»åŠ åˆ°å»¶è¿Ÿ(delay)ä¸­ï¼Œå†ä¹‹åçš„ä»»ä½•è¯·æ±‚éƒ½ä¼šè¢«æ‹’ç»ã€‚ 123456789limit_req_zone $binary_remote_addr zone=ip:10m rate=5r/s;server &#123; listen 80; location / &#123; limit_req zone=ip burst=12 delay=8; proxy_pass http://website; &#125;&#125; ä¸‹é¢å‡è®¾æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ä¸æ–­åœ°å‘æˆ‘ä»¬çš„é™é€ŸæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œæ ¹æ®ä¸Šé¢çš„é…ç½®ï¼Œnginxçš„å¤„ç†æƒ…å†µå¦‚ä¸‹ï¼š è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä»bursté˜Ÿåˆ—ä¸­é¦–å…ˆæœ€å¼€å§‹çš„12ä¸ªè¯·æ±‚å¯ä»¥æŒ‰ç…§é…ç½®åˆ†ä¸º8+5 å³æœ€å‰é¢çš„8ä¸ªè¯·æ±‚ä¼šè¢«ç›´æ¥å‘é€ç»™upstreamå¤„ç†ï¼Œä¹Ÿå°±æ˜¯åœ¨bursté˜Ÿåˆ—ä¸­çš„no delayéƒ¨åˆ†ï¼Œè¿™é‡Œçš„8ä¸ªå’Œé…ç½®ä¸­çš„å‚æ•°delay=8å»åˆ éšåçš„5ä¸ªè¯·æ±‚ä¹Ÿä¼šè¢«åŠ å…¥åˆ°bursté˜Ÿåˆ—ä¸­ï¼Œè¿™é‡Œçš„å¤„ç†è§„åˆ™å°±ä¸æ˜¯æŒ‰ç…§å‰é¢çš„no delayéƒ¨åˆ†çš„è§„åˆ™æ¥å¤„ç†ï¼Œè€Œæ˜¯å…ˆæŒ‰ç…§è®¾å®šçš„rate=5r/sæ¥è¿›è¡Œå¤„ç†ï¼Œæ¥ç€åŒæ ·æ˜¯è¿™ä¸€ç§’å†…çš„å…¶ä»–è¯·æ±‚éƒ½ä¼šè¢«è¿”å›503ä»£ç æ‹’ç»æ‰ å†è¿›å…¥ä¸‹ä¸€ç§’çš„æ—¶é—´ï¼Œè¿™é‡Œçš„è¯·æ±‚å°±å’Œä¹‹å‰è®¾å®šçš„ä¸€æ ·ï¼Œå…¨éƒ¨æŒ‰ç…§rate=5r/sæ¥è¿›è¡Œå¤„ç†ï¼ŒåŒæ ·æ˜¯è¿™ä¸€ç§’å†…çš„å…¶ä»–è¯·æ±‚éƒ½ä¼šè¢«è¿”å›503ä»£ç æ‹’ç»æ‰ 6.2 å®æµ‹è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨jmeteræ¥è¿›è¡Œå®æµ‹æŸ¥çœ‹ä¸åŒçš„é…ç½®å¯¹åº”çš„æ•ˆæœï¼Œè¿™é‡Œæˆ‘ä»¬å°è¯•5ç§’å†…å‘é€100æ¬¡è¯·æ±‚ï¼Œç„¶åæŸ¥çœ‹æµ‹è¯•ç»“æœï¼Œç”±äºnginxçš„æ—¥å¿—å†™å…¥æœ‰å»¶è¿Ÿï¼Œå’Œè¿™é‡Œçš„ç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«çš„æµ‹è¯•ä¼šæœ‰è¯¯å·®ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ç§’ä¸ºå•ä½æ¥æŸ¥çœ‹æ—¥å¿—ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:45 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:46 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:47 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:48 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:49 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:50 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:50 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:50 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:50 +0800] | 503 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:50 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:50 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:50 +0800] | 200 | test.tiny777.com1.1.1.1 | [16/Jun/2021:15:24:50 +0800] | 200 | test.tiny777.com è¿™é‡Œçš„æ•ˆæœå°±éå¸¸æ˜æ˜¾äº†ï¼Œç”±äº15:24:45å†…åˆšå¥½åªæœ‰12ä¸ªè¯·æ±‚ï¼Œå› æ­¤å…¨éƒ¨éƒ½èƒ½å¤Ÿæ­£å¸¸å¤„ç†ï¼Œè€Œä¹‹åçš„æ¯ä¸€ç§’çš„è¯·æ±‚å¤„ç†éƒ½è¶…è¿‡5ä¸ªï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬é™å®šäº†rate=5r/sï¼Œå› æ­¤æ¯ç§’åªæœ‰5ä¸ªæˆåŠŸçš„è¯·æ±‚ï¼Œå…¶ä½™å‡è¢«503.","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"nginxç¯‡09-locationä¸­çš„ifæŒ‡ä»¤æ˜¯é­”é¬¼å§","slug":"20210527-nginx-09-if-is-evil-in-location","date":"2021-05-27T04:00:00.000Z","updated":"2021-05-27T04:00:00.000Z","comments":true,"path":"20210527-nginx-09-if-is-evil-in-location/","link":"","permalink":"https://tinychen.com/20210527-nginx-09-if-is-evil-in-location/","excerpt":"æœ¬æ–‡ä¸»è¦æ˜¯å¯¹nginxå®˜æ–¹çš„æ–‡ç« If is Evil... when used in location contextçš„ç¿»è¯‘å’Œç†è§£ã€‚","text":"æœ¬æ–‡ä¸»è¦æ˜¯å¯¹nginxå®˜æ–¹çš„æ–‡ç« If is Evil... when used in location contextçš„ç¿»è¯‘å’Œç†è§£ã€‚ 1ã€ç®€ä»‹åœ¨locationå—ä¸­çš„ifæŒ‡ä»¤çš„æœ‰ç‚¹é—®é¢˜ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒifæŒ‡ä»¤å¹¶ä¸ä¼šæŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„é‚£èˆ¬å·¥ä½œï¼Œè€Œæ˜¯æœ‰å¯èƒ½å¾€å®Œå…¨ä¸åŒçš„æ–¹å‘å‘å±•ç”šè‡³å¯èƒ½ä¼šå¼•èµ·é”™è¯¯ã€‚å› æ­¤æœ€å¥½çš„æ–¹æ³•å°±æ˜¯å°½å¯èƒ½çš„ä¸è¦ä½¿ç”¨ifæŒ‡ä»¤ã€‚ åœ¨locationå—çš„ifæŒ‡ä»¤å†…100%å®‰å…¨çš„æŒ‡ä»¤æœ‰ï¼š return rewrite â€¦â€¦ last é™¤äº†ä¸Šé¢çš„ä¸¤ä¸ªæŒ‡ä»¤ä¹‹å¤–çš„ä»»ä½•æ“ä½œéƒ½æœ‰å¯èƒ½å¯¼è‡´ä¸å¯é¢„æµ‹çš„æ•ˆæœç”šè‡³å¯èƒ½æ˜¯SIGSEGVé”™è¯¯ï¼ˆå¯èƒ½å‡ºç°å†…å­˜é”™è¯¯å¯¼è‡´ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼‰ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šifæŒ‡ä»¤çš„æ‰§è¡Œç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç›¸åŒçš„ä¸¤ä¸ªè¯·æ±‚æ“ä½œï¼Œä¸å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªæˆåŠŸä½†æ˜¯å¦ä¸€ä¸ªå¤±è´¥çš„æƒ…å†µã€‚è¿™å°±æ„å‘³ç€åªè¦ç»è¿‡è¶³å¤Ÿåˆé€‚çš„æµ‹è¯•ä»¥åŠæˆ‘ä»¬å¯¹ç›¸åº”æ“ä½œçš„è¶³å¤Ÿäº†è§£ï¼ŒifæŒ‡ä»¤æ˜¯â€œå¯ä»¥â€è¢«ä½¿ç”¨çš„ã€‚è¿™ä¸ªå»ºè®®å¯¹äºå…¶ä»–çš„æŒ‡ä»¤ä¹Ÿæ˜¯åŒæ ·é€‚ç”¨çš„ã€‚ å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬æ˜¯æ²¡åŠæ³•é¿å…ä½¿ç”¨ifæŒ‡ä»¤çš„ï¼Œä¾‹å¦‚å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦ç­‰äºæŸä¸ªå€¼æˆ–è€…åŒ…å«æŸä¸ªå­—æ®µçš„æ—¶å€™ï¼Œå°±ä¼šéœ€è¦ç”¨åˆ°ifæŒ‡ä»¤ï¼š 123456if ($request_method = POST ) &#123; return 405;&#125;if ($args ~ post=140)&#123; rewrite ^ http://example.com/ permanent;&#125; 2ã€æ›¿ä»£æ–¹æ¡ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ try_files æŒ‡ä»¤ã€â€œreturn â€¦â€æŒ‡ä»¤æˆ–è€…â€œrewrite â€¦ lastâ€æŒ‡ä»¤ç”¨æ¥æ›¿ä»£ifæŒ‡ä»¤ã€‚åœ¨æŸäº›æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥æŠŠifæŒ‡ä»¤ç§»åŠ¨åˆ°serverå—çš„å±‚çº§ï¼Œæ­¤æ—¶çš„ifæŒ‡ä»¤æ˜¯å¯ä»¥å®‰å…¨ä½¿ç”¨çš„ï¼Œå› ä¸ºè¿™é‡Œåªæœ‰å…¶ä»–çš„rewriteæ¨¡å—æŒ‡ä»¤èƒ½è¢«ä½¿ç”¨ï¼ˆåŸå› ä¸‹æ–‡ä¼šè§£é‡Šï¼‰ã€‚ å½“ç„¶å¯¹äºä¸€äº›éœ€è¦ä½¿ç”¨ifæŒ‡ä»¤æ¥åˆ¤æ–­è¿”å›4xxå’Œ5xxä¹‹ç±»çš„å¼‚å¸¸ä»£ç å“åº”é¡µé¢æˆ–è€…æ˜¯æ“ä½œä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨returnæŒ‡ä»¤æ­é…error_pageæŒ‡ä»¤æ¥ä¿è¯å®‰å…¨ï¼Œä¾‹å¦‚ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ï¼š 12345678910111213141516location / &#123; error_page 418 = @other; recursive_error_pages on; if ($something) &#123; return 418; &#125; # some configuration ...&#125;location @other &#123; # some other configuration ...&#125; æ­¤å¤–ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä½¿ç”¨ä¸€äº›åµŒå…¥çš„è„šæœ¬æ¨¡å—ï¼ˆå¦‚luaï¼Œembedded perl, æˆ–è€…æ˜¯å…¶ä»–çš„ngxç¬¬ä¸‰æ–¹æ¨¡å—ï¼‰æ¥å®Œæˆä¸€äº›è¾ƒè´Ÿè´£çš„é€»è¾‘æ“ä½œå’Œåˆ¤æ–­ä¹Ÿä¸å¤±ä¸ºä¸€ä¸ªå¥½ä¸»æ„ã€‚ 3ã€å·²çŸ¥é”™è¯¯ä¸‹é¢åˆ—ä¸¾äº†ä¸€äº›ifæŒ‡ä»¤ä¸æŒ‰ç…§é¢„æœŸå·¥ä½œçš„çš„æƒ…å†µï¼Œè¯·æ³¨æ„ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šé…ç½®è¿™äº›æŒ‡ä»¤ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273# Here is collection of unexpectedly buggy configurations to show that# if inside location is evil.# only second header will be present in response# not really bug, just how it workslocation /only-one-if &#123; set $true 1; if ($true) &#123; add_header X-First 1; &#125; if ($true) &#123; add_header X-Second 2; &#125; return 204;&#125;# request will be sent to backend without uri changed# to &#x27;/&#x27; due to iflocation /proxy-pass-uri &#123; proxy_pass http://127.0.0.1:8080/; set $true 1; if ($true) &#123; # nothing &#125;&#125;# try_files wont work due to iflocation /if-try-files &#123; try_files /file @fallback; set $true 1; if ($true) &#123; # nothing &#125;&#125;# nginx will SIGSEGVlocation /crash &#123; set $true 1; if ($true) &#123; # fastcgi_pass here fastcgi_pass 127.0.0.1:9000; &#125; if ($true) &#123; # no handler here &#125;&#125;# alias with captures isn&#x27;t correcly inherited into implicit nested# location created by iflocation ~* ^/if-and-alias/(?&lt;file&gt;.*) &#123; alias /tmp/$file; set $true 1; if ($true) &#123; # nothing &#125;&#125; å¦‚æœå‘ç°äº†ä¸Šé¢æ²¡æœ‰åˆ—å‡ºå‡ºæ¥çš„æƒ…å†µï¼Œå¯ä»¥é‚®ä»¶åˆ°NGINX development mailing list. 4ã€åŸå› åˆ†æifæŒ‡ä»¤æœ¬è´¨ä¸Šå…¶å®æ˜¯rewriteæ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œrewriteæ¨¡å—æœ¬èº«è®¾è®¡å°±æ˜¯ç”¨æ¥â€œå‘½ä»¤å¼â€åœ°æ‰§è¡Œæ“ä½œï¼ˆè¿™å°±æ˜¯å‰é¢è¯´çš„ä¸ºä»€ä¹ˆifé‡Œé¢æ­é…returnå’ŒrewriteæŒ‡ä»¤ä¼š100%å®‰å…¨çš„åŸå› ï¼‰ã€‚å¦ä¸€æ–¹é¢ã€‚nginxçš„é…ç½®é€šå¸¸æ¥è¯´æ˜¯å£°æ˜å¼çš„ï¼Œä½†æ˜¯å‡ºäºæŸäº›åŸå› ï¼Œç”¨æˆ·éœ€è¦åœ¨ifä¸­æ·»åŠ æŸäº›éé‡å†™(non-rewrite)çš„æŒ‡ä»¤ï¼ˆä¾‹å¦‚ä½¿ç”¨ifåˆ¤æ–­http_originä¹‹ç±»çš„å‚æ•°ç„¶åæ·»åŠ headerï¼‰ï¼Œå°±æœ‰å¯èƒ½å‡ºç°æˆ‘ä»¬å‰é¢è¯´çš„ä¸æ­£å¸¸å·¥ä½œçš„æƒ…å†µï¼Œå°½ç®¡å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯èƒ½å¤Ÿæ­£å¸¸å·¥ä½œçš„â€¦â€¦ ç›®å‰çœ‹æ¥å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å®Œå…¨ç¦ç”¨æ‰ifä¸­çš„æ‰€æœ‰éé‡å†™æŒ‡ä»¤ï¼ˆnon-rewrite directivesï¼‰ï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´å¾ˆå¤šå·²æœ‰çš„é…ç½®æ— æ³•æ­£å¸¸å·¥ä½œï¼ˆä¼šæå¤§åœ°å½±å“å‰å‘å…¼å®¹æ€§ï¼‰ï¼Œå› æ­¤ä¸€ç›´æ²¡æœ‰å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚ 5ã€å¦‚ä»ä½¿ç”¨å¦‚æœè¿˜æ˜¯éœ€è¦åœ¨locationä¸­ä½¿ç”¨ifæŒ‡ä»¤ï¼Œè¯·åŠ¡å¿…æ³¨æ„ï¼š æ˜ç¡®ifçš„å·¥ä½œåŸç†å’Œæµç¨‹ äº‹å…ˆè¿›è¡Œè¶³å¤Ÿçš„æµ‹è¯•ä»¥ç¡®ä¿èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ You were warned.","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"bindç¯‡01-Bind+Keepalivedå®‰è£…é«˜å¯ç”¨DNSé›†ç¾¤","slug":"20210520-dns-05-bind9-keepalived-ha-installation","date":"2021-05-20T09:00:00.000Z","updated":"2021-05-20T09:00:00.000Z","comments":true,"path":"20210520-dns-05-bind9-keepalived-ha-installation/","link":"","permalink":"https://tinychen.com/20210520-dns-05-bind9-keepalived-ha-installation/","excerpt":"æœ¬æ–‡ä¸»è¦å¯¹bindè¿›è¡Œå®‰è£…é…ç½®ï¼Œå¹¶ä¸”æ­é…keepalivedå®ç°é«˜å¯ç”¨ã€‚","text":"æœ¬æ–‡ä¸»è¦å¯¹bindè¿›è¡Œå®‰è£…é…ç½®ï¼Œå¹¶ä¸”æ­é…keepalivedå®ç°é«˜å¯ç”¨ã€‚ 1ã€ç³»ç»Ÿç¯å¢ƒå‡†å¤‡è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯centos7çš„æ“ä½œç³»ç»Ÿï¼Œé»˜è®¤ä½¿ç”¨yumå®‰è£…çš„æƒ…å†µä¸‹ï¼Œbindçš„ç¨‹åºnamedä¼šå®‰è£…åˆ°/var/namedç›®å½•ä¸‹ï¼Œæ³¨æ„ä¿è¯åˆ†åŒºçš„å¤§å°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨chrootåŒ…æ¥ä¿®æ”¹ç›®å½•ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤ç›®å½• 123456[root@tiny-cloud /root]# lsb_release -aLSB Version: :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarchDistributor ID: CentOSDescription: CentOS Linux release 7.9.2009 (Core)Release: 7.9.2009Codename: Core 2ã€bindå®‰è£…bindçš„å®‰è£…éå¸¸ç®€å•ï¼Œé»˜è®¤çš„centosç³»ç»Ÿçš„yumæºä¸­å°±åŒ…å«äº†å…¶å®‰è£…åŒ…ï¼Œä¸åŒçš„ç³»ç»Ÿç‰ˆæœ¬å¯¹åº”çš„bindç‰ˆæœ¬ç•¥æœ‰å·®å¼‚ä½†æ˜¯ä¸å¤§ã€‚ 123456789[root@tiny-server ~]# yum list | egrep ^bind.x86_64bind.x86_64 32:9.11.20-5.el8_3.1 appstream[root@tiny-server ~]# cat /etc/redhat-releaseCentOS Linux release 8.3.2011[root@tiny-cloud ~]# yum list | egrep ^bind.x86_64bind.x86_64 32:9.11.4-26.P2.el7_9.5 updates[root@tiny-cloud ~]# cat /etc/redhat-releaseCentOS Linux release 7.9.2009 (Core) ä¸€èˆ¬æˆ‘ä»¬åªéœ€è¦å®‰è£…bindå’Œbind-utilsè¿™ä¸¤ä¸ªåŒ…ï¼Œå‰è€…æ˜¯bindçš„ä¸»è¦ç¨‹åºnamedå’Œæ§åˆ¶å·¥å…·rndcç­‰ï¼Œåè€…åˆ™æ˜¯ä¸€äº›å¸¸ç”¨å·¥å…·å¦‚digå‘½ä»¤ç­‰ã€‚ 1[root@tiny-cloud /home/named]# yum install bind bind-utils å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬å°±ä¼šå‘ç°ç³»ç»Ÿä¸»è¦æ–°å¢äº†/var/namedã€/etc/namedå’Œ/etc/named*ä¸€ç³»åˆ—æ–‡ä»¶ 1234567891011121314151617[root@tiny-cloud /home/named]# ll /var/named/total 28Kdrwxrwx--- 2 named named 4.0K Apr 29 22:05 datadrwxrwx--- 2 named named 4.0K Apr 29 22:05 dynamic-rw-r----- 1 root named 2.3K Apr 5 2018 named.ca-rw-r----- 1 root named 152 Dec 15 2009 named.empty-rw-r----- 1 root named 152 Jun 21 2007 named.localhost-rw-r----- 1 root named 168 Dec 15 2009 named.loopbackdrwxrwx--- 2 named named 4.0K Apr 29 22:05 slaves[root@tiny-cloud /home/named]# ll /etc/named*-rw-r----- 1 root named 1.8K Apr 29 22:06 /etc/named.conf-rw-r--r-- 1 root named 3.9K Apr 29 22:06 /etc/named.iscdlv.key-rw-r----- 1 root named 931 Jun 21 2007 /etc/named.rfc1912.zones-rw-r--r-- 1 root named 1.9K Apr 13 2017 /etc/named.root.key/etc/named:total 0 åŒæ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨systemdæ¥å¯¹namedæœåŠ¡è¿›è¡Œç®¡ç†ï¼š 1234567891011121314151617181920212223[root@tiny-cloud /home/named]# systemctl enable named.serviceCreated symlink from /etc/systemd/system/multi-user.target.wants/named.service to /usr/lib/systemd/system/named.service.[root@tiny-cloud /home/named]# systemctl start named.service[root@tiny-cloud /home/named]# systemctl status named.serviceâ— named.service - Berkeley Internet Name Domain (DNS) Loaded: loaded (/usr/lib/systemd/system/named.service; enabled; vendor preset: disabled) Active: active (running) since Thu 2021-05-20 16:26:36 CST; 10min ago Main PID: 28777 (named) Tasks: 4 Memory: 58.6M CGroup: /system.slice/named.service â””â”€28777 /usr/sbin/named -u named -c /etc/named.confMay 20 16:31:49 tiny-cloud named[28777]: validating net/SOA: got insecure response; parent indicates it should be secureMay 20 16:31:49 tiny-cloud named[28777]: no valid RRSIG resolving &#x27;edgekey.net/DS/IN&#x27;: 192.12.94.30#53May 20 16:31:49 tiny-cloud named[28777]: validating net/SOA: got insecure response; parent indicates it should be secureMay 20 16:31:49 tiny-cloud named[28777]: no valid RRSIG resolving &#x27;edgekey.net/DS/IN&#x27;: 192.31.80.30#53May 20 16:31:49 tiny-cloud named[28777]: validating net/DNSKEY: got insecure response; parent indicates it should be secureMay 20 16:31:49 tiny-cloud named[28777]: insecurity proof failed resolving &#x27;net/DNSKEY/IN&#x27;: 192.12.94.30#53May 20 16:31:50 tiny-cloud named[28777]: validating net/DNSKEY: got insecure response; parent indicates it should be secureMay 20 16:31:50 tiny-cloud named[28777]: insecurity proof failed resolving &#x27;net/DNSKEY/IN&#x27;: 192.31.80.30#53May 20 16:31:51 tiny-cloud named[28777]: validating net/SOA: got insecure response; parent indicates it should be secureMay 20 16:31:51 tiny-cloud named[28777]: no valid RRSIG resolving &#x27;akamaiedge.net/DS/IN&#x27;: 192.31.80.30#53 3ã€bindé…ç½®3.1 IPv6ç›¸å…³é…ç½®æ— è®ºæ˜¯centos7è¿˜æ˜¯centos8ç³»ç»Ÿä½¿ç”¨yumè¿›è¡Œå®‰è£…çš„bindéƒ½å·²ç»é»˜è®¤å¼€å¯äº†IPv6çš„æ”¯æŒï¼Œå¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿæš‚æ—¶è¿˜ä¸æ”¯æŒIPv6ç½‘ç»œï¼Œåˆ™æœ€å¥½æŠŠé…ç½®æ–‡ä»¶ä¸­çš„IPv6ç›¸å…³çš„é…ç½®å»é™¤ 1sed -i &#x27;s#listen-on-v6 port 53 &#123; ::1; &#125;;#//listen-on-v6 port 53 &#123; ::1; &#125;;#g&#x27; /etc/named.conf åŒæ—¶å¦‚æœæ˜¯æŠŠbindå½“ä½œé€’å½’æŸ¥è¯¢æœåŠ¡å™¨ä½¿ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹çš„bindæ˜¯ä¼šè‡ªåŠ¨å¯ç”¨äº†hintç±»å‹çš„è§£æ 1234zone &quot;.&quot; IN &#123; type hint; file &quot;named.ca&quot;;&#125;; è¯¥é…ç½®ä¼šæŠŠæ‰€æœ‰åŒ¹é…åˆ°è¿™ä¸ªzoneçš„DNSæŸ¥è¯¢è¯·æ±‚è½¬å‘åˆ°/var/named/named.caæ–‡ä»¶ä¸­çš„13ä¸ªæ ¹DNSæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œä¸ºäº†å‡å°‘ä¸å¿…è¦çš„å¹²æ‰°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ–‡ä»¶ä¸­çš„çš„AAAAè®°å½•æ³¨é‡Šæ‰ã€‚ 123456789101112131415161718192021222324252627;; ADDITIONAL SECTION:a.root-servers.net. 518400 IN A 198.41.0.4b.root-servers.net. 518400 IN A 199.9.14.201c.root-servers.net. 518400 IN A 192.33.4.12d.root-servers.net. 518400 IN A 199.7.91.13e.root-servers.net. 518400 IN A 192.203.230.10f.root-servers.net. 518400 IN A 192.5.5.241g.root-servers.net. 518400 IN A 192.112.36.4h.root-servers.net. 518400 IN A 198.97.190.53i.root-servers.net. 518400 IN A 192.36.148.17j.root-servers.net. 518400 IN A 192.58.128.30k.root-servers.net. 518400 IN A 193.0.14.129l.root-servers.net. 518400 IN A 199.7.83.42m.root-servers.net. 518400 IN A 202.12.27.33a.root-servers.net. 518400 IN AAAA 2001:503:ba3e::2:30b.root-servers.net. 518400 IN AAAA 2001:500:200::bc.root-servers.net. 518400 IN AAAA 2001:500:2::cd.root-servers.net. 518400 IN AAAA 2001:500:2d::de.root-servers.net. 518400 IN AAAA 2001:500:a8::ef.root-servers.net. 518400 IN AAAA 2001:500:2f::fg.root-servers.net. 518400 IN AAAA 2001:500:12::d0dh.root-servers.net. 518400 IN AAAA 2001:500:1::53i.root-servers.net. 518400 IN AAAA 2001:7fe::53j.root-servers.net. 518400 IN AAAA 2001:503:c27::2:30k.root-servers.net. 518400 IN AAAA 2001:7fd::1l.root-servers.net. 518400 IN AAAA 2001:500:9f::42m.root-servers.net. 518400 IN AAAA 2001:dc3::35 3.2 named.confé…ç½®rndcrndcå¯ä»¥ç®€å•è§†ä¸ºæ˜¯ä¸€ä¸ªç”¨æ¥æ§åˆ¶æˆ–è€…æŸ¥çœ‹namedç³»ç»Ÿçš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒä¸ä»…å¯ä»¥åœ¨æœåŠ¡å™¨æœ¬åœ°ä½¿ç”¨ï¼Œè¿˜å¯ä»¥è¿œç¨‹æ§åˆ¶å…¶ä»–çš„bindæœåŠ¡å™¨ä¸Šé¢çš„namedæœåŠ¡ã€‚ä½†æ˜¯åœ¨é»˜è®¤æƒ…å†µä¸‹çš„é…ç½®æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œæ˜¾ç¤ºé…ç½®ï¼Œæ‰€ä»¥namedç¨‹åºé»˜è®¤æƒ…å†µä¸‹åªä¼šç›‘å¬æœ¬æœº127.0.0.1çš„953ç«¯å£ 1234[root@tiny-cloud /home/named]# netstat -ntulp | grep namedtcp 0 0 127.0.0.1:953 0.0.0.0:* LISTEN 12737/namedtcp 0 0 127.0.0.1:53 0.0.0.0:* LISTEN 12737/namedudp 0 0 127.0.0.1:53 0.0.0.0:* 12737/named åœ¨named.confæ–‡ä»¶ä¸­å¯¹rndcè¿›è¡Œé…ç½®ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸‰ä¸ªé€‰é¡¹ï¼š**ç›‘å¬ç½‘å¡ï¼ˆinetï¼‰ã€å…è®¸IPï¼ˆallowï¼‰å’Œè®¤è¯ä½¿ç”¨çš„keys**ï¼š è¿™æ ·å­å°±æ˜¯è®¾ä¸ºç›‘å¬æœºå™¨ä¸Šçš„æ‰€æœ‰ç½‘å¡å¹¶å…è®¸æ‰€æœ‰çš„æ¥æºIPè¿›è¡Œè®¿é—®ï¼Œä¸è¿‡é™åˆ¶äº†éœ€è¦ä½¿ç”¨keys 1234# è¿™æ ·å­å°±æ˜¯è®¾ä¸ºç›‘å¬æœºå™¨ä¸Šçš„æ‰€æœ‰ç½‘å¡å¹¶å…è®¸æ‰€æœ‰çš„æ¥æºIPè¿›è¡Œè®¿é—®ï¼Œä¸è¿‡é™åˆ¶äº†éœ€è¦ä½¿ç”¨keyscontrols &#123; inet * allow &#123; any; &#125; keys &#123; &quot;rndc-key&quot;; &#125;;&#125;; è¿™ç§é™åˆ¶äº†åªèƒ½åœ¨æœ¬æœºä¸Šä½¿ç”¨rndc 1234# è¿™ç§é™åˆ¶äº†åªèƒ½åœ¨æœ¬æœºä¸Šä½¿ç”¨rndc controls &#123; inet 127.0.0.1 allow &#123; localhost; &#125; keys &#123; &quot;rndc-key&quot;; &#125;;&#125;; è¿™ç§é™åˆ¶äº†åœ¨å±€åŸŸç½‘å’Œæœ¬æœºä¸Šä½¿ç”¨rndcï¼Œå¦‚æœæœ‰å¤šä¸ªinetéœ€è¦æŒ‡å®šç›‘å¬åˆ™éœ€è¦åˆ†å¼€å¤šæ¡é…ç½®ï¼Œå¹¶ä¸”å¯ä»¥æ·»åŠ portå‚æ•°æ¥æŒ‡å®šç«¯å£ 12345# è¿™ç§é™åˆ¶äº†åœ¨å±€åŸŸç½‘å’Œæœ¬æœºä¸Šä½¿ç”¨rndcï¼Œå¦‚æœæœ‰å¤šä¸ªinetéœ€è¦æŒ‡å®šç›‘å¬åˆ™éœ€è¦åˆ†å¼€å¤šæ¡é…ç½® controls &#123; inet 127.0.0.1 allow &#123; localhost; &#125; keys &#123; rndckey; &#125;; inet 192.168.1.1 port 1953 allow &#123; 192.168.1.1; 192.168.1.2; 192.168.1.0/24;&#125; keys &#123; rndckey; &#125;;&#125;; 3.3 rndc-keyé…ç½®keysåœ¨è¿™é‡Œçš„ä½œç”¨ä¸»è¦æ˜¯é‰´æƒï¼Œæ•ˆæœç›¸å½“äºsshç¨‹åºä¸­çš„ssh-keyï¼Œå› æ­¤å¦‚æœéœ€è¦è¿œç¨‹æ“ä½œï¼Œéœ€è¦ä¿è¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„keysä¸€è‡´ã€‚ rndc-keyåªæ˜¯keysè¿™ä¸ªå‚æ•°çš„ä¸€ä¸ªå€¼ï¼Œç›¸å½“äºä¸€ä¸ªkey-valueï¼Œè¿™é‡Œåªæ˜¯ç”¨æ¥æŒ‡ä»£ï¼Œå®é™…ä¸Šæ¢æˆtinycehn-keyä¹‹ç±»çš„å…¶ä»–åå­—ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ï¼Œæœ¬è´¨ä¸Šå®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªHMAC-MD5çš„keyï¼Œå› æ­¤é¦–å…ˆæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªrndc-keyã€‚åœ¨bind9é‡Œé¢ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨dnssec-keygenå‘½ä»¤ç”Ÿæˆæˆ–è€…æ˜¯rndc-confgen -aå‘½ä»¤ç›´æ¥ç”Ÿæˆã€‚è¿™é‡Œä¸ªäººæ¨èç›´æ¥ä½¿ç”¨åè€…ã€‚ 1234567[root@tiny-cloud /home/named]# rndc-confgen -awrote key file &quot;/etc/rndc.key&quot;[root@tiny-cloud /home/named]# cat /etc/rndc.keykey &quot;rndc-key&quot; &#123; algorithm hmac-md5; secret &quot;0JqEwIF4kihHEcAbgC4t1w==&quot;;&#125;; ä½¿ç”¨dnssec-keygenå‘½ä»¤çš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªkeyå’Œä¸€ä¸ªprivateæ–‡ä»¶ï¼Œprivateæ–‡ä»¶é‡Œé¢è®°å½•ç€è¯¦ç»†ä¿¡æ¯ï¼ŒåŒæ—¶è¿™æ ·æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†æ ¼å¼ä¿®æ”¹ä¸ºrndcæ”¯æŒçš„æ ¼å¼å¹¶æ”¾ç½®åœ¨/etc/rndc.keyæ–‡ä»¶ä¸­ã€‚ 12345678910111213141516[root@tiny-cloud /home/named]# dnssec-keygen -a hmac-md5 -b 256 -n HOST tinychen-keyKtinychen-key.+157+42293[root@tiny-cloud /home/named]# lltotal 8-rw------- 1 root root 76 May 20 15:37 Ktinychen-key.+157+42293.key-rw------- 1 root root 185 May 20 15:37 Ktinychen-key.+157+42293.private[root@tiny-cloud /home/named]# cat Ktinychen-key.+157+42293.keytinychen-key. IN KEY 512 3 157 uEICksjZ53OlSXPpHrAmS1s/FhRy5g26+KUCtGqmflM=[root@tiny-cloud /home/named]# cat Ktinychen-key.+157+42293.privatePrivate-key-format: v1.3Algorithm: 157 (HMAC_MD5)Key: uEICksjZ53OlSXPpHrAmS1s/FhRy5g26+KUCtGqmflM=Bits: AAA=Created: 20210520073748Publish: 20210520073748Activate: 20210520073748 In this case, the is a HMAC-MD5 key. You can generate your own HMAC-MD5 keys with the following command: dnssec-keygen -a hmac-md5 -b -n HOST A key with at least a 256-bit length is good idea. The actual key that should be placed in the area can found in the . The name of the key used in /etc/named.conf should be something other than key. 3.4 rndc.confé…ç½®é»˜è®¤æƒ…å†µä¸‹å¹¶ä¸ä¼šç”Ÿæˆrndc.confæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±æ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªã€‚ä½¿ç”¨rndc-confgenå‘½ä»¤å¯ä»¥å¿«é€Ÿåœ°ç”Ÿæˆä¸€ä¸ªé…ç½®æ¨¡æ¿å¹¶ä¸”æ‰“å°åˆ°ç»ˆç«¯çª—å£ä¸Šï¼ˆæ³¨æ„æ‰§è¡Œå‘½ä»¤ä¹‹åå¹¶ä¸ä¼šç”Ÿæˆrndc.confæ–‡ä»¶ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å°†ç”Ÿæˆçš„é…ç½®å†™å…¥æ–‡ä»¶/etc/rndc.confï¼‰ 123456789101112131415161718192021222324252627[root@tiny-cloud /home/named]# rndc-confgen# Start of rndc.confkey &quot;rndc-key&quot; &#123; algorithm hmac-md5; secret &quot;h0Pmn9ueo1Uk9Cv6cpPE2w==&quot;;&#125;;options &#123; default-key &quot;rndc-key&quot;; default-server 127.0.0.1; default-port 953;&#125;;# End of rndc.conf# Use with the following in named.conf, adjusting the allow list as needed:# key &quot;rndc-key&quot; &#123;# algorithm hmac-md5;# secret &quot;h0Pmn9ueo1Uk9Cv6cpPE2w==&quot;;# &#125;;## controls &#123;# inet 127.0.0.1 port 953# allow &#123; 127.0.0.1; &#125; keys &#123; &quot;rndc-key&quot;; &#125;;# &#125;;# End of named.conf éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“åŒæ—¶å­˜åœ¨rndc.confæ–‡ä»¶å’Œrndc.keyæ–‡ä»¶çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯ä¼˜å…ˆè¯»å–rndc.confï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸åŒçš„keyæ¥è®¿é—®ä¸åŒçš„serverï¼Œå¯ä»¥åœ¨å‘½ä»¤ä¸­æŒ‡å®šå‚æ•°ï¼Œå¦‚ï¼š 12345678910111213141516171819202122[root@tiny-cloud /home/named]# cat /etc/rndc.confkey &quot;rndc-key&quot; &#123; algorithm hmac-md5; secret &quot;h0Pmn9ueo1Uk9Cv6cpPE2w==&quot;;&#125;;key &quot;rndc-conf-key&quot; &#123; algorithm hmac-md5; secret &quot;uEICksjZ53OlSXPpHrAmS1s/FhRy5g26+KUCtGqmflM=&quot;;&#125;;options &#123; default-key &quot;rndc-key&quot;; default-server 127.0.0.1; default-port 953;&#125;;# -så‚æ•°ç”¨æ¥æŒ‡å®šä¸åŒçš„æœåŠ¡å™¨ï¼Œè¿™é‡Œå¯ä»¥æ˜¯åŸŸåä¹Ÿå¯ä»¥æ˜¯IP# -kå‚æ•°ç”¨æ¥æŒ‡å®škeyï¼Œä½†æ˜¯åé¢è·Ÿç€çš„æ˜¯ä¸€ä¸ªç±»ä¼¼rndc.keyçš„æ–‡ä»¶# -yå‚æ•°ä¹Ÿæ˜¯ç”¨æ¥æŒ‡å®škeyï¼Œä½†æ˜¯åé¢è·Ÿç€çš„å‚æ•°éœ€è¦æ˜¯åœ¨rndc.confæ–‡ä»¶ä¸­å·²ç»å†™æ˜çš„keyçš„key-value[root@tiny-cloud /home/named]# rndc -s localhost -k /etc/rndc.key status[root@tiny-cloud /home/named]# rndc -s 192.168.1.1 -y rndc-conf-key status 4ã€keepalivedå®‰è£…ç”±äºè¿™é‡Œåªéœ€è¦æ”¯æŒIPv4ç½‘ç»œçš„keepalivedç¨‹åºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨yumæºæ¥å®‰è£…keepalivedï¼Œå¦‚æœæœ‰è¾ƒé«˜çš„ç‰ˆæœ¬è¦æ±‚æˆ–è€…ç‰¹æ®Šéœ€è¦ï¼Œå¯ä»¥è€ƒè™‘è‡ªè¡Œä¸‹è½½æºç ç¼–è¯‘å®‰è£…ã€‚ 1[root@tiny-cloud /home/named]# yum install keepalived åŒæ—¶ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬debugï¼Œè¿™é‡Œå†å°†keepalivedçš„æ—¥å¿—é¢å¤–é‡å®šå‘åˆ°å•ç‹¬çš„ç›®å½•æ–‡ä»¶ä¸­ é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹keepalivedçš„é»˜è®¤å¯åŠ¨å‚æ•° 12345678910111213141516[root@tiny-cloud coremail]# sed -i &#x27;s#KEEPALIVED_OPTIONS=&quot;-D&quot;#KEEPALIVED_OPTIONS=&quot;-D -d -S 0&quot;#g&#x27; /etc/sysconfig/keepalived[root@tiny-cloud coremail]# cat /etc/sysconfig/keepalived# Options for keepalived. See `keepalived --help&#x27; output and keepalived(8) and# keepalived.conf(5) man pages for a list of all options. Here are the most# common ones :## --vrrp -P Only run with VRRP subsystem.# --check -C Only run with Health-checker subsystem.# --dont-release-vrrp -V Dont remove VRRP VIPs &amp; VROUTEs on daemon stop.# --dont-release-ipvs -I Dont remove IPVS topology on daemon stop.# --dump-conf -d Dump the configuration data.# --log-detail -D Detailed log messages.# --log-facility -S 0-7 Set local syslog facility (default=LOG_DAEMON)#KEEPALIVED_OPTIONS=&quot;-D -d -S 0&quot; ä¿®æ”¹syslogçš„é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šçš„ç›®å½• 12# å¯¹äºç³»ç»Ÿä½¿ç”¨rsyslogæœåŠ¡æ¥ç®¡ç†æ—¥å¿—çš„ï¼Œå¯ä»¥ä¿®æ”¹ /etc/rsyslog.conf åŠ å…¥ä¸‹åˆ—çš„é…ç½®local0.* /path/to/keepalived.log æœ€åé‡å¯rsyslogæœåŠ¡å’ŒkeepalivedæœåŠ¡å³å¯ 12[root@tiny-cloud /etc/keepalived]# systemctl enable rsyslog.service[root@tiny-cloud /etc/keepalived]# systemctl restart rsyslog.service 5ã€bindä¸»ä»å®‰è£…ä¸»ä»ä¸¤ä¸ªèŠ‚ç‚¹çš„å®‰è£…ç†è®ºä¸Šåº”è¯¥å®Œå…¨ä¸€è‡´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼š ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„rndcé…ç½®å¿…é¡»è¦ä¿è¯èƒ½å¤Ÿäº’ç›¸è¿œç¨‹è®¿é—® ç¡®ä¿ä¸¤è€…ä¹‹é—´çš„é…ç½®æ–‡ä»¶èƒ½å¤Ÿä¿æŒåŒæ­¥ï¼ˆå¯ä»¥ä½¿ç”¨gitæˆ–è€…rsyncç­‰æ–¹å¼ï¼‰ ç¡®ä¿ä¸¤ä¸ªèŠ‚ç‚¹çš„named.confé…ç½®æ–‡ä»¶ä¸­çš„ç›‘å¬ç½‘å¡å’Œç«¯å£è¦†ç›–äº†æœ¬æœºIPå’ŒVIP 6ã€é«˜å¯ç”¨è¿‡ç¨‹åˆ†æè¿™é‡Œä¸ºäº†ä¿è¯DNSèŠ‚ç‚¹çš„é«˜å¯ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨keepalivedå°†ä¸¤å°æœºå™¨åˆ†åˆ«ä½œä¸ºä¸»ä»èŠ‚ç‚¹ï¼Œåšä¸€ä¸ªç®€å•çš„ä¸»ä»èŠ‚ç‚¹æ–¹å¼çš„é«˜å¯ç”¨ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸»èŠ‚ç‚¹çš„priorityä¸º100ï¼Œä»èŠ‚ç‚¹çš„priorityä¸º90ï¼Œæ­¤æ—¶VIPåœ¨ä¸»èŠ‚ç‚¹ä¸Šï¼Œè¯·æ±‚å’Œæµé‡ä»VIPè¿›å…¥ï¼Œç”±ä¸»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œä»èŠ‚ç‚¹ä½œä¸ºå¤‡ç”¨ã€‚ å½“ä¸»èŠ‚ç‚¹å‡ºç°å¼‚å¸¸æ—¶ï¼ŒVIPåç§»åˆ°ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹è¿›å…¥MASTERçŠ¶æ€ï¼Œç›´åˆ°ä¸»èŠ‚ç‚¹æœ¬èº«çš„æœåŠ¡æ¢å¤æ­£å¸¸å†åˆ‡æ¢è¿‡å»ã€‚ è€Œä¸ºäº†é˜²æ­¢VIPåç§»åˆ°å¯¹åº”çš„æœºå™¨ä¸Šçš„æ—¶å€™ï¼ŒnamedæœåŠ¡æ²¡æœ‰ç›‘å¬åˆ°å¯¹åº”çš„ç«¯å£ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬ä¸­è®¾ç½®å½“keepalivedè¿›å…¥notify_masteræ—¶é‡å¯ä¸€ä¸‹namedæœåŠ¡ï¼Œç¡®ä¿èƒ½å¤ŸVIPçš„æœåŠ¡ç«¯å£èƒ½å¤Ÿè¢«æ­£å¸¸ç›‘å¬ã€‚ æ³¨æ„åœ¨ä¸»èŠ‚ç‚¹è„šæœ¬ä¸­è®¾ç½®çš„æ£€æµ‹æ–¹å¼æ˜¯æ£€æµ‹MASTERæœ¬èº«çš„IPä¸Šçš„rndcçŠ¶æ€æ˜¯å¦æ­£å¸¸è€Œä¸æ˜¯VIPä¸Šé¢çš„rndcçŠ¶æ€ï¼Œè€Œå¤‡èŠ‚ç‚¹åˆ™åˆšå¥½ç›¸åã€‚ è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†é¿å…å½“ä¸»èŠ‚ç‚¹æœ¬èº«DNSæœåŠ¡å°±æœ‰é—®é¢˜ï¼Œè€Œå®ƒçš„æ£€æµ‹è„šæœ¬åˆæ˜¯æ£€æµ‹VIPçš„rndcçŠ¶æ€æ—¶ï¼ŒVIPåˆ‡åˆ°ä»èŠ‚ç‚¹åå¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ï¼Œç„¶åä¸»èŠ‚ç‚¹è„šæœ¬æ£€æµ‹æ­£å¸¸ï¼Œå°†VIPæŠ¢äº†å›æ¥ï¼Œä½†æ˜¯è¿™æ—¶å€™ä¸»èŠ‚ç‚¹è‡ªå·±æ˜¯æ— æ³•æ­£å¸¸æä¾›æœåŠ¡çš„ï¼Œéšåä»èŠ‚ç‚¹æ£€æµ‹åˆ°æœåŠ¡ä¸æ­£å¸¸ï¼Œåˆå°†VIPæŠ¢äº†è¿‡å»ï¼Œç„¶åç»§ç»­å¾ªç¯å¯¼è‡´VIPä¸æ–­åç§»ã€‚ 7ã€keepalivedé…ç½®keepalivedçš„é…ç½®æ¯”è¾ƒç®€å•ï¼Œæ³¨æ„è¿™é‡Œçš„intervalã€interfaceã€router_idã€virtual_router_idç­‰å‚æ•°å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚ 7.1 keepalived.confï¼ˆmasterï¼‰1234567891011121314151617181920212223242526272829303132333435363738394041! Configuration File for keepalivedglobal_defs &#123; router_id HA_DNS&#125;vrrp_script chk_dns &#123; # å®šä¹‰æ£€æµ‹çš„è„šæœ¬å’Œæ‰§è¡Œå‚æ•° script &quot;/etc/keepalived/dns_status.sh check ä¸»æœºå™¨çš„IP&quot; # å®šä¹‰è„šæœ¬çš„æ‰§è¡Œæ—¶é—´é—´éš”ä¸º2ç§’ interval 2 # æ‰§è¡Œå¤±è´¥çš„æ—¶å€™weight-20 weight -20 # æ£€æµ‹åˆ°è„šæœ¬æ‰§è¡Œä¸¤æ¬¡å¤±è´¥æ‰ç®—å¤±è´¥ fall 2 # æ£€æµ‹åˆ°è„šæœ¬æ‰§è¡ŒæˆåŠŸä¸€æ¬¡å°±ç®—æˆåŠŸ rise 1&#125;vrrp_instance VIRT_DNS &#123; state MASTER interface eth0 virtual_router_id 201 priority 100 advert_int 1 authentication &#123; auth_type PASS auth_pass 7777@tinychen &#125; track_script &#123; chk_dns &#125; virtual_ipaddress &#123; éœ€è¦é…ç½®çš„VIP(e.g. 1.1.1.1) dev VIPæ‰€åœ¨çš„ç½‘å¡(e.g. eth0) &#125; notify_master &quot;/etc/keepalived/dns_status.sh notify master&quot; notify_backup &quot;/etc/keepalived/dns_status.sh notify backup&quot; notify_fault &quot;/etc/keepalived/dns_status.sh notify fault&quot;&#125; 7.2 keepalived.confï¼ˆbackupï¼‰12345678910111213141516171819202122232425262728293031323334353637383940! Configuration File for keepalivedglobal_defs &#123; router_id HA_DNS&#125;vrrp_script chk_dns &#123; script &quot;/etc/keepalived/dns_status.sh check ç”¨æ¥åšé«˜å¯ç”¨çš„VIP&quot; # å®šä¹‰è„šæœ¬çš„æ‰§è¡Œæ—¶é—´é—´éš”ä¸º2ç§’ interval 2 # æ‰§è¡Œå¤±è´¥çš„æ—¶å€™weight-20 weight -20 # æ£€æµ‹åˆ°è„šæœ¬æ‰§è¡Œä¸¤æ¬¡å¤±è´¥æ‰ç®—å¤±è´¥ fall 2 # æ£€æµ‹åˆ°è„šæœ¬æ‰§è¡ŒæˆåŠŸä¸€æ¬¡å°±ç®—æˆåŠŸ rise 1&#125;vrrp_instance VIRT_DNS &#123; state BACKUP interface eth0 virtual_router_id 201 priority 90 advert_int 1 authentication &#123; auth_type PASS auth_pass 7777@tinychen &#125; track_script &#123; chk_dns &#125; virtual_ipaddress &#123; éœ€è¦é…ç½®çš„VIP(e.g. 1.1.1.1) dev VIPæ‰€åœ¨çš„ç½‘å¡(e.g. eth0) &#125; notify_master &quot;/etc/keepalived/dns_status.sh notify master&quot; notify_backup &quot;/etc/keepalived/dns_status.sh notify backup&quot; notify_fault &quot;/etc/keepalived/dns_status.sh notify fault&quot;&#125; 7.3 dns_status.shè¿™é‡Œè„šæœ¬çš„æ”¾ç½®ç›®å½•è¦å’Œä¸Šé¢çš„ 123456789101112131415161718192021222324252627282930313233# vim /etc/keepalived/dns_status.sh#!/bin/bashLOGFILE=&quot;/home/named/keepalived/keepalived.log&quot;case &quot;$1&quot; incheck) ALIVE=$(/usr/sbin/rndc -s $2 status | grep &quot;server is up and running&quot;) if [ $? == 0 ]; then exit 0 else echo &quot;---------------------------------------&quot; &gt;&gt;$LOGFILE date &quot;+%Y-%m-%d %H:%M:%S&quot; &gt;&gt;$LOGFILE echo &quot;Using rndc status check failed&quot; &gt;&gt;$LOGFILE echo &quot;---------------------------------------&quot; &gt;&gt;$LOGFILE exit 1 fi ;;notify) echo &quot;---------------------------------------&quot; &gt;&gt;$LOGFILE date &quot;+%Y-%m-%d %H:%M:%S&quot; &gt;&gt;$LOGFILE echo &quot;Enter status: $2&quot; &gt;&gt;$LOGFILE if [ $2 == &quot;master&quot; ]; then echo &quot;Begin running systemctl restart cmd &quot; &gt;&gt;$LOGFILE systemctl restart named.service &gt;&gt;$LOGFILE 2&gt;&amp;1 echo &quot;Running reload cmd done ! &quot; &gt;&gt;$LOGFILE date &quot;+%Y-%m-%d %H:%M:%S&quot; &gt;&gt;$LOGFILE fi echo &quot;---------------------------------------&quot; &gt;&gt;$LOGFILE ;;*) echo &quot;Usage: sh $0 check ipaddr | notify status&quot; ;;esac 8ã€æ•ˆæœæ£€æµ‹æœ€åæˆ‘ä»¬å…³é—­ä¸»èŠ‚ç‚¹ä¸Šé¢çš„namedæœåŠ¡ï¼Œç„¶åæŸ¥çœ‹æ—¥å¿—å’Œä»èŠ‚ç‚¹çš„çŠ¶æ€ç¡®å®šVIPèƒ½å¦é¡ºåˆ©åˆ‡æ¢ï¼Œä¹‹åå†é‡å¯ä¸»èŠ‚ç‚¹ä¸Šé¢çš„namedæœåŠ¡ï¼Œä¿è¯æœåŠ¡èƒ½å¤Ÿæ­£å¸¸è¿è¡Œå³å¯ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"bind","slug":"bind","permalink":"https://tinychen.com/tags/bind/"}]},{"title":"CoreDNSç¯‡2-ç¼–è¯‘å®‰è£…External Plugins","slug":"20210516-dns-04-coredns-02--install-external-plugins","date":"2021-05-16T03:00:00.000Z","updated":"2021-05-16T03:00:00.000Z","comments":true,"path":"20210516-dns-04-coredns-02--install-external-plugins/","link":"","permalink":"https://tinychen.com/20210516-dns-04-coredns-02--install-external-plugins/","excerpt":"æœ¬æ–‡ä¸»è¦å¯¹corednsçš„æºç è¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œä»¥åŠåœ¨ç¼–è¯‘å®‰è£…çš„è¿‡ç¨‹ä¸­åŠ å…¥ä¸€äº›External Pluginsçš„æ–¹æ³•ã€‚","text":"æœ¬æ–‡ä¸»è¦å¯¹corednsçš„æºç è¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œä»¥åŠåœ¨ç¼–è¯‘å®‰è£…çš„è¿‡ç¨‹ä¸­åŠ å…¥ä¸€äº›External Pluginsçš„æ–¹æ³•ã€‚ 1ã€ç¼–è¯‘å®‰è£…coredns1.1 golangç¯å¢ƒå‡†å¤‡å®˜æ–¹çš„githubé¡µé¢ä¸Šæä¾›äº†ç¼–è¯‘å®‰è£…çš„ç›¸å…³æŒ‡å¼•ï¼Œéœ€è¦çš„å¯ä»¥ç‚¹å‡»è¿™é‡Œè·³è½¬ã€‚ First, make sure your golang version is 1.12 or higher as go mod support is needed. See here for go mod details. ç”±äºcorednsæ˜¯ä½¿ç”¨golangç¼–å†™ï¼Œå› æ­¤å¯¹å…¶è¿›è¡Œç¼–è¯‘å®‰è£…ä¹‹å‰éœ€è¦å…ˆé…ç½®goç¯å¢ƒã€‚è€Œåœ¨centosä¸­ä½¿ç”¨yumå®‰è£…çš„goç‰ˆæœ¬è¾ƒæ—§ï¼Œæˆ‘ä»¬ç›´æ¥å»å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬è¿›è¡Œè§£å‹å³å¯ã€‚ 123wget https://golang.org/dl/go1.16.4.linux-amd64.tar.gztar -zxvf go1.16.4.linux-amd64.tar.gz -C /usr/local/ln -s /usr/local/go/bin/go /usr/bin/go æ¥ä¸‹æ¥çš„goç¯å¢ƒå˜é‡åŒå­¦ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚è¿›è¡Œé…ç½®ã€‚å¯¹äºæˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘ç›´æ¥åœ¨/etc/profileä¸­æ·»åŠ ä¸‹é¢çš„é…ç½®ç„¶åsourceç”Ÿæ•ˆå³å¯ã€‚ 12345678910cat &gt;&gt; /etc/profile &lt;&lt;EOFexport GOROOT=/usr/local/goexport GOBIN=$GOROOT/binexport PATH=$PATH:$GOBINexport GOPATH=/home/gopathEOF[root@tiny-server home]# mkdir /home/gopath[root@tiny-server home]# source /etc/profile[root@tiny-server home]# go versiongo version go1.16.4 linux/amd64 goç¯å¢ƒé…ç½®å®Œæˆä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ ¹æ®corednsçš„æç¤ºæ£€æŸ¥gomodæ˜¯å¦æ­£å¸¸ï¼Œä»goçš„GitHubæ–‡æ¡£ä¸­æˆ‘ä»¬å¯ä»¥å¾—çŸ¥åœ¨1.16ç‰ˆæœ¬å¼€å§‹æ˜¯é»˜è®¤å¯ç”¨å¹¶æ”¯æŒgomodçš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æ— éœ€é¢å¤–é…ç½®ã€‚ Go 1.16 See the Go 1.16 release notes for details. Module mode (GO111MODULE=on) is the default in all cases Commands no longer modify go.mod / go.sum by default (-mod=readonly) go install pkg@version is the recommended way to globally install packages / executables retract is available in go.mod 1.2 ç¼–è¯‘corednsæ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥å¼€å§‹è¿›è¡Œç¼–è¯‘ï¼Œ(åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šè®¿é—®google.com,k8s.ioç­‰åŸŸåï¼Œéœ€è¦æ³¨æ„ä¿è¯ç½‘ç»œæ­£å¸¸) 123git clone https://github.com/coredns/corednscd coredns/make ç¼–è¯‘å®Œæˆä¹‹åæˆ‘ä»¬å°±ä¼šåœ¨å½“å‰ç›®å½•ä¸‹å¾—åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ 12345[/home/coredns]# file corednscoredns: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, stripped[/home/coredns]# ./coredns -versionCoreDNS-1.8.3linux/amd64, go1.16.4, 7b43d042 2ã€ç¼–è¯‘External Plugins2.1 ä»€ä¹ˆæ˜¯External Pluginscorednså®˜æ–¹å¯¹äºæ’ä»¶çš„åˆ†ç±»åŸºæœ¬å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼šPluginsã€External Pluginså’Œå…¶ä»–ã€‚å…¶ä¸­Pluginsä¸€èˆ¬éƒ½ä¼šè¢«é»˜è®¤ç¼–è¯‘åˆ°corednsçš„é¢„ç¼–è¯‘ç‰ˆæœ¬ä¸­ï¼Œè€ŒExternal Pluginsåˆ™ä¸ä¼šã€‚å®˜æ–¹çš„æ–‡æ¡£å¯¹å¤–éƒ¨æ’ä»¶çš„å®šä¹‰æœ‰ç€æ˜ç¡®çš„è§£é‡Šï¼Œä¸»è¦è¦æ±‚å¤§æ¦‚æ˜¯æœ‰ç”¨ã€é«˜æ•ˆã€ç¬¦åˆæ ‡å‡†ã€æ–‡æ¡£é½å…¨ã€é€šè¿‡æµ‹è¯•ç­‰ã€‚ 2.2 å¦‚ä½•ç¼–è¯‘æ’ä»¶å®˜æ–¹ç»™å‡ºäº†ä¸€ä¸ªè¯¦ç»†çš„æ–‡æ¡£è¯´æ˜ï¼Œç¼–è¯‘æ’ä»¶åŸºæœ¬å¯ä»¥åˆ†ä¸ºä¿®æ”¹æºç å’Œä¿®æ”¹ç¼–è¯‘çš„é…ç½®æ–‡ä»¶è¿™ä¸¤ç§æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç®€å•é«˜æ•ˆçš„ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œæµ‹è¯•ã€‚ åœ¨æˆ‘ä»¬å‰é¢ä¸‹è½½çš„å®˜æ–¹æºç ä¸­ï¼Œæœ‰ä¸€ä¸ªpluginçš„ç›®å½•ï¼Œé‡Œé¢æ˜¯å„ç§æ’ä»¶çš„å®‰è£…åŒ…ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªplugin.cfgçš„æ–‡ä»¶ï¼Œé‡Œé¢åˆ—å‡ºäº†ä¼šç¼–è¯‘åˆ°corednsä¸­çš„æ’ä»¶ï¼Œ 1234567891011[/home/coredns]# tail plugin.cfgsecondary:secondaryetcd:etcdloop:loopforward:forwardgrpc:grpcerratic:erraticwhoami:whoamion:github.com/coredns/caddy/oneventsign:signdump:github.com/miekg/dump ä¾‹å¦‚è¿™é‡Œæˆ‘ä»¬éœ€è¦é¢å¤–å¤šæ·»åŠ ä¸€ä¸ªdumpæ’ä»¶åˆ°corednsä¸­ï¼Œåªéœ€è¦åœ¨plugin.cfgä¸­åŠ å…¥æ’ä»¶çš„åç§°å’Œåœ°å€ 1dump:github.com/miekg/dump å¯¹äºåœ¨pluginç›®å½•ä¸‹å·²ç»å­˜åœ¨çš„æ’ä»¶ï¼Œåˆ™å¯ä»¥ç›´æ¥å†™æˆpluginä¸­çš„ç›®å½•åï¼š 1sign:sign ç„¶åæˆ‘ä»¬å¼€å§‹ç¼–è¯‘ 123456[/home/coredns]# go get github.com/miekg/dumpgo: downloading github.com/miekg/dump v0.0.0-20201002053733-d877fdb82251go get: added github.com/miekg/dump v0.0.0-20201002053733-d877fdb82251[/home/coredns]# go generate[/home/coredns]# go build[/home/coredns]# make 2.3 éªŒè¯æ’ä»¶æ¥ä¸‹æ¥åªè¦æ£€éªŒç”Ÿæˆçš„corednsäºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ˜¯å¦åŒ…å«dumpæ’ä»¶å³å¯ç¡®è®¤æ˜¯å¦é¡ºåˆ©ç¼–è¯‘å®Œæˆï¼š æœ€åæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å¯åŠ¨dumpæ¨¡å—å¹¶è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°ä¸€æ¡æŸ¥è¯¢ä¼šå‡ºç°ä¸¤æ¡æ—¥å¿—ï¼Œåˆ†åˆ«å¯¹åº”çš„æ˜¯dumpæ’ä»¶ç”Ÿæˆçš„æ—¥å¿—å’Œlogæ’ä»¶ç”Ÿæˆçš„æ—¥å¿—ï¼ˆå¸¦INFOï¼‰","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"coredns","slug":"coredns","permalink":"https://tinychen.com/tags/coredns/"}]},{"title":"CoreDNSç¯‡1-ç®€ä»‹å’Œå®‰è£…","slug":"20210509-dns-03-coredns-01-introduction","date":"2021-05-09T03:00:00.000Z","updated":"2021-05-09T03:00:00.000Z","comments":true,"path":"20210509-dns-03-coredns-01-introduction/","link":"","permalink":"https://tinychen.com/20210509-dns-03-coredns-01-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦å¯¹corednsçš„åŸç†å’Œç‰¹æ€§è¿›è¡Œä»‹ç»ï¼ŒåŒæ—¶ä¼šå¯¹å…¶äºŒè¿›åˆ¶çš„å®‰è£…æ–¹æ³•è¿›è¡Œå°è¯•ã€‚","text":"æœ¬æ–‡ä¸»è¦å¯¹corednsçš„åŸç†å’Œç‰¹æ€§è¿›è¡Œä»‹ç»ï¼ŒåŒæ—¶ä¼šå¯¹å…¶äºŒè¿›åˆ¶çš„å®‰è£…æ–¹æ³•è¿›è¡Œå°è¯•ã€‚ 1ã€corednsç®€ä»‹corednsæ˜¯ä¸€ä¸ªç”¨goè¯­è¨€ç¼–å†™çš„å¼€æºçš„DNSæœåŠ¡ï¼Œå®ƒçš„å®˜ç½‘å¯ä»¥ç‚¹å‡»è¿™é‡Œï¼Œgithubé¡µé¢å¯ä»¥ç‚¹å‡»è¿™é‡Œã€‚éœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯ï¼Œcorednsæ˜¯é¦–æ‰¹åŠ å…¥CNCFç»„ç»‡çš„äº‘åŸç”Ÿå¼€æºé¡¹ç›®ï¼Œå¹¶ä¸”ä½œä¸ºå·²ç»åœ¨CNCFæ¯•ä¸šçš„é¡¹ç›®ï¼Œcorednsè¿˜æ˜¯ç›®å‰kubernetesä¸­é»˜è®¤çš„dnsæœåŠ¡ã€‚åŒæ—¶ï¼Œç”±äºcorednså¯ä»¥é›†æˆæ’ä»¶ï¼Œå®ƒè¿˜èƒ½å¤Ÿå®ç°æœåŠ¡å‘ç°çš„åŠŸèƒ½ã€‚ corednså’Œå…¶ä»–çš„è¯¸å¦‚bindã€knotã€powerdnsã€unboundç­‰DNSæœåŠ¡ä¸åŒçš„æ˜¯ï¼šcorednséå¸¸çš„çµæ´»ï¼Œå¹¶ä¸”å‡ ä¹æŠŠæ‰€æœ‰çš„æ ¸å¿ƒåŠŸèƒ½å®ç°éƒ½å¤–åŒ…ç»™äº†æ’ä»¶ã€‚æ¯”å¦‚è¯´å¦‚æœä½ æƒ³è¦åœ¨corednsä¸­åŠ å…¥Prometheusçš„ç›‘æ§æ”¯æŒï¼Œé‚£ä¹ˆåªéœ€è¦å®‰è£…å¯¹åº”çš„prometheusæ’ä»¶å¹¶ä¸”å¯ç”¨å³å¯ï¼Œå› æ­¤å®˜æ–¹ä¹Ÿè¯´corednsæ˜¯ç”±æ’ä»¶é©±åŠ¨çš„ã€‚ CoreDNS is powered by plugins. å¯¹äºcorednsæ’ä»¶çš„å®šä¹‰ï¼Œå®˜ç½‘æ˜¯è¿™æ ·è¡¨ç¤ºçš„ï¼šæ’ä»¶æ˜¯èƒ½å¤Ÿå•ç‹¬æˆ–è€…å…±åŒå®ç°ä¸€ä¸ªâ€œDNSçš„åŠŸèƒ½ï¼ˆDNS functionï¼‰â€ã€‚ Plugins can be stand-alone or work together to perform a â€œDNS functionâ€. So whatâ€™s a â€œDNS functionâ€? For the purpose of CoreDNS, we define it as a piece of software that implements the CoreDNS Plugin API. The functionality implemented can wildly deviate. There are plugins that donâ€™t themselves create a response, such as metrics or cache, but that add functionality. Then there are plugins that do generate a response. These can also do anything: There are plugins that communicate with Kubernetes to provide service discovery, plugins that read data from a file or a database. 2ã€corednså®‰è£…å’Œå¤§å¤šæ•°çš„è½¯ä»¶ä¸€æ ·ï¼Œcorednsæä¾›äº†æºç ç¼–è¯‘ã€é¢„ç¼–è¯‘åŒ…å’Œdockeré•œåƒä¸‰ç§å®‰è£…æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é¢„ç¼–è¯‘åŒ…çš„æ–¹å¼è¿›è¡Œå®‰è£…ã€‚corednsåœ¨githubä¸Šé¢æä¾›äº†å„ç§ç‰ˆæœ¬çš„é¢„ç¼–è¯‘åŒ…ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸‹è½½å¯¹åº”çš„ç¡¬ä»¶ç‰ˆæœ¬å³å¯ã€‚ è§£å‹å¯¹åº”çš„ç‰ˆæœ¬åå¯ä»¥å¾—åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç›´æ¥æ‰§è¡Œå°±å¯ä»¥ä½¿ç”¨ã€‚ 1234567891011121314[root@tiny-server coredns]# ./coredns --helpUsage of ./coredns: -conf string Corefile to load (default &quot;Corefile&quot;) -dns.port string Default port (default &quot;53&quot;) -pidfile string Path to write pid file -plugins List installed plugins -quiet Quiet mode (no initialization output) -version Show version éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºé¢„ç¼–è¯‘çš„ç‰ˆæœ¬ï¼Œä¼šå†…ç½®å…¨éƒ¨å®˜æ–¹è®¤è¯çš„æ’ä»¶ï¼Œä¹Ÿå°±æ˜¯å®˜ç½‘çš„æ’ä»¶é¡µé¢åˆ—å‡ºæ¥çš„å…¨éƒ¨æ’ä»¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455[root@tiny-server coredns]# ./coredns -pluginsServer types: dnsCaddyfile loaders: flag defaultOther plugins: dns.acl dns.any dns.auto dns.autopath dns.azure dns.bind dns.bufsize dns.cache dns.cancel dns.chaos dns.clouddns dns.debug dns.dns64 dns.dnssec dns.dnstap dns.erratic dns.errors dns.etcd dns.file dns.forward dns.grpc dns.health dns.hosts dns.k8s_external dns.kubernetes dns.loadbalance dns.local dns.log dns.loop dns.metadata dns.nsid dns.pprof dns.prometheus dns.ready dns.reload dns.rewrite dns.root dns.route53 dns.secondary dns.sign dns.template dns.tls dns.trace dns.transfer dns.whoami on corednsçš„è¿è¡Œä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶å³å¯ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥æ·»åŠ çš„å‚æ•°ä¸å¤šï¼Œä¸»è¦æ˜¯æŒ‡å®šé…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šè¿è¡Œç«¯å£å’Œè®¾ç½®quietæ¨¡å¼ã€‚ 1234[root@tiny-server coredns]# ./coredns.:53CoreDNS-1.8.3linux/amd64, go1.16, 4293992 é»˜è®¤æƒ…å†µä¸‹ä¼šç›´æ¥ç›‘å¬53ç«¯å£ï¼Œå¹¶ä¸”è¯»å–å’Œè‡ªå·±åœ¨ç›¸åŒç›®å½•ä¸‹çš„Corefileé…ç½®æ–‡ä»¶ã€‚ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè™½ç„¶corednsæ­£å¸¸è¿è¡Œäº†ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰é…ç½®æ–‡ä»¶ï¼Œæ˜¯æ— æ³•æ­£å¸¸è§£æä»»ä½•åŸŸåè¯·æ±‚çš„ã€‚ 1234567891011121314151617181920212223242526272829303132# ç›´æ¥è¿è¡Œcorednsè®©å…¶ç›‘å¬30053ç«¯å£[root@tiny-server coredns-test]# ./coredns -dns.port 30053.:30053CoreDNS-1.8.3linux/amd64, go1.16, 4293992[INFO] 127.0.0.1:47910 - 63992 &quot;A IN tinychen.com. udp 53 false 4096&quot; NOERROR qr,aa,rd 94 0.000162476s[INFO] 127.0.0.1:48764 - 26598 &quot;A IN tinychen.com. udp 53 false 4096&quot; NOERROR qr,aa,rd 94 0.000135895s# ä½¿ç”¨digå‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°èƒ½å¤Ÿæ­£å¸¸è¿”å›è¯·æ±‚ä½†æ˜¯è§£æçš„ç»“æœä¸æ­£ç¡®[root@tiny-server coredns-test]# dig tinychen.com @127.0.0.1 -p30053; &lt;&lt;&gt;&gt; DiG 9.11.20-RedHat-9.11.20-5.el8_3.1 &lt;&lt;&gt;&gt; tinychen.com @127.0.0.1 -p30053;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 26598;; flags: qr aa rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 3;; WARNING: recursion requested but not available;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 4096; COOKIE: 4429aa454c031afe (echoed);; QUESTION SECTION:;tinychen.com. IN A;; ADDITIONAL SECTION:tinychen.com. 0 IN A 127.0.0.1_udp.tinychen.com. 0 IN SRV 0 0 48764 .;; Query time: 0 msec;; SERVER: 127.0.0.1#30053(127.0.0.1);; WHEN: Tue May 11 11:39:47 CST 2021;; MSG SIZE rcvd: 117 è¿™é‡Œæˆ‘ä»¬ç®€å•ç¼–å†™ä¸€ä¸ªCorefileé…ç½®æ–‡ä»¶å°±èƒ½å¤Ÿå…ˆè®©corednsæ­£å¸¸è§£æåŸŸåï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶çš„æ„è¯†æ˜¯å¯¹æ‰€æœ‰åŸŸçš„è¯·æ±‚éƒ½forwardåˆ°114DNSè¿›è¡Œè§£æï¼Œå¹¶ä¸”è®°å½•æ­£å¸¸çš„æ—¥å¿—å’Œé”™è¯¯çš„æ—¥å¿—ã€‚ 1234567[root@tiny-server coredns]# cat Corefile. &#123; forward . 114.114.114.114 223.5.5.5 log errors whoami&#125; ç„¶åæˆ‘ä»¬å†è¿›è¡Œæµ‹è¯•å°±å‘ç°corednså¯ä»¥æ­£å¸¸è§£æåŸŸåäº†ï¼š 1234567891011121314151617181920212223242526[root@tiny-server coredns-test]# dig tinychen.com @127.0.0.1 -p30053; &lt;&lt;&gt;&gt; DiG 9.11.20-RedHat-9.11.20-5.el8_3.1 &lt;&lt;&gt;&gt; tinychen.com @127.0.0.1 -p30053;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 49732;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 4096;; QUESTION SECTION:;tinychen.com. IN A;; ANSWER SECTION:tinychen.com. 35 IN A 47.107.188.168;; Query time: 29 msec;; SERVER: 127.0.0.1#30053(127.0.0.1);; WHEN: Tue May 11 14:02:41 CST 2021;; MSG SIZE rcvd: 69[root@tiny-server coredns-test]# ./coredns -dns.port 30053.:30053CoreDNS-1.8.3linux/amd64, go1.16, 4293992[INFO] 127.0.0.1:42293 - 51799 &quot;A IN tinychen.com. udp 53 false 4096&quot; NOERROR qr,rd,ra 58 0.244014828s 3ã€systemdç®¡ç†corednsä½œä¸ºä¸€ä¸ªäºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å‘å…¶ä»–çš„å¦‚nginxã€bindç­‰æœåŠ¡æä¾›ç§ç±»ç¹å¤šçš„è¿›ç¨‹æ§åˆ¶ï¼ˆreload stop restartç­‰ç­‰ï¼‰é€‰é¡¹ï¼Œå› æ­¤ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ç®¡ç†å’Œåœ¨åå°ä¸€ç›´è¿è¡Œcorednsï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨systemdå¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œåªéœ€è¦ç¼–å†™ä¸€ä¸ªsystemdçš„unitæ–‡ä»¶å³å¯ï¼š 1234567891011121314151617[root@tiny-server coredns]# cat /usr/lib/systemd/system/coredns.service[Unit]Description=CoreDNSDocumentation=https://coredns.io/manual/toc/After=network.target[Service]# Typeè®¾ç½®ä¸ºnotifyæ—¶ï¼ŒæœåŠ¡ä¼šä¸æ–­é‡å¯# å…³äºtypeçš„è®¾ç½®ï¼Œå¯ä»¥å‚è€ƒhttps://www.freedesktop.org/software/systemd/man/systemd.service.html#OptionsType=simpleUser=root# æŒ‡å®šè¿è¡Œç«¯å£å’Œè¯»å–çš„é…ç½®æ–‡ä»¶ExecStart=/home/coredns/coredns -dns.port=53 -conf /home/coredns/CorefileRestart=on-failure[Install]WantedBy=multi-user.target ç¼–å†™å®Œæˆä¹‹åæˆ‘ä»¬ä¾æ¬¡reloadé…ç½®æ–‡ä»¶å¹¶ä¸”è®¾ç½®å¼€æœºå¯åŠ¨æœåŠ¡å’Œå¼€å¯æœåŠ¡ï¼Œå³å¯çœ‹åˆ°æœåŠ¡æ­£å¸¸è¿è¡Œ 123456789101112131415[root@tiny-server coredns]# systemctl daemon-reload[root@tiny-server coredns]# systemctl enable coredns.service[root@tiny-server coredns]# systemctl start coredns.service[root@tiny-server coredns]# systemctl status coredns.serviceâ— coredns.service - CoreDNS Loaded: loaded (/usr/lib/systemd/system/coredns.service; enabled; vendor preset: disabled) Active: active (running) since Tue 2021-05-11 11:29:53 CST; 2h 37min ago Docs: https://coredns.io/manual/toc/ Main PID: 131287 (coredns) Tasks: 10 (limit: 49835) Memory: 27.3M CGroup: /system.slice/coredns.service â””â”€131287 /home/coredns/coredns -dns.port=53 -conf /home/coredns/CorefileMay 11 11:29:53 tiny-server systemd[1]: Started CoreDNS. 4ã€corednsæ—¥å¿—å¤„ç†corednsçš„æ—¥å¿—è¾“å‡ºå¹¶ä¸å¦‚nginxé‚£ä¹ˆå®Œå–„ï¼ˆå¹¶ä¸èƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶ç›®å½•ï¼Œä½†æ˜¯å¯ä»¥æŒ‡å®šæ—¥å¿—çš„æ ¼å¼ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸è®ºæ˜¯logæ’ä»¶è¿˜æ˜¯erroræ’ä»¶éƒ½ä¼šæŠŠæ‰€æœ‰çš„ç›¸å…³æ—¥å¿—è¾“å‡ºåˆ°ç¨‹åºçš„standard outputä¸­ã€‚ä½¿ç”¨systemdæ¥ç®¡ç†corednsä¹‹åï¼Œé»˜è®¤æƒ…å†µä¸‹åŸºæœ¬å°±æ˜¯ç”±rsyslogå’Œsystemd-journaldè¿™ä¸¤ä¸ªæœåŠ¡æ¥ç®¡ç†æ—¥å¿—ã€‚ 4.1 StandardOutputæ ¹æ®ç½‘ä¸Šçš„å‚è€ƒèµ„æ–™æˆ‘ä»¬å¯ä»¥å¾—çŸ¥è¾ƒæ–°ç‰ˆæœ¬çš„systemdæ˜¯å¯ä»¥ç›´æ¥åœ¨systemdçš„unitæ–‡ä»¶é‡Œé¢é…ç½®StandardOutputå’ŒStandardErrorä¸¤ä¸ªå‚æ•°æ¥å°†ç›¸å…³è¿è¡Œæ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚ å› æ­¤å¯¹äºcentos8ç­‰è¾ƒæ–°çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬çš„unitæ–‡ä»¶å¯ä»¥è¿™æ ·ç¼–å†™ï¼š 12345678910111213141516171819202122[Unit]Description=CoreDNSDocumentation=https://coredns.io/manual/toc/After=network.target# StartLimitè¿™ä¸¤ä¸ªç›¸å…³å‚æ•°ä¹Ÿæ˜¯centos8ç­‰systemdç‰ˆæœ¬è¾ƒæ–°çš„ç³»ç»Ÿæ‰æ”¯æŒçš„StartLimitBurst=1StartLimitIntervalSec=15s[Service]# Typeè®¾ç½®ä¸ºnotifyæ—¶ï¼ŒæœåŠ¡ä¼šä¸æ–­é‡å¯Type=simpleUser=root# æŒ‡å®šè¿è¡Œç«¯å£å’Œè¯»å–çš„é…ç½®æ–‡ä»¶ExecStart=/home/coredns/coredns -dns.port=53 -conf /home/coredns/Corefile# appendç±»å‹å¯ä»¥åœ¨åŸæœ‰æ–‡ä»¶æœ«å°¾ç»§ç»­è¿½åŠ å†…å®¹ï¼Œè€Œfileç±»å‹åˆ™æ˜¯é‡æ–°æ‰“å¼€ä¸€ä¸ªæ–°æ–‡ä»¶# ä¸¤è€…çš„åŒºåˆ«ç±»ä¼¼äº echo &gt;&gt; å’Œ echo &gt;StandardOutput=append:/home/coredns/logs/coredns.logStandardError=append:/home/coredns/logs/coredns_error.logRestart=on-failure[Install]WantedBy=multi-user.target å‚è€ƒé“¾æ¥ï¼šsystemd.exec (www.freedesktop.org) The file:*path* option may be used to connect a specific file system object to standard output. The semantics are similar to the same option of StandardInput=, see above. If path refers to a regular file on the filesystem, it is opened (created if it doesnâ€™t exist yet) for writing at the beginning of the file, but without truncating it. If standard input and output are directed to the same file path, it is opened only once, for reading as well as writing and duplicated. This is particularly useful when the specified path refers to an AF_UNIX socket in the file system, as in that case only a single stream connection is created for both input and output. append:*path* is similar to file:*path* above, but it opens the file in append mode. ä¿®æ”¹å®Œæˆä¹‹åæˆ‘ä»¬å†é‡å¯æœåŠ¡å°±å¯ä»¥çœ‹åˆ°æ—¥å¿—å·²ç»è¢«é‡å®šå‘è¾“å‡ºåˆ°æˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶ä¸­ 12[root@tiny-server coredns]# systemctl daemon-reload[root@tiny-server coredns]# systemctl restart coredns.service 4.2 rsyslogå¯¹äºcentos7ç­‰ç³»ç»Ÿè€Œè¨€ï¼Œæ˜¯ä¸æ”¯æŒä¸Šé¢çš„appendå’Œfileä¸¤ä¸ªå‚æ•°çš„ï¼Œé‚£ä¹ˆåœ¨å¼€å¯äº†rsyslog.serviceæœåŠ¡çš„æƒ…å†µä¸‹ï¼Œæ—¥å¿—å°±ä¼šè¾“å‡ºåˆ°/var/log/messagesæ–‡ä»¶ä¸­ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨journalctl -u corednså‘½ä»¤æ¥æŸ¥çœ‹å…¨éƒ¨çš„æ—¥å¿—ã€‚ å¦‚æœæƒ³è¦å°†corednsçš„æ—¥å¿—å…¨éƒ¨é›†ä¸­åˆ°ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è´Ÿè´£ç®¡ç†systemdçš„æ—¥å¿—çš„rsyslogæœåŠ¡çš„é…ç½®è¿›è¡Œä¿®æ”¹ï¼š 12345# vim /etc/rsyslog.confif $programname == &#x27;coredns&#x27; then /home/coredns/logs/coredns.log&amp; stop[root@tiny-server coredns]# systemctl restart rsyslog.service ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ç§æ–¹å¼æ‰“å‡ºæ¥çš„æ—¥å¿—ç¨å¾®æœ‰äº›ä¸åŒï¼Œå¯¹äºStandardOutputè¿™ç§æ–¹å¼è¾“å‡ºçš„æ—¥å¿—ç¼ºå°‘äº†å‰é¢çš„æ—¶é—´å’Œä¸»æœºåç­‰ä¿¡æ¯ï¼Œç›¸å¯¹è€Œè¨€è¿˜æ˜¯ä¿®æ”¹rsyslogçš„æ–¹å¼è¦æ›´åŠ çš„å¯é ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"coredns","slug":"coredns","permalink":"https://tinychen.com/tags/coredns/"}]},{"title":"åœ¨centosä¸­ä½¿ç”¨nmcliå·¥å…·åˆ›å»ºè™šæ‹Ÿç½‘æ¡¥","slug":"20210408-nmcli-create-net-bridge","date":"2021-04-08T03:00:00.000Z","updated":"2021-04-08T03:00:00.000Z","comments":true,"path":"20210408-nmcli-create-net-bridge/","link":"","permalink":"https://tinychen.com/20210408-nmcli-create-net-bridge/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨centos8ä¸­ä½¿ç”¨nmcliå·¥å…·åˆ›å»ºè™šæ‹Ÿç½‘æ¡¥å¹¶ä¸”æ·»åŠ ç‰©ç†ç½‘å¡åˆ°è™šæ‹Ÿç½‘æ¡¥ä¸­ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªäºŒå±‚äº¤æ¢æœºã€‚ è¿™ä¸ªæ“ä½œä¸ä»…é€‚ç”¨äºç‰©ç†ç½‘å¡è®¾å¤‡ä¸Šï¼Œè¿˜é€‚ç”¨äºå„ç§è™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘å¡è®¾å¤‡ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨centos8ä¸­ä½¿ç”¨nmcliå·¥å…·åˆ›å»ºè™šæ‹Ÿç½‘æ¡¥å¹¶ä¸”æ·»åŠ ç‰©ç†ç½‘å¡åˆ°è™šæ‹Ÿç½‘æ¡¥ä¸­ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªäºŒå±‚äº¤æ¢æœºã€‚ è¿™ä¸ªæ“ä½œä¸ä»…é€‚ç”¨äºç‰©ç†ç½‘å¡è®¾å¤‡ä¸Šï¼Œè¿˜é€‚ç”¨äºå„ç§è™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘å¡è®¾å¤‡ã€‚ ç›®æ ‡æ˜¯å°†çº¢æ¡†å†…çš„ä¸‰ä¸ªç½‘å¡éƒ½ç»„åˆæˆä¸ºä¸€ä¸ªäºŒå±‚çš„äº¤æ¢æœºï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ï¼Œè¿™ä¸ªè®¾å¤‡çš„åŠŸèƒ½å°±ç›¸å½“äºæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„äº¤æ¢æœº 1nmcli connection add type bridge con-name switch ifname switch autoconnect yes æ¥ç€æˆ‘ä»¬å°†éœ€è¦çš„ç½‘å¡æ·»åŠ åˆ°åˆšåˆšåˆ›å»ºçš„åä¸ºswitchçš„ç½‘æ¡¥ä¸­ 123nmcli connection add type bridge-slave ifname enp0s20u3 master switchnmcli connection add type bridge-slave ifname enp0s20u4 master switchnmcli connection add type bridge-slave ifname enp6s0 master switch å®Œæˆæ·»åŠ ä¹‹åæˆ‘ä»¬éœ€è¦å¯¹ç½‘æ¡¥å’Œç½‘å¡çš„é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œç¼–è¾‘å¯¹åº”çš„é…ç½®æ–‡ä»¶ä¿®æ”¹å¯åŠ¨é€‰é¡¹å’ŒIPåœ°å€ï¼š/etc/sysconfig/network-scripts/ifcfg-*ï¼ŒæŠŠæ·»åŠ åˆ°switchç½‘æ¡¥çš„æ‰€æœ‰ç½‘å¡å–æ¶ˆå¼€æœºå¯åŠ¨ï¼Œé¿å…å’Œç½‘æ¡¥çš„é…ç½®äº§ç”Ÿå†²çªï¼š 1ONBOOT=no åŒæ—¶ç»™ç½‘æ¡¥è®¾ç½®é™æ€IPåœ°å€ï¼Œé…ç½®çš„æ–¹æ³•å’Œéƒ¨åˆ†ç›¸å…³é…ç½®å¦‚ä¸‹ 123456BOOTPROTO=staticONBOOT=yesIPADDR=192.168.1.1NETMASK=255.255.255.0GATEWAY=192.168.1.253DNS1=8.8.8.8 é…ç½®å®Œæˆä¹‹åï¼Œè¿™æ—¶çš„æ•´ä¸ªswitchè®¾å¤‡å°±ç›¸å½“äºä¸€ä¸ªæ‹¥æœ‰ä¸‰ä¸ªRJ45æ¥å£çš„å¸¦æœ‰ç®¡ç†IPçš„äºŒå±‚äº¤æ¢æœºã€‚æˆ‘ä»¬åœ¨switchçš„ç½‘å¡ä¸Šé¢æ¥ä¸Šè·¯ç”±å™¨ï¼Œå¦ä¸€ä¸ªæ¥å£æ¥ä¸Šæˆ‘ä»¬çš„ç”µè„‘ï¼Œç†è®ºä¸Šè¿™æ—¶å€™å°±èƒ½å¤Ÿæ­£å¸¸è·å–è·¯ç”±å™¨é€šè¿‡DHCPä¸‹å‘çš„IPåœ°å€ï¼š ç”µè„‘ç½‘å¡ä½¿ç”¨ç½‘çº¿ç›´æ¥è¿æ¥åˆ°Linuxä¸»æœºä¸Šå·²ç»æ·»åŠ åˆ°ç½‘æ¡¥ä¸­çš„ç½‘å¡ï¼ŒæŸ¥çœ‹çŠ¶æ€å¯ä»¥ç›´æ¥è·å–åˆ°IPv4å’ŒIPv6çš„åœ°å€å¹¶ä¸”èƒ½å¤Ÿæ­£ç¡®è”ç½‘ï¼Œè¿™æ—¶å€™è¯æ˜æ•´ä¸ªè™šæ‹Ÿç½‘æ¡¥è®¾å¤‡æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ã€‚ åŒæ ·çš„æ“ä½œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨KVMè™šæ‹Ÿæœºä¸Šé¢å®ç°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¦‚æœæˆ‘ä»¬ç»™è™šæ‹Ÿæœºç›´æ¥æ·»åŠ å®¿ä¸»æœºç½‘å¡çš„æ¡¥æ¥ç½‘å¡ï¼Œæ˜¯å¯ä»¥å®ç°è™šæ‹Ÿæœºå’Œå®¿ä¸»æœºå¤„åœ¨ç›¸åŒç½‘æ®µçš„æ“ä½œçš„ã€‚ä½†æ˜¯è¿™ä¸ªæ—¶å€™ä¼šå‡ºç°å®¿ä¸»æœºæ²¡åŠæ³•ç›´æ¥å’Œè™šæ‹Ÿæœºè¿›è¡Œé€šä¿¡çš„æƒ…å†µã€‚ è¿™æ—¶å€™å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ï¼Œç„¶åæŠŠå®¿ä¸»æœºçš„ç½‘å¡æ·»åŠ åˆ°è¿™ä¸ªç½‘æ¡¥å†…ï¼Œç„¶åè™šæ‹Ÿæœºçš„ç½‘å¡åˆ›å»ºçš„æ—¶å€™é€‰æ‹©æ¡¥æ¥è¿™ä¸ªè™šæ‹Ÿç½‘æ¡¥å³å¯ã€‚","categories":[{"name":"â€Œvirtualization","slug":"â€Œvirtualization","permalink":"https://tinychen.com/categories/%E2%80%8Cvirtualization/"}],"tags":[{"name":"kvm","slug":"kvm","permalink":"https://tinychen.com/tags/kvm/"}]},{"title":"OpenRestyç¯‡01-å…¥é—¨ç®€ä»‹å’Œå®‰è£…é…ç½®","slug":"20210317-openresty-01-introduction-and-installation","date":"2021-03-17T07:00:00.000Z","updated":"2021-03-17T07:00:00.000Z","comments":true,"path":"20210317-openresty-01-introduction-and-installation/","link":"","permalink":"https://tinychen.com/20210317-openresty-01-introduction-and-installation/","excerpt":"æœ¬æ–‡ä¸»è¦å¯¹openrestyåšå…¥é—¨ç®€ä»‹ä»¥åŠåˆå§‹åŒ–çš„å®‰è£…é…ç½®ä»‹ç»ã€‚","text":"æœ¬æ–‡ä¸»è¦å¯¹openrestyåšå…¥é—¨ç®€ä»‹ä»¥åŠåˆå§‹åŒ–çš„å®‰è£…é…ç½®ä»‹ç»ã€‚ 1ã€OpenRestyç®€ä»‹äº†è§£è¿‡webæœåŠ¡å™¨çš„åŒå­¦è‚¯å®šå¯¹nginxä¸é™Œç”Ÿï¼Œnginxä½œä¸ºç›®å‰å æœ‰ç‡ç¬¬ä¸€çš„webæœåŠ¡å™¨ï¼Œæœ¬èº«ä½œä¸ºé™æ€webæœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å’Œå››å±‚ã€ä¸ƒå±‚è´Ÿè½½å‡è¡¡å™¨éƒ½æœ‰ç€éå¸¸ä¼˜ç§€çš„è¡¨ç°ã€‚ä½†æ˜¯å¯¹äºwebæœåŠ¡å™¨è€Œè¨€ï¼Œnginxçš„å¾ˆå¤šåŠŸèƒ½éƒ½åå‘äºé™æ€webåº”ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„åŠ¨æ€å¤„ç†èƒ½åŠ›æ˜¯æœ‰ä¸€å®šçš„ç¼ºå¤±çš„ã€‚ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œnginxæ— æ³•åœ¨é…ç½®ä¸­ç›´æ¥è¿›è¡Œä¸€ä¸ªæ¡ä»¶ä»¥ä¸Šçš„é€»è¾‘åˆ¤æ–­ï¼Œè¿™å¯¹äºä¸€äº›æ¶æ„è®¾è®¡æ¥è¯´æœ‰ç€è¾ƒå¤§çš„ä¸ä¾¿ã€‚OpenRestyçš„è¯ç”Ÿå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å®˜æ–¹å¯¹äºOpenRestyçš„ä»‹ç»æ˜¯ï¼š OpenRestyÂ® æ˜¯ä¸€ä¸ªåŸºäº Nginx ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚ OpenRestyÂ® é€šè¿‡æ±‡èšå„ç§è®¾è®¡ç²¾è‰¯çš„ Nginx æ¨¡å—ï¼ˆä¸»è¦ç”± OpenResty å›¢é˜Ÿè‡ªä¸»å¼€å‘ï¼‰ï¼Œä»è€Œå°† Nginx æœ‰æ•ˆåœ°å˜æˆä¸€ä¸ªå¼ºå¤§çš„é€šç”¨ Web åº”ç”¨å¹³å°ã€‚è¿™æ ·ï¼ŒWeb å¼€å‘äººå‘˜å’Œç³»ç»Ÿå·¥ç¨‹å¸ˆå¯ä»¥ä½¿ç”¨ Lua è„šæœ¬è¯­è¨€è°ƒåŠ¨ Nginx æ”¯æŒçš„å„ç§ C ä»¥åŠ Lua æ¨¡å—ï¼Œå¿«é€Ÿæ„é€ å‡ºè¶³ä»¥èƒœä»» 10K ä¹ƒè‡³ 1000K ä»¥ä¸Šå•æœºå¹¶å‘è¿æ¥çš„é«˜æ€§èƒ½ Web åº”ç”¨ç³»ç»Ÿã€‚ OpenRestyÂ® çš„ç›®æ ‡æ˜¯è®©ä½ çš„WebæœåŠ¡ç›´æ¥è·‘åœ¨ Nginx æœåŠ¡å†…éƒ¨ï¼Œå……åˆ†åˆ©ç”¨ Nginx çš„éé˜»å¡ I/O æ¨¡å‹ï¼Œä¸ä»…ä»…å¯¹ HTTP å®¢æˆ·ç«¯è¯·æ±‚,ç”šè‡³äºå¯¹è¿œç¨‹åç«¯è¯¸å¦‚ MySQLã€PostgreSQLã€Memcached ä»¥åŠ Redis ç­‰éƒ½è¿›è¡Œä¸€è‡´çš„é«˜æ€§èƒ½å“åº”ã€‚ ä¸ªäººç®€å•çš„ç†è§£å°±æ˜¯OpenResty=nginx+lua+ç¬¬ä¸‰æ–¹åº“ï¼Œäº‹å®ä¸Šnginxæœ¬èº«ä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¯‘çš„æ–¹å¼æ·»åŠ luaçš„æ”¯æŒï¼ŒåŒæ—¶nginxä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¯‘çš„æ–¹å¼æ·»åŠ ç¬¬ä¸‰æ–¹åº“çš„æ”¯æŒï¼ŒOpenRestyåˆ™æ˜¯ç›´æ¥å°†å…¶å…¨éƒ¨æ‰“åŒ…åœ¨ä¸€èµ·ã€‚ä¸”ä¸è®¨è®ºOpenRestyä½œä¸ºå…¨èƒ½å‹webæœåŠ¡å™¨æ˜¯å¦èƒ½å¤Ÿæ»¡è¶³æ‰€æœ‰çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå°±å…¶çªå‡ºçš„åŠ¨æ€å¤„ç†èƒ½åŠ›å°±èƒ½ç»™æˆ‘ä»¬çš„ç³»ç»Ÿæ¶æ„å¸¦æ¥å¾ˆå¤§çš„çµæ´»æ€§å’Œé¢å¤–çš„å¤šæ ·åŒ–å¤„ç†èƒ½åŠ›ã€‚ 2ã€yumå®‰è£…2.1 é…ç½®yumæºopenrestyå®˜ç½‘æœ‰æä¾›å„ç§ä¸»æµLinuxå‘è¡Œç‰ˆçš„é¢„ç¼–è¯‘åŒ…ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œä¸€èˆ¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„å®‰è£…åŒ…è¿›è¡Œå®‰è£…ã€‚ ä¸‹é¢æˆ‘ä»¬ä»¥centosä¸ºä¾‹è¿›è¡Œç¤ºèŒƒï¼š 123456# add the yum repo:wget https://openresty.org/package/centos/openresty.reposudo mv openresty.repo /etc/yum.repos.d/# update the yum index:sudo yum check-update 2.2 rpmåŒ…ä»‹ç»openrestyçš„yumæºä¸­é™¤äº†openrestyæœ¬èº«ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å·¥å…·åŒ…å’Œä¾èµ–åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„rpmåŒ…ï¼Œå¯¹äºè¿™äº›rpmåŒ…çš„è¯¦ç»†å†…å®¹è§£è¯´å¯ä»¥æŸ¥çœ‹å®˜ç½‘çš„æ–‡æ¡£ã€‚ 1sudo yum --disablerepo=&quot;*&quot; --enablerepo=&quot;openresty&quot; list available ä¸‹é¢ç®€å•ä»‹ç»å‡ ä¸ªé‡ç‚¹çš„rpmåŒ…ã€‚ 2.2.1 openrestyè¿™æ˜¯ç”¨äºæ ¸å¿ƒ OpenResty æœåŠ¡çš„ç”Ÿäº§ç‰ˆæœ¬ã€‚ä¹Ÿå°±æ˜¯æ•´ä¸ªopenrestyä¸­æä¾›ä¸»è¦æœåŠ¡çš„æ ¸å¿ƒåŠŸèƒ½æ–‡ä»¶ã€‚åœ¨ä½¿ç”¨rpmåŒ…å®‰è£…çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¸­çš„openrestyæŒ‡ä»¤ä¼šé“¾æ¥åˆ°/usr/bin/openrestyï¼Œè€Œ/usr/bin/openrestyå®é™…ä¸Šæ˜¯/usr/local/openresty/nginx/sbin/nginxçš„è½¯é“¾æ¥ å®é™…ä¸Š/usr/local/openresty/nginx/sbin/nginxæ‰æ˜¯æ•´ä¸ªopenrestyçš„nginxå¯æ‰§è¡Œæ–‡ä»¶çš„æœ¬ä½“ï¼Œæˆ‘ä»¬åŠ ä¸Š-Vå‚æ•°å³å¯æŸ¥çœ‹å®ƒåŒ…æ‹¬ç¼–è¯‘æ¨¡å—åœ¨å†…çš„è¯¦ç»†æƒ…å†µã€‚ä¹‹æ‰€ä»¥è¦å°†å…¶è½¯é“¾æ¥åˆ°/usr/bin/openrestyï¼Œå®˜æ–¹è§£é‡Šæ˜¯ä¸ºäº†é¿å…å’Œæœºå™¨ä¸Šå·²æœ‰çš„nginxå‘ç”Ÿå†²çªã€‚ ä»ä¸Šé¢çš„ç¼–è¯‘å‚æ•°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°openrestyä½¿ç”¨äº†å®ƒä»¬è‡ªå·±ç»´æŠ¤çš„opensslåº“ã€zlibåº“ã€pcreåº“å’ŒLuaJITåº“ï¼Œè¿™æ ·ä¸€æ¥èƒ½å¤Ÿè¾ƒå¥½åœ°æ§åˆ¶å„ä¸ªåº“ä¹‹é—´çš„ç‰ˆæœ¬ä»¥åŠåŠŸèƒ½æ›´æ–°å’ŒåŒæ­¥åè°ƒã€‚ 2.2.2 openresty-restyè¿™ä¸ªåŒ…é‡Œé¢æœ‰ resty å‘½ä»¤è¡Œç¨‹åºï¼Œè¿™ä¸ªå·¥å…·åŒ…ä¸»è¦ä¾èµ–äº resty-cli è¿™ä¸ªé¡¹ç›®ï¼Œè¿™ä¸ªåŒ…ä¾èµ–æ ‡å‡† çš„perl åŒ…ä»¥åŠä¸Šé¢æåˆ°çš„ openresty åŒ…æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚é»˜è®¤æƒ…å†µä¸‹å®ƒæ˜¯æŒ‡å‘/usr/bin/restyç›®å½•çš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”æºæ–‡ä»¶åœ¨/usr/local/openresty/bin/resty ä¸ªäººè®¤ä¸ºè¿™ä¸ªå·¥å…·åŒ…çš„ä¸»è¦ä½œç”¨å°±æ˜¯æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œä¸€äº›ç®€å•çš„å‘½ä»¤è°ƒè¯• 12$ resty -e &#x27;ngx.say(&quot;hello&quot;)&#x27;hello 2.2.3 openresty-docé¡¾åæ€ä¹‰è¿™ä¸ªrpmåŒ…æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯æä¾›æ–‡æ¡£æŸ¥è¯¢ï¼Œä¸€èˆ¬æ¥è¯´éœ€è¦æ³¨æ„ä½¿ç”¨UTF-8ç¼–ç çš„Terminalå³å¯ã€‚å’Œmanå‘½ä»¤æœ‰äº›ç±»ä¼¼ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢openrestyä¸­æŸä¸ªæ¨¡å—çš„ç›¸å…³æ–‡æ¡£ï¼Œåªéœ€è¦ä½¿ç”¨restydocå‘½ä»¤å³å¯ã€‚ 12345678# æˆ‘ä»¬å¯ä»¥ç›´æ¥è¾“å…¥å¯¹åº”çš„æ¨¡å—å‘½æŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£restydoc ngx_luarestydoc ngx_lua_upstreamrestydoc ngx_http_v2_modulerestydoc luajit# ä¹Ÿå¯ä»¥åŠ å…¥-så‚æ•°æŸ¥çœ‹æŸæ¡æŒ‡ä»¤æˆ–æŸä¸ªéƒ¨åˆ†çš„æ–‡æ¡£restydoc -s content_by_luarestydoc -s proxy_pass 2.2.4 openresty-opensslè¿™æ˜¯openrestyå®˜æ–¹ç»´æŠ¤çš„ OpenSSL åº“ã€‚ä¸ºäº†èŠ‚çœå¼€é”€ï¼Œè¿™ä¸ªç‰ˆæœ¬ç¦ç”¨äº†åœ¨æ„å»ºä¸­å¯¹äºå¤šçº¿ç¨‹çš„æ”¯æŒã€‚æ­¤å¤–ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ€é‡è¦çš„æ˜¯OpenRestyå®˜æ–¹åŠ å…¥äº†ä»–ä»¬è‡ªå·±çš„ä¸€äº›è¡¥ä¸åŒ…æ¥æ”¯æŒä¸€äº›opensslçš„æœ€æ–°ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿåšäº†ä¸€äº›ä¼˜åŒ–ä½¿å¾—æ¯”è¾ƒæ—§çš„ç³»ç»Ÿä¹Ÿèƒ½å¤Ÿæ”¯æŒæœ€æ–°ç‰ˆæœ¬çš„opensslã€‚åŒç†ï¼Œä¸ä»…æ˜¯opensslï¼Œopenrestyè‡ªå·±ç»´æŠ¤çš„pcreå’Œzlibåº“ä¹Ÿæ˜¯æœ‰è¿™ç§çš„ç›®çš„ã€‚ å’Œnginxé»˜è®¤çš„rpmç‰ˆæœ¬ä½¿ç”¨çš„è¿˜æ˜¯è¾ƒæ—§/ç¨³å®šçš„opensslç‰ˆæœ¬ç›¸æ¯”ï¼Œopenrestyå¯¹äºopensslç‰ˆæœ¬çš„æ”¯æŒæ— ç–‘æ˜¯æ¯”è¾ƒæ¿€è¿›çš„ã€‚ 2.2.5 å…¶ä»–æ›´å¤šè¯¦ç»†çš„åŒ…ä»‹ç»å¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„è‹±æ–‡æ–‡æ¡£ï¼Œä»‹ç»çš„æ¯”è¾ƒå…¨é¢ï¼Œä¸€èˆ¬æ¥è¯´å°±æ˜¯ä¸»è¦çš„å‡ ä¸ªå·¥å…·è½¯ä»¶å¦‚openrestyã€opensslã€pcreã€zlibç­‰ç­‰çš„ä¸»è¦ç”Ÿäº§ç‰ˆæœ¬ã€debugç‰ˆæœ¬ã€asanç‰ˆæœ¬ã€valgrindç‰ˆæœ¬ç­‰ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚ 2.3 rpmåŒ…å®‰è£…openrestyè™½ç„¶ä¸Šé¢ä»‹ç»äº†å¾ˆå¤šä¸ªopenrestyç›¸å…³çš„åŒ…ï¼Œä½†æ˜¯å®é™…ä¸Šå®‰è£…çš„æ—¶å€™åªéœ€è¦å®‰è£…openrestyï¼Œå…¶ä»–çš„ä¾èµ–å…³ç³»ä¼šç”±yumè‡ªåŠ¨å¤„ç†ã€‚æ³¨æ„openresty-docã€openresty-restyç­‰æ˜¯å¯é€‰å®‰è£…çš„åŒ…ã€‚ 123456789# add the yum repo:wget https://openresty.org/package/centos/openresty.reposudo mv openresty.repo /etc/yum.repos.d/# update the yum index:sudo yum check-update# use yum to installyum install openresty å®‰è£…å®Œæˆä¹‹åä¼šåœ¨é»˜è®¤çš„ç›®å½•è·¯å¾„/usr/local/openresty/nginxä¸‹é¢ç”Ÿæˆå¯¹åº”çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œæˆ‘ä»¬å°†å…¶å’Œyumå®‰è£…çš„nginxå’Œç¼–è¯‘å®‰è£…çš„nginxå¯¹æ¯”å¯ä»¥å‘ç°å‡ ä¹æ˜¯ä¸€è‡´çš„ã€‚ 1234567891011121314151617# ä½¿ç”¨yumå®‰è£…çš„nginx[root@tiny-test nginx]# pwd/etc/nginx[root@tiny-test nginx]# lsconf.d fastcgi_params koi-utf koi-win mime.types modules nginx.conf scgi_params uwsgi_params win-utf# æºç ç¼–è¯‘å®‰è£…çš„nginx[root@tiny-test nginx]# pwd/home/nginx[root@tiny-test nginx]# lsclient_body_temp conf fastcgi_temp html logs sbin scgi_temp uwsgi_temp# ä½¿ç”¨yumå®‰è£…çš„openrestyç›®å½•ä¸‹çš„nginx[root@tiny-test nginx]# pwd/usr/local/openresty/nginx[root@tiny-test nginx]# lsclient_body_temp conf fastcgi_temp html logs proxy_temp sbin scgi_temp uwsgi_temp æˆ‘ä»¬ç®€å•å†™ä¸€ä¸ªnginx.confé…ç½®æ–‡ä»¶ç”¨æ¥æµ‹è¯•å³å¯ï¼Œæ–‡ä»¶ä½¿ç”¨é»˜è®¤è·¯å¾„çš„/usr/local/openresty/nginx/conf/nginx.confã€‚ 1234567891011121314151617181920212223242526272829303132333435[root@tiny-test conf]# openresty -Tnginx: the configuration file /usr/local/openresty/nginx/conf/nginx.conf syntax is oknginx: configuration file /usr/local/openresty/nginx/conf/nginx.conf test is successful# configuration file /usr/local/openresty/nginx/conf/nginx.conf:user root;worker_processes 1;error_log logs/error.log;pid logs/nginx.pid;events &#123; worker_connections 1024;&#125;http &#123; log_format main &#x27;$remote_addr | [$time_local] | $status | $scheme | &#x27; &#x27;$server_name | request= $request | request_uri= $request_uri | http_referer= $http_referer | &#x27; &#x27;UA= $http_user_agent | $request_time | $ssl_protocol | $ssl_cipher | &#x27; &#x27;remote_port= $remote_port | $request_id&#x27;; access_log logs/access.log main; server &#123; listen 8080; location / &#123; default_type text/html; content_by_lua_block &#123; ngx.say(&quot;&lt;p&gt;hello, world&lt;/p&gt;&quot;) &#125; &#125; &#125;&#125; åˆ†åˆ«ä½¿ç”¨curlå’Œæµè§ˆå™¨æµ‹è¯•å‡æ­£å¸¸ 12[root@tiny-test conf]# curl 10.224.192.144:8080&lt;p&gt;hello, world&lt;/p&gt; æ—¥å¿—ä¸­ä¹Ÿèƒ½çœ‹åˆ°å¯¹åº”çš„æ“ä½œ 1234[root@tiny-test conf]# tail -f ../logs/access.log10.224.192.144 | [12/Mar/2021:14:42:25 +0800] | 200 | http | | request= GET / HTTP/1.1 | request_uri= / | http_referer= - | UA= curl/7.29.0 | 0.000 | - | - | remote_port= 34626 | 602882ad9b5cf910bea2f6d13ce4bf5e10.228.18.249 | [12/Mar/2021:14:42:51 +0800] | 200 | http | | request= GET / HTTP/1.1 | request_uri= / | http_referer= - | UA= Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36 | 0.000 | - | - | remote_port= 7148 | 5a91256294bf307ed62f48a06905dbc010.228.18.249 | [12/Mar/2021:14:42:51 +0800] | 200 | http | | request= GET /favicon.ico HTTP/1.1 | request_uri= /favicon.ico | http_referer= http://10.224.192.144:8080/ | UA= Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36 | 0.000 | - | - | remote_port= 7148 | 372e7402db9f396950dae48b66a7e1ce å†æŸ¥çœ‹ç«¯å£ç›‘å¬å’ŒæœåŠ¡è¿›ç¨‹éƒ½æ­£å¸¸ é‚£ä¹ˆå°±å¯ä»¥åŸºæœ¬åˆ¤å®šè¿™æ¬¡çš„å®‰è£…æ˜¯é¡ºåˆ©å®‰è£…æˆåŠŸäº†ã€‚ 3ã€æºç ç¼–è¯‘å®‰è£…å¦‚æœéœ€è¦è¿›è¡Œå®šåˆ¶åŒ–ï¼Œé‚£ä¹ˆä»æºç å¼€å§‹è¿›è¡Œç¼–è¯‘å®‰è£…å°±æ˜¯æˆ‘ä»¬çš„ä¸äºŒä¹‹é€‰ã€‚é¦–å…ˆæˆ‘ä»¬å»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„openrestyæºç åŒ…å¹¶è§£å‹ã€‚ 123cd /homewget https://openresty.org/download/openresty-1.19.3.1.tar.gztar -zxvf openresty-1.19.3.1.tar.gz 3.1 ç¼–è¯‘ç¯å¢ƒ123456[root@tiny-test home]# lsb_release -aLSB Version: :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarchDistributor ID: CentOSDescription: CentOS Linux release 7.9.2009 (Core)Release: 7.9.2009Codename: Core åŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦å‡†å¤‡ç¼–è¯‘ä½¿ç”¨çš„å·¥å…·å¦‚ç¼–è¯‘å™¨ç­‰ï¼Œå¯¹äºCentOS7ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„å®‰è£…æ•´ä¸ªå¼€å‘å·¥å…·åŒ…Development Toolsã€‚ 12yum grouplistyum groupinstall &quot;Development Tools&quot; -y 3.2 å‡†å¤‡opensslã€pcreå’Œzlibå’Œnginxä¸€æ ·ï¼Œæˆ‘ä»¬æ‰‹åŠ¨ä¸‹è½½å‡†å¤‡æœ€æ–°ç‰ˆæœ¬çš„opensslã€pcreå’Œzlibï¼Œæ³¨æ„è¿™ä¸‰ä¸ªåº“åªéœ€è¦ä¸‹è½½è§£å‹ï¼Œå¹¶ä¸éœ€è¦æå‰è¿›è¡Œå®‰è£…ã€‚ 12345678# ä¸‹è½½wget https://www.openssl.org/source/openssl-1.1.1j.tar.gzwget https://ftp.pcre.org/pub/pcre/pcre-8.44.tar.gzwget https://zlib.net/zlib-1.2.11.tar.gz# è§£å‹tar -zxvf openssl-1.1.1j.tar.gztar -zxvf pcre-8.44.tar.gztar -zxvf zlib-1.2.11.tar.gz 3.3 ç¼–è¯‘å®‰è£…å’Œnginxçš„ç¼–è¯‘å®‰è£…ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç¼–è¯‘å®‰è£…çš„æ¨¡å—ï¼Œè¿™é‡Œå¯ä»¥æŸ¥çœ‹openrestyæ¨¡å—çš„å®˜æ–¹è¯´æ˜ã€‚ 12cd /home/openresty-1.19.3.1/./configure --prefix=/home/openresty --with-openssl=/home/openssl-1.1.1j --with-pcre=/home/pcre-8.44 --with-zlib=/home/zlib-1.2.11 --with-http_realip_module --with-http_stub_status_module --with-debug --with-http_ssl_module --with-http_v2_module 12gmake -j8gmake install æœ€ååœ¨å®‰è£…å®Œæˆçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¼šæŠŠç¼–è¯‘çš„openrestyç›®å½•ä¸‹çš„/home/openresty/nginx/sbin/nginxè½¯é“¾æ¥åˆ°/home/openresty/bin/openrestyï¼Œé€»è¾‘å’Œyumå®‰è£…çš„openrestyä¸€æ · å¦‚æœæƒ³è¦æ–¹ä¾¿å…¨å±€æ“ä½œï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ã€‚ 1ln -s /home/openresty/bin/openresty /usr/local/bin/openresty å½“ç„¶è¦æ˜¯è§‰å¾—è¿™æ ·å­çš„ç›®å½•ä¸å¥½æ“ä½œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™å¤šåŠ ä¸€äº›å‚æ•°ï¼Œå°†å¸¸ç”¨çš„ç›®å½•éƒ½æ‰‹åŠ¨æŒ‡å®šï¼Œæ“ä½œèµ·æ¥å°±å’Œnginxå‡ ä¹æ²¡æœ‰å·®åˆ«äº†ï¼Œä¸‹é¢ç®€å•åˆ—ä¸¾ä¸€ä¸ªä¾‹å­ï¼š 1234567891011121314151617181920212223./configure \\--prefix=/home/openresty \\--sbin-path=/home/openresty/bin/nginx \\--conf-path=/home/openresty/conf/nginx.conf \\--http-log-path=/home/openresty/logs/access.log \\--error-log-path=/home/openresty/logs/error.log \\--pid-path=/home/openresty/logs/nginx.pid \\--lock-path=/home/openresty/logs/nginx.lock \\--http-client-body-temp-path=/home/openresty/client_body_temp/ \\--http-proxy-temp-path=/home/openresty/proxy_temp/ \\--http-fastcgi-temp-path=/home/openresty/fastcgi_temp/ \\--http-uwsgi-temp-path=/home/openresty/uwsgi_temp/ \\--http-scgi-temp-path=/home/openresty/scgi_temp/ \\--with-openssl=/home/openssl-1.1.1k \\--with-pcre=/home/pcre-8.44 \\--with-zlib=/home/zlib-1.2.11 \\--with-http_realip_module \\--with-http_stub_status_module \\--with-debug \\--with-http_ssl_module \\--with-http_v2_module \\--build=tinychen-build \\--dry-run 4ã€OpenRestyæ“ä½œopenrestyçš„æ“ä½œæŒ‡ä»¤å’Œnginxæ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚å…·ä½“å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233[root@tiny-test home]# nginx -hnginx version: nginx/1.19.8Usage: nginx [-?hvVtTq] [-s signal] [-p prefix] [-e filename] [-c filename] [-g directives]Options: -?,-h : this help -v : show version and exit -V : show version and configure options then exit -t : test configuration and exit -T : test configuration, dump it and exit -q : suppress non-error messages during configuration testing -s signal : send signal to a master process: stop, quit, reopen, reload -p prefix : set prefix path (default: /etc/nginx/) -e filename : set error log file (default: /var/log/nginx/error.log) -c filename : set configuration file (default: /etc/nginx/nginx.conf) -g directives : set global directives out of configuration file[root@tiny-test home]# openresty -hnginx version: openresty/1.19.3.1Usage: nginx [-?hvVtTq] [-s signal] [-c filename] [-p prefix] [-g directives]Options: -?,-h : this help -v : show version and exit -V : show version and configure options then exit -t : test configuration and exit -T : test configuration, dump it and exit -q : suppress non-error messages during configuration testing -s signal : send signal to a master process: stop, quit, reopen, reload -p prefix : set prefix path (default: /usr/local/openresty/nginx/) -c filename : set configuration file (default: conf/nginx.conf) -g directives : set global directives out of configuration file -h æ‰“å°å¸®åŠ©èœå• -v å°å†™çš„væ˜¯æ‰“å°ç‰ˆæœ¬å¹¶é€€å‡º -V å¤§å†™çš„Væ˜¯æ‰“å°ç¼–è¯‘å‚æ•°å’Œç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º -t å°å†™çš„tæ˜¯æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯å¹¶é€€å‡º -T å¤§å†™çš„Tæ˜¯æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯¯å¹¶ä¸”æ‰“å°å‡ºç”Ÿæ•ˆçš„é…ç½®æ–‡ä»¶å¹¶é€€å‡ºï¼Œå¦‚æœnginx.confé‡Œé¢ä½¿ç”¨äº†includeå‘½ä»¤æ·»åŠ äº†å…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¼šä¸€å¹¶æ‹¼æ¥æ‰“å°å‡ºæ¥ -q åœ¨æµ‹è¯•æœŸé—´ä¸æ‰“å°éé”™è¯¯ä¿¡æ¯ï¼Œé€‚åˆdebugä½¿ç”¨ -s å‘é€ä¿¡å·æ§åˆ¶masterè¿›ç¨‹ï¼Œåˆ†åˆ«ä¸ºstopï¼ˆæš´åŠ›åœæ­¢ï¼‰, quitï¼ˆä¼˜é›…åœæ­¢ï¼‰, reopenï¼ˆé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼‰, reloadï¼ˆä¼˜é›…é‡å¯ï¼‰ -pé€šè¿‡-på‚æ•°æ¥æŒ‡å®šå®é™…çš„å·¥ä½œç›®å½•ï¼Œä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸åŒçš„æµ‹è¯•é¡¹ç›®ï¼Œåˆ™å¯ä»¥é€šè¿‡openresty -p /path/to/appåœ¨å¯åŠ¨çš„æ—¶å€™æŒ‡å®šä¸åŒçš„å·¥ä½œç›®å½•ï¼Œä»è€Œå®ç°å…è®¸å¤šä¸ªä¸åŒçš„ OpenResty åº”ç”¨å…±äº«åŒä¸€ä¸ª OpenResty æœåŠ¡ç¨‹åºçš„æ•ˆæœ -c é€šè¿‡-cå‚æ•°æ¥æŒ‡å®šä¸åŒçš„é…ç½®æ–‡ä»¶è€Œéåªæ˜¯é»˜è®¤è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ -g åœ¨å¯åŠ¨çš„æ—¶å€™è®¾å®šé…ç½®æ–‡ä»¶ä¹‹å¤–çš„å…¨å±€æŒ‡ä»¤ï¼Œä¾‹å¦‚openresty -g &quot;pid /var/run/nginx.pid; worker_processes 8;&quot;","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"},{"name":"openresty","slug":"openresty","permalink":"https://tinychen.com/tags/openresty/"}]},{"title":"nginxç¯‡08-æ·»åŠ å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯","slug":"20210304-nginx-08-ssl-client-certificate","date":"2021-03-04T07:00:00.000Z","updated":"2021-03-04T07:00:00.000Z","comments":true,"path":"20210304-nginx-08-ssl-client-certificate/","link":"","permalink":"https://tinychen.com/20210304-nginx-08-ssl-client-certificate/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ç»™nginxæœåŠ¡æ·»åŠ å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ä»è€Œå®ç°åŒå‘åŠ å¯†ã€‚ å¯¹äºä¸€èˆ¬çš„httpsç½‘ç«™æ¥è¯´ï¼Œå®é™…ä¸Šhttpsæ‰€ä½¿ç”¨çš„è¯ä¹¦æ˜¯å±äºå•å‘éªŒè¯ï¼Œå³å®¢æˆ·ç«¯å•å‘éªŒè¯æœåŠ¡å™¨çš„å®‰å…¨æ€§ï¼Œè€ŒæœåŠ¡å™¨ç«¯æ˜¯æ²¡æœ‰å¯¹å®¢æˆ·ç«¯çš„èº«ä»½è¿›è¡ŒéªŒè¯çš„ã€‚å…³äºhttpsçš„åŸç†ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šã€ŠSSL/TLSã€å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†å’ŒTLSv1.3ã€‹ å¦‚æœè‡ªå·±éƒ¨ç½²äº†ä¸€äº›å®‰å…¨æ€§è¾ƒé«˜çš„ç½‘ç«™ä¸å¸Œæœ›è¢«å…¶ä»–äººéšæ„è®¿é—®ï¼Œå°±å¯ä»¥å°è¯•éƒ¨ç½²httpsçš„åŒå‘è®¤è¯ï¼Œå¯¹å®¢æˆ·ç«¯ä¹Ÿæ·»åŠ è¯ä¹¦è®¤è¯ã€‚æœ¬æ–‡å°†ä¼šä½¿ç”¨opensslè‡ªç­¾è¯ä¹¦æ¥å®Œæˆæœ€ç®€å•çš„ä¸€ä¸ªhttpsåŒå‘è®¤è¯ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ç»™nginxæœåŠ¡æ·»åŠ å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ä»è€Œå®ç°åŒå‘åŠ å¯†ã€‚ å¯¹äºä¸€èˆ¬çš„httpsç½‘ç«™æ¥è¯´ï¼Œå®é™…ä¸Šhttpsæ‰€ä½¿ç”¨çš„è¯ä¹¦æ˜¯å±äºå•å‘éªŒè¯ï¼Œå³å®¢æˆ·ç«¯å•å‘éªŒè¯æœåŠ¡å™¨çš„å®‰å…¨æ€§ï¼Œè€ŒæœåŠ¡å™¨ç«¯æ˜¯æ²¡æœ‰å¯¹å®¢æˆ·ç«¯çš„èº«ä»½è¿›è¡ŒéªŒè¯çš„ã€‚å…³äºhttpsçš„åŸç†ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šã€ŠSSL/TLSã€å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†å’ŒTLSv1.3ã€‹ å¦‚æœè‡ªå·±éƒ¨ç½²äº†ä¸€äº›å®‰å…¨æ€§è¾ƒé«˜çš„ç½‘ç«™ä¸å¸Œæœ›è¢«å…¶ä»–äººéšæ„è®¿é—®ï¼Œå°±å¯ä»¥å°è¯•éƒ¨ç½²httpsçš„åŒå‘è®¤è¯ï¼Œå¯¹å®¢æˆ·ç«¯ä¹Ÿæ·»åŠ è¯ä¹¦è®¤è¯ã€‚æœ¬æ–‡å°†ä¼šä½¿ç”¨opensslè‡ªç­¾è¯ä¹¦æ¥å®Œæˆæœ€ç®€å•çš„ä¸€ä¸ªhttpsåŒå‘è®¤è¯ã€‚ 1ã€opensslè‡ªç­¾è¯ä¹¦åœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç›®å½•ä¸“é—¨ç”¨æ¥å­˜æ”¾è¿™æ¬¡ç”Ÿæˆè¯ä¹¦ç›¸å…³çš„å…¨éƒ¨æ–‡ä»¶ã€‚opensslç”Ÿæˆè‡ªç­¾è¯ä¹¦çš„å‘½ä»¤éå¸¸ç®€å•ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š 12345openssl genrsa -out root.key 1024openssl req -new -out root.csr -key root.keyopenssl x509 -req -in root.csr -out root.crt -signkey root.key -CAcreateserial -days 3650 æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹é€ä¸ªå‘½ä»¤è¿›è¡Œè®²è§£ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªroot.keyæ–‡ä»¶ root.keyæ–‡ä»¶ç”Ÿæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®keyæ–‡ä»¶æ¥ç”Ÿæˆä¸€ä¸ªè®°å½•è¯ä¹¦ä¿¡æ¯çš„csræ–‡ä»¶ç”¨äºç”³è¯·è¯ä¹¦ã€‚csræ–‡ä»¶éœ€è¦è®°å½•ç›¸å…³çš„è¯ä¹¦ç”³è¯·äººçš„åœ°å€å’Œé‚®ä»¶ç­‰ä¿¡æ¯ï¼Œæœ€åè¿˜å¯ä»¥è®¾ç½®ä¸€ä¸ªå¯†ç ï¼Œå½“éœ€è¦ä½¿ç”¨è¿™ä¸ªcsræ–‡ä»¶æ¥ç”³è¯·è¯ä¹¦çš„é€‚åˆå°±éœ€è¦è¾“å…¥è¿™ä¸ªå¯†ç ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ï¼Œå¦‚æœä¸æƒ³è®¾ç½®çš„è¯ç›´æ¥å›è½¦å³å¯è·³è¿‡ ç”Ÿæˆäº†keyå’Œcsræ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±ç”Ÿæˆä¸€ä¸ªcrtçš„è¯ä¹¦æ–‡ä»¶ï¼Œç”±äºè¿™é‡Œæ˜¯æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠæ—¶é—´è®¾å®šä¸º10å¹´ åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å·²ç»ç”Ÿæˆäº†ä¸€ä¸ªå®Œæ•´çš„è‡ªç­¾CAè¯ä¹¦ï¼Œå…¶ä¸­åŒ…å«äº†ç§é’¥keyæ–‡ä»¶ï¼Œè¯ä¹¦ä¿¡æ¯csræ–‡ä»¶å’Œå…¬é’¥crtæ–‡ä»¶ã€‚ 2ã€ç”Ÿæˆp12è¯ä¹¦ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¯ä¹¦æ‰“åŒ…æˆp12æ ¼å¼çš„è¯ä¹¦æ–‡ä»¶ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯çš„ç”µè„‘ä¸Šå¯¼å…¥ã€‚åŒæ ·çš„åœ¨ç”Ÿæˆp12æ–‡ä»¶çš„æ—¶å€™æˆ‘ä»¬æœ€å¥½æ·»åŠ ä¸€ä¸ªå¯†ç ä¿æŠ¤ï¼Œè¿™æ ·å°±ç®—è¯ä¹¦æ³„éœ²äº†ä¹Ÿä¸ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚ 1openssl pkcs12 -export -clcerts -in root.crt -inkey root.key -out root.p12 3ã€é…ç½®nginxæœ€åæˆ‘ä»¬åªéœ€è¦åœ¨nginxä¸­éœ€è¦ä½¿ç”¨åŒå‘è®¤è¯çš„éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹é…ç½®ç„¶åé‡å¯å³å¯ç”Ÿæ•ˆ 1234# å®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦ssl_client_certificate /path/to/root.crt;# å¼€å¯å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯ssl_verify_client on; æœ€åæˆ‘ä»¬åœ¨windowsæˆ–è€…macä¸Šé¢å¯¼å…¥p12æ–‡ä»¶ä¹‹åï¼Œæ‰“å¼€å¯¹åº”çš„ç½‘ç«™å°±ä¼šæœ‰ç›¸åº”çš„æç¤ºäº†ï¼š å¦‚æœä¸è¿›è¡Œè¯ä¹¦éªŒè¯ï¼Œåˆ™æœåŠ¡å™¨ä¼šè¿”å›400é”™è¯¯ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨curlæ¥è¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœä¸å¸¦ä¸Šè¯ä¹¦ï¼Œä¼šç›´æ¥æŠ¥400é”™è¯¯ã€‚ 123456789# curl https://ip.tinychen.com&lt;html&gt;&lt;head&gt;&lt;title&gt;400 No required SSL certificate was sent&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;&lt;center&gt;No required SSL certificate was sent&lt;/center&gt;&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;&lt;/body&gt;&lt;/html&gt; å¸¦ä¸Šè¯ä¹¦ä¹‹ååˆ™è®¿é—®æ­£å¸¸ 12[root@tiny-cloud /home/certs]# curl --cert ./root.crt --key ./root.key https://ip.tinychen.comhello world å¦‚æœæƒ³è¦æŸ¥çœ‹curlçš„è¯¦ç»†è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸Š-vå‚æ•°æ¥æŸ¥çœ‹ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"},{"name":"tls","slug":"tls","permalink":"https://tinychen.com/tags/tls/"}]},{"title":"tomcatå…¥é—¨æŒ‡åŒ—","slug":"20210303-tomcat-start-guide","date":"2021-03-03T07:00:00.000Z","updated":"2021-03-03T07:00:00.000Z","comments":true,"path":"20210303-tomcat-start-guide/","link":"","permalink":"https://tinychen.com/20210303-tomcat-start-guide/","excerpt":"æœ¬æ–‡ä¸»è¦æ˜¯åå‘è¿ç»´è§’åº¦æ¥å¯¹tomcatè¿›è¡Œå…¥é—¨ä»‹ç»ï¼Œé‡ç‚¹è®²è§£äº†tomcatçš„åŸºæœ¬æ¦‚å¿µã€åŸºæœ¬é…ç½®å’Œtomcatçš„I/Oæ¨¡å‹ã€‚æ˜¯ä¹‹å‰çš„tomcatç¯‡çš„æ±‡æ€»æ•´ç†ä¹‹ä½œã€‚","text":"æœ¬æ–‡ä¸»è¦æ˜¯åå‘è¿ç»´è§’åº¦æ¥å¯¹tomcatè¿›è¡Œå…¥é—¨ä»‹ç»ï¼Œé‡ç‚¹è®²è§£äº†tomcatçš„åŸºæœ¬æ¦‚å¿µã€åŸºæœ¬é…ç½®å’Œtomcatçš„I/Oæ¨¡å‹ã€‚æ˜¯ä¹‹å‰çš„tomcatç¯‡çš„æ±‡æ€»æ•´ç†ä¹‹ä½œã€‚ 1ã€Tomcatç®€ä»‹åœ¨äº†è§£tomcatä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›åŸºæœ¬çš„æ¦‚å¿µã€‚ 1.1 webåº”ç”¨æ‰€è°“Webåº”ç”¨ï¼Œå°±æ˜¯æŒ‡éœ€è¦é€šè¿‡ç¼–ç¨‹æ¥åˆ›å»ºçš„Webç«™ç‚¹ã€‚Webåº”ç”¨ä¸­ä¸ä»…åŒ…æ‹¬æ™®é€šçš„é™æ€HTMLæ–‡æ¡£ï¼Œè¿˜åŒ…å«å¤§é‡å¯è¢«WebæœåŠ¡å™¨åŠ¨æ€æ‰§è¡Œçš„ç¨‹åºã€‚ç”¨æˆ·åœ¨Internetä¸Šçœ‹åˆ°çš„èƒ½å¼€å±•ä¸šåŠ¡çš„å„ç§Webç«™ç‚¹éƒ½å¯çœ‹ä½œWebåº”ç”¨ï¼Œä¾‹å¦‚ï¼Œç½‘ä¸Šå•†åº—å’Œç½‘ä¸Šé“¶è¡Œéƒ½æ˜¯Webåº”ç”¨ã€‚æ­¤å¤–ï¼Œå…¬å¸å†…éƒ¨åŸºäºWebçš„Intranetå·¥ä½œå¹³å°ä¹Ÿæ˜¯Webåº”ç”¨ã€‚ Webåº”ç”¨ä¸ä¼ ç»Ÿçš„æ¡Œé¢åº”ç”¨ç¨‹åºç›¸æ¯”ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š ä»¥æµè§ˆå™¨ä½œä¸ºå±•ç¤ºå®¢æˆ·ç«¯ç•Œé¢çš„çª—å£ã€‚ å®¢æˆ·ç«¯ç•Œé¢ä¸€å¾‹è¡¨ç°ä¸ºç½‘é¡µå½¢å¼ï¼Œç½‘é¡µç”±HTMLè¯­è¨€å†™æˆã€‚ å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯èƒ½è¿›è¡Œå’Œä¸šåŠ¡ç›¸å…³çš„åŠ¨æ€äº¤äº’ã€‚ èƒ½å®Œæˆä¸æ¡Œé¢åº”ç”¨ç¨‹åºç±»ä¼¼çš„åŠŸèƒ½ã€‚ ä½¿ç”¨æµè§ˆå™¨â€”æœåŠ¡å™¨æ¶æ„ï¼ˆB/Sï¼‰ï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´é‡‡ç”¨HTTPåè®®é€šä¿¡ã€‚ Webåº”ç”¨é€šè¿‡WebæœåŠ¡å™¨æ¥å‘å¸ƒã€‚ webåº”ç”¨çš„ä¸€å¤§å¥½å¤„å°±æ˜¯å¯ä»¥è½»æ˜“åœ°è·¨å¹³å°è¿è¡Œï¼Œä¸è®ºæ˜¯windowsã€macã€iosã€androidè¿˜æ˜¯linuxï¼Œåªè¦å®‰è£…äº†æµè§ˆå™¨ï¼Œä¸€èˆ¬éƒ½å¯ä»¥ä½¿ç”¨webåº”ç”¨ï¼Œè€Œæµè§ˆå™¨åœ¨å„ä¸ªå¹³å°éƒ½æ˜¯æ ‡é…çš„è½¯ä»¶ï¼Œå› æ­¤ç»™webåº”ç”¨çš„æ™®åŠæä¾›äº†éå¸¸è‰¯å¥½çš„æ¡ä»¶ã€‚åŒæ ·çš„ï¼Œwebåº”ç”¨ä½¿ç”¨çš„æ˜¯B/Sæ¶æ„ï¼Œå³Browser/Serveræ¶æ„ï¼Œä¸»è¦çš„è®¡ç®—ä»»åŠ¡éƒ½äº¤ç»™Serverç«¯è¿›è¡Œï¼Œå› æ­¤éƒ½å®¢æˆ·ç«¯çš„æ€§èƒ½è¦æ±‚è¾ƒä½ï¼ŒåŒæ—¶ä¹Ÿæ¨åŠ¨äº†æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡ã€é«˜å¯ç”¨ç­‰æŠ€æœ¯çš„å‘å±•ã€‚ Contextï¼šåœ¨tomcatä¸­ä¸€èˆ¬æŒ‡webåº”ç”¨ 1.2 ServletServletï¼ˆServer Appletï¼‰ï¼Œå…¨ç§°Java Servletã€‚æ˜¯ç”¨Javaç¼–å†™çš„æœåŠ¡å™¨ç«¯ç¨‹åºã€‚å…¶ä¸»è¦åŠŸèƒ½åœ¨äºäº¤äº’å¼åœ°æµè§ˆå’Œä¿®æ”¹æ•°æ®ï¼Œç”ŸæˆåŠ¨æ€Webå†…å®¹ã€‚ç‹­ä¹‰çš„Servletæ˜¯æŒ‡Javaè¯­è¨€å®ç°çš„ä¸€ä¸ªæ¥å£ï¼Œå¹¿ä¹‰çš„Servletæ˜¯æŒ‡ä»»ä½•å®ç°äº†è¿™ä¸ªServletæ¥å£çš„ç±»åˆ«ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯´çš„Servletä¸ºåè€…ã€‚ Servletè¿è¡Œäºæ”¯æŒJavaçš„åº”ç”¨æœåŠ¡å™¨ä¸­ã€‚ä»å®ç°ä¸Šè®²ï¼ŒServletå¯ä»¥å“åº”ä»»ä½•ç±»å‹çš„è¯·æ±‚ï¼Œä½†ç»å¤§å¤šæ•°æƒ…å†µä¸‹Servletåªç”¨æ¥æ‰©å±•åŸºäºHTTPåè®®çš„WebæœåŠ¡å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´WebæœåŠ¡å™¨å¯ä»¥è®¿é—®ä»»æ„ä¸€ä¸ªWebåº”ç”¨ä¸­æ‰€æœ‰å®ç°Servletæ¥å£çš„ç±»ã€‚è€ŒWebåº”ç”¨ä¸­ç”¨äºè¢«WebæœåŠ¡å™¨åŠ¨æ€è°ƒç”¨çš„ç¨‹åºä»£ç ä½äºServletæ¥å£çš„å®ç°ç±»ä¸­ã€‚æ—¢ç„¶servletå’Œjavaå…³ç³»å¯†åˆ‡ï¼Œé‚£ä¹ˆservletæ¥å£çš„æ ‡å‡†åˆ¶å®šæ¯«æ— ç–‘é—®ä¹Ÿæ˜¯ç”±ç”²éª¨æ–‡å…¬å¸æ¥ä¸»å¯¼ã€‚ Servletè§„èŒƒæŠŠèƒ½å¤Ÿå‘å¸ƒå’Œè¿è¡ŒJava Webåº”ç”¨çš„WebæœåŠ¡å™¨ç§°ä¸ºServletå®¹å™¨ã€‚Servletå®¹å™¨æœ€ä¸»è¦çš„ç‰¹å¾æ˜¯åŠ¨æ€æ‰§è¡ŒJava Webåº”ç”¨ä¸­Servletå®ç°ç±»çš„ç¨‹åºä»£ç ã€‚ç”±Apacheå¼€æºè½¯ä»¶ç»„ç»‡åˆ›å»ºçš„Tomcatæ˜¯ä¸€ä¸ªç¬¦åˆServletè§„èŒƒçš„ä¼˜ç§€Servletå®¹å™¨ã€‚ 1.3 jspJSPï¼ˆå…¨ç§°JavaServer Pagesï¼‰æ˜¯ç”±Sun Microsystemså…¬å¸ä¸»å¯¼å»ºç«‹çš„ä¸€ç§åŠ¨æ€ç½‘é¡µæŠ€æœ¯æ ‡å‡†ã€‚JSPæ˜¯HttpServletçš„æ‰©å±•ã€‚JSPå°†Javaä»£ç å’Œç‰¹å®šå˜åŠ¨å†…å®¹åµŒå…¥åˆ°é™æ€çš„é¡µé¢ä¸­ï¼Œå®ç°ä»¥é™æ€é¡µé¢ä¸ºæ¨¡æ¿ï¼ŒåŠ¨æ€ç”Ÿæˆå…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ã€‚JSPåœ¨é¦–æ¬¡è¢«è®¿é—®çš„æ—¶å€™è¢«åº”ç”¨æœåŠ¡å™¨è½¬æ¢ä¸ºservletï¼Œåœ¨ä»¥åçš„è¿è¡Œä¸­ï¼Œå®¹å™¨ç›´æ¥è°ƒç”¨è¿™ä¸ªservletï¼Œè€Œä¸å†è®¿é—®JSPé¡µé¢ã€‚JSPçš„å®è´¨ä»ç„¶æ˜¯servletã€‚ 1.4 TomcatTomcatæ˜¯åœ¨Oracleå…¬å¸çš„JSWDKï¼ˆJavaServer Web DevelopmentKitï¼Œæ˜¯Oracleå…¬å¸æ¨å‡ºçš„å°å‹Servlet/JSPè°ƒè¯•å·¥å…·ï¼‰çš„åŸºç¡€ä¸Šå‘å±•èµ·æ¥çš„ä¸€ä¸ªä¼˜ç§€çš„Servletå®¹å™¨ï¼ŒTomcatæœ¬èº«å®Œå…¨ç”¨Javaè¯­è¨€ç¼–å†™ã€‚ä½œä¸ºä¸€ä¸ªå¼€æºè½¯ä»¶ï¼ŒTomcaté™¤äº†è¿è¡Œç¨³å®šã€å¯é ï¼Œå¹¶ä¸”æ•ˆç‡é«˜ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å’Œç›®å‰å¤§éƒ¨åˆ†çš„ä¸»æµWebæœåŠ¡å™¨ï¼ˆå¦‚IISã€Apacheã€Nginxç­‰ï¼‰ä¸€èµ·å·¥ä½œã€‚ tomcatçš„ç‰ˆæœ¬å®é™…ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œç›®å‰æœ‰7ã€8ã€9ã€10å››ä¸ªç‰ˆæœ¬å¹¶è¡Œå‘å¸ƒï¼Œå…·ä½“çš„å„ä¸ªç‰ˆæœ¬çš„å…¼å®¹ä¿¡æ¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å®˜ç½‘æŸ¥è¯¢ã€‚ 2ã€Tomcatçš„ç›®å½•ç»“æ„æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹tomcat8.5å’Œtomcat9ä¸­çš„homeç›®å½•ä¸­çš„æ–‡ä»¶ï¼š å¯ä»¥çœ‹åˆ°é™¤æ‰ä¸€äº›è¯´æ˜æ–‡ä»¶ä¹‹åï¼Œè¿˜æœ‰7ä¸ªç›®å½•ï¼š ç›®å½•å ç”¨é€” bin å­˜æ”¾ç”¨äºå¯åŠ¨åŠå…³é—­çš„æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è„šæœ¬ã€‚å…¶ä¸­ï¼ŒUNIX ç³»ç»Ÿä¸“ç”¨çš„ *.sh æ–‡ä»¶åœ¨åŠŸèƒ½ä¸Šç­‰åŒäº windows ç³»ç»Ÿä¸“ç”¨çš„ *.bat æ–‡ä»¶ã€‚å› ä¸º Win32 çš„å‘½ä»¤è¡Œç¼ºä¹æŸäº›åŠŸèƒ½ï¼Œæ‰€ä»¥åˆé¢å¤–åœ°åŠ å…¥äº†ä¸€äº›æ–‡ä»¶ conf é…ç½®æ–‡ä»¶åŠç›¸å…³çš„ DTDï¼ˆdocument type definition æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ŒDTDæ–‡ä»¶ä¸€èˆ¬å’ŒXMLæ–‡ä»¶é…åˆä½¿ç”¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†çº¦æŸXMLæ–‡ä»¶ï¼‰ã€‚å…¶ä¸­æœ€é‡è¦çš„æ–‡ä»¶æ˜¯ server.xmlï¼Œè¿™æ˜¯å®¹å™¨çš„ä¸»é…ç½®æ–‡ä»¶ lib å­˜æ”¾tomcatæœåŠ¡å™¨è‡ªèº«å’Œæ‰€æœ‰çš„webåº”ç”¨éƒ½å¯ä»¥è®¿é—®çš„JARæ–‡ä»¶ logs æ—¥å¿—æ–‡ä»¶çš„é»˜è®¤ç›®å½• temp å­˜æ”¾ä¸´æ—¶æ–‡ä»¶çš„é»˜è®¤ç›®å½• webapps åœ¨tomcatä¸Šå‘å¸ƒJava webåº”ç”¨çš„æ—¶å€™ï¼Œé»˜è®¤æŠŠwebåº”ç”¨çš„æ–‡ä»¶å­˜æ”¾åœ¨è¿™ä¸ªç›®å½• work tomcatçš„å·¥ä½œç›®å½•ï¼ŒtomcatæŠŠè¿è¡Œæ—¶ç”Ÿæˆçš„ä¸€äº›å·¥ä½œæ–‡ä»¶å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ï¼Œå¦‚é»˜è®¤æƒ…å†µä¸‹tomcatä¼šæŠŠç¼–è¯‘JSPç”Ÿæˆçš„Servletç±»æ–‡ä»¶å­˜æ”¾åœ¨è¿™é‡Œ å®é™…ä¸Šé™¤äº†ä¸»ç›®å½•é‡Œæœ‰libç›®å½•ï¼Œåœ¨webappsç›®å½•ä¸‹çš„webåº”ç”¨ä¸­çš„WEB-INFç›®å½•ä¸‹ä¹Ÿå­˜åœ¨ä¸€ä¸ªlibç›®å½•ï¼š ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼š â— Tomcatä¸»ç›®å½•ä¸‹çš„libç›®å½•ï¼šå­˜æ”¾çš„JARæ–‡ä»¶ä¸ä»…èƒ½è¢«Tomcatè®¿é—®ï¼Œè¿˜èƒ½è¢«æ‰€æœ‰åœ¨Tomcatä¸­å‘å¸ƒçš„Java Webåº”ç”¨è®¿é—®â— webappsç›®å½•ä¸‹çš„Java Webåº”ç”¨çš„libç›®å½•ï¼šå­˜æ”¾çš„JARæ–‡ä»¶åªèƒ½è¢«å½“å‰Java Webåº”ç”¨è®¿é—® æ—¢ç„¶æœ‰å¤šä¸ªlibç›®å½•ï¼Œé‚£ä¹ˆè‚¯å®šå°±æœ‰ä½¿ç”¨çš„ä¼˜å…ˆé¡ºåºï¼ŒTomcatç±»åŠ è½½å™¨çš„ç›®å½•åŠ è½½ä¼˜å…ˆé¡ºåºå¦‚ä¸‹ï¼š Tomcatçš„ç±»åŠ è½½å™¨è´Ÿè´£ä¸ºTomcatæœ¬èº«ä»¥åŠJava Webåº”ç”¨åŠ è½½ç›¸å…³çš„ç±»ã€‚å‡å¦‚Tomcatçš„ç±»åŠ è½½å™¨è¦ä¸ºä¸€ä¸ªJava Webåº”ç”¨åŠ è½½ä¸€ä¸ªç±»ï¼Œç±»åŠ è½½å™¨ä¼šæŒ‰ç…§ä»¥ä¸‹ä¼˜å…ˆé¡ºåºåˆ°å„ä¸ªç›®å½•ä¸­å»æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼Œå¦‚æœæ‰€æœ‰ç›®å½•ä¸­éƒ½ä¸å­˜åœ¨è¯¥ç±»çš„.classæ–‡ä»¶ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š åœ¨Java Webåº”ç”¨çš„WEB-INF/classesç›®å½•ä¸‹æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ åœ¨Java Webåº”ç”¨çš„WEB-INF/libç›®å½•ä¸‹çš„JARæ–‡ä»¶ä¸­æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ åœ¨Tomcatçš„libå­ç›®å½•ä¸‹ç›´æ¥æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ åœ¨Tomcatçš„libå­ç›®å½•ä¸‹çš„JARæ–‡ä»¶ä¸­æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ 3ã€Tomcatå®‰è£…é…ç½®tomcatçš„é…ç½®å®‰è£…éœ€è¦å…ˆåœ¨ç³»ç»Ÿä¸Šé…ç½®å¥½jdkç¯å¢ƒï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨centos7.7ç‰ˆæœ¬çš„Linuxç³»ç»Ÿå’Œjdk8ç‰ˆæœ¬ã€‚ 3.1 é…ç½®jdk8æˆ‘ä»¬é¦–å…ˆåˆ°å®˜ç½‘ä¸‹è½½JDK8çš„å®‰è£…åŒ…ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©tar.gzæ ¼å¼çš„å‹ç¼©åŒ…ä¸‹è½½ï¼Œéœ€è¦æ³¨æ„å»ºè®®å…ˆä½¿ç”¨æµè§ˆå™¨ä¸‹è½½å†ä½¿ç”¨å·¥å…·ä¼ è¾“åˆ°Linuxä¸Šï¼Œå› ä¸ºä¸‹è½½éœ€è¦ç™»å½•æ³¨å†Œè´¦å·ã€‚ æ¥ç€æˆ‘ä»¬è§£å‹å°†å®‰è£…åŒ…è§£å‹åˆ°è‡ªå·±æƒ³è¦é…ç½®çš„jdkå®‰è£…ç›®å½•ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨/home/ç›®å½• 1tar -zxvf jdk-8u241-linux-x64.tar.gz -C /home/ åœ¨/etc/profileä¸­æ·»åŠ ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°å¹¶å¯¼å…¥ 1234JAVA_HOME=/home/jdk_1.8.0_241CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/libPATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/binexport JAVA_HOME CLASSPATH PATH é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶ 1source /etc/profile æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Œå¦‚ä¸ç”Ÿæ•ˆå¯ä»¥é‡å¯ç»ˆç«¯è¯•è¯•ï¼š 1234[root@tiny-yun ~]# java -versionjava version &quot;1.8.0_241&quot;Java(TM) SE Runtime Environment (build 1.8.0_241-b07)Java HotSpot(TM) 64-Bit Server VM (build 25.241-b07, mixed mode) 3.2 é…ç½®tomcattomcatçš„å®‰è£…é…ç½®å’Œä¸Šé¢å‡ ä¹ä¸€æ ·ï¼Œç”±äºæˆ‘ä»¬å·²ç»åœ¨/etc/profileä¸­è®¾å®šäº†å…¨å±€çš„javaç¯å¢ƒå˜é‡ï¼Œå› æ­¤åœ¨tomcatä¸­å°±ä¸ç”¨å†ç‰¹æ®Šé…ç½®ï¼Œç›´æ¥å°±ä¼šä½¿ç”¨é»˜è®¤çš„å…¨å±€å˜é‡ã€‚ è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨å®˜ç½‘æä¾›çš„tar.gzå‹ç¼©åŒ…æ¥å®‰è£…ã€‚ 123456# tomcatå¯ä»¥ç›´æ¥ä½¿ç”¨wgetä¸‹è½½wget https://downloads.apache.org/tomcat/tomcat-8/v8.5.53/bin/apache-tomcat-8.5.53.tar.gz# è§£å‹åˆ°å®‰è£…ç›®å½•å¹¶é‡å‘½åtar -zxvf apache-tomcat-8.5.53.tar.gz /home/cd /homemv apache-tomcat-8.5.53 tomcat-8.5.53 é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹tomcatä¸­çš„ä¸»è¦ç›®å½•ï¼š /bin å­˜æ”¾ç”¨äºå¯åŠ¨åŠå…³é—­çš„æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è„šæœ¬ã€‚å…¶ä¸­ï¼ŒUNIX ç³»ç»Ÿä¸“ç”¨çš„ *.sh æ–‡ä»¶åœ¨åŠŸèƒ½ä¸Šç­‰åŒäº Windows ç³»ç»Ÿä¸“ç”¨çš„ *.bat æ–‡ä»¶ã€‚å› ä¸º Win32 çš„å‘½ä»¤è¡Œç¼ºä¹æŸäº›åŠŸèƒ½ï¼Œæ‰€ä»¥åˆé¢å¤–åœ°åŠ å…¥äº†ä¸€äº›æ–‡ä»¶ã€‚ /conf é…ç½®æ–‡ä»¶åŠç›¸å…³çš„ DTDã€‚å…¶ä¸­æœ€é‡è¦çš„æ–‡ä»¶æ˜¯ server.xmlï¼Œè¿™æ˜¯å®¹å™¨çš„ä¸»é…ç½®æ–‡ä»¶ã€‚ /log æ—¥å¿—æ–‡ä»¶çš„é»˜è®¤ç›®å½•ã€‚ /webapps å­˜æ”¾ Web åº”ç”¨çš„ç›¸å…³æ–‡ä»¶ã€‚ æ¥ç€æˆ‘ä»¬è¿›å…¥tomcatç›®å½•ä¸‹çš„binç›®å½•å°±å¯ä»¥çœ‹åˆ°å„ç§å„æ ·çš„è„šæœ¬æ–‡ä»¶ï¼Œä¸»è¦åˆ†ä¸ºbatå’Œshä¸¤ç±»ï¼Œå…¶ä¸­batä¸»è¦æ˜¯åœ¨windowsç³»ç»Ÿä¸Šä½¿ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬åˆ æ‰ï¼Œæ¥ç€æˆ‘ä»¬æ‰§è¡Œä¸€äº›version.shè¿™ä¸ªè„šæœ¬å°±å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å’Œtomcatç›¸å…³çš„å‡ ä¸ªå˜é‡ï¼š JRE_HOME è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°JRE_HOMEè¿™ä¸ªå˜é‡æ˜¯ä¹‹å‰è®¾ç½®äº†çš„JAVA_HOMEç¯å¢ƒå˜é‡ã€‚ å¦‚æœåŒæ—¶å®šä¹‰äº†JRE_HOMEå’ŒJAVA_HOMEè¿™ä¸¤ä¸ªå˜é‡ï¼Œé‚£ä¹ˆä½¿ç”¨çš„æ˜¯JRE_HOME å¦‚æœåªå®šä¹‰äº†JAVA_HOMEï¼Œé‚£ä¹ˆJRE_HOMEå˜é‡å€¼å°±æ˜¯JAVA_HOMEçš„å˜é‡å€¼ å¦‚æœä¸¤ä¸ªå˜é‡éƒ½æ²¡å®šä¹‰ï¼Œé‚£ä¹ˆtomcatæ— æ³•è¿è¡Œ å‰é¢æˆ‘ä»¬æåˆ°è¿‡tomcatæ˜¯ä½¿ç”¨Javaç¼–å†™çš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å®ƒåœ¨è¿è¡Œçš„æ—¶å€™éœ€è¦åˆ›å»ºä¸€ä¸ªJVMè™šæ‹Ÿæœºï¼Œæ‰€ä»¥å¦‚æœæ²¡å®šä¹‰JAVAç¯å¢ƒå˜é‡ï¼Œtomcatæ˜¯æ— æ³•è¿è¡Œçš„ CATALINA_HOME tomcatå®‰è£…ç›®å½•çš„æ ¹ç›®å½• CATALINA_BASE tomcatå®ä¾‹è¿è¡Œçš„ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ç­‰äºCATALINA_HOMEï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ªtomcatå®ä¾‹ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªCATALINA_BASE setenv.sh è¿™ä¸ªè„šæœ¬é»˜è®¤æ˜¯ä¸å­˜åœ¨çš„ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨åˆ›å»ºåœ¨binç›®å½•ä¸‹ï¼Œåœ¨windowsç³»ç»Ÿåˆ™åº”è¯¥æ˜¯setenv.batï¼Œæˆ‘ä»¬åœ¨é‡Œé¢æŒ‡å®šäº†JRE_HOMEç¯å¢ƒå˜é‡ä»¥åŠPIDæ–‡ä»¶çš„ä½ç½®ï¼Œè¿™æ ·åœ¨è¿è¡Œçš„æ—¶å€™å°±èƒ½æ¯”è¾ƒæ–¹ä¾¿çš„å®šä½åˆ°è¿è¡Œè¿›ç¨‹ æ³¨æ„å‰é¢æåˆ°çš„CATALINA_HOMEå’ŒCATALINA_BASEä¸¤ä¸ªå˜é‡ä¸èƒ½åœ¨è¿™é‡Œè®¾å®šï¼Œå› ä¸ºtomcatå°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªå˜é‡æ¥æ‰¾åˆ° setenv.shçš„ã€‚ 123[admin@tiny-yun bin]$ cat setenv.sh JRE_HOME=/home/jdk1.8.0_241/jreCATALINA_PID=&quot;$CATALINA_BASE/tomcat.pid&quot; è¿™æ—¶å€™è¿è¡Œ./catalina.sh startæˆ–è€…æ˜¯./startup.shæ–‡ä»¶å°±å¯ä»¥å¯åŠ¨tomcatï¼Œæ³¨æ„è¦åœ¨é˜²ç«å¢™ä¸­æ”¾è¡Œé»˜è®¤çš„8080ç«¯å£ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šPIDæ–‡ä»¶çš„ä½ç½®ï¼Œåœ¨å…³é—­tomcatçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚æ­¤å¤–ï¼Œä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨rootç”¨æˆ·æ¥è¿è¡Œtomcatã€‚ 3.3 manageråº”ç”¨tomcatæœ¬èº«å†…ç½®äº†ä¸¤ä¸ªwebåº”ç”¨ï¼Œä¸“é—¨ç”¨æ¥ç®¡ç†tomcatï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯host-managerï¼ˆç®¡ç†virtual hostï¼‰å’Œmanagerï¼ˆç®¡ç†webåº”ç”¨ï¼‰ã€‚ 12http://localhost:8080/host-manager/htmlhttp://localhost:8080/manager/html åœ¨å¯åŠ¨tomcatä¹‹åï¼Œæˆ‘ä»¬è®¿é—®ä¸Šé¢çš„è¿™ä¸¤ä¸ªç½‘å€å¯ä»¥å‘ç°è¢«403äº†ã€‚å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ ç›¸å…³çš„ç”¨æˆ·ï¼Œä¸ºäº†ä¿è¯å®‰å…¨ï¼Œè¿™é‡Œçš„ç”¨æˆ·é»˜è®¤éƒ½æ˜¯ç¦ç”¨çš„ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±åˆ›å»ºã€‚ æˆ‘ä»¬ç¼–è¾‘tomcatç›®å½•ä¸‹çš„confå­ç›®å½•ä¸­çš„tomcat-users.xmlï¼Œæ·»åŠ å¯¹åº”çš„é…ç½®å³å¯ï¼š 123456789101112131415161718&lt;!--adminå¯¹åº”çš„æ˜¯host-managerçš„ç”¨æˆ·--&gt;&lt;!--allows access to the HTML GUI--&gt;&lt;role rolename=&quot;admin-gui&quot;/&gt;&lt;!--allows access to the text interface--&gt;&lt;role rolename=&quot;adminâ€script&quot;/&gt;&lt;!--managerå¯¹åº”çš„æ˜¯managerçš„ç”¨æˆ·--&gt;&lt;!--allows access to the HTML GUI and the status pages--&gt;&lt;role rolename=&quot;manager-gui&quot;/&gt;&lt;!--allows access to the text interface and the status pages--&gt;&lt;role rolename=&quot;managerâ€script&quot;/&gt;&lt;!--allows access to the JMX proxy and the status pages--&gt;&lt;role rolename=&quot;manager-jmx&quot;/&gt;&lt;!--allows access to the status pages only--&gt;&lt;role rolename=&quot;manager-status&quot;/&gt;&lt;!--æˆ‘ä»¬è¿™é‡Œæ·»åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åå®šä¹‰è§’è‰²å³å¯--&gt;&lt;user username=&quot;tinychen&quot; password=&quot;tinychen#321&quot; roles=&quot;adminâ€gui,manager-gui&quot;/&gt; Users with the admin-gui role should not be granted the admin-script role. æ³¨æ„è¢«æˆäºˆadmin-guiæƒé™çš„ç”¨æˆ·ä¸åº”è¯¥æˆäºˆadmin-scriptæƒé™ Users with the manager-gui role should not be granted either the manager-script or manager-jmx roles. æ³¨æ„è¢«æˆäºˆmanager-guiæƒé™çš„ç”¨æˆ·ä¸åº”è¯¥æˆäºˆmanager-scriptæˆ–manager-jmxæƒé™ tomcat9ä¸­é»˜è®¤æ˜¯åªå…è®¸éƒ¨ç½²tomcatçš„æœºå™¨è®¿é—®mangerå’Œhost-managerçš„é¡µé¢çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¿®æ”¹tomcatç›®å½•ä¸‹å¯¹åº”çš„webåº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼š 12vim /home/tomcat9/webapps/host-manager/META-INF/context.xml vim /home/tomcat9/webapps/manager/META-INF/context.xml ç„¶åä¿®æ”¹é‡Œé¢é™åˆ¶çš„IPåœ°å€ä¸ºå…¨éƒ¨æˆ–è€…è‡ªå·±çš„IPåœ°å€å³å¯ã€‚ 12345678910&lt;Context antiResourceLocking=&quot;false&quot; privileged=&quot;true&quot; &gt; &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot; allow=&quot;127\\.\\d+\\.\\d+\\.\\d+|::1|0:0:0:0:0:0:0:1&quot; /&gt; &lt;Manager sessionAttributeValueClassNameFilter=&quot;java\\.lang\\.(?:Boolean|Integer|Long|Number|String)|org\\.apache\\.catalina\\.filters\\.CsrfPreventionFilter\\$LruCache(?:\\$1)?|java\\.util\\.(?:Linked)?HashMap&quot;/&gt;&lt;/Context&gt;# å°†allowå‚æ•°æ”¹ä¸º &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot; allow=&quot;^.*$&quot; /&gt; ç„¶åæˆ‘ä»¬å°±å¯ä»¥è®¿é—®webç•Œé¢æ¥æŸ¥çœ‹tomcatæœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€äº†ã€‚ managerçš„webç•Œé¢ host-managerçš„webç•Œé¢ 3.4 Tomcatçš„å®ˆæŠ¤è¿›ç¨‹ï¼ˆjsvcï¼‰åœ¨Windowsä¸Šï¼Œtomcatä¼šé»˜è®¤æ³¨å†Œæˆç³»ç»ŸæœåŠ¡ï¼Œè¿™æ ·è®¾ç½®å¯åŠ¨å’Œè¿è¡Œéƒ½æ–¹ä¾¿å¾ˆå¤šï¼Œè€Œåœ¨Linuxä¸Šï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©jsvcæ¥å®ç°è¿™ä¸€æ•ˆæœã€‚ 3.4.1 ä»€ä¹ˆæ˜¯jsvcCommons Daemonï¼ˆå…±äº«å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼ŒåŸåJSVCï¼Œæ˜¯ä¸€ä¸ªå±äºApacheçš„Commonsé¡¹ç›®çš„Javaåº“ã€‚å®ˆæŠ¤ç¨‹åºæä¾›äº†ä¸€ç§å¯åŠ¨å’Œåœæ­¢æ­£åœ¨è¿è¡ŒæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºçš„Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰çš„ä¾¿æºå¼æ–¹æ³•ã€‚å®ˆæŠ¤ç¨‹åºåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šç”¨Cç¼–å†™çš„æ“ä½œç³»ç»Ÿæ¥å£çš„åŸç”Ÿåº“ ï¼Œä»¥åŠæä¾›ç”¨Javaç¼–å†™çš„Daemon APIçš„åº“ã€‚ æœ‰ä¸¤ç§ä½¿ç”¨Commonså®ˆæŠ¤ç¨‹åºçš„æ–¹æ³•ï¼šç›´æ¥è°ƒç”¨å®ç°å®ˆæŠ¤ç¨‹åºæ¥å£ï¼ˆinterfaceï¼‰æˆ–è°ƒç”¨ä¸ºå®ˆæŠ¤ç¨‹åºæä¾›æ‰€éœ€æ–¹æ³•ï¼ˆmethodï¼‰çš„ç±»ï¼ˆclassï¼‰ã€‚ä¾‹å¦‚ï¼ŒTomcat-4.1.xä½¿ç”¨å®ˆæŠ¤ç¨‹åºæ¥å£ï¼Œè€ŒTomcat-5.0.xæä¾›äº†ä¸€ä¸ªç±»ï¼Œè¯¥ç±»çš„æ–¹æ³•ç›´æ¥ç”±JSVCè°ƒç”¨ã€‚ 3.4.2 jsvcå·¥ä½œåŸç†jsvcä½¿ç”¨äº†ä¸‰ä¸ªè¿›ç¨‹æ¥å·¥ä½œï¼šä¸€ä¸ªå¯åŠ¨è¿›ç¨‹ã€ä¸€ä¸ªæ§åˆ¶è¿›ç¨‹ã€ä¸€ä¸ªè¢«æ§åˆ¶è¿›ç¨‹ã€‚å…¶ä¸­è¢«æ§åˆ¶è¿›ç¨‹ä¸€èˆ¬æ¥è¯´å°±æ˜¯javaä¸»çº¿ç¨‹ï¼ˆæˆ‘ä»¬è¿™é‡Œå°±æ˜¯tomcatï¼‰ï¼Œå¦‚æœJVMè™šæ‹Ÿæœºå´©æºƒäº†ï¼Œé‚£ä¹ˆæ§åˆ¶è¿›ç¨‹ä¼šåœ¨ä¸‹ä¸€åˆ†é’Ÿé‡å¯ã€‚å› ä¸ºjsvcæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œæ‰€ä»¥å®ƒåº”è¯¥ä½¿ç”¨rootç”¨æˆ·æ¥å¯åŠ¨ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨-userå‚æ•°æ¥è¿›è¡Œç”¨æˆ·çš„é™çº§ï¼ˆdowngradeï¼‰ï¼Œå³å…ˆä½¿ç”¨rootç”¨æˆ·æ¥åˆ›å»ºè¿›ç¨‹ï¼Œç„¶åå†é™çº§åˆ°æŒ‡å®šçš„érootç”¨æˆ·è€Œä¸ä¸¢å¤±rootç”¨æˆ·çš„ç‰¹æ®Šæƒé™ï¼Œå¦‚ç›‘å¬1024ä»¥ä¸‹çš„ç«¯å£ã€‚ 3.4.3 jsvcé…ç½®tomcatå®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰tomcatçš„äºŒè¿›åˆ¶å®‰è£…åŒ…ä¸­çš„binç›®å½•ä¸‹å°±æœ‰jsvcçš„å®‰è£…åŒ…ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨GCCç¼–è¯‘å™¨å¯¹å…¶è¿›è¡Œç¼–è¯‘å®‰è£…ã€‚åŒæ—¶åœ¨ç¼–è¯‘çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æŒ‡å®šjdkçš„è·¯å¾„ï¼Œç”±äºæˆ‘ä»¬å‰é¢å·²ç»æ‰‹åŠ¨æŒ‡å®šäº†ï¼Œè¿™é‡Œä¸éœ€è¦å†æŒ‡å®šã€‚å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥ä½¿ç”¨./configure --with-java=$JAVA_HOMEæ¥è¿›è¡Œæ“ä½œã€‚ 1234567891011# é¦–å…ˆæˆ‘ä»¬è¿›å…¥tomcatçš„binç›®å½•è¿›è¡Œç¼–è¯‘cd $CATALINA_HOME/bintar xvfz commons-daemon-native.tar.gzcd commons-daemon-1.2.2-native-src/unix./configuremake# ç¼–è¯‘å®Œæˆåï¼Œä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ç”Ÿæˆä¸€ä¸ªjsvcçš„æ–‡ä»¶ï¼Œå°†å®ƒæ‹·è´åˆ°tomcatçš„/bin/ç›®å½•ä¸‹cp jsvc ../..cd ../..# æ¥ç€æˆ‘ä»¬å¯ä»¥è¿™æ ·æŸ¥çœ‹jsvcçš„å¸®åŠ©æ–‡æ¡£./jsvc -help ä½¿ç”¨jsvcæ¥å¯åŠ¨tomcatï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‚æ•°æ¥è¿›è¡Œå¯åŠ¨ 12345678910./jsvc \\ -user tomcat \\ -classpath $CATALINA_HOME/bin/bootstrap.jar:$CATALINA_HOME/bin/tomcat-juli.jar \\ -outfile $CATALINA_BASE/logs/catalina.out \\ -errfile $CATALINA_BASE/logs/catalina.err \\ -Dcatalina.home=$CATALINA_HOME \\ -Dcatalina.base=$CATALINA_BASE \\ -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \\ -Djava.util.logging.config.file=$CATALINA_BASE/conf/logging.properties \\ org.apache.catalina.startup.Bootstrap æ³¨æ„çœ‹è¿™æ—¶çš„ç”¨æˆ·å’ŒPIDï¼Œä¸Šé¢çš„12839çš„ç”¨æˆ·ä¸ºrootï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„æ§åˆ¶è¿›ç¨‹ï¼Œåé¢è¢«12839è¿›ç¨‹æ§åˆ¶çš„12840è¿›ç¨‹æ‰æ˜¯æˆ‘ä»¬ä¸»è¦è¿è¡Œçš„tomcatè¿›ç¨‹ï¼Œè€Œè¿™é‡Œçš„ç”¨æˆ·ä¹Ÿç¬¦åˆæˆ‘ä»¬ä½¿ç”¨-userå‚æ•°æŒ‡å®šçš„tomcatç”¨æˆ·ã€‚å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šè¿›ç¨‹çš„PIDæ–‡ä»¶ä½ç½®ï¼Œé‚£ä¹ˆé»˜è®¤å°±ä¼šåœ¨/var/runç›®å½•ä¸‹ç”ŸæˆPIDæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªjsvc.pidå¯¹åº”çš„æ­£å¥½æ˜¯jsvcè¿è¡Œçš„ä¸‰ä¸ªè¿›ç¨‹ä¸­çš„è¢«æ§åˆ¶è¿›ç¨‹ã€‚ å¦‚æœéœ€è¦å…³é—­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š 1234./jsvc -stop org.apache.catalina.startup.Bootstrap stop# è¿˜å¯ä»¥æŒ‡å®špidæ–‡ä»¶ä½ç½®ï¼Œå¦‚æœå‰é¢æ²¡æœ‰ä½¿ç”¨é»˜è®¤çš„pidæ–‡ä»¶ç›®å½•çš„è¯./jsvc -stop -pidfile /var/run/jsvc.pid org.apache.catalina.startup.Bootstrap stop è¿™ä¸ªæ—¶å€™å¯èƒ½å°±ä¼šæœ‰åŒå­¦å‘ç°ï¼Œå‰é¢ä¸æ˜¯è¯´jsvcä¸»è¦æœ‰ä¸‰ä¸ªè¿›ç¨‹æ¥å·¥ä½œçš„å—ï¼Œæ€ä¹ˆè¿™é‡Œåªæœ‰ä¸¤ä¸ªè¿›ç¨‹å‘¢ï¼Ÿ æˆ‘ä»¬åœ¨ä¸Šé¢çš„å¯åŠ¨å‘½ä»¤çš„é€‰é¡¹é‡Œé¢åŠ å…¥ä¸€ä¸ª-wait 10çš„å‚æ•°ï¼Œç„¶åå¯åŠ¨ä¹‹åè¿…é€ŸæŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯åŠ¨è¿›ç¨‹åœ¨å¯åŠ¨äº†æ§åˆ¶è¿›ç¨‹ä¹‹åå°±ä¼šç»“æŸï¼Œè€Œå½“æˆ‘ä»¬ä½¿ç”¨äº†-waitå‚æ•°ä¹‹åï¼Œå¯åŠ¨è¿›ç¨‹ä¼šç­‰å¾…è¢«æ§åˆ¶è¿›ç¨‹å¯åŠ¨å¥½äº†ä¹‹åå‘å…¶å‘é€ä¸€ä¸ªâ€I am readyâ€ä¿¡å·ï¼Œå¯åŠ¨è¿›ç¨‹åœ¨æ”¶åˆ°ä¿¡å·ä¹‹åå°±ä¼šç»“æŸã€‚-wait 10è¡¨ç¤ºç­‰å¾…æ—¶é—´ä¸º10ç§’ï¼Œéœ€è¦æ³¨æ„ç­‰å¾…æ—¶é—´è¦æ˜¯10çš„å€æ•°ã€‚ è¿™æ—¶å€™å¯ä»¥çœ‹åˆ°å­˜åœ¨ä¸‰ä¸ªjsvcç›¸å…³çš„è¿›ç¨‹ï¼Œç­‰tomcatå¯åŠ¨å®Œä¹‹åå†æŸ¥çœ‹çš„æ—¶å€™æˆ‘ä»¬å°±ä¼šå‘ç°æœ€ä¸Šé¢çš„19347å·è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯jsvcå¯åŠ¨è¿›ç¨‹æ¶ˆå¤±äº†ã€‚å¹¶ä¸”æ§åˆ¶è¿›ç¨‹19350çš„çˆ¶è¿›ç¨‹å˜æˆäº†1å·è¿›ç¨‹ã€‚ æˆ‘ä»¬å†è¿›ä¸€æ­¥æŸ¥çœ‹ä»¥ä¸‹è¿›ç¨‹çš„å…³ç³»ï¼š æ¥ç€æˆ‘ä»¬å†æ¥æŸ¥çœ‹ä¸€ä¸‹1å·è¿›ç¨‹ã€‚å¯ä»¥å‘ç°ï¼Œåœ¨centos7ä¸­çš„1å·è¿›ç¨‹æ˜¯systemdã€‚ æ¥ç€æˆ‘ä»¬å¯ä»¥æ€»ç»“ä»¥ä¸Šçš„æ•´ä¸ªè¿‡ç¨‹ä¸ºä¸‹åˆ—æ­¥éª¤ï¼š ç³»ç»Ÿå¯åŠ¨ï¼Œ0å·è¿›ç¨‹å¯åŠ¨ï¼Œ0å·é€šè¿‡fork()ç”Ÿæˆ1å·è¿›ç¨‹systemdï¼› 1å·è¿›ç¨‹systemdé€šè¿‡fork()åˆ›å»ºè¿›ç¨‹sshdï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„sshæœåŠ¡çš„è¿›ç¨‹ï¼› ç”¨æˆ·ä½¿ç”¨sshè¿œç¨‹ç™»å½•ç³»ç»Ÿï¼Œsshdè¿›ç¨‹åˆ›å»ºäº†å¯¹åº”çš„ç»ˆç«¯è¿›ç¨‹ptsï¼› ç”¨æˆ·åœ¨ç»ˆç«¯è¾“å…¥æŒ‡ä»¤ï¼Œptsæ ¹æ®ç³»ç»Ÿä¸­æŒ‡å®šçš„è¯¥ç”¨æˆ·ä½¿ç”¨çš„shellï¼ˆæ­¤å¤„ä¸ºbash shellï¼‰æ¥æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼Œè¿™é‡Œå…·ä½“è¡¨ç°ä¸ºæ ¹æ®æˆ‘ä»¬è¾“å…¥çš„æŒ‡ä»¤æ¥åˆ›å»ºjsvcçš„å¯åŠ¨è¿›ç¨‹ï¼› jsvcå¯åŠ¨è¿›ç¨‹åˆ›å»ºjsvcæ§åˆ¶è¿›ç¨‹ï¼Œå¹¶æ ¹æ®å¯åŠ¨å‚æ•°å†³å®šæ˜¯å¦åœ¨ç­‰å¾…jsvcæ§åˆ¶è¿›ç¨‹çš„â€I am readyâ€ä¿¡å·å†ç»“æŸï¼ŒåŒæ—¶jsvcå¯åŠ¨è¿›ç¨‹åœ¨ç»“æŸä¹‹å‰ä¼šæŠŠjsvcæ§åˆ¶è¿›ç¨‹äº¤ç»™1å·è¿›ç¨‹systemdæ¥ç®¡ç†æ§åˆ¶ï¼› jsvcæ§åˆ¶è¿›ç¨‹åˆ›å»ºjsvcè¢«æ§åˆ¶è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ä¸»è¦è¿›ç¨‹tomcatï¼ŒåŒæ—¶jsvcæ§åˆ¶è¿›ç¨‹ä¼šç›‘è§†jsvcè¢«æ§åˆ¶è¿›ç¨‹ï¼Œå¦‚æœå®ƒå´©æºƒäº†ï¼Œjsvcæ§åˆ¶è¿›ç¨‹åˆ™ä¼šé‡å¯ï¼Œç¡®ä¿å…¶æ­£å¸¸è¿è¡Œï¼› è¿™é‡Œä½¿ç”¨jsvcæ¥å¯åŠ¨tomcatçš„å¥½å¤„å°±æ˜¯å¯åŠ¨å®Œæˆäº†ä¹‹åå³ä½¿æˆ‘ä»¬çš„shellç»ˆç«¯å…³é—­äº†ä¹Ÿä¸ä¼šå½±å“å®ƒçš„è¿è¡Œï¼Œå½“ç„¶å¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨tomcatçš„binç›®å½•ä¸‹çš„å¯åŠ¨è„šæœ¬æ¥è¿›è¡Œå¯åŠ¨ç„¶åå†é€å…¥åå°è¿è¡Œä¹Ÿæ˜¯å¯ä»¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœã€‚å®é™…ä¸Šæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç¼–å†™systemdçš„unitå•å…ƒé…ç½®æ–‡ä»¶ï¼Œå°†tomcatæ³¨å†Œæˆç³»ç»ŸæœåŠ¡ã€‚ 3.4.4 daemon.shåŒæ ·çš„ï¼Œåœ¨tomcatçš„binç›®å½•ä¸‹ï¼Œé›†æˆäº†ä¸€ä¸ªdaemon.shçš„è„šæœ¬ï¼Œç”¨æ¥è°ƒç”¨jsvcä»è€Œå®ç°tomcatçš„å®ˆæŠ¤è¿›ç¨‹ã€‚daemon.shçš„å®ç°åŸç†è¿˜æ˜¯jsvcï¼Œåªä¸è¿‡åœ¨è„šæœ¬ä¸­åŠ å…¥äº†å¤§é‡çš„å˜é‡åˆ¤æ–­å’Œç¯å¢ƒé…ç½®æ–‡ä»¶è¯»å–ç­‰æ“ä½œ åœ¨å®˜ç½‘ä¸Šä¼šå»ºè®®æˆ‘ä»¬ç›´æ¥æŠŠdaemon.shè„šæœ¬å¤åˆ¶åˆ° /etc/init.d ç›®å½•ä¸‹ï¼Œå°±å¯ä»¥å®ç°å¼€æœºè‡ªåŠ¨å¯åŠ¨äº†ã€‚ä¸è¿‡åœ¨CentOS7ç­‰ä½¿ç”¨äº†systemdçš„ç³»ç»Ÿä¸Šï¼Œæˆ‘ä¸ªäººæ›´æ¨èä½¿ç”¨systemdæ¥ç®¡ç†ã€‚ 3.5 Tomcatçš„å®ˆæŠ¤è¿›ç¨‹ï¼ˆsystemd+jsvcï¼‰ è¿™é‡Œå…ˆæ”¾ä¸Šarchwikiå’Œfedoraprojectå®˜ç½‘ä¸Šé¢çš„é“¾æ¥ä½œä¸ºå‚è€ƒèµ„æ–™ï¼š https://wiki.archlinux.org/index.php/Systemd https://docs.fedoraproject.org/en-US/quick-docs/understanding-and-administering-systemd/index.html 3.5.1 systemdç®€ä»‹systemd æ˜¯ Linux ä¸‹ä¸€ä¸ªä¸ SysV å’Œ LSB åˆå§‹åŒ–è„šæœ¬å…¼å®¹çš„ç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨ï¼Œæ˜¯ Linux ç³»ç»Ÿä¸­æœ€æ–°çš„åˆå§‹åŒ–ç³»ç»Ÿï¼ˆinitï¼‰ï¼Œå®ƒä¸»è¦çš„è®¾è®¡ç›®æ ‡æ˜¯å…‹æœ sysvinit å›ºæœ‰çš„ç¼ºç‚¹ï¼Œæé«˜ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦ã€‚systemd å’Œ ubuntu çš„ upstart æ˜¯ç«äº‰å¯¹æ‰‹ï¼Œä¸è¿‡ç°åœ¨ubuntuä¹Ÿä½¿ç”¨äº†systemdã€‚ systemd ä½¿ç”¨ socket å’Œ D-Bus æ¥å¼€å¯æœåŠ¡ï¼Œæä¾›åŸºäºå®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰çš„æŒ‰éœ€å¯åŠ¨ç­–ç•¥ï¼Œä¿ç•™äº† Linux cgroups çš„è¿›ç¨‹è¿½è¸ªåŠŸèƒ½ï¼Œæ”¯æŒå¿«ç…§å’Œç³»ç»ŸçŠ¶æ€æ¢å¤ï¼Œç»´æŠ¤æŒ‚è½½å’Œè‡ªæŒ‚è½½ç‚¹ï¼Œå®ç°äº†å„æœåŠ¡é—´åŸºäºä»å±å…³ç³»çš„ä¸€ä¸ªæ›´ä¸ºç²¾ç»†çš„é€»è¾‘æ§åˆ¶ï¼Œæ‹¥æœ‰å‰å«çš„å¹¶è¡Œæ€§èƒ½ã€‚systemd æ— éœ€ç»è¿‡ä»»ä½•ä¿®æ”¹ä¾¿å¯ä»¥æ›¿ä»£ sysvinit ã€‚ systemd å¼€å¯å’Œç›‘ç£æ•´ä¸ªç³»ç»Ÿæ˜¯åŸºäº unit çš„æ¦‚å¿µã€‚unit æ˜¯ç”±ä¸€ä¸ªä¸é…ç½®æ–‡ä»¶å¯¹åº”çš„åå­—å’Œç±»å‹ç»„æˆçš„(ä¾‹å¦‚ï¼šavahi.service unit æœ‰ä¸€ä¸ªå…·æœ‰ç›¸åŒåå­—çš„é…ç½®æ–‡ä»¶ï¼Œæ˜¯å®ˆæŠ¤è¿›ç¨‹ Avahi çš„ä¸€ä¸ªå°è£…å•å…ƒ)ã€‚ä¸€ä¸ªunitå•å…ƒé…ç½®æ–‡ä»¶å¯ä»¥æè¿°çš„å†…å®¹æœ‰ï¼šç³»ç»ŸæœåŠ¡ï¼ˆ.serviceï¼‰ã€æŒ‚è½½ç‚¹ï¼ˆ.mountï¼‰ã€socketsï¼ˆ.socketsï¼‰ ã€ç³»ç»Ÿè®¾å¤‡ï¼ˆ.deviceï¼‰ã€äº¤æ¢åˆ†åŒºï¼ˆ.swapï¼‰ã€æ–‡ä»¶è·¯å¾„ï¼ˆ.pathï¼‰ã€å¯åŠ¨ç›®æ ‡ï¼ˆ.targetï¼‰ã€ç”± systemd ç®¡ç†çš„è®¡æ—¶å™¨ï¼ˆ.timerï¼‰ã€‚ service ï¼šå®ˆæŠ¤è¿›ç¨‹çš„å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’Œé‡è½½æ˜¯æ­¤ç±» unit ä¸­æœ€ä¸ºæ˜æ˜¾çš„å‡ ä¸ªç±»å‹ã€‚ socket ï¼šæ­¤ç±» unit å°è£…ç³»ç»Ÿå’Œäº’è”ç½‘ä¸­çš„ä¸€ä¸ª socket ã€‚å½“ä¸‹ï¼Œsystemd æ”¯æŒæµå¼ã€æ•°æ®æŠ¥å’Œè¿ç»­åŒ…çš„ AF_INETã€AF_INET6ã€AF_UNIX socket ã€‚ä¹Ÿæ”¯æŒä¼ ç»Ÿçš„ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ ä¼ è¾“æ¨¡å¼ã€‚æ¯ä¸€ä¸ª socket unit éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„æœåŠ¡ unit ã€‚ç›¸åº”çš„æœåŠ¡åœ¨ç¬¬ä¸€ä¸ªè¿æ¥ï¼ˆconnectionï¼‰è¿›å…¥ socket æˆ– FIFO æ—¶å°±ä¼šå¯åŠ¨(ä¾‹å¦‚ï¼šnscd.socket åœ¨æœ‰æ–°è¿æ¥åä¾¿å¯åŠ¨ nscd.service)ã€‚ device ï¼šæ­¤ç±» unit å°è£…ä¸€ä¸ªå­˜åœ¨äº Linux è®¾å¤‡æ ‘ä¸­çš„è®¾å¤‡ã€‚æ¯ä¸€ä¸ªä½¿ç”¨ udev è§„åˆ™æ ‡è®°çš„è®¾å¤‡éƒ½å°†ä¼šåœ¨ systemd ä¸­ä½œä¸ºä¸€ä¸ªè®¾å¤‡ unit å‡ºç°ã€‚udev çš„å±æ€§è®¾ç½®å¯ä»¥ä½œä¸ºé…ç½®è®¾å¤‡ unit ä¾èµ–å…³ç³»çš„é…ç½®æºã€‚ mount ï¼šæ­¤ç±» unit å°è£…ç³»ç»Ÿç»“æ„å±‚æ¬¡ä¸­çš„ä¸€ä¸ªæŒ‚è½½ç‚¹ã€‚ automount ï¼šæ­¤ç±» unit å°è£…ç³»ç»Ÿç»“æ„å±‚æ¬¡ä¸­çš„ä¸€ä¸ªè‡ªæŒ‚è½½ç‚¹ã€‚æ¯ä¸€ä¸ªè‡ªæŒ‚è½½ unit å¯¹åº”ä¸€ä¸ªå·²æŒ‚è½½çš„æŒ‚è½½ unit (éœ€è¦åœ¨è‡ªæŒ‚è½½ç›®å½•å¯ä»¥å­˜å–çš„æƒ…å†µä¸‹å°½æ—©æŒ‚è½½)ã€‚ target ï¼šæ­¤ç±» unit ä¸ºå…¶ä»– unit è¿›è¡Œé€»è¾‘åˆ†ç»„ã€‚å®ƒä»¬æœ¬èº«å®é™…ä¸Šå¹¶ä¸åšä»€ä¹ˆï¼Œåªæ˜¯å¼•ç”¨å…¶ä»– unit è€Œå·²ã€‚è¿™æ ·ä¾¿å¯ä»¥å¯¹ unit åšä¸€ä¸ªç»Ÿä¸€çš„æ§åˆ¶ã€‚(ä¾‹å¦‚ï¼šmulti-user.target ç›¸å½“äºåœ¨ä¼ ç»Ÿä½¿ç”¨ SysV çš„ç³»ç»Ÿä¸­è¿è¡Œçº§åˆ«5ï¼Œå³GUIå›¾å½¢åŒ–ç•Œé¢)ï¼›bluetooth.target åªæœ‰åœ¨è“ç‰™é€‚é…å™¨å¯ç”¨çš„æƒ…å†µä¸‹æ‰è°ƒç”¨ä¸è“ç‰™ç›¸å…³çš„æœåŠ¡ï¼Œå¦‚ï¼šbluetooth å®ˆæŠ¤è¿›ç¨‹ã€obex å®ˆæŠ¤è¿›ç¨‹ç­‰ï¼‰ snapshot ï¼šä¸ target unit ç›¸ä¼¼ï¼Œå¿«ç…§æœ¬èº«ä¸åšä»€ä¹ˆï¼Œå”¯ä¸€çš„ç›®çš„å°±æ˜¯å¼•ç”¨å…¶ä»– unit ã€‚ systemdçš„unitæ–‡ä»¶å¯ä»¥ä»å¤šä¸ªåœ°æ–¹åŠ è½½ï¼Œä½¿ç”¨systemctl show --property=UnitPath å¯ä»¥æŒ‰ä¼˜å…ˆçº§ä»ä½åˆ°é«˜æ˜¾ç¤ºåŠ è½½ç›®å½•ã€‚ ä¸»è¦çš„unitæ–‡ä»¶åœ¨ä¸‹é¢çš„ä¸¤ä¸ªç›®å½•ä¸­ï¼š /usr/lib/systemd/system/ ï¼šè½¯ä»¶åŒ…å®‰è£…çš„å•å…ƒ /etc/systemd/system/ ï¼šç³»ç»Ÿç®¡ç†å‘˜å®‰è£…çš„å•å…ƒ 3.5.2 systemdåŸç†è¿™é‡Œæˆ‘ä»¬é‡ç‚¹åˆ†æä¸€ä¸‹systemdçš„å¹¶è¡Œæ“ä½œæ€§èƒ½ä»¥åŠserviceæœåŠ¡çš„é…ç½®å•å…ƒã€‚ å’Œå‰ä»»çš„sysvinitçš„å®Œå…¨ä¸²è¡Œç›¸æ¯”ï¼Œsystemdä¸ºäº†åŠ é€Ÿæ•´ä¸ªç³»ç»Ÿå¯åŠ¨ï¼Œå®ç°äº†å‡ ä¹æ‰€æœ‰çš„è¿›ç¨‹éƒ½å¹¶è¡Œå¯åŠ¨ï¼ˆåŒ…æ‹¬éœ€è¦ä¸Šä¸‹è¿›ç¨‹ä¾èµ–çš„è¿›ç¨‹ä¹Ÿå¹¶è¡Œå¯åŠ¨ï¼‰ã€‚æƒ³è¦å®ç°è¿™ä¸€ç‚¹ï¼Œä¸»è¦éœ€è¦è§£å†³ä¸‰ä¸ªæ–¹é¢çš„ä¾èµ–é—®é¢˜ï¼šsocketã€D-Buså’Œæ–‡ä»¶ç³»ç»Ÿã€‚ 3.5.2.1 socket ä¾èµ–(inetd)ç»å¤§å¤šæ•°çš„æœåŠ¡ä¾èµ–æ˜¯å¥—æ¥å­—ä¾èµ–ã€‚æ¯”å¦‚æœåŠ¡ A é€šè¿‡ä¸€ä¸ªå¥—æ¥å­—ç«¯å£ S1 æä¾›è‡ªå·±çš„æœåŠ¡ï¼Œå…¶ä»–çš„æœåŠ¡å¦‚æœéœ€è¦æœåŠ¡ Aï¼Œåˆ™éœ€è¦è¿æ¥ S1ã€‚å› æ­¤å¦‚æœæœåŠ¡ A å°šæœªå¯åŠ¨ï¼ŒS1 å°±ä¸å­˜åœ¨ï¼Œå…¶ä»–çš„æœåŠ¡å°±ä¼šå¾—åˆ°å¯åŠ¨é”™è¯¯ã€‚ æ‰€ä»¥ä¼ ç»Ÿåœ°ï¼Œäººä»¬éœ€è¦å…ˆå¯åŠ¨æœåŠ¡ Aï¼Œç­‰å¾…å®ƒè¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå†å¯åŠ¨å…¶ä»–éœ€è¦å®ƒçš„æœåŠ¡ã€‚ systemd è®¤ä¸ºï¼Œåªè¦æˆ‘ä»¬é¢„å…ˆæŠŠå¥—æ¥å­—ç«¯å£S1å»ºç«‹å¥½ï¼Œé‚£ä¹ˆå…¶ä»–æ‰€æœ‰çš„æœåŠ¡å°±å¯ä»¥åŒæ—¶å¯åŠ¨è€Œæ— éœ€ç­‰å¾…æœåŠ¡ Aæ¥åˆ›å»ºå¥—æ¥å­—ç«¯å£S1äº†ã€‚å¦‚æœæœåŠ¡ A å°šæœªå¯åŠ¨ï¼Œé‚£ä¹ˆå…¶ä»–è¿›ç¨‹å‘å¥—æ¥å­—ç«¯å£S1å‘é€çš„æœåŠ¡è¯·æ±‚å®é™…ä¸Šä¼šè¢« Linux æ“ä½œç³»ç»Ÿç¼“å­˜ï¼Œå…¶ä»–è¿›ç¨‹ä¼šåœ¨è¿™ä¸ªè¯·æ±‚çš„åœ°æ–¹ç­‰å¾…ï¼ˆè¿™é‡Œä½¿ç”¨FIFOæ–¹å¼ï¼‰ã€‚ä¸€æ—¦æœåŠ¡Aå¯åŠ¨å°±ç»ªï¼Œå°±å¯ä»¥ç«‹å³å¤„ç†ç¼“å­˜çš„è¯·æ±‚ï¼Œä¸€åˆ‡éƒ½å¼€å§‹æ­£å¸¸è¿è¡Œã€‚ é‚£ä¹ˆæœåŠ¡å¦‚ä½•ä½¿ç”¨ç”± init è¿›ç¨‹åˆ›å»ºçš„å¥—æ¥å­—å‘¢ï¼Ÿ Linux æ“ä½œç³»ç»Ÿæœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå½“è¿›ç¨‹è°ƒç”¨forkæˆ–è€…execåˆ›å»ºå­è¿›ç¨‹ä¹‹åï¼Œæ‰€æœ‰åœ¨çˆ¶è¿›ç¨‹ä¸­è¢«æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ (file descriptor) éƒ½è¢«å­è¿›ç¨‹æ‰€ç»§æ‰¿ã€‚å¥—æ¥å­—ä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶å¥æŸ„ï¼Œè¿›ç¨‹Aå¯ä»¥åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œæ­¤åå½“è¿›ç¨‹ Aè°ƒç”¨ exec å¯åŠ¨ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹æ—¶ï¼Œåªè¦ç¡®ä¿è¯¥å¥—æ¥å­—çš„close_on_execæ ‡å¿—ä½è¢«æ¸…ç©ºï¼Œé‚£ä¹ˆæ–°çš„å­è¿›ç¨‹å°±å¯ä»¥ç»§æ‰¿è¿™ä¸ªå¥—æ¥å­—ã€‚å­è¿›ç¨‹çœ‹åˆ°çš„å¥—æ¥å­—å’Œçˆ¶è¿›ç¨‹åˆ›å»ºçš„å¥—æ¥å­—æ˜¯åŒä¸€ä¸ªç³»ç»Ÿå¥—æ¥å­—ï¼Œå°±ä»¿ä½›è¿™ä¸ªå¥—æ¥å­—æ˜¯å­è¿›ç¨‹è‡ªå·±åˆ›å»ºçš„ä¸€æ ·ï¼Œæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ è¿™ä¸ªç‰¹æ€§ä»¥å‰è¢«ä¸€ä¸ªå«åšinetdçš„ç³»ç»ŸæœåŠ¡æ‰€åˆ©ç”¨ã€‚Inetdè¿›ç¨‹ä¼šè´Ÿè´£ç›‘æ§ä¸€äº›å¸¸ç”¨å¥—æ¥å­—ç«¯å£ï¼Œæ¯”å¦‚ sshï¼Œå½“è¯¥ç«¯å£æœ‰è¿æ¥è¯·æ±‚æ—¶ï¼Œinetdæ‰å¯åŠ¨telnetdè¿›ç¨‹ï¼Œå¹¶æŠŠæœ‰è¿æ¥çš„å¥—æ¥å­—ä¼ é€’ç»™æ–°çš„telnetdè¿›ç¨‹è¿›è¡Œå¤„ç†ã€‚è¿™æ ·ï¼Œå½“ç³»ç»Ÿæ²¡æœ‰ ssh å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œå°±ä¸éœ€è¦å¯åŠ¨ sshd è¿›ç¨‹ã€‚Inetd å¯ä»¥ä»£ç†å¾ˆå¤šçš„ç½‘ç»œæœåŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥èŠ‚çº¦å¾ˆå¤šçš„ç³»ç»Ÿè´Ÿè½½å’Œå†…å­˜èµ„æºï¼Œåªæœ‰å½“æœ‰çœŸæ­£çš„è¿æ¥è¯·æ±‚æ—¶æ‰å¯åŠ¨ç›¸åº”æœåŠ¡ï¼Œå¹¶æŠŠå¥—æ¥å­—ä¼ é€’ç»™ç›¸åº”çš„æœåŠ¡è¿›ç¨‹ã€‚ å’Œ inetd ç±»ä¼¼ï¼Œsystemd(1å·è¿›ç¨‹)æ˜¯æ‰€æœ‰å…¶ä»–è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œå®ƒå¯ä»¥å…ˆå»ºç«‹æ‰€æœ‰éœ€è¦çš„å¥—æ¥å­—ï¼Œç„¶ååœ¨è°ƒç”¨ exec çš„æ—¶å€™å°†è¯¥å¥—æ¥å­—ä¼ é€’ç»™æ–°çš„æœåŠ¡è¿›ç¨‹ï¼Œè€Œæ–°è¿›ç¨‹ç›´æ¥ä½¿ç”¨è¯¥å¥—æ¥å­—è¿›è¡ŒæœåŠ¡å³å¯ã€‚ 3.5.2.2 D-Bus ä¾èµ–(bus activation)D-Bus æ˜¯ desktop-bus çš„ç®€ç§°ï¼Œæ˜¯ä¸€ä¸ªä½å»¶è¿Ÿã€ä½å¼€é”€ã€é«˜å¯ç”¨æ€§çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚å®ƒè¶Šæ¥è¶Šå¤šåœ°ç”¨äºåº”ç”¨ç¨‹åºä¹‹é—´é€šä¿¡ï¼Œä¹Ÿç”¨äºåº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¹‹é—´çš„é€šä¿¡ã€‚å¾ˆå¤šç°ä»£çš„æœåŠ¡è¿›ç¨‹éƒ½ä½¿ç”¨D-Bus å–ä»£å¥—æ¥å­—ä½œä¸ºè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚ Linuxçš„ NetworkManager æœåŠ¡å°±ä½¿ç”¨ D-Bus å’Œå…¶ä»–çš„åº”ç”¨ç¨‹åºæˆ–è€…æœåŠ¡è¿›è¡Œäº¤äº’ï¼šLinuxä¸Šå¸¸è§çš„é‚®ä»¶å®¢æˆ·ç«¯è½¯ä»¶ evolution å¯ä»¥é€šè¿‡ D-Bus ä» NetworkManager æœåŠ¡è·å–ç½‘ç»œçŠ¶æ€çš„æ”¹å˜ï¼Œä»¥ä¾¿åšå‡ºç›¸åº”çš„å¤„ç†ã€‚ D-Bus æ”¯æŒæ‰€è°“&quot;bus activation&quot;åŠŸèƒ½ã€‚å¦‚æœæœåŠ¡ A éœ€è¦ä½¿ç”¨æœåŠ¡ B çš„ D-Bus æœåŠ¡ï¼Œè€ŒæœåŠ¡ B å¹¶æ²¡æœ‰è¿è¡Œï¼Œåˆ™ D-Bus å¯ä»¥åœ¨æœåŠ¡ A è¯·æ±‚æœåŠ¡ B çš„ D-Bus æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡ Bã€‚è€ŒæœåŠ¡ A å‘å‡ºçš„è¯·æ±‚ä¼šè¢« D-Bus ç¼“å­˜ï¼ŒæœåŠ¡ A ä¼šç­‰å¾…æœåŠ¡ B å¯åŠ¨å°±ç»ªã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä¾èµ– D-Bus çš„æœåŠ¡å°±å¯ä»¥å®ç°å¹¶è¡Œå¯åŠ¨ã€‚ 3.5.2.3 æ–‡ä»¶ç³»ç»Ÿä¾èµ–(automounter)ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„æ´»åŠ¨æ˜¯æœ€è€—æ—¶çš„ï¼Œæ¯”å¦‚æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œå¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œç£ç›˜æ£€æŸ¥ï¼ˆfsckï¼‰ï¼Œç£ç›˜é…é¢æ£€æŸ¥ç­‰éƒ½æ˜¯éå¸¸è€—æ—¶çš„æ“ä½œã€‚åœ¨ç­‰å¾…è¿™äº›å·¥ä½œå®Œæˆçš„åŒæ—¶ï¼Œç³»ç»Ÿå¤„äºç©ºé—²çŠ¶æ€ã€‚é‚£äº›æƒ³ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„æœåŠ¡ä¼¼ä¹å¿…é¡»ç­‰å¾…æ–‡ä»¶ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆæ‰å¯ä»¥å¯åŠ¨ã€‚ä½†æ˜¯ systemd å‘ç°è¿™ç§ä¾èµ–ä¹Ÿæ˜¯å¯ä»¥é¿å…çš„ã€‚ systemd å‚è€ƒäº† autofs çš„è®¾è®¡æ€è·¯ï¼Œä½¿å¾—ä¾èµ–æ–‡ä»¶ç³»ç»Ÿçš„æœåŠ¡å’Œæ–‡ä»¶ç³»ç»Ÿæœ¬èº«åˆå§‹åŒ–ä¸¤è€…å¯ä»¥å¹¶è¡Œå·¥ä½œã€‚autofs å¯ä»¥ç›‘æµ‹åˆ°æŸä¸ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹çœŸæ­£è¢«è®¿é—®åˆ°çš„æ—¶å€™æ‰è§¦å‘æŒ‚è½½æ“ä½œï¼Œè¿™æ˜¯é€šè¿‡å†…æ ¸ automounter æ¨¡å—çš„æ”¯æŒè€Œå®ç°çš„ã€‚systemd é›†æˆäº†autofsçš„å®ç°ï¼Œå¯¹äºç³»ç»Ÿä¸­çš„æŒ‚è½½ç‚¹ï¼Œæ¯”å¦‚/homeï¼Œå½“ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œsystemd ä¸ºå…¶åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„è‡ªåŠ¨æŒ‚è½½ç‚¹ã€‚åœ¨è¿™ä¸ªæ—¶åˆ»/home çœŸæ­£çš„æŒ‚è½½è®¾å¤‡å°šæœªå¯åŠ¨å¥½ï¼ŒçœŸæ­£çš„æŒ‚è½½æ“ä½œè¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ–‡ä»¶ç³»ç»Ÿæ£€æµ‹ä¹Ÿè¿˜æ²¡æœ‰å®Œæˆã€‚å¯æ˜¯é‚£äº›ä¾èµ–è¯¥ç›®å½•çš„è¿›ç¨‹å·²ç»å¯ä»¥å¹¶å‘å¯åŠ¨ï¼Œä»–ä»¬çš„ open()æ“ä½œè¢«å†…å»ºåœ¨ systemd ä¸­çš„ autofs æ•è·ï¼Œå°†è¯¥ open()è°ƒç”¨æŒ‚èµ·ï¼ˆå¯ä¸­æ–­ç¡çœ çŠ¶æ€ï¼‰ã€‚ç„¶åç­‰å¾…çœŸæ­£çš„æŒ‚è½½æ“ä½œå®Œæˆï¼Œæ–‡ä»¶ç³»ç»Ÿæ£€æµ‹ä¹Ÿå®Œæˆåï¼Œsystemd å°†è¯¥è‡ªåŠ¨æŒ‚è½½ç‚¹æ›¿æ¢ä¸ºçœŸæ­£çš„æŒ‚è½½ç‚¹ï¼Œå¹¶è®© open()è°ƒç”¨è¿”å›ã€‚ç”±æ­¤ï¼Œå®ç°äº†é‚£äº›ä¾èµ–äºæ–‡ä»¶ç³»ç»Ÿçš„æœåŠ¡å’Œæ–‡ä»¶ç³»ç»Ÿæœ¬èº«åŒæ—¶å¹¶å‘å¯åŠ¨ã€‚ å¯¹äº/æ ¹ç›®å½•çš„ä¾èµ–å®é™…ä¸Šä¸€å®šè¿˜æ˜¯è¦ä¸²è¡Œæ‰§è¡Œï¼Œå› ä¸º systemd è‡ªå·±ä¹Ÿå­˜æ”¾åœ¨/æ ¹ç›®å½•ä¹‹ä¸‹ï¼Œå¿…é¡»ç­‰å¾…ç³»ç»Ÿæ ¹ç›®å½•æŒ‚è½½æ£€æŸ¥å¥½ã€‚ ä¸è¿‡å¯¹äºç±»ä¼¼/homeç­‰æŒ‚è½½ç‚¹ï¼Œè¿™ç§å¹¶å‘å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯å½“/homeæ˜¯è¿œç¨‹çš„ NFS èŠ‚ç‚¹ï¼Œæˆ–è€…æ˜¯åŠ å¯†ç›˜ç­‰ï¼Œéœ€è¦è€—è´¹è¾ƒé•¿çš„æ—¶é—´æ‰å¯ä»¥å‡†å¤‡å°±ç»ªçš„æƒ…å†µä¸‹ï¼Œå› ä¸ºå¹¶å‘å¯åŠ¨ï¼Œè¿™æ®µæ—¶é—´å†…ï¼Œç³»ç»Ÿå¹¶ä¸æ˜¯å®Œå…¨æ— äº‹å¯åšï¼Œè€Œæ˜¯å¯ä»¥åˆ©ç”¨è¿™æ®µç©ºä½™æ—¶é—´åšæ›´å¤šçš„å¯åŠ¨è¿›ç¨‹çš„äº‹æƒ…ï¼Œæ€»çš„æ¥è¯´å°±ç¼©çŸ­äº†ç³»ç»Ÿå¯åŠ¨æ—¶é—´ã€‚ 3.5.2.4 æ€»ç»“ä»ä¸Šé¢çš„ä¸‰ä¸ªåŠæ³•æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œsystemdè®©å¤šä¸ªç¨‹åºå¹¶è¡Œå¯åŠ¨çš„è§£å†³æ€è·¯å°±æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç‚¹ï¼Œè®©å„ç±»éœ€è¦ä¾èµ–çš„æœåŠ¡å…ˆè¿è¡Œèµ·æ¥ï¼Œæœ€åå†æŠŠè™šæ‹Ÿç‚¹æ¢æˆå®é™…çš„æœåŠ¡ä½¿å¾—èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ 3.5.3 systemdå®ç°tomcatçš„daemonè¿›ç¨‹æˆ‘ä»¬åœ¨/usr/lib/systemd/system/ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªtomcat9.serviceæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨systemctlå‘½ä»¤æ¥è¿›è¡Œæ§åˆ¶ï¼š ä½¿ç”¨ systemctl æ§åˆ¶å•å…ƒæ—¶ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨unitæ–‡ä»¶çš„å…¨åï¼ŒåŒ…æ‹¬æ‰©å±•åï¼ˆä¾‹å¦‚ sshd.service ï¼‰ã€‚ä½†æ˜¯æœ‰äº›unitå¯ä»¥åœ¨ systemctl ä¸­ä½¿ç”¨ç®€å†™æ–¹å¼ã€‚ å¦‚æœæ— æ‰©å±•åï¼Œsystemctl é»˜è®¤æŠŠæ‰©å±•åå½“ä½œ .service ã€‚ä¾‹å¦‚ tomcat å’Œ tomcat.service æ˜¯ç­‰ä»·çš„ã€‚ æŒ‚è½½ç‚¹ä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºç›¸åº”çš„ .mount å•å…ƒã€‚ä¾‹å¦‚ /home ç­‰ä»·äº home.mount ã€‚ è®¾å¤‡ä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºç›¸åº”çš„ .device å•å…ƒï¼Œæ‰€ä»¥ /dev/sda1 ç­‰ä»·äº dev-sda1.device ã€‚ 3.5.3.1 ä½¿ç”¨daemon.shé¦–å…ˆæˆ‘ä»¬å°è¯•åœ¨systemdä¸­ä½¿ç”¨è‡ªå¸¦çš„è„šæœ¬è¿›è¡Œå¯åŠ¨å’Œå…³é—­tomcatï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæŠŠstartup.shå’Œshutdown.shä¸¤ä¸ªè„šæœ¬ç»™æ’é™¤æ‰ï¼Œè™½ç„¶å®ƒä»¬æ— æ³•å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹çš„ç¼ºé™·å¯ä»¥ä½¿ç”¨systemdæ¥è¿›è¡Œå¼¥è¡¥ï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•ä½¿ç”¨jsvcï¼Œæ— æ³•åœ¨ç‰¹æƒç«¯å£å’Œè¿è¡Œç”¨æˆ·ä¹‹é—´å–å¾—ä¸¤å…¨ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨daemon.shæ¥è¿è¡Œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsystemdå¹¶ä¸ä¼šå»è¯»å–æˆ‘ä»¬å…ˆå‰åœ¨/etc/profileä¸­è®¾å®šçš„å˜é‡ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥æŠŠå˜é‡å†™è¿›unité…ç½®æ–‡ä»¶ä¸­ã€‚ 123456789101112131415161718[Unit]Description=Apache Tomcat 9[Service]User=tomcatGroup=tomcatPIDFile=/var/run/tomcat.pidEnvironment=JAVA_HOME=/home/jdk8/Environment=JRE_HOME=/home/jdk8/jreEnvironment=CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/libEnvironment=CATALINA_HOME=/home/tomcat9Environment=CATALINA_BASE=/home/tomcat9Environment=CATALINA_TMPDIR=/home/tomcat9/tempExecStart=/home/tomcat9/bin/daemon.sh startExecStop=/home/tomcat9/bin/daemon.sh stop[Install]WantedBy=multi-user.target æ·»åŠ äº†æ–°çš„unitå•å…ƒä¹‹åæˆ‘ä»¬å…ˆsystemctl daemon-reloadé‡å¯ä¸€ä¸‹daemonè¿›ç¨‹ï¼Œå†ä½¿ç”¨systemctl start tomcat9.serviceæ¥å¯åŠ¨æœåŠ¡ï¼Œæ¥ç€æŸ¥çœ‹çŠ¶æ€ï¼Œå‘ç°æ— æ³•æ­£å¸¸è¿è¡Œï¼Œä¸€å¯åŠ¨è¿›ç¨‹å°±failedæ‰äº†ï¼ŒæŸ¥çœ‹daemonè„šæœ¬é»˜è®¤çš„æ—¥å¿—æ–‡ä»¶ï¼ˆä½äºtomcatç›®å½•ä¸‹çš„logs/catalina-daemon.outï¼‰æˆ‘ä»¬å‘ç°è¿”å›äº†143é”™è¯¯ã€‚ 1Service exit with a return value of 143 ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ï¼Œæœ‰ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯æŠŠdaemon.shè„šæœ¬ä¸­çš„waitå‚æ•°æ—¶é—´ä»10è°ƒæˆ240ï¼Œåœ¨125è¡Œå·¦å³çš„ä½ç½®ï¼š 12# Set the default service-start wait time if necessarytest &quot;.$SERVICE_START_WAIT_TIME&quot; = . &amp;&amp; SERVICE_START_WAIT_TIME=10 waitå‚æ•°è°ƒå¤§ä¹‹åï¼Œç­‰å¾…å¯åŠ¨æˆåŠŸä¹‹åï¼ˆè¿™é‡Œç”¨çš„ä¸»æœºé…ç½®å¾ˆä½ï¼Œå¯åŠ¨æ¯”è¾ƒè€—æ—¶ï¼‰å°±å¯ä»¥æ­£å¸¸è®¿é—®äº† ä½†æ˜¯åœ¨å››åˆ†é’Ÿï¼ˆ240sï¼‰ä¹‹åæˆ‘ä»¬å†æŸ¥çœ‹tomcat9.serviceå°±ä¼šå‘ç°ï¼Œè¿›ç¨‹å·²ç»ç»“æŸäº†ï¼Œå†æ¬¡è®¿é—®é»˜è®¤çš„8080ç«¯å£ä¹Ÿæ— æ³•è®¿é—®ï¼ŒæŸ¥æ‰¾è¿›ç¨‹ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„è¿›ç¨‹ã€‚ è¯•å›¾åˆ†æä¸€æ³¢ æˆ‘ä»¬æ¥æ ¹æ®ä¸Šé¢çš„æƒ…å†µç»“åˆåŸç†æ¥è¯•å›¾åˆ†æä¸€ä¸‹ï¼š é¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°-waitå‚æ•°æ—¶é•¿è°ƒåˆ°240ä¹‹åï¼Œbash shellè¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿äº†ï¼Œæ ¹æ®ä¹‹å‰çš„jsvcå·¥ä½œåŸç†éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥çŸ¥é“-waitå‚æ•°ä¼šå½±å“jsvcçš„å¯åŠ¨è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä»systemdè¾“å‡ºçš„ä¿¡æ¯æ¥çœ‹ï¼Œæœ‰åŒ…æ‹¬jsvcä¸‰ä¸ªè¿›ç¨‹å’Œbash shellè¿›ç¨‹åœ¨å†…å…±è®¡å››ä¸ªè¿›ç¨‹ï¼Œè¿™å’Œä¹‹å‰æˆ‘ä»¬ç›´æ¥è¿è¡Œdaemon.shä¹‹åæœ€ç»ˆåªæœ‰jsvcçš„ä¸¤ä¸ªè¿›ç¨‹ï¼ˆæ§åˆ¶è¿›ç¨‹å’Œè¢«æ§åˆ¶è¿›ç¨‹ä¸åŒï¼‰ï¼Œä¸”Main PIDå‚æ•°æŒ‡å‘çš„æ˜¯bash shellè¿›ç¨‹ã€‚ äºæ˜¯ä¹æˆ‘ä»¬å¤§èƒ†çŒœæµ‹ä¸€ä¸‹ï¼šä½¿ç”¨daemon.sh startå‘½ä»¤å¯åŠ¨tomcatï¼Œsystemdä¼šæŠŠå¯åŠ¨daemon.shçš„bashçš„PIDä½œä¸ºæ•´ä¸ªserviceçš„PIDæ¥ç›‘æ§ï¼Œè€Œè¿™ä¸ªbashè¿›ç¨‹åœ¨å¯åŠ¨äº†jsvcä¹‹åæ˜¯ä¼šè‡ªè¡Œé€€å‡ºçš„ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†systemdè®¤ä¸ºserviceå·²ç»è¿è¡Œå¤±è´¥ï¼Œä»è€Œæ¸…ç†æ‰äº†å…³è”çš„è¿›ç¨‹ï¼Œè¿›è€Œä½¿å¾—jsvcç›¸å…³çš„tomcatè¿›ç¨‹ä¹Ÿè¢«æ¸…ç†æ‰äº†ã€‚è€Œ-waitå‚æ•°æ—¶é•¿è°ƒåˆ°240ä¹‹åï¼Œbash shellè¿›ç¨‹çš„å­˜æ´»æ—¶é—´å˜é•¿ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨tomcatå¯åŠ¨å®Œæˆä¹‹åä¸”bash shellè¿›ç¨‹ç»“æŸä¹‹å‰è®¿é—®åˆ°tomcatæœåŠ¡å™¨ã€‚ è€ƒè™‘åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹ä½¿ç”¨daemon.sh runæ¥å¯åŠ¨tomcatï¼Œå› ä¸ºåœ¨ç»ˆç«¯ä¸­ä½¿ç”¨runå‚æ•°çš„æ—¶å€™ä¼šä¸€ç›´æŠŠlogä¿¡æ¯è¾“å‡ºåˆ°ç»ˆç«¯ï¼Œæˆ‘çŒœæµ‹è¿™ä¸ªè¿è¡Œæ–¹å¼æ˜¯å’Œstartä¸å¤ªä¸€æ ·çš„ã€‚ æŠŠsystemdçš„unitæ–‡ä»¶çš„å¯åŠ¨å‚æ•°æ”¹ä¸ºrunï¼ŒåŒæ—¶å°†-waitå‚æ•°æ—¶é•¿è°ƒå›é»˜è®¤çš„10ï¼Œå†æ¬¡å¯åŠ¨æœåŠ¡ã€‚ è¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°systemdçš„Main PIDå¯¹åº”ä¸ºjsvcçš„ä¸»è¿›ç¨‹ï¼ŒtomcatæœåŠ¡ä¹Ÿèƒ½ä¸€ç›´æ­£å¸¸çš„åœ¨åå°è¿è¡Œã€‚åº”è¯¥ç®—æ˜¯æˆåŠŸçš„ä½¿ç”¨systemdæ¥ç®¡ç†jsvcå¯åŠ¨çš„tomcatè¿›ç¨‹äº†ã€‚ é‚£ä¹ˆè¿™ä¸¤è€…çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿæ¥ç€æˆ‘ä»¬æ‰“å¼€daemon.shè¿™ä¸ªè„šæœ¬æ¥æŸ¥çœ‹ä¸€ä¸‹ä¸¤è€…çš„ä¸åŒï¼š ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤è€…æœ€å¤§çš„ä¸åŒå°±æ˜¯ä½¿ç”¨runå‘½ä»¤çš„æ—¶å€™æ˜¯execè°ƒç”¨jsvcæ¥å¯åŠ¨tomcatå¹¶ä¸”ä½¿ç”¨äº†-nodetachå‚æ•°ã€‚ shellä¸­çš„execå‘½ä»¤å’Œç›´æ¥è°ƒç”¨ä¸åŒï¼Œå‘½ä»¤execå°†å¹¶ä¸å¯åŠ¨æ–°çš„shellï¼Œè€Œæ˜¯ç”¨è¦è¢«æ‰§è¡Œå‘½ä»¤æ›¿æ¢å½“å‰çš„shellè¿›ç¨‹ï¼Œå¹¶ä¸”å°†è€è¿›ç¨‹çš„ç¯å¢ƒæ¸…ç†æ‰ï¼Œè€Œä¸”execå‘½ä»¤åçš„å…¶å®ƒå‘½ä»¤å°†ä¸å†æ‰§è¡Œã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œrunå‘½ä»¤ä½¿ç”¨execè°ƒç”¨äº†jsvcï¼Œæ˜¯ç›´æ¥æ›¿ä»£åŸæ¥å¯åŠ¨daemon.shçš„bash shellè¿›ç¨‹ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªexecå‘½ä»¤æ‰§è¡Œå®Œä¹‹åæ‰ä¼šæ‰§è¡Œåé¢çš„exitå‘½ä»¤ã€‚è¿™æ ·å°±å¯ä»¥è®©systemdçš„Main PIDä»bash shellè¿›ç¨‹é¡ºç†æˆç« åœ°å˜ä¸ºjsvcçš„å¯åŠ¨è¿›ç¨‹ã€‚ é‚£ä¹ˆæˆ‘ä»¬çŸ¥é“ï¼Œjsvcçš„å¯åŠ¨è¿›ç¨‹åœ¨å¯åŠ¨å®Œjsvcæ§åˆ¶è¿›ç¨‹ä¹‹åè¿˜æ˜¯ä¼šé€€å‡ºçš„ï¼Œè¿™ä¸ªæ—¶å€™systemdè¿˜æ˜¯ä¼šç›‘å¬å¤±è´¥ã€‚è€Œ-nodetachå‚æ•°çš„ä½œç”¨å°±æ˜¯ä¸è„±ç¦»çˆ¶è¿›ç¨‹è€Œæˆä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼ˆ donâ€™t detach from parent process and become a daemonï¼‰ï¼Œè¿™æ ·å°±èƒ½é¡ºåˆ©åœ°ä½¿å¾—jsvcæ§åˆ¶è¿›ç¨‹ä»å®ƒçš„çˆ¶è¿›ç¨‹jsvcå¯åŠ¨è¿›ç¨‹é‚£é‡Œâ€œå¾—åˆ°â€systemdçš„Main PIDçš„ä½ç½®ï¼Œæˆä¸ºè¯¥serviceçš„ä¸»è¦è¿›ç¨‹ã€‚ æˆ‘ä»¬ç›´æ¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œjsvcå¹¶åŠ ä¸Š-nodetachå‚æ•°ï¼Œå¯ä»¥çœ‹åˆ°å³ä½¿æ˜¯è¿è¡ŒæˆåŠŸäº†ä¹‹åä¹Ÿä¸ä¼šé€€å‡ºï¼ˆæ§åˆ¶è¿›ç¨‹ç»§æ‰¿äº†å¯åŠ¨è¿›ç¨‹æˆä¸ºå®ˆæŠ¤è¿›ç¨‹ä¸€ç›´è¿è¡Œï¼‰ï¼Œè€Œæ²¡åŠ çš„æƒ…å†µä¸‹åˆ™æ˜¯jsvcå¯åŠ¨è¿›ç¨‹é€€å‡ºåå°±ä¼šé€€å‡ºã€‚ è¿™é‡Œå†æ”¾ä¸Šsystemdä½¿ç”¨daemon.shå¯åŠ¨tomcatçš„æ•´ä¸ªunitæ–‡ä»¶çš„é…ç½®åŠæ³¨é‡Šï¼š 1234567891011121314151617181920212223242526272829[Unit]Description=Apache Tomcat 9# å¯¹æ•´ä¸ªseriveçš„æè¿°ï¼Œç›¸å½“äºå¤‡æ³¨ï¼Œä¼šå‡ºç°åœ¨systemdçš„logä¸­After=network.target# åœ¨networkæœåŠ¡å¯åŠ¨ä¹‹åå†å¯åŠ¨[Service]User=tomcatGroup=tomcat# è¿è¡Œè¯¥serviceçš„ç”¨æˆ·åŠç”¨æˆ·ç»„PIDFile=/var/run/tomcat.pid# è¯¥serviceçš„PIDæ–‡ä»¶Environment=JAVA_HOME=/home/jdk8/Environment=JRE_HOME=/home/jdk8/jreEnvironment=CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/libEnvironment=CATALINA_HOME=/home/tomcat9Environment=CATALINA_BASE=/home/tomcat9Environment=CATALINA_TMPDIR=/home/tomcat9/temp# å®šä¹‰äº†è¿è¡Œæ—¶éœ€è¦çš„å˜é‡ExecStart=/home/tomcat9/bin/daemon.sh startExecStop=/home/tomcat9/bin/daemon.sh stop# å¯¹åº”systemdæ§åˆ¶çš„startå’Œstopå‘½ä»¤[Install]WantedBy=multi-user.target# è¿è¡Œçº§åˆ«ä¸ºç¬¬ä¸‰çº§ï¼ˆå¸¦æœ‰ç½‘ç»œçš„å¤šç”¨æˆ·æ¨¡å¼ï¼‰ 3.5.3.2 ç›´æ¥ä½¿ç”¨jsvcæ—¢ç„¶ææ¸…æ¥šäº†è¿è¡ŒåŸç†ï¼Œæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥è·³è¿‡è„šæœ¬ç›´æ¥åœ¨unitæ–‡ä»¶ä¸­å®šä¹‰å„ç§å‚æ•°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[Unit]Description=Apache Tomcat 9After=network.target[Service]User=rootGroup=root# è¿™é‡Œä½¿ç”¨rootç”¨æˆ·å¯åŠ¨æ–¹ä¾¿jsvcç›‘å¬ç‰¹æƒç«¯å£# åé¢å¯ä»¥åœ¨jsvcå‚æ•°ä¸­ä½¿ç”¨-useré™æƒåˆ°tomcatç”¨æˆ·PIDFile=/var/run/tomcat.pidEnvironment=JAVA_HOME=/home/jdk8/Environment=JRE_HOME=/home/jdk8/jreEnvironment=CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/libEnvironment=CATALINA_HOME=/home/tomcat9Environment=CATALINA_BASE=/home/tomcat9Environment=CATALINA_TMPDIR=/home/tomcat9/tempExecStart=/home/tomcat9/bin/jsvc \\ -user tomcat \\ -nodetach \\ -java-home $&#123;JAVA_HOME&#125; \\ -pidfile $&#123;CATALINA_BASE&#125;/tomcat.pid \\ -classpath $&#123;CATALINA_HOME&#125;/bin/bootstrap.jar:$&#123;CATALINA_HOME&#125;/bin/tomcat-juli.jar \\ -outfile $&#123;CATALINA_BASE&#125;/logs/catalina.out \\ -errfile $&#123;CATALINA_BASE&#125;/logs/catalina.err \\ -Dcatalina.home=$&#123;CATALINA_HOME&#125; \\ -Dcatalina.base=$&#123;CATALINA_BASE&#125; \\ -Djava.io.tmpdir=$&#123;CATALINA_TMPDIR&#125; \\ -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \\ -Djava.util.logging.config.file=$&#123;CATALINA_BASE&#125;/conf/logging.properties \\ org.apache.catalina.startup.BootstrapExecStop=/home/tomcat9/bin/jsvc \\ -stop \\ -classpath $&#123;CLASSPATH&#125; \\ -Dcatalina.base=$&#123;CATALINA_BASE&#125; \\ -Dcatalina.home=$&#123;CATALINA_HOME&#125; \\ -pidfile $&#123;CATALINA_BASE&#125;/tomcat.pid \\ -Djava.io.tmpdir=$&#123;CATALINA_TMPDIR&#125; \\ -Djava.util.logging.config.file=$&#123;CATALINA_BASE&#125;/conf/logging.properties \\ -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \\ org.apache.catalina.startup.Bootstrap [Install]WantedBy=multi-user.target æ³¨æ„ï¼šExecStartå’ŒExecStopä¸¤ä¸ªå‘½ä»¤ä¸­çš„æ‰§è¡Œæ–‡ä»¶è·¯å¾„éœ€è¦ä½¿ç”¨ç»å¯¹è·¯å¾„ 4ã€Tomcatçš„å·¥ä½œæ¨¡å¼Tomcatä¸ä»…å¯ä»¥å•ç‹¬è¿è¡Œï¼Œè¿˜å¯ä»¥ä¸å…¶ä»–çš„WebæœåŠ¡å™¨é›†æˆï¼Œä½œä¸ºå…¶ä»–WebæœåŠ¡å™¨çš„è¿›ç¨‹å†…æˆ–è¿›ç¨‹å¤–çš„servletå®¹å™¨ã€‚é›†æˆçš„æ„ä¹‰åœ¨äºï¼šå¯¹äºä¸æ”¯æŒè¿è¡ŒJava Servletçš„å…¶ä»–WebæœåŠ¡å™¨ï¼Œå¯é€šè¿‡é›†æˆTomcatæ¥æä¾›è¿è¡ŒServletçš„åŠŸèƒ½ã€‚ Tomcatæœ‰ä¸‰ç§å·¥ä½œæ¨¡å¼ï¼š ç¬¬ä¸€ç§ï¼šTomcatåœ¨ä¸€ä¸ªJavaè™šæ‹Ÿæœºè¿›ç¨‹ä¸­ç‹¬ç«‹è¿è¡Œï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ç›´æ¥å’Œtomcaté€šä¿¡ã€‚Tomcatå¯çœ‹ä½œæ˜¯èƒ½è¿è¡ŒServletçš„ç‹¬ç«‹WebæœåŠ¡å™¨ã€‚Servletå®¹å™¨ç»„ä»¶ä½œä¸ºWebæœåŠ¡å™¨ä¸­çš„ä¸€éƒ¨åˆ†è€Œå­˜åœ¨ã€‚è¿™æ˜¯Tomcatçš„é»˜è®¤å·¥ä½œæ¨¡å¼ã€‚ ç¬¬äºŒç§ï¼šTomcatè¿è¡Œåœ¨å…¶ä»–WebæœåŠ¡å™¨çš„è¿›ç¨‹ä¸­ï¼ŒTomcatä¸ç›´æ¥å’Œå®¢æˆ·ç«¯é€šä¿¡ï¼Œä»…ä»…ä¸ºå…¶ä»–WebæœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è®¿é—®Servletçš„è¯·æ±‚ã€‚è¿›ç¨‹å†…çš„Servletå®¹å™¨å¯¹äºå•è¿›ç¨‹ã€å¤šçº¿ç¨‹çš„WebæœåŠ¡å™¨éå¸¸åˆé€‚ï¼Œå¯ä»¥æä¾›è¾ƒé«˜çš„è¿è¡Œé€Ÿåº¦ï¼Œä½†ç¼ºä¹ä¼¸ç¼©æ€§ã€‚ åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒTomcatåˆ†ä¸ºWebæœåŠ¡å™¨æ’ä»¶å’ŒServletå®¹å™¨ç»„ä»¶ä¸¤éƒ¨åˆ†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒWebæœåŠ¡å™¨æ’ä»¶åœ¨å…¶ä»–WebæœåŠ¡å™¨è¿›ç¨‹çš„å†…éƒ¨åœ°å€ç©ºé—´å¯åŠ¨ä¸€ä¸ªJavaè™šæ‹Ÿæœºï¼ŒServletå®¹å™¨ç»„ä»¶åœ¨æ­¤Javaè™šæ‹Ÿæœºä¸­è¿è¡Œã€‚å¦‚æœ‰å®¢æˆ·ç«¯å‘å‡ºè°ƒç”¨Servletçš„è¯·æ±‚ï¼ŒWebæœåŠ¡å™¨æ’ä»¶è·å¾—å¯¹æ­¤è¯·æ±‚çš„æ§åˆ¶å¹¶å°†å®ƒè½¬å‘ï¼ˆä½¿ç”¨JNIé€šä¿¡æœºåˆ¶ï¼‰ç»™Servletå®¹å™¨ç»„ä»¶ã€‚ JNIï¼ˆJava Native Interfaceï¼‰æŒ‡çš„æ˜¯Javaæœ¬åœ°è°ƒç”¨æ¥å£ï¼Œé€šè¿‡è¿™ä¸€æ¥å£ï¼ŒJavaç¨‹åºå¯ä»¥å’Œé‡‡ç”¨å…¶ä»–è¯­è¨€ç¼–å†™çš„æœ¬åœ°ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ ç¬¬ä¸‰ç§ï¼šTomcatåœ¨ä¸€ä¸ªJavaè™šæ‹Ÿæœºè¿›ç¨‹ä¸­ç‹¬ç«‹è¿è¡Œï¼Œä½†æ˜¯å®ƒä¸ç›´æ¥å’Œå®¢æˆ·ç«¯é€šä¿¡ï¼Œä»…ä»…ä¸ºä¸å®ƒé›†æˆçš„å…¶ä»–WebæœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è®¿é—®Servletçš„è¯·æ±‚ã€‚ åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒTomcatåˆ†ä¸ºWebæœåŠ¡å™¨æ’ä»¶å’ŒServletå®¹å™¨ç»„ä»¶ä¸¤éƒ¨åˆ†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒWebæœåŠ¡å™¨æ’ä»¶åœ¨å…¶ä»–WebæœåŠ¡å™¨çš„å¤–éƒ¨åœ°å€ç©ºé—´å¯åŠ¨ä¸€ä¸ªJVMè¿›ç¨‹ï¼ŒServletå®¹å™¨ç»„ä»¶åœ¨æ­¤JVMä¸­è¿è¡Œã€‚å¦‚æœ‰å®¢æˆ·ç«¯å‘å‡ºè°ƒç”¨Servletçš„è¯·æ±‚ï¼ŒWebæœåŠ¡å™¨æ’ä»¶è·å¾—å¯¹æ­¤è¯·æ±‚çš„æ§åˆ¶å¹¶å°†å®ƒè½¬å‘ï¼ˆé‡‡ç”¨IPCé€šä¿¡æœºåˆ¶ï¼‰ç»™Servletå®¹å™¨ã€‚ è¿›ç¨‹å¤–Servletå®¹å™¨å¯¹å®¢æˆ·è¯·æ±‚çš„å“åº”é€Ÿåº¦ä¸å¦‚è¿›ç¨‹å†…Servletå®¹å™¨ï¼Œä½†è¿›ç¨‹å¤–å®¹å™¨å…·æœ‰æ›´å¥½çš„ä¼¸ç¼©æ€§å’Œç¨³å®šæ€§ã€‚ IPCï¼ˆInter-Process Communicationï¼Œè¿›ç¨‹é—´é€šä¿¡ï¼‰æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡çš„ä¸€ç§æœºåˆ¶ã€‚ 5ã€Tomcatçš„æ•´ä½“æ¶æ„æˆ‘ä»¬å…ˆä»tomcatçš„æºç ç›®å½•æ¥åˆ†æä¸€ä¸‹tomcatçš„æ•´ä½“æ¶æ„ï¼Œå‰é¢æˆ‘ä»¬é…ç½®jsvcè¿è¡Œtomcatçš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“tomcatä¸­å¯åŠ¨è¿è¡Œçš„æœ€ä¸»è¦çš„ç±»æ˜¯org.apache.catalina.startup.Bootstrapï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨tomcatçš„æºç ä¸­çš„javaç›®å½•ä¸‹çš„orgç›®å½•çš„apacheç›®å½•å¯ä»¥æ‰¾åˆ°ä¸»è¦çš„æºç çš„ç›¸å¯¹åº”çš„ç±»ã€‚ å›¾ä¸­çš„ç›®å½•å¦‚æœç”»æˆæ¶æ„å›¾ï¼Œå¯ä»¥è¿™æ ·è¡¨ç¤ºï¼š Tomcat æœ¬è´¨ä¸Šå°±æ˜¯ä¸€æ¬¾Servlet å®¹å™¨ï¼Œå› æ­¤catalinaæ‰æ˜¯Tomcatçš„æ ¸å¿ƒ ï¼Œå…¶ä»–æ¨¡å—éƒ½æ˜¯ä¸ºcatalinaæä¾›æ”¯æ’‘çš„ã€‚ coyoteæ¨¡å—ä¸»è¦è´Ÿè´£é“¾æ¥é€šä¿¡ï¼ŒTomcatä½œä¸ºhttpæœåŠ¡å™¨ï¼Œéœ€è¦ä»socketä¸­è·å¾—HTTPæ•°æ®æµï¼›è€ŒTomcatä½œä¸ºå®¹å™¨ï¼Œåªèƒ½å¤„ç†å°è£…å¥½çš„org.apache.coyote.Requestï¼Œå› æ­¤ä»socketåˆ°Requestä¹‹é—´çš„è½¬æ¢å°±äº¤ç»™coyoteæ¥è´Ÿè´£äº†ã€‚å› æ­¤ï¼Œè¿æ¥socketå’Œå®¹å™¨ä¹‹é—´çš„é‡ä»»å°±äº¤ç»™äº†Coyoteã€‚ç®€å•è¯´å°±æ˜¯coyoteæ¥å¤„ç†åº•å±‚çš„socketï¼Œå¹¶å°†httpè¯·æ±‚ã€å“åº”ç­‰å­—èŠ‚æµå±‚é¢çš„ä¸œè¥¿ï¼ŒåŒ…è£…æˆRequestå’ŒResponseä¸¤ä¸ªç±»ï¼ˆè¿™ä¸¤ä¸ªç±»æ˜¯tomcatå®šä¹‰çš„ï¼Œè€Œéservletä¸­çš„ServletRequestå’ŒServletResponseï¼‰ï¼Œä¾›å®¹å™¨ä½¿ç”¨ï¼›åŒæ—¶ï¼Œä¸ºäº†èƒ½è®©æˆ‘ä»¬ç¼–å†™çš„servletèƒ½å¤Ÿå¾—åˆ°ServletRequestï¼Œtomcatä½¿ç”¨äº†facadeæ¨¡å¼ï¼Œå°†æ¯”è¾ƒåº•å±‚ã€ä½çº§çš„RequeståŒ…è£…æˆä¸ºServletRequestï¼ˆè¿™ä¸€è¿‡ç¨‹é€šå¸¸å‘ç”Ÿåœ¨Wrapperå®¹å™¨ä¸€çº§ï¼‰ jasperæ¨¡å—æä¾›JSPå¼•æ“ï¼Œåœ¨jspæ–‡ä»¶è¢«åˆæ¬¡è®¿é—®çš„æ—¶å€™åšå‡ºå“åº”ï¼Œå°†jspé¡µé¢ç¿»è¯‘æˆservletè¯·æ±‚ï¼Œç„¶åè°ƒç”¨javaç¼–è¯‘å™¨å¯¹servletè¿›è¡Œç¼–è¯‘å¾—åˆ°classæ–‡ä»¶ï¼Œå†è°ƒç”¨jvmæ¥æ‰§è¡Œclassæ–‡ä»¶ç”Ÿæˆåº”ç­”ï¼Œæœ€åæŠŠåº”ç­”å‘é€å›å®¢æˆ·ç«¯ã€‚ elå…¨åä¸ºExpression Languageï¼Œä¹Ÿå«JUELï¼Œä¸»è¦åœ¨Java Webåº”ç”¨ä¸­ç”¨äºå°†è¡¨è¾¾å¼åµŒå…¥åˆ°webé¡µé¢ namingæä¾›JNDI æœåŠ¡(Java Naming and Directory Interface,Javaå‘½åå’Œç›®å½•æ¥å£)ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†æŸ¥æ‰¾å’Œè®¿é—®å„ç§å‘½åå’Œç›®å½•æœåŠ¡çš„é€šç”¨ã€ç»Ÿä¸€çš„æ¥å£ï¼Œç”±ç®¡ç†è€…å°†JNDI APIæ˜ å°„ä¸ºç‰¹å®šçš„å‘½åæœåŠ¡å’Œç›®å½•ç³»ç»Ÿï¼Œä½¿å¾—Javaåº”ç”¨ç¨‹åºå¯ä»¥å’Œè¿™äº›å‘½åæœåŠ¡å’Œç›®å½•æœåŠ¡ä¹‹é—´è¿›è¡Œäº¤äº’ã€‚ juliæä¾›æ—¥å¿—æœåŠ¡ï¼ŒJDK æ‰€æä¾›çš„é»˜è®¤ java.util.logging å®ç°åŠŸèƒ½å¤ªè¿‡å±€é™ï¼Œä¸èƒ½å®ç°é’ˆå¯¹æ¯ä¸€åº”ç”¨è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œå› ä¸ºé…ç½®æ˜¯é’ˆå¯¹VMçš„ã€‚è€Œjulié€šè¿‡è‡ªå®šä¹‰çš„ LogManager èƒ½åˆ†è¾¨è¿è¡Œåœ¨ Tomcat ä¸Šçš„ä¸åŒ Web åº”ç”¨ï¼ˆä»¥åŠå®ƒä»¬æ‰€ç”¨çš„ä¸åŒçš„ç±»åŠ è½½å™¨ï¼‰ï¼Œè¿˜èƒ½é’ˆå¯¹æ¯ä¸€åº”ç”¨è¿›è¡Œç§æœ‰çš„æ—¥å¿—é…ç½®ã€‚ 6ã€Tomcatçš„å®¹å™¨æ¶æ„Tomcatè®¾è®¡äº†4ç§å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯Engineã€Hostã€Contextå’ŒWrapperã€‚è¿™4ç§å®¹å™¨æ˜¯çˆ¶å­å…³ç³»ï¼Œ Tomcaté€šè¿‡ä¸€ç§åˆ†å±‚çš„æ¶æ„ï¼Œä½¿å¾—Servletå®¹å™¨å…·æœ‰å¾ˆå¥½çš„çµæ´»æ€§ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š ä¸€å°æœºå™¨ä¸Šå¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„CATALINA_BASEæ¥è¿è¡Œå¤šä¸ªtomcatå®ä¾‹ï¼Œå³å¯ä»¥è¿è¡Œå¤šä¸ªserver ä¸€ä¸ªserverä¸­åªæœ‰ä¸€ä¸ªEngineï¼Œè€ŒEngineå°±æ˜¯å®ç°äº†servletè§„èŒƒçš„å¼•æ“ï¼Œè¿™é‡Œå°±æ˜¯Catalina ä¸€ä¸ªengineä¸­å¯ä»¥åŒ…å«å¤šä¸ªhostï¼Œå³å’Œapacheã€nginxç­‰æœåŠ¡å™¨ç›¸åŒï¼Œå¯ä»¥é…ç½®å¤šä¸ªvirtual hostç«™ç‚¹ ä¸€ä¸ªhostä¸­å¯ä»¥åŒ…å«å¤šä¸ªcontextï¼Œå³å¯ä»¥åŒ…å«å¤šä¸ªwebåº”ç”¨ ä¸€ä¸ªwarpperè¡¨ç¤ºä¸€ä¸ªServletï¼Œwrapper ä½œä¸ºå®¹å™¨ä¸­çš„æœ€åº•å±‚ï¼Œä¸èƒ½åŒ…å«å­å®¹å™¨ Tomcatä½¿ç”¨ç»„åˆæ¨¡å¼æ¥ç®¡ç†è¿™äº›å®¹å™¨ï¼Œæ‰€æœ‰å®¹å™¨ç»„ä»¶éƒ½å®ç°äº†Containeræ¥å£ï¼Œå› æ­¤ç»„åˆæ¨¡å¼å¯ä»¥ä½¿å¾—ç”¨æˆ·å¯¹å•å®¹å™¨å¯¹è±¡ï¼ˆæœ€åº•å±‚çš„Wrapperï¼‰å’Œç»„åˆå®¹å™¨å¯¹è±¡ï¼ˆContextã€Hostæˆ–è€…Engineï¼‰çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚ Tomcat æœåŠ¡å™¨çš„é…ç½®ä¸»è¦é›†ä¸­äº tomcat/conf ä¸‹çš„ catalina.policyã€ catalina.propertiesã€context.xmlã€server.xmlã€tomcat-users.xmlã€web.xml æ–‡ä»¶ã€‚ Tomcatçš„è¿™ä¸€è®¾è®¡æ€æƒ³åœ¨å…¶é…ç½®æ–‡ä»¶server.xmlä¸­å¾—åˆ°äº†å¾ˆå¥½çš„è¯ é‡Šï¼Œserver.xml æ˜¯tomcat æœåŠ¡å™¨çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼ŒåŒ…å«äº†Tomcatçš„ Servlet å®¹å™¨ ï¼ˆCatalinaï¼‰çš„æ‰€æœ‰é…ç½®ã€‚ä¸‹é¢æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹server.xmlæ–‡ä»¶ä¸­çš„ä¸€äº›ä¸»è¦é…ç½®ã€‚ 7ã€Tomcatçš„connectorç®€ä»‹7.1 connectorçš„å·¥ä½œåŸç†è¿™é‡Œæˆ‘ä»¬è¯´çš„Tomcatä¸­ä¸‰ç§ä¸åŒçš„I/Oæ¨¡å‹ä¸»è¦æŒ‡çš„æ˜¯å…¶è¿æ¥å™¨ï¼ˆconnectorï¼‰çš„å·¥ä½œæ¨¡å‹ï¼Œå¯¹äºtomcatè€Œè¨€ï¼Œè¿æ¥å™¨ä¸€èˆ¬æŒ‡çš„æ˜¯coyoteï¼Œå…¶å·¥ä½œåŸç†å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿æ¥å™¨ä¸­çš„å„ä¸ªç»„ä»¶çš„ä½œç”¨å¦‚ä¸‹ï¼š 7.1.1 EndPointEndPointå³Coyoteé€šä¿¡ç«¯ç‚¹ï¼Œæ˜¯é€šä¿¡ç›‘å¬çš„æ¥å£ï¼Œæ˜¯å…·ä½“Socketæ¥æ”¶å’Œå‘é€å¤„ç†å™¨ï¼Œæ˜¯å¯¹ä¼ è¾“å±‚ï¼ˆå››å±‚ï¼‰çš„æŠ½è±¡ï¼Œå› æ­¤EndPointç”¨æ¥å®ç°TCP/IPåè®®çš„ã€‚Tomcat å¹¶æ²¡æœ‰EndPointæ¥å£ï¼Œè€Œæ˜¯æä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»AbstractEndpointï¼Œ é‡Œé¢å®šä¹‰äº†ä¸¤ä¸ªå†…éƒ¨ç±»ï¼šAcceptorå’ŒSocketProcessorã€‚Acceptorç”¨äºç›‘å¬Socketè¿æ¥è¯·æ±‚ã€‚ SocketProcessorç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„Socketè¯·æ±‚ï¼Œå®ƒå®ç°Runnableæ¥å£ï¼Œåœ¨Runæ–¹æ³•é‡Œ è°ƒç”¨åè®®å¤„ç†ç»„ä»¶Processorè¿›è¡Œå¤„ç†ã€‚ä¸ºäº†æé«˜å¤„ç†èƒ½åŠ›ï¼ŒSocketProcessorè¢«æäº¤åˆ°çº¿ç¨‹æ± æ¥æ‰§è¡Œï¼Œè€Œè¿™ä¸ªçº¿ç¨‹æ± å«ä½œæ‰§è¡Œå™¨ï¼ˆExecutor)ã€‚ 7.1.2 ProcessorProcessoræ˜¯coyoteçš„åè®®å¤„ç†æ¥å£ ã€‚å¦‚æœè¯´EndPointæ˜¯ç”¨æ¥å®ç°TCP/IPåè®®çš„ï¼Œé‚£ä¹ˆ Processorç”¨æ¥å®ç°HTTPåè®®ï¼ŒProcessoræ¥æ”¶æ¥è‡ªEndPointçš„Socketï¼Œè¯»å–å­—èŠ‚æµè§£ææˆTomcatçš„Requestå’ŒResponseå¯¹è±¡ï¼Œå¹¶é€šè¿‡Adapterå°†å…¶æäº¤åˆ°å®¹å™¨å¤„ç†ï¼Œ Processoræ˜¯å¯¹åº”ç”¨å±‚ï¼ˆä¸ƒå±‚ï¼‰åè®®çš„æŠ½è±¡ã€‚ 7.1.3 ProtocolHandlerProtocolHandleræ˜¯Coyoteçš„åè®®æ¥å£ï¼Œé€šè¿‡Endpointå’ŒProcessor ï¼Œå®ç°å¯¹å…·ä½“åè®®ï¼ˆHTTPæˆ–AJPï¼‰çš„å¤„ç†ã€‚Tomcat æŒ‰ç…§åè®®å’ŒI/O æä¾›äº†6ä¸ªå®ç°ç±» ï¼š AjpNioProtocol ï¼Œ AjpAprProtocolï¼Œ AjpNio2Protocol ï¼Œ Http11NioProtocol ï¼ŒHttp11Nio2Protocol ï¼Œ Http11AprProtocolã€‚æˆ‘ä»¬åœ¨é…ç½®tomcat/conf/server.xml ä¸­çš„connecterå—æ—¶ ï¼Œ è‡³å°‘è¦æŒ‡å®šå…·ä½“çš„ProtocolHandler , å½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šåè®®åç§°ï¼ˆå¦‚HTTP/1.1ï¼‰ã€‚ 7.1.4 Adapterç”±äºåè®®ä¸åŒï¼Œå®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚ä¿¡æ¯ä¹Ÿä¸å°½ç›¸åŒï¼ŒTomcatå®šä¹‰äº†è‡ªå·±çš„Requestç±»æ¥å­˜æ”¾è¿™äº›è¯·æ±‚ä¿¡æ¯ã€‚ProtocolHandleræ¥å£è´Ÿè´£è§£æè¯·æ±‚å¹¶ç”ŸæˆTomcatçš„Requestç±»ã€‚ ä½†æ˜¯è¿™ä¸ªRequestå¯¹è±¡ä¸æ˜¯æ ‡å‡†çš„ServletRequestï¼Œä¸èƒ½ç”¨æ¥ä½œä¸ºå‚æ•°æ¥è°ƒç”¨å®¹å™¨ã€‚å› æ­¤éœ€è¦å¼•å…¥CoyoteAdapterï¼Œè¿æ¥å™¨è°ƒç”¨CoyoteAdapterçš„Seviceæ–¹æ³•ï¼Œä¼ å…¥Tomcatçš„Requestå¯¹è±¡ï¼ŒCoyoteAdapterå°†Requestè½¬æˆServletRequestï¼Œå†è°ƒç”¨å®¹å™¨çš„Serviceæ–¹æ³•ã€‚ 7.2 connectorçš„å‡ ä¸ªé‡è¦å‚æ•°7.2.1 connectionTimeout The number of milliseconds this Connector will wait, after accepting a connection, for the request URI line to be presented. Use a value of -1 to indicate no (i.e. infinite) timeout. The default value is 60000 (i.e. 60 seconds) but note that the standard server.xml that ships with Tomcat sets this to 20000 (i.e. 20 seconds). Unless disableUploadTimeout is set to false, this timeout will also be used when reading the request body (if any). åœ¨connectorå’Œè¯·æ±‚çš„å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ä¹‹åå¼€å§‹è®¡æ—¶ï¼Œå½“è¶…è¿‡è¯¥å€¼çš„æ—¶å€™å°±ä¼šè¶…æ—¶ï¼Œç„¶åæ–­å¼€è¿æ¥ã€‚ä½¿ç”¨å€¼-1è¡¨ç¤ºæ— è¶…æ—¶ï¼Œé»˜è®¤å€¼ä¸º60000ï¼ˆå³60ç§’ï¼‰ï¼Œä½†Tomcatä¸­çš„server.xmlå°†æ­¤å€¼è®¾ç½®ä¸º20000ï¼ˆå³20ç§’ï¼‰ã€‚ é™¤édisableUploadTimeoutè®¾ç½®ä¸ºfalseï¼Œå¦åˆ™åœ¨è¯»å–è¯·æ±‚æ­£æ–‡ï¼ˆå¦‚æœæœ‰ï¼‰æ—¶ä¹Ÿä¼šä½¿ç”¨æ­¤è¶…æ—¶ã€‚ 7.2.2 maxThreads The maximum number of request processing threads to be created by this Connector, which therefore determines the maximum number of simultaneous requests that can be handled. If not specified, this attribute is set to 200. If an executor is associated with this connector, this attribute is ignored as the connector will execute tasks using the executor rather than an internal thread pool. Note that if an executor is configured any value set for this attribute will be recorded correctly but it will be reported (e.g. via JMX) as -1 to make clear that it is not used. æœ€å¤§çº¿ç¨‹æ•°ï¼Œå¤§å¹¶å‘è¯·æ±‚æ—¶ï¼Œtomcatèƒ½åˆ›å»ºæ¥å¤„ç†è¯·æ±‚çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œè¶…è¿‡åˆ™æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­è¿›è¡Œæ’é˜Ÿï¼Œé»˜è®¤å€¼ä¸º200ã€‚ 7.2.3 acceptCount The maximum queue length for incoming connection requests when all possible request processing threads are in use. Any requests received when the queue is full will be refused. The default value is 100. å½“æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaxThreadsï¼‰è¢«ä½¿ç”¨å®Œæ—¶ï¼Œå¯ä»¥æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—æ’é˜Ÿä¸ªæ•°ï¼Œè¶…è¿‡è¿™ä¸ªæ•°è¿”å›connection refusedï¼ˆè¯·æ±‚è¢«æ‹’ç»ï¼‰ï¼Œé»˜è®¤å€¼ä¸º100ï¼› 7.2.4 maxConnections The maximum number of connections that the server will accept and process at any given time. When this number has been reached, the server will accept, but not process, one further connection. This additional connection be blocked until the number of connections being processed falls below maxConnections at which point the server will start accepting and processing new connections again. Note that once the limit has been reached, the operating system may still accept connections based on the acceptCount setting. The default value is 8192.For NIO/NIO2 only, setting the value to -1, will disable the maxConnections feature and connections will not be counted. Tomcatåœ¨ä»»æ„æ—¶åˆ»æ¥æ”¶å’Œå¤„ç†çš„æœ€å¤§è¿æ¥æ•°ã€‚å½“Tomcatæ¥æ”¶çš„è¿æ¥æ•°è¾¾åˆ°maxConnectionsæ—¶ï¼ŒAcceptorçº¿ç¨‹ä¸ä¼šè¯»å–accepté˜Ÿåˆ—ä¸­çš„è¿æ¥ï¼›è¿™æ—¶accepté˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ç€ï¼Œç›´åˆ°Tomcatæ¥æ”¶çš„è¿æ¥æ•°å°äºmaxConnectionsã€‚é»˜è®¤å€¼ä¸º8192ã€‚ å¯¹äºNIO / NIO2ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸º-1å°†ç¦ç”¨maxConnectionsåŠŸèƒ½ï¼Œå¹¶ä¸”ä¸è®¡ç®—è¿æ¥æ•°ã€‚ 7.2.5 å›¾è§£æŒ‰ç…§è¢«å¤„ç†çš„å…ˆåé¡ºåºæˆ‘ä»¬å¯ä»¥æŠŠtomcatä¸­çš„çº¿ç¨‹é˜Ÿåˆ—å’Œä»¥ä¸Šå››ä¸ªå‚æ•°ä½¿ç”¨è¯¥å›¾è¿›è¡Œè¡¨ç¤º å½“maxThreads + acceptCount &lt; maxConnectionsçš„æ—¶å€™å°†ä¸ä¼šæœ‰çº¿ç¨‹è¢«é˜»å¡ å½“é˜»å¡çš„çº¿ç¨‹æ—¶é—´è¶…è¿‡connectionTimeoutè¿˜æ²¡å¾—åˆ°è¿”å›å€¼å°†è¿”å›è¿æ¥è¶…æ—¶ 8ã€å¸¸è§çš„æœåŠ¡å™¨I/Oæ¨¡å‹åœ¨å¼€å§‹äº†è§£Tomcatçš„I/Oæ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹æœåŠ¡å™¨ä¸­å¸¸è§çš„I/Oæ¨¡å‹è¿›è¡Œç®€å•ä»‹ç»ã€‚ 8.1 é˜»å¡I/Oå¤„ç†æ¨¡å‹8.1.1 å•çº¿ç¨‹é˜»å¡I/Oæ¨¡å‹å•çº¿ç¨‹é˜»å¡I/Oæ¨¡å‹æ˜¯æœ€ç®€å•çš„ä¸€ç§æœåŠ¡å™¨I/Oæ¨¡å‹ï¼Œå•çº¿ç¨‹å³åŒæ—¶åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œé˜»å¡å³è¯¥çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å¤„ç†å®Œæˆä¸ºæ­¢ã€‚å¯¹äºå¤šä¸ªå®¢æˆ·ç«¯è®¿é—®ï¼Œå¿…é¡»è¦ç­‰åˆ°å‰ä¸€ä¸ªå®¢æˆ·ç«¯è®¿é—®ç»“æŸæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªè®¿é—®çš„å¤„ç†ï¼Œè¯·æ±‚ä¸€ä¸ªä¸€ä¸ªæ’é˜Ÿï¼Œåªæä¾›ä¸€é—®ä¸€ç­”æœåŠ¡ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šè¿™æ˜¯ä¸€ä¸ªåŒæ­¥é˜»å¡æœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯è®¿é—®çš„æ—¶é—´èŠ‚ç‚¹å›¾ã€‚ é¦–å…ˆï¼ŒæœåŠ¡å™¨å¿…é¡»åˆå§‹åŒ–ä¸€ä¸ªå¥—æ¥å­—æœåŠ¡å™¨ï¼Œå¹¶ç»‘å®šæŸä¸ªç«¯å£å·å¹¶ä½¿ä¹‹ç›‘å¬å®¢æˆ·ç«¯çš„è®¿é—® æ¥ç€ï¼Œå®¢æˆ·ç«¯1è°ƒç”¨æœåŠ¡å™¨çš„æœåŠ¡ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œåå†™æ•°æ®å›å®¢æˆ·ç«¯1ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œé¢å®Œæˆçš„ æœ€åï¼Œå¤„ç†å®¢æˆ·ç«¯2çš„è¯·æ±‚å¹¶å†™æ•°æ®å›å®¢æˆ·ç«¯2ï¼ŒæœŸé—´å°±ç®—å®¢æˆ·ç«¯2åœ¨æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·ç«¯1ä¹‹å‰å°±è¿›è¡Œè¯·æ±‚ï¼Œä¹Ÿè¦ç­‰æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯1å“åº”å®Œåæ‰ä¼šå¯¹å®¢æˆ·ç«¯2è¿›è¡Œå“åº”å¤„ç† è¿™ç§æ¨¡å‹çš„ç‰¹ç‚¹åœ¨äºå•çº¿ç¨‹å’Œé˜»å¡I/Oã€‚å•çº¿ç¨‹å³æœåŠ¡å™¨ç«¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯çš„æ‰€æœ‰è¯·æ±‚ï¼Œå®¢æˆ·ç«¯è¿æ¥ä¸æœåŠ¡å™¨ç«¯çš„å¤„ç†çº¿ç¨‹æ¯”æ˜¯n:1ï¼Œå®ƒæ— æ³•åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ï¼Œåªèƒ½ä¸²è¡Œå¤„ç†è¿æ¥ã€‚è€Œé˜»å¡I/Oæ˜¯æŒ‡æœåŠ¡å™¨åœ¨è¯»å†™æ•°æ®æ—¶æ˜¯é˜»å¡çš„ï¼Œè¯»å–å®¢æˆ·ç«¯æ•°æ®æ—¶è¦ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ®å¹¶ä¸”æŠŠæ“ä½œç³»ç»Ÿå†…æ ¸å¤åˆ¶åˆ°ç”¨æˆ·è¿›ç¨‹ä¸­ï¼Œè¿™æ—¶æ‰è§£é™¤é˜»å¡çŠ¶æ€ã€‚å†™æ•°æ®å›å®¢æˆ·ç«¯æ—¶è¦ç­‰å¾…ç”¨æˆ·è¿›ç¨‹å°†æ•°æ®å†™å…¥å†…æ ¸å¹¶å‘é€åˆ°å®¢æˆ·ç«¯åæ‰è§£é™¤é˜»å¡çŠ¶æ€ã€‚è¿™ç§é˜»å¡å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼ŒæœåŠ¡å™¨å¿…é¡»è¦ç­‰åˆ°å®¢æˆ·ç«¯æˆåŠŸæ¥æ”¶æ‰èƒ½ç»§ç»­å¾€ä¸‹å¤„ç†å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œåœ¨æ­¤æœŸé—´çº¿ç¨‹å°†æ— æ³•å“åº”ä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚ã€‚ è¯¥æ¨¡å‹çš„ç‰¹ç‚¹ï¼šå®ƒæ˜¯æœ€ç®€å•çš„æœåŠ¡å™¨æ¨¡å‹ï¼Œæ•´ä¸ªè¿è¡Œè¿‡ç¨‹éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œåªèƒ½æ”¯æŒåŒæ—¶å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚(å¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯è®¿é—®ï¼Œå°±å¿…é¡»æ’é˜Ÿç­‰å¾…)ï¼ŒæœåŠ¡å™¨ç³»ç»Ÿèµ„æºæ¶ˆè€—è¾ƒå°ï¼Œä½†å¹¶å‘èƒ½åŠ›ä½ï¼Œå®¹é”™èƒ½åŠ›å·®ã€‚ 8.1.2 å¤šçº¿ç¨‹é˜»å¡I/Oæ¨¡å‹å¤šçº¿ç¨‹é˜»å¡I/Oæ¨¡å‹åœ¨å•çº¿ç¨‹é˜»å¡I/Oæ¨¡å‹çš„åŸºç¡€ä¸Šå¯¹å…¶è¿›è¡Œæ”¹è¿›ï¼ŒåŠ å…¥å¤šçº¿ç¨‹ï¼Œæé«˜å¹¶å‘èƒ½åŠ›ï¼Œä½¿å…¶èƒ½å¤ŸåŒæ—¶å¯¹å¤šä¸ªå®¢æˆ·ç«¯è¿›è¡Œå“åº”ï¼Œå¤šçº¿ç¨‹çš„æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨å¤šçº¿ç¨‹æœºåˆ¶ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªçº¿ç¨‹ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæœåŠ¡å™¨ç«¯å¼€å§‹ç›‘å¬å®¢æˆ·ç«¯çš„è®¿é—®ï¼Œå‡å¦‚æœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘é€è¯·æ±‚è¿‡æ¥ï¼ŒæœåŠ¡å™¨ç«¯åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ååˆ†åˆ«åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹å¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ï¼Œæ¯æ¡çº¿ç¨‹è´Ÿè´£ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œç›´åˆ°å“åº”å®Œæˆã€‚æœŸé—´ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘åœ°ä¸ºå„è‡ªå¯¹åº”çš„å®¢æˆ·ç«¯å¤„ç†è¯·æ±‚ï¼ŒåŒ…æ‹¬è¯»å–å®¢æˆ·ç«¯æ•°æ®ã€å¤„ç†å®¢æˆ·ç«¯æ•°æ®ã€å†™æ•°æ®å›å®¢æˆ·ç«¯ç­‰æ“ä½œã€‚ è¿™ç§æ¨¡å‹çš„I/Oæ“ä½œä¹Ÿæ˜¯é˜»å¡çš„ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°è¯»å–æˆ–å†™å…¥æ“ä½œæ—¶éƒ½å°†è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°è¯»å–åˆ°å®¢æˆ·ç«¯çš„æ•°æ®æˆ–æ•°æ®æˆåŠŸå†™å…¥å®¢æˆ·ç«¯åæ‰è§£é™¤é˜»å¡çŠ¶æ€ã€‚å°½ç®¡I/Oæ“ä½œé˜»å¡ï¼Œä½†è¿™ç§æ¨¡å¼æ¯”å•çº¿ç¨‹å¤„ç†çš„æ€§èƒ½æ˜æ˜¾é«˜äº†ï¼Œå®ƒä¸ç”¨ç­‰åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œæ‰å¤„ç†ç¬¬äºŒä¸ªï¼Œè€Œæ˜¯å¹¶å‘åœ°å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå®¢æˆ·ç«¯è¿æ¥ä¸æœåŠ¡å™¨ç«¯å¤„ç†çº¿ç¨‹çš„æ¯”ä¾‹æ˜¯1:1ã€‚ å¤šçº¿ç¨‹é˜»å¡I/Oæ¨¡å‹çš„ç‰¹ç‚¹ï¼šæ”¯æŒå¯¹å¤šä¸ªå®¢æˆ·ç«¯å¹¶å‘å“åº”ï¼Œå¤„ç†èƒ½åŠ›å¾—åˆ°å¤§å¹…æé«˜ï¼Œæœ‰è¾ƒå¤§çš„å¹¶å‘é‡ï¼Œä½†æœåŠ¡å™¨ç³»ç»Ÿèµ„æºæ¶ˆè€—é‡è¾ƒå¤§ï¼Œè€Œä¸”å¦‚æœçº¿ç¨‹æ•°è¿‡å¤šï¼Œå¤šçº¿ç¨‹ä¹‹é—´ä¼šäº§ç”Ÿè¾ƒå¤§çš„çº¿ç¨‹åˆ‡æ¢æˆæœ¬ï¼ŒåŒæ—¶æ‹¥æœ‰è¾ƒå¤æ‚çš„ç»“æ„ã€‚ 8.2 éé˜»å¡I/Oæ¨¡å‹8.2.1 éé˜»å¡æƒ…å†µä¸‹çš„äº‹ä»¶æ£€æµ‹åœ¨æ¢è®¨å•çº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹å‰å¿…é¡»è¦å…ˆäº†è§£éé˜»å¡æƒ…å†µä¸‹å¥—æ¥å­—äº‹ä»¶çš„æ£€æµ‹æœºåˆ¶ï¼Œå› ä¸ºå¯¹äºå•çº¿ç¨‹éé˜»å¡æ¨¡å‹æœ€é‡è¦çš„äº‹æƒ…æ˜¯æ£€æµ‹å“ªäº›è¿æ¥æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿã€‚ä¸€èˆ¬ä¼šæœ‰å¦‚ä¸‹ä¸‰ç§æ£€æµ‹æ–¹å¼ã€‚ æ­¤å¤„â€œæœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿâ€æŒ‡çš„æ˜¯éœ€è¦è¿›è¡Œè¯»å†™æ•°æ®ç­‰æ“ä½œã€‚ (1)åº”ç”¨ç¨‹åºéå†å¥—æ¥å­—çš„äº‹ä»¶æ£€æµ‹å½“å¤šä¸ªå®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¼šä¿å­˜ä¸€ä¸ªå¥—æ¥å­—è¿æ¥åˆ—è¡¨ä¸­ï¼Œåº”ç”¨å±‚çº¿ç¨‹å¯¹å¥—æ¥å­—åˆ—è¡¨è½®è¯¢å°è¯•è¯»å–æˆ–å†™å…¥ã€‚å¦‚æœæˆåŠŸåˆ™è¿›è¡Œå¤„ç†ï¼Œå¦‚æœå¤±è´¥åˆ™ä¸‹æ¬¡ç»§ç»­ã€‚è¿™æ ·ä¸ç®¡æœ‰å¤šå°‘ä¸ªå¥—æ¥å­—è¿æ¥ï¼Œå®ƒä»¬éƒ½å¯ä»¥è¢«ä¸€ä¸ªçº¿ç¨‹ç®¡ç†ï¼Œè¿™å¾ˆå¥½åœ°åˆ©ç”¨äº†é˜»å¡çš„æ—¶é—´ï¼Œå¤„ç†èƒ½åŠ›å¾—åˆ°æå‡ã€‚ ä½†è¿™ç§æ¨¡å‹éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­éå†æ‰€æœ‰çš„å¥—æ¥å­—åˆ—è¡¨ï¼ŒåŒæ—¶éœ€è¦å¤„ç†æ•°æ®çš„æ‹¼æ¥ï¼Œè¿æ¥ç©ºé—²æ—¶å¯èƒ½ä¹Ÿä¼šå ç”¨è¾ƒå¤šCPUèµ„æºï¼Œä¸é€‚åˆå®é™…ä½¿ç”¨ã€‚ (2)å†…æ ¸éå†å¥—æ¥å­—çš„äº‹ä»¶æ£€æµ‹è¿™ç§æ–¹å¼å°†å¥—æ¥å­—çš„éå†å·¥ä½œäº¤ç»™äº†æ“ä½œç³»ç»Ÿå†…æ ¸ï¼ŒæŠŠå¯¹å¥—æ¥å­—éå†çš„ç»“æœç»„ç»‡æˆä¸€ç³»åˆ—çš„äº‹ä»¶åˆ—è¡¨å¹¶è¿”å›åº”ç”¨å±‚å¤„ç†ã€‚å¯¹äºåº”ç”¨å±‚ï¼Œå®ƒä»¬éœ€è¦å¤„ç†çš„å¯¹è±¡å°±æ˜¯è¿™äº›äº‹ä»¶ï¼Œè¿™æ˜¯ä¸€ç§äº‹ä»¶é©±åŠ¨çš„éé˜»å¡æ–¹å¼ã€‚ æœåŠ¡å™¨ç«¯æœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œåº”ç”¨å±‚å‘å†…æ ¸è¯·æ±‚è¯»å†™äº‹ä»¶åˆ—è¡¨ã€‚å†…æ ¸éå†æ‰€æœ‰å¥—æ¥å­—å¹¶ç”Ÿæˆå¯¹åº”çš„å¯è¯»åˆ—è¡¨readListå’Œå¯å†™åˆ—è¡¨writeListã€‚readListå’ŒwriteListåˆ™æ ‡æ˜äº†æ¯ä¸ªå¥—æ¥å­—æ˜¯å¦å¯è¯»/å¯å†™ã€‚åº”ç”¨å±‚éå†è¯»å†™äº‹ä»¶åˆ—è¡¨readListå’ŒwriteListï¼Œåšç›¸åº”çš„è¯»å†™æ“ä½œã€‚ å†…æ ¸éå†å¥—æ¥å­—æ—¶å·²ç»ä¸ç”¨åœ¨åº”ç”¨å±‚å¯¹æ‰€æœ‰å¥—æ¥å­—è¿›è¡Œéå†ï¼Œå°†éå†å·¥ä½œä¸‹ç§»åˆ°å†…æ ¸å±‚ï¼Œè¿™ç§æ–¹å¼æœ‰åŠ©äºæé«˜æ£€æµ‹æ•ˆç‡ã€‚ç„¶è€Œï¼Œå®ƒéœ€è¦å°†æ‰€æœ‰è¿æ¥çš„å¯è¯»äº‹ä»¶åˆ—è¡¨å’Œå¯å†™äº‹ä»¶åˆ—è¡¨ä¼ åˆ°åº”ç”¨å±‚ï¼Œå‡å¦‚å¥—æ¥å­—è¿æ¥æ•°é‡å˜å¤§ï¼Œåˆ—è¡¨ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨å±‚ä¹Ÿæ˜¯ä¸å°çš„å¼€é”€ã€‚å¦å¤–ï¼Œå½“æ´»è·ƒè¿æ¥è¾ƒå°‘æ—¶ï¼Œå†…æ ¸ä¸åº”ç”¨å±‚ä¹‹é—´å­˜åœ¨å¾ˆå¤šæ— æ•ˆçš„æ•°æ®å‰¯æœ¬ï¼Œå› ä¸ºå®ƒå°†æ´»è·ƒå’Œä¸æ´»è·ƒçš„è¿æ¥çŠ¶æ€éƒ½å¤åˆ¶åˆ°åº”ç”¨å±‚ä¸­ã€‚ (3)å†…æ ¸åŸºäºå›è°ƒçš„äº‹ä»¶æ£€æµ‹é€šè¿‡éå†çš„æ–¹å¼æ£€æµ‹å¥—æ¥å­—æ˜¯å¦å¯è¯»å¯å†™æ˜¯ä¸€ç§æ•ˆç‡æ¯”è¾ƒä½çš„æ–¹å¼ï¼Œä¸ç®¡æ˜¯åœ¨åº”ç”¨å±‚ä¸­éå†è¿˜æ˜¯åœ¨å†…æ ¸ä¸­éå†ã€‚æ‰€ä»¥éœ€è¦å¦å¤–ä¸€ç§æœºåˆ¶æ¥ä¼˜åŒ–éå†çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯å›è°ƒå‡½æ•°ã€‚å†…æ ¸ä¸­çš„å¥—æ¥å­—éƒ½å¯¹åº”ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å®¢æˆ·ç«¯å¾€å¥—æ¥å­—å‘é€æ•°æ®æ—¶ï¼Œå†…æ ¸ä»ç½‘å¡æ¥æ”¶æ•°æ®åå°±ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­ç»´æŠ¤äº‹ä»¶åˆ—è¡¨ï¼Œåº”ç”¨å±‚è·å–æ­¤äº‹ä»¶åˆ—è¡¨å³å¯å¾—åˆ°æ‰€æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚ å†…æ ¸åŸºäºå›è°ƒçš„äº‹ä»¶æ£€æµ‹æ–¹å¼æœ‰ä¸¤ç§ æ–¹å¼ä¸€ï¼šç¬¬ä¸€ç§æ˜¯ç”¨å¯è¯»åˆ—è¡¨readListå’Œå¯å†™åˆ—è¡¨writeListæ ‡è®°è¯»å†™äº‹ä»¶ï¼Œå¥—æ¥å­—çš„æ•°é‡ä¸readListå’ŒwriteListä¸¤ä¸ªåˆ—è¡¨çš„é•¿åº¦ä¸€æ ·ã€‚ æœåŠ¡å™¨ç«¯æœ‰å¤šä¸ªå®¢æˆ·ç«¯å¥—æ¥å­—è¿æ¥ å½“å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥æ—¶ï¼Œå†…æ ¸ä»ç½‘å¡å¤åˆ¶æ•°æ®æˆåŠŸåè°ƒç”¨å›è°ƒå‡½æ•°å°†readList/writeListå¯¹åº”çš„å…ƒç´ æ ‡è®°ä¸ºå¯è¯»/å¯å†™ åº”ç”¨å±‚å‘é€è¯·æ±‚è¯»ã€å†™äº‹ä»¶åˆ—è¡¨ï¼Œå†…æ ¸è¿”å›åŒ…å«äº†äº‹ä»¶æ ‡è¯†çš„readListå’ŒwriteListäº‹ä»¶åˆ—è¡¨ï¼Œæ­¤æ—¶è¿”å›çš„ä¸¤ä¸ªåˆ—è¡¨å†…å®¹å¤§è‡´å¦‚ä¸‹ å¥—æ¥å­— readList 1 1 2 0 3 1 â€¦â€¦ â€¦â€¦ n â€¦â€¦ å¥—æ¥å­— writeList 1 0 2 1 3 0 â€¦â€¦ â€¦â€¦ n â€¦â€¦ åº”ç”¨ç¨‹åºæ¥ç€åˆ†è¡¨éå†è¯»äº‹ä»¶åˆ—è¡¨readListå’Œå†™äº‹ä»¶åˆ—è¡¨writeListï¼Œå¯¹ç½®ä¸º1çš„å…ƒç´ å¯¹åº”çš„å¥—æ¥å­—è¿›è¡Œè¯»æˆ–å†™æ“ä½œ è¿™æ ·å°±é¿å…äº†éå†å¥—æ¥å­—çš„æ“ä½œï¼Œä½†ä»ç„¶æœ‰å¤§é‡æ— ç”¨çš„æ•°æ®(çŠ¶æ€ä¸º0çš„å…ƒç´ )ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨å±‚ä¸­ã€‚ä»ä¸Šé¢çš„è¡¨æ ¼ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®é™…ä¸Šæœ‰ç”¨çš„æ•°æ®åªæ˜¯åœ¨Listä¸­è¢«æ ‡è®°ä¸º1çš„æ•°æ®ï¼ˆæ„å‘³ç€å¯è¯»æˆ–å¯å†™ï¼‰ï¼Œå…¶ä»–çš„æ•°æ®å¹¶æ²¡æœ‰ä¼ é€å›å»çš„å¿…è¦ã€‚ æ–¹å¼äºŒï¼š æœåŠ¡å™¨ç«¯æœ‰å¤šä¸ªå®¢æˆ·ç«¯å¥—æ¥å­—è¿æ¥ã€‚ åº”ç”¨å±‚å‘Šè¯‰å†…æ ¸æ¯ä¸ªå¥—æ¥å­—æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œè¿™æ—¶å€™ç›´æ¥å‘é€ä¸€ä¸ªåˆ—è¡¨ç»™å†…æ ¸ å¥—æ¥å­— æ“ä½œ 1 read 2 write 3 read â€¦â€¦ â€¦â€¦ n â€¦â€¦ æ¥ç€ï¼Œå½“å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥æ—¶ï¼Œå¯¹åº”ä¼šæœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå†…æ ¸ä»ç½‘å¡å¤åˆ¶æ•°æ®æˆåŠŸåå³è°ƒå›è°ƒå‡½æ•°å°†å¥—æ¥å­—1ä½œä¸ºå¯è¯»äº‹ä»¶event1åŠ å…¥åˆ°äº‹ä»¶åˆ—è¡¨ï¼ŒåŒæ ·åœ°ï¼Œå†…æ ¸å‘ç°ç½‘å¡å¯å†™æ—¶å°±å°†å¥—æ¥å­—2ä½œä¸ºå¯å†™äº‹ä»¶event2æ·»åŠ åˆ°äº‹ä»¶åˆ—è¡¨ä¸­ åº”ç”¨å±‚å‘å†…æ ¸è¯·æ±‚è¯»ã€å†™äº‹ä»¶åˆ—è¡¨ï¼Œå†…æ ¸å°†åŒ…å«äº†event1å’Œevent2çš„äº‹ä»¶åˆ—è¡¨è¿”å›åº”ç”¨å±‚ï¼Œæ­¤æ—¶çš„åˆ—è¡¨å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š å¥—æ¥å­— å¯ä»¥è¿›è¡Œçš„æ“ä½œ 1 read 2 write æ³¨æ„è¿™æ—¶ä¸èƒ½è¿›è¡Œè¯»å†™æ“ä½œçš„å¥—æ¥å­—æ˜¯ä¸ä¼šè¢«è®°å½•åˆ°åˆ—è¡¨ä¸­è¿”å›ç»™åº”ç”¨å±‚çš„ï¼Œè¿™å°±å¤§å¤§åœ°å‡å°‘äº†æ•°æ®çš„ä¼ è¾“é‡ã€‚ åº”ç”¨å±‚é€šè¿‡éå†äº‹ä»¶åˆ—è¡¨å¾—çŸ¥å“ªäº›å¥—æ¥å­—å¯ä»¥è¿›è¡Œå“ªäº›æ“ä½œï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚ ä¸Šé¢ä¸¤ç§æ–¹å¼ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç»´æŠ¤å®¢æˆ·ç«¯çš„æ‰€æœ‰è¿æ¥å¹¶é€šè¿‡å›è°ƒå‡½æ•°ä¸æ–­æ›´æ–°äº‹ä»¶åˆ—è¡¨ï¼Œè€Œåº”ç”¨å±‚çº¿ç¨‹åªè¦éå†è¿™äº›äº‹ä»¶åˆ—è¡¨å³å¯çŸ¥é“å¯è¯»å–æˆ–å¯å†™å…¥çš„è¿æ¥ï¼Œè¿›è€Œå¯¹è¿™äº›è¿æ¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œæå¤§æé«˜äº†æ£€æµ‹æ•ˆç‡ï¼Œè‡ªç„¶å¤„ç†èƒ½åŠ›ä¹Ÿæ›´å¼ºã€‚ 8.2.2 å•çº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹å•çº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹æœ€é‡è¦çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œåœ¨è°ƒç”¨è¯»å–æˆ–å†™å…¥æ¥å£åç«‹å³è¿”å›ï¼Œè€Œä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚è™½ç„¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å®ƒé€šè¿‡æŠŠéé˜»å¡è¯»å†™æ“ä½œä¸ä¸Šé¢å‡ ç§æ£€æµ‹æœºåˆ¶é…åˆå°±å¯ä»¥å®ç°å¯¹å¤šä¸ªè¿æ¥çš„åŠæ—¶å¤„ç†ï¼Œè€Œä¸ä¼šå› ä¸ºæŸä¸ªè¿æ¥çš„é˜»å¡æ“ä½œå¯¼è‡´å…¶ä»–è¿æ¥æ— æ³•å¤„ç†ã€‚åœ¨å®¢æˆ·ç«¯è¿æ¥å¤§å¤šæ•°éƒ½ä¿æŒæ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªçº¿ç¨‹ä¼šä¸€ç›´å¾ªç¯å¤„ç†è¿™äº›è¿æ¥ï¼Œå®ƒå¾ˆå¥½åœ°åˆ©ç”¨äº†é˜»å¡çš„æ—¶é—´ï¼Œå¤§å¤§æé«˜äº†è¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚ å•çº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹çš„ä¸»è¦ä¼˜åŠ¿ä½“ç°åœ¨å¯¹å¤šä¸ªè¿æ¥çš„ç®¡ç†ï¼Œä¸€èˆ¬åœ¨åŒæ—¶éœ€è¦å¤„ç†å¤šä¸ªè¿æ¥çš„å‘åœºæ™¯ä¸­ä¼šä½¿ç”¨éé˜»å¡NIOæ¨¡å¼ï¼Œæ­¤æ¨¡å‹ä¸‹åªé€šè¿‡ä¸€ä¸ªçº¿ç¨‹å»ç»´æŠ¤å’Œå¤„ç†è¿æ¥ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†æœºå™¨çš„æ•ˆç‡ã€‚ä¸€èˆ¬æœåŠ¡å™¨ç«¯æ‰ä¼šä½¿ç”¨NIOæ¨¡å¼ï¼Œè€Œå¯¹äºå®¢æˆ·ç«¯ï¼Œå‡ºäºæ–¹ä¾¿åŠä¹ æƒ¯ï¼Œå¯ä½¿ç”¨é˜»å¡æ¨¡å¼çš„å¥—æ¥å­—è¿›è¡Œé€šä¿¡ã€‚ 8.2.3 å¤šçº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹åœ¨å¤šæ ¸çš„æœºå™¨ä¸Šå¯ä»¥é€šè¿‡å¤šçº¿ç¨‹ç»§ç»­æé«˜æœºå™¨æ•ˆç‡ã€‚æœ€æœ´å®ã€æœ€è‡ªç„¶çš„åšæ³•å°±æ˜¯å°†å®¢æˆ·ç«¯è¿æ¥æŒ‰ç»„åˆ†é…ç»™è‹¥å¹²çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£å¤„ç†å¯¹åº”ç»„å†…çš„è¿æ¥ã€‚æ¯”å¦‚æœ‰4ä¸ªå®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†å¥—æ¥å­—1å’Œå¥—æ¥å­—2äº¤ç”±çº¿ç¨‹1ç®¡ç†ï¼Œè€Œçº¿ç¨‹2åˆ™ç®¡ç†å¥—æ¥å­—3å’Œå¥—æ¥å­—4ï¼Œé€šè¿‡äº‹ä»¶æ£€æµ‹åŠéé˜»å¡è¯»å†™å°±å¯ä»¥è®©æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½é«˜æ•ˆå¤„ç†ã€‚ å¤šçº¿ç¨‹éé˜»å¡I/Oæ¨¡å¼è®©æœåŠ¡å™¨ç«¯å¤„ç†èƒ½åŠ›å¾—åˆ°å¾ˆå¤§æé«˜ï¼Œå®ƒå……åˆ†åˆ©ç”¨æœºå™¨çš„CPUï¼Œé€‚åˆç”¨äºå¤„ç†é«˜å¹¶å‘çš„åœºæ™¯ï¼Œä½†å®ƒä¹Ÿè®©ç¨‹åºæ›´å¤æ‚ï¼Œæ›´å®¹æ˜“å‡ºç°é—®é¢˜ï¼ˆæ­»é”ã€æ•°æ®ä¸ä¸€è‡´ç­‰ç»å…¸å¹¶å‘é—®é¢˜ï¼‰ã€‚ 8.2.4 Reactoræ¨¡å¼æœ€ç»å…¸çš„å¤šçº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹æ–¹å¼æ˜¯Reactoræ¨¡å¼ã€‚é¦–å…ˆçœ‹å•çº¿ç¨‹ä¸‹çš„Reactorï¼ŒReactorå°†æœåŠ¡å™¨ç«¯çš„æ•´ä¸ªå¤„ç†è¿‡ç¨‹åˆ†æˆè‹¥å¹²ä¸ªäº‹ä»¶ï¼Œä¾‹å¦‚åˆ†ä¸ºæ¥æ”¶äº‹ä»¶ã€è¯»äº‹ä»¶ã€å†™äº‹ä»¶ã€æ‰§è¡Œäº‹ä»¶ç­‰ã€‚Reactoré€šè¿‡äº‹ä»¶æ£€æµ‹æœºåˆ¶å°†è¿™äº›äº‹ä»¶åˆ†å‘ç»™ä¸åŒå¤„ç†å™¨å»å¤„ç†ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­åªè¦æœ‰å¾…å¤„ç†çš„äº‹ä»¶å­˜åœ¨ï¼Œå³å¯ä»¥è®©Reactorçº¿ç¨‹ä¸æ–­å¾€ä¸‹æ‰§è¡Œï¼Œè€Œä¸ä¼šé˜»å¡åœ¨æŸå¤„ï¼Œæ‰€ä»¥å¤„ç†æ•ˆç‡å¾ˆé«˜ã€‚ åŸºäºå•çº¿ç¨‹Reactoræ¨¡å‹ï¼Œæ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯ï¼ŒæŠŠå®ƒæ”¹è¿›æˆå¤šçº¿ç¨‹æ¨¡å¼ã€‚å¸¸è§çš„æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯åœ¨è€—æ—¶çš„processå¤„ç†å™¨ä¸­å¼•å…¥å¤šçº¿ç¨‹ï¼Œå¦‚ä½¿ç”¨çº¿ç¨‹æ± ï¼›å¦ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨å¤šä¸ªReactorå®ä¾‹ï¼Œæ¯ä¸ªReactorå®ä¾‹å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚ Reactoræ¨¡å¼çš„ä¸€ç§æ”¹è¿›æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…¶æ•´ä½“ç»“æ„åŸºæœ¬ä¸Šä¸å•çº¿ç¨‹çš„Reactorç±»ä¼¼ï¼Œåªæ˜¯å¼•å…¥äº†ä¸€ä¸ªçº¿ç¨‹æ± ã€‚ç”±äºå¯¹è¿æ¥çš„æ¥æ”¶ã€å¯¹æ•°æ®çš„è¯»å–å’Œå¯¹æ•°æ®çš„å†™å…¥ç­‰æ“ä½œåŸºæœ¬ä¸Šéƒ½è€—æ—¶è¾ƒå°‘ï¼Œå› æ­¤æŠŠå®ƒä»¬éƒ½æ”¾åˆ°Reactorçº¿ç¨‹ä¸­å¤„ç†ã€‚ç„¶è€Œï¼Œå¯¹äºé€»è¾‘å¤„ç†å¯èƒ½æ¯”è¾ƒè€—æ—¶çš„å·¥ä½œï¼Œå¯ä»¥åœ¨processå¤„ç†å™¨ä¸­å¼•å…¥çº¿ç¨‹æ± ï¼Œprocesså¤„ç†å™¨è‡ªå·±ä¸æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯äº¤ç»™çº¿ç¨‹æ± ï¼Œä»è€Œåœ¨Reactorçº¿ç¨‹ä¸­é¿å…äº†è€—æ—¶çš„æ“ä½œã€‚å°†è€—æ—¶çš„æ“ä½œè½¬ç§»åˆ°çº¿ç¨‹æ± ä¸­åï¼Œå°½ç®¡Reactoråªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¹Ÿèƒ½ä¿è¯Reactorçš„é«˜æ•ˆã€‚ Reactoræ¨¡å¼çš„å¦ä¸€ç§æ”¹è¿›æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…¶ä¸­æœ‰å¤šä¸ªReactorå®ä¾‹ï¼Œæ¯ä¸ªReactorå®ä¾‹å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚å› ä¸ºæ¥æ”¶äº‹ä»¶æ˜¯ç›¸å¯¹äºæœåŠ¡å™¨ç«¯è€Œè¨€çš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯çš„è¿æ¥æ¥æ”¶å·¥ä½œç»Ÿä¸€ç”±ä¸€ä¸ªacceptå¤„ç†å™¨è´Ÿè´£ï¼Œacceptå¤„ç†å™¨ä¼šå°†æ¥æ”¶çš„å®¢æˆ·ç«¯è¿æ¥å‡åŒ€åˆ†é…ç»™æ‰€æœ‰Reactorå®ä¾‹ï¼Œæ¯ä¸ªReactorå®ä¾‹è´Ÿè´£å¤„ç†åˆ†é…åˆ°è¯¥Reactorä¸Šçš„å®¢æˆ·ç«¯è¿æ¥ï¼ŒåŒ…æ‹¬è¿æ¥çš„è¯»æ•°æ®ã€å†™æ•°æ®å’Œé€»è¾‘å¤„ç†ã€‚è¿™å°±æ˜¯å¤šReactorå®ä¾‹çš„åŸç†ã€‚ 9ã€Tomcatçš„ä¸‰ç§ä¸»è¦I/Oæ¨¡å‹Tomcatæ”¯æŒçš„I/Oæ¨¡å‹å¦‚ä¸‹è¡¨ï¼ˆè‡ª8.5/9.0 ç‰ˆæœ¬èµ·ï¼ŒTomcatç§»é™¤äº†å¯¹BIOçš„æ”¯æŒï¼‰ï¼Œåœ¨ 8.0 ä¹‹å‰ ï¼Œ Tomcat é»˜è®¤é‡‡ç”¨çš„I/Oæ–¹å¼ä¸º BIO ï¼Œ ä¹‹åæ”¹ä¸º NIOã€‚ æ— è®º NIOã€NIO2 è¿˜æ˜¯ APRï¼Œ åœ¨æ€§èƒ½æ–¹é¢å‡ä¼˜äºä»¥å¾€çš„BIOã€‚ IOæ¨¡å‹ æè¿° NIO åŒæ­¥éé˜»å¡I/Oï¼Œé‡‡ç”¨Java NIOç±»åº“å®ç° NIO2 å¼‚æ­¥éé˜»å¡I/Oï¼Œé‡‡ç”¨JDK 7æœ€æ–°çš„NIO2ç±»åº“å®ç° APR é‡‡ç”¨Apacheå¯ç§»æ¤è¿è¡Œåº“å®ç°ï¼Œæ˜¯C/C++ç¼–å†™çš„æœ¬åœ°åº“ï¼Œéœ€è¦å•ç‹¬å®‰è£…APRåº“ åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹tomcatå®˜ç½‘ç»™å‡ºçš„è¿™ä¸‰ç§I/Oæ¨¡å‹çš„å·¥ä½œå‚æ•°çš„ä¸€ä¸ªå¯¹æ¯”å›¾ï¼š è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€èˆ¬è¯´çš„NIOã€NIO2å’ŒAPRä½¿ç”¨çš„æ˜¯éé˜»å¡æ–¹å¼æŒ‡çš„å°±æ˜¯åœ¨è¯»å–è¯·æ±‚æŠ¥å¤´å’Œç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™æ˜¯ä½¿ç”¨çš„éé˜»å¡æ–¹å¼ã€‚ Tomcatçš„NIOæ˜¯åŸºäºI/Oå¤ç”¨ï¼ˆåŒæ­¥I/Oï¼‰æ¥å®ç°çš„ï¼Œè€ŒNIO2æ˜¯ä½¿ç”¨çš„å¼‚æ­¥I/Oã€‚å‚è€ƒç»å…¸ä¹¦ç±ã€ŠUNIXç½‘ç»œç¼–ç¨‹ å·1 å¥—æ¥å­—è”ç½‘APIã€‹ï¼Œä¸¤è€…çš„ä¸»è¦åŸç†å¦‚ä¸‹ï¼š I/Oå¤ç”¨ I/Oå¤ç”¨ï¼ˆI/O multiplexingï¼‰å¯ä»¥è°ƒç”¨selectæˆ–pollï¼Œé˜»å¡åœ¨è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ä¸­çš„æŸä¸€ä¸ªä¹‹ä¸Šï¼Œè€Œä¸æ˜¯é˜»å¡åœ¨çœŸæ­£çš„I/Oç³»ç»Ÿè°ƒç”¨ä¸Šã€‚è¿›ç¨‹é˜»å¡äºselectè°ƒç”¨ï¼Œç­‰å¾…æ•°æ®æŠ¥å¥—æ¥å­—å˜ä¸ºå¯è¯»ã€‚å½“selectè¿”å›å¥—æ¥å­—å¯è¯»è¿™ä¸€æ¡ä»¶æ—¶ï¼Œè¿›ç¨‹è°ƒç”¨recvfromæŠŠæ‰€è¯»æ•°æ®æŠ¥å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºï¼Œå°½ç®¡è¿™é‡Œéœ€è¦ä½¿ç”¨selectå’Œrecvfromä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œä½†æ˜¯ä½¿ç”¨selectçš„å¯ä»¥ç­‰å¾…å¤šä¸ªæè¿°ç¬¦å°±ç»ªï¼Œå³å¯ä»¥ç­‰å¾…å¤šä¸ªè¯·æ±‚ã€‚ å¼‚æ­¥IO å¼‚æ­¥I/Oï¼ˆasynchronous I/Oï¼‰çš„å·¥ä½œæœºåˆ¶æ˜¯ï¼šå‘ŠçŸ¥å†…æ ¸å¯åŠ¨æŸä¸ªæ“ä½œï¼Œå¹¶è®©å†…æ ¸åœ¨æ•´ä¸ªæ“ä½œï¼ˆåŒ…æ‹¬å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨ç¨‹åºçš„ç¼“å†²åŒºï¼‰å®Œæˆåé€šçŸ¥åº”ç”¨ç¨‹åºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¼‚æ­¥I/Oæ¨¡å‹æ˜¯ç”±å†…æ ¸é€šçŸ¥åº”ç”¨è¿›ç¨‹I/Oæ“ä½œä½•æ—¶å®Œæˆã€‚ æœ€åæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„è¿‡ç¨‹ç»“åˆå‰©ä¸‹æ²¡æœ‰æåˆ°çš„ä¸‰ç§UNIXç³»ç»Ÿä¸­çš„IOæ¨¡å‹è¿›è¡Œå¯¹æ¯”å¾—åˆ°ä¸‹å›¾ï¼š 9.1 NIOï¼ˆNew I/O APIsã€åŒæ­¥éé˜»å¡ï¼‰Tomcatä¸­çš„NIOæ¨¡å‹æ˜¯ä½¿ç”¨çš„JAVAçš„NIOç±»åº“ï¼Œå…¶å†…éƒ¨çš„IOå®ç°æ˜¯åŒæ­¥çš„ï¼ˆä¹Ÿå°±æ˜¯åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ•°æ®äº¤æ¢ä¸Šæ˜¯åŒæ­¥æœºåˆ¶ï¼‰ï¼Œé‡‡ç”¨åŸºäºselectorå®ç°çš„å¼‚æ­¥äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼ˆè¿™é‡Œçš„å¼‚æ­¥æŒ‡çš„æ˜¯selectorè¿™ä¸ªå®ç°æ¨¡å‹æ˜¯ä½¿ç”¨çš„å¼‚æ­¥æœºåˆ¶ï¼‰ã€‚è€Œå¯¹äºJavaæ¥è¯´ï¼Œéé˜»å¡I/Oçš„å®ç°å®Œå…¨æ˜¯åŸºäºæ“ä½œç³»ç»Ÿå†…æ ¸çš„éé˜»å¡I/Oï¼Œå®ƒå°†æ“ä½œç³»ç»Ÿçš„éé˜»å¡I/Oçš„å·®å¼‚å±è”½å¹¶æä¾›ç»Ÿä¸€çš„APIï¼Œè®©æˆ‘ä»¬ä¸å¿…å…³å¿ƒæ“ä½œç³»ç»Ÿã€‚JDKä¼šå¸®æˆ‘ä»¬é€‰æ‹©éé˜»å¡I/Oçš„å®ç°æ–¹å¼ã€‚ è¿™é‡Œéœ€è¦æä¸€ä¸‹åŒæ­¥å¼‚æ­¥å’Œé˜»å¡éé˜»å¡çš„æ¦‚å¿µï¼š åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ï¼ŒåŒæ­¥å¼‚æ­¥æŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºå‘èµ·çš„è°ƒç”¨è¯·æ±‚å’Œè·å¾—çš„è¿”å›å€¼æ˜¯å¦ä¸€èµ·è¿”å›ï¼Œå¦‚æœä¸€èµ·è¿”å›å°±æ˜¯åŒæ­¥ï¼Œå¦åˆ™å°±æ˜¯å¼‚æ­¥ï¼Œå¼‚æ­¥å¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°ç­‰æ–¹å¼å®ç°ã€‚ é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœæ—¶çš„çŠ¶æ€ï¼Œåº”ç”¨ç¨‹åºå‘èµ·è°ƒç”¨è¯·æ±‚ä¹‹åä¸èƒ½å¹²åˆ«çš„äº‹æƒ…ç›´åˆ°è¯·æ±‚å¤„ç†å®Œæˆäº†å°±æ˜¯é˜»å¡ï¼Œå¦åˆ™å°±æ˜¯éé˜»å¡ã€‚ æ‰€ä»¥æˆ‘ä¸ªäººè®¤ä¸ºï¼Œå¯¹äºé˜»å¡I/Oè°ˆåŒæ­¥å¼‚æ­¥æ˜¯æ²¡æœ‰å¤ªå¤§æ„ä¹‰çš„ï¼Œå› ä¸ºæ­¤æ—¶è¿›ç¨‹å·²ç»é˜»å¡ï¼Œæƒ³è¦å»å¹²åˆ«çš„äº‹æƒ…å¿…é¡»å¾—ç­‰è¯·æ±‚å¤„ç†å®Œï¼Œè€Œè¯·æ±‚å¤„ç†å®Œå¿…ç„¶ä¼šå¾—åˆ°è¿”å›å€¼ã€‚ ä¸Šé¢æˆ‘ä»¬æåˆ°å¾—å†…æ ¸åŸºäºå›è°ƒå¾—äº‹ä»¶æ£€æµ‹æ–¹å¼äºŒå°±æ˜¯å…¸å‹çš„å¼‚æ­¥éé˜»å¡I/Oæ¨¡å‹ã€‚ 9.2 NIO2ï¼ˆNew I/O APIs 2ã€å¼‚æ­¥éé˜»å¡ã€AIOï¼‰NIO2å’Œå‰è€…ç›¸æ¯”çš„æœ€å¤§ä¸åŒå°±åœ¨äºå¼•å…¥äº†å¼‚æ­¥é€šé“æ¥å®ç°å¼‚æ­¥IOæ“ä½œï¼Œå› æ­¤ä¹Ÿå«AIOï¼ˆAsynchronous I/Oï¼‰ã€‚NIO.2 çš„å¼‚æ­¥é€šé“ APIs æä¾›æ–¹ä¾¿çš„ã€å¹³å°ç‹¬ç«‹çš„æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ ‡å‡†æ–¹æ³•ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜èƒ½å¤Ÿä»¥æ›´æ¸…æ™°çš„æ–¹å¼æ¥ç¼–å†™ç¨‹åºï¼Œè€Œä¸å¿…å®šä¹‰è‡ªå·±çš„ Java çº¿ç¨‹ï¼Œæ­¤å¤–ï¼Œè¿˜å¯é€šè¿‡ä½¿ç”¨åº•å±‚ OS æ‰€æ”¯æŒçš„å¼‚æ­¥åŠŸèƒ½æ¥æé«˜æ€§èƒ½ã€‚å¦‚åŒå…¶ä»– Java API ä¸€æ ·ï¼ŒAPI å¯åˆ©ç”¨çš„ OS è‡ªæœ‰å¼‚æ­¥åŠŸèƒ½çš„æ•°é‡å–å†³äºå…¶å¯¹è¯¥å¹³å°çš„æ”¯æŒç¨‹åº¦ã€‚ å¼‚æ­¥é€šé“æä¾›æ”¯æŒè¿æ¥ã€è¯»å–ã€ä»¥åŠå†™å…¥ä¹‹ç±»éé”å®šæ“ä½œçš„è¿æ¥ï¼Œå¹¶æä¾›å¯¹å·²å¯åŠ¨æ“ä½œçš„æ§åˆ¶æœºåˆ¶ã€‚Java 7 ä¸­ç”¨äº Java Platformï¼ˆNIO.2ï¼‰çš„ More New I/O APIsï¼Œé€šè¿‡åœ¨ java.nio.channels åŒ…ä¸­å¢åŠ å››ä¸ªå¼‚æ­¥é€šé“ç±»ï¼Œä»è€Œå¢å¼ºäº† Java 1.4 ä¸­çš„ New I/O APIsï¼ˆNIOï¼‰ï¼Œè¿™äº›ç±»åœ¨é£æ ¼ä¸Šä¸ NIO é€šé“ API å¾ˆç›¸ä¼¼ã€‚ä»–ä»¬å…±äº«ç›¸åŒçš„æ–¹æ³•ä¸å‚æ•°ç»“æ„ä½“ï¼Œå¹¶ä¸”å¤§å¤šæ•°å¯¹äº NIO é€šé“ç±»å¯ç”¨çš„å‚æ•°ï¼Œå¯¹äºæ–°çš„å¼‚æ­¥ç‰ˆæœ¬ä»ç„¶å¯ç”¨ã€‚ä¸»è¦åŒºåˆ«åœ¨äºæ–°é€šé“å¯ä½¿ä¸€äº›æ“ä½œå¼‚æ­¥æ‰§è¡Œã€‚ å¼‚æ­¥é€šé“ API æä¾›ä¸¤ç§å¯¹å·²å¯åŠ¨å¼‚æ­¥æ“ä½œçš„ç›‘æµ‹ä¸æ§åˆ¶æœºåˆ¶ã€‚ç¬¬ä¸€ç§æ˜¯é€šè¿‡è¿”å›ä¸€ä¸ª java.util.concurrent.Future å¯¹è±¡æ¥å®ç°ï¼Œå®ƒå°†ä¼šå»ºæ¨¡ä¸€ä¸ªæŒ‚èµ·æ“ä½œï¼Œå¹¶å¯ç”¨äºæŸ¥è¯¢å…¶çŠ¶æ€ä»¥åŠè·å–ç»“æœã€‚ç¬¬äºŒç§æ˜¯é€šè¿‡ä¼ é€’ç»™æ“ä½œä¸€ä¸ªæ–°ç±»çš„å¯¹è±¡ï¼Œjava.nio.channels.CompletionHandlerï¼Œæ¥å®Œæˆï¼Œå®ƒä¼šå®šä¹‰åœ¨æ“ä½œå®Œæ¯•åæ‰€æ‰§è¡Œçš„å¤„ç†ç¨‹åºæ–¹æ³•ã€‚æ¯ä¸ªå¼‚æ­¥é€šé“ç±»ä¸ºæ¯ä¸ªæ“ä½œå®šä¹‰ API å‰¯æœ¬ï¼Œè¿™æ ·å¯é‡‡ç”¨ä»»ä¸€æœºåˆ¶ã€‚ 9.3 APRApacheå¯ç§»æ¤è¿è¡Œæ—¶ï¼ˆApache Portable Runtimeï¼ŒAPRï¼‰æ˜¯Apache HTTPæœåŠ¡å™¨çš„æ”¯æŒåº“ï¼Œæœ€åˆï¼ŒAPRæ˜¯ä½œä¸ºApache HTTPæœåŠ¡å™¨çš„ä¸€éƒ¨åˆ†è€Œå­˜åœ¨çš„ï¼Œåæ¥æˆä¸ºä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ã€‚å…¶ä»–çš„åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨APRæ¥å®ç°å¹³å°æ— å…³æ€§ï¼ˆè·¨å¹³å°ï¼‰ã€‚APRæä¾›äº†ä¸€ç»„æ˜ å°„åˆ°ä¸‹å±‚æ“ä½œç³»ç»Ÿçš„APIï¼Œå¦‚æœæ“ä½œç³»ç»Ÿä¸æ”¯æŒæŸä¸ªç‰¹å®šçš„åŠŸèƒ½ï¼ŒAPRå°†æä¾›ä¸€ä¸ªæ¨¡æ‹Ÿçš„å®ç°ã€‚è¿™æ ·ç¨‹åºå‘˜ä½¿ç”¨APRç¼–å†™çœŸæ­£å¯åœ¨ä¸åŒå¹³å°ä¸Šç§»æ¤çš„ç¨‹åºã€‚ 9.4 Tomcaté…ç½®APR1234567891011# é¦–å…ˆä½¿ç”¨yumæ¥å®‰è£…apryum install apr apr-devel# è¿›å…¥tomcatç›®å½•ä¸‹å¯¹tomcat-nativeè¿›è¡Œè§£å‹cd /home/tomcat9/bin/tar -zxvf tomcat-native.tar.gz cd tomcat-native-1.2.23-src/native/# ç¼–è¯‘å®‰è£…./configure makemake install é¡ºåˆ©å®‰è£…å®Œæˆåä¼šæ˜¾ç¤ºaprçš„libåº“è·¯å¾„ï¼Œä¸€èˆ¬éƒ½æ˜¯/usr/local/apr/lib å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ç¯å¢ƒå˜é‡å’Œé…ç½®å‚æ•° è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯systemdè°ƒç”¨jsvcæ¥å¯åŠ¨tomcatï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥åœ¨systemdå¯¹åº”çš„tomcatçš„unitæ–‡ä»¶ä¸­çš„ExecStartä¸­æ·»åŠ ä¸€ä¸ªè·¯å¾„å‚æ•°-Djava.library.path=/usr/local/apr/libæŒ‡å‘apråº“çš„è·¯å¾„ï¼š 123456789101112131415ExecStart=/home/tomcat9/bin/jsvc \\ -user tomcat \\ -nodetach \\ -java-home $&#123;JAVA_HOME&#125; \\ -pidfile $&#123;CATALINA_BASE&#125;/tomcat.pid \\ -classpath $&#123;CATALINA_HOME&#125;/bin/bootstrap.jar:$&#123;CATALINA_HOME&#125;/bin/tomcat-juli.jar \\ -outfile $&#123;CATALINA_BASE&#125;/logs/catalina.out \\ -errfile $&#123;CATALINA_BASE&#125;/logs/catalina.err \\ -Dcatalina.home=$&#123;CATALINA_HOME&#125; \\ -Dcatalina.base=$&#123;CATALINA_BASE&#125; \\ -Djava.io.tmpdir=$&#123;CATALINA_TMPDIR&#125; \\ -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \\ -Djava.util.logging.config.file=$&#123;CATALINA_BASE&#125;/conf/logging.properties \\ -Djava.library.path=/usr/local/apr/lib \\ org.apache.catalina.startup.Bootstrap ç„¶åæˆ‘ä»¬åœ¨tomcatçš„homeç›®å½•ä¸‹çš„confå­ç›®å½•ä¸­å¯¹server.xmlæ–‡ä»¶è¿›è¡Œä¿®æ”¹ æŠŠ8080ç«¯å£å¯¹åº”çš„é…ç½®ä¿®æ”¹æˆaprï¼šï¼ˆå…¶ä»–ç«¯å£é…ç½®ä¹Ÿç±»ä¼¼ï¼‰ 123&lt;Connector port=&quot;8080&quot; protocol=&quot;org.apache.coyote.http11.Http11AprProtocol&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt; é‡å¯tomcatæœåŠ¡æˆ‘ä»¬ä»tomcatçš„æ—¥å¿—ä¸­å°±å¯ä»¥çœ‹åˆ°åè®®å·²ç»ä»é»˜è®¤çš„nioå˜æˆäº†aprã€‚ 9.5 ä¸‰è€…ä¹‹é—´çš„åŒºåˆ«ï¼š NIO NIO2 APR å®ç° JAVA NIOåº“ JDK1.7 NIO2åº“ C IOæ¨¡å‹ åŒæ­¥éé˜»å¡ å¼‚æ­¥éé˜»å¡ å–å†³äºç³»ç»Ÿ APRçš„é‡ç‚¹åœ¨äºä½¿ç”¨Cè¯­è¨€å®ç°å¹¶ä¸”èƒ½å¤Ÿè·¨å¹³å°ä½¿ç”¨ï¼Œå®ƒç›¸å½“äºå°†UNIXç³»ç»Ÿä¸­çš„IOæ“ä½œè¿›è¡Œäº†ä¸€å±‚å°è£…ä½¿å¾—ç¼–ç¨‹å¼€å‘æ›´å®¹æ˜“ NIOæ€§èƒ½æ˜¯æœ€å·®çš„è¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„ï¼Œå¦‚æœæ˜¯è€ƒè™‘åˆ°é«˜å¹¶å‘çš„æƒ…å†µï¼Œæ˜¾ç„¶å¼‚æ­¥éé˜»å¡I/Oæ¨¡å¼çš„NIO2å’ŒAPRåº“åœ¨æ€§èƒ½ä¸Šæ›´æœ‰ä¼˜åŠ¿ï¼Œå®é™…ä¸ŠNIO2çš„æ€§èƒ½è¡¨ç°ä¹Ÿå’ŒAPRä¸ç›¸ä¸Šä¸‹ï¼Œä½†æ˜¯NIO2è¦æ±‚Tomcatçš„ç‰ˆæœ¬è¦åœ¨8.0ä»¥ä¸Šï¼Œè€ŒAPRåªéœ€è¦5.5ä»¥ä¸Šå³å¯ï¼Œä½†æ˜¯APRéœ€è¦é¢å¤–é…ç½®åº“ç¯å¢ƒï¼Œç›¸å¯¹äºå†…ç½®é›†æˆçš„NIO2æ¥è¯´APRè¿™ä¸ªæ“ä½œæ¯”è¾ƒéº»çƒ¦ï¼Œä¸¤è€…å„æœ‰ä¼˜åŠ£ã€‚å…·ä½“ä½¿ç”¨å“ªä¸ªè¿˜æ˜¯éœ€è¦ç»“åˆå®é™…ä¸šåŠ¡éœ€æ±‚å’Œç¯å¢ƒè¿›è¡Œæµ‹è¯•æ‰èƒ½å†³å®šã€‚ 10ã€server.xmlTomcatä¸­çš„å¤§å¤šæ•°é…ç½®éƒ½ä¼šåœ¨server.xmlæ–‡ä»¶ä¸­ï¼Œserver.xmlçš„åœ°ä½å°±å¥½åƒnginxä¸­çš„nginx.confæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬æƒ³è¦å­¦ä¹ é…ç½®tomcatçš„å„ç±»å‚æ•°ï¼Œæœ€å…ˆå¼€å§‹å­¦ä¹ çš„é…ç½®å°±æ˜¯server.xmlæ–‡ä»¶ã€‚ 10.1 server.xmlæ•´ä½“æ¶æ„é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“server.xmlä¸­çš„xmlä»£ç å—åˆ†ç±»ï¼Œtomcatå®˜ç½‘å°†å…¶ä¸»è¦åˆ†ä¸ºå››ç±»ï¼š Top Level Elementsï¼šserverå—æ˜¯æ•´ä¸ªé…ç½®æ–‡ä»¶çš„æ ¹å…ƒç´ ï¼Œè€Œserviceå—ä»£è¡¨ä¸å¼•æ“å…³è”çš„ä¸€ç»„è¿æ¥å™¨ï¼ˆconnectorï¼‰ã€‚ Connectors ï¼šè¡¨ç¤ºå¤–éƒ¨å®¢æˆ·ç«¯å‘ç‰¹å®šæœåŠ¡å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”çš„æ¥å£ï¼ˆæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„coyoteè¿æ¥å™¨ä»¥åŠå¯¹åº”çš„NIOç­‰IOæ¨¡å¼éƒ½æ˜¯æ•´ä¸ªèŒƒç•´å†…çš„æ¦‚å¿µï¼‰ã€‚ Containersï¼šå®¹å™¨ï¼ˆContainerï¼‰è´Ÿè´£å¤„ç†ä¼ å…¥çš„è¯·æ±‚å¹¶åˆ›å»ºç›¸åº”çš„å“åº”ã€‚Engineå¤„ç†å¯¹Serviceçš„æ‰€æœ‰è¯·æ±‚ï¼ŒHostå¤„ç†å¯¹ç‰¹å®švirtual hostçš„æ‰€æœ‰è¯·æ±‚ï¼Œè€ŒContextå¤„ç†å¯¹ç‰¹å®šWebåº”ç”¨ç¨‹åºçš„æ‰€æœ‰è¯·æ±‚ã€‚ Nested Componentsï¼šè¡¨ç¤ºå¯ä»¥åµŒå¥—åœ¨Containerå…ƒç´ å†…çš„å…ƒç´ ã€‚ æ³¨æ„ä¸€äº›å…ƒç´ å¯ä»¥åµŒå¥—åœ¨ä»»ä½•Containerä¸­ï¼Œè€Œå¦ä¸€äº›å…ƒç´ åªèƒ½åµŒå¥—åœ¨Contextä¸­ã€‚ 10.2 Top Level Elements3.2.1 Serverå—Serverå—ä»£è¡¨çš„æ˜¯æ•´ä¸ªcatalina servletå®¹å™¨ã€‚å› æ­¤ï¼Œå®ƒå¿…é¡»æ˜¯conf/server.xmlé…ç½®æ–‡ä»¶ä¸­æœ€å¤–é¢çš„å•ä¸ªå…ƒç´ ã€‚å®ƒçš„å±æ€§ä»£è¡¨äº†æ•´ä¸ªservletå®¹å™¨çš„ç‰¹å¾ã€‚Tomcat9ä¸­é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸­Serverå—å†…åµŒçš„å­å…ƒç´ ä¸º Listenerã€GlobalNamingResourcesã€Serviceï¼ˆå¯ä»¥åµŒå¥—å¤šä¸ªï¼‰ã€‚å…·ä½“çš„æ¯ä¸ªå±æ€§å‚æ•°æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢å®˜ç½‘ï¼Œä¸‹é¢è§£é‡Šé»˜è®¤çš„å‚æ•°é…ç½®ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt; &lt;!-- port ï¼š Tomcatç›‘å¬çš„å…³é—­æœåŠ¡å™¨çš„ç«¯å£ shutdown ï¼š å…³é—­æœåŠ¡å™¨çš„æŒ‡ä»¤å­—ç¬¦ä¸² --&gt; &lt;!-- ä»¥æ—¥å¿—å½¢å¼è¾“å‡ºæœåŠ¡å™¨ã€æ“ä½œç³»ç»Ÿã€JVMçš„ç‰ˆæœ¬ä¿¡æ¯ --&gt; &lt;Listener className=&quot;org.apache.catalina.startup.VersionLoggerListener&quot; /&gt; &lt;!-- å¯åŠ¨å’Œåœæ­¢APRã€‚å¦‚æœæ‰¾ä¸åˆ°APRåº“ä¼šè¾“å‡ºæ—¥å¿—ä½†å¹¶ä¸å½±å“tomcatæ­£å¸¸å¯åŠ¨ --&gt; &lt;Listener className=&quot;org.apache.catalina.core.AprLifecycleListener&quot; SSLEngine=&quot;off&quot; /&gt; &lt;!-- æ³¨æ„è¿™é‡Œçš„SSLEngineé»˜è®¤æ˜¯æ‰“å¼€çš„ï¼ˆonï¼‰ å¦‚æœå¯ç”¨äº†aprä½œä¸ºè¿æ¥å™¨çš„åè®® ä½†æ˜¯åªé…ç½®äº†httpè€Œæ²¡æœ‰é…ç½®https åˆ™ä¼šæŠ¥é”™ --&gt; &lt;!-- ç”¨äºé¿å…JREå†…å­˜æ³„æ¼é—®é¢˜ --&gt; &lt;Listener className=&quot;org.apache.catalina.core.JreMemoryLeakPreventionListener&quot; /&gt; &lt;!-- ç”¨æˆ·åŠ è½½ï¼ˆæœåŠ¡å™¨å¯åŠ¨ï¼‰å’Œé”€æ¯ï¼ˆæœåŠ¡å™¨åœæ­¢ï¼‰å…¨å±€å‘½åæœåŠ¡ --&gt; &lt;Listener className=&quot;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener&quot; /&gt; &lt;!-- ç”¨äºåœ¨Contextåœæ­¢æ—¶é‡å»ºExecutoræ± ä¸­çš„çº¿ç¨‹ï¼Œ ä»¥é¿å…ThreadLocalç›¸å…³çš„å†…å­˜æ³„æ¼ --&gt; &lt;Listener className=&quot;org.apache.catalina.core.ThreadLocalLeakPreventionListener&quot; /&gt; &lt;!-- GlobalNamingResourcesä¸­å®šä¹‰äº†å…¨å±€å‘½åæœåŠ¡ï¼š --&gt; &lt;GlobalNamingResources&gt; &lt;Resource name=&quot;UserDatabase&quot; auth=&quot;Container&quot; type=&quot;org.apache.catalina.UserDatabase&quot; description=&quot;User database that can be updated and saved&quot; factory=&quot;org.apache.catalina.users.MemoryUserDatabaseFactory&quot; pathname=&quot;conf/tomcat-users.xml&quot; /&gt; &lt;!--è¿™é‡Œå®šä¹‰çš„æ–‡ä»¶å°±æ˜¯æˆ‘ä»¬å‰é¢é…ç½®managerå’Œhost managerçš„ç”¨æˆ·çš„æ–‡ä»¶--&gt; &lt;/GlobalNamingResources&gt; &lt;Service&gt; ... &lt;/Service&gt; &lt;/Server&gt; 3.2.2 Serviceå— Serviceå…ƒç´ ç”¨äºåˆ›å»º Service å®ä¾‹ï¼Œé»˜è®¤ä½¿ç”¨ org.apache.catalina.core.StandardServiceã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒTomcat9ä¸­é»˜è®¤ä»…æŒ‡å®šäº†Serviceçš„åç§°ä¸ºCatalinaã€‚ 123&lt;Service name=&quot;Catalina&quot;&gt;...&lt;/Service&gt; Service å¯ä»¥å†…åµŒçš„å…ƒç´ ä¸º ï¼š Listenerã€Executorã€Connectorã€Engine ï¼Œè¯¦ç»†çš„å‚æ•°å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹å®˜ç½‘ Listener ç”¨äºä¸ºService æ·»åŠ ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨ Executor ç”¨äºé…ç½®Service å…±äº«çº¿ç¨‹æ±  Connector ç”¨äºé…ç½® Service åŒ…å«çš„é“¾æ¥å™¨ Engine ç”¨äºé…ç½®Serviceä¸­è¿æ¥å™¨ï¼ˆconnectorï¼‰å¯¹åº”çš„Servlet å®¹å™¨å¼•æ“ 10.3 Executorexecutorè¡¨ç¤ºå¯ç»„ä»¶ä¹‹é—´Tomcatä¸­å…±äº«çš„çº¿ç¨‹æ± ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒServiceå¹¶æœªæ·»åŠ å…±äº«çº¿ç¨‹æ± é…ç½®ã€‚executorå®ç°äº†tomcatä¸­çš„org.apache.catalina.Executoræ¥å£ã€‚ å¦‚æœä¸é…ç½®å…±äº«çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆCatalina å„ç»„ä»¶åœ¨ç”¨åˆ°çº¿ç¨‹æ± æ—¶ä¼šç‹¬ç«‹åˆ›å»ºã€‚ç”±äºexecutoræ˜¯Serviceå…ƒç´ çš„åµŒå¥—å…ƒç´ ã€‚ä¸ºäº†ä½¿å®ƒèƒ½å¤Ÿè¢«Connectorä½¿ç”¨ï¼ŒExecutorå…ƒç´ å¿…é¡»å‡ºç°åœ¨server.xmlä¸­çš„Connectorå…ƒç´ ä¹‹å‰ã€‚ä¸‹é¢å±•ç¤ºçš„æ˜¯ä¸€ä¸ªç®€å•çš„executorçš„é…ç½®ï¼Œå…·ä½“çš„é…ç½®å‚æ•°å¯ä»¥ç‚¹è¿™é‡ŒæŸ¥çœ‹å®˜ç½‘ï¼š 12345678910&lt;Executor name=&quot;tomcatThreadPool&quot; namePrefix=&quot;catalinaâ€execâ€&quot; maxThreads=&quot;200&quot; minSpareThreads=&quot;100&quot; maxIdleTime=&quot;60000&quot; maxQueueSize=&quot;Integer.MAX_VALUE&quot; prestartminSpareThreads=&quot;false&quot; threadPriority=&quot;5&quot; className=&quot;org.apache.catalina.core.StandardThreadExecutor&quot;/&gt; å±æ€§ å«ä¹‰ name çº¿ç¨‹æ± åç§°ï¼Œç”¨äºConnectorä¸­æŒ‡å®šã€‚ namePrefix æ‰€åˆ›å»ºçš„æ¯ä¸ªçº¿ç¨‹çš„åç§°å‰ç¼€ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹åç§°ä¸º namePrefix+threadNumberã€‚ daemon æ˜¯å¦ä½œä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼ˆç±»ä¼¼äºå®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œé»˜è®¤ä¸ºtrue maxThreads çº¿ç¨‹æ± ä¸­æœ€å¤§çº¿ç¨‹æ•°ã€‚ minSpareThreads æ´»è·ƒçº¿ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯æ ¸å¿ƒæ± çº¿ç¨‹æ•°ï¼Œè¿™äº›çº¿ç¨‹ä¸ä¼šè¢«é”€æ¯ï¼Œä¼šä¸€ç›´å­˜åœ¨ã€‚ maxIdleTime çº¿ç¨‹ç©ºé—²æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´åï¼Œç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ï¼Œé»˜ è®¤å€¼ä¸º6000ï¼ˆ1åˆ†é’Ÿï¼‰ï¼Œå•ä½æ¯«ç§’ã€‚ maxQueueSize åœ¨è¢«æ‰§è¡Œå‰æœ€å¤§çº¿ç¨‹æ’é˜Ÿæ•°ç›®ï¼Œé»˜è®¤ä¸ºintçš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯å¹¿ä¹‰çš„æ— é™ã€‚é™¤éç‰¹æ®Šæƒ…å†µï¼Œè¿™ä¸ªå€¼ä¸éœ€è¦æ›´æ”¹ï¼Œ å¦åˆ™ä¼šæœ‰è¯·æ±‚ä¸ä¼šè¢«å¤„ç†çš„æƒ…å†µå‘ç”Ÿã€‚ prestartminSpareThreads å¯åŠ¨çº¿ç¨‹æ± æ—¶æ˜¯å¦å¯åŠ¨ minSpareThreadséƒ¨åˆ†çº¿ç¨‹ã€‚ é»˜è®¤å€¼ä¸ºfalseï¼Œå³ä¸å¯åŠ¨ã€‚ threadPriority çº¿ç¨‹æ± ä¸­çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé»˜è®¤å€¼ä¸º5ï¼Œå€¼ä»1åˆ°10ã€‚ className çº¿ç¨‹æ± å®ç°ç±»ï¼ŒæœªæŒ‡å®šæƒ…å†µä¸‹ï¼Œé»˜è®¤å®ç°ç±»ä¸º org.apache.catalina.core.StandardThreadExecutorã€‚ å¦‚æœæƒ³ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± é¦–å…ˆéœ€è¦å®ç° org.apache.catalina.Executoræ¥å£ã€‚ 10.4 ConnectorConnector ç”¨äºåˆ›å»ºé“¾æ¥å™¨å®ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œserver.xml é…ç½®äº†ä¸¤ä¸ªé“¾æ¥å™¨ï¼Œä¸€ä¸ªæ”¯ æŒHTTPåè®®ï¼Œä¸€ä¸ªæ”¯æŒAJPåè®®ã€‚å› æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ–°å¢é“¾æ¥å™¨é…ç½®ï¼Œ åªæ˜¯æ ¹æ®éœ€è¦å¯¹å·²æœ‰é“¾æ¥å™¨è¿›è¡Œä¼˜åŒ–ã€‚ 123&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot;redirectPort=&quot;8443&quot; /&gt;&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt; portä¸ºç›‘å¬çš„ç«¯å£ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼ŒTomcatå°†ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ç«¯å£å·ç»™å½“å‰Connector ä½¿ç”¨ protocolä¸ºConnectorçš„åè®®ï¼Œè¿™é‡Œé»˜è®¤çš„æ˜¯HTTPå’ŒAJPä¸¤ç§åè®®ï¼Œåé¢å¯ä»¥æŒ‡å®šå¯¹åº”åè®®çš„ä¸åŒç‰ˆæœ¬ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæ£€æµ‹æœ¬æœºæ˜¯å¦é…ç½®äº†APRåº“ï¼Œå¦‚æœæœ‰å¹¶ä¸” useAprConnectorè®¾ç½®ä¸ºtrueåˆ™ä¼šé»˜è®¤ä½¿ç”¨APRæ¨¡å¼çš„IOåè®®ï¼Œå¦‚æœæ— åˆ™ä¼šä½¿ç”¨NIOæ¨¡å¼ connectionTimeOut ï¼šConnector æ¥æ”¶é“¾æ¥åçš„ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚ -1è¡¨ç¤ºæ°¸ä¸è¶…æ—¶ redirectPortï¼šå½“å‰Connector ä¸æ”¯æŒSSLè¯·æ±‚ï¼Œ æ¥æ”¶åˆ°äº†ä¸€ä¸ªè¯·æ±‚ï¼Œ å¹¶ä¸”ä¹Ÿç¬¦åˆ security-constraint çº¦æŸï¼Œ éœ€è¦SSLä¼ è¾“ï¼ŒCatalinaè‡ªåŠ¨å°†è¯·æ±‚é‡å®šå‘åˆ°æŒ‡å®šçš„ç«¯å£ executor ï¼š æŒ‡å®šå‰é¢æåˆ°çš„å…±äº«çº¿ç¨‹æ± çš„åç§°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡maxThreadsã€minSpareThreads ç­‰å±æ€§å¯¹è¯¥connectorè¿›è¡Œå•ç‹¬é…ç½®å¯¹åº”çš„å†…éƒ¨çº¿ç¨‹æ±  URIEncoding : ç”¨äºæŒ‡å®šç¼–ç URIçš„å­—ç¬¦ç¼–ç ï¼Œ Tomcat8.xå’ŒTomcat9.xç‰ˆæœ¬é»˜è®¤çš„ç¼–ç ä¸º UTF-8 , Tomcat7.xç‰ˆæœ¬é»˜è®¤ä¸ºISO-8859-1 10.5 engineEngine ä½œä¸ºServlet å¼•æ“çš„é¡¶çº§å…ƒç´ ï¼Œå†…éƒ¨å¯ä»¥åµŒå…¥ï¼š Clusterã€Listenerã€Realmã€ Valveå’ŒHostã€‚ 123&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt; â€¦â€¦&lt;/Engine&gt; nameï¼šç”¨äºæŒ‡å®šEngine çš„åç§°ï¼Œ é»˜è®¤ä¸ºCatalina defaultHostï¼šé»˜è®¤ä½¿ç”¨çš„è™šæ‹Ÿä¸»æœºåç§°ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è®¿é—®çš„hostæ— æ•ˆæ—¶ï¼Œä¼šè·³è½¬åˆ°é»˜è®¤çš„hostæ¥å¤„ç†è¯·æ±‚ 10.6 HostHost å…ƒç´ ç”¨äºé…ç½®ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå®ƒæ”¯æŒä»¥ä¸‹åµŒå…¥å…ƒç´ ï¼šAliasã€Clusterã€Listenerã€ Valveã€Realmã€Context å¦‚æœåœ¨Engineä¸‹é…ç½®Realmï¼Œé‚£ä¹ˆæ­¤é…ç½®å°†åœ¨å½“å‰Engineä¸‹çš„æ‰€æœ‰Hostä¸­å…±äº«ã€‚ åŒæ ·ï¼Œå¦‚æœåœ¨Hostä¸­é…ç½®Realm ï¼Œåˆ™åœ¨å½“å‰Hostä¸‹çš„æ‰€æœ‰Context ä¸­å…±äº« Contextä¸­çš„Realmä¼˜å…ˆçº§ &gt; Hostçš„Realmä¼˜å…ˆçº§ &gt; Engineä¸­çš„Realmä¼˜å…ˆçº§ 12345678&lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt; &lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot; prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot; pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt; &lt;Alias&gt;www.example.com&lt;/Alias&gt; &lt;Alias&gt;www.example2.com&lt;/Alias&gt;&lt;/Host&gt; ä¸Šé¢è¿™ä¸€æ®µHostçš„é…ç½®æ–‡ä»¶ä¸­è¿˜é¢å¤–æ·»åŠ äº†Valveé…ç½®æ¥å®ç°è‡ªå®šä¹‰çš„æ—¥å¿—è®°å½•ã€‚å…¶ä¸­ä¸€äº›å‚æ•°çš„è¯¦ç»†ä¿¡æ¯å’Œé…ç½®æ–¹å¼å¯ä»¥æŸ¥çœ‹å®˜ç½‘çš„è¯´æ˜ã€‚ The shorthand pattern pattern=&quot;common&quot; corresponds to the Common Log Format defined by â€˜%h %l %u %t â€œ%râ€ %s %bâ€™. name: å½“å‰Hosté€šç”¨çš„ç½‘ç»œåç§°ï¼Œä¹Ÿå°±æ˜¯å¸¸ç”¨çš„åŸŸåï¼Œå¦‚æœæœ‰å¤šä¸ªåŸŸåå¯¹åº”åŒä¸€ä¸ªHostçš„åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªAliasæ¥å®ç°è®¿é—® appBaseï¼šå½“å‰Hoståº”ç”¨å¯¹åº”çš„ç›®å½•ï¼Œå½“å‰Hostä¸Šéƒ¨ç½²çš„Webåº”ç”¨å‡åœ¨è¯¥ç›®å½•ä¸‹ï¼ˆç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„å‡å¯ï¼‰ï¼Œé»˜è®¤ä¸ºwebapps unpackWARsï¼šè®¾ç½®ä¸ºtrueï¼ŒHoståœ¨å¯åŠ¨æ—¶ä¼šå°†appBaseç›®å½•ä¸‹waråŒ…è§£å‹ä¸ºç›® å½•ã€‚è®¾ç½®ä¸ºfalseï¼ŒHostå°†ç›´æ¥ä»waræ–‡ä»¶å¯åŠ¨ autoDeployï¼š æ§åˆ¶tomcatæ˜¯å¦åœ¨è¿è¡Œæ—¶å®šæœŸæ£€æµ‹å¹¶è‡ªåŠ¨éƒ¨ç½²æ–°å¢æˆ–å˜æ›´çš„webåº”ç”¨ 10.7 ContextContextçš„å®Œæ•´é…ç½®å®˜ç½‘æ–‡æ¡£ï¼ŒContext ç”¨äºé…ç½®ä¸€ä¸ªWebåº”ç”¨ï¼Œé»˜è®¤çš„é…ç½®å¦‚ä¸‹ã€‚å®ƒæ”¯æŒçš„å†…åµŒå…ƒç´ ä¸ºï¼šCookieProcessorï¼ŒLoaderï¼ŒManagerï¼ŒRealmï¼ŒResourcesï¼ŒWatchedResourceï¼ŒJarScannerï¼ŒValveã€‚ 123456&lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt; &lt;Context docBase=&quot;myAppDeploy&quot; path=&quot;/myApp&quot;&gt; .... &lt;/Context&gt;&lt;/Host&gt; docBaseï¼šWebåº”ç”¨ç›®å½•æˆ–è€…WaråŒ…çš„éƒ¨ç½²è·¯å¾„ã€‚å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºè¯¥Contextæ‰€å±çš„Hostä¸­çš„appBaseçš„ç›¸å¯¹è·¯å¾„ã€‚ pathï¼šWebåº”ç”¨çš„Contextçš„è®¿é—®è·¯å¾„ã€‚ å‡è®¾tomcatçš„å®‰è£…ç›®å½•ä¸º/home/tomcat9ï¼ŒHostä¸ºé»˜è®¤çš„localhostï¼Œ åˆ™è¯¥webåº”ç”¨è®¿é—®çš„æ ¹è·¯å¾„ä¸ºï¼š http://localhost:8080/myAppï¼Œå¯¹åº”çš„éƒ¨ç½²æ–‡ä»¶æ‰€å­˜æ”¾çš„è·¯å¾„ä¸ºï¼š/home/tomcat9/webapps/myAppDeployã€‚","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://tinychen.com/tags/tomcat/"}]},{"title":"PowerDNSç¯‡1-ç®€ä»‹å’Œå®‰è£…","slug":"20210224-dns-02-pdns01-pdns-auth-and-rec-introduction","date":"2021-02-24T03:00:00.000Z","updated":"2021-02-24T03:00:00.000Z","comments":true,"path":"20210224-dns-02-pdns01-pdns-auth-and-rec-introduction/","link":"","permalink":"https://tinychen.com/20210224-dns-02-pdns01-pdns-auth-and-rec-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»PowerDNSçš„ä¸»è¦ç‰¹æ€§å’Œåˆå§‹åŒ–å®‰è£…çš„é…ç½®æ–¹æ³•ï¼Œä¾§é‡ç‚¹æ˜¯å¯¹å¤æ‚ç¨‹åº¦ç›¸å¯¹è¾ƒé«˜PowerDNS Authoritative Serverè¿›è¡Œä»‹ç»ï¼ŒåŒæ—¶ä¼šå¤¹æ‚éƒ¨åˆ†PowerDNS-Recursorçš„åˆå§‹åŒ–å®‰è£…å’Œé…ç½®ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»PowerDNSçš„ä¸»è¦ç‰¹æ€§å’Œåˆå§‹åŒ–å®‰è£…çš„é…ç½®æ–¹æ³•ï¼Œä¾§é‡ç‚¹æ˜¯å¯¹å¤æ‚ç¨‹åº¦ç›¸å¯¹è¾ƒé«˜PowerDNS Authoritative Serverè¿›è¡Œä»‹ç»ï¼ŒåŒæ—¶ä¼šå¤¹æ‚éƒ¨åˆ†PowerDNS-Recursorçš„åˆå§‹åŒ–å®‰è£…å’Œé…ç½®ã€‚ 1ã€PowerDNSç®€ä»‹PowerDNSï¼ˆPDNSï¼‰æˆç«‹äº20ä¸–çºª90å¹´ä»£æœ«ï¼Œæ˜¯å¼€æºDNSè½¯ä»¶ã€æœåŠ¡å’Œæ”¯æŒçš„ä¸»è¦ä¾›åº”å•†ï¼Œå®ƒä»¬æä¾›çš„æƒå¨è®¤è¯DNSæœåŠ¡å™¨å’Œé€’å½’è®¤è¯DNSæœåŠ¡å™¨éƒ½æ˜¯100%å¼€æºçš„è½¯ä»¶ï¼ŒåŒæ—¶ä¹Ÿå’Œçº¢å¸½ç­‰å¼€æºæ–¹æ¡ˆæä¾›å•†ä¸€æ ·æä¾›äº†ä»˜è´¹çš„æŠ€æœ¯æ”¯æŒç‰ˆæœ¬ã€‚åŒæ—¶å®˜æ–¹è¡¨ç¤ºä¸ºäº†é¿å…å’Œè½¯ä»¶ä½¿ç”¨è€…å‡ºç°ç«äº‰ï¼Œä»–ä»¬åªæä¾›æœåŠ¡æ”¯æŒè€Œä¸æä¾›DNSæ‰˜ç®¡æœåŠ¡ã€‚ Our Authoritative Server, Recursor and dnsdist products are 100% open source. For the service provider market, OX also sells the PowerDNS Platform which builds on our Open Source products to deliver an integrated DNS solution with 24/7 support and includes features as parental control, malware filtering, automated attack mitigation, and long-term query logging &amp; searching. ç†Ÿæ‚‰DNSå·¥ä½œåŸç†çš„åŒå­¦å¯ä»¥å¤§è‡´åœ°å°†DNSè®°å½•çš„æŸ¥è¯¢åˆ†ä¸ºä¸¤ç§ï¼šæŸ¥è¯¢æœ¬åœ°ç¼“å­˜å’Œå‘ä¸Šé€’å½’æŸ¥è¯¢ã€‚å’Œå…¶ä»–çš„å¦‚BINDã€dnsmasqç­‰å°†è¿™äº›åŠŸèƒ½é›†æˆåˆ°ä¸€èµ·çš„DNSè½¯ä»¶ä¸åŒï¼ŒPowerDNSå°†å…¶ä¸€åˆ†ä¸ºäºŒï¼Œåˆ†ä¸ºäº†PowerDNS Authoritative Serverå’ŒPowerDNS Recursorï¼Œåˆ†åˆ«å¯¹åº”è¿™ä¸¤ç§ä¸»è¦çš„éœ€æ±‚ï¼Œè€Œæˆ‘ä»¬å¸¸è¯´çš„pdnsæŒ‡çš„å°±æ˜¯PowerDNS Authoritative Server (åé¢ç®€ç§°PDNS Auth)ï¼Œä¸»è¦ç”¨é€”å°±æ˜¯ä½œä¸ºæƒå¨åŸŸåæœåŠ¡å™¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½œä¸ºæ™®é€šçš„DNSæœåŠ¡å™¨æä¾›DNSæŸ¥è¯¢åŠŸèƒ½ã€‚ å¯¹äºPowerDNS-Recursorï¼ŒPowerDNSå®˜ç½‘ä»‹ç»å…¶æ˜¯ä¸€ä¸ªå†…ç½®è„šæœ¬èƒ½åŠ›çš„é«˜æ€§èƒ½çš„DNSé€’å½’æŸ¥è¯¢æœåŠ¡å™¨ï¼Œå¹¶ä¸”å·²ç»ä¸ºä¸€äº¿äº”åƒä¸‡ä¸ªäº’è”ç½‘è¿æ¥æä¾›æ”¯æŒã€‚ The PowerDNS Recursor is a high-performance DNS recursor with built-in scripting capabilities. It is known to power the resolving needs of over 150 million internet connections. PowerDNS-Recursor(ä»¥ä¸‹ç®€ç§°pdns-rec)çš„å®˜æ–¹æ–‡æ¡£å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚å®˜æ–¹æŒ‡çš„å†…ç½®è„šæœ¬èƒ½åŠ›æ˜¯æŒ‡åœ¨4.0.0ç‰ˆæœ¬ä¹‹åçš„é…ç½®æ–‡ä»¶é‡Œé¢æ·»åŠ äº†å¯¹luaè„šæœ¬çš„æ”¯æŒã€‚ 2ã€PowerDNSå®‰è£…2.1 PowerDNS Authoritative Serverå®‰è£…è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ç»å…¸çš„CentOS7ç³»ç»Ÿè¿›è¡Œå®‰è£…æµ‹è¯•ï¼Œç³»ç»Ÿçš„ç›¸å…³ç‰ˆæœ¬å’Œå†…æ ¸ä¿¡æ¯å¦‚ä¸‹ï¼š 12345678[root@tiny-test home]# lsb_release -aLSB Version: :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarchDistributor ID: CentOSDescription: CentOS Linux release 7.9.2009 (Core)Release: 7.9.2009Codename: Core[root@tiny-test home]# uname -r3.10.0-1160.11.1.el7.x86_64 pdnså¯¹ä¸»æµçš„æ“ä½œç³»ç»Ÿéƒ½æœ‰ç€è¾ƒå¥½çš„æ”¯æŒï¼Œåœ¨centosä¸Šé¢å¯ä»¥ç›´æ¥é€šè¿‡repoä»“åº“æ¥å®‰è£…ï¼Œçº¢å¸½ç³»çš„Linuxå¯ä»¥é€šè¿‡epelæºï¼Œmonshouweræä¾›çš„ç¬¬ä¸‰æ–¹æºå’Œpowerdnså®˜æ–¹æºä¸‰ç§æºæ¥è¿›è¡Œå®‰è£…ã€‚ On RedHat based systems there are 3 options to install PowerDNS, from EPEL, the repository from Kees Monshouwer or from the PowerDNS repositories: ä½¿ç”¨epelæºæ¥è¿›è¡Œå®‰è£…çš„è¯å¯èƒ½ä¼šå¯¼è‡´æ— æ³•å®‰è£…æœ€æ–°ç‰ˆæœ¬ å¦‚æœç½‘ç»œæ¡ä»¶å…è®¸çš„è¯ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯ç›´æ¥é€šè¿‡å®˜æ–¹çš„repoæºæ¥è¿›è¡Œå®‰è£…ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯masteræºï¼Œåˆ™å¯ä»¥å®‰è£…åˆ°æœ€æ–°çš„æµ‹è¯•ç‰ˆæœ¬ï¼š 1234yum install epel-release yum-plugin-prioritiescurl -o /etc/yum.repos.d/powerdns-auth-master.repo https://repo.powerdns.com/repo-files/centos-auth-master.repoyum install pdnsyum install pdns-backend-$backend è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆ4.4ç‰ˆæœ¬è¿›è¡Œå®‰è£…ï¼Œbackendè¿™é‡Œæˆ‘ä»¬é€‰æ‹©pdns-backend-mysql 1234yum install epel-release yum-plugin-prioritiescurl -o /etc/yum.repos.d/powerdns-auth-44.repo https://repo.powerdns.com/repo-files/centos-auth-44.repoyum install pdnsyum install pdns-backend-$backend è¯·æ³¨æ„å¯¹äºæŸäº›è½¯ä»¶åŒ…æºï¼Œbind backendä½œä¸ºåŸºæœ¬pdnsè½¯ä»¶åŒ…çš„ä¸€éƒ¨åˆ†æä¾›ï¼Œå¹¶ä¸”æ²¡æœ‰å•ç‹¬çš„pdns-backend-bindè½¯ä»¶åŒ…ã€‚ 2.2 PowerDNS-Recursorå®‰è£…è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ç»å…¸çš„CentOS7ç³»ç»Ÿè¿›è¡Œå®‰è£…æµ‹è¯•ï¼Œç³»ç»Ÿçš„ç›¸å…³ç‰ˆæœ¬å’Œå†…æ ¸ä¿¡æ¯å¦‚ä¸‹ï¼š 12345678[root@tiny-cloud /home]# lsb_release -aLSB Version: :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarchDistributor ID: CentOSDescription: CentOS Linux release 7.9.2009 (Core)Release: 7.9.2009Codename: Core[root@tiny-cloud /home]# uname -r3.10.0-1160.24.1.el7.x86_64 pdnså¯¹ä¸»æµçš„æ“ä½œç³»ç»Ÿéƒ½æœ‰ç€è¾ƒå¥½çš„æ”¯æŒï¼Œåœ¨çº¢å¸½ç³»å’ŒCentOSç³»ç›¸å…³çš„å‘è¡Œç‰ˆæœ¬ä¸Šé¢å¯ä»¥ä¹‹é—´é€šè¿‡epelæºæ¥è¿›è¡Œå®‰è£…ï¼Œä¸è¿‡ä½¿ç”¨epelæºæ¥è¿›è¡Œå®‰è£…çš„è¯å¯èƒ½ä¼šå¯¼è‡´æ— æ³•å®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚ On Red Hat, CentOS and related distributions, ensure that EPEL is available. To install the PowerDNS Recursor, run yum install pdns-recursor as root. å¦‚æœç½‘ç»œæ¡ä»¶å…è®¸çš„è¯ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯ç›´æ¥é€šè¿‡å®˜æ–¹çš„repoæºæ¥è¿›è¡Œå®‰è£…ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯masteråˆ†æ”¯çš„repoæºï¼Œåˆ™å¯ä»¥å®‰è£…åˆ°æœ€æ–°çš„æµ‹è¯•ç‰ˆæœ¬ã€‚å®˜æ–¹è¡¨ç¤ºmasterå­˜å‚¨åº“å¯¹åº”çš„æ˜¯ä»–ä»¬åœ¨githubä¸Šé¢æ­£åœ¨å¼€å‘çš„masteråˆ†æ”¯ã€‚ 123yum install epel-release yum-plugin-priorities &amp;&amp;curl -o /etc/yum.repos.d/powerdns-rec-master.repo https://repo.powerdns.com/repo-files/centos-rec-master.repo &amp;&amp;yum install pdns-recursor å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å®˜æ–¹æä¾›çš„ä¸åŒç‰ˆæœ¬yumæºæ¥å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„pdnsï¼Œä¸åŒçš„ç‰ˆæœ¬åˆ†æ”¯å¯¹åº”çš„æ”¯æŒæ—¶é—´ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå®˜æ–¹è¡¨ç¤ºåœ¨å¯¹åº”ç‰ˆæœ¬çš„ç”Ÿå‘½å‘¨æœŸç»“æŸä¹‹åï¼Œå¯¹åº”çš„ä»“åº“ä¹Ÿä¸ä¼šå†æä¾›æ”¯æŒï¼Œpdns-recçš„EOLä¿¡æ¯å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚ç”±äºç›®å‰4.5.xç‰ˆæœ¬è¿˜å¤„äºrcé˜¶æ®µï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯å®‰è£…æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬4.4.xç‰ˆæœ¬ã€‚ 123yum install epel-release yum-plugin-priorities &amp;&amp;curl -o /etc/yum.repos.d/powerdns-rec-44.repo https://repo.powerdns.com/repo-files/centos-rec-44.repo &amp;&amp;yum install pdns-recursor 3ã€pdns-authçš„mysqlå®‰è£…é…ç½®3.1 å®‰è£…mysqlpdnså¯¹äºmysqlçš„ç‰ˆæœ¬å’Œå®‰è£…æ–¹å¼å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„è¦æ±‚ï¼Œä¸ªäººæ¨èç‰ˆæœ¬åœ¨5.7+æˆ–è€…8.0+éƒ½å¯ä»¥ï¼Œè¿™é‡Œä½¿ç”¨yumå®‰è£…8.0ç‰ˆæœ¬çš„mysqlã€‚ æœ€æ–°ç‰ˆçš„mysqlçš„repoæ–‡ä»¶æˆ‘ä»¬å¯ä»¥ç›´æ¥å‰å¾€å®˜ç½‘ä¸‹è½½ï¼šhttps://dev.mysql.com/downloads/repo/yum/ å¦‚æœéœ€è¦ä½¿ç”¨5.7çš„ç‰ˆæœ¬å¯ä»¥åˆ°è¿™é‡Œä¸‹è½½ 1wget http://repo.mysql.com/mysql57-community-release-el7-9.noarch.rpm 123456789[root@tinychen-server /root]# rpm -ivh mysql80-community-release-el7-3.noarch.rpm[root@tinychen-server /root]# yum update[root@tinychen-server /root]# yum install mysql-server[root@tinychen-server /root]# mysqladmin --versionmysqladmin Ver 8.0.23 for Linux on x86_64 (MySQL Community Server - GPL)# MYSQL8çš„åˆå§‹å¯†ç å¯ä»¥åœ¨logä¸­æŸ¥çœ‹[root@tinychen-server /root]# grep &#x27;temporary password&#x27; /var/log/mysqld.log[root@tinychen-server /root]# mysql -u root -p 3.2 åˆ›å»ºç”¨æˆ·æ¥ä¸‹æ¥éœ€è¦è¿›è¡ŒåŸºæœ¬çš„æ•°æ®åº“æ“ä½œï¼Œç»™pdnsåˆ›å»ºå¯¹åº”çš„æ•°æ®åº“å’Œç”¨æˆ·å¹¶ç®€å•è®¾ç½®ç›¸å…³æƒé™ï¼š 1234567891011121314-- ä¿®æ”¹å¯†ç ALTER user &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;ä½ çš„æ–°å¯†ç &#x27;;-- æ³¨æ„è¿™é‡Œçš„&#x27;localhost&#x27;ä¹Ÿæœ‰å¯èƒ½æ˜¯åˆ«çš„å‚æ•°ï¼Œå…·ä½“å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ¡å‘½ä»¤æ¥è¿›è¡ŒæŸ¥è¯¢ï¼šselect user, host, authentication_string, plugin from mysql.user;-- åˆ›å»ºä¸€ä¸ªmysqlçš„ç”¨æˆ·åä¸ºpowerdnsï¼Œåªèƒ½æœ¬æœºç™»å½•-- åˆ›å»ºä¸€ä¸ªmysqlçš„æ•°æ®åº“åä¸ºpowerdnsï¼Œå¹¶å…è®¸powerdnsç”¨æˆ·è®¿é—®CREATE USER &#x27;powerdns&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;ä½ çš„æ–°å¯†ç &#x27;;CREATE DATABASE powerdns;GRANT ALL ON powerdns.* TO &#x27;powerdns&#x27;@&#x27;localhost&#x27;;FLUSH PRIVILEGES;-- å¯¹äºMYSQL8éœ€è¦é¢å¤–æŒ‡å®šåŠ å¯†æ–¹å¼é¿å…ERROR 2059 (HY000)çš„é—®é¢˜ALTER USER &#x27;powerdns&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;ä½ çš„æ–°å¯†ç &#x27;; 3.3 åˆ›å»ºæ•°æ®è¡¨åˆ›å»ºæ•°æ®è¡¨çš„æ“ä½œå®Œå…¨æŒ‰ç…§å®˜æ–¹çš„æ–‡æ¡£è¿›è¡Œï¼Œæœ‰ç‰¹æ®Šéœ€è¦çš„ä¹Ÿå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889CREATE TABLE domains ( id INT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, master VARCHAR(128) DEFAULT NULL, last_check INT DEFAULT NULL, type VARCHAR(6) NOT NULL, notified_serial INT UNSIGNED DEFAULT NULL, account VARCHAR(40) CHARACTER SET &#x27;utf8&#x27; DEFAULT NULL, PRIMARY KEY (id)) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;CREATE UNIQUE INDEX name_index ON domains(name);CREATE TABLE records ( id BIGINT AUTO_INCREMENT, domain_id INT DEFAULT NULL, name VARCHAR(255) DEFAULT NULL, type VARCHAR(10) DEFAULT NULL, content VARCHAR(64000) DEFAULT NULL, ttl INT DEFAULT NULL, prio INT DEFAULT NULL, disabled TINYINT(1) DEFAULT 0, ordername VARCHAR(255) BINARY DEFAULT NULL, auth TINYINT(1) DEFAULT 1, PRIMARY KEY (id)) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;CREATE INDEX nametype_index ON records(name,type);CREATE INDEX domain_id ON records(domain_id);CREATE INDEX ordername ON records (ordername);CREATE TABLE supermasters ( ip VARCHAR(64) NOT NULL, nameserver VARCHAR(255) NOT NULL, account VARCHAR(40) CHARACTER SET &#x27;utf8&#x27; NOT NULL, PRIMARY KEY (ip, nameserver)) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;CREATE TABLE comments ( id INT AUTO_INCREMENT, domain_id INT NOT NULL, name VARCHAR(255) NOT NULL, type VARCHAR(10) NOT NULL, modified_at INT NOT NULL, account VARCHAR(40) CHARACTER SET &#x27;utf8&#x27; DEFAULT NULL, comment TEXT CHARACTER SET &#x27;utf8&#x27; NOT NULL, PRIMARY KEY (id)) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;CREATE INDEX comments_name_type_idx ON comments (name, type);CREATE INDEX comments_order_idx ON comments (domain_id, modified_at);CREATE TABLE domainmetadata ( id INT AUTO_INCREMENT, domain_id INT NOT NULL, kind VARCHAR(32), content TEXT, PRIMARY KEY (id)) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;CREATE INDEX domainmetadata_idx ON domainmetadata (domain_id, kind);CREATE TABLE cryptokeys ( id INT AUTO_INCREMENT, domain_id INT NOT NULL, flags INT NOT NULL, active BOOL, published BOOL DEFAULT 1, content TEXT, PRIMARY KEY(id)) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;CREATE INDEX domainidindex ON cryptokeys(domain_id);CREATE TABLE tsigkeys ( id INT AUTO_INCREMENT, name VARCHAR(255), algorithm VARCHAR(50), secret VARCHAR(255), PRIMARY KEY (id)) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;CREATE UNIQUE INDEX namealgoindex ON tsigkeys(name, algorithm); 4ã€pdnsé…ç½®mysql4.1 mysql ç›¸å…³é…ç½®123456789101112131415161718192021222324252627282930313233343536# gmysql-host# éœ€è¦è¿æ¥çš„mysqlçš„IPåœ°å€ï¼Œå’Œgmysql-socketå˜é‡äº’æ–¥# gmysql-port# éœ€è¦è¿æ¥çš„mysqlçš„ç«¯å£å·ï¼Œé»˜è®¤æ˜¯3306# gmysql-socket# éœ€è¦è¿æ¥çš„mysqlçš„UNIX socketåœ°å€ï¼Œå’Œgmysql-hostäº’æ–¥# gmysql-dbname# éœ€è¦è¿æ¥çš„æ•°æ®åº“ï¼Œé»˜è®¤ï¼špowerdns# gmysql-user# è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åï¼Œé»˜è®¤ï¼špowerdns# gmysql-group# è¿æ¥æ•°æ®åº“çš„ç»„ï¼Œé»˜è®¤ï¼šclient# gmysql-password# è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·çš„å¯†ç # gmysql-dnssec# æ˜¯å¦å¯ç”¨dnssecåŠŸèƒ½ï¼Œé»˜è®¤ï¼šno# gmysql-innodb-read-committed# ä½¿ç”¨InnoDBçš„READ-COMMITTEDäº‹åŠ¡éš”ç¦»ï¼Œé»˜è®¤ï¼šyes# gmysql-ssl# æ˜¯å¦å¼€å¯SSLæ”¯æŒï¼Œé»˜è®¤ï¼šno# gmysql-timeout# å°è¯•è¯»å–æ•°æ®åº“çš„è¶…æ—¶æ—¶é—´ï¼Œ0ä¸ºç¦ç”¨ï¼Œé»˜è®¤ï¼š10# gmysql-thread-cleanup# å¯¹äºä¸€äº›è€æ—§ç‰ˆæœ¬çš„MySQL/MariaDBï¼ˆæ¯”å¦‚RHEL7å†…ç½®çš„ç‰ˆæœ¬ï¼‰ä¼šå‡ºç°å†…å­˜æ³„éœ²çš„é—®é¢˜ï¼Œé™¤éåº”ç”¨ç¨‹åºæ˜ç¡®å‘è¯¥åº“æŠ¥å‘Šæ¯ä¸ªçº¿ç¨‹çš„ç»“æŸã€‚å¯ç”¨gmysql-thread-cleanupå‘Šè¯‰PowerDNSæ¯å½“çº¿ç¨‹ç»“æŸæ—¶å°±è°ƒç”¨mysql_thread_endï¼ˆï¼‰ã€‚# åªæœ‰å½“ç¡®å®šè‡ªå·±éœ€è¦å¼€å¯è¿™ä¸ªåŠŸèƒ½çš„æ—¶å€™å†å¼€å¯ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹https://github.com/PowerDNS/pdns/issues/6231. 4.2 pdns.confé…ç½®1234567891011121314151617181920212223242526272829303132333435[root@tiny-server ~]# cat /etc/pdns/pdns.confapi=yesapi-key=ä½ çš„API-KEYconfig-dir=/etc/pdnswrite-pid=yesdaemon=noguardian=nolaunch=gmysqlgmysql-host=localhostgmysql-port=3306gmysql-dbname=ä½ çš„æ•°æ®åº“ågmysql-user=ä½ çš„ç”¨æˆ·ågmysql-password=ä½ çš„å¯†ç log-dns-details=yeslog-dns-queries=yeslog-timestamp=yesloglevel=9logging-facility=0log-timestamp=yessetgid=rootsetuid=rootwebserver=yeswebserver-address=192.168.100.100webserver-loglevel=detailedwebserver-port=8081# webserver-allow-fromæŒ‡å®šå…è®¸è®¿é—®webserverå’ŒAPIçš„IPç™½åå•ï¼Œå¤šä¸ªIPå¯ä»¥ä½¿ç”¨è‹±æ–‡é€—å·éš”å¼€webserver-allow-from=192.168.100.0/24# pdnsæœåŠ¡ç›‘å¬çš„åœ°å€ï¼Œå¤šä¸ªIPå¯ä»¥ä½¿ç”¨è‹±æ–‡é€—å·éš”å¼€local-address=192.168.100.100query-local-address=192.168.100.100 4.3 pdns-recé…ç½®pdns-recçš„é…ç½®æ–‡ä»¶é™¤äº†é»˜è®¤æ–‡ä»¶å‘½åå’Œå°‘æ•°ç‰¹æ®Šçš„é…ç½®é¡¹å¤–ï¼Œå…¶ä»–çš„ç»å¤§éƒ¨åˆ†é…ç½®éƒ½å’Œpdns-authä¸€è‡´ï¼Œè¿™é‡Œä¸ä½œèµ˜è¿°ã€‚ 12[root@tiny-cloud /etc/pdns-recursor]# realpath recursor.conf/etc/pdns-recursor/recursor.conf 5ã€pdnsæ—¥å¿—å¤„ç†å®˜ç½‘çš„ç›¸å…³æ–‡æ¡£å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ï¼Œdebugé˜¶æ®µæˆ‘ä»¬æŠŠæ—¥å¿—çº§åˆ«è°ƒåˆ°äº†æœ€é«˜çš„9ï¼Œä¸ºäº†é¿å…é”™è¿‡é‡è¦ä¿¡æ¯ï¼Œæˆ‘ä»¬æŠŠæ—¥å¿—æŒ‰ç…§ä¸åŒçš„çº§åˆ«åˆ†åˆ«å†™å…¥ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚ ä¿®æ”¹centoså¯¹åº”çš„rsyslogé…ç½®æ–‡ä»¶å¹¶ä¸”é‡å¯æœåŠ¡ 12345678# mkdir -p /etc/pdns/logs# cat /etc/rsyslog.conf | grep pdnslocal0.info /etc/pdns/logs/pdns.info.loglocal0.warn /etc/pdns/logs/pdns.warn.loglocal0.err /etc/pdns/logs/pdns.err.logsystemctl restart rsyslog.service ä¿®æ”¹pdnsçš„systemdçš„unitæ–‡ä»¶ï¼Œå°†é‡Œé¢çš„ç¦ç”¨syslogå‚æ•°å»æ‰ï¼ŒåŒæ—¶å°†å…¶ä»–å¤šä½™çš„æ§åˆ¶é€‰é¡¹ä¹Ÿä¸€å¹¶å»é™¤ï¼Œç»Ÿä¸€å°†å„ç±»å‚æ•°è®¾ç½®é›†ä¸­åˆ°pdns.confæ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿åæœŸçš„ç®¡ç†å’Œè¿ç»´ã€‚ 12345678vim /usr/lib/systemd/system/pdns.service# å°†åŸæ¥çš„å¯åŠ¨å‚æ•°å…¨éƒ¨æ›¿æ¢æ‰# ExecStart=/usr/sbin/pdns_server --socket-dir=%t/pdns --guardian=no --daemon=no --disable-syslog --log-timestamp=no --write-pid=no# æ›¿æ¢ä¸ºExecStart=/usr/sbin/pdns_server --socket-dir=%t/pdnssystemctl daemon-reload 6ã€pdns-authçš„APIè¯·æ±‚PDNSæä¾›äº†APIåŠŸèƒ½ï¼Œè¯·æ±‚çš„æ—¶å€™éœ€è¦æ³¨æ„æ­£ç¡®æºå¸¦é…ç½®ä¸­çš„api-keyï¼Œå¦åˆ™ä¼šæ— æ³•è¿”å›æ­£ç¡®çš„ç»“æœï¼Œè€Œæ˜¯æ˜¾ç¤º401 Unauthorizedé”™è¯¯ã€‚ 123456789101112131415161718[root@tiny-server ~]# curl -v http://192.168.100.100:8081/api/v1/servers* Trying 192.168.100.100...* TCP_NODELAY set* Connected to 192.168.100.100 (192.168.100.100) port 8081 (#0)&gt; GET /api/v1/servers HTTP/1.1&gt; Host: 192.168.100.100:8081&gt; User-Agent: curl/7.61.1&gt; Accept: */*&gt;&lt; HTTP/1.1 401 Unauthorized&lt; Connection: close&lt; Content-Length: 12&lt; Content-Type: text/plain; charset=utf-8&lt; Server: PowerDNS/4.4.0&lt; Www-Authenticate: X-API-Key realm=&quot;PowerDNS&quot;&lt;* Closing connection 0Unauthorized è¯·æ±‚æ­£ç¡®çš„æƒ…å†µä¸‹ä¼šè¿”å›jsonæ ¼å¼çš„ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324[root@tiny-server ~]# curl -v -H &#x27;X-API-Key: é…ç½®ä¸­çš„api-key&#x27; http://192.168.100.100:8081/api/v1/servers* Trying 192.168.100.100...* TCP_NODELAY set* Connected to 192.168.100.100 (192.168.100.100) port 8081 (#0)&gt; GET /api/v1/servers HTTP/1.1&gt; Host: 192.168.100.100:8081&gt; User-Agent: curl/7.61.1&gt; Accept: */*&gt; X-API-Key: é…ç½®ä¸­çš„api-key&gt;&lt; HTTP/1.1 200 OK&lt; Access-Control-Allow-Origin: *&lt; Connection: close&lt; Content-Length: 249&lt; Content-Security-Policy: default-src &#x27;self&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;&lt; Content-Type: application/json&lt; Server: PowerDNS/4.4.0&lt; X-Content-Type-Options: nosniff&lt; X-Frame-Options: deny&lt; X-Permitted-Cross-Domain-Policies: none&lt; X-Xss-Protection: 1; mode=block&lt;* Closing connection 0[&#123;&quot;config_url&quot;: &quot;/api/v1/servers/localhost/config&#123;/config_setting&#125;&quot;, &quot;daemon_type&quot;: &quot;authoritative&quot;, &quot;id&quot;: &quot;localhost&quot;, &quot;type&quot;: &quot;Server&quot;, &quot;url&quot;: &quot;/api/v1/servers/localhost&quot;, &quot;version&quot;: &quot;4.4.0&quot;, &quot;zones_url&quot;: &quot;/api/v1/servers/localhost/zones&#123;/zone&#125;&quot;&#125;] 7ã€DNSè§£æå¯¹äºpdns-recè€Œè¨€ï¼Œæ˜¯å•çº¯çš„ä¸€ä¸ªé€’å½’æŸ¥è¯¢å™¨ï¼ˆRecursorï¼‰ï¼Œä¼šæ ¹æ®è®¾ç½®çš„ç¼“å­˜æ—¶é—´æ¥ç¼“å­˜å‘ä¸ŠæŸ¥è¯¢åˆ°çš„DNSè®°å½•ã€‚ ç†è®ºä¸ŠPDNS Authåªä¼šæŸ¥è¯¢è‡ªå·±å·²æœ‰çš„DNSè®°å½•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šç›´æ¥è¿”å›ç©ºï¼Œè€Œä¸æ˜¯ç»§ç»­å‘ä¸Šé€’å½’æŸ¥è¯¢ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è½»é‡å‹çš„DNSæœåŠ¡å™¨dnsmasqä½œä¸ºå¯¹æ¯”ï¼Œä¸¤è€…éƒ½æ²¡æœ‰æ‰‹åŠ¨æ·»åŠ ä»»ä½•çš„DNSè§£æè®°å½•ã€‚ ä»ä¸Šé¢çš„æµ‹è¯•ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡ºpdns authåªä¼šè¿”å›è‡ªå·±çš„æ•°æ®åº“ä¸­å­˜åœ¨çš„è®°å½•ã€‚äºæ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ è®°å½•åˆ°pdnsä¸­å†è¿›è¡ŒæŸ¥è¯¢ã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨pdnsutilå·¥å…·æ¥ç®€å•æµ‹è¯•ï¼Œé¦–å…ˆæˆ‘ä»¬ç®€å•çš„åˆ›å»ºä¸€ä¸ªå…³äºexample.orgçš„zoneï¼Œç„¶åæˆ‘ä»¬å†åˆ›å»ºå…³äºexample.orgçš„ä¸€æ¡Aè®°å½•å’ŒMXè®°å½•ï¼Œæ¥ç€ä½¿ç”¨digå‘½ä»¤æ¥è¿›è¡Œæµ‹è¯•ï¼š 123456789101112131415161718192021222324[root@tiny-server pdns]# pdnsutil create-zone example.org ns1.example.comFeb 24 16:54:48 gmysql Connection successful. Connected to database &#x27;powerdns&#x27; on &#x27;localhost&#x27;.Feb 24 16:54:48 gmysql Connection successful. Connected to database &#x27;powerdns&#x27; on &#x27;localhost&#x27;.Creating empty zone &#x27;example.org&#x27;Feb 24 16:54:48 No serial for &#x27;example.org&#x27; found - zone is missing?Also adding one NS record[root@tiny-server pdns]# pdnsutil list-all-zonesFeb 24 16:54:59 gmysql Connection successful. Connected to database &#x27;powerdns&#x27; on &#x27;localhost&#x27;.Feb 24 16:54:59 gmysql Connection successful. Connected to database &#x27;powerdns&#x27; on &#x27;localhost&#x27;.tinychen.comexample.org[root@tiny-server pdns]# pdnsutil add-record example.org &#x27;&#x27; MX &#x27;25 mail.example.org&#x27;Feb 24 16:55:36 gmysql Connection successful. Connected to database &#x27;powerdns&#x27; on &#x27;localhost&#x27;.Feb 24 16:55:36 gmysql Connection successful. Connected to database &#x27;powerdns&#x27; on &#x27;localhost&#x27;.New rrset:example.org. 3600 IN MX 25 mail.example.org[root@tiny-server pdns]# pdnsutil add-record example.org. www A 192.168.100.100Feb 24 16:56:09 gmysql Connection successful. Connected to database &#x27;powerdns&#x27; on &#x27;localhost&#x27;.Feb 24 16:56:09 gmysql Connection successful. Connected to database &#x27;powerdns&#x27; on &#x27;localhost&#x27;.New rrset:www.example.org. 3600 IN A 192.168.100.100 åŒæ ·çš„æˆ‘ä»¬å¯¹tinychen.comè¿›è¡Œç›¸åŒçš„æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°è¿™æ—¶å·²ç»èƒ½å¤Ÿè§£æå‡ºå¯¹åº”çš„IPäº†ã€‚ ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹åº”çš„tinychen.comåŸŸåè§£æå‡ºæ¥çš„è®°å½•æ˜¯æˆ‘ä»¬æ‰‹åŠ¨è®¾å®šçš„IPå€¼ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"powerdns","slug":"powerdns","permalink":"https://tinychen.com/tags/powerdns/"}]},{"title":"Prometheusç³»åˆ—01-å•æœºç‰ˆäºŒè¿›åˆ¶éƒ¨ç½²","slug":"20210105-prometheus-01-binary-install","date":"2021-01-05T03:00:00.000Z","updated":"2021-01-05T03:00:00.000Z","comments":true,"path":"20210105-prometheus-01-binary-install/","link":"","permalink":"https://tinychen.com/20210105-prometheus-01-binary-install/","excerpt":"ä½œä¸º CNCF ä¸­æœ€æˆåŠŸçš„å¼€æºé¡¹ç›®ä¹‹ä¸€ï¼ŒPrometheus å·²ç»æˆä¸ºäº†äº‘åŸç”Ÿç›‘æ§çš„ä»£åè¯ï¼Œè¢«å¹¿æ³›åº”ç”¨åœ¨ Kuberneteså’ŒOpenShift ç­‰é¡¹ç›®ä¸­ï¼ŒåŒæ—¶æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆä¹Ÿä¼šé›†æˆ Prometheusã€‚éšç€ Kubernetes åœ¨å®¹å™¨è°ƒåº¦å’Œç®¡ç†ä¸Šç¡®å®šé¢†å¤´ç¾Šçš„åœ°ä½ï¼ŒPrometheus ä¹Ÿæˆä¸ºKuberneteså®¹å™¨ç›‘æ§çš„æ ‡é…ã€‚ è€ƒè™‘åˆ°k8sç³»ç»Ÿçš„å¤æ‚æ€§å’Œä¸Šæ‰‹éš¾åº¦è¾ƒé«˜ï¼Œæœ¬æ–‡å°†ä»æœ€ç®€å•æœ€åŸºç¡€çš„éƒ¨åˆ†å¼€å§‹å¾ªåºæ¸è¿›ï¼Œä¸»è¦ä»‹ç»å¦‚ä½•åœ¨CentOS8ç³»ç»Ÿä¸Šç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å’Œsystemdè¿›è¡ŒPrometheus serverçš„å•æœºç‰ˆæœ¬éƒ¨ç½²ï¼Œæœ¬æ–‡åªæ¶‰åŠåˆ°æœ€åŸºç¡€çš„Prometheus serverã€node_exporterå’ŒGrafanaä¸‰ä¸ªæ¨¡å—ï¼Œæš‚æœªæ¶‰åŠPushgatewayå’ŒAlertmanagerä¸¤ä¸ªæ¨¡å—ã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒPrometheus serveræ˜¯ç”¨äºä½œä¸ºæœåŠ¡ç«¯æ¥å­˜å‚¨å„ç±»exporteråœ¨è¢«ç›‘æ§èŠ‚ç‚¹ä¸Šé¢é‡‡é›†çš„æ•°æ®ï¼Œè€ŒGrafanaåˆ™è´Ÿè´£å°†Prometheus serverä¸Šçš„æ•°æ®å¯è§†åŒ–ï¼Œå› æ­¤Prometheus serverå’ŒGrafanaä¸ä¸€å®šè¦éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šé¢ï¼Œåªéœ€è¦éƒ¨ç½²ä¸¤è€…çš„æœºå™¨èƒ½å¤Ÿäº’ç›¸é€šä¿¡å³å¯ï¼ŒåŒç†ï¼Œå„ç±»exporteråº”è¯¥éƒ¨ç½²åœ¨éœ€è¦è¢«ç›‘æ§çš„èŠ‚ç‚¹æœºå™¨ä¸Šã€‚è¿™é‡Œç”±äºæœºå™¨æ•°é‡æœ‰é™ä¸”åªä½œä¸ºæµ‹è¯•ï¼Œä¼šå°†ä¸‰è€…éƒ½éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚","text":"ä½œä¸º CNCF ä¸­æœ€æˆåŠŸçš„å¼€æºé¡¹ç›®ä¹‹ä¸€ï¼ŒPrometheus å·²ç»æˆä¸ºäº†äº‘åŸç”Ÿç›‘æ§çš„ä»£åè¯ï¼Œè¢«å¹¿æ³›åº”ç”¨åœ¨ Kuberneteså’ŒOpenShift ç­‰é¡¹ç›®ä¸­ï¼ŒåŒæ—¶æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆä¹Ÿä¼šé›†æˆ Prometheusã€‚éšç€ Kubernetes åœ¨å®¹å™¨è°ƒåº¦å’Œç®¡ç†ä¸Šç¡®å®šé¢†å¤´ç¾Šçš„åœ°ä½ï¼ŒPrometheus ä¹Ÿæˆä¸ºKuberneteså®¹å™¨ç›‘æ§çš„æ ‡é…ã€‚ è€ƒè™‘åˆ°k8sç³»ç»Ÿçš„å¤æ‚æ€§å’Œä¸Šæ‰‹éš¾åº¦è¾ƒé«˜ï¼Œæœ¬æ–‡å°†ä»æœ€ç®€å•æœ€åŸºç¡€çš„éƒ¨åˆ†å¼€å§‹å¾ªåºæ¸è¿›ï¼Œä¸»è¦ä»‹ç»å¦‚ä½•åœ¨CentOS8ç³»ç»Ÿä¸Šç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å’Œsystemdè¿›è¡ŒPrometheus serverçš„å•æœºç‰ˆæœ¬éƒ¨ç½²ï¼Œæœ¬æ–‡åªæ¶‰åŠåˆ°æœ€åŸºç¡€çš„Prometheus serverã€node_exporterå’ŒGrafanaä¸‰ä¸ªæ¨¡å—ï¼Œæš‚æœªæ¶‰åŠPushgatewayå’ŒAlertmanagerä¸¤ä¸ªæ¨¡å—ã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒPrometheus serveræ˜¯ç”¨äºä½œä¸ºæœåŠ¡ç«¯æ¥å­˜å‚¨å„ç±»exporteråœ¨è¢«ç›‘æ§èŠ‚ç‚¹ä¸Šé¢é‡‡é›†çš„æ•°æ®ï¼Œè€ŒGrafanaåˆ™è´Ÿè´£å°†Prometheus serverä¸Šçš„æ•°æ®å¯è§†åŒ–ï¼Œå› æ­¤Prometheus serverå’ŒGrafanaä¸ä¸€å®šè¦éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šé¢ï¼Œåªéœ€è¦éƒ¨ç½²ä¸¤è€…çš„æœºå™¨èƒ½å¤Ÿäº’ç›¸é€šä¿¡å³å¯ï¼ŒåŒç†ï¼Œå„ç±»exporteråº”è¯¥éƒ¨ç½²åœ¨éœ€è¦è¢«ç›‘æ§çš„èŠ‚ç‚¹æœºå™¨ä¸Šã€‚è¿™é‡Œç”±äºæœºå™¨æ•°é‡æœ‰é™ä¸”åªä½œä¸ºæµ‹è¯•ï¼Œä¼šå°†ä¸‰è€…éƒ½éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚ Prometheusæœ€åˆèµ·æºäºSoundCloudæ„å»ºçš„ç›‘æ§ç³»ç»Ÿå’Œå‘Šè­¦å·¥å…·ï¼Œæ˜¯Google BorgMonç›‘æ§ç³»ç»Ÿçš„å¼€æºç‰ˆæœ¬ã€‚å®ƒåŸºäºGoè¯­è¨€ä¸”è‡ªå¸¦æ—¶åºå‹æ•°æ®åº“ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€DevOpså·¥ç¨‹å¸ˆåœ¨éƒ¨ç½²Prometheusç›‘æ§ç³»ç»Ÿçš„æ—¶å€™æ— éœ€å†é¢å¤–æ­å»ºæ•°æ®åº“ï¼Œå½“ç„¶å¦‚æœæœ‰æ›´é«˜çš„éœ€æ±‚ä¹Ÿå¯ä»¥è‡ªè¡Œæ­å»ºå…¶ä»–çš„æ—¶åºæ€§æ•°æ®åº“ï¼ˆTSDBï¼‰ã€‚ Prometheusçš„åŸºæœ¬åŸç†æ˜¯é€šè¿‡ HTTPå‘¨æœŸæ€§æŠ“å–è¢«ç›‘æ§ç»„ä»¶çš„çŠ¶æ€ï¼Œä»»æ„ç»„ä»¶åªè¦æä¾›å¯¹åº”çš„ HTTP æ¥å£å¹¶ä¸”ç¬¦åˆ Prometheus å®šä¹‰çš„æ•°æ®æ ¼å¼ï¼Œå°±å¯ä»¥æ¥å…¥Prometheusç›‘æ§ã€‚æ­¤å¤–ï¼Œä½¿ç”¨Grafana çš„Prometheusçš„æ•°æ®å¯è§†åŒ–ç¨‹åº¦éå¸¸é«˜ï¼Œå‘Šè­¦è§„åˆ™ä¹Ÿååˆ†å¤šæ ·ï¼Œè¿˜æ”¯æŒä¼ ç»ŸæœåŠ¡å™¨ç›‘æ§ä»¥åŠäº‘åŸç”Ÿç›‘æ§ï¼Œå¯ä»¥ç§°ä¸ºæ˜¯ç›‘æ§ç³»ç»Ÿä¸­çš„â€œç‘å£«å†›åˆ€â€ã€‚ 1ã€éƒ¨ç½²prometheusæˆ‘ä»¬å»å®˜ç½‘é€‰æ‹©åˆé€‚çš„äºŒè¿›åˆ¶ç‰ˆæœ¬è¿›è¡Œä¸‹è½½å¹¶è§£å‹ 12wget https://github.com/prometheus/prometheus/releases/download/v2.23.0/prometheus-2.23.0.linux-amd64.tar.gztar -zxvf prometheus-2.23.0.linux-amd64.tar.gz ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„prometheusç”¨æˆ·æ¥è¿è¡Œprometheusï¼ŒåŒæ—¶è¦ä¿è¯å®‰å…¨ï¼Œåˆ›å»ºçš„ç”¨æˆ·åªç”¨æ¥è¿è¡Œprometheusè€Œä¸èƒ½ä½¿ç”¨shellç™»å½•ã€‚ 123groupadd prometheususeradd -g prometheus -s /sbin/nologin prometheuschown -R prometheus.prometheus /home/prometheus ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®ä½¿ç”¨systemdå¯¹è¿›ç¨‹è¿›è¡Œç®¡ç† 123456789101112131415161718192021222324vim /usr/lib/systemd/system/prometheus.service[Unit]Description=PrometheusDocumentation=https://prometheus.io/After=network.target[Service]# Typeè®¾ç½®ä¸ºnotifyæ—¶ï¼ŒæœåŠ¡ä¼šä¸æ–­é‡å¯Type=simpleUser=prometheus# --storage.tsdb.pathæ˜¯å¯é€‰é¡¹ï¼Œé»˜è®¤æ•°æ®ç›®å½•åœ¨è¿è¡Œç›®å½•çš„./dadaç›®å½•ä¸­ExecStart=/home/prometheus/prometheus --config.file=/home/prometheus/prometheus.yml --storage.tsdb.path=/home/prometheusRestart=on-failure[Install]WantedBy=multi-user.targetchown prometheus.prometheus /usr/lib/systemd/system/prometheus.servicesystemctl daemon-reloadsystemctl enable prometheus.servicesystemctl start prometheus.servicesystemctl status prometheus.service å¦‚æ— æ„å¤–åº”è¯¥å·²ç»å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼ŒåŒæ—¶è®¿é—®æœåŠ¡å™¨çš„9090ç«¯å£å¯ä»¥æŸ¥çœ‹åˆ°ç®€å•çš„UIç•Œé¢ 2ã€éƒ¨ç½²node_exporteræˆ‘ä»¬å»å®˜ç½‘é€‰æ‹©åˆé€‚çš„äºŒè¿›åˆ¶ç‰ˆæœ¬è¿›è¡Œä¸‹è½½å¹¶è§£å‹ 1234wget https://github.com/prometheus/node_exporter/releases/download/v1.0.1/node_exporter-1.0.1.linux-amd64.tar.gztar -zxvf node_exporter-1.0.1.linux-amd64.tar.gzmv node_exporter-1.0.1.linux-amd64 node_exporterchown -R prometheus.prometheus /home/node_exporter åŒæ ·çš„æˆ‘ä»¬ä½¿ç”¨systemdè¿›è¡Œç®¡ç† 123456789101112131415161718192021222324vim /usr/lib/systemd/system/node_exporter.service[Unit]Description=Prometheus-node_exporterDocumentation=https://prometheus.io/After=network.target# æ³¨æ„ä¸‹é¢è¿™ä¸¤é¡¹å‚æ•°æ˜¯CentOS8çš„systemdæ‰æ”¯æŒçš„StartLimitBurst=1StartLimitIntervalSec=15s[Service]Type=simpleUser=prometheusExecStart=/home/node_exporter/node_exporterRestart=on-failure[Install]WantedBy=multi-user.targetchown prometheus.prometheus /usr/lib/systemd/system/node_exporter.servicesystemctl daemon-reloadsystemctl enable node_exporter.servicesystemctl start node_exporter.servicesystemctl status node_exporter.service å¦‚æœé¡ºåˆ©çš„è¯ï¼Œnode_exporteråº”è¯¥å°±æ­£å¸¸è¿è¡Œåœ¨é»˜è®¤çš„9100ç«¯å£äº†ï¼Œå†æŸ¥çœ‹9090ç«¯å£çš„prometheusçš„webé¡µé¢ç§çš„Statusé‡Œé¢çš„Targetsåº”è¯¥å°±èƒ½å¤Ÿçœ‹åˆ°å·²ç»è¿è¡Œèµ·æ¥çš„ç›‘æ§äº†ã€‚ æ¥ç€æˆ‘ä»¬éœ€è¦ä¿®æ”¹Prometheusçš„é…ç½®æ–‡ä»¶/home/prometheus/prometheus.ymlï¼Œæ·»åŠ å¯¹åº”çš„jobï¼Œä½¿å…¶ç›‘å¬å¯¹åº”IPçš„9100ç«¯å£è·å–ä¿¡æ¯å¹¶é‡å¯Prometheusã€‚ 12345678scrape_configs: - job_name: &#x27;prometheus&#x27; static_configs: - targets: [&#x27;192.168.100.100:9090&#x27;] - job_name: &#x27;tiny-server&#x27; static_configs: - targets: [&#x27;192.168.100.100:9100&#x27;] 3ã€éƒ¨ç½²grafanaå®˜ç½‘ç»™å‡ºäº†å¤šç§ç‰ˆæœ¬ç³»ç»Ÿçš„å®‰è£…æ•™ç¨‹ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯CentOSï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½å¯¹åº”çš„RPMåŒ…ç„¶åç›´æ¥å®‰è£…ï¼Œå¯¹åº”çš„æ“ä½œå¦‚ä¸‹ 1234567wget https://dl.grafana.com/oss/release/grafana-7.3.6-1.x86_64.rpmsudo yum install grafana-7.3.6-1.x86_64.rpmsystemctl daemon-reloadsystemctl enable grafana-server.servicesystemctl start grafana-server.servicesystemctl status grafana-server.service å¯¹åº”çš„é…ç½®æ–‡ä»¶ä½äº/etc/grafana/grafana.iniï¼Œå¦‚æœæœ‰éœ€è¦å¯ä»¥è¿›è¡Œæ›´æ”¹ï¼Œç„¶åé‡å¯æœåŠ¡ã€‚ é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬ç›´æ¥è®¿é—®å¯¹åº”æœåŠ¡å™¨çš„3000ç«¯å£ï¼Œç„¶åä½¿ç”¨åˆå§‹çš„ç”¨æˆ·åå’Œå¯†ç admin/adminè¿›è¡Œç™»å½•å¹¶ä¸”ä¿®æ”¹åˆå§‹å¯†ç ã€‚ éšåæˆ‘ä»¬å¼€å§‹æ·»åŠ æ•°æ®æº æ¥ä¸‹æ¥åœ¨é…ç½®ä¸­å¡«å…¥ç›¸åº”çš„ç½‘å€å’Œç«¯å£å³å¯ï¼Œä¸€èˆ¬å¦‚æœæ²¡æœ‰è¿›è¡Œç‰¹æ®Šä¿®æ”¹ï¼Œä½¿ç”¨é»˜è®¤çš„é…ç½®å³å¯è¯»å–åˆ°ç›¸åº”çš„æ•°æ®æº å‰é¢æˆ‘ä»¬å·²ç»éƒ¨ç½²äº†node_exporterï¼Œå®ƒä¼šé‡‡é›†ç›¸åº”çš„æ•°æ®åˆ°éƒ¨ç½²çš„æœºå™¨çš„9100ç«¯å£ï¼Œæˆ‘ä»¬è¿™é‡Œå†åˆ°Grafanaä¸­æ·»åŠ å¯¹åº”çš„dashboardå°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„å›¾è¡¨æ•°æ®äº†ã€‚Grafanaå®˜æ–¹æä¾›çš„dashboardéå¸¸å¤šï¼Œå¯¹åº”node_exporterçš„å¯ä»¥è¿›è¡Œæœç´¢ä¸‹è½½ï¼Œç„¶åå†ä¸Šä¼ åˆ°Grafanaä¸­ï¼Œå½“ç„¶å¦‚æœç½‘ç»œæ­£å¸¸çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å¯¼å…¥é¢æ¿ä¸­è¾“å…¥å¯¹åº”çš„IDç¼–å·å°±å¯ä»¥ç›´æ¥å¯¼å…¥ï¼Œç”±äºæˆ‘ä»¬çš„ç‰ˆæœ¬è¶³å¤Ÿæ–°ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸­æ–‡ç‰ˆæœ¬çš„node_exporterçš„dashboardï¼Œå¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹è¯¦æƒ…ã€‚ éƒ¨åˆ†æ•ˆæœå±•ç¤ºå¦‚ä¸‹ï¼š","categories":[{"name":"sre","slug":"sre","permalink":"https://tinychen.com/categories/sre/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"prometheus","slug":"prometheus","permalink":"https://tinychen.com/tags/prometheus/"}]},{"title":"ç»™sshæœåŠ¡æ·»åŠ fail2banå®‰å…¨è®¤è¯","slug":"20201222-centos8-install-fail2ban","date":"2020-12-22T03:00:00.000Z","updated":"2020-12-22T03:00:00.000Z","comments":true,"path":"20201222-centos8-install-fail2ban/","link":"","permalink":"https://tinychen.com/20201222-centos8-install-fail2ban/","excerpt":"æœ¬æ–‡ä¸»è¦è®²è§£åœ¨centos8ç³»ç»Ÿä¸­å®‰è£…fail2banæœåŠ¡æ¥æä¾›sshæœåŠ¡çš„å®‰å…¨æ€§ã€‚ æœ¬æ–‡å‚è€ƒé“¾æ¥ã€‚","text":"æœ¬æ–‡ä¸»è¦è®²è§£åœ¨centos8ç³»ç»Ÿä¸­å®‰è£…fail2banæœåŠ¡æ¥æä¾›sshæœåŠ¡çš„å®‰å…¨æ€§ã€‚ æœ¬æ–‡å‚è€ƒé“¾æ¥ã€‚ fail2banç”¨æ¥ä¿æŠ¤sshçš„åŸç†éå¸¸ç®€å•ï¼Œä¸»è¦å°±æ˜¯é€šè¿‡æ£€æµ‹sshçš„æ—¥å¿—ï¼Œè®°å½•ä¸‹é¢‘ç¹ç™»å½•å¤±è´¥çš„IPï¼Œç„¶åä½¿ç”¨iptablesæ¥ç›´æ¥ç¦ç”¨æ‰è¿™ä¸ªIPå¯¹åº”çš„è¯·æ±‚å³å¯å®ç°sshçš„é˜²æš´åŠ›ç ´è§£ã€‚ 1ã€å®‰è£…fail2bancentosä¸­å¯ä»¥ç›´æ¥å¯ç”¨epelæºæ¥ç›´æ¥è¿›è¡Œå®‰è£… 12yum install epel-releaseyum install fail2ban 2ã€é…ç½®fail2banfail2bançš„ä¸»è¦é…ç½®ç›®å½•ä½äº/etc/fail2ban 1234567891011121314151617181920212223242526[root@tiny-server fail2ban]# cat jail.local[DEFAULT]# ä»¥ç©ºæ ¼åˆ†éš”çš„åˆ—è¡¨ï¼Œå¯ä»¥æ˜¯ IP åœ°å€ã€CIDR å‰ç¼€æˆ–è€… DNS ä¸»æœºå# ç”¨äºæŒ‡å®šå“ªäº›åœ°å€å¯ä»¥å¿½ç•¥ fail2ban é˜²å¾¡ignoreip = 192.168.0.0/24# å®¢æˆ·ç«¯ä¸»æœºè¢«ç¦æ­¢çš„æ—¶é•¿ï¼ˆç§’ï¼‰bantime = 8640000# å®¢æˆ·ç«¯ä¸»æœºè¢«ç¦æ­¢å‰å…è®¸å¤±è´¥çš„æ¬¡æ•°maxretry = 3# æŸ¥æ‰¾å¤±è´¥æ¬¡æ•°çš„æ—¶é•¿ï¼ˆç§’ï¼‰findtime = 600mta = sendmail[ssh-iptables]enabled = truefilter = sshdaction = iptables[name=SSH, port=ssh, protocol=tcp]sendmail-whois[name=SSH-Fail2ban, dest=example@mail.com, sender=fail2ban@email.com]# Red Hat ç³»çš„å‘è¡Œç‰ˆlogpath = /var/log/secure# ssh æœåŠ¡çš„æœ€å¤§å°è¯•æ¬¡æ•°maxretry = 3 3ã€é‡å¯æœåŠ¡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849[root@tiny-server jail.d]# sudo systemctl restart fail2ban[root@tiny-server jail.d]# sudo systemctl status fail2banâ— fail2ban.service - Fail2Ban Service Loaded: loaded (/usr/lib/systemd/system/fail2ban.service; disabled; vendor preset: disabled) Active: active (running) since Tue 2020-12-22 16:01:45 +08; 5s ago Docs: man:fail2ban(1) Process: 46536 ExecStartPre=/bin/mkdir -p /run/fail2ban (code=exited, status=0/SUCCESS) Main PID: 46539 (f2b/server) Tasks: 5 (limit: 408286) Memory: 13.4M CGroup: /system.slice/fail2ban.service â””â”€46539 /usr/bin/python3.6 -s /usr/bin/fail2ban-server -xf startDec 22 16:01:45 tiny-server systemd[1]: Starting Fail2Ban Service...Dec 22 16:01:45 tiny-server systemd[1]: Started Fail2Ban Service.Dec 22 16:01:45 tiny-server fail2ban-server[46539]: Server ready# æµ‹è¯•æ˜¯å¦æ­£å¸¸è¿è¡Œ[root@tiny-server jail.d]# sudo fail2ban-client pingServer replied: pong# æ·»åŠ æœåŠ¡å¼€æœºå¯åŠ¨[root@tiny-server jail.d]# sudo systemctl enable fail2banCreated symlink /etc/systemd/system/multi-user.target.wants/fail2ban.service â†’ /usr/lib/systemd/system/fail2ban.service.# æŸ¥çœ‹fail2bançš„æ—¥å¿—[root@tiny-server fail2ban]# tail -f /var/log/fail2ban.log# æŸ¥çœ‹fail2bançŠ¶æ€[root@tiny-server fail2ban]# fail2ban-client statusStatus|- Number of jail: 1`- Jail list: ssh-iptables[root@tiny-server fail2ban]# fail2ban-client status ssh-iptablesStatus for the jail: ssh-iptables|- Filter| |- Currently failed: 0| |- Total failed: 0| `- File list: /var/log/secure`- Actions |- Currently banned: 0 |- Total banned: 0 `- Banned IP list:# æŸ¥çœ‹iptablesçš„ç¦ç”¨æƒ…å†µsudo iptables --list -n # è§£ç¦ä¸€ä¸ªç‰¹å®šIPfail2ban-client set ssh-iptables unbanip 192.168.1.8","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"ssh","slug":"ssh","permalink":"https://tinychen.com/tags/ssh/"},{"name":"fail2ban","slug":"fail2ban","permalink":"https://tinychen.com/tags/fail2ban/"}]},{"title":"ubuntu20.04åˆå§‹åŒ–çš„éƒ¨åˆ†æ“ä½œ","slug":"20201220-ubuntu2004-init","date":"2020-12-20T03:00:00.000Z","updated":"2020-12-20T03:00:00.000Z","comments":true,"path":"20201220-ubuntu2004-init/","link":"","permalink":"https://tinychen.com/20201220-ubuntu2004-init/","excerpt":"æœ¬æ–‡ä¸»è¦è®²è§£åœ¨ubuntu20.04ç³»ç»Ÿå®‰è£…åéœ€è¦è¿›è¡Œçš„ä¸€äº›åˆå§‹åŒ–äº‹é¡¹ã€‚","text":"æœ¬æ–‡ä¸»è¦è®²è§£åœ¨ubuntu20.04ç³»ç»Ÿå®‰è£…åéœ€è¦è¿›è¡Œçš„ä¸€äº›åˆå§‹åŒ–äº‹é¡¹ã€‚ 1ã€å®‰è£…sshæœåŠ¡12# ubuntué»˜è®¤æƒ…å†µä¸‹éœ€è¦è‡ªå·±å®‰è£…sshæœåŠ¡sudo apt install openssl-server 2ã€æ›´æ¢é•œåƒæºï¼ˆæ¸…åï¼‰å‚è€ƒçš„å®˜æ–¹é“¾æ¥ï¼ŒUbuntu çš„è½¯ä»¶æºé…ç½®æ–‡ä»¶æ˜¯ /etc/apt/sources.listã€‚å°†ç³»ç»Ÿè‡ªå¸¦çš„è¯¥æ–‡ä»¶åšä¸ªå¤‡ä»½ï¼Œå°†è¯¥æ–‡ä»¶æ›¿æ¢ä¸ºä¸‹é¢å†…å®¹ï¼Œå³å¯ä½¿ç”¨ TUNA çš„è½¯ä»¶æºé•œåƒã€‚ 12345678910111213# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Šdeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse# é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse 3ã€é˜²ç«å¢™123# ç¦ç”¨é˜²ç«å¢™tinychen@tiny-server:~$ sudo ufw disableFirewall stopped and disabled on system startup 4ã€ç¦ç”¨IPv61234echo &quot;net.ipv6.conf.all.disable_ipv6=1&quot; &gt;&gt; /etc/sysctl.confecho &quot;net.ipv6.conf.default.disable_ipv6=1&quot; &gt;&gt; /etc/sysctl.confecho &quot;net.ipv6.conf.lo.disable_ipv6=1&quot; &gt;&gt; /etc/sysctl.confsudo sysctl -p 5ã€å®‰è£…nvidiaæ˜¾å¡é©±åŠ¨123456789101112# æŸ¥çœ‹æ˜¾å¡å‹å·å’Œæ¨èå®‰è£…çš„é©±åŠ¨tinychen@tiny-server:~$ ubuntu-drivers devices== /sys/devices/pci0000:00/0000:00:1c.7/0000:08:00.0 ==modalias : pci:v000010DEd00000A66sv00001B0Asd00009060bc03sc00i00vendor : NVIDIA Corporationmodel : GT218 [GeForce 310]driver : nvidia-340 - distro non-free recommendeddriver : xserver-xorg-video-nouveau - distro free builtin# è‡ªåŠ¨å®‰è£…é»˜è®¤æ¨èçš„é©±åŠ¨tinychen@tiny-server:~$ sudo ubuntu-drivers autoinstall[sudo] password for tinychen:","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"ssh","slug":"ssh","permalink":"https://tinychen.com/tags/ssh/"}]},{"title":"ç»™sshæœåŠ¡æ·»åŠ è°·æ­ŒåŒé‡è®¤è¯","slug":"20201203-ssh-add-google-authenticator","date":"2020-12-03T03:00:00.000Z","updated":"2020-12-03T03:00:00.000Z","comments":true,"path":"20201203-ssh-add-google-authenticator/","link":"","permalink":"https://tinychen.com/20201203-ssh-add-google-authenticator/","excerpt":"æœ¬æ–‡ä¸»è¦è®²è§£åœ¨centos7ç³»ç»Ÿä¸­æ·»åŠ è°·æ­ŒéªŒè¯å™¨æ¥å¼€å¯sshçš„åŒé‡è®¤è¯ä»è€Œæé«˜sshæœåŠ¡åœ¨ä½¿ç”¨å¯†ç ç™»å½•çš„æ—¶å€™çš„å®‰å…¨æ€§ã€‚","text":"æœ¬æ–‡ä¸»è¦è®²è§£åœ¨centos7ç³»ç»Ÿä¸­æ·»åŠ è°·æ­ŒéªŒè¯å™¨æ¥å¼€å¯sshçš„åŒé‡è®¤è¯ä»è€Œæé«˜sshæœåŠ¡åœ¨ä½¿ç”¨å¯†ç ç™»å½•çš„æ—¶å€™çš„å®‰å…¨æ€§ã€‚ æœ¬æ–‡å‚è€ƒé“¾æ¥ã€‚ 1ã€Linuxä¸Šå®‰è£…googleéªŒè¯å™¨é¦–å…ˆæˆ‘ä»¬éœ€è¦å¯ç”¨epelä»“åº“ 1yum install epel-release ç„¶åæˆ‘ä»¬éœ€è¦å®‰è£…ç›¸å…³ä¾èµ–åº“ 1yum install pam-devel æ¥ç€ç›´æ¥å®‰è£…googleéªŒè¯å™¨ 1234# æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯yum list google-authenticator# ç›´æ¥å®‰è£…yum install google-authenticator å®‰è£…å®Œæˆä¹‹åè¿›è¡Œåˆå§‹åŒ–é…ç½®ï¼Œç›´æ¥è¿è¡Œä¸‹é¢å‘½ä»¤å¼€å§‹åˆå§‹åŒ–é…ç½® 1google-authenticator åˆå§‹åŒ–è¿‡ç¨‹ä¸­ç”ŸæˆäºŒç»´ç éœ€è¦é€šè¿‡æ‰‹æœºç«¯çš„googleèº«ä»½éªŒè¯å™¨è¿™ä¸ªè½¯ä»¶æ¥æ‰«æç„¶åå°±å¯ä»¥æ·»åŠ åˆ°ä¸€ä¸ª30så˜åŒ–ä¸€æ¬¡çš„åŠ¨æ€å¯†ç ï¼› å¦å¤–è¿˜æœ‰ä¸€ä¸ªç”Ÿæˆçš„emergency scratch codesè®°å¾—è‡ªå·±å°å¿ƒä¿å­˜èµ·æ¥ï¼Œè¿™ä¸ªæ˜¯å½“æ‰‹æœºä¸¢å¤±çš„æ—¶å€™ç”¨æ¥ç´§æ€¥ç™»å½•çš„ï¼› å…¶ä»–çš„é€‰é¡¹æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œé€‰æ‹©ï¼Œä¸çŸ¥é“çš„è¯å°±é»˜è®¤é€‰æ‹©yå³å¯ã€‚ 2ã€ç»™sshå¯ç”¨googleéªŒè¯1echo &quot;auth required pam_google_authenticator.so&quot; &gt;&gt; /etc/pam.d/sshd ä¿®æ”¹sshçš„é…ç½®æ–‡ä»¶/etc/ssh/sshd_configï¼Œå°†ä¸‹åˆ—å‚æ•°è°ƒæ•´ä¸ºyes 1ChallengeResponseAuthentication yes æœ€åæˆ‘ä»¬é‡å¯sshæœåŠ¡å³å¯ 1systemctl restart sshd 3ã€æ•ˆæœé‡å¯ä¹‹åéœ€è¦å†æ¬¡ä½¿ç”¨å¯†ç è¿›è¡Œsshç™»å½•çš„æ—¶å€™å°±éœ€è¦å…ˆè¾“å…¥å‰é¢çš„è°·æ­ŒéªŒè¯ç æ‰èƒ½å†è¾“å…¥å¯†ç ç™»å½•ã€‚ 12Verification code:Password:","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"ssh","slug":"ssh","permalink":"https://tinychen.com/tags/ssh/"}]},{"title":"å¯¹KVMè™šæ‹Ÿæœºæ·»åŠ ttyS0å®ç°consoleæ“ä½œ","slug":"20201129-add-kvm-console-ttys0","date":"2020-11-29T03:00:00.000Z","updated":"2020-11-29T03:00:00.000Z","comments":true,"path":"20201129-add-kvm-console-ttys0/","link":"","permalink":"https://tinychen.com/20201129-add-kvm-console-ttys0/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ç»™KVMè™šæ‹Ÿæœºæ·»åŠ ttyS0ç»ˆç«¯å®ç°å®¿ä¸»æœºçš„consoleæ“ä½œã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ç»™KVMè™šæ‹Ÿæœºæ·»åŠ ttyS0ç»ˆç«¯å®ç°å®¿ä¸»æœºçš„consoleæ“ä½œã€‚ ä¸€èˆ¬æ¥è¯´ç›´æ¥åˆ›å»ºçš„è™šæ‹Ÿæœºæ˜¯æ²¡åŠæ³•åœ¨å®¿ä¸»æœºä¸Šç›´æ¥é€šè¿‡consoleå‘½ä»¤æ¥æ“ä½œï¼Œåœ¨ä½¿ç”¨consoleå‘½ä»¤çš„æ—¶å€™ä¼šå¡åœ¨ä¸‹åˆ—ç•Œé¢ 12345678# æ·»åŠ åˆ°securettyä¸­å…è®¸ç™»å½•grep ttyS0 /etc/securetty || echo &quot;ttyS0&quot; &gt;&gt; /etc/securetty# ä½¿ç”¨grubbyåœ¨å†…æ ¸å‚æ•°ä¸­æ·»åŠ ttyS0grubby --update-kernel=ALL --args=console=ttyS0# æ·»åŠ åˆ°inittabä¸­å®ç°å¼€æœºåˆå§‹åŒ–ttygrep ttyS0 /etc/inittab || echo &quot;S0:12345:respawn:/sbin/agetty ttyS0 115200&quot; &gt;&gt; /etc/inittab# é‡å¯ç”Ÿæ•ˆreboot /etc/inittabæ–‡ä»¶ä¸­çš„é…ç½®æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿›è¡Œä¹¦å†™ 1idï¼šrunlevelsï¼šactionï¼šprocess idï¼šå®ƒæ˜¯æ¯ä¸ªç™»è®°é¡¹çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†æ¯ä¸ªç™»è®°é¡¹ï¼Œä¸èƒ½é‡å¤ runlevelsï¼šç³»ç»Ÿçš„è¿è¡Œçº§åˆ«ï¼Œè¡¨ç¤ºprocessçš„actionè¦åœ¨å“ªä¸ªçº§åˆ«ä¸‹è¿è¡Œï¼Œè¯¥æ®µä¸­å¯ä»¥å®šä¹‰å¤šä¸ªè¿è¡Œçº§åˆ«ï¼Œå„çº§åˆ«ä¹‹é—´ç›´æ¥å†™ä¸ç”¨åˆ†éš”ç¬¦ï¼›å¦‚æœä¸ºç©ºï¼Œè¡¨ç¤ºåœ¨æ‰€æœ‰çš„è¿è¡Œçº§åˆ«è¿è¡Œ actionï¼šè¡¨ç¤ºå¯¹åº”ç™»è®°é¡¹çš„processåœ¨ä¸€å®šæ¡ä»¶ä¸‹æ‰€è¦æ‰§è¡Œçš„åŠ¨ä½œ processï¼šè¡¨ç¤ºå¯åŠ¨å“ªä¸ªç¨‹åºæˆ–è„šæœ¬æˆ–æ‰§è¡Œå“ªä¸ªå‘½ä»¤ç­‰ ä¹‹åå†æ¬¡å°è¯•å°±å¯ä»¥æ­£å¸¸æ“ä½œäº†","categories":[{"name":"â€Œvirtualization","slug":"â€Œvirtualization","permalink":"https://tinychen.com/categories/%E2%80%8Cvirtualization/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"kvm","slug":"kvm","permalink":"https://tinychen.com/tags/kvm/"}]},{"title":"ç»™cpå’Œmvå‘½ä»¤æ·»åŠ è¿›åº¦æ¡","slug":"20201128-add-progess-bar-in-cp-mv","date":"2020-11-28T03:00:00.000Z","updated":"2020-11-28T03:00:00.000Z","comments":true,"path":"20201128-add-progess-bar-in-cp-mv/","link":"","permalink":"https://tinychen.com/20201128-add-progess-bar-in-cp-mv/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨githubä¸Šçš„å¼€æºé¡¹ç›®advcpmvæ¥å®ç°Linuxä¸­çš„cpå’Œmvå‘½ä»¤çš„è¿›åº¦æ¡ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨githubä¸Šçš„å¼€æºé¡¹ç›®advcpmvæ¥å®ç°Linuxä¸­çš„cpå’Œmvå‘½ä»¤çš„è¿›åº¦æ¡ã€‚ ç”±äºcpå’Œmvå‘½ä»¤éƒ½æ˜¯å±äºcoreutilså·¥å…·åŒ…ä¸‹çš„ï¼Œå› æ­¤æˆ‘ä»¬çš„ä¸»è¦æ“ä½œå°±æ˜¯åœ¨ç¼–è¯‘coreutilsçš„æ—¶å€™åŠ å…¥è¡¥ä¸ä»è€Œå®ç°è¿›åº¦æ¡åŠŸèƒ½ 123456789101112131415161718192021# æ³¨æ„å°½é‡ä¸è¦ä½¿ç”¨rootç”¨æˆ·æ“ä½œ[tinychen@tiny-server ~]$ pwd/home/tinychen# ä¸‹è½½coreutils[tinychen@tiny-server ~]$ wget http://ftp.gnu.org/gnu/coreutils/coreutils-8.32.tar.xz[tinychen@tiny-server ~]$ tar -xJf coreutils-8.32.tar.xz[tinychen@tiny-server ~]$ cd coreutils-8.32/# ä¸‹è½½githubä¸Šçš„è¡¥ä¸[tinychen@tiny-server coreutils-8.32]$ wget https://raw.githubusercontent.com/jarun/advcpmv/master/advcpmv-0.8-8.32.patch# æ‰“è¡¥ä¸ï¼Œå®ç°è¿›åº¦æ¡æ˜¾ç¤º[tinychen@tiny-server coreutils-8.32]$ patch -p1 -i advcpmv-0.8-8.32.patchpatching file src/copy.cpatching file src/copy.hpatching file src/cp.cpatching file src/mv.c# ç¼–è¯‘å®‰è£…[tinychen@tiny-server coreutils-8.32]$ ./configure[tinychen@tiny-server coreutils-8.32]$ make# å°†æ‰“è¡¥ä¸ç”Ÿæˆçš„cpå’Œmvå‘½ä»¤çš„äºŒè¿›åˆ¶æ–‡ä»¶å¤åˆ¶åˆ°binç›®å½•ä¸‹[tinychen@tiny-server coreutils-8.32]$ sudo cp src/cp /usr/local/bin/cp[tinychen@tiny-server coreutils-8.32]$ sudo cp src/mv /usr/local/bin/mv æ¥ç€æˆ‘ä»¬åªéœ€è¦åœ¨ä½¿ç”¨cpå’Œmvå‘½ä»¤çš„æ—¶å€™åŠ ä¸Š-gå‚æ•°å°±å¯ä»¥æ˜¾ç¤ºè¿›åº¦æ¡äº†ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§æˆ‘ä»¬å¯ä»¥åœ¨.bashrcæ–‡ä»¶ä¸­è®¾ç½®alias 12alias cp=&#x27;cp -ig&#x27;alias mv=&#x27;mv -ig&#x27; è¯•ä¸€ä¸‹å®é™…æ•ˆæœï¼Œå¤åˆ¶ä¸€ä¸ªå¤§æ–‡ä»¶å¤¹çš„æ—¶å€™å¯ä»¥æ˜¾ç¤ºæ€»è¿›åº¦å’Œå½“å‰æ–‡ä»¶å¤åˆ¶è¿›åº¦ï¼Œä»¥åŠåœ¨å¤åˆ¶å®Œæˆä¹‹åè¿˜å¯ä»¥æ˜¾ç¤ºå¤åˆ¶çš„è¿‡ç¨‹ä¸­çš„å¹³å‡é€Ÿåº¦ã€‚ 1234567[root@tiny-server ~]# cp -r /samba/Elements02/kvm/* /kvm/0 files copied so far... 1.6 GiB / 67.2 GiB[===&gt; ] 2.4 %Copying at 178.4 MiB/s (about 0h 6m 45s remaining)/samba/Elements02/kvm/iso/CentOS-6.10-x86_64-bin-DVD1.iso 1.6 GiB / 3.7 GiB[========================================================================&gt; ] 43.4 %","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"bash","slug":"bash","permalink":"https://tinychen.com/tags/bash/"},{"name":"shell","slug":"shell","permalink":"https://tinychen.com/tags/shell/"}]},{"title":"ä½¿ç”¨acme.shå·¥å…·ç”³è¯·let's encryptçš„æ³›åŸŸåè¯ä¹¦","slug":"20201127-use-acme-letsencrypt-ecc-certs","date":"2020-11-27T03:00:00.000Z","updated":"2020-11-27T03:00:00.000Z","comments":true,"path":"20201127-use-acme-letsencrypt-ecc-certs/","link":"","permalink":"https://tinychen.com/20201127-use-acme-letsencrypt-ecc-certs/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨acme.shå·¥å…·æ¥ç”³è¯·letâ€™s encryptçš„æ³›åŸŸåè¯ä¹¦ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨acme.shå·¥å…·æ¥ç”³è¯·letâ€™s encryptçš„æ³›åŸŸåè¯ä¹¦ã€‚ 1ã€å®‰è£…acme.shå®‰è£…acme.shä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆå®‰è£…å¿…è¦çš„å·¥å…·å’Œä¾èµ– 1yum install socat curl -y æ¥ç€æˆ‘ä»¬å®‰è£…acme.shï¼Œè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦æ‰§è¡Œä¸‹åˆ—æ“ä½œå³å¯è‡ªåŠ¨å®‰è£…ã€‚å¯¹äºå®‰è£…çš„ç”¨æˆ·ï¼Œå®˜æ–¹å£°ç§°å¯ä»¥ä½¿ç”¨rootç”¨æˆ·æˆ–è€…æ™®é€šç”¨æˆ·ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨rootç”¨æˆ·è¿›è¡Œæ“ä½œã€‚ 1curl https://get.acme.sh | sh å®‰è£…çš„è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œä¼šåœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªéšè—ç›®å½•ï¼Œæ‰€æœ‰çš„ç›¸å…³æ–‡ä»¶éƒ½ä¼šå­˜æ”¾åœ¨è¿™é‡Œï¼ŒåŒæ—¶è¿˜ä¼šåˆ›å»ºä¸€ä¸ªcrontabæ¥å®šæ—¶æ‰§è¡Œä»»åŠ¡æ£€æµ‹è¯ä¹¦ã€‚ 123456789101112131415161718192021222324252627[root@aliyun /root]# pwd/root[root@aliyun /root]# curl https://get.acme.sh | sh % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 775 0 775 0 0 963 0 --:--:-- --:--:-- --:--:-- 962 % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 201k 100 201k 0 0 47150 0 0:00:04 0:00:04 --:--:-- 47156[Fri Nov 27 09:50:57 CST 2020] Installing from online archive.[Fri Nov 27 09:50:57 CST 2020] Downloading https://github.com/acmesh-official/acme.sh/archive/master.tar.gz[Fri Nov 27 09:51:00 CST 2020] Extracting master.tar.gz[Fri Nov 27 09:51:00 CST 2020] Installing to /root/.acme.sh[Fri Nov 27 09:51:00 CST 2020] Installed to /root/.acme.sh/acme.sh[Fri Nov 27 09:51:00 CST 2020] Installing alias to &#x27;/root/.bashrc&#x27;[Fri Nov 27 09:51:00 CST 2020] OK, Close and reopen your terminal to start using acme.sh[Fri Nov 27 09:51:00 CST 2020] Installing alias to &#x27;/root/.cshrc&#x27;[Fri Nov 27 09:51:00 CST 2020] Installing alias to &#x27;/root/.tcshrc&#x27;[Fri Nov 27 09:51:00 CST 2020] Installing cron job21 0 * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; &gt; /dev/null[Fri Nov 27 09:51:00 CST 2020] Good, bash is found, so change the shebang to use bash as preferred.[Fri Nov 27 09:51:01 CST 2020] OK[Fri Nov 27 09:51:01 CST 2020] Install success![root@aliyun /root]# crontab -l21 0 * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; &gt; /dev/null[root@aliyun /root]# ll -A | grep acmedrwx------ 5 root root 4.0K Nov 27 09:51 .acme.sh 2ã€é…ç½®é˜¿é‡Œäº‘DNSè§£æç”±äºæ³›åŸŸåè¯ä¹¦ç”³è¯·çš„æ—¶å€™éœ€è¦ä½¿ç”¨DNSè§£æä½œä¸ºè®¤è¯ï¼Œä¸ºäº†ä¿è¯è‡ªåŠ¨ç”³è¯·è¯ä¹¦æˆåŠŸï¼Œæˆ‘ä»¬éœ€è¦ç”³è¯·ä¸€ä¸ªAccess_Keyæ¥è¿›è¡Œæ“ä½œï¼Œè¿™é‡Œä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ 12[root@aliyun /root/.acme.sh/dnsapi]# pwd dns_ali.sh/root/.acme.sh/dnsapi åœ¨é‡Œé¢æ‰¾åˆ°Ali_Keyå’ŒAli_Secretä¸¤ä¸ªå­—æ®µï¼Œå°†ç”³è¯·åˆ°çš„é˜¿é‡Œäº‘access_keyå¡«å…¥é‡Œé¢ï¼Œæ³¨æ„åœ¨é˜¿é‡Œäº‘ä¸­åˆ›å»ºäº†å­ç”¨æˆ·ä¹‹åï¼Œéœ€è¦æˆäºˆå¯¹åº”çš„æƒé™æ‰èƒ½å¯¹DNSè§£æè¿›è¡Œæ“ä½œ 3ã€ç”Ÿæˆè¯ä¹¦æˆ‘ä»¬ä»¥é˜¿é‡Œäº‘DNSç”³è¯·æ³›åŸŸåè¯ä¹¦ä¸ºä¾‹ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤åˆ™å¯ä»¥ç”Ÿæˆå¯¹åº”çš„è¯ä¹¦ 1./acme.sh --issue --dns dns_ali -d tinychen.com -d *.tinychen.com å¯¹äºeccè¯ä¹¦ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨åé¢åŠ ä¸Š--keylength ec-256 1./acme.sh --issue --dns dns_ali -d tinychen.com -d *.tinychen.com --keylength ec-256 å¯¹äºç”Ÿæˆçš„è¯ä¹¦ï¼Œè¯ä¹¦é“¾å’Œå…¬é’¥æ˜¯åˆ†å¼€çš„ï¼Œåœ¨nginxä¸­ï¼Œä¸ºäº†ä¿è¯è¯ä¹¦çš„å®Œæ•´æ€§ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨å¸¦æœ‰è¯ä¹¦é“¾çš„å…¬é’¥ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”è¿™é‡Œç”Ÿæˆçš„fullchain.ceræ–‡ä»¶å°±åŒ…å«äº†å…¬é’¥å’Œè¯ä¹¦é“¾ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"tls","slug":"tls","permalink":"https://tinychen.com/tags/tls/"}]},{"title":"k8sç³»åˆ—01-ä»€ä¹ˆæ˜¯kubernetesï¼Ÿ","slug":"20201120-k8s-01-what-is-kubernetes","date":"2020-11-20T03:00:00.000Z","updated":"2020-11-20T03:00:00.000Z","comments":true,"path":"20201120-k8s-01-what-is-kubernetes/","link":"","permalink":"https://tinychen.com/20201120-k8s-01-what-is-kubernetes/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä»€ä¹ˆæ˜¯k8sä»¥åŠk8sçš„åŸºæœ¬æ¶æ„å’Œç›¸å…³åŸºç¡€æ¦‚å¿µã€‚ Kubernetes ä¸€è¯æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸ºâ€œèˆµæ‰‹â€æˆ–â€œé£è¡Œå‘˜â€ï¼Œä½œä¸ºä¸€ä¸ªå¯ç§»æ¤ã€å¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œk8så¯ä»¥ä½¿ç”¨å£°æ˜å¼é…ç½®æ¥ç®¡ç†ç¼–æ’å®¹å™¨æœåŠ¡å¹¶ä¸”æé«˜è‡ªåŠ¨åŒ–æ°´å¹³å’Œæ•ˆç‡ã€‚åŒæ—¶ï¼Œå¾—ç›Šäºåºå¤§ä¸”ä»ä¸æ–­åœ¨å¢é•¿çš„ç”Ÿæ€ç³»ç»Ÿæ”¯æ’‘ï¼Œk8sæ‹¥æœ‰æµ·é‡å¯ç”¨çš„å‘¨è¾¹æœåŠ¡ã€å·¥å…·å’Œç”Ÿæ€æ”¯æŒã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä»€ä¹ˆæ˜¯k8sä»¥åŠk8sçš„åŸºæœ¬æ¶æ„å’Œç›¸å…³åŸºç¡€æ¦‚å¿µã€‚ Kubernetes ä¸€è¯æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸ºâ€œèˆµæ‰‹â€æˆ–â€œé£è¡Œå‘˜â€ï¼Œä½œä¸ºä¸€ä¸ªå¯ç§»æ¤ã€å¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œk8så¯ä»¥ä½¿ç”¨å£°æ˜å¼é…ç½®æ¥ç®¡ç†ç¼–æ’å®¹å™¨æœåŠ¡å¹¶ä¸”æé«˜è‡ªåŠ¨åŒ–æ°´å¹³å’Œæ•ˆç‡ã€‚åŒæ—¶ï¼Œå¾—ç›Šäºåºå¤§ä¸”ä»ä¸æ–­åœ¨å¢é•¿çš„ç”Ÿæ€ç³»ç»Ÿæ”¯æ’‘ï¼Œk8sæ‹¥æœ‰æµ·é‡å¯ç”¨çš„å‘¨è¾¹æœåŠ¡ã€å·¥å…·å’Œç”Ÿæ€æ”¯æŒã€‚ kuberneteså®˜ç½‘ä¸Šç»™å‡ºçš„å®šä¹‰å¦‚ä¸‹ï¼šKubernetesæ˜¯ç”¨äºè‡ªåŠ¨éƒ¨ç½²ï¼Œæ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„å¼€æºç³»ç»Ÿã€‚ï¼ˆKubernetes, also known as K8s, is an open-source system for automating deployment, scaling, and management of containerized applications.ï¼‰å®ƒå°†ç»„æˆåº”ç”¨ç¨‹åºçš„å®¹å™¨ç»„åˆæˆé€»è¾‘å•å…ƒï¼ˆpodï¼‰ï¼Œä»¥ä¾¿äºç®¡ç†å’ŒæœåŠ¡å‘ç°ã€‚Kubernetes æºè‡ªGoogle 15 å¹´ç”Ÿäº§ç¯å¢ƒçš„è¿ç»´ç»éªŒï¼ŒåŒæ—¶å‡èšäº†ç¤¾åŒºçš„æœ€ä½³åˆ›æ„å’Œå®è·µã€‚ 1ã€è½¯ä»¶éƒ¨ç½²çš„è¿­ä»£è¿›ç¨‹ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè½¯ä»¶éƒ¨åˆ†åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šä¼ ç»Ÿéƒ¨ç½²ã€è™šæ‹ŸåŒ–éƒ¨ç½²ã€å®¹å™¨åŒ–éƒ¨ç½²ã€‚ æ³¨æ„å®¹å™¨åŒ–è™½ç„¶ä¹Ÿå±äºè™šæ‹ŸåŒ–çš„ä¸€ç§ï¼Œä½†æ˜¯è¿™é‡Œæ‰€æŒ‡çš„è™šæ‹ŸåŒ–éƒ¨ç½²æŒ‡çš„æ˜¯é€šè¿‡KVMç­‰è™šæ‹ŸåŒ–æ–¹å¼åˆ›å»ºçš„è™šæ‹Ÿæœºæ¥éƒ¨ç½²åº”ç”¨ã€‚ ä¼ ç»Ÿéƒ¨ç½² åœ¨ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£ï¼Œæ‰€æœ‰çš„åº”ç”¨éƒ½è¿è¡Œåœ¨åŒä¸€å°ç‰©ç†æœºä¸Šé¢ã€‚è¿™ç»™èµ„æºçš„éš”ç¦»å¸¦æ¥äº†å¾ˆå¤§çš„å›°æ‰°ï¼Œä¸åŒçš„åº”ç”¨ä¼šå› ä¸ºäº‰å¤ºç³»ç»Ÿèµ„æºè€Œé™ä½æ€§èƒ½è¡¨ç°ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåº”ç”¨å ç”¨äº†å¤§éƒ¨åˆ†èµ„æºè€Œå¦ä¸€ä¸ªåº”ç”¨æ— èµ„æºå¯ç”¨çš„æƒ…å†µã€‚åŒæ—¶ï¼Œè¿ç»´äººå‘˜ç»´æŠ¤å¦‚æ­¤å¤šçš„è¿è¡Œä¸åŒåº”ç”¨çš„ç‰©ç†æœºä¹Ÿæ˜¯ç›¸å½“éº»çƒ¦çš„ã€‚ è™šæ‹ŸåŒ–éƒ¨ç½² åœ¨è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£ï¼Œé€šè¿‡åœ¨æ“ä½œç³»ç»Ÿä¸­åŠ å…¥äº†Hypervisorï¼Œä»¥åŠCPUç­‰ç¡¬ä»¶çš„æ›´æ–°è¿­ä»£æ”¯æŒï¼Œå¯ä»¥åœ¨ä¸€å°ç‰©ç†æœºä¸Šé¢é€šè¿‡è™šæ‹ŸåŒ–çš„æ–¹å¼åˆ›å»ºå¤šå°è™šæ‹ŸæœºVirtual Machines (VMs)ã€‚æ¯å°è™šæ‹Ÿæœºéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿï¼Œæ‹¥æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿå’Œå„ç§èµ„æºä»¥åŠè™šæ‹ŸåŒ–çš„ç¡¬ä»¶ã€‚è¿ç»´äººå‘˜åªéœ€è¦ç»´æŠ¤å„ç§è™šæ‹Ÿæœºé•œåƒé•œåƒå³å¯ã€‚ å®¹å™¨åŒ–éƒ¨ç½² å‰é¢æˆ‘ä»¬è¯´è¿‡å®¹å™¨åŒ–ä¸¥æ ¼æ¥è¯´ä¹Ÿæ˜¯è™šæ‹ŸåŒ–çš„ä¸€ç§ï¼Œåªä¸è¿‡å®¹å™¨åŒ–æ›´è¿›ä¸€æ­¥ï¼Œé€šè¿‡å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰ï¼Œå¯ä»¥è®©ä¸åŒçš„å®¹å™¨å…±äº«åº•å±‚å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºå®¹å™¨åŒ–è¢«è§†ä¸ºæ˜¯ä¸€ç§è½»é‡çš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚åŒæ—¶ï¼Œå’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œå®¹å™¨ä¹Ÿæœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰èµ„æºã€‚è€Œä¸”ç”±äºå®¹å™¨å’Œåº•å±‚çš„æ“ä½œç³»ç»Ÿåˆ†ç¦»ï¼Œä¸€ä¸ªå®¹å™¨å¯ä»¥è¿è¡Œåœ¨ä¸åŒæ“ä½œç³»ç»Ÿå’Œäº‘ç¯å¢ƒä¸Šã€‚å®¹å™¨åŒ–æŠ€æœ¯çš„ä¸€äº›ç‰¹ç‚¹å¦‚ä¸‹ï¼š è§£è€¦äº†åº”ç”¨çš„åˆ›å»ºå’Œéƒ¨ç½²è¿‡ç¨‹ï¼šå¯¹æ¯”è™šæ‹Ÿæœºï¼Œå¯ä»¥æä¾›æ›´é«˜çš„æ˜“ç”¨æ€§å’Œæ•ˆç‡ æŒç»­å¼€å‘ã€é›†æˆã€éƒ¨ç½²ï¼ˆCI/CDï¼‰ï¼šå¾—ç›Šäºå®¹å™¨é•œåƒçš„ä¸å˜æ€§ï¼Œå®¹å™¨åŒ–æŠ€æœ¯å¯ä»¥é«˜æ•ˆå¿«é€Ÿåœ°é¢‘ç¹åˆ›å»ºé«˜è´¨é‡çš„å®¹å™¨é•œåƒç”¨äºéƒ¨ç½²å’Œå›æ»š å¼€å‘å’Œè¿ç»´åˆ†ç¦»ï¼šåˆ›å»ºåº”ç”¨å®¹å™¨é•œåƒå’Œéƒ¨ç½²åº”ç”¨çš„æ—¶ç©ºè¿ç»­æ€§è¢«æ‰“æ–­ï¼Œåˆ›å»ºä¹‹åä¸éœ€è¦ç«‹å³éƒ¨ç½²ï¼Œè€Œæ˜¯ä½¿ç”¨å®¹å™¨ä½œä¸ºä¸­ä»‹å°†å…¶ä¿å­˜èµ·æ¥ï¼Œä»è€Œä½¿å¾—åº”ç”¨å’Œåº•å±‚çš„åŸºç¡€æ¶æ„è§£è€¦ å‡ºè‰²çš„å¯è§‚å¯Ÿæ€§ï¼šä¸ä»…ä»…æ˜¯ç³»ç»Ÿå±‚é¢çš„æŒ‡æ ‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬åº”ç”¨çš„å¥åº·çŠ¶æ€å’Œå…¶ä»–å˜é‡ä¹Ÿèƒ½å¤Ÿå±•ç¤ºå‡ºæ¥ ç¯å¢ƒä¸€è‡´æ€§ï¼šå¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒåªè¦ä½¿ç”¨åŒæ ·çš„é•œåƒï¼Œå°±å¯ä»¥ä¿è¯ç¯å¢ƒçš„ä¸€è‡´æ€§ è·¨äº‘å’Œæ“ä½œç³»ç»Ÿï¼šå®¹å™¨å¯ä»¥è¿è¡Œåœ¨å„ç§äº‘ç¯å¢ƒå’Œä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Š ä»¥åº”ç”¨ä¸ºä¸­å¿ƒè¿›è¡Œç®¡ç†ï¼šå®¹å™¨çš„æŠ½è±¡å±‚çº§ä¸Šå‡åˆ°äº†åº”ç”¨çº§åˆ«ï¼Œå› æ­¤å¯ä»¥ä»åº”ç”¨çš„é€»è¾‘èµ„æºå±‚é¢è¿›è¡Œè°ƒåº¦åˆ†é…å’Œç®¡ç† æ¾æ•£è€¦åˆã€åˆ†å¸ƒå¼ã€å¼¹æ€§ã€è§£æ”¾çš„å¾®æœåŠ¡ï¼šåº”ç”¨ç¨‹åºè¢«åˆ†è§£æˆè¾ƒå°çš„ç‹¬ç«‹éƒ¨åˆ†ï¼Œ å¹¶ä¸”å¯ä»¥åŠ¨æ€éƒ¨ç½²å’Œç®¡ç†ï¼Œè€Œä¸æ˜¯åœ¨ä¸€å°å¤§å‹çš„ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºä¸Šæ•´ä½“è¿è¡Œ èµ„æºéš”ç¦»ï¼šå¯é¢„æµ‹çš„åº”ç”¨ç¨‹åºæ€§èƒ½ èµ„æºåˆ©ç”¨ï¼šé«˜æ•ˆç‡å’Œé«˜å¯†åº¦ 2ã€k8sçš„ä¼˜åŠ¿å®¹å™¨æ— ç–‘æ˜¯ä¸€ç§è¿è¡Œå’Œç®¡ç†åº”ç”¨çš„è‰¯æ–¹ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯æ¯ä¸€ä¸ªå®¹å™¨æœåŠ¡éƒ½æ­£å¸¸è¿è¡Œï¼Œå¦‚æœæŸä¸ªå®¹å™¨å®•æ‰äº†ï¼Œéœ€è¦é‡å¯ä¸€ä¸ªæ–°çš„å®¹å™¨æ¥è¿›è¡Œæ›¿è¡¥ã€‚å¦‚æœä¸Šè¿°çš„æ“ä½œèƒ½å¤Ÿè¢«æŸä¸ªç³»ç»Ÿè‡ªåŠ¨å®ç°å‘¢ï¼Ÿè¿™æ—¶å€™k8sçš„ä¼˜åŠ¿å°±å±•ç°å‡ºæ¥äº†ã€‚k8sæä¾›äº†ä¸€ä¸ªå¼¹æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¡†æ¶ï¼Œå®ƒç…§é¡¾åˆ°äº†åº”ç”¨æ‰©å®¹ã€æ•…éšœè½¬ç§»å’Œéƒ¨ç½²æ¨¡å¼ç­‰å¤šä¸ªæ–¹é¢ã€‚k8sçš„ä¸€äº›ä¸»è¦ç‰¹æ€§æœ‰ï¼š æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼šk8så¯ä»¥é€šè¿‡DNSæˆ–è€…æ˜¯IPåœ°å€æ¥æš´éœ²å®¹å™¨ä¸­çš„æœåŠ¡ã€‚å¦‚æœæŸä¸ªå®¹å™¨çš„æµé‡/è¯·æ±‚ç‰¹åˆ«é«˜ï¼Œk8sèƒ½å¤Ÿä¸»åŠ¨å®ç°è´Ÿè½½å‡è¡¡æ¥é™ä½è¯¥å®¹å™¨çš„æµé‡/è¯·æ±‚ä»è€Œä¿è¯å®¹å™¨çš„ç¨³å®šè¿è¡Œ å­˜å‚¨ç¼–æ’ï¼šk8så…è®¸æˆ‘ä»¬æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚å’Œé€‰æ‹©æ¥æŒ‚è½½å­˜å‚¨ç³»ç»Ÿï¼Œæ”¯æŒä½†ä¸é™äºæœ¬åœ°å­˜å‚¨ã€äº‘å­˜å‚¨ç­‰å„ç§æ–¹å¼ è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»šï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨k8sæ¥å£°æ˜å·²ç»éƒ¨ç½²çš„å®¹å™¨çš„æœŸæœ›çŠ¶æ€ï¼Œå®ƒå¯ä»¥ä»¥å—æ§çš„é€Ÿç‡å°†å®é™…çŠ¶æ€åˆ‡æ¢åˆ°æœŸæœ›çŠ¶æ€ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥å£°æ˜æŸä¸ªå®¹å™¨çš„è¿è¡Œæ•°é‡çš„æœŸæœ›å€¼ä¸º10ï¼Œk8sä¼šè‡ªåŠ¨å°†å®¹å™¨çš„æ•°é‡è°ƒæ•´åˆ°è¯¥æœŸæœ›çŠ¶æ€ï¼›æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ– Kubernetes æ¥ä¸ºéƒ¨ç½²åˆ›å»ºæ–°å®¹å™¨ï¼Œ åˆ é™¤ç°æœ‰å®¹å™¨å¹¶å°†å®ƒä»¬çš„æ‰€æœ‰èµ„æºç”¨äºæ–°å®¹å™¨ è‡ªåŠ¨è£…ç®±è®¡ç®—ï¼šæˆ‘ä»¬å¯ä»¥åœ¨k8sä¸­æŒ‡å®šæ¯ä¸ªå®¹å™¨æ‰€éœ€ CPU å’Œå†…å­˜ï¼ˆRAMï¼‰ã€‚ å½“å®¹å™¨æŒ‡å®šäº†èµ„æºè¯·æ±‚æ—¶ï¼Œk8sä¼šæ ¹æ®æ¯ä¸ªnodeèŠ‚ç‚¹çš„çŠ¶æ€å’Œæ¯ä¸ªå®¹å™¨æ‰€éœ€è¦çš„èµ„æºæ¥è¿›è¡Œæ™ºèƒ½è°ƒåº¦ï¼Œç¡®ä¿èµ„æºçš„æœ€å¤§åŒ–åˆ©ç”¨ è‡ªæˆ‘ä¿®å¤ k8sèƒ½å¤Ÿè‡ªåŠ¨é‡å¯è¿è¡Œå¤±è´¥çš„å®¹å™¨ã€æ›¿æ¢å®¹å™¨ã€æ€æ­»ä¸å“åº” ç”¨æˆ·å®šä¹‰çš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„å®¹å™¨ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡å¥½æœåŠ¡ä¹‹å‰ä¸å°†å…¶é€šå‘Šç»™å®¢æˆ·ç«¯ï¼Œä»è€Œä¿è¯å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸ä¼šè¢«åˆ†å‘åˆ°æœ‰é—®é¢˜çš„å®¹å™¨ä¸­ å¯†é’¥ä¸é…ç½®ç®¡ç† k8så…è®¸æˆ‘ä»¬å­˜å‚¨å’Œç®¡ç†å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸é‡å»ºå®¹å™¨é•œåƒçš„æƒ…å†µä¸‹éƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼Œä¹Ÿä¸éœ€è¦åœ¨é…ç½®ä¸­æš´éœ²å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ 3ã€k8sä¸æ˜¯ä»€ä¹ˆå®˜æ–¹ä¸€ç›´åœ¨å¼ºè°ƒè¿™ä¸ªè§‚ç‚¹ï¼šk8så¹¶ä¸æ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„åŒ…ç½—ä¸‡è±¡çš„PaaSå¹³å°ï¼Œå®ƒçš„è®¾è®¡æ€æƒ³æ˜¯æä¾›æœ€æ ¸å¿ƒçš„åŸºç¡€æ¡†æ¶å’Œå¿…è¦çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè€Œåœ¨å…¶ä»–çš„é€‰æ‹©ä¸Šå°½å¯èƒ½ä¿è¯å¤šæ ·çš„å…¼å®¹æ€§å’Œçµæ´»æ€§ã€‚å°½ç®¡å› ä¸ºæ“ä½œåœ¨å®¹å™¨çº§åˆ«å±‚é¢è€Œä¸æ˜¯ç¡¬ä»¶å±‚é¢ï¼Œä½¿å¾—k8sæä¾›äº†ä¸€äº›å¦‚éƒ¨ç½²ã€æ‰©å®¹ã€è´Ÿè½½å‡è¡¡ç­‰å’ŒPaaSå¹³å°ç±»ä¼¼çš„ç‰¹æ€§ï¼Œä½†æ˜¯å¯¹äºæ—¥å¿—ã€å­˜å‚¨ã€æŠ¥è­¦ã€ç›‘æ§ã€CI/CDç­‰å…¶ä»–è¯¸å¤šæ–¹é¢ï¼Œk8sé€‰æ‹©äº†å°†é€‰æ‹©æƒäº¤ç»™ä½¿ç”¨è€…ï¼Œè¿™ä¹Ÿæ˜¯æ„å»ºk8sä¸°å¯Œçš„ç”Ÿæ€ä¸­çš„é‡è¦ä¸€ç¯ã€‚ k8sä¸é™åˆ¶æ”¯æŒçš„åº”ç”¨ç±»å‹ï¼šåŒ…æ‹¬æ— çŠ¶æ€ï¼ˆnginxç­‰ï¼‰ã€æœ‰çŠ¶æ€ï¼ˆæ•°æ®åº“ç­‰ï¼‰å’Œæ•°æ®å¤„ç†ï¼ˆAIã€å¤§æ•°æ®ã€æ·±åº¦å­¦ä¹ ç­‰ï¼‰å„ç§å„æ ·çš„åº”ç”¨ç±»å‹ï¼ŒåŸºæœ¬ä¸Šèƒ½åœ¨å®¹å™¨ä¸­è¿è¡Œçš„åº”ç”¨éƒ½èƒ½åœ¨k8sä¸­è¿è¡Œï¼Œè€Œäº‹å®ä¸Šç»å¤§å¤šæ•°åº”ç”¨éƒ½èƒ½åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œå› æ­¤ç»å¤§å¤šæ•°åº”ç”¨éƒ½èƒ½åœ¨k8sä¸­è¿è¡Œ ä¸è´Ÿè´£éƒ¨ç½²æºä»£ç ã€ä¸æ„å»ºç¨‹åºã€æ²¡æœ‰CI/CDï¼šk8så¹¶ä¸æ¶‰åŠè¿™äº›éƒ¨åˆ†ï¼Œä½¿ç”¨è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„åå¥½æ¥é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆ ä¸æä¾›åº”ç”¨çº§åˆ«çš„æœåŠ¡ï¼šä¸æä¾›ä¸­é—´ä»¶ã€æ•°æ®åº“ã€æ•°æ®å­˜å‚¨é›†ç¾¤ç­‰ä½œä¸ºå†…ç½®æœåŠ¡ï¼Œä½†æ˜¯å®ƒä»¬éƒ½èƒ½å¤Ÿå¾ˆå¥½åœ°è¿è¡Œåœ¨k8sä¸­ï¼Œä¹Ÿèƒ½é€šè¿‡å„ç§æ–¹å¼å°†æœåŠ¡æš´éœ²å‡ºå»ä½¿ç”¨ ä¸æä¾›æ—¥å¿—ã€ç›‘æ§å’ŒæŠ¥è­¦ç­‰è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯æä¾›äº†ä¸€äº›æ¦‚å¿µå’ŒæŒ‡æ ‡æ•°æ®ç­‰ç”¨äºæ”¶é›†å¯¼å‡ºæœºåˆ¶ ä¸æä¾›æˆ–ä¸è¦æ±‚é…ç½®è¯­è¨€/ç³»ç»Ÿï¼ˆä¾‹å¦‚ jsonnetï¼‰ï¼Œå®ƒæä¾›äº†å¯ä»¥ç”±ä»»æ„å½¢å¼çš„å£°æ˜æ€§è§„èŒƒæ‰€æ„æˆçš„å£°æ˜æ€§ API ä¸æä¾›ä¹Ÿä¸é‡‡ç”¨ä»»ä½•å…¨é¢çš„æœºå™¨é…ç½®ã€ç»´æŠ¤ã€ç®¡ç†æˆ–è‡ªæˆ‘ä¿®å¤ç³»ç»Ÿ æ­¤å¤–ï¼ŒKubernetes ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç¼–æ’ç³»ç»Ÿï¼Œå®é™…ä¸Šå®ƒæ¶ˆé™¤äº†ç¼–æ’çš„éœ€è¦ã€‚ ç¼–æ’çš„æŠ€æœ¯å®šä¹‰æ˜¯æ‰§è¡Œå·²å®šä¹‰çš„å·¥ä½œæµç¨‹ï¼šé¦–å…ˆæ‰§è¡Œ Aï¼Œç„¶åæ‰§è¡Œ Bï¼Œå†æ‰§è¡Œ Cã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼ŒKubernetes åŒ…å«ä¸€ç»„ç‹¬ç«‹çš„ã€å¯ç»„åˆçš„æ§åˆ¶è¿‡ç¨‹ï¼Œ è¿™äº›è¿‡ç¨‹è¿ç»­åœ°å°†å½“å‰çŠ¶æ€é©±åŠ¨åˆ°æ‰€æä¾›çš„æ‰€éœ€çŠ¶æ€ã€‚ å¦‚ä½•ä» A åˆ° C çš„æ–¹å¼æ— å…³ç´§è¦ï¼Œä¹Ÿä¸éœ€è¦é›†ä¸­æ§åˆ¶ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ ä¸”åŠŸèƒ½æ›´å¼ºå¤§ã€ç³»ç»Ÿæ›´å¥å£®ã€æ›´ä¸ºå¼¹æ€§å’Œå¯æ‰©å±•ã€‚ 4ã€k8såŸºæœ¬æ¶æ„æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®˜æ–¹ç»™å‡ºçš„åŸºæœ¬æ¶æ„å›¾ã€‚ä¸‹å›¾åªåŒ…å«äº†éå¸¸åŸºç¡€çš„k8sæ¶æ„ç»„ä»¶ã€‚æˆ‘ä»¬å…ˆä»è¿™é‡Œå¼€å§‹ã€‚ é¦–å…ˆä¸Šå›¾ç°è‰²åŒºåŸŸè¡¨ç¤ºçš„æ˜¯ä¸€æ•´ä¸ªk8sé›†ç¾¤ï¼Œæ•´ä¸ªk8sçš„æ¶æ„å…¶å®å’Œæˆ‘ä»¬å¸¸è§çš„master-workeræ¨¡å‹éå¸¸ç›¸ä¼¼ï¼Œåªä¸è¿‡ç”±äºè¿™æ˜¯åˆ†å¸ƒå¼çš„é›†ç¾¤ï¼Œè¦æ›´å¤æ‚ä¸€äº›ã€‚ 4.1 Control Planeé¦–å…ˆæˆ‘ä»¬çœ‹åˆ°è“è‰²æ¡†å†…çš„Control Planeï¼Œè¿™ä¸ªæ˜¯æ•´ä¸ªé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œç›¸å½“äºæ˜¯masterè¿›ç¨‹çš„åŠ å¼ºç‰ˆã€‚k8sä¸­çš„Control Planeä¸€èˆ¬éƒ½ä¼šè¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šé¢ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒMasterèŠ‚ç‚¹å¹¶ä¸ä¼šè¿è¡Œåº”ç”¨å·¥ä½œè´Ÿè½½ï¼Œæ‰€æœ‰çš„åº”ç”¨å·¥ä½œè´Ÿè½½éƒ½äº¤ç”±NodeèŠ‚ç‚¹è´Ÿè´£ã€‚ æ§åˆ¶å¹³é¢ä¸­çš„MasterèŠ‚ç‚¹ä¸»è¦è¿è¡Œæ§åˆ¶å¹³é¢çš„å„ç§ç»„ä»¶ï¼Œå®ƒä»¬ä¸»è¦çš„ä½œç”¨å°±æ˜¯ç»´æŒæ•´ä¸ªk8sé›†ç¾¤çš„æ­£å¸¸å·¥ä½œã€å­˜å‚¨é›†ç¾¤çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒæ—¶ä¸ºé›†ç¾¤æä¾›æ•…éšœè½¬ç§»ã€è´Ÿè½½å‡è¡¡ã€ä»»åŠ¡è°ƒåº¦å’Œé«˜å¯ç”¨ç­‰åŠŸèƒ½ã€‚å¯¹äºMasterèŠ‚ç‚¹ä¸€èˆ¬æœ‰å¤šä¸ªç”¨äºä¿è¯é«˜å¯ç”¨ï¼Œè€Œæ§åˆ¶å¹³é¢ä¸­çš„å„ä¸ªç»„ä»¶å‡ä»¥å®¹å™¨çš„Podå½¢å¼è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸­ï¼Œå¤§éƒ¨åˆ†çš„ç»„ä»¶éœ€è¦åœ¨æ¯ä¸ªMasterèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œï¼Œå°‘æ•°å¦‚DNSæœåŠ¡ç­‰ç»„ä»¶åˆ™åªéœ€è¦ä¿è¯è¶³å¤Ÿæ•°é‡çš„é«˜å¯ç”¨å³å¯ã€‚ 4.1.1 kube-apiserverk8sé›†ç¾¤çš„æ§åˆ¶å¹³é¢çš„æ ¸å¿ƒæ˜¯APIæœåŠ¡å™¨ï¼Œè€ŒAPIæœåŠ¡å™¨ä¸»è¦å°±æ˜¯ç”±kube-apiserverç»„ä»¶å®ç°çš„ï¼Œå®ƒè¢«è®¾è®¡ä¸ºå¯æ°´å¹³æ‰©å±•ï¼Œå³é€šè¿‡éƒ¨ç½²ä¸åŒæ•°é‡çš„å®ä¾‹æ¥è¿›è¡Œç¼©æ”¾ä»è€Œé€‚åº”ä¸åŒçš„æµé‡ã€‚APIæœåŠ¡å™¨ä½œä¸ºæ•´ä¸ªk8sæ§åˆ¶å¹³é¢çš„å‰ç«¯ï¼Œè´Ÿè´£æä¾› HTTP APIï¼Œä»¥ä¾›ç”¨æˆ·ã€é›†ç¾¤ä¸­çš„ä¸åŒéƒ¨åˆ†ç»„ä»¶å’Œé›†ç¾¤å¤–éƒ¨ç»„ä»¶ç›¸äº’é€šä¿¡ã€‚ å¹¶ä¸”kubernetes apiåœ¨è®¾è®¡çš„æ—¶å€™æ˜¯éµå¾ªRESTæ€æƒ³çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡kubeadmæˆ–è€…kubectlè¿™ç±»çš„CLIå·¥å…·æ¥æ“æ§APIä»è€Œæ§åˆ¶æ•´ä¸ªk8sé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–çš„Web UIæ¥è¿›è¡Œæ“æ§ã€‚ 4.1.2 kube-schedulerä¸»èŠ‚ç‚¹ä¸Šçš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç›‘è§†é‚£äº›æ–°åˆ›å»ºçš„æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹çš„ Podï¼Œå¹¶é€‰æ‹©èŠ‚ç‚¹è®© Pod åœ¨ä¸Šé¢è¿è¡Œã€‚ è°ƒåº¦å†³ç­–è€ƒè™‘çš„å› ç´ åŒ…æ‹¬å•ä¸ª Pod å’Œ Pod é›†åˆçš„èµ„æºéœ€æ±‚ã€ç¡¬ä»¶/è½¯ä»¶/ç­–ç•¥çº¦æŸã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„èŒƒã€æ•°æ®ä½ç½®ã€å·¥ä½œè´Ÿè½½é—´çš„å¹²æ‰°å’Œæœ€åæ—¶é™ã€‚ 4.1.3 kube-controller-manageråœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿è¡Œ æ§åˆ¶å™¨ çš„ç»„ä»¶ã€‚ ä»é€»è¾‘ä¸Šè®²ï¼Œæ¯ä¸ªæ§åˆ¶å™¨éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œ ä½†æ˜¯ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘åˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œã€‚ è¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬: èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: è´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”ã€‚ å‰¯æœ¬æ§åˆ¶å™¨ï¼ˆReplication Controllerï¼‰: è´Ÿè´£ä¸ºç³»ç»Ÿä¸­çš„æ¯ä¸ªå‰¯æœ¬æ§åˆ¶å™¨å¯¹è±¡ç»´æŠ¤æ­£ç¡®æ•°é‡çš„ Podã€‚ ç«¯ç‚¹æ§åˆ¶å™¨ï¼ˆEndpoints Controllerï¼‰: å¡«å……ç«¯ç‚¹(Endpoints)å¯¹è±¡(å³åŠ å…¥ Service ä¸ Pod)ã€‚ æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨ï¼ˆService Account &amp; Token Controllersï¼‰: ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤å¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ. 4.1.4 etcdetcd æ˜¯å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼key-valueæ•°æ®åº“ï¼Œå¯ä»¥ä½œä¸ºä¿å­˜ Kubernetes æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“ï¼Œè´Ÿè´£ä¿å­˜Kubernetes Clusterçš„é…ç½®ä¿¡æ¯å’Œå„ç§èµ„æºçš„çŠ¶æ€ä¿¡æ¯ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œetcd ä¼šå¿«é€Ÿåœ°é€šçŸ¥Kubernetesç›¸å…³ç»„ä»¶ã€‚ Kubernetes é›†ç¾¤çš„ etcd æ•°æ®åº“é€šå¸¸éœ€è¦æœ‰ä¸ªå¤‡ä»½è®¡åˆ’ã€‚æ­¤å¤–è¿˜æœ‰ä¸€ç§k8sé›†ç¾¤éƒ¨ç½²çš„é«˜å¯ç”¨æ–¹æ¡ˆæ˜¯å°†etcdæ•°æ®åº“ä»å®¹å™¨ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œå•ç‹¬ä½œä¸ºä¸€ä¸ªé«˜å¯ç”¨æ•°æ®åº“éƒ¨ç½²ï¼Œä»è€Œä¸ºk8sæä¾›ç¨³å®šå¯é çš„é«˜å¯ç”¨æ•°æ®åº“å­˜å‚¨ã€‚ 4.1.5 cloud-controller-managercloud-controller-manager ä»…è¿è¡Œç‰¹å®šäºäº‘å¹³å°çš„æ§åˆ¶å›è·¯ã€‚ å¦‚æœä½ åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿è¡Œ Kubernetesï¼Œæˆ–è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸­è¿è¡Œå­¦ä¹ ç¯å¢ƒï¼Œ æ‰€éƒ¨ç½²çš„ç¯å¢ƒä¸­ä¸éœ€è¦äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ã€‚å› æ­¤å¯ä»¥å°†å…¶ç†è§£ä¸ºäº‘æœåŠ¡å‚å•†ä¸“ç”¨çš„kube-controller-managerï¼Œè¿™é‡Œä¸ä½œèµ˜è¿°ã€‚ 4.1.6 DNSDNSè™½ç„¶åœ¨k8sçš„å®˜æ–¹æ–‡æ¡£è¢«åˆ’åˆ†ä¸ºæ’ä»¶éƒ¨åˆ†ï¼Œä½†æ˜¯ä»k8sçš„åŸç†ä¸­æˆ‘ä»¬ä¸éš¾çœ‹å‡ºå…¶é‡è¦æ€§ï¼Œå› æ­¤å‡ ä¹æ‰€æœ‰ Kubernetes é›†ç¾¤éƒ½åº”è¯¥æœ‰é›†ç¾¤ DNSï¼Œ å› ä¸ºå¾ˆå¤šç¤ºä¾‹éƒ½éœ€è¦ DNS æœåŠ¡ã€‚ é›†ç¾¤ DNS æ˜¯ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œå’Œç¯å¢ƒä¸­çš„å…¶ä»– DNS æœåŠ¡å™¨ä¸€èµ·å·¥ä½œï¼Œå®ƒä¸º Kubernetes æœåŠ¡æä¾› DNS è®°å½•ã€‚Kubernetes å¯åŠ¨çš„å®¹å™¨è‡ªåŠ¨å°†æ­¤ DNS æœåŠ¡å™¨åŒ…å«åœ¨å…¶ DNS æœç´¢åˆ—è¡¨ä¸­ã€‚ k8sé»˜è®¤ä½¿ç”¨çš„æ˜¯coreDNSç»„ä»¶ã€‚ 4.2 Worker NodeWorker Nodeçš„æ¦‚å¿µæ˜¯å’Œå‰é¢çš„Control Planeç›¸å¯¹ç«‹çš„ï¼Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹åŸºæœ¬éƒ½å¯ä»¥åˆ†ä¸ºæ§åˆ¶èŠ‚ç‚¹ï¼ˆControl Plane/masterï¼‰å’Œå·¥ä½œèŠ‚ç‚¹(Worker Node/worker)ä¸¤å¤§ç±»ã€‚ä¸€èˆ¬æ¥è¯´é›†ç¾¤ä¸­çš„ä¸»è¦å·¥ä½œè´Ÿè½½éƒ½æ˜¯è¿è¡Œåœ¨Worker Nodeä¸Šé¢çš„ï¼ŒMasterèŠ‚ç‚¹é»˜è®¤æƒ…å†µä¸‹ä¸å‚ä¸å·¥ä½œè´Ÿè½½ï¼Œä½†æ˜¯å¯ä»¥æ‰‹åŠ¨è®¾ç½®ä¸ºå…è®¸å‚ä¸å·¥ä½œè´Ÿè½½ã€‚ 4.3.1 PodPodæ˜¯k8sé›†ç¾¤ä¸­æœ€å°çš„å·¥ä½œå•å…ƒï¼Œå’Œdockeré‡Œé¢çš„å•ä¸ªè¿è¡Œçš„å®¹å™¨ä¸åŒï¼ŒPodä¸­å¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨ï¼Œå®ƒä»¬å…±äº«ç›¸åŒçš„è®¡ç®—ã€ç½‘ç»œå’Œå­˜å‚¨ç­‰èµ„æºï¼ˆç›¸å½“äºåœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ªåº”ç”¨ï¼‰ 4.3.2 kubeletkubeletæ˜¯k8sé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼ˆåŒ…æ‹¬masterèŠ‚ç‚¹ï¼‰éƒ½ä¼šè¿è¡Œçš„ä»£ç†ã€‚ å®ƒèƒ½å¤Ÿä¿è¯å®¹å™¨éƒ½è¿è¡Œåœ¨ Pod ä¸­ã€‚kubelet åªä¼šç®¡ç†ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨ã€‚ kubelet æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚ å½“Schedulerç¡®å®šåœ¨æŸä¸ªNodeä¸Šè¿è¡ŒPodåï¼Œä¼šå°†Podçš„å…·ä½“é…ç½®ä¿¡æ¯ï¼ˆimageã€volumeç­‰ï¼‰å‘é€ç»™è¯¥èŠ‚ç‚¹çš„kubeletï¼Œkubeletæ ¹æ®è¿™äº›ä¿¡æ¯åˆ›å»ºå’Œè¿è¡Œå®¹å™¨ï¼Œå¹¶å‘MasteræŠ¥å‘Šè¿è¡ŒçŠ¶æ€ã€‚ 4.3.3 kube-proxykube-proxy æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œ kube-proxyé€šè¿‡ç»´æŠ¤ä¸»æœºä¸Šçš„ç½‘ç»œè§„åˆ™å¹¶æ‰§è¡Œè¿æ¥è½¬å‘ï¼Œå®ç°äº†KubernetesæœåŠ¡æŠ½è±¡ã€‚ serviceåœ¨é€»è¾‘ä¸Šä»£è¡¨äº†åç«¯çš„å¤šä¸ªPodï¼Œå¤–ç•Œé€šè¿‡serviceè®¿é—®Podã€‚serviceæ¥æ”¶åˆ°çš„è¯·æ±‚å°±æ˜¯é€šè¿‡kube-proxyè½¬å‘åˆ°Podä¸Šçš„ï¼Œkube-proxyæœåŠ¡è´Ÿè´£å°†è®¿é—®serviceçš„TCP/UDPæ•°æ®æµè½¬å‘åˆ°åç«¯çš„å®¹å™¨ã€‚å¦‚æœæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œkube-proxyä¼šå®ç°è´Ÿè½½å‡è¡¡ã€‚","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"},{"name":"docker","slug":"docker","permalink":"https://tinychen.com/tags/docker/"}]},{"title":"centos8ä½¿ç”¨grubbyä¿®æ”¹å†…æ ¸å¯åŠ¨å‚æ•°","slug":"20201118-centos8-use-grubby-modify-kernel","date":"2020-11-18T03:00:00.000Z","updated":"2020-11-18T03:00:00.000Z","comments":true,"path":"20201118-centos8-use-grubby-modify-kernel/","link":"","permalink":"https://tinychen.com/20201118-centos8-use-grubby-modify-kernel/","excerpt":"grubbyæ˜¯ä¸€ä¸ªç”¨äºæ›´æ–°å’Œæ˜¾ç¤ºæœ‰å…³å„ç§ä½“ç³»ç»“æ„ç‰¹å®šçš„å¼•å¯¼ç¨‹åºçš„é…ç½®æ–‡ä»¶ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ å®ƒä¸»è¦è®¾è®¡ç”¨äºå®‰è£…æ–°å†…æ ¸å¹¶éœ€è¦æŸ¥æ‰¾æœ‰å…³å½“å‰å¼•å¯¼ç¯å¢ƒçš„ä¿¡æ¯çš„è„šæœ¬ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¯¹å¯åŠ¨å†…æ ¸çš„å„é¡¹ä¿¡æ¯å‚æ•°è¿›è¡Œä¿®æ”¹ã€‚ æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨centos8ä¸­ä½¿ç”¨grubbyå·¥å…·æ¥å¯¹ç³»ç»Ÿçš„å†…æ ¸å¯åŠ¨å‚æ•°å’Œå¯åŠ¨é¡ºåºè¿›è¡Œè°ƒæ•´ã€‚","text":"grubbyæ˜¯ä¸€ä¸ªç”¨äºæ›´æ–°å’Œæ˜¾ç¤ºæœ‰å…³å„ç§ä½“ç³»ç»“æ„ç‰¹å®šçš„å¼•å¯¼ç¨‹åºçš„é…ç½®æ–‡ä»¶ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ å®ƒä¸»è¦è®¾è®¡ç”¨äºå®‰è£…æ–°å†…æ ¸å¹¶éœ€è¦æŸ¥æ‰¾æœ‰å…³å½“å‰å¼•å¯¼ç¯å¢ƒçš„ä¿¡æ¯çš„è„šæœ¬ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¯¹å¯åŠ¨å†…æ ¸çš„å„é¡¹ä¿¡æ¯å‚æ•°è¿›è¡Œä¿®æ”¹ã€‚ æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨centos8ä¸­ä½¿ç”¨grubbyå·¥å…·æ¥å¯¹ç³»ç»Ÿçš„å†…æ ¸å¯åŠ¨å‚æ•°å’Œå¯åŠ¨é¡ºåºè¿›è¡Œè°ƒæ•´ã€‚ ä½¿ç”¨yumæˆ–è€…dnfå¯ä»¥ç›´æ¥å®‰è£…grubbyå·¥å…·ã€‚ 123456[root@tiny-server ~]# yum install grubbyLast metadata expiration check: 1:29:38 ago on Wed 18 Nov 2020 09:44:26 AM +08.Package grubby-8.40-38.el8.x86_64 is already installed.Dependencies resolved.Nothing to do.Complete! æŸ¥çœ‹å½“å‰çš„é»˜è®¤å¯åŠ¨å†…æ ¸ï¼š 12[root@tiny-server ~]# grubby --default-kernel/boot/vmlinuz-4.18.0-193.28.1.el8_2.x86_64 æŸ¥çœ‹ç³»ç»Ÿå®‰è£…çš„å…¨éƒ¨å†…æ ¸ï¼š 123456789101112131415161718192021222324252627282930313233343536[root@tiny-server ~]# grubby --info=ALLindex=0kernel=&quot;/boot/vmlinuz-5.9.1-1.el8.elrepo.x86_64&quot;args=&quot;ro crashkernel=auto resume=/dev/mapper/cl-swap rd.lvm.lv=cl/root rd.lvm.lv=cl/swap net.ifnames=0 rhgb quiet intel_iommu=on $tuned_params&quot;root=&quot;/dev/mapper/cl-root&quot;initrd=&quot;/boot/initramfs-5.9.1-1.el8.elrepo.x86_64.img $tuned_initrd&quot;title=&quot;Red Hat Enterprise Linux (5.9.1-1.el8.elrepo.x86_64) 8.2 (Ootpa)&quot;id=&quot;12ab47b22fef4c02bcdc88b340d5f706-5.9.1-1.el8.elrepo.x86_64&quot;index=1kernel=&quot;/boot/vmlinuz-4.18.0-193.28.1.el8_2.x86_64&quot;args=&quot;ro crashkernel=auto resume=/dev/mapper/cl-swap rd.lvm.lv=cl/root rd.lvm.lv=cl/swap net.ifnames=0 rhgb quiet intel_iommu=on $tuned_params&quot;root=&quot;/dev/mapper/cl-root&quot;initrd=&quot;/boot/initramfs-4.18.0-193.28.1.el8_2.x86_64.img $tuned_initrd&quot;title=&quot;CentOS Linux (4.18.0-193.28.1.el8_2.x86_64) 8 (Core)&quot;id=&quot;12ab47b22fef4c02bcdc88b340d5f706-4.18.0-193.28.1.el8_2.x86_64&quot;index=2kernel=&quot;/boot/vmlinuz-4.18.0-193.19.1.el8_2.x86_64&quot;args=&quot;ro crashkernel=auto resume=/dev/mapper/cl-swap rd.lvm.lv=cl/root rd.lvm.lv=cl/swap net.ifnames=0 rhgb quiet intel_iommu=on $tuned_params&quot;root=&quot;/dev/mapper/cl-root&quot;initrd=&quot;/boot/initramfs-4.18.0-193.19.1.el8_2.x86_64.img $tuned_initrd&quot;title=&quot;CentOS Linux (4.18.0-193.19.1.el8_2.x86_64) 8 (Core)&quot;id=&quot;12ab47b22fef4c02bcdc88b340d5f706-4.18.0-193.19.1.el8_2.x86_64&quot;index=3kernel=&quot;/boot/vmlinuz-4.18.0-193.el8.x86_64&quot;args=&quot;ro crashkernel=auto resume=/dev/mapper/cl-swap rd.lvm.lv=cl/root rd.lvm.lv=cl/swap net.ifnames=0 rhgb quiet intel_iommu=on $tuned_params&quot;root=&quot;/dev/mapper/cl-root&quot;initrd=&quot;/boot/initramfs-4.18.0-193.el8.x86_64.img $tuned_initrd&quot;title=&quot;CentOS Linux (4.18.0-193.el8.x86_64) 8 (Core)&quot;id=&quot;12ab47b22fef4c02bcdc88b340d5f706-4.18.0-193.el8.x86_64&quot;index=4kernel=&quot;/boot/vmlinuz-0-rescue-12ab47b22fef4c02bcdc88b340d5f706&quot;args=&quot;ro crashkernel=auto resume=/dev/mapper/cl-swap rd.lvm.lv=cl/root rd.lvm.lv=cl/swap net.ifnames=0 rhgb quiet intel_iommu=on&quot;root=&quot;/dev/mapper/cl-root&quot;initrd=&quot;/boot/initramfs-0-rescue-12ab47b22fef4c02bcdc88b340d5f706.img&quot;title=&quot;CentOS Linux (0-rescue-12ab47b22fef4c02bcdc88b340d5f706) 8 (Core)&quot;id=&quot;12ab47b22fef4c02bcdc88b340d5f706-0-rescue&quot; è®¾ç½®æ–°çš„é»˜è®¤å¯åŠ¨å†…æ ¸ï¼š 1234567891011# ä½¿ç”¨è·¯å¾„æ¥æŒ‡å®šå†…æ ¸ï¼Œå¯ä»¥ä½¿ç”¨--set-default=kernel-path[root@tiny-server ~]# grubby --set-default=/boot/vmlinuz-5.9.1-1.el8.elrepo.x86_64The default is /boot/loader/entries/12ab47b22fef4c02bcdc88b340d5f706-5.9.1-1.el8.elrepo.x86_64.conf with index 0 and kernel /boot/vmlinuz-5.9.1-1.el8.elrepo.x86_64[root@tiny-server ~]# grubby --default-kernel/boot/vmlinuz-5.9.1-1.el8.elrepo.x86_64# ä½¿ç”¨indexæ¥æŒ‡å®šå†…æ ¸ï¼Œåˆ™ä½¿ç”¨--set-default-index=entry-index[root@tiny-server ~]# grubby --set-default-index=1The default is /boot/loader/entries/12ab47b22fef4c02bcdc88b340d5f706-4.18.0-193.28.1.el8_2.x86_64.conf with index 1 and kernel /boot/vmlinuz-4.18.0-193.28.1.el8_2.x86_64[root@tiny-server ~]# grubby --default-kernel/boot/vmlinuz-4.18.0-193.28.1.el8_2.x86_64 æ·»åŠ /åˆ é™¤å†…æ ¸å¯åŠ¨å‚æ•°ï¼š 123456789# å¯¹æ‰€æœ‰çš„å†…æ ¸éƒ½åˆ é™¤æŸä¸ªå‚æ•° [root@tiny-server ~]# grubby --update-kernel=ALL --remove-args=intel_iommu=on# å¯¹æ‰€æœ‰çš„å†…æ ¸éƒ½æ·»åŠ æŸä¸ªå‚æ•° [root@tiny-server ~]# grubby --update-kernel=ALL --args=intel_iommu=on# å¯¹æŸä¸ªçš„å†…æ ¸æ·»åŠ å¯åŠ¨å‚æ•° [root@tiny-server ~]# grubby --update-kernel=/boot/vmlinuz-5.9.1-1.el8.elrepo.x86_64 --args=intel_iommu=on æŸ¥çœ‹ç‰¹å®šå†…æ ¸çš„å…·ä½“ä¿¡æ¯ï¼š 12345678[root@tiny-server ~]# grubby --info=/boot/vmlinuz-5.9.1-1.el8.elrepo.x86_64index=0kernel=&quot;/boot/vmlinuz-5.9.1-1.el8.elrepo.x86_64&quot;args=&quot;ro crashkernel=auto resume=/dev/mapper/cl-swap rd.lvm.lv=cl/root rd.lvm.lv=cl/swap net.ifnames=0 rhgb quiet intel_iommu=on $tuned_params&quot;root=&quot;/dev/mapper/cl-root&quot;initrd=&quot;/boot/initramfs-5.9.1-1.el8.elrepo.x86_64.img $tuned_initrd&quot;title=&quot;Red Hat Enterprise Linux (5.9.1-1.el8.elrepo.x86_64) 8.2 (Ootpa)&quot;id=&quot;12ab47b22fef4c02bcdc88b340d5f706-5.9.1-1.el8.elrepo.x86_64&quot;","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"grubby","slug":"grubby","permalink":"https://tinychen.com/tags/grubby/"}]},{"title":"linuxä¸­è®¾ç½®sshç™»å½•æ—¶æ˜¾ç¤ºçš„banner","slug":"20201116-linux-modify-ssh-login-banner","date":"2020-11-16T03:00:00.000Z","updated":"2020-11-16T03:00:00.000Z","comments":true,"path":"20201116-linux-modify-ssh-login-banner/","link":"","permalink":"https://tinychen.com/20201116-linux-modify-ssh-login-banner/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨linuxç³»ç»Ÿä¸‹å¯¹sshçš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ä»è€Œè‡ªå®šä¹‰sshç™»å½•æ˜¾ç¤ºçš„banneræ¨ªå¹…æç¤ºè¯­ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨linuxç³»ç»Ÿä¸‹å¯¹sshçš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ä»è€Œè‡ªå®šä¹‰sshç™»å½•æ˜¾ç¤ºçš„banneræ¨ªå¹…æç¤ºè¯­ã€‚ åœ¨sshçš„é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°bannerå­—æ®µï¼Œå¦‚æ²¡æœ‰åˆ™æ‰‹åŠ¨æ·»åŠ ï¼Œç„¶åæŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯åˆ°æ—¶å€™ç™»å½•æ˜¾ç¤ºçš„å†…å®¹ 123[root@tiny-server ~]# grep Banner /etc/ssh/sshd_config#Banner noneBanner /etc/ssh/my_banner å¯¹äºcentos8è€Œè¨€ï¼Œé™¤äº†è‡ªå®šä¹‰çš„bannerï¼Œ/etc/motdå’Œ/etc/motd.d/*ä¹Ÿä¼šåœ¨sshç™»å½•çš„æ—¶å€™æ˜¾ç¤ºã€‚ å¯¹äºbannerçš„è‡ªå®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨å„ç§å­—ç¬¦å·¥å…·ï¼Œä¾‹å¦‚figletã€cowsayç­‰ç­‰ï¼Œéƒ½å¯ä»¥ä½¿ç”¨yumç›´æ¥å®‰è£… 12[root@tiny-server ~]# figlet tiny-server &gt;&gt; /etc/ssh/my_banner[root@tiny-server ~]# cat /etc/redhat-release | cowsay -f turtle &gt;&gt; /etc/ssh/my_banner æœ€åæ•ˆæœ 12345678910111213141516171819202122232425262728293031[/root]# ssh tiny-server _ _| |_(_)_ __ _ _ ___ ___ _ ____ _____ _ __| __| | &#x27;_ \\| | | |_____/ __|/ _ \\ &#x27;__\\ \\ / / _ \\ &#x27;__|| |_| | | | | |_| |_____\\__ \\ __/ | \\ V / __/ | \\__|_|_| |_|\\__, | |___/\\___|_| \\_/ \\___|_| |___/ ---------------------------------------&lt; CentOS Linux release 8.2.2004 (Core) &gt; --------------------------------------- \\ ___-------___ \\ _-~~ ~~-_ \\ _-~ /~-_ /^\\__/^\\ /~ \\ / \\ /| O|| O| / \\_______________/ \\ | |___||__| / / \\ \\ | \\ / / \\ \\ | (_______) /______/ \\_________ \\ | / / \\ / \\ \\ \\^\\\\ \\ / \\ / \\ || \\______________/ _-_ //\\__// \\ ||------_-~~-_ ------------- \\ --/~ ~\\ || __/ ~-----||====/~ |==================| |/~~~~~ (_(__/ ./ / \\_\\ \\. (_(___/ \\_____)_)Last login: Wed Nov 18 14:50:10 2020 from 0.0.0.0[root@tiny-server ~]#","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"ssh","slug":"ssh","permalink":"https://tinychen.com/tags/ssh/"},{"name":"bash","slug":"bash","permalink":"https://tinychen.com/tags/bash/"},{"name":"shell","slug":"shell","permalink":"https://tinychen.com/tags/shell/"}]},{"title":"DPDKåœ¨DPVSä¸­çš„åº”ç”¨åŠåŸç†åˆ†æ","slug":"20201112-dpdk-in-dpvs-principle-analysis","date":"2020-11-12T07:00:00.000Z","updated":"2020-11-12T07:00:00.000Z","comments":true,"path":"20201112-dpdk-in-dpvs-principle-analysis/","link":"","permalink":"https://tinychen.com/20201112-dpdk-in-dpvs-principle-analysis/","excerpt":"ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»äº†DPVSçš„ç‰¹ç‚¹å’Œéƒ¨ç½²æ–¹å¼ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯ç”¨äºä»‹ç»DPVSæ˜¯å¦‚ä½•å®ç°å‰é¢æ‰€è¯´çš„ç‰¹ç‚¹ï¼Œæˆ–è€…è¯´æ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„ã€‚ ä¸‹å›¾æ˜¯çˆ±å¥‡è‰ºçš„DPVSå¼€å‘å›¢é˜Ÿç»™å‡ºçš„DPVSåœ¨æé«˜æ€§èƒ½æ–¹é¢çš„æ“ä½œï¼Œæˆ‘ä»¬è¿™é‡Œæ¢ä¸€ä¸ªè§’åº¦ï¼Œè‡ªåº•å‘ä¸Šï¼Œä»åº•å±‚çš„CPUã€å†…å­˜ã€ç½‘å¡æ¥çœ‹è¿™äº›æ“ä½œæ˜¯å¦‚ä½•å®ç°çš„ã€‚ ï¼ˆæœ¬æ–‡æ¶‰åŠåˆ°è¾ƒå¤šçš„è®¡ç®—æœºç»„ç»‡æ¶æ„å’Œæ“ä½œç³»ç»ŸåŸç†çš„çŸ¥è¯†ç‚¹ï¼Œç”±äºç¯‡å¹…åŸå› æ²¡åŠæ³•ä¸€ä¸€è¯¦è§£ï¼Œå› æ­¤æœ‰ä¸€å®šçš„ç†è§£é—¨æ§›ï¼Œå¦‚æœæœ‰çœ‹ä¸æ‡‚çš„çŸ¥è¯†ç‚¹å¯ä»¥åœ¨æ–‡ç« ä¸‹é¢ç•™è¨€ï¼Œæœ‰æœºä¼šæˆ‘ä¼šå†™ä¸€äº›æ–‡ç« è¯¦ç»†ä»‹ç»ä¸€ä¸‹ç›¸å…³å†…å®¹ï¼‰","text":"ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»äº†DPVSçš„ç‰¹ç‚¹å’Œéƒ¨ç½²æ–¹å¼ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯ç”¨äºä»‹ç»DPVSæ˜¯å¦‚ä½•å®ç°å‰é¢æ‰€è¯´çš„ç‰¹ç‚¹ï¼Œæˆ–è€…è¯´æ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„ã€‚ ä¸‹å›¾æ˜¯çˆ±å¥‡è‰ºçš„DPVSå¼€å‘å›¢é˜Ÿç»™å‡ºçš„DPVSåœ¨æé«˜æ€§èƒ½æ–¹é¢çš„æ“ä½œï¼Œæˆ‘ä»¬è¿™é‡Œæ¢ä¸€ä¸ªè§’åº¦ï¼Œè‡ªåº•å‘ä¸Šï¼Œä»åº•å±‚çš„CPUã€å†…å­˜ã€ç½‘å¡æ¥çœ‹è¿™äº›æ“ä½œæ˜¯å¦‚ä½•å®ç°çš„ã€‚ ï¼ˆæœ¬æ–‡æ¶‰åŠåˆ°è¾ƒå¤šçš„è®¡ç®—æœºç»„ç»‡æ¶æ„å’Œæ“ä½œç³»ç»ŸåŸç†çš„çŸ¥è¯†ç‚¹ï¼Œç”±äºç¯‡å¹…åŸå› æ²¡åŠæ³•ä¸€ä¸€è¯¦è§£ï¼Œå› æ­¤æœ‰ä¸€å®šçš„ç†è§£é—¨æ§›ï¼Œå¦‚æœæœ‰çœ‹ä¸æ‡‚çš„çŸ¥è¯†ç‚¹å¯ä»¥åœ¨æ–‡ç« ä¸‹é¢ç•™è¨€ï¼Œæœ‰æœºä¼šæˆ‘ä¼šå†™ä¸€äº›æ–‡ç« è¯¦ç»†ä»‹ç»ä¸€ä¸‹ç›¸å…³å†…å®¹ï¼‰ è¿™é‡Œéœ€è¦é¢å¤–è§£é‡Šä¸€ä¸‹Share Nothingå’ŒBatchingã€‚ Shared nothingæ¶æ„ï¼ˆShared Nothing Architectureï¼ŒSNAï¼‰è¿™é‡Œçš„Share NothingæŒ‡çš„æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼è€Œä¸æ˜¯æŸç§å…·ä½“çš„æŠ€æœ¯ï¼Œè¿™ç§æ¶æ„è®¾è®¡çš„æ€æƒ³æ˜¯é€šè¿‡ç‰ºç‰²æ•´ä½“çš„æ¨ªå‘æ‰©å±•èƒ½åŠ›æ¥æå‡çºµå‘æ€§èƒ½ã€‚ä½œä¸ºä¸€ç§åˆ†å¸ƒå¼è®¡ç®—æ¶æ„ï¼Œå®ƒçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆ nodeï¼‰éƒ½æ˜¯ç‹¬ç«‹ã€è‡ªç»™çš„ï¼Œè€Œä¸”æ•´ä¸ªç³»ç»Ÿä¸­æ²¡æœ‰å•ç‚¹ç«äº‰ï¼Œæ²¡æœ‰èµ„æºçš„ç«äº‰å°±ä¸éœ€è¦åŠ é”ï¼Œä¹Ÿä¸éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ Batchingåœ¨è¿™é‡ŒæŒ‡çš„æ‰¹å¤„ç†ï¼Œä¸»è¦è¿˜æ˜¯ä¾é DPDKçš„SIMDï¼ˆSingle Instruction Multiple Dataï¼Œå•æŒ‡ä»¤æµå¤šæ•°æ®æµï¼‰ç¼–ç æ€æƒ³ä»¥åŠå¤„ç†å™¨æœ¬èº«çš„SIMDæŒ‡ä»¤é›†æ¥å®ç°ã€‚SIMDæ˜¯ä¸€ç§é‡‡ç”¨ä¸€ä¸ªæ§åˆ¶å™¨æ¥æ§åˆ¶å¤šä¸ªå¤„ç†å™¨ï¼ŒåŒæ—¶å¯¹ä¸€ç»„æ•°æ®ï¼ˆåˆç§°â€œæ•°æ®å‘é‡â€ï¼‰ä¸­çš„æ¯ä¸€ä¸ªåˆ†åˆ«æ‰§è¡Œç›¸åŒçš„æ“ä½œä»è€Œå®ç°ç©ºé—´ä¸Šçš„å¹¶è¡Œæ€§çš„æŠ€æœ¯ã€‚åœ¨å¾®å¤„ç†å™¨ä¸­ï¼Œå•æŒ‡ä»¤æµå¤šæ•°æ®æµæŠ€æœ¯åˆ™æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨æ§åˆ¶å¤šä¸ªå¹³è¡Œçš„å¤„ç†å¾®å…ƒï¼Œä¾‹å¦‚Intelçš„MMXæˆ–SSEï¼Œä»¥åŠAMDçš„3D Now!æŒ‡ä»¤é›†ã€‚ 1ã€From NIC driversPMD ï¼ˆPoll Mode Driverï¼‰ ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿèµ„æºå ç”¨ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ¨dpvsä¸­å¯¹ç½‘å¡æ”¶å‘é˜Ÿåˆ—è¿›è¡Œäº†ä¸€ä¸€ç»‘å®šçš„CPUæ ¸å¿ƒå ç”¨ç‡ä¼šä¸€ç›´ç»´æŒåœ¨100%ï¼Œå¹¶ä¸”æ˜¯ç”¨æˆ·æ€çš„100%å ç”¨ï¼Œå¹¶ä¸”æ— è®ºæ˜¯å¦æœ‰æµé‡åœ¨æ‰€å±çš„dpdkç½‘å¡ä¸Šç»è¿‡ï¼Œéƒ½ä¼šä¸€ç›´ç»´æŒåœ¨100%çš„çŠ¶æ€ã€‚è¿™æ˜¯dpdkçš„ä¸€ä¸ªç‰¹æ€§ï¼Œç§°ä¹‹ä¸º**PMDï¼ˆPoll Mode Driverï¼‰**ã€‚å‰é¢åœ¨å®‰è£…dpdkçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨dpdkç»™å¯¹åº”çš„ç½‘å¡æ¥å®‰è£…ç‰¹å®šçš„ç½‘å¡é©±åŠ¨ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œç”¨äºæµ‹è¯•ä½¿ç”¨çš„82599ç½‘å¡ä½¿ç”¨çš„æ˜¯UIOé©±åŠ¨ï¼Œè¿™äº›éƒ½æ˜¯å±äºPMDé©±åŠ¨ã€‚ç›®å‰DPDKæ”¯æŒ1Gã€10Gã€40Gä»¥åŠåŠè™šæ‹ŸåŒ–çš„virtioç½‘å¡çš„PMDé©±åŠ¨ã€‚ å¯¹äºè¿è¡Œç€dpdkçš„æœºå™¨ï¼Œæˆ‘ä»¬æŸ¥çœ‹å†…æ ¸æ¨¡å—å’Œå¯¹åº”çš„dpdkç½‘å¡é©±åŠ¨ï¼Œå¯ä»¥å‘ç°uioæ¨¡å—å’ŒPMDé©±åŠ¨çš„è¸ªè¿¹ï¼Œå…¶ä¸­04:00.1æ˜¯dpdkçš„ç½‘å¡ï¼Œè€Œ04:00.0åˆ™æ˜¯æ™®é€šçŠ¶æ€ä¸‹çš„ç½‘å¡ 123456789101112# lsmod | grep uioigb_uio 13414 1uio 19338 3 igb_uio04:00.0 Ethernet controller [0200]: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection [8086:10fb] (rev 01) Subsystem: Intel Corporation Ethernet Server Adapter X520-2 [8086:000c] Kernel driver in use: ixgbe Kernel modules: ixgbe04:00.1 Ethernet controller [0200]: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection [8086:10fb] (rev 01) Subsystem: Intel Corporation Ethernet Server Adapter X520-2 [8086:000c] Kernel driver in use: igb_uio Kernel modules: ixgbe PMDé©±åŠ¨åŒ…å«äº†å„ç§APIï¼Œå¹¶ä¸”æä¾›äº†åœ¨ç”¨æˆ·æ€è¿è¡Œçš„BSDé©±åŠ¨ï¼Œç”¨äºé…ç½®ç½‘å¡å’Œç½‘å¡çš„æ”¶å‘é˜Ÿåˆ—ã€‚æ­¤å¤–ï¼ŒPWDé©±åŠ¨æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯æ— éœ€ä»»ä½•ä¸­æ–­æ“ä½œå°±å¯ä»¥ç›´æ¥è®¿é—®ç½‘å¡é˜Ÿåˆ—ä¸­çš„RX/TXæè¿°ç¬¦ï¼ˆé™¤äº†ç½‘å¡çš„é“¾æ¥çŠ¶æ€å˜åŒ–ï¼‰ï¼Œå€ŸåŠ©è¿™ä¸ªä¼˜åŠ¿ï¼Œå°±å¯ä»¥ç»•è¿‡å†…æ ¸å’ŒåŒæ ·è¿è¡Œåœ¨ç”¨æˆ·æ€çš„åº”ç”¨ç¨‹åºå¿«é€Ÿåœ°è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥å¯¹æ¯”ä¼ ç»Ÿçš„åº”ç”¨ç¨‹åºå’Œç½‘å¡é€šä¿¡çš„æ–¹å¼ä»¥åŠä½¿ç”¨PMDé©±åŠ¨åå’Œç½‘å¡é€šä¿¡çš„æ–¹å¼ã€‚ ä¼ ç»Ÿæ¨¡å¼ä¸‹ï¼Œåº”ç”¨ç¨‹åºå¦‚nginxç­‰è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼ˆUser Spaceï¼‰ï¼Œç½‘å¡ï¼ˆNICï¼‰å±äºç¡¬ä»¶è®¾å¤‡ï¼Œæ˜¯å½’å±äºå†…æ ¸ç®¡ç†ï¼Œç½‘å¡é©±åŠ¨è¿è¡Œåœ¨å†…æ ¸æ€ä¸­ï¼ˆKernel Spaceï¼‰ã€‚é‚£ä¹ˆå½“åº”ç”¨ç¨‹åºéœ€è¦å’Œç½‘å¡äº¤æ¢æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œä¸€è½®ç”¨æˆ·æ€åˆ°å†…æ ¸æ€ä¹‹é—´çš„åˆ‡æ¢ï¼Œå†ç»è¿‡å†…æ ¸ä¸­çš„TCP/IPåè®®æ ˆï¼Œæ‰èƒ½å’Œç½‘å¡é©±åŠ¨é€šä¿¡ï¼Œè€Œç½‘å¡é©±åŠ¨å’Œç½‘å¡ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡ç¡¬ä»¶ä¸­æ–­çš„æ–¹å¼æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯ä¼ ç»Ÿæ¨¡å¼ä¸‹å­˜åœ¨ç€ç”¨æˆ·æ€/å†…æ ¸æ€åˆ‡æ¢å’Œä¸¤ä¸ªéå¸¸è€—æ—¶è€—èµ„æºçš„æ“ä½œã€‚ DPDKçš„å¤„ç†æ–¹å¼éå¸¸ç®€å•ç²—æš´ï¼Œé¦–å…ˆå°†ç½‘å¡é©±åŠ¨ä»å†…æ ¸æ€ç§»åŠ¨åˆ°ç”¨æˆ·æ€è¿è¡Œï¼Œè¿™æ ·åº”ç”¨ç¨‹åºå’ŒPMDç½‘å¡é©±åŠ¨ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢å°±ä¸éœ€è¦è¿›è¡Œå†…æ ¸æ€/ç”¨æˆ·æ€çš„åˆ‡æ¢ï¼Œé¿å…äº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸”ç”±äºéƒ½æ˜¯åœ¨ç”¨æˆ·æ€ï¼Œä¸éœ€è¦å°†æ•°æ®æ‹·è´åˆ°å†…æ ¸æ€ï¼Œä¹Ÿå®ç°äº†é›¶æ‹·è´zero copyï¼ŒåŒæ—¶è¿˜ç»•è¿‡äº†å†…æ ¸ä¸­çš„TCP/IPç½‘ç»œæ ˆï¼Œæå¤§åœ°ç¼©çŸ­APPåˆ°Driverä¹‹é—´çš„ä¼ è¾“æ—¶é—´ã€‚ å½“ç„¶è¿™ç§ç»•è¿‡ç³»ç»Ÿå†…æ ¸çš„åšæ³•æœ€ç›´æ¥çš„ä»£ä»·å°±æ˜¯é©±åŠ¨ç¨‹åºå¿…é¡»ä¸€ç›´é€šè¿‡è½®è¯¢pollçš„æ“ä½œæ¥ä¿è¯èƒ½å¤ŸåŠæ—¶æ¥æ”¶åˆ°ç½‘å¡çš„ä¿¡æ¯å’Œæ•°æ®ï¼Œå¯¼è‡´å¯¹åº”çš„cpuæ ¸å¿ƒä¼šä¸€ç›´å¤„äº100%çš„å ç”¨çŠ¶æ€ã€‚åŒæ—¶è¿™ä¸ªæ—¶å€™ç½‘å¡å·²ç»ä¸å†å½’äºç³»ç»Ÿå†…æ ¸ç®¡ç†ï¼Œå¸¸è§„çš„ipå’Œifconfigç­‰å‘½ä»¤å·²ç»æ²¡åŠæ³•æŸ¥çœ‹ç½‘å¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨dpipå·¥å…·æ¥å¯¹ç½‘å¡è¿›è¡Œç®¡ç†ã€‚ è¿™é‡Œå°±æ˜¯dpvså®£ç§°çš„å†…æ ¸æ—è·¯ï¼ˆkernel bypassï¼‰ã€è½®è¯¢ï¼ˆpollingï¼‰ã€é›¶æ‹·è´ï¼ˆzero copyï¼‰ç­‰ç‰¹æ€§çš„å®ç°åŸç†ã€‚ æ³¨æ„è¿™ç§PMDé©±åŠ¨å¹¶ä¸é€‚ç”¨äºä¸€èˆ¬çš„åº”ç”¨åœºæ™¯ï¼Œå› ä¸ºéœ€è¦æœ‰ä¸“é—¨çš„CPUç»™PMDä¸€ç›´åšè½®è¯¢æ“ä½œï¼Œå¯¹åº”çš„CPUå°±ä¼šä¸€ç›´å ç”¨100%ï¼Œå¯èƒ½ä¸¥é‡å½±å“äº†å…¶ä»–ä»»åŠ¡çš„è¿è¡Œã€‚ å½“ç½‘ç»œå¤„äºç©ºé—²çŠ¶æ€çš„æ—¶å€™ï¼ŒCPUå ç”¨100%çš„é—®é¢˜ä¼šå¸¦æ¥é¢å¤–çš„ä¸å¿…è¦çš„åŠŸè€—ï¼Œå› æ­¤dpdkè¿˜æ¨å‡ºäº†ä¸€ä¸ªinterrupt dpdkæ¨¡å¼ï¼Œå³å½“ç½‘å¡ä¸­æ²¡æœ‰æ•°æ®åŒ…å¤„ç†çš„æ—¶å€™è¿›å…¥ç±»ä¼¼ç¡çœ æ¨¡å¼çš„çŠ¶æ€ï¼Œç„¶åæ”¹ä¸ºä¼ ç»Ÿçš„ä¸­æ–­æ–¹å¼é€šçŸ¥ï¼Œè¿™ä¸ªæ—¶å€™è¢«100%å ç”¨çš„æ ¸å¿ƒåˆ©ç”¨ç‡å°±ä¼šé™ä½ï¼Œå¯ä»¥å’Œå…¶ä»–çš„è¿›ç¨‹å…±äº«ï¼Œä½†æ˜¯DPDKä»ç„¶æ‹¥æœ‰é«˜ä¼˜å…ˆçº§ï¼Œè€Œå½“æœ‰æ•°æ®åŒ…è¿›æ¥çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥ä¼˜å…ˆå¤„ç†ã€‚ 2ã€From CPUNUMA Awareness 1.ä»ç³»ç»Ÿæ¶æ„æ¥çœ‹ï¼Œç›®å‰çš„å•†ç”¨æœåŠ¡å™¨å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸‰ç±» å¯¹ç§°å¤šå¤„ç†å™¨ç»“æ„(SMPï¼šSymmetric Multi-Processor) éä¸€è‡´å­˜å‚¨è®¿é—®ç»“æ„(NUMAï¼šNon-Uniform Memory Access) æµ·é‡å¹¶è¡Œå¤„ç†ç»“æ„(MPPï¼šMassive Parallel Processing) 2.å…±äº«å­˜å‚¨å‹å¤šå¤„ç†æœºæœ‰ä¸¤ç§æ¨¡å‹ å‡åŒ€å­˜å‚¨å™¨å­˜å–ï¼ˆUniform Memory Accessï¼Œç®€ç§°UMAï¼‰æ¨¡å‹ éå‡åŒ€å­˜å‚¨å™¨å­˜å–ï¼ˆNonuniform Memory Accessï¼Œç®€ç§°NUMAï¼‰æ¨¡å‹ å‰é¢æˆ‘ä»¬åœ¨å®‰è£…dpvsçš„æ—¶å€™ï¼Œç‰¹åˆ«éœ€è¦æ³¨æ„çš„å°±æ˜¯éœ€è¦åœ¨BIOSä¸­å¼€å¯NUMAï¼Œè¿™é‡Œä¸»è¦æ¶‰åŠåˆ°çš„å°±æ˜¯å¯¹äºå¤šè·¯æœåŠ¡å™¨ï¼ˆå¾€å¾€å¤šé¢—CPUåœ¨ä¸€å—ä¸»æ¿ä¸Šï¼‰çš„å†…å­˜è°ƒåº¦ä¼˜åŒ–é—®é¢˜ã€‚ä»¥æˆ‘ä»¬çš„æµ‹è¯•æœåŠ¡å™¨ä¸ºä¾‹æ¥è¿›è¡Œä¸¾ä¾‹è¯´æ˜ï¼šè¿™å°æ™®é€šçš„R630æœåŠ¡å™¨ä¸€å…±æœ‰ä¸¤é¢—CPUï¼Œ128Gå†…å­˜ï¼Œå…¶ä¸­å†…å­˜æ˜¯å‡åŒ€åˆ†å¸ƒåœ¨ä¸¤é¢—CPUä¸Šçš„ï¼Œå³æ¯é¢—CPUçš„å†…å­˜æ€»çº¿éƒ½å¯¹åº”è¿æ¥ç€64Gçš„å†…å­˜ã€‚é‚£ä¹ˆNUMAæ‰“å¼€å’Œå…³é—­çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿ å¯¹äºå…³é—­NUMAçš„æœºå™¨ï¼Œåœ¨Linuxç³»ç»Ÿä¸­æŸ¥çœ‹çš„æ—¶å€™åªæœ‰ä¸€ä¸ªNUMAèŠ‚ç‚¹ï¼Œç³»ç»Ÿä¼šä»¥ä¸ºåªæœ‰ä¸€é¢—CPUï¼Œé‚£ä¹ˆè¿™128Gå†…å­˜å°±éƒ½æ˜¯è¿™ä¸€é¢—CPUçš„ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åœ¨åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿè·¨NUMAèŠ‚ç‚¹è°ƒåº¦å¦å¤–ä¸€é¢—CPUçš„å†…å­˜ï¼Œè™½ç„¶ä¸€é¢—CPUåªæœ‰64Gå†…å­˜çš„ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªCPUä¸Šé¢è¿è¡Œçš„ç¨‹åºå¯ä»¥è°ƒç”¨128Gçš„å†…å­˜ï¼Œå®åœ¨ä¸å¤Ÿäº†å†è°ƒç”¨SWAPå†…å­˜ã€‚å¯¹äºä¸€èˆ¬çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå³ä½¿æ˜¯ä½¿ç”¨äº†å¦å¤–ä¸€é¢—CPUçš„å†…å­˜ä¼šå¸¦æ¥è¾ƒé«˜çš„å»¶æ—¶ï¼Œä½†æ˜¯æ€§èƒ½ä¹Ÿè¿œæ¯”swapå†…å­˜å¼ºå¤šäº†ã€‚ å…³äºæ˜¯å¦å¼€å¯å¤„ç†å™¨çš„è¶…çº¿ç¨‹æŠ€æœ¯ï¼Œä¸»è¦åˆ†æå¦‚ä¸‹ï¼š è¶…çº¿ç¨‹ï¼ˆHyper-Threadingï¼‰åœ¨ä¸€ä¸ªå¤„ç†å™¨ä¸­æä¾›ä¸¤ä¸ªé€»è¾‘æ‰§è¡Œçº¿ç¨‹ï¼Œé€»è¾‘çº¿ç¨‹å…±äº«æµæ°´çº¿ã€æ‰§è¡Œå•å…ƒå’Œç¼“å­˜ã€‚è¯¥æŠ€æœ¯çš„æœ¬è´¨æ˜¯å¤ç”¨å•å¤„ç†å™¨ä¸­çš„è¶…æ ‡é‡æµæ°´çº¿çš„å¤šè·¯æ‰§è¡Œå•å…ƒï¼Œé™ä½å¤šè·¯æ‰§è¡Œå•å…ƒä¸­å› æŒ‡ä»¤ä¾èµ–é€ æˆçš„æ‰§è¡Œå•å…ƒé—²ç½®ã€‚å¯¹äºæ¯ä¸ªé€»è¾‘çº¿ç¨‹ï¼Œæ‹¥æœ‰å®Œæ•´ç‹¬ç«‹çš„å¯„å­˜å™¨é›†åˆå’Œæœ¬åœ°ä¸­æ–­é€»è¾‘ï¼Œä»è½¯ä»¶çš„è§’åº¦ï¼Œä¸å•çº¿ç¨‹ç‰©ç†æ ¸å¹¶æ²¡æœ‰å·®å¼‚ã€‚ä¾‹å¦‚ï¼Œ8æ ¸å¿ƒçš„å¤„ç†å™¨ä½¿ç”¨è¶…çº¿ç¨‹æŠ€æœ¯ä¹‹åï¼Œå¯ä»¥å¾—åˆ°16ä¸ªé€»è¾‘çº¿ç¨‹ã€‚é‡‡ç”¨è¶…çº¿ç¨‹ï¼Œåœ¨å•æ ¸ä¸Šå¯ä»¥åŒæ—¶è¿›è¡Œå¤šçº¿ç¨‹å¤„ç†ï¼Œä½¿æ•´ä½“æ€§èƒ½å¾—åˆ°ä¸€å®šç¨‹åº¦æå‡ã€‚ä½†ç”±äºå…¶æ¯•ç«Ÿæ˜¯å…±äº«æ‰§è¡Œå•å…ƒçš„ï¼Œå¯¹IPCï¼ˆæ¯å‘¨æœŸæ‰§è¡ŒæŒ‡ä»¤æ•°ï¼‰è¶Šé«˜çš„åº”ç”¨ï¼Œå¸¦æ¥çš„å¸®åŠ©è¶Šæœ‰é™ã€‚DPDKæ˜¯ä¸€ç§I/Oé›†ä¸­çš„è´Ÿè½½ï¼Œå¯¹äºè¿™ç±»è´Ÿè½½ï¼ŒIPCç›¸å¯¹ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œæ‰€ä»¥è¶…çº¿ç¨‹æŠ€æœ¯ä¼šæœ‰ä¸€å®šç¨‹åº¦çš„å¸®åŠ©ã€‚ å¯¹äºæ‰“å¼€NUMAçš„æœºå™¨ï¼Œåœ¨æœ¬èº«çš„CPUå†…å­˜ç”¨å°½çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå»è·¨NUMAèŠ‚ç‚¹è°ƒåº¦å¦å¤–ä¸€é¢—CPUçš„å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨swapå†…å­˜ã€‚å¯¹äºDPDKç¨‹åºæ¥è¯´ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯å°½å¯èƒ½åœ°é™ä½å†…å­˜çš„å»¶è¿Ÿï¼Œæé«˜æ€§èƒ½è¡¨ç°ã€‚ç”±äºDPDKå¹¿æ³›çš„ä½¿ç”¨äº†å¤§é¡µå†…å­˜ï¼ˆHugePageï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶å†…å­˜çš„è¶…ç”¨é—®é¢˜ï¼Œä¸ä¼šæ¶‰åŠåˆ°swapå†…å­˜çš„è°ƒç”¨ã€‚ RSSï¼ˆReceive Side Scalingï¼‰åŒæ ·çš„é™¤äº†å†…å­˜ä¹‹å¤–ï¼Œé—®é¢˜è¿˜å­˜åœ¨äºç½‘å¡è®¾å¤‡ä¸Šã€‚ä¸€èˆ¬æ¥è¯´ç½‘å¡è®¾å¤‡æ˜¯é€šè¿‡PCIeæ€»çº¿å’ŒCPUè¿æ¥ï¼Œä¸åŒCPUä¹‹é—´è·¨NUMAèŠ‚ç‚¹è°ƒç”¨PCIeè®¾å¤‡å¸¦æ¥çš„æ€§èƒ½æŸè€—å®é™…ä¸Šå¹¶æ²¡æœ‰å†…å­˜é‚£ä¹ˆå¤§ï¼Œå› ä¸ºPCIeæ€»çº¿å¹¶æ²¡æœ‰å†…å­˜æ€»çº¿è·ç¦»CPUé‚£ä¹ˆâ€œè¿‘â€ï¼Œè€Œä¸”ä¸¤è€…çš„å¸¦å®½ä¹Ÿä¸æ˜¯åœ¨ä¸€ä¸ªæ•°é‡çº§ä¸Šã€‚ è¿˜æ˜¯å‰é¢ç”¨åˆ°çš„é‚£å¼ ç½‘å¡ï¼Œæˆ‘ä»¬ä½¿ç”¨lspciå‘½ä»¤æŸ¥çœ‹pciè®¾å¤‡ä¿¡æ¯çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹åº”çš„NICè®¾å¤‡çš„ä¿¡æ¯ï¼ˆæˆªå–éƒ¨åˆ†ï¼‰ï¼š è¿™é‡Œå¯ä»¥çœ‹åˆ°5GT/så¯¹åº”çš„æ˜¯PCIe2.0ï¼Œx8åˆ™è¡¨ç¤ºå¸¦å®½ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªPCIe2.0x8çš„åŒå£ä¸‡å…†ç½‘å¡82599ES GT/sæ˜¯PCIeè®¾å¤‡ç”¨æ¥è¡¨ç¤ºå¸¦å®½çš„å•ä½ï¼Œå…·ä½“å¯¹åº”é€Ÿåº¦è½¬æ¢å¯ä»¥æŸ¥çœ‹ä¸‹é¢çš„è¿™ä¸ªè¡¨æ ¼ NUMA nodeè¡¨ç¤ºè¿™å—PCIeç½‘å¡æ’åœ¨çš„æ’æ§½æ˜¯å“ªä¸€é¢—CPUå¯¹åº”çš„PCIeæ€»çº¿ 123456704:00.1 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01) Subsystem: Intel Corporation Ethernet Server Adapter X520-2 NUMA node: 0 LnkCap: Port #0, Speed 5GT/s, Width x8, ASPM L0s, Exit Latency L0s &lt;1us, L1 &lt;8us ClockPM- Surprise- LLActRep- BwNot- ASPMOptComp- Kernel driver in use: igb_uio Kernel modules: ixgbe RSSï¼ˆReceive Side Scalingï¼‰åŠŸèƒ½çš„å®ç°å…¶å®å’Œç½‘å¡ä»¥åŠCPUéƒ½æœ‰å…³ç³»ï¼Œä½†æ˜¯è¿™é‡Œæ”¾åˆ°CPUçš„éƒ¨åˆ†æ¥åˆ†æï¼Œä¸»è¦æ˜¯éœ€è¦å‰é¢æåŠçš„æŠ€æœ¯ä½œä¸ºæ”¯æ’‘ã€‚å…³äºRSSçš„ä¸€äº›è¯´æ˜æˆ‘ä»¬å¯ä»¥å‚è€ƒLinuxå†…æ ¸çš„å®˜ç½‘æ–‡æ¡£ï¼Œæ­¤å¤–å¾®è½¯çš„å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰ä¸é”™çš„å›¾æ–‡è§£é‡Šã€‚ RSSï¼Œæ¥æ”¶æ–¹ç¼©æ”¾ï¼ˆç›´è¯‘èµ·æ¥ç•¥æ˜¾æ™¦æ¶©ç”Ÿç¡¬ï¼‰ï¼Œä½¿ç”¨æœç´¢å¼•æ“çš„æ—¶å€™å»ºè®®æœå…¨åReceive Side Scalingï¼Œæœç¼©å†™RSSå®¹æ˜“æœåˆ°Really Simple Syndicationï¼Œä¸­æ–‡è¯‘ä½œç®€æ˜“ä¿¡æ¯èšåˆï¼Œä¹Ÿç§°èšåˆå†…å®¹ï¼Œæ˜¯ä¸€ç§æ¶ˆæ¯æ¥æºæ ¼å¼è§„èŒƒï¼Œç”¨ä»¥èšåˆç»å¸¸å‘å¸ƒæ›´æ–°èµ„æ–™çš„ç½‘ç«™ï¼Œä¾‹å¦‚åšå®¢æ–‡ç« ã€æ–°é—»ã€éŸ³é¢‘æˆ–è§†é¢‘çš„ç½‘æ‘˜ã€‚ ç°åœ¨çš„ç½‘å¡åŸºæœ¬éƒ½æ”¯æŒå¤šé˜Ÿåˆ—(multi-queue)æŠ€æœ¯ï¼Œè€Œé˜Ÿåˆ—æ˜¯åˆ†ä¸ºæ”¶å’Œå‘ä¸¤ç§çš„ã€‚åœ¨æ¥æ”¶æ•°æ®åŒ…çš„æ—¶å€™ï¼Œç½‘å¡å¯ä»¥æŠŠæ•°æ®åŒ…å‘å¾€ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä¸€èˆ¬é€šè¿‡å“ˆå¸Œç®—æ³•ï¼‰ï¼Œä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—å¯¹åº”ä¸åŒçš„CPUï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°å¹¶è¡Œå¤„ç†æ•°æ®ã€‚å…¸å‹çš„RSSé…ç½®æ˜¯ï¼šå¦‚æœè®¾å¤‡æ”¯æŒè¶³å¤Ÿçš„é˜Ÿåˆ—ï¼Œåˆ™æ¯ä¸ªCPUæœ‰ä¸€ä¸ªæ¥æ”¶é˜Ÿåˆ—ï¼ˆä¸€èˆ¬å¤šç½‘å¡æœºå™¨ä¸Šç½‘å¡çš„æ€»é˜Ÿåˆ—æ•°ä¼šè¶…è¿‡CPUæ ¸å¿ƒæ•°ï¼Œå› æ­¤CPUæ ¸å¿ƒæ•°å’Œç½‘å¡é˜Ÿåˆ—æ•°ä¸€ä¸€å¯¹åº”å³å¯ï¼‰ï¼Œå¦åˆ™ï¼Œæ¯ä¸ªå†…å­˜åŸŸï¼ˆå¦‚ä¸€ä¸ªNUMAèŠ‚ç‚¹ï¼‰è‡³å°‘æœ‰ä¸€ä¸ªæ¥æ”¶é˜Ÿåˆ—ã€‚ åŸºäºè¿™äº›ç‰¹æ€§ï¼ŒDPVSå¯ä»¥åœ¨é…ç½®ä¸­è®¾å®šworkerè¿›ç¨‹ã€CPUæ ¸å¿ƒå’Œç½‘å¡æ”¶å‘é˜Ÿåˆ—çš„ä¸€ä¸€ç»‘å®šï¼Œæœ€å¥½çš„æƒ…å†µä¸‹å°±æ˜¯å…¨éƒ¨éƒ½æ˜¯åœ¨ä¸€é¢—ç‰©ç†CPUä¸Šï¼Œè¿™æ ·å¸¦æ¥çš„æ€§èƒ½æå‡æœ€æ˜æ˜¾ã€‚ è¿™æ˜¯DPVSå®£ä¼ çš„NUMA Awarenesså’ŒRX steering&amp;CPUçš„æŠ€æœ¯åŸç†ã€‚ 3ã€From memoryHuge pageå¤§é¡µå†…å­˜DPDKå¹¿æ³›ä½¿ç”¨äº†å¤§é¡µå†…å­˜ï¼ˆ2Mæˆ–è€…1Gï¼‰æœºåˆ¶ï¼ˆå¯¹äºDPVSæ¥è¯´ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯2MBçš„å¤§é¡µå†…å­˜ï¼‰ï¼Œä»¥Linuxç³»ç»Ÿä¸ºä¾‹ï¼Œ1Gçš„å¤§é¡µä¸€èˆ¬ä¸èƒ½åœ¨ç³»ç»ŸåŠ è½½ååŠ¨æ€åˆ†é…ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šåœ¨å†…æ ¸åŠ è½½çš„æ—¶å€™è®¾ç½®å¥½éœ€è¦ç”¨åˆ°çš„å¤§é¡µã€‚ä¾‹å¦‚ï¼Œå¢åŠ å†…æ ¸å¯åŠ¨å‚æ•°default_hugepagesz=1G hugepagesz=1G hugepages=8æ¥é…ç½®å¥½8ä¸ª1Gçš„å¤§é¡µã€‚åœ¨Linuxç³»ç»Ÿä¸Šï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤cat /proc/meminfoæ¥æŸ¥çœ‹ç³»ç»ŸåŠ è½½åçš„å†…å­˜çŠ¶å†µå’Œå¤§é¡µå†…å­˜çš„åˆ†é…çŠ¶å†µã€‚ 1234567# cat /proc/meminfo | grep HugeAnonHugePages: 243712 kBHugePages_Total: 16384HugePages_Free: 0HugePages_Rsvd: 0HugePages_Surp: 0Hugepagesize: 2048 kB æ³¨æ„ä¸Šé¢çš„AnonHugePageså’Œæˆ‘ä»¬è¿™é‡Œè¦è®²çš„Hugepagesä¸æ˜¯ä¸€ç±»ä¸œè¥¿ï¼Œå»ºè®®å¿½ç•¥ã€‚åŒæ—¶Hugepagesä¸ä¼šå¤‡æ³¨å¤§å°ï¼Œä¸Šé¢çš„Hugepagesizeè¡¨æ˜ä½¿ç”¨çš„æ˜¯2MBçš„å¤§é¡µå†…å­˜ï¼Œè€ŒHugePages_Totalè¡¨æ˜æœ‰16384ä¸ªè¿™ä¹ˆå¤§çš„å¤§é¡µå†…å­˜ï¼Œæ‰€ä»¥è¿™é‡Œä¸€å…±æ˜¯32GBçš„å¤§é¡µå†…å­˜ã€‚ åœ¨ç»§ç»­åé¢çš„å†…å®¹ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹TLBæ˜¯ä»€ä¹ˆã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“MMU(Memory Management Unit)çš„ä½œç”¨æ˜¯æŠŠè™šæ‹Ÿå†…å­˜åœ°å€è½¬æ¢æˆç‰©ç†å†…å­˜åœ°å€ã€‚è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»å­˜å‚¨åœ¨é¡µè¡¨ä¸­ï¼Œè€Œç°åœ¨é¡µè¡¨åˆæ˜¯åˆ†çº§çš„ã€‚64ä½ç³»ç»Ÿä¸€èˆ¬éƒ½æ˜¯3~5çº§ã€‚å¸¸è§çš„é…ç½®æ˜¯4çº§é¡µè¡¨ï¼Œå°±ä»¥4çº§é¡µè¡¨ä¸ºä¾‹è¯´æ˜ã€‚åˆ†åˆ«æ˜¯PGDã€PUDã€PMDã€PTEå››çº§é¡µè¡¨ã€‚ åœ¨ç¡¬ä»¶ä¸Šä¼šæœ‰ä¸€ä¸ªå«åšé¡µè¡¨åŸºåœ°å€å¯„å­˜å™¨ï¼Œå®ƒå­˜å‚¨PGDé¡µè¡¨çš„é¦–åœ°å€ã€‚MMUå°±æ˜¯æ ¹æ®é¡µè¡¨åŸºåœ°å€å¯„å­˜å™¨ä»PGDé¡µè¡¨ä¸€è·¯æŸ¥åˆ°PTEï¼Œæœ€ç»ˆæ‰¾åˆ°ç‰©ç†åœ°å€(PTEé¡µè¡¨ä¸­å­˜å‚¨ç‰©ç†åœ°å€)ã€‚å››çº§é¡µè¡¨æŸ¥æ‰¾è¿‡ç¨‹éœ€è¦å››æ¬¡å†…å­˜è®¿é—®ã€‚å»¶æ—¶å¯æƒ³è€ŒçŸ¥ï¼Œéå¸¸å½±å“æ€§èƒ½ã€‚ï¼ˆä¸‹å›¾æ¥è‡ªçŸ¥ä¹ï¼‰ TLBçš„æœ¬è´¨å…¶å®å°±æ˜¯ä¸€å—é«˜é€Ÿç¼“å­˜ã€‚æ•°æ®cacheç¼“å­˜åœ°å€(è™šæ‹Ÿåœ°å€æˆ–è€…ç‰©ç†åœ°å€)å’Œæ•°æ®ã€‚TLBç¼“å­˜è™šæ‹Ÿåœ°å€å’Œå…¶æ˜ å°„çš„ç‰©ç†åœ°å€ã€‚TLBæ ¹æ®è™šæ‹Ÿåœ°å€æŸ¥æ‰¾cacheï¼Œå®ƒæ²¡å¾—é€‰ï¼Œåªèƒ½æ ¹æ®è™šæ‹Ÿåœ°å€æŸ¥æ‰¾ã€‚æ‰€ä»¥TLBæ˜¯ä¸€ä¸ªè™šæ‹Ÿé«˜é€Ÿç¼“å­˜ã€‚ç¡¬ä»¶å­˜åœ¨TLBåï¼Œè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è¿‡ç¨‹å‘ç”Ÿäº†å˜åŒ–ã€‚è™šæ‹Ÿåœ°å€é¦–å…ˆå‘å¾€TLBç¡®è®¤æ˜¯å¦å‘½ä¸­cacheï¼Œå¦‚æœcache hitç›´æ¥å¯ä»¥å¾—åˆ°ç‰©ç†åœ°å€ã€‚å¦åˆ™ï¼Œä¸€çº§ä¸€çº§æŸ¥æ‰¾é¡µè¡¨è·å–ç‰©ç†åœ°å€ã€‚å¹¶å°†è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»ç¼“å­˜åˆ°TLBä¸­ã€‚ é»˜è®¤ä¸‹Linuxç³»ç»Ÿçš„å†…å­˜é‡‡ç”¨4KBä¸ºä¸€é¡µï¼Œé¡µè¶Šå°ä¸”å†…å­˜è¶Šå¤§åˆ™é¡µè¡¨çš„å¼€é”€è¶Šå¤§ï¼Œé¡µè¡¨çš„å†…å­˜å ç”¨ä¹Ÿè¶Šå¤§ã€‚CPUä½¿ç”¨çš„TLBï¼ˆTranslation Lookaside Bufferï¼‰åˆ¶ä½œæˆæœ¬å¾ˆé«˜ï¼Œæ‰€ä»¥ä¸€èˆ¬å¤§å°å¹¶ä¸å¤§ï¼Œå› æ­¤ä¸€èˆ¬å°±åªèƒ½å­˜æ”¾å‡ ç™¾åˆ°ä¸Šåƒä¸ªé¡µè¡¨é¡¹ã€‚å¦‚æœè¿›ç¨‹è¦ä½¿ç”¨64Gå†…å­˜ï¼Œåˆ™64G/4KB=16000000ï¼ˆä¸€åƒå…­ç™¾ä¸‡ï¼‰é¡µï¼Œæ¯é¡µåœ¨é¡µè¡¨é¡¹ä¸­å ç”¨16000000*4B=62MBã€‚å¦‚æœç”¨HugePageé‡‡ç”¨2MBä½œä¸ºä¸€é¡µï¼Œåªéœ€64G/2MB=2000ï¼Œæ•°é‡ä¸åœ¨åŒä¸ªçº§åˆ«ã€‚ è€ŒDPDKé‡‡ç”¨HugePageï¼Œåœ¨Ã—86-64ä¸‹æ”¯æŒ2MBã€1GBçš„é¡µå¤§å°ï¼Œå‡ ä½•çº§çš„é™ä½äº†é¡µè¡¨é¡¹çš„å¤§å°ï¼Œä»è€Œå‡å°‘TLB-Missï¼Œå¹¶æä¾›äº†å†…å­˜æ± ï¼ˆMempoolï¼‰ã€MBufã€æ— é”ç¯ï¼ˆRingï¼‰ã€Bitmapç­‰åŸºç¡€åº“ã€‚ è€Œä¸”å¯¹äºæ™®é€šåº”ç”¨ç¨‹åºè€Œè¨€ï¼Œæ ¹æœ¬ä¸ä¼šè°ƒç”¨åˆ°å¤§é¡µå†…å­˜ï¼Œä¸”å¤§é¡µå†…å­˜åˆ†é…ä¹‹åç«‹åˆ»å°±ä¼šåœ¨ç³»ç»Ÿçš„å¯ç”¨å†…å­˜ä¸­åˆ’å»ï¼Œä¸ç®¡dpdkç¨‹åºæ˜¯å¦ä½¿ç”¨ï¼Œéƒ½ä¸ä¼šè¢«å…¶ä»–ç¨‹åºå ç”¨ï¼Œåœ¨åªè¿è¡Œäº†dpdkç¨‹åºçš„æœºå™¨ä¸Šï¼Œåˆ’åˆ†å‡ºçš„å¤§é¡µå†…å­˜åŒºåŸŸå°±æ˜¯è¯¥dpdkç¨‹åºç‹¬äº«çš„VIPåŒºã€‚ è¿™é‡Œå°±æ˜¯DPVSå®£ä¼ çš„mempoolå’ŒHugePageç‰¹æ€§çš„å®ç°åŸç†ã€‚ 4ã€æ€»ç»“ç¨åŠ æ·±å…¥åˆ†æä¹‹åæˆ‘ä»¬ä¸éš¾å‘ç°DPVSçš„é«˜æ€§èƒ½å®ç°åŸºæœ¬éƒ½æ˜¯ä¾é ç‰¹å®šç¡¬ä»¶å’ŒDPDKæ¥å®ç°çš„ï¼Œé‚£ä¹ˆDPVSçš„ä¼˜åŠ¿åœ¨å“ªé‡Œå‘¢ï¼Ÿ å®é™…ä¸ŠDPDKä½œä¸ºä¸€å¥—å¼€å‘å¥—ä»¶ï¼Œæœ¬èº«å¹¶ä¸æ˜¯ç‰¹åˆ«çš„å®Œå–„ï¼Œç”±äºå®ƒçš„PMDé©±åŠ¨ç»•è¿‡äº†å†…æ ¸çš„ç½‘ç»œæ ˆï¼Œå› æ­¤æƒ³è¦å®ç°DPDK+LVSçš„æ ¸å¿ƒéš¾åº¦åœ¨äºå¦‚ä½•åœ¨ç”¨æˆ·æ€å®ç°ä¸€å¥—è½»é‡çº§çš„ç½‘ç»œåè®®æ ˆï¼ˆL4LBä¸éœ€è¦å®Œæ•´çš„ç½‘ç»œæ ˆï¼‰ï¼Œè¿™ä¹Ÿæ˜¯DPVSçš„æœ€æ ¸å¿ƒéš¾ç‚¹ä¹‹ä¸€ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"},{"name":"lvs","slug":"lvs","permalink":"https://tinychen.com/tags/lvs/"},{"name":"dpdk","slug":"dpdk","permalink":"https://tinychen.com/tags/dpdk/"},{"name":"dpvs","slug":"dpvs","permalink":"https://tinychen.com/tags/dpvs/"}]},{"title":"DPVSç®€ä»‹ä¸éƒ¨ç½²","slug":"20201103-dpvs-deploy-in-centos7","date":"2020-11-03T03:00:00.000Z","updated":"2020-11-03T03:00:00.000Z","comments":true,"path":"20201103-dpvs-deploy-in-centos7/","link":"","permalink":"https://tinychen.com/20201103-dpvs-deploy-in-centos7/","excerpt":"å¯¹DPVSè¿›è¡Œç®€å•çš„ä»‹ç»å’Œåœ¨centos7çš„ç‰©ç†æœºä¸Šéƒ¨ç½²dpvsè´Ÿè½½å‡è¡¡ç³»ç»Ÿã€‚","text":"å¯¹DPVSè¿›è¡Œç®€å•çš„ä»‹ç»å’Œåœ¨centos7çš„ç‰©ç†æœºä¸Šéƒ¨ç½²dpvsè´Ÿè½½å‡è¡¡ç³»ç»Ÿã€‚ 0ã€DPVSç®€ä»‹DPVSæ¶æ„DPVSæ˜¯ä¸€ä¸ªåŸºäºDPDKçš„é«˜æ€§èƒ½å››å±‚è´Ÿè½½å‡è¡¡å™¨ï¼ˆLayer-4 load balancerï¼‰ï¼ŒDPVSçš„åå­—æ¥æºäºDPDK+LVSï¼Œæ³¨æ„è¿™é‡Œçš„LVSæ˜¯é˜¿é‡Œå·´å·´æ”¹è¿›ç‰ˆçš„LVSã€‚ä¸‹å›¾æ˜¯çˆ±å¥‡è‰ºå®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªDPVSæ¶æ„ä»¥åŠä¸»è¦ç‰¹ç‚¹ï¼š ç”¨æˆ·æ€å®ç°DPVSä¸»è¦çš„ä»»åŠ¡éƒ½æ˜¯åœ¨ç”¨æˆ·æ€å®Œæˆçš„ï¼Œå¯ä»¥æå¤§åœ°æé«˜æ•ˆç‡ã€‚å®˜æ–¹å£°ç§°DPVSçš„åŒ…å¤„ç†é€Ÿåº¦ï¼Œ1ä¸ªå·¥ä½œçº¿ç¨‹å¯ä»¥è¾¾åˆ° 2.3Mppsï¼Œ6ä¸ªå·¥ä½œçº¿ç¨‹å¯ä»¥è¾¾åˆ°ä¸‡å…†ç½‘å¡å°åŒ…çš„è½¬å‘çº¿é€Ÿï¼ˆçº¦ 12Mpps)ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºDPVSç»•è¿‡äº†å†…æ ¸å¤æ‚çš„åè®®æ ˆï¼Œå¹¶é‡‡ç”¨è½®è¯¢çš„æ–¹å¼æ”¶å‘æ•°æ®åŒ…ï¼Œé¿å…äº†é”ã€å†…æ ¸ä¸­æ–­ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ã€å†…æ ¸æ€å’Œç”¨æˆ·æ€æ•°æ®æ‹·è´äº§ç”Ÿçš„æ€§èƒ½å¼€é”€ã€‚ å®é™…ä¸Šå››å±‚è´Ÿè½½å‡è¡¡å¹¶ä¸éœ€è¦å®Œæ•´çš„åè®®æ ˆï¼Œä½†æ˜¯éœ€è¦åŸºæœ¬çš„ç½‘ç»œç»„ä»¶ï¼Œä»¥ä¾¿å®Œæˆå’Œå‘¨å›´è®¾å¤‡çš„äº¤äº’ï¼ˆARP/NS/NAï¼‰ã€ç¡®å®šåˆ†ç»„èµ°å‘ ï¼ˆRouteï¼‰ã€å›åº” Ping è¯·æ±‚ã€å¥å…¨æ€§æ£€æŸ¥ï¼ˆåˆ†ç»„å®Œæ•´æ€§ï¼ŒChecksumæ ¡éªŒï¼‰ã€ä»¥åŠ IP åœ°å€ç®¡ç†ç­‰åŸºæœ¬å·¥ä½œã€‚ä½¿ç”¨ DPDK æé«˜äº†æ”¶å‘åŒ…æ€§èƒ½ï¼Œä½†ä¹Ÿç»•è¿‡äº†å†…æ ¸åè®®æ ˆï¼ŒDPVS ä¾èµ–çš„åè®®æ ˆéœ€è¦è‡ªå·±å®ç°ã€‚ Master/Workeræ¨¡å‹è¿™ä¸€ç‚¹å’Œnginxä¸€æ ·ï¼Œä½¿ç”¨M/Sæ¨¡å‹ï¼ŒMaster å¤„ç†æ§åˆ¶å¹³é¢ï¼Œæ¯”å¦‚å‚æ•°é…ç½®ã€ç»Ÿè®¡è·å–ç­‰ï¼›Worker å®ç°æ ¸å¿ƒè´Ÿè½½å‡è¡¡ã€è°ƒåº¦ã€æ•°æ®è½¬å‘åŠŸèƒ½ã€‚ å¦å¤–ï¼ŒDPVS ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å‹ï¼Œæ¯ä¸ªçº¿ç¨‹ç»‘å®šåˆ°ä¸€ä¸ª CPU ç‰©ç†æ ¸å¿ƒä¸Šï¼Œå¹¶ä¸”ç¦æ­¢è¿™äº› CPU è¢«è°ƒåº¦ã€‚è¿™äº› CPU åªè¿è¡Œ DPVS çš„ Master æˆ–è€…æŸä¸ª Workerï¼Œä»¥æ­¤é¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåˆ«çš„è¿›ç¨‹ä¸ä¼šè¢«è°ƒåº¦åˆ°è¿™äº› CPUï¼ŒWorker ä¹Ÿä¸ä¼šè¿ç§»åˆ°å…¶ä»– CPU é€ æˆç¼“å­˜å¤±æ•ˆã€‚ ç½‘å¡é˜Ÿåˆ—/CPUç»‘å®šç°åœ¨çš„æœåŠ¡å™¨ç½‘å¡ç»å¤§å¤šæ•°éƒ½æ˜¯å¤šé˜Ÿåˆ—ç½‘å¡ï¼Œæ”¯æŒå¤šä¸ªé˜Ÿåˆ—åŒæ—¶æ”¶å‘æ•°æ®ï¼Œè®©ä¸åŒçš„ CPU å¤„ç†ä¸åŒçš„ç½‘å¡é˜Ÿåˆ—çš„æµé‡ï¼Œåˆ†æ‘Šå·¥ä½œé‡ï¼ŒDPVSå°†å…¶å’ŒCPUè¿›è¡Œç»‘å®šï¼Œåˆ©ç”¨DPDK çš„ API å®ç°ä¸€ä¸ªç½‘å¡çš„ä¸€ä¸ªæ”¶å‘é˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªCPUæ ¸å¿ƒå’Œä¸€ä¸ªWorkerè¿›ç¨‹ï¼Œå®ç°ä¸€ä¸€å¯¹åº”å’Œç»‘å®šï¼Œä»è€Œå®ç°äº†å¤„ç†èƒ½åŠ›éšCPUæ ¸å¿ƒã€ç½‘å¡é˜Ÿåˆ—æ•°çš„å¢åŠ è€Œçº¿æ€§å¢é•¿ï¼Œå¹¶ä¸”å¾ˆå¥½åœ°å®ç°äº†å¹¶è¡Œå¤„ç†å’Œçº¿æ€§æ‰©å±•ã€‚ å…³é”®æ•°æ®æ— é”åŒ–å†…æ ¸æ€§èƒ½é—®é¢˜çš„ä¸€å¤§åŸå› å°±æ˜¯èµ„æºå…±äº«å’Œé”ã€‚æ‰€ä»¥ï¼Œè¢«é¢‘ç¹è®¿é—®çš„å…³é”®æ•°æ®éœ€è¦å°½å¯èƒ½çš„å®ç°æ— é”åŒ–ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹æ³•æ˜¯å°†æ•°æ®åšåˆ° per-cpu åŒ–ï¼Œå³æ¯ä¸ªCPUæ ¸å¿ƒåªå¤„ç†è‡ªå·±æœ¬åœ°çš„æ•°æ®ï¼Œä¸éœ€è¦è®¿é—®å…¶ä»–CPUçš„æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…åŠ é”ã€‚å¯¹äºDPVSè€Œè¨€ï¼Œè¿æ¥è¡¨ï¼Œé‚»å±…è¡¨ï¼Œè·¯ç”±è¡¨ç­‰é¢‘ç¹ä¿®æ”¹æˆ–è€…é¢‘ç¹æŸ¥æ‰¾çš„æ•°æ®ï¼Œéƒ½åšåˆ°äº† per-cpu åŒ–ã€‚ä½†æ˜¯åœ¨å…·ä½“ per-cpu çš„å®ç°ä¸Šï¼Œè¿æ¥è¡¨å’Œé‚»å±…è¡¨ã€è·¯ç”±è¡¨ä¸¤è€…çš„å®ç°æ–¹å¼å¹¶ä¸ç›¸åŒã€‚ è¿æ¥è¡¨åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¼šè¢«é¢‘ç¹çš„CRUDã€‚DPVSä¸­æ¯ä¸ªCPUæ ¸å¿ƒç»´æŠ¤çš„æ˜¯ä¸ç›¸åŒçš„è¿æ¥è¡¨ï¼Œä¸åŒçš„ç½‘ç»œæ•°æ®æµï¼ˆTCP/UDP/ICMPï¼‰æŒ‰ç…§ N å…ƒç»„è¢«å®šå‘åˆ°ä¸åŒçš„CPUæ ¸å¿ƒï¼Œåœ¨æ­¤ç‰¹å®šçš„CPUæ ¸å¿ƒä¸Šåˆ›å»ºã€æŸ¥æ‰¾ã€è½¬å‘ã€é”€æ¯ã€‚åŒä¸€ä¸ªæ•°æ®æµçš„åŒ…ï¼Œåªä¼šå‡ºç°åœ¨æŸä¸ªCPUæ ¸å¿ƒä¸Šï¼Œä¸ä¼šè½åˆ°å…¶ä»–çš„CPUæ ¸å¿ƒä¸Šã€‚è¿™æ ·å°±å¯ä»¥åšåˆ°ä¸åŒçš„CPUæ ¸å¿ƒåªç»´æŠ¤è‡ªå·±æœ¬åœ°çš„è¡¨ï¼Œæ— éœ€åŠ é”ã€‚ å¯¹äºé‚»å±…è¡¨å’Œè·¯ç”±è¡¨è¿™ç§æ¯ä¸ªCPUæ ¸å¿ƒéƒ½è¦ä½¿ç”¨çš„å…¨å±€çº§åˆ«çš„æ“ä½œç³»ç»Ÿæ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä½¿ç”¨â€å…¨å±€è¡¨+é”ä¿æŠ¤â€œçš„æ–¹å¼ã€‚DPVSé€šè¿‡è®©æ¯ä¸ªCPUæ ¸å¿ƒæœ‰åŒæ ·çš„è§†å›¾ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªCPUæ ¸å¿ƒéœ€è¦ç»´æŠ¤åŒæ ·çš„è¡¨ï¼Œä»è€Œåšåˆ°äº†per-cpuã€‚å¯¹äºè¿™ä¸¤ä¸ªè¡¨ï¼Œè™½ç„¶åœ¨å…·ä½“å®ç°ä¸Šæœ‰å°çš„å·®åˆ«ï¼ˆè·¯ç”±è¡¨æ˜¯ç›´æ¥ä¼ é€’ä¿¡æ¯ï¼Œé‚»å±…æ˜¯å…‹éš†æ•°æ®å¹¶ä¼ é€’åˆ†ç»„ç»™åˆ«çš„ CPUï¼‰ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡è·¨CPUé€šä¿¡æ¥å®ç°çš„è·¨CPUæ— é”åŒæ­¥ï¼Œä»è€Œå°†è¡¨çš„å˜åŒ–åŒæ­¥åˆ°æ¯ä¸ªCPUï¼Œæœ€åå®ç°äº†æ— é”åŒ–ã€‚ è·¨CPUæ— é”é€šä¿¡ä¸Šé¢çš„å…³é”®æ•°æ®æ— é”åŒ–å’Œè¿™ä¸€ç‚¹å®é™…ä¸Šæ˜¯æ®Šé€”åŒå½’çš„ã€‚é¦–å…ˆï¼Œè™½ç„¶é‡‡ç”¨äº†å…³é”®æ•°æ® per-cpuç­‰ä¼˜åŒ–ï¼Œä½†è·¨CPUè¿˜æ˜¯éœ€è¦é€šä¿¡çš„ï¼Œæ¯”å¦‚: Master è·å–å„ä¸ª Worker çš„å„ç§ç»Ÿè®¡ä¿¡æ¯ Master å°†è·¯ç”±ã€é»‘åå•ç­‰é…ç½®åŒæ­¥åˆ°å„ä¸ª Worker Master å°†æ¥è‡ªDPVSçš„KNIç½‘å¡çš„æ•°æ®å‘é€åˆ° Workerï¼ˆåªæœ‰ Worker èƒ½æ“ä½œDPDKç½‘å¡æ¥å£æ¥å‘é€æ•°æ®ï¼‰ æ—¢ç„¶éœ€è¦é€šä¿¡ï¼Œå°±ä¸èƒ½å­˜åœ¨äº’ç›¸å½±å“ã€ç›¸äº’ç­‰å¾…çš„æƒ…å†µï¼Œå› ä¸ºé‚£ä¼šå½±å“æ€§èƒ½ã€‚DPVSçš„æ— é”é€šä¿¡è¿˜æ˜¯ä¸»è¦ä¾é DPDKæä¾›çš„æ— é”rte_ringåº“å®ç°çš„ï¼Œä»åº•å±‚ä¿è¯é€šä¿¡æ˜¯æ— é”çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨æ­¤ä¹‹ä¸Šå°è£…ä¸€å±‚æ¶ˆæ¯æœºåˆ¶æ¥æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼ŒåŒæ­¥æˆ–å¼‚æ­¥çš„æ¶ˆæ¯ã€‚ ä¸°å¯Œçš„åŠŸèƒ½ä»è½¬å‘æ¨¡å¼ä¸Šçœ‹ï¼šDPVS æ”¯æŒ DirectRoutingï¼ˆDRï¼‰ã€NATã€Tunnelã€Full-NATã€SNATäº”ç§è½¬å‘æ¨¡å¼ï¼Œå¯ä»¥çµæ´»é€‚é…å„ç§ç½‘ç»œåº”ç”¨åœºæ™¯ ä»åè®®æ”¯æŒä¸Šçœ‹ï¼šDPVS æ”¯æŒ IPv4å’Œ IPv6 åè®®ã€ä¸”æœ€æ–°ç‰ˆæœ¬å¢åŠ äº† NAT64çš„è½¬å‘åŠŸèƒ½ï¼Œå®ç°äº†ç”¨æˆ·ä» IPv6ç½‘ç»œè®¿é—® IPv4æœåŠ¡ ä»è®¾å¤‡æ”¯æŒä¸Šçœ‹ï¼šDPVSæ”¯æŒä¸»æµçš„ç¡¬ä»¶ç½‘å¡è®¾å¤‡ï¼ŒåŒæ—¶è¿˜æ”¯æŒäº†Bondingï¼ˆmode 0 and 4 ï¼‰, VLAN, kni, ipip/GREç­‰è™šæ‹Ÿè®¾å¤‡ ä»ç®¡ç†å·¥å…·ä¸Šçœ‹ï¼šå¯ä»¥ä½¿ç”¨åŒ…æ‹¬ ipvsadmã€keepalivedã€dpipç­‰å·¥å…·å¯¹DPVSè¿›è¡Œé…ç½®å’Œç®¡ç†ï¼Œä¹Ÿæ”¯æŒä½¿ç”¨è¿›è¡Œ quagga é›†ç¾¤åŒ–éƒ¨ç½² å°ç»“ä»ä¸Šé¢åˆ—å‡ºçš„å‡ ä¸ªDPVSçš„ä¸»è¦ç‰¹ç‚¹æˆ‘ä»¬ä¸éš¾å‘ç°ï¼ŒDPVSçš„ä¸»è¦è®¾è®¡æ€è·¯å°±æ˜¯é€šè¿‡å‡å°‘å„ç§åˆ‡æ¢å’Œé¿å…åŠ é”æ¥æé«˜æ€§èƒ½ï¼Œå…·ä½“çš„å®ç°ä¸Šåˆ™ä¸»è¦ä¾èµ–äº†DPDKçš„è®¸å¤šåŠŸèƒ½ç‰¹æ€§ä»¥åŠä½¿ç”¨äº†å¸¸ç”¨çš„å‡ ä¸ªå¼€æºè´Ÿè½½å‡è¡¡è½¯ä»¶ï¼ˆipvsadmã€keepalivedã€dpipç­‰ï¼‰ï¼Œç»“åˆç”¨æˆ·æ€çš„è½»é‡çº§ç½‘ç»œåè®®æ ˆï¼ˆåªä¿ç•™äº†å››å±‚è´Ÿè½½å‡è¡¡æ‰€å¿…é¡»çš„ï¼‰ï¼Œå°±å®ç°äº†è¶…å¼ºæ€§èƒ½çš„å››å±‚è´Ÿè½½å‡è¡¡ç³»ç»Ÿã€‚ 1ã€æœºå™¨é…ç½®DPVSç”±äºå¼•å…¥äº†DPDKå¥—ä»¶ä½œä¸ºåº•å±‚çš„æ”¯æ’‘ï¼Œå› æ­¤æƒ³è¦æœ€å¤§åŒ–å‘æŒ¥å®ƒçš„æ€§èƒ½ï¼Œéœ€è¦å¯¹ç¡¬ä»¶æœ‰ä¸€å®šçš„è¦æ±‚ï¼Œdpdkå®˜æ–¹ç»™å‡ºäº†ä¸€ä»½æ”¯æŒåˆ—è¡¨ï¼Œè™½ç„¶æ”¯æŒæ€§åˆ—è¡¨ä¸Šé¢çš„å¹³å°æ”¯æŒå¾—å¾ˆå¹¿æ³›ï¼Œä½†æ˜¯å®é™…ä¸Šå…¼å®¹æ€§å’Œè¡¨ç°æœ€å¥½çš„ä¼¼ä¹è¿˜æ˜¯è¦Intelçš„ç¡¬ä»¶å¹³å°ã€‚ç½‘å¡çš„å…¼å®¹æ€§æ–¹é¢ï¼Œä¸»æµçš„Intelç½‘å¡å‡ ä¹éƒ½æ”¯æŒï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸åŒå‹å·çš„ç½‘å¡åœ¨flow-directoråŠŸèƒ½å’Œç½‘å¡çš„æ”¶å‘æ•°æ®åŒ…æ”¯æŒçš„é˜Ÿåˆ—æ•°å¯èƒ½ä¼šæœ‰ä¸åŒã€‚ æœºå™¨å‚æ•° CPUï¼šä¸¤é¢— Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz å†…å­˜ï¼š16G*8 DDR4-2400 MT/sï¼Œæ¯ä¸ªCPU64Gï¼Œå…±è®¡128G ç½‘å¡ï¼šä¸¤å¼ åŒå£çš„Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01) ç³»ç»Ÿï¼šRed Hat Enterprise Linux Server release 7.6 (Maipo) å†…æ ¸ï¼š3.10.0-1127.19.1.el7.x86_64 å…³é—­è¶…çº¿ç¨‹å’Œå¯ç”¨NUMAç­–ç•¥å…³é—­è¶…çº¿ç¨‹æœ€å¥½çš„åŠæ³•æ˜¯åœ¨BIOSä¸­æ‰¾åˆ°ç›¸å…³çš„è¶…çº¿ç¨‹è®¾ç½®å¹¶ä¸”å°†å…¶ç¦ç”¨ï¼Œè€ŒNUMAç­–ç•¥ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæœ€å¥½åœ¨BIOSä¸­ç›´æ¥æ‰“å¼€ã€‚ æ‰“å¼€è¶…çº¿ç¨‹æŠ€æœ¯çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Thread(s) per coreæ˜¯2ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªç‰©ç†æ ¸å¿ƒå¯¹åº”æœ‰2ä¸ªé€»è¾‘æ ¸å¿ƒï¼Œè€ŒCore(s) per socketè¡¨ç¤ºæ¯ä¸ªsocketæœ‰10ä¸ªç‰©ç†æ ¸å¿ƒï¼ˆä¸€èˆ¬ä¸€ä¸ªCPUå¯¹åº”ä¸€ä¸ªsocketï¼‰ï¼ŒSocket(s)è¡¨ç¤ºå½“å‰æœåŠ¡å™¨æœ‰ä¸¤ä¸ªCPUï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„åŒè·¯ã€‚ 1234567891011121314151617181920212223242526272829303132$ lscpuArchitecture: x86_64CPU op-mode(s): 32-bit, 64-bitByte Order: Little EndianCPU(s): 40On-line CPU(s) list: 0-39Thread(s) per core: 2Core(s) per socket: 10Socket(s): 2NUMA node(s): 2Vendor ID: GenuineIntelCPU family: 6Model: 79Model name: Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHzStepping: 1CPU MHz: 2669.567CPU max MHz: 3100.0000CPU min MHz: 1200.0000BogoMIPS: 4399.75Virtualization: VT-xL1d cache: 32KL1i cache: 32KL2 cache: 256KL3 cache: 25600KNUMA node0 CPU(s): 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38NUMA node1 CPU(s): 1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39# å½“ç¡¬ä»¶çš„è¶…çº¿ç¨‹è®¾ç½®æ‰“å¼€çš„æ—¶å€™ï¼Œæ˜¾ç¤ºä¸º1ï¼Œè¡¨æ˜ç¡¬ä»¶å¯ç”¨äº†è¶…çº¿ç¨‹$ cat /sys/devices/system/cpu/smt/active1# å½“ç„¶è¾ƒé«˜ç‰ˆæœ¬çš„å†…æ ¸ä¹Ÿå¯ä»¥é€šè¿‡smt.controlå‚æ•°æ¥ä»æ“ä½œç³»ç»Ÿå±‚é¢æ§åˆ¶è¶…çº¿ç¨‹æŠ€æœ¯$ cat /sys/devices/system/cpu/smt/controlon å…³é—­è¶…çº¿ç¨‹æŠ€æœ¯ä¹‹åçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Thread(s) per coreæ˜¯1ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªç‰©ç†æ ¸å¿ƒå¯¹åº”æœ‰1ä¸ªé€»è¾‘æ ¸å¿ƒã€‚è¿™æ—¶å€™CPU(s)çš„æ•°å€¼å’ŒCPUçš„ç‰©ç†æ ¸å¿ƒæ•°å€¼åº”è¯¥ç›¸ç­‰ã€‚ 12345678910111213141516171819202122232425262728$ lscpuArchitecture: x86_64CPU op-mode(s): 32-bit, 64-bitByte Order: Little EndianCPU(s): 20On-line CPU(s) list: 0-19Thread(s) per core: 1Core(s) per socket: 10Socket(s): 2NUMA node(s): 2Vendor ID: GenuineIntelCPU family: 6Model: 79Model name: Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHzStepping: 1CPU MHz: 1200.036CPU max MHz: 3100.0000CPU min MHz: 1200.0000BogoMIPS: 4400.07Virtualization: VT-xL1d cache: 32KL1i cache: 32KL2 cache: 256KL3 cache: 25600KNUMA node0 CPU(s): 0,2,4,6,8,10,12,14,16,18NUMA node1 CPU(s): 1,3,5,7,9,11,13,15,17,19$ cat /sys/devices/system/cpu/smt/active0 ä½¿ç”¨numastatå‘½ä»¤å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªnodeï¼Œè¡¨æ˜å·²ç»æ‰“å¼€NUMAç­–ç•¥ï¼ŒåŒæ ·çš„è¿˜å¯ä»¥ä½¿ç”¨lscpuå‘½ä»¤æŸ¥çœ‹NUMA node(s)çš„æ•°é‡ã€‚ 12345678$ numastat node0 node1numa_hit 654623151 11334196numa_miss 0 0numa_foreign 0 0interleave_hit 34599 34359local_node 654619810 11281809other_node 3341 52387 2ã€å®‰è£…å¼€å§‹ä¹‹å‰æˆ‘ä»¬éœ€è¦ä½¿ç”¨yumå®‰è£…ä¸€äº›ç¼–è¯‘å®‰è£…çš„æ—¶å€™éœ€è¦ä½¿ç”¨çš„å·¥å…·å’Œè½¯ä»¶ 123456789101112131415161718$ yum group install &quot;Development Tools&quot;$ yum install patch libnuma* numactl numactl-devel kernel-devel openssl* popt* -y# 2021-0722æ›´æ–°ï¼Œcentos7.9ç³»ç»Ÿéœ€è¦å®‰è£…$ yum install libpcap-devel -y# 2021-0722æ›´æ–°ï¼Œéœ€è¦æ”¯æŒipv6éœ€è¦å®‰è£…libnl3-devel# *** WARNING - this build will not support IPVS with IPv6. Please install libnl/libnl-3 dev libraries to support IPv6 with IPVS.$ yum install libnl3-devel -y# æ³¨æ„kernelä»¥åŠç›¸åº”çš„kernelç»„ä»¶çš„ç‰ˆæœ¬éœ€è¦å’Œç°åœ¨ä½¿ç”¨çš„kernelç‰ˆæœ¬ç›¸å¯¹åº”$ rpm -qa | grep kernel | grep &quot;3.10.0-1127.19.1&quot; | sortkernel-3.10.0-1127.19.1.el7.x86_64kernel-debug-devel-3.10.0-1127.19.1.el7.x86_64kernel-devel-3.10.0-1127.19.1.el7.x86_64kernel-headers-3.10.0-1127.19.1.el7.x86_64kernel-tools-3.10.0-1127.19.1.el7.x86_64kernel-tools-libs-3.10.0-1127.19.1.el7.x86_64$ uname -r3.10.0-1127.19.1.el7.x86_64 è¿™æ—¶å€™éœ€è¦æœºå™¨èƒ½å¤Ÿè¿æ¥å¤–ç½‘ï¼ˆäº’è”ç½‘ï¼‰ï¼Œç›´æ¥ä»githubå°†dpvsé¡¹ç›®cloneä¸‹æ¥ï¼ŒåŒæ—¶è¿˜éœ€è¦ä¸‹è½½ç‰¹å®šç‰ˆæœ¬çš„dpdkï¼Œæ— æ³•è”ç½‘çš„æœºå™¨ä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ä¹‹åä¼ è¾“åˆ°æœåŠ¡å™¨ä¸­ï¼Œåç»­çš„å®‰è£…è¿‡ç¨‹å¹¶ä¸éœ€è¦è”ç½‘ 1234567# é¦–å…ˆæˆ‘ä»¬ä»GitHubä¸Šé¢æŠŠdpvsæ•´ä¸ªé¡¹ç›®cloneä¸‹æ¥$ cd /home/$ git clone https://github.com/iqiyi/dpvs.git$ cd /home/dpvs# ç„¶åæˆ‘ä»¬ä¸‹è½½ç‰¹å®šç‰ˆæœ¬çš„dpdkå¹¶è§£å‹$ wget https://fast.dpdk.org/rel/dpdk-17.11.2.tar.xz$ tar vxf dpdk-17.11.2.tar.xz æ¥ä¸‹æ¥éœ€è¦å¯¹dpdkè¿›è¡Œæ‰“è¡¥ä¸ï¼Œæ³¨æ„è¿™é‡Œçš„è¡¥ä¸å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚ 12345678910$ cd /home/dpvs$ cp patch/dpdk-stable-17.11.2/*.patch dpdk-stable-17.11.2/$ cd dpdk-stable-17.11.2/# 0001å·è¡¥ä¸ä¸»è¦æ˜¯ç”¨äºåœ¨kniç½‘å¡ä¸Šå¼€å¯ç¡¬ä»¶å¤šæ’­åŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨kniè®¾å¤‡ä¸Šå¯åŠ¨ospfd$ patch -p 1 &lt; 0001-kni-use-netlink-event-for-multicast-driver-part.patch# patching file lib/librte_eal/linuxapp/kni/kni_net.c# 0002å·è¡¥ä¸ä¸»è¦æ˜¯ä½¿ç”¨dpvsçš„UOAæ¨¡å—çš„æ—¶å€™éœ€è¦ç”¨åˆ°$ patch -p 1 &lt; 0002-net-support-variable-IP-header-len-for-checksum-API.patch# patching file lib/librte_net/rte_ip.h ç¼–è¯‘dpdk1234$ cd /home/dpvs/dpdk-stable-17.11.2$ make config T=x86_64-native-linuxapp-gcc# Configuration done using x86_64-native-linuxapp-gcc$ make å¦‚æœå‡ºç°ä¸‹é¢çš„é—®é¢˜ æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ›´æ”¹æ–‡ä»¶ï¼Œè§£å†³æ–¹æ¡ˆå‚è€ƒè¿™é‡Œï¼š ç”¨find / -name netdevice.h æŸ¥æ‰¾å†…æ ¸ä¸­çš„å¤´æ–‡ä»¶ï¼Œæ‰¾åˆ°struct net_device_ops ä¸­çš„ ndo_change_mtuï¼Œ ä¼šçœ‹åˆ°ndo_change_mtuè¢«æ›¿æ¢æˆå¯¹åº”ç‰ˆæœ¬çš„ndo_change_mtu_rhXX,æ¯”å¦‚ ndo_change_mtu_rh75 å°† /kni_net.c:704:2 ä¸­ ndo_change_mtu ç”¨ ndo_change_mtu_rh75 æ›¿æ¢è¯•è¯•ï¼Ÿ æŸ¥çœ‹å¯¹åº”å†…æ ¸ä¸­çš„æ–‡ä»¶ 12345678910111213141516$ find / -name netdevice.h/usr/include/linux/netdevice.h/usr/src/kernels/3.10.0-1127.19.1.el7.x86_64.debug/include/linux/netdevice.h/usr/src/kernels/3.10.0-1127.19.1.el7.x86_64.debug/include/uapi/linux/netdevice.h/usr/src/kernels/3.10.0-1127.19.1.el7.x86_64/include/linux/netdevice.h/usr/src/kernels/3.10.0-1127.19.1.el7.x86_64/include/uapi/linux/netdevice.h$ grep ndo_change_mtu /usr/src/kernels/3.10.0-1127.19.1.el7.x86_64/include/linux/netdevice.h * int (*ndo_change_mtu)(struct net_device *dev, int new_mtu); int (*ndo_change_mtu)(struct net_device *dev, * int (*ndo_change_mtu)(struct net_device *dev, int new_mtu); RH_KABI_RENAME(int (*ndo_change_mtu), int (*ndo_change_mtu_rh74))(struct net_device *dev, * .ndo_change_mtu_rh74 handler is *not* provided. * both .extended.ndo_change_mtu() as well as .ndo_change_mtu_rh74() are$ grep ndo_change_mtu /home/dpvs/dpdk-stable-17.11.2/lib/librte_eal/linuxapp/kni/kni_net.c .ndo_change_mtu = kni_net_change_mtu, æˆ–è€…å¯¹äºCentOS7.5ä¹‹åçš„ç‰ˆæœ¬å¯ä»¥ç›´æ¥æ‰§è¡Œ 1sed -i &#x27;s/ndo_change_mtu/ndo_change_mtu_rh74/g&#x27; /home/dpvs/dpdk-stable-17.11.2/lib/librte_eal/linuxapp/kni/kni_net.c ç„¶åæˆ‘ä»¬é‡æ–°æ‰§è¡Œmakeæ“ä½œ 123456$ make clean$ make # å‡ºç°ä¸‹é¢å­—æ®µè¯´æ˜makeæˆåŠŸ# Build complete [x86_64-native-linuxapp-gcc]# æ¥ç€è®¾ç½®å˜é‡$ export RTE_SDK=$PWD é…ç½®hugepageå’Œå…¶ä»–çš„ä¸€èˆ¬ç¨‹åºä¸åŒï¼Œdpvsä½¿ç”¨çš„dpdkå¹¶ä¸æ˜¯ä»æ“ä½œç³»ç»Ÿä¸­ç´¢è¦å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨å¤§é¡µå†…å­˜ï¼ˆhugepageï¼‰ï¼Œæå¤§åœ°æé«˜äº†å†…å­˜åˆ†é…çš„æ•ˆç‡ã€‚ å®˜æ–¹çš„é…ç½®è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯2MBçš„å¤§é¡µå†…å­˜ï¼Œè¿™é‡Œçš„8192æŒ‡çš„æ˜¯åˆ†é…äº†8192ä¸ª2MBçš„å¤§é¡µå†…å­˜ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªnodeå¯¹åº”16GBçš„å†…å­˜ï¼Œä¸€å…±åˆ†é…äº†32GBçš„å†…å­˜ï¼Œè¿™é‡Œçš„å†…å­˜å¯ä»¥æ ¹æ®æœºå™¨çš„å¤§å°æ¥è‡ªè¡Œè°ƒæ•´ã€‚ä½†æ˜¯å¦‚æœå°äº1GBå¯èƒ½ä¼šå¯¼è‡´å¯åŠ¨æŠ¥é”™ã€‚ 123456789# for NUMA machine$ echo 8192 &gt; /sys/devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages$ echo 8192 &gt; /sys/devices/system/node/node1/hugepages/hugepages-2048kB/nr_hugepages$ mkdir /mnt/huge$ mount -t hugetlbfs nodev /mnt/huge# éœ€è¦å¼€æœºè‡ªåŠ¨æŒ‚è½½çš„è¯å¯ä»¥åœ¨$ echo &quot;nodev /mnt/huge hugetlbfs defaults 0 0&quot; &gt;&gt; /etc/fstab æŒ‚è½½é©±åŠ¨æ¨¡å—1234$ modprobe uio$ cd /home/dpvs/dpdk-stable-17.11.2$ insmod /home/dpvs/dpdk-stable-17.11.2/build/kmod/igb_uio.ko$ insmod /home/dpvs/dpdk-stable-17.11.2/build/kmod/rte_kni.ko ä½¿ç”¨è„šæœ¬æŸ¥çœ‹ç›®å‰æœºå™¨å’Œdpvså…¼å®¹çš„è®¾å¤‡ï¼Œè¿™é‡Œæˆ‘ä»¬åªæˆªå–éƒ¨åˆ†é‡ç‚¹å†…å®¹ 1234567891011121314151617181920212223242526272829303132333435$ ./usertools/dpdk-devbind.py --status$ ./usertools/dpdk-devbind.py --statusNetwork devices using DPDK-compatible driver============================================&lt;none&gt;Network devices using kernel driver===================================0000:01:00.0 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth0 drv=ixgbe unused=igb_uio0000:01:00.1 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth1 drv=ixgbe unused=igb_uio0000:04:00.0 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth4 drv=ixgbe unused=igb_uio *Active*0000:04:00.1 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth5 drv=ixgbe unused=igb_uio *Active*0000:08:00.0 &#x27;I350 Gigabit Network Connection 1521&#x27; if=eth2 drv=igb unused=igb_uio0000:08:00.1 &#x27;I350 Gigabit Network Connection 1521&#x27; if=eth3 drv=igb unused=igb_uio# å¯¹éœ€è¦ä½¿ç”¨dpvsçš„ç½‘å¡åŠ è½½ç‰¹å®šçš„é©±åŠ¨$ ifconfig eth5 down$ ./usertools/dpdk-devbind.py -b igb_uio 0000:04:00.1# å†æ¬¡æ£€æŸ¥æ˜¯å¦åŠ è½½æˆåŠŸ$ ./usertools/dpdk-devbind.py --statusNetwork devices using DPDK-compatible driver============================================0000:04:00.1 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; drv=igb_uio unused=ixgbeNetwork devices using kernel driver===================================0000:01:00.0 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth0 drv=ixgbe unused=igb_uio0000:01:00.1 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth1 drv=ixgbe unused=igb_uio0000:04:00.0 &#x27;82599ES 10-Gigabit SFI/SFP+ Network Connection 10fb&#x27; if=eth4 drv=ixgbe unused=igb_uio *Active*0000:08:00.0 &#x27;I350 Gigabit Network Connection 1521&#x27; if=eth2 drv=igb unused=igb_uio0000:08:00.1 &#x27;I350 Gigabit Network Connection 1521&#x27; if=eth3 drv=igb unused=igb_uio ç¼–è¯‘å®‰è£…dpvs123456789101112131415161718$ cd /home/dpvs/dpdk-stable-17.11.2/$ export RTE_SDK=$PWD$ cd /home/dpvs/$ make$ make install$ cd bin/$ lsdpip dpvs ipvsadm keepalived$ cp conf/dpvs.conf.single-nic.sample /etc/dpvs.conf$ cd /home/dpvs/bin/$ ./dpvs &amp;# å¦‚æœå®‰è£…æˆåŠŸå¹¶ä¸”æˆåŠŸè¿è¡Œäº†ï¼Œæ‰§è¡Œå‘½ä»¤å°±å¯ä»¥çœ‹åˆ°$ ./dpip link show1: dpdk0: socket 0 mtu 1500 rx-queue 8 tx-queue 8 UP 10000 Mbps full-duplex auto-nego addr 00:1B:21:BE:EA:C2 OF_RX_IP_CSUM OF_TX_IP_CSUM OF_TX_TCP_CSUM OF_TX_UDP_CSUM ä¸ºäº†æ–¹ä¾¿ç®¡ç†å¯ä»¥å°†ç›¸å…³çš„æ“ä½œå‘½ä»¤è½¯é“¾æ¥åˆ°/sbinä¸‹æ–¹ä¾¿å…¨å±€æ‰§è¡Œ 1234ln -s /home/dpvs/bin/dpvs /sbin/dpvsln -s /home/dpvs/bin/dpip /sbin/dpipln -s /home/dpvs/bin/ipvsadm /sbin/ipvsadmln -s /home/dpvs/bin/keepalived /sbin/keepalived","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"},{"name":"lvs","slug":"lvs","permalink":"https://tinychen.com/tags/lvs/"},{"name":"dpdk","slug":"dpdk","permalink":"https://tinychen.com/tags/dpdk/"},{"name":"dpvs","slug":"dpvs","permalink":"https://tinychen.com/tags/dpvs/"}]},{"title":"centos7/8ä¿®æ”¹ç½‘å¡åç§°å¹¶æŒä¹…åŒ–é…ç½®","slug":"20201024-centos8-modify-eth-name","date":"2020-10-25T07:00:00.000Z","updated":"2021-10-16T15:00:00.000Z","comments":true,"path":"20201024-centos8-modify-eth-name/","link":"","permalink":"https://tinychen.com/20201024-centos8-modify-eth-name/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»å°†centos7/8ä¸­å¼•å…¥çš„æ–°ç½‘å¡å‘½åæ–¹å¼ä¿®æ”¹ä¸ºä¼ ç»Ÿçš„ethxå‘½åå¹¶å°†å‘½åå’Œmacåœ°å€è¿›è¡ŒæŒä¹…åŒ–ç»‘å®šçš„æ–¹æ³•","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»å°†centos7/8ä¸­å¼•å…¥çš„æ–°ç½‘å¡å‘½åæ–¹å¼ä¿®æ”¹ä¸ºä¼ ç»Ÿçš„ethxå‘½åå¹¶å°†å‘½åå’Œmacåœ°å€è¿›è¡ŒæŒä¹…åŒ–ç»‘å®šçš„æ–¹æ³• é»˜è®¤æƒ…å†µä¸‹çš„ç½‘å¡åç§°ä¼šæ ¹æ®ç½‘å¡çš„å‹å·å’Œè¿æ¥æ–¹å¼ï¼Œå¦‚USBç½‘å¡ã€PCIeç½‘å¡ç­‰å„ç§æ–¹å¼ä¸åŒè€Œæ˜¾ç¤ºå‡ºä¸åŒçš„åç§°ï¼Œä¾‹å¦‚è¿™é‡Œå°±æ˜¾ç¤ºä¸ºeno1ï¼š 1234[root@tiny-server network-scripts]# nmcli connection showNAME UUID TYPE DEVICEeno1 03043370-9378-4a22-9396-b8f7c83142d5 ethernet eno1virbr0 821ce0c2-56cb-42ce-93c5-4933b9b56841 bridge virbr0 ä¿®æ”¹å†…æ ¸å‚æ•°å¹¶é‡æ–°ç”Ÿæˆgrubå¼•å¯¼æ–‡ä»¶ï¼Œç„¶åé‡æ–°å¯åŠ¨ç³»ç»Ÿ 12345678910#åœ¨å†…æ ¸å¯åŠ¨å‚æ•°ä¸­çš„rhgbå‰æ·»åŠ net.ifnames=0sed -i &#x27;s/rhgb/net.ifnames=0 &amp;/&#x27; /etc/default/grub# ä¿®æ”¹å‰GRUB_CMDLINE_LINUX=&quot;crashkernel=auto resume=/dev/mapper/cl-swap rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quiet&quot;# ä¿®æ”¹åGRUB_CMDLINE_LINUX=&quot;crashkernel=auto resume=/dev/mapper/cl-swap rd.lvm.lv=cl/root rd.lvm.lv=cl/swap net.ifnames=0 rhgb quiet&quot;# é‡æ–°ç”Ÿæˆå¼•å¯¼æ–‡ä»¶ï¼Œæ³¨æ„BIOSå¼•å¯¼å’ŒEFIå¼•å¯¼çš„å¯åŠ¨æ–‡ä»¶ç›®å½•ä¼šä¸ä¸€æ ·grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨grubbyå·¥å…· 1grubby --update-kernel=ALL --args=net.ifnames=0 é‡å¯ç³»ç»Ÿä¹‹ååŸæ¥çš„ç½‘å¡å·²ç»å¤±æ•ˆæ— æ³•ä½¿ç”¨ï¼Œæ­¤æ—¶æ— æ³•æ­£å¸¸è¿æ¥ç½‘ç»œï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨nmcliå·¥å…·æ–°å»ºç½‘å¡ 123456# å…¶ä¸­con-nameä¸ºæ–°å»ºçš„ç½‘å¡åç§°ï¼Œè€Œåé¢çš„ifnameä¸ºå·²æœ‰çš„ç¡¬ä»¶ç½‘å¡åç§°# nmcli connection add type ethernet con-name eth0 ifname eth0# æ–°å»ºåæŸ¥çœ‹å¦‚ä¸‹[root@tiny-server ~]# nmcli connection showNAME UUID TYPE DEVICEeth1 363bd12e-34aa-435d-83db-2e966c50854b ethernet eth1 ä¿®æ”¹ä¸ºä¼ ç»Ÿçš„ethxå‘½åæ–¹å¼ä¹‹åï¼Œå¯¹åº”çš„ethxå’Œç‰©ç†ç½‘å¡å¹¶æ²¡æœ‰ä¸€ä¸€å¯¹åº”çš„å¼ºç»‘å®šå…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯¹eth1ç½‘ç»œè¿›è¡Œé…ç½®å˜æ›´ä¹‹åï¼Œå¯èƒ½æœºå™¨ä¸Šé¢æ–°å¢äº†ä¸€å¼ ç½‘å¡ï¼Œæˆ–è€…æ˜¯åŸæ¥çš„ç½‘å¡çš„pcieæ’æ§½ä½ç½®å˜æ›´äº†ï¼Œéƒ½å¯èƒ½ä¼šå¯¼è‡´eth1ç½‘å¡å¯¹åº”çš„ç‰©ç†ç½‘å¡å‘ç”Ÿå˜åŒ–ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æœ€å¥½æ–¹æ³•å°±æ˜¯å°†åå­—å’Œmacåœ°å€è¿›è¡Œç»‘å®šã€‚ 12345# ä¿®æ”¹ä¸‹é¢çš„è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªï¼Œç„¶åå†™å…¥å¯¹åº”çš„macåœ°å€å’Œç½‘å¡åå­—ï¼Œæœ€åé‡å¯æœºå™¨å³å¯[root@tiny-dpvs ~]# cat /etc/udev/rules.d/70-persistent-net.rulesSUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;11:22:33:44:55:66&quot;, NAME=&quot;eth0&quot;SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;11:22:33:44:55:77&quot;, NAME=&quot;eth1&quot;SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;11:22:33:44:55:88&quot;, NAME=&quot;eth2&quot;","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"é™åˆ¶wsl2å ç”¨è¿‡å¤šå†…å­˜","slug":"20200924-wsl2-limit-memory","date":"2020-09-24T02:00:00.000Z","updated":"2020-09-24T02:00:00.000Z","comments":true,"path":"20200924-wsl2-limit-memory/","link":"","permalink":"https://tinychen.com/20200924-wsl2-limit-memory/","excerpt":"æœ¬æ–‡ä¸»è¦è®°å½•ä½¿ç”¨wsl2é•¿æ—¶é—´å¼€å¯åå ç”¨è¿‡å¤šç³»ç»Ÿå†…å­˜çš„è§£å†³åŠæ³•ã€‚","text":"æœ¬æ–‡ä¸»è¦è®°å½•ä½¿ç”¨wsl2é•¿æ—¶é—´å¼€å¯åå ç”¨è¿‡å¤šç³»ç»Ÿå†…å­˜çš„è§£å†³åŠæ³•ã€‚ 1ã€å‰è¨€å‰å‡ å¤©ç¬”è®°æœ¬ä¸€ç›´æ²¡æœ‰å…³æœºï¼Œåé¢å‘ç°ç³»ç»Ÿå†…å­˜å·²ç»è¢«å æ»¡äº†ï¼Œæˆ‘çš„ç¬”è®°æœ¬æ‰£æ‰æ ¸æ˜¾å†…å­˜å ç”¨ä¹‹åå¯ç”¨å®¹é‡å¤§æ¦‚è¿˜æœ‰15Gå¤šä¸€ç‚¹ï¼Œç”¨ä»»åŠ¡ç®¡ç†å™¨é‡Œé¢æŸ¥çœ‹å‘ç°æ˜¯Vmmemè¿™ä¸ªè¿›ç¨‹å ç”¨äº†å¤§é‡çš„å†…å­˜ï¼Œè¿™ä¸ªå°±æ˜¯wslå¯¹åº”çš„è™šæ‹Ÿæœºè¿›ç¨‹ã€‚ æŸ¥è¯¢äº†ç›¸å…³èµ„æ–™å‘ç°è¿™å¹¶ä¸æ˜¯ä¸ªä¾‹ï¼Œwsl2æœ¬èº«çš„æœºåˆ¶ä¼¼ä¹ä¼šä¸æ–­åœ°æ‹¿å®¿ä¸»æœºçš„å†…å­˜æ¥ç»™è‡ªå·±å½“cacheä½¿ç”¨ï¼Œå¹¶ä¸”æ‹¿äº†è¿˜ä¸è¿˜ï¼Œä¹‹å‰ä½¿ç”¨å°å¼æœºçš„æ—¶å€™æœ‰å…³æœºçš„ä¹ æƒ¯å› æ­¤å¹¶ä¸ä¼šå¤ªæ˜æ˜¾ï¼Œç°åœ¨ä½¿ç”¨ç¬”è®°æœ¬é•¿æ—¶é—´ä¸å…³æœºå°±è§¦å‘äº†è¿™ä¸ªé—®é¢˜ã€‚ç›®å‰æ¥è¯´ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼š é‡å¯wsl2 ä½¿ç”¨.wslconfigæ–‡ä»¶é™åˆ¶èµ„æº è°ƒæ•´å†…æ ¸å‚æ•°å®šæœŸé‡Šæ”¾cacheå†…å­˜ 2ã€é‡å¯wsl2å¦‚æœæˆ‘ä»¬ç›´æ¥å…³é—­wsl2çš„çª—å£å¹¶ä¸ä¼šå…³é—­è¯¥wsl2çš„è™šæ‹Ÿæœºï¼Œå®ƒä¾æ—§ä¼šåœ¨åå°è¿è¡Œï¼Œéœ€è¦å…³é—­wsl2çš„è¯æˆ‘ä»¬å¯ä»¥æ‰“å¼€powershellï¼Œåœ¨é‡Œé¢ä½¿ç”¨wsl --shutdownå‘½ä»¤å°±å¯ä»¥å…³é—­å…¨éƒ¨çš„wsl2è™šæ‹Ÿæœºäº†ã€‚ä¹‹åå†éšæ„æ‰“å¼€ä¸€ä¸ªwsl2çš„çª—å£å°±ä¼šå†æ¬¡å¼€å¯è™šæ‹Ÿæœºã€‚ è¿™ç§æ–¹å¼é‡Šæ”¾å†…å­˜æœ€å½»åº•ï¼Œæ•ˆæœå’Œç‰©ç†æœºå†…å­˜ä¸è¶³å¡æ­»ç„¶åç›´æ¥é‡å¯æ˜¯ä¸€æ ·çš„ã€‚ 3ã€é™åˆ¶wsl2å†…å­˜ä½¿ç”¨è¿™ä¸ªè§£å†³æ–¹æ¡ˆæ¥è‡ªgithubï¼Œç®€å•æ¥è¯´å°±æ˜¯åˆ›å»ºä¸€ä¸ª%UserProfile%\\.wslconfigæ–‡ä»¶æ¥é™åˆ¶wslä½¿ç”¨çš„å†…å­˜æ€»é‡ã€‚æ¯”å¦‚è¯´æˆ‘åœ¨Windowsä¸­ä½¿ç”¨çš„ç”¨æˆ·æ˜¯tinychenï¼Œé‚£ä¹ˆæˆ‘å°±åœ¨C:\\Users\\tinychenä¸­åˆ›å»ºäº†ä¸€ä¸ª.wslconfigæ–‡ä»¶ï¼Œåœ¨é‡Œé¢åŠ å…¥ä»¥ä¸‹å†…å®¹æ¥é™åˆ¶wsl2çš„å†…å­˜æ€»å¤§å°ï¼š 12345[wsl2]processors=8memory=8GBswap=8GBlocalhostForwarding=true æ³¨æ„ä¿®æ”¹å®Œæˆä¹‹åéœ€è¦é‡å¯wsl2æ‰èƒ½ç”Ÿæ•ˆã€‚æ›´å¤šè¯¦ç»†çš„é…ç½®å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ 4ã€å®šæœŸé‡Šæ”¾cacheå†…å­˜Linuxå†…æ ¸ä¸­æœ‰ä¸€ä¸ªå‚æ•°/proc/sys/vm/drop_cachesï¼Œæ˜¯å¯ä»¥ç”¨æ¥æ‰‹åŠ¨é‡Šæ”¾Linuxä¸­çš„cacheç¼“å­˜ï¼Œå¦‚æœå‘ç°wsl2çš„cacheè¿‡å¤§å½±å“åˆ°å®¿ä¸»æœºæ­£å¸¸è¿è¡Œäº†ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥é‡Šæ”¾cacheï¼š 1echo 3 &gt; /proc/sys/vm/drop_caches å½“ç„¶ä¹Ÿå¯ä»¥è®¾ç½®æˆå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´é‡Šæ”¾ä¸€æ¬¡ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"wsl","slug":"wsl","permalink":"https://tinychen.com/tags/wsl/"}]},{"title":"sshå¸¸ç”¨é…ç½®","slug":"20200912-ssh-config-introduction","date":"2020-09-12T02:00:00.000Z","updated":"2020-09-12T02:00:00.000Z","comments":true,"path":"20200912-ssh-config-introduction/","link":"","permalink":"https://tinychen.com/20200912-ssh-config-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦è®°å½•äº†ä¸€äº›Linuxç³»ç»Ÿä¸‹ä½¿ç”¨sshæŒ‡ä»¤çš„æŠ€å·§å’Œsshçš„configæ–‡ä»¶ç®€åŒ–sshæ“ä½œçš„è¿‡ç¨‹ã€‚","text":"æœ¬æ–‡ä¸»è¦è®°å½•äº†ä¸€äº›Linuxç³»ç»Ÿä¸‹ä½¿ç”¨sshæŒ‡ä»¤çš„æŠ€å·§å’Œsshçš„configæ–‡ä»¶ç®€åŒ–sshæ“ä½œçš„è¿‡ç¨‹ã€‚ 1ã€è®¾ç½®æƒé™ä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½ä¼šåœ¨å¯¹åº”çš„å®¶ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª.sshæ–‡ä»¶å¤¹ï¼Œå¦‚tinychenç”¨æˆ·åˆ™ä¸º/home/tinychen/.sshï¼Œè€Œrootç”¨æˆ·åˆ™ä¸º/root/.sshã€‚å¦‚æœæ˜¯æ‰‹åŠ¨åˆ›å»ºçš„.sshæ–‡ä»¶å¤¹ï¼Œè¿˜éœ€è¦æ³¨æ„æƒé™é—®é¢˜ã€‚ä¸€èˆ¬æ¥è¯´.sshæ–‡ä»¶å¤¹çš„æƒé™ä¸º700ï¼Œç§é’¥ä¸º600ï¼Œå…¬é’¥ä¸º644ã€‚ 123456[/home/tinychen]# ls -lA | grep sshdrwx------ 2 tinychen tinychen 4096 Sep 11 15:48 .ssh[/home/tinychen/.ssh]# ls -ltotal 8-rw------- 1 tinychen tinychen 2610 Sep 11 15:48 id_rsa-rw-r--r-- 1 tinychen tinychen 575 Sep 11 15:48 id_rsa.pub 2ã€æŒ‡å®šå¯†é’¥å¯¹äºå¯†é’¥è€Œè¨€ï¼Œä¸€ä¸ªç”¨æˆ·å¯èƒ½ä¼šæœ‰å¤šä¸ªå¯†é’¥ï¼Œå¦‚æœéœ€è¦åœ¨å»ºç«‹sshè¿æ¥çš„æ—¶å€™éœ€è¦æŒ‡å®šæŸä¸ªå¯†é’¥å¯ä»¥ä½¿ç”¨-iå‚æ•° 1ssh -i /home/tinychen/.ssh/id_rsa tinychen@192.168.1.1 3ã€æŒ‡å®šç«¯å£å¦‚æœsshæœåŠ¡å™¨çš„ç«¯å£ä¸æ˜¯é»˜è®¤çš„22ç«¯å£ï¼Œåˆ™åœ¨è¿æ¥çš„æ—¶å€™éœ€è¦ä½¿ç”¨-på‚æ•°æ‰‹åŠ¨æŒ‡å®šç«¯å£ 1ssh -p 23333 tinychen@192.168.1.1 4ã€å¤šè·¯å¤ç”¨å¤šè·¯å¤ç”¨è¿™ä¸ªåŠŸèƒ½å¹¶ä¸ç®—æ˜¯ç½•è§çš„æ–°åŠŸèƒ½ï¼Œå¯¹äºsshä¹Ÿå¯ä»¥å®ç°sshè¿æ¥çš„å¤šè·¯å¤ç”¨ï¼Œå³åœ¨å’Œä¸€å°ä¸»æœºå»ºç«‹sshè¿æ¥ä¹‹åï¼Œå†æ¬¡ä¸è¿™å°ä¸»æœºå»ºç«‹è¿æ¥çš„æ—¶å€™ç›´æ¥å¤ç”¨å·²æœ‰çš„sshè¿æ¥ï¼Œå°±ä¸éœ€è¦å†é‡å¤è¿›è¡Œå¯†ç éªŒè¯ç­‰å„ç§æ“ä½œï¼Œè¿™ç§æ“ä½œåœ¨sshé‡Œé¢ç§°ä¹‹ä¸ºControlMasterã€‚é…ç½®çš„æ–¹æ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ¯ä¸ªç”¨æˆ·å¯¹åº”çš„~/.ssh/ç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ªconfigæ–‡ä»¶ï¼Œå†æ·»åŠ å¯¹åº”çš„é…ç½®ï¼š 12345678Host *# Hostå˜é‡ä¸»è¦ç”¨äºæ§åˆ¶å“ªäº›ä¸»æœºä¼šä½¿ç”¨ä¸‹é¢çš„é…ç½® ControlMaster auto # ControlMasterå˜é‡ç”¨äºæ§åˆ¶æ˜¯å¦å¼€å¯sshçš„å¤šè·¯å¤ç”¨åŠŸèƒ½ ControlPersist 600s # ControlPersistå˜é‡ä¸»è¦ç”¨äºæ§åˆ¶ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œè¿™é‡Œ600så³ä¸º600ç§’ï¼ˆ10åˆ†é’Ÿï¼‰ ControlPath ~/.ssh/%r@%h:%p.socket # ControlPathå˜é‡ç”¨äºå­˜æ”¾å¤ç”¨è¿æ¥æ‰€äº§ç”Ÿçš„socketæ–‡ä»¶çš„è·¯å¾„å’Œå‘½åæ–¹å¼ 5ã€ä»£ç†è½¬å‘sshä¸­çš„ä»£ç†è½¬å‘åŠŸèƒ½ï¼Œåä¸ºagent forwardingï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š å‡è®¾å½“å‰æœ‰ä¸¤å°æœåŠ¡å™¨Aå’ŒBï¼Œä½ ä»è‡ªå·±çš„ç”µè„‘è¿œç¨‹ç™»å½•åˆ°æœåŠ¡å™¨Aï¼Œè¿™æ—¶å€™æƒ³ç›´æ¥åœ¨æœåŠ¡å™¨Aä¸Šé¢ç™»å½•åˆ°æœåŠ¡å™¨Bï¼Œä½†æ˜¯æœåŠ¡å™¨Aä¸Šé¢æ²¡æœ‰èƒ½å¤Ÿç™»å½•åˆ°æœåŠ¡å™¨Bçš„keyï¼Œæ­¤æ—¶åªè¦å¼€å¯ä»£ç†è½¬å‘åŠŸèƒ½ï¼Œå°†è‡ªå·±ç”µè„‘çš„keyè·Ÿéšsshè¿‡ç¨‹ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨Aï¼Œå°±å¯ä»¥ä»æœåŠ¡å™¨Aç™»å½•åˆ°æœåŠ¡å™¨Bäº†ã€‚ å¦‚ä½•éªŒè¯è‡ªå·±çš„é…ç½®æ˜¯å¦ç”Ÿæ•ˆå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ssh-add -Lå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ä¸»æœºæ‰€æ‹¥æœ‰çš„keyã€‚ 12Host * ForwardAgent yes 6ã€ä¿æŒè¿æ¥æœ‰äº›sshæœåŠ¡ç«¯ä¸ºäº†å®‰å…¨ï¼Œåœ¨ä¸€å®šçš„æ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„æ“ä½œï¼Œå°±ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥ã€‚æƒ³è¦å»¶é•¿è¿™ä¸ªæ—¶é—´æˆ‘ä»¬å¯ä»¥è®¾ç½®å®¢æˆ·ç«¯æ¯éš”ä¸€æ®µæ—¶é—´å°±å‘æœåŠ¡å™¨å‘é€æ•°æ®åŒ…æ¥ä¿æŒè¿æ¥ï¼š 12ServerAliveInterval 60ServerAliveCountMax 60 åŒæ ·åœ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯æ·»åŠ ç›¸å…³çš„é…ç½®ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨/etc/ssh/sshd_configæ–‡ä»¶ä¸­ 12ClientAliveInterval 60ClientAliveCountMax 60 å…¶ä¸­ServerAliveIntervalå’ŒClientAliveIntervalè¡¨ç¤ºé—´éš”æ—¶é—´ï¼Œæ¯éš”60så‘é€ä¸€æ¬¡ï¼›ServerAliveCountMaxå’ŒClientAliveCountMaxåˆ™è¡¨ç¤ºå‘é€çš„æœ€å¤§æ¬¡æ•°ï¼Œæœ€å¤šå‘é€60æ¬¡ã€‚å³åœ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´æ²¡æœ‰æ“ä½œçš„æ—¶å€™é‡å¤å‘é€60æ¬¡ï¼Œä¸€å…±60æ¬¡*60ç§’å…±è®¡1å°æ—¶åæ–­å¼€è¿æ¥ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"ssh","slug":"ssh","permalink":"https://tinychen.com/tags/ssh/"}]},{"title":"Windows NTå¯¹åº”ç‰ˆæœ¬","slug":"20200907-windows-nt-version","date":"2020-09-07T07:00:00.000Z","updated":"2020-09-07T07:00:00.000Z","comments":true,"path":"20200907-windows-nt-version/","link":"","permalink":"https://tinychen.com/20200907-windows-nt-version/","excerpt":"æœ¬æ–‡ä¸»è¦è®°å½•å„ä¸ªWindows NTç‰ˆæœ¬å¯¹åº”çš„Windowsç‰ˆæœ¬ã€‚åŸç»´åŸºç™¾ç§‘é“¾æ¥å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚","text":"æœ¬æ–‡ä¸»è¦è®°å½•å„ä¸ªWindows NTç‰ˆæœ¬å¯¹åº”çš„Windowsç‰ˆæœ¬ã€‚åŸç»´åŸºç™¾ç§‘é“¾æ¥å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚ Windows NTï¼Œæ–°æŠ€æœ¯è§†çª—æ“ä½œç³»ç»Ÿï¼ˆWindows New Technologyï¼‰çš„ç®€ç§°ï¼Œæ˜¯ç¾å›½å¾®è½¯å…¬å¸1993å¹´æ¨å‡ºçš„çº¯32ä½æ“ä½œç³»ç»Ÿæ ¸å¿ƒã€‚å…¶åŸºäºOS/2 NTçš„åŸºç¡€æ„é€ ã€‚OS/2æ˜¯ç”±å¾®è½¯å’ŒIBMè”åˆç ”åˆ¶ï¼Œåˆ†ä¸ºå¾®è½¯çš„Microsoft OS/2 NTä¸IBMçš„IBM OS/2ã€‚ç”±äºåŒæ–¹åœ¨åä½œåæ¥ä¸æ¬¢è€Œæ•£ï¼ŒIBMç»§ç»­å‘å¸‚åœºæä¾›å…ˆå‰çš„OS/2ç‰ˆæœ¬ï¼›è€Œå¾®è½¯åˆ™æŠŠOS/2 NTæ”¹åä¸ºWindows NTï¼Œå¹¶åœ¨1988å¹´11æœˆå¼€å§‹äº†å¯¹äºâ€œWinNTâ€ï¼ˆå³ç¬¬ä¸€ä»£çš„Windows NT 3.1ï¼‰çš„äº§å“ç ”å‘ã€‚åœ¨ç ”å‘åˆæœŸï¼ŒWindows NTæ›¾ä¸€åº¦è¢«è®¤ä¸ºå°†ä¼šæ˜¯åŸå…ˆOS/2çš„3.0ç‰ˆæœ¬ï¼Œä½†é¢ä¸–ä¹‹åçš„Windows NTæ˜¯ä¸€ç§çº¯32ä½æ“ä½œç³»ç»Ÿï¼Œé‡‡ç”¨NTæ ¸å¿ƒæŠ€æœ¯ã€‚åæœŸæ›´æ–°çš„Windows NTæ”¯æŒ32ä¸64ä½ä¸¤ç§ç‰ˆæœ¬ã€‚ NTç‰ˆæœ¬ å¸‚åœºåç§° ç‰ˆæœ¬ å‘è¡Œæ—¥æœŸ NT 3.1 Windows NT 3.1 Workstationï¼ˆä»…è¢«å‘½åä¸ºâ€œWindows NTâ€ï¼‰ã€Advanced Server 1993å¹´7æœˆ27æ—¥ NT 3.5 Windows NT 3.5 Workstationã€Advanced Server 1994å¹´9æœˆ5æ—¥ NT 3.51 Windows NT 3.51 Workstationã€æœåŠ¡å™¨ç‰ˆ 1995å¹´5æœˆ30æ—¥ NT 4.0 Windows NT 4.0 Workstationã€æœåŠ¡å™¨ç‰ˆã€Server Enterprise Edition, Terminal Serverã€Embedded 1996å¹´7æœˆ29æ—¥ NT 5.0 Windows 2000 ä¸“ä¸šç‰ˆã€æœåŠ¡å™¨ç‰ˆã€Advanced Serverã€DataCenter Server 2000å¹´2æœˆ17æ—¥ NT 5.1 Windows XP å®¶åº­ç‰ˆã€ä¸“ä¸šç‰ˆã€Media Centerã€Tablet PCã€å…¥é—¨ç‰ˆã€Embeddedã€N 2001å¹´10æœˆ25æ—¥ NT 5.2 Windows XP 64-bit Edition Version 2003ï¼ˆFor IA64ï¼‰ã€ä¸“ä¸šç‰ˆ x64 Editionï¼ˆFor AMD64ï¼‰ IA64: 2003å¹´3æœˆ28æ—¥x64: 2005å¹´4æœˆ25æ—¥ Windows Server 2003 Standardã€ä¼ä¸šç‰ˆã€DataCenterã€Webã€Small Business Server 2003å¹´4æœˆ24æ—¥ Windows Server 2003 R2 Standardã€ä¼ä¸šç‰ˆã€DataCenterã€Webã€Small Business Server 2005å¹´12æœˆ6æ—¥ NT 6.0 Windows Vista å…¥é—¨ç‰ˆã€å®¶åº­æ™®é€šç‰ˆã€å®¶åº­é«˜çº§ç‰ˆã€å•†ä¸šç‰ˆã€ä¼ä¸šç‰ˆã€æ——èˆ°ç‰ˆ 2007å¹´1æœˆ30æ—¥ Windows Server 2008 Foundationã€Standardã€ä¼ä¸šç‰ˆã€Datacenterã€Web Serverã€HPC Serverã€Itanium-Based Systems 2008å¹´8æœˆ27æ—¥ 6001ï¼ˆRTMï¼‰6002ï¼ˆSP2ï¼‰ NT 6.1 Windows 7 å…¥é—¨ç‰ˆã€å®¶åº­æ™®é€šç‰ˆã€å®¶åº­é«˜çº§ç‰ˆã€ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆã€æ——èˆ°ç‰ˆ 2009å¹´10æœˆ22æ—¥ Windows Server 2008 R2 Foundationã€Standardã€ä¼ä¸šç‰ˆã€Datacenterã€Web Serverã€HPC Serverã€Itanium-Based Systems 2009å¹´10æœˆ22æ—¥ 7600ï¼ˆRTMï¼‰7601ï¼ˆSP1ï¼‰ NT 6.2 Windows 8 Windows 8ã€ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆã€Windows RT 2012å¹´10æœˆ26æ—¥ Windows Phone 8 ä¸é€‚ç”¨ 2012å¹´10æœˆ30æ—¥ 9200 Windows Server 2012 Foundationã€Essentialsã€Standardã€Datacenter 2012å¹´9æœˆ4æ—¥ 9200 NT 6.3 Windows 8.1 Windows 8.1ã€ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆã€Windows RT 8.1 2013å¹´10æœˆ18æ—¥ Windows Server 2012 R2 Essentialsã€Standardã€Datacenter 2013å¹´10æœˆ18æ—¥ 9600 NT 10.0 Windows 10 ä¸ªäººä½¿ç”¨ï¼šå®¶åº­ç‰ˆï¼ˆåŒ…æ‹¬Sæ¨¡å¼çš„å®¶åº­ç‰ˆï¼‰[7]ã€ä¸“ä¸šç‰ˆï¼ˆåŒ…æ‹¬Sæ¨¡å¼çš„ä¸“ä¸šç‰ˆï¼‰[7]ã€ä¸“ä¸šå·¥ä½œç«™ç‰ˆå•†ç”¨ï¼šä¼ä¸šç‰ˆã€æ•™è‚²ç‰ˆã€ä¸“ä¸šæ•™è‚²ç‰ˆï¼ˆåŒ…æ‹¬Sæ¨¡å¼çš„ä¸“ä¸šæ•™è‚²ç‰ˆï¼‰[7]ç§»åŠ¨è®¾å¤‡ï¼šç§»åŠ¨ç‰ˆã€ç§»åŠ¨ä¼ä¸šç‰ˆç‰©è”ç½‘è®¾å¤‡ï¼šWindows 10 IoT 2015å¹´7æœˆ29æ—¥ Windows Server 2016 Essentialsã€Standardã€Datacenter 2016å¹´9æœˆ26æ—¥ 14393ï¼ˆRS1ï¼‰ 16299ï¼ˆRS3ï¼‰ 17134ï¼ˆRS4ï¼‰ Windows Server 2019 Essentialsã€Standardã€Datacenter 2018å¹´10æœˆ2æ—¥ 17763","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"}]},{"title":"xragså‘½ä»¤çš„å¸¸è§ç”¨æ³•","slug":"20200903-linux-xargs-command-introduction","date":"2020-09-03T07:00:00.000Z","updated":"2020-09-03T07:00:00.000Z","comments":true,"path":"20200903-linux-xargs-command-introduction/","link":"","permalink":"https://tinychen.com/20200903-linux-xargs-command-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨xragså‘½ä»¤çš„ä¸€äº›å‚æ•°å’Œå¸¸è§çš„ä½¿ç”¨æ–¹æ³•ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨xragså‘½ä»¤çš„ä¸€äº›å‚æ•°å’Œå¸¸è§çš„ä½¿ç”¨æ–¹æ³•ã€‚ ä½¿ç”¨Linuxå‘½ä»¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ç®¡é“ç¬¦å·|æ¥è¿›è¡Œå‘½ä»¤ä¹‹é—´çš„è¾“å…¥è¾“å‡ºçš„ä¼ é€’ï¼Œä¾‹å¦‚ 1cat example.txt | grep uuid | sort è¿™ä¸€æ¡å‘½ä»¤å°±å¯ä»¥å°†example.txtè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å…¨éƒ¨æ‰“å°åˆ°å±å¹•ä¸Šï¼Œç„¶åä½¿ç”¨grepæ¥æŸ¥æ‰¾å¸¦æœ‰uuidå­—ç¬¦çš„è¡Œï¼Œæ¥ç€ä½¿ç”¨sortå‘½ä»¤æ¥è¿›è¡Œæ’åºï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è¿™æ ·ï¼š 1grep uuid example.txt | sort ä¸¤è€…çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å¯¹äºå¾ˆå¤šå‘½ä»¤æ¥è¯´ç®¡é“ç¬¦å·|å´ä¸ä¸€å®šèƒ½ç”¨ ä¾‹å¦‚æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾æ‰€æœ‰è¿›ç¨‹ä¸­å¸¦æœ‰nginxå…³é”®å­—çš„è¿›ç¨‹å¹¶ä¸”å°†å…¶å…¨éƒ¨killæ‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è·å–åˆ°å¯¹åº”çš„è¿›ç¨‹IDä¿¡æ¯ 123# ps -ef | grep nginx | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27;1224529913 ç†è®ºä¸Šæˆ‘ä»¬åªéœ€è¦å°†å¯¹åº”çš„PIDå…¨éƒ¨killæ‰å°±å¯ä»¥å®Œæˆæ“ä½œï¼Œä½†æ˜¯å´ä¸èƒ½ç›´æ¥ä½¿ç”¨ç®¡é“ç¬¦å·ï¼Œå› ä¸ºkillå‘½ä»¤æ²¡åŠæ³•æ¥æ”¶è¿™æ ·çš„è¾“å…¥ä¿¡æ¯ 12# è¿™æ ·æ“ä½œæ˜¯ä¸è¡Œçš„# ps -ef | grep nginx | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | kill -9 è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨xargså‘½ä»¤æ¥è¿›è¡Œæ“ä½œï¼Œxargså‘½ä»¤ä¼šå°†å‰é¢å‘½ä»¤çš„è¾“å…¥ç»“æœé€ä¸ªä¼ é€’ç»™åé¢çš„killå‘½ä»¤ 1ps -ef | grep nginx | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9 æ¥ç€æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹xargså‘½ä»¤çš„ä½¿ç”¨è¯´æ˜ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041[/root]# xargs --helpUsage: xargs [OPTION]... COMMAND [INITIAL-ARGS]...Run COMMAND with arguments INITIAL-ARGS and more arguments read from input.Mandatory and optional arguments to long options are alsomandatory or optional for the corresponding short option. -0, --null items are separated by a null, not whitespace; disables quote and backslash processing and logical EOF processing -a, --arg-file=FILE read arguments from FILE, not standard input -d, --delimiter=CHARACTER items in input stream are separated by CHARACTER, not by whitespace; disables quote and backslash processing and logical EOF processing -E END set logical EOF string; if END occurs as a line of input, the rest of the input is ignored (ignored if -0 or -d was specified) -e, --eof[=END] equivalent to -E END if END is specified; otherwise, there is no end-of-file string -I R same as --replace=R -i, --replace[=R] replace R in INITIAL-ARGS with names read from standard input; if R is unspecified, assume &#123;&#125; -L, --max-lines=MAX-LINES use at most MAX-LINES non-blank input lines per command line -l[MAX-LINES] similar to -L but defaults to at most one non- blank input line if MAX-LINES is not specified -n, --max-args=MAX-ARGS use at most MAX-ARGS arguments per command line -P, --max-procs=MAX-PROCS run at most MAX-PROCS processes at a time -p, --interactive prompt before running commands --process-slot-var=VAR set environment variable VAR in child processes -r, --no-run-if-empty if there are no arguments, then do not run COMMAND; if this option is not given, COMMAND will be run at least once -s, --max-chars=MAX-CHARS limit length of command line to MAX-CHARS --show-limits show limits on command-line length -t, --verbose print commands before executing them -x, --exit exit if the size (see -s) is exceeded --help display this help and exit --version output version information and exitReport bugs to &lt;bug-findutils@gnu.org&gt;. è¿™é‡Œç€é‡è¯´æ˜å‡ ä¸ªå‚æ•° å‚æ•° ä½œç”¨ -t åœ¨æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ä¹‹å‰å…ˆå°†å…¶æ‰“å°å‡ºæ¥ -a ä»æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–å˜é‡è¿è¡Œå‘½ä»¤è€Œä¸æ˜¯æ ‡å‡†çš„è¾“å…¥ -i ä½¿ç”¨{}å¯ä»¥æ›¿æ¢å¯¹åº”çš„å˜é‡ å¯¹äº-iå‚æ•°çš„ä½¿ç”¨å¯èƒ½ä¸å¤ªèƒ½ç†è§£ï¼Œæˆ‘ä»¬ä¸¾ä¾‹è¿›è¡Œè¯´æ˜ï¼š å‡è®¾æˆ‘ä»¬éœ€è¦å¯¹å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰txtæ–‡ä»¶è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¯¹äºæ–‡ä»¶ä¸­å«æœ‰tinychenå…³é”®å­—çš„æ–‡ä»¶åå…¨éƒ¨æ·»åŠ ä¸€ä¸ªownçš„åç¼€ 1grep tinychen *.log 2&gt;/dev/null | awk -F : &#x27;&#123;print $1&#125;&#x27; | sort | uniq | xargs -t -i mv &#123;&#125; &#123;&#125;.own å¯¹äºä¸Šé¢çš„è¿™ä¸ªå‘½ä»¤ä¸­ä½¿ç”¨äº†-iå‚æ•°ä¹‹åï¼Œä¼šå°†å‰é¢è¯»å–åˆ°çš„è¾“å…¥ä¸&#123;&#125;ç›¸å…³è”ï¼Œå¯¹äºä½¿ç”¨åƒmvè¿™æ ·çš„éœ€è¦è¾“å…¥ä¸æ­¢ä¸€ä¸ªå˜é‡çš„å‘½ä»¤çš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ã€‚ å†ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹é¢çš„txtæ–‡ä»¶ï¼Œå°†æ‰€æœ‰å¸¦æœ‰192.168.192.168å­—æ®µçš„è¡Œæ³¨é‡Šæ‰ 1cat *.txt 2&gt;/dev/null | grep 192.168.192.168 | xargs -t -i sed -i &#x27;s/&#123;&#125;/#&#123;&#125;/g&#x27; *.txt","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"bash","slug":"bash","permalink":"https://tinychen.com/tags/bash/"},{"name":"shell","slug":"shell","permalink":"https://tinychen.com/tags/shell/"}]},{"title":"Megacliå¸¸ç”¨å‘½ä»¤æ•´ç†","slug":"20200902-megacli-command-introduction","date":"2020-09-02T07:00:00.000Z","updated":"2020-09-02T07:00:00.000Z","comments":true,"path":"20200902-megacli-command-introduction/","link":"","permalink":"https://tinychen.com/20200902-megacli-command-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»Megacliå·¥å…·çš„å¸¸ç”¨å‘½ä»¤","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»Megacliå·¥å…·çš„å¸¸ç”¨å‘½ä»¤ MegaCli æ˜¯LSIå…¬å¸å®˜æ–¹æä¾›çš„SCSIå¡ç®¡ç†å·¥å…·è½¯ä»¶ï¼Œåæ¥ç»è¿‡ä¸€ç³»åˆ—çš„æ”¶è´­åˆå¹¶ç­‰æ“ä½œï¼Œç°åœ¨çš„LSIå±äºåšé€šå…¬å¸æ——ä¸‹çš„äº§å“ï¼Œå› æ­¤å¦‚æœéœ€è¦ä¸‹è½½MegaCliçš„è¯å¯ä»¥å‰å¾€åšé€šå®˜ç½‘ä¸‹è½½ã€‚ MegaCliå·¥å…·ä¸€èˆ¬åœ¨/opt/MegaRAID/MegaCli/MegaCli64ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨MegaCliï¼Œä¸€èˆ¬æ¥è¯´ä¸¤è€…æ˜¯ä¸€æ ·çš„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -Lall -aALL# æŸ¥çœ‹æ‰€æœ‰é˜µåˆ—å¡çš„æ‰€æœ‰é˜µåˆ—é€»è¾‘å·çš„æ‰€æœ‰ä¿¡æ¯/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -Lall -a0 | grep -i &quot;Virtual Disk&quot;# æŸ¥çœ‹ç¬¬1å¼ é˜µåˆ—å¡ä¸Šä¸€å…±æœ‰å¤šå°‘ä¸ªraidé˜µåˆ—ç»„ï¼ˆé»˜è®¤ä»0å¼€å§‹è®¡æ•°ï¼‰/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -L0 -a0# æŸ¥çœ‹ç¬¬1å¼ é˜µåˆ—å¡ä¸Šçš„ç¬¬0ä¸ªraidé˜µåˆ—ç»„çš„ä¿¡æ¯ï¼ˆé»˜è®¤ä»0å¼€å§‹è®¡æ•°ï¼‰/opt/MegaRAID/MegaCli/MegaCli64 -LDPdInfo -aAll# æŸ¥çœ‹æ‰€æœ‰é˜µåˆ—å¡çš„æ‰€æœ‰é˜µåˆ—é€»è¾‘å·çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆåŒ…æ‹¬é˜µåˆ—é€»è¾‘å·å¯¹åº”çš„ç‰©ç†ç¡¬ç›˜ï¼‰/opt/MegaRAID/MegaCli/MegaCli64 -AdpAllInfo -aALL# æ˜¾ç¤ºæ‰€æœ‰é˜µåˆ—å¡ä¿¡æ¯,å¯ä»¥æŸ¥çœ‹æœºå™¨ä¸Šä¸€å…±æœ‰å¤šå°‘å¼ é˜µåˆ—å¡ä»¥åŠæ¯å¼ å¡çš„è¯¦ç»†ä¿¡æ¯/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aALL# æŸ¥çœ‹æ‰€æœ‰é˜µåˆ—å¡ä¸Šçš„æ‰€æœ‰ç‰©ç†ç¡¬ç›˜ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‹å·ã€æ¥å£ã€SNç ã€éƒ¨åˆ†SMARTä¿¡æ¯ç­‰/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r5 [32:2,32:3,32:4] WB Direct -Hsp[32:4] -a0# åœ¨ç¬¬1å¼ é˜µåˆ—å¡ä¸Šåˆ›å»ºä¸€ä¸ª raid5 é˜µåˆ—ï¼Œç”±ç‰©ç†ç›˜ 1,2,3 æ„æˆï¼Œè¯¥é˜µåˆ—çš„çƒ­å¤‡ç›˜æ˜¯ç‰©ç†ç›˜ 4# æ³¨æ„è¿™é‡Œçš„32:2æŒ‡çš„æ˜¯ä½¿ç”¨eIDå’Œslot IDå¯¹ä¸€ä¸ªé˜µåˆ—å¡ä¸‹çš„ç¡¬ç›˜è¿›è¡Œå®šä½ï¼ˆé»˜è®¤ä»0å¼€å§‹è®¡æ•°ï¼‰/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r5 [32:2,32:3,32:4] WB Direct -a0# åŒä¸Šï¼Œåˆ›å»ºä¸€ä¸ª raid5 é˜µåˆ—ï¼Œä½†æ˜¯ä¸æŒ‡å®šçƒ­å¤‡ç›˜/opt/MegaRAID/MegaCli/MegaCli64 -LDRecon -Start -r5 -Add -PhysDrv[32:5] -L1 -a0# åœ¨çº¿æ·»åŠ ç‰©ç†ç¡¬ç›˜åˆ°æŸä¸ªé˜µåˆ—ä¸­/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdDel -L1 -a0# åˆ é™¤ç¬¬1å¼ é˜µåˆ—å¡ä¸Šçš„ç¬¬2ä¸ªraidé˜µåˆ—ï¼ˆé»˜è®¤ä»0å¼€å§‹è®¡æ•°ï¼‰/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -ShowProg -LALL -aALL# é˜µåˆ—åˆ›å»ºå®Œåï¼Œä¼šæœ‰ä¸€ä¸ªåˆå§‹åŒ–åŒæ­¥å—çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹çœ‹å…¶è¿›åº¦/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -ProgDsply -LALL -aALL# åŒä¸Šï¼Œä½†æ˜¯ä»¥åŠ¨æ€å¯è§†åŒ–æ–‡å­—ç•Œé¢æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯/opt/MegaRAID/MegaCli/MegaCli64 -LDBI -ShowProg -LALL -aALL# æŸ¥çœ‹é˜µåˆ—åå°åˆå§‹åŒ–è¿›åº¦/opt/MegaRAID/MegaCli/MegaCli64 -LDBI -ProgDsply -LALL -aALL# åŒä¸Šï¼Œä»¥åŠ¨æ€å¯è§†åŒ–æ–‡å­—ç•Œé¢æ˜¾ç¤º/opt/MegaRAID/MegaCli/MegaCli64 -PDHSP -Set [-EnclAffinity] [-nonRevertible] -PhysDrv[32:7] -a0# æŒ‡å®šç¬¬1å¼ é˜µåˆ—å¡çš„ç¬¬8å—ç›˜ä½œä¸ºå…¨å±€çƒ­å¤‡ ï¼ˆé»˜è®¤ä»0å¼€å§‹è®¡æ•°ï¼‰/opt/MegaRAID/MegaCli/MegaCli64 -PDHSP -Set [-Dedicated [-Array1]] [-EnclAffinity] [-nonRevertible] -PhysDrv[32:7] -a0# åŒä¸Šï¼ŒæŒ‡å®šä¸ºæŸä¸ªé˜µåˆ—çš„ä¸“ç”¨çƒ­å¤‡/opt/MegaRAID/MegaCli/MegaCli64 -PDHSP -Rmv -PhysDrv[32:7] -a0# åˆ é™¤å…¨å±€çƒ­å¤‡ç›˜/opt/MegaRAID/MegaCli/MegaCli64 -PDOffline -PhysDrv [32:2] -a0# å°†æŸå—ç‰©ç†ç›˜ä¸‹çº¿ï¼ˆofflineï¼‰/opt/MegaRAID/MegaCli/MegaCli64 -PDOnline -PhysDrv [32:2] -a0# å°†æŸå—ç‰©ç†ç›˜ä¸‹çº¿ï¼ˆonlineï¼‰/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -PhysDrv [32:2] -a0# æ¢ç›˜åæŸ¥çœ‹ç‰©ç†ç£ç›˜é‡å»ºè¿›åº¦/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ProgDsply -PhysDrv [32:2] -a0# ä»¥åŠ¨æ€å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹ç‰©ç†ç£ç›˜é‡å»ºè¿›åº¦/opt/MegaRAID/MegaCli/MegaCli64 -FwTermLog -Dsply -aALL# æŸ¥çœ‹raidå¡æ—¥å¿—ï¼Œæ³¨æ„æ—¥å¿—çš„è¾“å‡ºé‡å¯èƒ½è¾ƒå¤§ï¼Œé˜µåˆ—å¡å¯¹åº”çš„ç»„å»ºé˜µåˆ—ç­‰æ“ä½œçš„è¯¦ç»†ä¿¡æ¯éƒ½å¯ä»¥åœ¨æ—¥å¿—ä¸­æŸ¥çœ‹/opt/MegaRAID/MegaCli/MegaCli64 -cfgdsply -aALL# æ˜¾ç¤ºRaidå¡å‹å·ï¼ŒRaidè®¾ç½®ï¼ŒDiskç›¸å…³ä¿¡æ¯/opt/MegaRAID/MegaCli/MegaCli64 -adpCount# æ˜¾ç¤ºé€‚é…å™¨ä¸ªæ•°ï¼Œåªèƒ½æŸ¥çœ‹æœºå™¨ä¸Šä¸€å…±æœ‰å¤šå°‘å¼ é˜µåˆ—å¡ï¼Œä¸èƒ½æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯/opt/MegaRAID/MegaCli/MegaCli64 -AdpGetTime â€“aALL# æ˜¾ç¤ºé€‚é…å™¨æ—¶é—´/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -aAll# æŸ¥çœ‹BBUçš„è¯¦ç»†ä¿¡æ¯/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuStatus - aALL |grep &#x27;Charger Status&#x27; # æŸ¥çœ‹BBUç”µæ± çš„å……ç”µçŠ¶æ€/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuStatus -aALL# æ˜¾ç¤ºBBUçŠ¶æ€ä¿¡æ¯/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuCapacityInfo -aALL# æ˜¾ç¤ºBBUå®¹é‡ä¿¡æ¯/opt/MegaRAID/MegaCli/ MegaCli64 -AdpBbuCmd -GetBbuDesignInfo -aALL# æ˜¾ç¤ºBBUè®¾è®¡å‚æ•°/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuProperties -aALL# æ˜¾ç¤ºå½“å‰BBUå±æ€§","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"harddisk","slug":"harddisk","permalink":"https://tinychen.com/tags/harddisk/"}]},{"title":"ä½¿ç”¨nginx-quicæ”¯æŒHTTP/3","slug":"20200821-nginx-quic-compile-to-implement-http3","date":"2020-08-21T07:00:00.000Z","updated":"2021-11-03T10:00:00.000Z","comments":true,"path":"20200821-nginx-quic-compile-to-implement-http3/","link":"","permalink":"https://tinychen.com/20200821-nginx-quic-compile-to-implement-http3/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨nginx-quicå’Œboringsslé¡¹ç›®æ¥å¯¹æœåŠ¡å™¨è¿›è¡Œå‡çº§æ”¯æŒHTTP/3åè®®ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨nginx-quicå’Œboringsslé¡¹ç›®æ¥å¯¹æœåŠ¡å™¨è¿›è¡Œå‡çº§æ”¯æŒHTTP/3åè®®ã€‚ 1ã€èƒŒæ™¯ä»‹ç»nginxå®˜æ–¹ä»1.19ç‰ˆæœ¬å¼€å§‹ï¼Œæ–°å»ºç«‹äº†ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸“é—¨ç”¨æ¥å¯¹QUICè¿›è¡Œæ”¯æŒï¼Œå®˜ç½‘çš„é“¾æ¥ç‚¹è¿™é‡Œã€‚æ³¨æ„è¯¥é¡¹ç›®è¿˜å¤„äºæ—©æœŸçš„alphaç‰ˆæœ¬ï¼Œéå¸¸ä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ The code is at an early alpha level of quality and should not be used in production. nginx-quicçš„å®‰è£…åŒ…å¯ä»¥åœ¨ä¸‹é¢è¿™é‡Œæ‰¾åˆ°ï¼Œç”±äºè¿˜å¤„äºå¼€å‘é˜¶æ®µï¼Œé¡¹ç›®æ›´æ–°å¾—éå¸¸å¿«ã€‚ 1https://hg.nginx.org/nginx-quic/shortlog/quic ä»å®˜ç½‘çš„readmeæ–‡ä»¶æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œæˆªæ­¢åˆ°2020å¹´8æœˆ21æ—¥ï¼Œnginx-quicé¡¹ç›®ç›®å‰åªæ”¯æŒh3-27ã€h3-28ã€h3-29ä¸‰ä¸ªç‰ˆæœ¬ï¼Œå†æ—©æœŸçš„è‰æ¡ˆç‰ˆæœ¬å¹¶ä¸æ”¯æŒï¼Œä¸è¿‡ç›®å‰æ›´æ–°çš„é€Ÿåº¦éå¸¸å¿«ï¼Œå˜åŠ¨ä¹Ÿå¾ˆå¤§ã€‚ Currently we support IETF-QUIC draft-27, draft-28, draft-29.Earlier drafts are NOT supported as they have incompatible wire format. è€ƒè™‘åˆ°æµè§ˆå™¨çš„å…¼å®¹æ€§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸»è¦åŸºäºh3-27ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ã€‚ åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯opensslå®˜æ–¹ç‰ˆæœ¬ç›®å‰å¹¶ä¸æ”¯æŒquicåè®®ï¼Œå®˜æ–¹äº2020å¹´2æœˆç»™å‡ºçš„åŸå› æ˜¯ç›®å‰quicå¹¶ä¸ç¨³å®šï¼Œè¿˜æœ‰å¾ˆå¤šç‰ˆæœ¬éœ€è¦è¿­ä»£ç¡®å®šï¼Œå®ƒä»¬éœ€è¦ä¼˜å…ˆæŠŠç²¾åŠ›æ”¾åœ¨openssl3.0ç‰ˆæœ¬çš„å¼€å‘ä¸Šï¼Œç­‰åˆ°openssl3.0ç‰ˆæœ¬å¼€å‘å®Œæˆäº†å†æ¥è¿›è¡Œquicçš„æ”¯æŒã€‚ So in conclusion; QUIC is on our minds, but it will not be included in the OpenSSL 3.0 release. We expect more tangible action to happen after weâ€™ve released OpenSSL 3.0. æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦ç”¨åˆ°è°·æ­Œè‡ªå·±ä½¿ç”¨çš„opensslåˆ†æ”¯ç‰ˆæœ¬boringsslï¼Œè¿™æ˜¯è°·æ­Œå¯¹åº”çš„å¼€æºçš„è‡ªç”¨çš„opensslç‰ˆæœ¬ï¼Œè°·æ­Œå®˜æ–¹è¡¨ç¤ºboringsslè¿™ä¸ªé¡¹ç›®è™½ç„¶å¼€æºäº†ï¼Œä½†æ˜¯å¹¶ä¸å»ºè®®å¤§å®¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šå¹¿æ³›ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯æ ¹æ®è°·æ­Œè‡ªèº«çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´çš„ï¼Œæœ‰äº›APIå¯èƒ½å¹¶ä¸ç¨³å®šã€‚ åç»­æ›´æ–°ï¼š2021å¹´5æœˆä»½ï¼ŒRFC 9000æ­£å¼å‘å¸ƒäº†HTTP3-QUICã€‚ rfc9000 (ietf.org) 2ã€ç¼–è¯‘å®‰è£…nginx-quicè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†CentOS7æ¥è¿›è¡Œç¼–è¯‘å®‰è£… 123456[root@tiny-centos7 nginx-quic-quic]# lsb_release -aLSB Version: :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarchDistributor ID: CentOSDescription: CentOS Linux release 7.9.2009 (Core)Release: 7.9.2009Codename: Core é¦–å…ˆæˆ‘ä»¬åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨yumå®‰è£…åŸºæœ¬çš„ç¼–è¯‘å·¥å…·ï¼Œæ³¨æ„æ­¤æ¬¡ä½¿ç”¨çš„å¾ˆå¤šè½¯ä»¶å·¥å…·å’Œä¾èµ–éƒ½æ˜¯éœ€è¦è¾ƒæ–°ç‰ˆæœ¬çš„ï¼Œå› æ­¤åé¢ä¼šè¿›è¡Œå¤§é‡çš„ç¼–è¯‘å®‰è£…ï¼Œè¯·ç¡®ä¿æœºå™¨æ‹¥æœ‰è¶³å¤Ÿçš„æ€§èƒ½ï¼ˆå¯èƒ½éœ€è¦ç¼–è¯‘gccï¼‰å’Œè‰¯å¥½çš„ç½‘ç»œã€‚ä¸»è¦éœ€è¦ä½¿ç”¨åˆ°çš„å·¥å…·è½¯ä»¶çš„å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š 2.1 yumå®‰è£…ä¾èµ–éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œå®‰è£…æ‰€éœ€è¦çš„è½¯ä»¶å¾ˆå¤šï¼Œè¿™é‡Œå¹¶ä¸èƒ½å…¨éƒ¨åˆ—å‡ºæ¥ï¼Œä½†æ˜¯é™¤äº†åˆ—å‡ºæ¥çš„è½¯ä»¶å¯¹æ–°ç‰ˆæœ¬æœ‰è¦æ±‚å¤–ï¼Œåˆ«çš„éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨yumè¿›è¡Œå®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±æ ¹æ®éœ€è¦ç¼–è¯‘å®‰è£…æ–°ç‰ˆæœ¬ã€‚ 1sudo yum group install &quot;Development Tools&quot; éœ€è¦æ³¨æ„çš„æ˜¯ç½‘ä¸Šæœ‰éƒ¨åˆ†æ•™ç¨‹ä¼šè®©æˆ‘ä»¬å»å®‰è£…build-essentialï¼Œè€Œè¿™ä¸ªå¥—ä»¶åœ¨centosä¸­æ˜¯ä¸å­˜åœ¨çš„ï¼Œæˆ‘ä»¬ç›´æ¥å®‰è£…Development Toolså¥—ä»¶å³å¯ 2.2 ç¼–è¯‘å®‰è£…cmakecmakeçš„ç‰ˆæœ¬å¿…é¡»è¦åœ¨3.0ä»¥ä¸Šï¼Œcmakeå¯ä»¥åˆ°è¿™é‡Œä¸‹è½½https://cmake.org/download/ã€‚ 12345678wget https://github.com/Kitware/CMake/releases/download/v3.18.2/cmake-3.18.2.tar.gztar -zxvf cmake-3.18.2.tar.gz./bootstrapgmakemakemake installcmake --version 2.3 ç¼–è¯‘å®‰è£…perlperlçš„å®‰è£…åŒ…å¯ä»¥ä»è¿™é‡Œwww.cpan.org/srcä¸‹è½½ã€‚perlçš„ç‰ˆæœ¬éœ€è¦å°½å¯èƒ½æ–°ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯5.32.0çš„ç¨³å®šç‰ˆæœ¬ï¼ˆæˆªæ­¢2020-08-21ï¼‰ 123456789101112131415161718192021wget https://www.cpan.org/src/5.0/perl-5.32.0.tar.gztar -zxvf perl-5.32.0.tar.gzcd perl-5.32.0/./Configure -des -Dprefix=/usr/local/perlmake -j8make testmake install# æ³¨æ„æœ€åæ£€æŸ¥ä¸€ä¸‹ç³»ç»Ÿé»˜è®¤çš„perlæ˜¯å¦ä¸ºæˆ‘ä»¬æ–°å®‰è£…çš„perlperl -v# å¦‚æœä¸æ˜¯åˆ™éœ€è¦è¿›è¡Œä¿®æ”¹# æŸ¥çœ‹é»˜è®¤çš„perlwhich perl | xargs file# æ›¿æ¢æ–°å®‰è£…çš„perlå’ŒåŸæ¥çš„perlmv /usr/bin/perl /usr/bin/perl.5.16.3# éœ€è¦æ³¨æ„æ–°å®‰è£…çš„perlç›®å½•è¦æ ¹æ®å‰é¢ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šçš„ç›®å½•æ¥ç¡®å®šln -s /usr/local/perl/bin/perl /usr/bin/perl# å†æ¬¡æ£€æŸ¥perl -v 2.4 å®‰è£…golanggolangçš„å®‰è£…é…ç½®æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä»https://golang.org/dlç›´æ¥ä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬å³å¯ã€‚ 1234wget https://golang.org/dl/go1.15.linux-amd64.tar.gztar -zxvf go1.15.linux-amd64.tar.gz -C /usr/local# ä¿®æ”¹ç³»ç»Ÿé»˜è®¤çš„goæ–‡ä»¶ln -s /usr/local/go/bin/go /usr/bin/go æ¥ä¸‹æ¥çš„goç¯å¢ƒå˜é‡åŒå­¦ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚è¿›è¡Œé…ç½®ã€‚å¯¹äºæˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘ç›´æ¥åœ¨/etc/profileä¸­æ·»åŠ ä¸‹é¢çš„é…ç½®ç„¶åsourceç”Ÿæ•ˆå³å¯ã€‚ 1234export GOROOT=/usr/local/goexport GOBIN=$GOROOT/binexport PATH=$PATH:$GOBINexport GOPATH=/home/gopath 2.5 ç¼–è¯‘å®‰è£…gccCentOS7é»˜è®¤çš„gccçš„ç‰ˆæœ¬å¤ªæ—§äº†ï¼Œç¼–è¯‘boringsslçš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬æ‰‹åŠ¨ç¼–è¯‘å®‰è£…æ–°ç‰ˆæœ¬çš„gccï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯10.2.0çš„ç‰ˆæœ¬ã€‚gccçš„ç‰ˆæœ¬å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½http://ftp.gnu.org/gnu/gcc/ã€‚ 123456789101112131415161718192021wget http://ftp.gnu.org/gnu/gcc/gcc-10.2.0/gcc-10.2.0.tar.gztar -zxvf gcc-10.2.0.tar.gzcd gcc-10.2.0/# è§£å‹å®Œæˆåéœ€è¦ä¸‹è½½å››ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬æ‰§è¡Œè„šæœ¬å³å¯ç›´æ¥ä¸‹è½½ï¼ŒæœåŠ¡å™¨ç½‘ç»œä¸å¥½çš„åŒå­¦ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸‹è½½./contrib/download_prerequisites# è¿™é‡Œéœ€è¦å¯¹cå’Œc++è¿›è¡Œæ”¯æŒï¼Œä¸ºäº†èŠ‚çœæ—¶é—´ç¦ç”¨æ‰äº†äº¤å‰ç¼–è¯‘./configure -enable-checking=release -enable-languages=c,c++ -disable-multilib# æ¥ä¸‹æ¥è¿™é‡Œéœ€è¦å¾ˆä¹…make -j8make install# å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬éœ€è¦æ›¿æ¢åŸæ¥çš„ccæ–‡ä»¶å’Œc++æ–‡ä»¶ï¼Œç¡®ä¿å®ƒä»¬çš„ç‰ˆæœ¬éƒ½æ˜¯æœ€æ–°çš„ç‰ˆæœ¬# ä¸€èˆ¬æ¥è¯´åŸæ¥ç³»ç»Ÿçš„ccæ–‡ä»¶å’Œc++æ–‡ä»¶éƒ½åœ¨/usr/bin/ç›®å½•ä¸‹ï¼Œè€Œæˆ‘ä»¬ç¼–è¯‘å®‰è£…çš„ccæ–‡ä»¶å’Œc++æ–‡ä»¶åœ¨/usr/local/bin/cd /usr/bin/mv /usr/bin/cc /usr/bin/cc.4.8.5mv /usr/bin/c++ /usr/bin/c++.4.8.5ln -s /usr/local/bin/gcc /usr/bin/ccln -s /usr/local/bin/c++ /usr/bin/c++# æœ€åæ£€æŸ¥ç‰ˆæœ¬/usr/bin/cc -v/usr/bin/c++ -v gccä¸‹è½½çš„ä¾èµ–å†…å®¹å¦‚ä¸‹ï¼Œæœ‰éœ€è¦çš„åŒå­¦è‡ªå– 12345678910[root@TINY-DESKTOP /home/gcc-10.2.0]# ./contrib/download_prerequisites2020-08-21 21:28:24 URL:http://gcc.gnu.org/pub/gcc/infrastructure/gmp-6.1.0.tar.bz2 [2383840/2383840] -&gt; &quot;./gmp-6.1.0.tar.bz2&quot; [1]2020-08-21 21:28:26 URL:http://gcc.gnu.org/pub/gcc/infrastructure/mpfr-3.1.4.tar.bz2 [1279284/1279284] -&gt; &quot;./mpfr-3.1.4.tar.bz2&quot; [1]2020-08-21 21:28:28 URL:http://gcc.gnu.org/pub/gcc/infrastructure/mpc-1.0.3.tar.gz [669925/669925] -&gt; &quot;./mpc-1.0.3.tar.gz&quot; [1]2020-08-21 21:28:30 URL:http://gcc.gnu.org/pub/gcc/infrastructure/isl-0.18.tar.bz2 [1658291/1658291] -&gt; &quot;./isl-0.18.tar.bz2&quot; [1]gmp-6.1.0.tar.bz2: OKmpfr-3.1.4.tar.bz2: OKmpc-1.0.3.tar.gz: OKisl-0.18.tar.bz2: OKAll prerequisites downloaded successfully. 2.6 ç¼–è¯‘å®‰è£…boringsslè°·æ­Œå®˜æ–¹å»ºè®®æˆ‘ä»¬ä½¿ç”¨ninjaæ¥ç¼–è¯‘å®‰è£…boringsslï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…ˆå®‰è£…ä¸€ä¸ªninjaã€‚ 1234wget https://github.com/ninja-build/ninja/releases/download/v1.10.2/ninja-linux.zipunzip ninja-linux.zipcp -r ninja /usr/bin/which ninja 12345678910# boringssl éœ€è¦ libunwind-generic è¿™ä¸ªmoduleçš„æ”¯æŒyum install libunwind-devel libunwind# æ³¨æ„è¿™é‡Œçš„gitä»“åº“å¾ˆå¤§ï¼Œå¤§æ¦‚åœ¨250MBå·¦å³ï¼Œè¯·ç¡®ä¿ç¼–è¯‘å®‰è£…æœåŠ¡å™¨çš„ç½‘ç»œè‰¯å¥½git clone https://github.com/google/boringssl.gitcd boringssl/# å»ºç«‹ä¸€ä¸ªä¸“é—¨ç”¨äºç¼–è¯‘çš„æ–‡ä»¶å¤¹mkdir buildcd buildcmake -GNinja ..ninja æ³¨æ„åœ¨æ‰§è¡Œcmakeè¿™ä¸€æ­¥çš„æ—¶å€™æ­£å¸¸æƒ…å†µä¸‹æ£€æµ‹åˆ°çš„gccæ–‡ä»¶å’Œperlåº“ç‰ˆæœ¬åº”è¯¥æ˜¯æˆ‘ä»¬ä¹‹å‰ç¼–è¯‘å®‰è£…å¥½çš„æ–°ç‰ˆæœ¬ï¼Œå¦‚æœä¸å¯¹çš„è¯éœ€è¦å†æ¬¡æ£€æŸ¥ 12345678910111213141516171819202122# cmake -GNinja ..-- The C compiler identification is GNU 10.2.0-- Detecting C compiler ABI info-- Detecting C compiler ABI info - done-- Check for working C compiler: /usr/bin/cc - skipped-- Detecting C compile features-- Detecting C compile features - done-- The CXX compiler identification is GNU 10.2.0-- Detecting CXX compiler ABI info-- Detecting CXX compiler ABI info - done-- Check for working CXX compiler: /usr/bin/c++ - skipped-- Detecting CXX compile features-- Detecting CXX compile features - done-- Found Perl: /usr/bin/perl (found version &quot;5.32.0&quot;)-- Checking for module &#x27;libunwind-generic&#x27;-- Checking for module &#x27;libunwind-generic&#x27;-- Found libunwind-generic, version 1.2-- The ASM compiler identification is GNU-- Found assembler: /usr/bin/cc-- Configuring done-- Generating done-- Build files have been written to: /root/boringssl/build 2.7 ç¼–è¯‘nginxå‰©ä¸‹çš„nginxçš„ç¼–è¯‘å®‰è£…æ­¥éª¤å°±å’Œæ­£å¸¸çš„nginxç¼–è¯‘å®‰è£…ä¸€è‡´ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæ¨¡å—å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå®‰è£…ï¼Œå¼€å¯HTTP/3æ¨¡å—éœ€è¦ä½¿ç”¨--with-http_v3_module --with-cc-opt=&quot;-I../boringssl-master/include&quot; --with-ld-opt=&quot;-L../boringssl-master/build/ssl -L../boringssl-master/build/crypto&quot;å‚æ•°ã€‚ 1234cd nginx-quic/./auto/configure --prefix=/home/nginx --with-http_ssl_module --with-http_v2_module --with-debug --with-http_v3_module --with-cc-opt=&quot;-I../boringssl/include&quot; --with-ld-opt=&quot;-L../boringssl/build/ssl -L../boringssl/build/crypto&quot; --with-http_v3_module --with-http_quic_module --with-stream_quic_module --build=ngx-quic-tinychen20211103make make install å®‰è£…å®Œæˆåæˆ‘ä»¬æ£€æµ‹nginxçš„å‚æ•°ï¼š 123456[root@tiny-centos7 nginx-quic-quic]# /home/nginx/sbin/nginx -Vnginx version: nginx/1.21.3 (ngx-quic-tinychen20211103)built by gcc 11.2.0 (GCC)built with OpenSSL 1.1.1 (compatible; BoringSSL) (running with BoringSSL)TLS SNI support enabledconfigure arguments: --prefix=/home/nginx --with-http_ssl_module --with-http_v2_module --with-debug --with-http_v3_module --with-cc-opt=-I../boringssl/include --with-ld-opt=&#x27;-L../boringssl/build/ssl -L../boringssl/build/crypto&#x27; --with-http_v3_module --with-http_quic_module --with-stream_quic_module --build=ngx-quic-tinychen20211103 3ã€é…ç½®nginx-quic ç”±äºHTTP/3éœ€è¦ä½¿ç”¨udpåè®®ç«¯å£ï¼Œè¯·æ³¨æ„å¼€æ”¾å¯¹åº”çš„é˜²ç«å¢™ http2ç›‘å¬çš„æ˜¯443çš„tcpç«¯å£ï¼Œè€Œhttp3ç›‘å¬çš„æ˜¯udpç«¯å£ nginxä¸­æ·»åŠ äº†$http3å’Œ$quicå˜é‡ï¼Œå¯ä»¥æ·»åŠ åˆ°æ—¥å¿—ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥çœ‹åˆ°æ˜¯å¦ä½¿ç”¨äº†HTTP/3æ¥è¿›è¡Œè®¿é—®äº† å¦‚æœæœ‰å¤šä¸ªserver_nameï¼Œåœ¨ä¸æŒ‡å®šIPçš„æƒ…å†µä¸‹ï¼Œåªéœ€è¦åœ¨ä»»æ„ä¸€ä¸ªé…ç½®äº†listen 443 http3 quic reuseport;é‚£ä¹ˆå…¶ä»–æ‰€æœ‰server_nameéƒ½ä¼šå¼€å¯HTTP3ï¼Œå¹¶ä¸”ä¸éœ€è¦å†æ·»åŠ è¯¥é…ç½®å¦åˆ™ä¼šæŠ¥é”™ï¼ˆä¸çŸ¥é“åç»­ä¼šä¸ä¼šæŠŠæŠ¥é”™å»æ‰ï¼‰ï¼Œå¦‚æœéœ€è¦éƒ¨åˆ†server_nameå¼€å¯HTTP/3ï¼Œè¯·æŒ‡å®šç›‘å¬IPã€‚ http3å¢åŠ äº†http3_max_field_sizeã€http3_max_table_capacityã€http3_max_blocked_streamsã€http3_max_concurrent_pushesã€ http3_pushã€http3_push_preloadè¿™å…­ä¸ªå˜é‡æ¥æ§åˆ¶http3çš„æ€§èƒ½ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970 server &#123; listen 443 ssl http2; listen 443 http3 quic reuseport; # UDP listener for QUIC+HTTP/3 server_name tinychen.com www.tinychen.com; add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;; resolver 127.0.0.1; ssl_protocols TLSv1.2 TLSv1.3; ssl_ecdh_curve X25519:P-256:P-384; ssl_ciphers TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-256-GCM-SHA384:TLS13-AES-128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-CHACHA20-POLY1305:EECDH+CHACHA20:EECDH+AES128; # è¯¥é€‰é¡¹ç”¨äºå¼€å¯address validationï¼Œä½†æ˜¯ä¼šå’Œ0-RTTå†²çª #quic_retry on; # å¼€å¯ TLS 1.3 0-RTT ssl_early_data on; # æ·»åŠ  Early-Data å¤´å‘ŠçŸ¥åç«¯, é˜²æ­¢é‡æ”¾æ”»å‡» proxy_set_header Early-Data $ssl_early_data; # å‚è€ƒnginxå®˜æ–¹ç›®å‰æ”¯æŒçš„http3ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æ·»åŠ å¯¹åº”çš„header add_header Alt-Svc &#x27;h3-27=&quot;:443&quot;; h3-28=&quot;:443&quot;; h3-29=&quot;:443&quot;; ma=86400; quic=&quot;:443&quot;&#x27;; ...... &#125; server &#123; listen 443 ssl http2; listen 443 http3 quic reuseport; # UDP listener for QUIC+HTTP/3 server_name tinychen.com; #ssl_stapling on; ssl_stapling_verify on; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:1m; ssl_verify_depth 10; ssl_session_timeout 30m; ssl_protocols TLSv1.2 TLSv1.3; ssl_ecdh_curve X25519:P-256:P-384; ssl_ciphers ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256; # æ·»åŠ HSTSé…ç½® add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;; # æ·»åŠ headerå‘ŠçŸ¥æµè§ˆå™¨æ”¯æŒhttp3ï¼Œæ³¨æ„è¿™é‡Œä¸å†éœ€è¦åƒä¹‹å‰çš„è‰ç¨¿ç‰ˆæœ¬http3é‚£æ ·æŒ‡å®šå¦‚h3-27 h3-28 h3-29ç­‰ç‰ˆæœ¬ add_header Alt-Svc &#x27;h3=&quot;:443&quot;; ma=86400&#x27;; # å¼€å¯ TLS 1.3 0-RTT ssl_early_data on; # æ·»åŠ  Early-Data å¤´å‘ŠçŸ¥åç«¯, é˜²æ­¢é‡æ”¾æ”»å‡» proxy_set_header Early-Data $ssl_early_data; ...... location ~ ^/ &#123; root html/; index index.html index.htm; http2_push_preload on; http3_push_preload on; &#125; &#125; ä¿®æ”¹é…ç½®è¿è¡Œä¹‹ååº”è¯¥èƒ½çœ‹åˆ°udpçš„443ç«¯å£è¢«nginxè¿›ç¨‹ç›‘å¬ 123[root@tiny-cloud /home/nginx]# netstat -ntulp | grep 443tcp 0 0 0.0.0.0:443 0.0.0.0:* LISTEN 9730/nginx: masterudp 0 0 0.0.0.0:443 0.0.0.0:* 9730/nginx: master 4ã€æµ‹è¯•ç›®å‰çš„ä¸»æµæµè§ˆå™¨åªæœ‰Firefoxå’ŒChromeæ”¯æŒäº†HTTP/3åè®®ã€‚å¹¶ä¸”ä¸¤è€…æ”¯æŒç¨‹åº¦å¹¶ä¸é«˜ï¼ŒFirefoxæ˜¯é»˜è®¤ç¦ç”¨ï¼ŒChromeæ˜¯é»˜è®¤å¼€å¯éƒ¨åˆ†ï¼Œå› æ­¤é…ç½®èµ·æ¥æœ‰ç‚¹éº»çƒ¦ã€‚ 4.1 HTTP/3 CHECKhttp3check.netç½‘ç«™æä¾›äº†ç½‘ç«™çš„HTTP/3æ”¯æŒæ£€æµ‹ 4.2 Firefoxå¼€å¯HTTP/3å¯¹äºfirefoxè¦æ±‚ç‰ˆæœ¬åœ¨75+ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼š åœ¨firefoxä¸­å¼€å¯http3æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨åœ°å€æ ä¸­è¾“å…¥about:config,ç„¶åæœç´¢http3ï¼Œå°†network.http.http3.enabledè®¾ç½®ä¸ºtrueï¼Œæ¥ç€é‡å¯æµè§ˆå™¨ã€‚ å†æ¬¡è®¿é—®tinychen.comå°±å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†HTTP/3åè®®è¿›è¡Œè®¿é—®ï¼Œåœ¨åå°çš„æ—¥å¿—ä¸­ä¹Ÿèƒ½çœ‹åˆ°å¯¹åº”çš„è¯·æ±‚ä½¿ç”¨äº†quicå’Œh3-27ã€‚ï¼ˆæ—¥å¿—ä¸­çš„IPåœ°å€å·²åšè„±æ•å¤„ç†ï¼‰ã€‚ 1234567891011121314150.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET / HTTP/3 | - | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /css/main.css HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /lib/font-awesome/css/font-awesome.min.css HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /lib/pace/pace-theme-material.min.css HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /lib/pace/pace.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /lib/canvas-nest/canvas-nest.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /lib/anime.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /lib/velocity/velocity.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /lib/velocity/velocity.ui.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /js/utils.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /js/motion.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /js/schemes/pisces.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /js/next-boot.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /js/local-search.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.011 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:14:40:47 +0800] | 200 | tinychen.com | GET /lib/font-awesome/fonts/fontawesome-webfont.woff2?v=4.7.0 HTTP/3 | https://tinychen.com/lib/font-awesome/css/font-awesome.min.css | Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0 | 0.014 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-27 4.3 Chromeå¼€å¯HTTP/3nginxçš„å®˜ç½‘æç¤ºè¯´Chromeéœ€è¦83+ç‰ˆæœ¬æ‰æ”¯æŒHTTP/3ï¼Œå®æµ‹åœ¨éƒ¨åˆ†ç½‘ç«™ï¼ˆå¦‚google.comï¼‰ç¡®å®å¯ä»¥ä½¿ç”¨HTTP/3çš„æŸäº›è‰æ¡ˆç‰ˆæœ¬ï¼Œä½†æ˜¯Chromeç›®å‰æ¥è¯´é»˜è®¤è¿˜æ˜¯ä¸æ”¯æŒh3-27åè®®ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å¼€å¯ã€‚å¯¹äºwindowsç³»ç»Ÿè€Œè¨€ï¼Œæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è¡Œ+æŒ‡å®šå‚æ•°çš„æ–¹å¼å¼€å¯h3-27çš„æ”¯æŒï¼š 12PS C:\\Program Files (x86)\\Google\\Chrome\\Application&gt; .\\chrome.exe --enable-quic --quic-version=h3-27PS C:\\Program Files (x86)\\Google\\Chrome\\Application&gt; .\\chrome.exe --enable-quic --quic-version=h3-27 --origin-to-force-quic-on=tinychen.com:443 ä¸Šé¢ä½¿ç”¨äº†powershellæ¥å¯åŠ¨chromeï¼Œä¸ºäº†ä¿è¯æ•ˆæœï¼Œè¿˜ä½¿ç”¨äº†--origin-to-force-quic-onæ¥å¼ºè¡ŒæŒ‡å®šåŸŸåå’Œç«¯å£ã€‚ æœ¬æ¬¡æµ‹è¯•çš„chromeç‰ˆæœ¬å¦‚ä¸‹ï¼š æµ‹è¯•æ•ˆæœå¦‚ä¸‹ï¼š é™¤äº†æœ¬æ¬¡çš„æµ‹è¯•ç½‘ç«™tinychen.comå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°è°·æ­Œçš„å¤§éƒ¨åˆ†ç½‘ç«™ä¹Ÿéƒ½å¼€å¯äº†HTTP/3ã€‚ åŒæ ·çš„æˆ‘ä»¬åœ¨åå°æ—¥å¿—ä¸­ä¹Ÿèƒ½çœ‹åˆ°å¯¹åº”çš„è®¿é—®æ—¥å¿—ï¼ˆæ—¥å¿—ä¸­çš„IPåœ°å€å·²åšè„±æ•å¤„ç†ï¼‰ï¼š 1234567891011121314150.0.0.0 | [24/Aug/2020:15:01:26 +0800] | 200 | tinychen.com | GET / HTTP/3 | - | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /css/main.css HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /lib/font-awesome/css/font-awesome.min.css HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /lib/pace/pace-theme-material.min.css HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /lib/pace/pace.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /lib/canvas-nest/canvas-nest.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /lib/anime.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /lib/velocity/velocity.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /lib/velocity/velocity.ui.min.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /js/utils.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /js/motion.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /js/schemes/pisces.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /js/next-boot.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /js/local-search.js HTTP/3 | https://tinychen.com/ | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.000 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-270.0.0.0 | [24/Aug/2020:15:01:27 +0800] | 200 | tinychen.com | GET /lib/font-awesome/fonts/fontawesome-webfont.woff2?v=4.7.0 HTTP/3 | https://tinychen.com/lib/font-awesome/css/font-awesome.min.css | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36 | 0.015 | TLSv1.3 | TLS_AES_128_GCM_SHA256 | quic | h3-27 4.4 edgeå¼€å¯HTTP/32021å¹´11æœˆ3æ—¥åç»­æ›´æ–°ï¼Œä½¿ç”¨Microsoft EdgeVersion 95.0.1020.40 (Official build) (64-bit)è¿›è¡Œæµ‹è¯•å‘ç°é»˜è®¤å·²ç»æ”¯æŒhttp3ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"wsl access is denied","slug":"20200718-wsl-access-is-denied","date":"2020-07-18T03:00:00.000Z","updated":"2020-07-18T03:00:00.000Z","comments":true,"path":"20200718-wsl-access-is-denied/","link":"","permalink":"https://tinychen.com/20200718-wsl-access-is-denied/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†windowsæ›´æ–°å¼•èµ·çš„wsl access is deniedçš„é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†windowsæ›´æ–°å¼•èµ·çš„wsl access is deniedçš„é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚ è¿™å‡ å¤©ä½¿ç”¨wslçš„æ—¶å€™çªç„¶å‡ºç°äº†æ‹’ç»è®¿é—®çš„æƒ…å†µï¼Œåªæœ‰åœ¨ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€powershellç„¶åå†æ‰“å¼€wslæ‰èƒ½é¡ºåˆ©åˆ‡æ¢åˆ°wslï¼Œä¸Šç½‘æŸ¥è¯¢äº†ä¸€ä¸‹å‘ç°æ˜¯windowsæ›´æ–°çš„ä¸€ä¸ªè¡¥ä¸ï¼ˆKB4565503ï¼‰å¼•èµ·çš„ã€‚ å†æŸ¥äº†ä¸€ä¸‹æ›´æ–°è®°å½•å‘ç°ç¡®å®æœ€è¿‘å‡ å¤©å®‰è£…äº†è¿™ä¸ªç³»ç»Ÿæ›´æ–°ã€‚ç„¶åæœæ–­å°†å…¶å¸è½½ï¼Œç„¶åå…³é—­ç³»ç»Ÿæ›´æ–°ï¼Œæ¥ç€é‡å¯ï¼Œä¹‹åé—®é¢˜è§£å†³ã€‚ æ£€æµ‹ä¹‹åå·²ç»èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"wsl","slug":"wsl","permalink":"https://tinychen.com/tags/wsl/"}]},{"title":"å¸¸è§çš„HTTPçŠ¶æ€ç ","slug":"20200717-http-code-introduction","date":"2020-07-17T03:00:00.000Z","updated":"2020-07-17T03:00:00.000Z","comments":true,"path":"20200717-http-code-introduction/","link":"","permalink":"https://tinychen.com/20200717-http-code-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦è®°å½•äº†ä¸€äº›å¸¸è§çš„HTTPçŠ¶æ€ç ï¼Œå†…å®¹å‚è€ƒç»´åŸºç™¾ç§‘ã€‚","text":"æœ¬æ–‡ä¸»è¦è®°å½•äº†ä¸€äº›å¸¸è§çš„HTTPçŠ¶æ€ç ï¼Œå†…å®¹å‚è€ƒç»´åŸºç™¾ç§‘ã€‚ 1ã€æ ‡å‡†æ‰©å±•ç 1.1 1xx Informational ä¿¡æ¯åŒ– 100 Continue ç»§ç»­ 101 Switching Protocols äº¤æ¢åè®® 102 Processing å¤„ç† 1.2 2xx Success æˆåŠŸ 200 OK 201 Created åˆ›å»º 202 Accepted å·²æ¥å— 203 Non-Authoritative Information éæˆæƒä¿¡æ¯ 204 No Content æ— å†…å®¹ 205 Reset Content é‡ç½®å†…å®¹ 206 Partial Content éƒ¨åˆ†å†…å®¹ 207 Multi-Status å¤šçŠ¶æ€ 208 Already Reported å·²æŠ¥å‘Š 226 IMIM Used ä½¿ç”¨çš„ 1.3 3xx Redirection é‡å®šå‘ 300 Multiple Choices å¤šç§é€‰æ‹© 301 Moved Permanently æ°¸ä¹…ç§»åŠ¨ 302 Found å‘ç° 303 See Other æŸ¥çœ‹å…¶å®ƒ 304 Not Modified æœªä¿®æ”¹ 305 Use Proxy ä½¿ç”¨ä»£ç† 306 Switch Proxy å¼€å…³ä»£ç† 307 Temporary Redirect ä¸´æ—¶é‡å®šå‘ 308 Permanent Redirect æ°¸ä¹…é‡å®šå‘ 1.4 4xx Client Error å®¢æˆ·ç«¯é”™è¯¯ 400 Bad Request é”™è¯¯çš„è¯·æ±‚ 401 Unauthorized æœªæˆæƒ 402 Payment Required éœ€è¦ä»˜è´¹ 403Forbidden æ‹’ç»è®¿é—® 404 Not Found æœªæ‰¾åˆ° 405 Method Not Allowed ä¸å…è®¸çš„æ–¹æ³• 406 Not Acceptable ä¸å¯æ¥å— 407 Proxy Authentication Required ä»£ç†æœåŠ¡å™¨éœ€è¦èº«ä»½éªŒè¯ 408 Request Timeout è¯·æ±‚è¶…æ—¶ 409 Conflict å†²çª 410 Gone å®Œæˆ 411 Length Required éœ€è¦é•¿åº¦ 412 Precondition Failed å‰ææ¡ä»¶å¤±è´¥ 413 Payload Too Large è´Ÿè½½è¿‡å¤§ 414 URI Too Long å¤ªé•¿ 415 Unsupported Media Type ä¸æ”¯æŒçš„åª’ä½“ç±»å‹ 416 Range Not Satisfiable çš„èŒƒå›´ä¸åˆé€‚ 417 Expectation Failed é¢„æœŸå¤±è´¥ 418 Iâ€™m a teapot æˆ‘æ˜¯ä¸€ä¸ªèŒ¶å£¶ 421 Misdirected Request è¯¯å¯¼è¯·æ±‚ 422 Unprocessable Entity æ— æ³•å¤„ç†çš„å®ä½“ 423 Locked é”å®š 424 Failed Dependency å¤±è´¥çš„ä¾èµ– 426 Upgrade Required å‡çº§æ‰€éœ€ 428 Precondition Required æ‰€éœ€çš„å…ˆå†³æ¡ä»¶ 429 Too Many Requests å¤ªå¤šçš„è¯·æ±‚ 431 Request Header Fields Too Large è¯·æ±‚å¤´å­—æ®µå¤ªå¤§ 451 Unavailable For Legal Reasons ä¸å¯å‡ºäºæ³•å¾‹åŸå›  1.5 5xx Server Error æœåŠ¡å™¨é”™è¯¯ 500 Internal Server Error å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ 501 Not Implemented æœªæ‰§è¡Œ 502 Bad Gateway é”™è¯¯çš„ç½‘å…³ 503 Service Unavailable æœåŠ¡ä¸å¯ç”¨ 504 Gateway Timeout ç½‘å…³è¶…æ—¶ 505 HTTP Version Not Supported ä¸æ”¯æŒHTTPç‰ˆæœ¬ 506 Variant Also Negotiates å˜ä½“ä¹Ÿè¿›è¡Œåå•† 507 Insufficient Storage å­˜å‚¨ç©ºé—´ä¸è¶³ 508 Loop Detected æ£€æµ‹åˆ°å¾ªç¯ 510 Not Extended ä¸å»¶é•¿ 511 Network Authentication Required ç½‘ç»œéœ€è¦èº«ä»½éªŒè¯ 2ã€éå®˜æ–¹æ‰©å±•ç  103 Checkpoint æ£€æŸ¥ç‚¹ 420 Method Failure (Spring Framework) æ•…éšœçš„æ–¹æ³•ï¼ˆSpringæ¡†æ¶ï¼‰ 420 Enhance Your Calm (Twitter) å¢å¼ºæ‚¨çš„å¹³é™ï¼ˆå¾®åšï¼‰ 450 Blocked by Windows Parental Controls (Microsoft) è¢«Windowsé˜»æ­¢å®¶é•¿æ§åˆ¶ï¼ˆå¾®è½¯ï¼‰ 498 Invalid Token (Esri) æ— æ•ˆçš„ä»¤ç‰Œï¼ˆESRIçš„ï¼‰ 499 Token Required (Esri) ä»¤ç‰Œå¿…éœ€ï¼ˆESRIçš„ï¼‰ 499 Request has been forbidden by antivirus è¯·æ±‚å·²è¢«ç¦æ­¢åç—…æ¯’ 509 Bandwidth Limit Exceeded (Apache Web Server/cPanel) è¶…å‡ºå¸¦å®½é™åˆ¶ï¼ˆApacheçš„WebæœåŠ¡å™¨/çš„cPanelï¼‰ 530 Site is frozen ç½‘ç«™è¢«å†»ç»“ 3ã€äº’è”ç½‘ä¿¡æ¯æœåŠ¡æ‰©å±•çŠ¶æ€ç  440 Login Timeout ç™»å½•è¶…æ—¶ 449 Retry With é‡æ–°å‘é€å¸¦ 451 Redirect é‡å®šå‘ 4ã€NGINX æ‰©å±•çŠ¶æ€ç  444 No Response æ²¡æœ‰å“åº” 495 SSL Certificate Error è¯ä¹¦é”™è¯¯ 496 SSL Certificate Requiredè¯ä¹¦è¦æ±‚ 497 HTTP Request Sent to HTTPS Port å‘é€åˆ°HTTPSç«¯å£è¯·æ±‚ 499 Client Closed Request å®¢æˆ·ç«¯è¯·æ±‚å…³é—­","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"}]},{"title":"åŒ¹é…ipv4åœ°å€çš„æ­£åˆ™è¡¨è¾¾å¼","slug":"20200714-ipv4-address-re-match","date":"2020-07-14T07:00:00.000Z","updated":"2020-07-14T07:00:00.000Z","comments":true,"path":"20200714-ipv4-address-re-match/","link":"","permalink":"https://tinychen.com/20200714-ipv4-address-re-match/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ipv4åœ°å€ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ipv4åœ°å€ã€‚ 1ã€ç²—çŠ·åŒ¹é…æ¯”è¾ƒç²—çŠ·çš„åŒ¹é…æ–¹æ³•ï¼Œç›´æ¥åŒ¹é…å››ç»„ä½¿ç”¨äº†.è¿›è¡Œåˆ†éš”çš„æ•°å­— 1\\d+\\.&#123;3&#125;\\d+ ä½†æ˜¯è¿™æ ·å®¹æ˜“æŠŠä¸æ˜¯ipçš„ä¹ŸåŒ¹é…è¿›å»ï¼Œæ¯”å¦‚è¯´8888.888.88.8è¿™æ ·çš„ä¹Ÿæ˜¯ç¬¦åˆè§„åˆ™çš„ï¼Œæ‰€ä»¥æƒ³è¦å°½å¯èƒ½çš„å‡†ç¡®ï¼Œæˆ‘ä»¬å°±è¦è¿›è¡Œç²¾ç»†çš„åŒ¹é…ã€‚ 2ã€ç²¾å‡†åŒ¹é…æ‰€æœ‰ipé¦–å…ˆæˆ‘ä»¬è¦ç¡®å®šipv4åœ°å€çš„èŒƒå›´æ˜¯0.0.0.0åˆ°255.255.255.255ã€‚ç„¶åå°±ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼é€ä¸ªå­—è¿›è¡ŒåŒ¹é…ã€‚ é¦–å…ˆè¦åŒ¹é…0-255è¿™256ä¸ªæ•°å­—ï¼Œç”±äºæ­£åˆ™è¡¨è¾¾å¼åœ¨è¿™é‡Œä¸èƒ½ç›´æ¥ä½¿ç”¨æ•°å€¼å¤§å°è¿›è¡ŒåŒ¹é…ï¼Œå¹¶ä¸”éœ€è¦å°½å¯èƒ½åœ°ç²¾ç¡®æ§åˆ¶æ•°å€¼èŒƒå›´ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶åˆ†ä¸º0-9ã€10-99ã€100-199ã€200-249ã€250-255ä¸€å…±äº”ä¸ªéƒ¨åˆ†ï¼š 123456?: # éè·å–åŒ¹é…ï¼ŒåªåŒ¹é…ä½†æ˜¯ä¸è·å–(?:1[0-9][0-9]\\.) # 100-199(?:2[0-4][0-9]\\.) # 200-249(?:25[0-5]\\.) # 250-255(?:[1-9][0-9]\\.) # 10-99(?:[0-9]\\.) # 0-9 æ³¨æ„è¿™äº”ä¸ªåˆ†ç»„éƒ½æ˜¯æˆ–|å…³ç³»,å‰é¢ä¸‰ä¸ªéƒ¨åˆ†éƒ½æ˜¯0-255åŠ ä¸Šä¸€ä¸ªç‚¹.ï¼Œæœ€åçš„æ˜¯æ²¡æœ‰ç‚¹çš„.ï¼Œæ‰€ä»¥å‰é¢çš„æ‰§è¡Œä¸‰æ¬¡åŒ¹é…ï¼Œæœ€åå†åŠ ä¸Šæ²¡æœ‰ç‚¹.çš„ä¸€æ¬¡ï¼Œæ­£å¥½å°±èƒ½åŒ¹é…æ‰€æœ‰çš„IPåœ°å€ 1(?:(?:1[0-9][0-9]\\.)|(?:2[0-4][0-9]\\.)|(?:25[0-5]\\.)|(?:[1-9][0-9]\\.)|(?:[0-9]\\.))&#123;3&#125;(?:(?:1[0-9][0-9])|(?:2[0-4][0-9])|(?:25[0-5])|(?:[1-9][0-9])|(?:[0-9])) 3ã€åŒ¹é…å±€åŸŸç½‘IPåœ°å€å±€åŸŸç½‘ipåœ°å€åˆ†ä¸ºä¸‰ä¸ªå¤§çš„ç½‘æ®µï¼Œåˆ†åˆ«æ˜¯10.x.x.xã€172.16.0.0â€”172.31.255.254å’Œ192.168.x.xï¼Œå…·ä½“åŒ¹é…æ€è·¯å’Œä¸Šé¢ä¸€æ · 10.x.x.x110(?:(?:\\.1[0-9][0-9])|(?:\\.2[0-4][0-9])|(?:\\.25[0-5])|(?:\\.[1-9][0-9])|(?:\\.[0-9]))&#123;3&#125; 172.16.0.0â€”172.31.255.2541172(?:\\.(?:1[6-9])|(?:2[0-9])|(?:3[0-1]))(?:(?:\\.1[0-9][0-9])|(?:\\.2[0-4][0-9])|(?:\\.25[0-5])|(?:\\.[1-9][0-9])|(?:\\.[0-9]))&#123;2&#125; 192.168.x.x1192\\.168(?:(?:\\.1[0-9][0-9])|(?:\\.2[0-4][0-9])|(?:\\.25[0-5])|(?:\\.[1-9][0-9])|(?:\\.[0-9]))&#123;2&#125; åŒ¹é…æ‰€æœ‰å±€åŸŸç½‘IPåœ°å€1(?:(?:10(?:(?:\\.1[0-9][0-9])|(?:\\.2[0-4][0-9])|(?:\\.25[0-5])|(?:\\.[1-9][0-9])|(?:\\.[0-9])))|(?:172(?:\\.(?:1[6-9])|(?:2[0-9])|(?:3[0-1])))|(?:192\\.168))(?:(?:\\.1[0-9][0-9])|(?:\\.2[0-4][0-9])|(?:\\.25[0-5])|(?:\\.[1-9][0-9])|(?:\\.[0-9]))&#123;2&#125;","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"}]},{"title":"ä½¿ç”¨gpgæ¥å¯¹ä¸‹è½½çš„æ–‡ä»¶è¿›è¡Œæ ¡éªŒ","slug":"20200713-gpg-check-file","date":"2020-07-13T07:00:00.000Z","updated":"2020-07-13T07:00:00.000Z","comments":true,"path":"20200713-gpg-check-file/","link":"","permalink":"https://tinychen.com/20200713-gpg-check-file/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨gpgæ¥å¯¹ä¸‹è½½çš„æ–‡ä»¶è¿›è¡Œå®Œæ•´æ€§æ ¡éªŒ","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨gpgæ¥å¯¹ä¸‹è½½çš„æ–‡ä»¶è¿›è¡Œå®Œæ•´æ€§æ ¡éªŒ ä»¥åœ¨nginxå®˜ç½‘ä¸‹è½½nginxä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°nginxçš„å‹ç¼©åŒ…å’Œä¸€ä¸ªå¯¹åº”çš„ascæ ¼å¼çš„gpgç­¾åæ–‡ä»¶ã€‚ 123[root@TINY-DESKTOP /mnt/c/Users/tinychen/Downloads/http2]# ll nginx*-rwxrwxrwx 1 root root 1047223 Jul 13 13:11 nginx-1.19.1.tar.gz-rwxrwxrwx 1 root root 455 Jul 13 13:52 nginx-1.19.1.tar.gz.asc ä½¿ç”¨gpgå‘½ä»¤éœ€è¦å…ˆå®‰è£…gnupgå·¥å…· 1sudo yum install gnupg ä¸€èˆ¬æ¥è¯´æ˜¯ä½¿ç”¨gpg --verifyæ¥æ ¡éªŒæ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è¯´å¯èƒ½ä¼šå‡ºç°æ²¡æœ‰å…¬é’¥çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æ ¹æ®æ˜¾ç¤ºçš„RSA keyæ¥å¯¼å…¥å…¬é’¥ï¼Œç„¶åå†è¿›è¡ŒéªŒè¯å³å¯ã€‚ 12# gpg --verify gpgç­¾åæ–‡ä»¶ å¾…æ ¡éªŒæ–‡ä»¶# gpg --receive-keys RSA_key","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[]},{"title":"åœ¨bashä¸­å¼€å¯æ˜¾ç¤ºå®Œæ•´è·¯å¾„","slug":"20200701-bash-show-pwd","date":"2020-07-01T07:00:00.000Z","updated":"2020-07-01T07:00:00.000Z","comments":true,"path":"20200701-bash-show-pwd/","link":"","permalink":"https://tinychen.com/20200701-bash-show-pwd/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨bashä¸­å¼€å¯æ˜¾ç¤ºå®Œæ•´è·¯å¾„ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨bashä¸­å¼€å¯æ˜¾ç¤ºå®Œæ•´è·¯å¾„ã€‚ åªéœ€è¦ä¿®æ”¹å¯¹åº”çš„ç¯å¢ƒå˜é‡ï¼Œç„¶åé‡æ–°ç™»å½•å³å¯å®ç°ï¼š 1234sudo echo &quot;export PS1=&#x27;[\\u@\\h \\$PWD]# &#x27;&quot; &gt;&gt; /etc/profile&#x27;\\[\\e]2;\\u@\\H:\\w\\a\\]\\n($LOGNAME@$HOSTNAME) \\t\\n[$PWD]: &#x27;# æ³¨æ„åœ¨$ç¬¦å·ä¹‹åä¸€èˆ¬ä¼šç•™æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†è¾“å…¥å‘½ä»¤çš„æ—¶å€™å¯ä»¥å’Œå‰é¢çš„è·¯å¾„ä¿¡æ¯éš”ç¦»å¼€æ¥ 12345678910111213141516\\u æ˜¾ç¤ºå½“å‰ç”¨æˆ·è´¦å·\\v BASHçš„ç‰ˆæœ¬ä¿¡æ¯\\H å®Œæ•´çš„ä¸»æœºåç§°ã€‚ä¾‹å¦‚ï¼šhostnameä¸ºaliyun.alibaba.cloundï¼Œåˆ™è¿™ä¸ªåç§°å°±æ˜¯aliyun.alibaba.clound\\h ä»…å–ä¸»æœºçš„ç¬¬ä¸€ä¸ªåå­—ï¼Œä¾‹å¦‚ï¼šhostnameä¸ºaliyun.alibaba.cloundï¼Œåˆ™è¿™ä¸ªåç§°å°±æ˜¯aliyun\\W åªæ˜¾ç¤ºå½“å‰è·¯å¾„æœ€åä¸€ä¸ªç›®å½•\\w æ˜¾ç¤ºå½“å‰ç»å¯¹è·¯å¾„ï¼ˆå½“å‰ç”¨æˆ·ç›®å½•ä¼šä»¥ ~ä»£æ›¿ï¼‰\\t æ˜¾ç¤ºæ—¶é—´ä¸º24å°æ—¶æ ¼å¼,å¦‚ï¼š14:19:34\\T æ˜¾ç¤ºæ—¶é—´ä¸º12å°æ—¶æ ¼å¼,å¦‚ï¼š02:19:34\\A æ˜¾ç¤ºæ—¶é—´ä¸º24å°æ—¶æ ¼å¼ä½†æ˜¯ä¸å¸¦ç§’,å¦‚ï¼š14:19\\d ä»£è¡¨æ—¥æœŸï¼Œæ ¼å¼ä¸ºweekday month dateï¼Œä¾‹å¦‚ï¼š&quot;Mon Aug1&quot;$PWD æ˜¾ç¤ºå½“å‰å…¨è·¯å¾„\\# æ˜¾ç¤ºå‘½ä»¤è¡Œæç¤ºç¬¦å·ï¼Œä¸€èˆ¬ä½¿ç”¨&#x27;$&#x27;æˆ–è€…&#x27;#&#x27; 12sudo echo &quot;export PS1=&#x27;[\\u@\\h \\w]# &#x27;&quot; &gt;&gt; /etc/profile# å¦‚æœæƒ³è¦åœ¨ç”¨æˆ·å®¶ç›®å½•çš„æ—¶å€™æ˜¾ç¤ºä¸º~åˆ™å¯ä»¥å°†$PWDæ¢ä¸º\\w 123456789[root@aliyun /root]# hostnamealiyun.alibaba.clound[root@aliyun /root]# tail -1 /etc/profileexport PS1=&#x27;[\\u@\\h $PWD]# &#x27;[root@aliyun.alibaba.clound /root]# hostnamealiyun.alibaba.clound[root@aliyun.alibaba.clound /root]# tail -1 /etc/profileexport PS1=&#x27;[\\u@\\H $PWD]# &#x27;","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"bash","slug":"bash","permalink":"https://tinychen.com/tags/bash/"}]},{"title":"RHEL/CentOSä¿®æ”¹hostname","slug":"20200616-centos-modify-hostname","date":"2020-06-16T07:00:00.000Z","updated":"2020-06-16T07:00:00.000Z","comments":true,"path":"20200616-centos-modify-hostname/","link":"","permalink":"https://tinychen.com/20200616-centos-modify-hostname/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨RHEL/CentOS/6/7/8ä¸­å¦‚ä½•ä¿®æ”¹ä¸»æœºçš„hostnameã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨RHEL/CentOS/6/7/8ä¸­å¦‚ä½•ä¿®æ”¹ä¸»æœºçš„hostnameã€‚ 1ã€CentOS6/RHEL6å¯¹äº6ç³»çš„çº¢å¸½Linuxï¼Œä¿®æ”¹hostnameè¾ƒä¸ºéº»çƒ¦ï¼Œå¦‚æœåªæ˜¯éœ€è¦ä¸´æ—¶ä¿®æ”¹hostnameï¼Œåªéœ€è¦ä½¿ç”¨hostnameå‘½ä»¤å³å¯ï¼š 1hostname your-new-temp-hostname å¦‚æœéœ€è¦æ°¸ä¹…ä¿®æ”¹hostnameï¼Œåˆ™éœ€è¦ä¿®æ”¹ä¸¤ä¸ªåœ°æ–¹ï¼š é¦–å…ˆæ˜¯/etc/hostsæ–‡ä»¶ä¸­ï¼Œéœ€è¦æ·»åŠ IPå’Œhostnameçš„æ˜ å°„å…³ç³»ï¼Œå¦‚ï¼š 1127.0.0.1 your-new-perm-hostname ç„¶ååœ¨/etc/sysconfig/networkæ–‡ä»¶ä¸­ä¿®æ”¹å¯¹åº”çš„HOSTNAME=å‚æ•°ä¸ºæ–°çš„hostname 1HOSTNAME=your-new-perm-hostname æ³¨æ„ä¸¤å¤„åœ°æ–¹éœ€è¦åŒæ—¶ä¿®æ”¹ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæœ€åéœ€è¦é‡å¯ç³»ç»Ÿæ‰ä¼šç”Ÿæ•ˆã€‚ 2ã€CentOS7ã€8/RHEL7ã€8å¯¹äº7ç³»åŠä¹‹åçš„çº¢å¸½Linuxï¼Œåªéœ€è¦ç›´æ¥ä¿®æ”¹/etc/hostnameæ–‡ä»¶ç„¶åé‡å¯å°±å¯ä»¥å®Œæˆæ°¸ä¹…ä¿®æ”¹ å¦‚æœä¸æƒ³é‡å¯ï¼Œå¯ä»¥ä½¿ç”¨æ–°çš„hostnamectlå·¥å…·æ¥è¿›è¡Œæ°¸ä¹…ä¿®æ”¹ 1hostnamectl set-hostname your-new-perm-hostname 3ã€ä½¿ç”¨è„šæœ¬è‡ªåŠ¨æ‰§è¡Œ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#!/bin/bash# Determine whether executor is root or notif [ $(whoami) != &quot;root&quot; ]; then echo &quot;please exec this shell script with sudo or in root mode&quot; exit 1fi# Determine if there is a new hostnameif [ -z &quot;$1&quot; ]; then echo &quot;please input the new hostname&quot; exit 1fi# get the release versionversion=$(cat /etc/redhat-release | awk -F &#x27;release&#x27; &#x27;&#123;print $2&#125;&#x27; | cut -c -2)if [ $version -ne 6 ] &amp;&amp; [ $version -ne 7 ] &amp;&amp; [ $version -ne 8 ]; then echo &quot;This script do not suit your system, Bye!&quot; exit 1fiecho &quot;your hostname will be change to $1&quot;if [ $version == 6 ]; then # get hostname from /etc/sysconfig/network hostnameCurrent=$(cat /etc/sysconfig/network | grep HOSTNAME | awk -F &#x27;=&#x27; &#x27;&#123; print $NF &#125;&#x27;) # echo &quot;your hostname now is $hostnameCurrent&quot; # modify the tmp hostname hostname $1 # Determine if there is a field about $hostnameCurrent in /etc/hosts # if yes, use awk to replace it # if no, echo a new line aboout new hostname cat /etc/hosts | grep $hostnameCurrent if [ $? -ne 0 ]; then echo &quot;127.0.0.1 $1&quot; &gt;&gt;/etc/hosts else sed -i &quot;s/$hostnameCurrent/$1/g&quot; /etc/hosts fi # modify the hostname in /etc/sysconfig/network sed -i &quot;s/$hostnameCurrent/$1/g&quot; /etc/sysconfig/networkelse if [ $version == 7 ] || [ $version == 8 ]; then hostnamectl set-hostname $1 fifiecho &quot;Hostname modification is done !&quot;echo &quot;A restart might be better for apply the change&quot; å°†ä¸Šè¿°çš„ä»£ç ä¿å­˜ä¸ºè„šæœ¬å†åŠ ä¸Šéœ€è¦ä¿®æ”¹çš„hostnameç›´æ¥æ‰§è¡Œå°±å¯ä»¥äº†ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"},{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"HTTP2çš„ç‰¹æ€§è§£æ","slug":"20200608-http2-introduction","date":"2020-06-08T02:00:00.000Z","updated":"2020-06-08T02:00:00.000Z","comments":true,"path":"20200608-http2-introduction/","link":"","permalink":"https://tinychen.com/20200608-http2-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†HTTP2ç›¸å¯¹äºHTTP1.1çš„ä¸€äº›æ”¹è¿›å’Œæ–°ç‰¹æ€§ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†HTTP2ç›¸å¯¹äºHTTP1.1çš„ä¸€äº›æ”¹è¿›å’Œæ–°ç‰¹æ€§ã€‚ 1ã€HTTP1.1çš„ä¸è¶³HTTPåè®®é‡‡ç”¨â€œrequest-responseâ€æ¨¡å¼ï¼Œå½“ä½¿ç”¨æ™®é€šæ¨¡å¼ï¼Œå³éKeepAliveæ¨¡å¼æ—¶ï¼Œæ¯ä¸ªè¯·æ±‚/åº”ç­”å®¢æˆ·å’ŒæœåŠ¡å™¨éƒ½è¦æ–°å»ºä¸€ä¸ªè¿æ¥ï¼Œå®Œæˆä¹‹åç«‹å³æ–­å¼€è¿æ¥ï¼ˆHTTPåè®®ä¸ºæ— è¿æ¥çš„åè®®ï¼‰ã€‚å¯¹äºä¸€ä¸ªå¤æ‚çš„é¡µé¢ï¼Œä¸€èˆ¬éƒ½ä¼šæœ‰å¤šä¸ªèµ„æºéœ€è¦è·å–ã€‚å¦‚æœæ˜¯æ¯ä¸ªèµ„æºéƒ½å•ç‹¬å»ºç«‹ä¸€ä¸ªTCPè¿æ¥å»è·å–ï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥æ¥é€šä¿¡ï¼Œè¿™æ˜¯ååˆ†è€—è´¹èµ„æºçš„ã€‚ éšåå‡ºç°äº†Keep-Aliveï¼ŒKeep-Aliveè§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯ä¸€å®šæ—¶é—´å†…ï¼ŒåŒä¸€åŸŸåå¤šæ¬¡è¯·æ±‚æ•°æ®ï¼Œåªå»ºç«‹ä¸€æ¬¡HTTPè¯·æ±‚ï¼Œå…¶ä»–è¯·æ±‚å¯å¤ç”¨æ¯ä¸€æ¬¡å»ºç«‹çš„è¿æ¥é€šé“ï¼Œä»¥è¾¾åˆ°æé«˜è¯·æ±‚æ•ˆç‡çš„é—®é¢˜ã€‚è¿™é‡Œé¢æ‰€è¯´çš„ä¸€å®šæ—¶é—´ä¸€èˆ¬æ˜¯å¯ä»¥è‡ªè¡Œé…ç½®çš„ã€‚å½“ä½¿ç”¨Keep-Aliveæ¨¡å¼ï¼ˆåˆç§°æŒä¹…è¿æ¥ã€è¿æ¥é‡ç”¨ï¼‰æ—¶ï¼ŒKeep-AliveåŠŸèƒ½ä½¿å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯çš„è¿æ¥æŒç»­æœ‰æ•ˆï¼Œå½“å‡ºç°å¯¹æœåŠ¡å™¨çš„åç»§è¯·æ±‚æ—¶ï¼ŒKeep-AliveåŠŸèƒ½é¿å…äº†å»ºç«‹æˆ–è€…é‡æ–°å»ºç«‹è¿æ¥ã€‚ åœ¨HTTP1.1ä¸­æ˜¯é»˜è®¤å¼€å¯äº†Keep-Aliveï¼Œè™½ç„¶è§£å†³äº†å¤šæ¬¡è¿æ¥çš„é—®é¢˜ï¼Œä½†æ˜¯ä¾ç„¶æœ‰ä¸¤ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼š ä¸²è¡Œä¼ è¾“ï¼šåœ¨å•é€šé“ä¼ è¾“çš„å‰æä¸‹ï¼Œå‡è®¾è¦ä¼ è¾“10ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆåªèƒ½ä¾æ¬¡é€ä¸ªä¼ è¾“ï¼Œä¼ è¾“å®Œç¬¬ä¸€ä¸ªå†ä¼ è¾“ç¬¬äºŒä¸ªï¼Œä»¥æ­¤ç±»æ¨ï¼› è¿æ¥æ•°é—®é¢˜ï¼šHTTP/1.1 è™½ç„¶é»˜è®¤å¼€å¯keep-aliveå¯ä»¥å¤ç”¨ä¸€éƒ¨åˆ†è¿æ¥ï¼Œä½†åŸŸååˆ†ç‰‡ç­‰æƒ…å†µä¸‹ä»ç„¶éœ€è¦å»ºç«‹å¤šä¸ªconnectionï¼Œè€—è´¹èµ„æºï¼Œç»™æœåŠ¡å™¨å¸¦æ¥æ€§èƒ½å‹åŠ›ã€‚ ä½œä¸º HTTP/1.x çš„è¿æ¥ï¼Œè¯·æ±‚æ˜¯åºåˆ—åŒ–çš„ï¼Œå“ªæ€•æœ¬æ¥æ˜¯æ— åºçš„ï¼Œåœ¨æ²¡æœ‰è¶³å¤Ÿåºå¤§å¯ç”¨çš„å¸¦å®½æ—¶ï¼Œä¹Ÿæ— ä»ä¼˜åŒ–ã€‚ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ï¼Œæµè§ˆå™¨ä¸ºæ¯ä¸ªåŸŸåå»ºç«‹å¤šä¸ªè¿æ¥ï¼Œä»¥å®ç°å¹¶å‘è¯·æ±‚ã€‚æ›¾ç»é»˜è®¤çš„è¿æ¥æ•°é‡ä¸º 2 åˆ° 3 ä¸ªï¼Œç°åœ¨æ¯”è¾ƒå¸¸ç”¨çš„å¹¶å‘è¿æ¥æ•°å·²ç»å¢åŠ åˆ° 6 æ¡ã€‚å¦‚æœå°è¯•å¤§äºè¿™ä¸ªæ•°å­—ï¼Œå°±æœ‰è§¦å‘æœåŠ¡å™¨ DoS ä¿æŠ¤çš„é£é™©ã€‚å¦‚æœæœåŠ¡å™¨ç«¯æƒ³è¦æ›´å¿«é€Ÿçš„å“åº”ç½‘ç«™æˆ–åº”ç”¨ç¨‹åºçš„åº”ç­”ï¼Œå®ƒå¯ä»¥è¿«ä½¿å®¢æˆ·ç«¯å»ºç«‹æ›´å¤šçš„è¿æ¥ã€‚ä¾‹å¦‚ï¼Œä¸è¦åœ¨åŒä¸€ä¸ªåŸŸåä¸‹è·å–æ‰€æœ‰èµ„æºï¼Œå‡è®¾æœ‰ä¸ªåŸŸåæ˜¯ www.example.comï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ‹†åˆ†æˆå¥½å‡ ä¸ªåŸŸåï¼šwww1.example.comã€www2.example.comã€www3.example.comã€‚æ‰€æœ‰è¿™äº›åŸŸåéƒ½æŒ‡å‘åŒä¸€å°æœåŠ¡å™¨ï¼Œæµè§ˆå™¨ä¼šåŒæ—¶ä¸ºæ¯ä¸ªåŸŸåå»ºç«‹ 6 æ¡è¿æ¥(åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿æ¥æ•°ä¼šè¾¾åˆ° 18 æ¡)ã€‚è¿™ä¸€æŠ€æœ¯è¢«ç§°ä½œåŸŸååˆ†ç‰‡ã€‚ HTTP1.1ä¸­çš„æ•°æ®ä¼ è¾“æ˜¯åŸºäºæ–‡æœ¬æ¥è¿›è¡Œä¼ è¾“çš„ï¼Œè¿™å°±éœ€è¦ä¿è¯åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­å¿…é¡»æ˜¯æŒ‰ç…§æ–‡æœ¬åŸæœ‰çš„é¡ºåºè¿›è¡Œä¼ è¾“ã€‚æŒ‰ç…§é¡ºåºä¼ è¾“çš„ä¸€å¤§å¼Šç«¯å°±æ˜¯æ²¡åŠæ³•è¿›è¡Œå¹¶è¡Œä¼ è¾“ï¼Œä¾‹å¦‚ä¸€å¥Helloå°±åªèƒ½æŒ‰ç…§å­—æ¯é¡ºåºé€ä¸ªä¼ è¾“ï¼Œå¦‚æœå¹¶è¡Œä¼ è¾“ï¼Œå­—æ¯åˆ°è¾¾çš„å…ˆåé¡ºåºæ˜¯ä¸ä¸€å®šå’Œåœ¨æ–‡æœ¬ä¸­çš„é¡ºåºä¸€æ ·çš„ï¼Œè€Œå­—æ¯æœ¬èº«åˆæ²¡æœ‰é¡ºåºæ ‡å·ï¼Œå°±æ²¡æœ‰åŠæ³•å¯¹å…¶è¿›è¡Œæ’åºï¼Œå¾ˆæœ‰å¯èƒ½å°±ä¼šå¯¼è‡´å†…å®¹é”™ä¹±ï¼ŒHelloå°±å¯èƒ½å˜æˆleloHã€‚ 2ã€HTTP2çš„ç‰¹æ€§2.1 äºŒè¿›åˆ¶åˆ†å¸§http2é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ä¼ è¾“æ•°æ®ï¼Œè€Œé HTTP 1.x çš„æ–‡æœ¬æ ¼å¼ï¼ŒäºŒè¿›åˆ¶åè®®è§£æèµ·æ¥æ›´é«˜æ•ˆã€‚ HTTP / 1 çš„è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ï¼Œéƒ½æ˜¯ç”±èµ·å§‹è¡Œï¼Œé¦–éƒ¨å’Œå®ä½“æ­£æ–‡ï¼ˆå¯é€‰ï¼‰ç»„æˆï¼Œå„éƒ¨åˆ†ä¹‹é—´ä»¥æ–‡æœ¬æ¢è¡Œç¬¦åˆ†éš”ã€‚HTTP/2 å°†è¯·æ±‚å’Œå“åº”æ•°æ®åˆ†å‰²ä¸ºæ›´å°çš„å¸§ï¼Œå¹¶ä¸”å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶ç¼–ç ã€‚HTTP/2 ä¸­ï¼ŒåŒåŸŸåä¸‹æ‰€æœ‰é€šä¿¡éƒ½åœ¨å•ä¸ªè¿æ¥ä¸Šå®Œæˆï¼Œè¯¥è¿æ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµã€‚æ¯ä¸ªæ•°æ®æµéƒ½ä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ï¼Œè€Œæ¶ˆæ¯åˆç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆã€‚å¤šä¸ªå¸§ä¹‹é—´å¯ä»¥ä¹±åºå‘é€ï¼Œæ ¹æ®å¸§é¦–éƒ¨çš„æµæ ‡è¯†å¯ä»¥é‡æ–°ç»„è£…ã€‚ æµï¼šæµæ˜¯è¿æ¥ä¸­çš„ä¸€ä¸ªè™šæ‹Ÿä¿¡é“ï¼Œå¯ä»¥æ‰¿è½½åŒå‘çš„æ¶ˆæ¯ï¼›æ¯ä¸ªæµéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°æ ‡è¯†ç¬¦ï¼ˆ1ã€2â€¦Nï¼‰ï¼› æ¶ˆæ¯ï¼šæ˜¯æŒ‡é€»è¾‘ä¸Šçš„ HTTP æ¶ˆæ¯ï¼Œæ¯”å¦‚è¯·æ±‚ã€å“åº”ç­‰ï¼Œç”±ä¸€æˆ–å¤šä¸ªå¸§ç»„æˆã€‚ å¸§ï¼šHTTP 2.0 é€šä¿¡çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªå¸§åŒ…å«å¸§é¦–éƒ¨ï¼Œè‡³å°‘ä¹Ÿä¼šæ ‡è¯†å‡ºå½“å‰å¸§æ‰€å±çš„æµï¼Œæ‰¿è½½ç€ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œå¦‚ HTTP é¦–éƒ¨ã€è´Ÿè·ï¼Œç­‰ç­‰ HTTP/2å¼•å…¥çš„äºŒè¿›åˆ¶æ•°æ®å¸§å’Œæµçš„æ¦‚å¿µï¼Œå…¶ä¸­å¸§å¯¹æ•°æ®è¿›è¡Œé¡ºåºæ ‡è¯†ï¼Œè¿™æ ·æµè§ˆå™¨æ”¶åˆ°æ•°æ®ä¹‹åï¼Œå°±å¯ä»¥æŒ‰ç…§åºåˆ—å¯¹æ•°æ®è¿›è¡Œåˆå¹¶ï¼Œè€Œä¸ä¼šå‡ºç°åˆå¹¶åæ•°æ®é”™ä¹±çš„æƒ…å†µã€‚åŒæ ·æ˜¯å› ä¸ºæœ‰äº†åºåˆ—ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥å¹¶è¡Œçš„ä¼ è¾“æ•°æ®ï¼Œè¿™å°±æ˜¯æµæ‰€åšçš„äº‹æƒ…ã€‚ æˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢çš„ä¸¤å¼ å›¾æ¥å¯¹å…¶è¿›è¡Œäº†è§£ï¼š å¤šè·¯å¤ç”¨ ï¼ˆmultiplexingï¼‰ åœ¨HTTP/2 åè®®ä¸­ï¼Œ Connection å’Œ Keep-Alive æ˜¯è¢«å¿½ç•¥çš„ï¼›ä¸»è¦ä½¿ç”¨äº†å¤šè·¯å¤ç”¨æ¥è¿›è¡Œè¿æ¥ç®¡ç†ã€‚åœ¨ HTTP/2 ä¸­ï¼Œæœ‰äº†äºŒè¿›åˆ¶åˆ†å¸§ä¹‹åï¼ŒHTTP /2 ä¸å†ä¾èµ– TCP è¿æ¥å»å®ç°å¤šæµå¹¶è¡Œäº†ï¼Œåœ¨ HTTP/2 ä¸­ åŒåŸŸåä¸‹æ‰€æœ‰é€šä¿¡éƒ½åœ¨å•ä¸ªè¿æ¥ä¸Šå®Œæˆ å•ä¸ªè¿æ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµ æ•°æ®æµä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ï¼Œè€Œæ¶ˆæ¯åˆç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆï¼Œå¤šä¸ªå¸§ä¹‹é—´å¯ä»¥ä¹±åºå‘é€ï¼Œå› ä¸ºæ ¹æ®å¸§é¦–éƒ¨çš„æµæ ‡è¯†å¯ä»¥é‡æ–°ç»„è£…ã€‚ è¿™ä¸€ç‰¹æ€§ï¼Œä½¿æ€§èƒ½æœ‰äº†æå¤§æå‡ï¼š åŒä¸ªåŸŸååªéœ€è¦å ç”¨ä¸€ä¸ª TCP è¿æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªè¿æ¥å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”,æ¶ˆé™¤äº†å› å¤šä¸ª TCP è¿æ¥è€Œå¸¦æ¥çš„å»¶æ—¶å’Œå†…å­˜æ¶ˆè€— å¹¶è¡Œäº¤é”™åœ°å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œä¸¤ä¸¤ä¹‹é—´äº’ä¸å½±å“ åœ¨ HTTP/2 ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½å¯ä»¥å¸¦ä¸€ä¸ª 31bit çš„ä¼˜å…ˆå€¼ï¼Œ0 è¡¨ç¤ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œ æ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šä½ã€‚æœ‰äº†è¿™ä¸ªä¼˜å…ˆå€¼ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±å¯ä»¥åœ¨å¤„ç†ä¸åŒçš„æµæ—¶é‡‡å–ä¸åŒçš„ç­–ç•¥ï¼Œä»¥æœ€ä¼˜çš„æ–¹å¼å‘é€æµã€æ¶ˆæ¯å’Œå¸§ã€‚ ä½¿ç”¨æµè§ˆå™¨çš„å¼€å‘è€…æ¨¡å¼æŸ¥çœ‹ç›¸å…³èµ„æºçš„åŠ è½½æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°å¯¹åº”çš„http2çš„èµ„æºåœ¨åŠ è½½çš„æ—¶å€™ä¼šä½¿ç”¨å¤šè·¯å¤ç”¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶è¯·æ±‚å¤šä¸ªèµ„æºï¼›è€Œä¸‹æ–¹çš„http1.1åˆ™åœ¨è¯·æ±‚èµ„æºçš„æ—¶å€™å‡ºç°äº†ç­‰å¾…çš„æƒ…å†µã€‚ 2.2 é¦–éƒ¨å‹ç¼©ï¼ˆheader compressionï¼‰åœ¨åŒä¸€ä¸ªHTTPé¡µé¢ä¸­ï¼Œè®¸å¤šèµ„æºçš„Headeræ˜¯é«˜åº¦ç›¸ä¼¼çš„ï¼Œä½†æ˜¯åœ¨HTTP2ä¹‹å‰éƒ½æ˜¯ä¸ä¼šå¯¹å…¶è¿›è¡Œå‹ç¼©çš„ï¼Œè¿™ä½¿å¾—åœ¨å¤šæ¬¡ä¼ è¾“ä¸­ç™½ç™½æµªè´¹äº†èµ„æºæ¥è¿›è¡Œé‡å¤æ— è°“çš„æ“ä½œã€‚ åœ¨HTTPä¸­ï¼Œé¦–éƒ¨å­—æ®µæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ‰€æœ‰çš„é¦–éƒ¨å­—æ®µç»„æˆé¦–éƒ¨å­—æ®µåˆ—è¡¨ã€‚åœ¨HTTP/1.xä¸­ï¼Œé¦–éƒ¨å­—æ®µéƒ½è¢«è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ï¼Œä¸€è¡Œä¸€è¡Œçš„é¦–éƒ¨å­—æ®µå­—ç¬¦ä¸²ç»„æˆé¦–éƒ¨å­—æ®µåˆ—è¡¨ã€‚è€Œåœ¨HTTP/2çš„é¦–éƒ¨å‹ç¼©HPACKç®—æ³•ä¸­ï¼Œåˆ™æœ‰ç€ä¸åŒçš„è¡¨ç¤ºæ–¹æ³•ã€‚ HPACKç®—æ³•çš„å…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒRFC7541 HPACKç®—æ³•è¡¨ç¤ºçš„å¯¹è±¡ï¼Œä¸»è¦æœ‰åŸå§‹æ•°æ®ç±»å‹çš„æ•´å‹å€¼å’Œå­—ç¬¦ä¸²ï¼Œå¤´éƒ¨å­—æ®µï¼Œä»¥åŠå¤´éƒ¨å­—æ®µåˆ—è¡¨ã€‚ å¤´éƒ¨å‹ç¼©éœ€è¦åœ¨æ”¯æŒ HTTP/2 çš„æµè§ˆå™¨å’ŒæœåŠ¡ç«¯ä¹‹é—´ï¼š ç»´æŠ¤ä¸€ä»½ç›¸åŒçš„é™æ€å­—å…¸ï¼ˆStatic Tableï¼‰ï¼ŒåŒ…å«å¸¸è§çš„å¤´éƒ¨åç§°ï¼Œä»¥åŠç‰¹åˆ«å¸¸è§çš„å¤´éƒ¨åç§°ä¸å€¼çš„ç»„åˆã€‚å…¶ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªï¼šå¯¹äºå®Œå…¨åŒ¹é…çš„å¤´éƒ¨é”®å€¼å¯¹ï¼Œä¾‹å¦‚ :method: GETï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºï¼›å¯¹äºå¤´éƒ¨åç§°å¯ä»¥åŒ¹é…çš„é”®å€¼å¯¹ï¼Œä¾‹å¦‚ cookie: xxxxxxxï¼Œå¯ä»¥å°†åç§°cookieä½¿ç”¨ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºã€‚ ç»´æŠ¤ä¸€ä»½ç›¸åŒçš„åŠ¨æ€å­—å…¸ï¼ˆDynamic Tableï¼‰ï¼Œå¯ä»¥åŠ¨æ€åœ°æ·»åŠ å†…å®¹ã€‚å¯¹äºcookie: xxxxxxx è¿™æ ·çš„å†…å®¹ï¼Œå¯ä»¥å°†å…¶æ·»åŠ åˆ°åŠ¨æ€å­—å…¸ä¸­ï¼Œä¹‹åæ•´ä¸ªé”®å€¼å¯¹åªä½¿ç”¨å­—æ®µä¸­æ›¿ä»£çš„å­—ç¬¦æ¥è¡¨ç¤ºå³å¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŠ¨æ€å­—å…¸ä¸Šä¸‹æ–‡æœ‰å…³ï¼Œéœ€è¦ä¸ºæ¯ä¸ª HTTP/2 è¿æ¥ç»´æŠ¤ä¸åŒçš„å­—å…¸ã€‚ æ”¯æŒåŸºäºé™æ€å“ˆå¤«æ›¼ç è¡¨çš„å“ˆå¤«æ›¼ç¼–ç ï¼ˆHuffman Codingï¼‰ï¼› ä½¿ç”¨å­—å…¸å¯ä»¥æå¤§åœ°æå‡å‹ç¼©æ•ˆæœï¼Œå…¶ä¸­é™æ€å­—å…¸åœ¨é¦–æ¬¡è¯·æ±‚ä¸­å°±å¯ä»¥ä½¿ç”¨ã€‚å¯¹äºé™æ€ã€åŠ¨æ€å­—å…¸ä¸­ä¸å­˜åœ¨çš„å†…å®¹ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å“ˆå¤«æ›¼ç¼–ç æ¥å‡å°ä½“ç§¯ã€‚HTTP/2 ä½¿ç”¨äº†ä¸€ä»½é™æ€å“ˆå¤«æ›¼ç è¡¨ï¼Œä¹Ÿéœ€è¦å†…ç½®åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹ä¸­ã€‚ ä¸‹é¢çš„è¡¨æ ¼æˆªå–äº†éƒ¨åˆ†é™æ€å­—å…¸çš„å†…å®¹ï¼š 2.3 æœåŠ¡å™¨æ¨é€ï¼ˆserver pushï¼‰Server Push å³æœåŠ¡ç«¯èƒ½é€šè¿‡ push çš„æ–¹å¼å°†å®¢æˆ·ç«¯éœ€è¦çš„å†…å®¹é¢„å…ˆæ¨é€è¿‡å»ï¼Œä¹Ÿå«â€œcache pushâ€ã€‚è¿™ä¸ªæ–°ç‰¹æ€§æ˜¯æœ‰äº›é¢ è¦†äº†ä¼ ç»Ÿçš„HTTPæ¨¡å¼çš„ï¼Œå› ä¸ºä¼ ç»Ÿçš„HTTPæ¨¡å¼æ˜¯å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆrequestï¼‰èµ„æºï¼Œç„¶åæœåŠ¡å™¨æ‰ä¼šè¿”å›ï¼ˆresponseï¼‰å¯¹åº”çš„èµ„æºï¼Œè€ŒServer Pushçš„æ–¹å¼æ˜¯æœåŠ¡å™¨ä¸»åŠ¨å°†èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ã€‚ å¯ä»¥æƒ³è±¡ä»¥ä¸‹æƒ…å†µï¼ŒæŸäº›èµ„æºå®¢æˆ·ç«¯æ˜¯ä¸€å®šä¼šè¯·æ±‚çš„ï¼Œè¿™æ—¶å°±å¯ä»¥é‡‡å–æœåŠ¡ç«¯ push çš„æŠ€æœ¯ï¼Œæå‰ç»™å®¢æˆ·ç«¯æ¨é€å¿…è¦çš„èµ„æºï¼Œè¿™æ ·å°±å¯ä»¥ç›¸å¯¹å‡å°‘ä¸€ç‚¹å»¶è¿Ÿæ—¶é—´ã€‚ä¾‹å¦‚æœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨æŠŠ JS å’Œ CSS æ–‡ä»¶æ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸éœ€è¦å®¢æˆ·ç«¯è§£æ HTML æ—¶å†å‘é€è¿™äº›è¯·æ±‚ã€‚ æœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨æ¨é€ï¼Œå®¢æˆ·ç«¯ä¹Ÿæœ‰æƒåˆ©é€‰æ‹©æ˜¯å¦æ¥æ”¶ã€‚å¦‚æœæœåŠ¡ç«¯æ¨é€çš„èµ„æºå·²ç»è¢«æµè§ˆå™¨ç¼“å­˜è¿‡ï¼Œæµè§ˆå™¨å¯ä»¥é€šè¿‡å‘é€ RST_STREAM å¸§æ¥æ‹’æ”¶ã€‚å®é™…ä¸ŠæœåŠ¡å™¨åº”è¯¥é¿å…æ¨é€å·²ç»è¢«å®¢æˆ·ç«¯ç¼“å­˜äº†çš„èµ„æºï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡åˆ¤æ–­è¯·æ±‚ä¸­çš„ç¼“å­˜ç›¸å…³å­—æ®µæ¥ç¡®å®šæ˜¯å¦éœ€è¦æ¨é€ã€‚ä¸»åŠ¨æ¨é€ä¹Ÿéµå®ˆåŒæºç­–ç•¥ï¼Œæ¢å¥è¯è¯´ï¼ŒæœåŠ¡å™¨ä¸èƒ½éšä¾¿å°†ç¬¬ä¸‰æ–¹èµ„æºæ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œå¿…é¡»æ˜¯ç»è¿‡åŒæ–¹ç¡®è®¤æ‰è¡Œã€‚ è¿˜å¯ä»¥ä½¿ç”¨server pushå¯ä»¥æå‰å°†éœ€è¦åŠ è½½çš„èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œè¿™æ ·è¿˜å¯ä»¥æœ‰æ•ˆæå‡é¡µé¢çš„åŠ è½½é€Ÿåº¦ï¼š ä»ä¸Šé¢ä¸¤å¼ å›¾ç‰‡çš„å¯¹æ¯”ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¤§å°ä¸º50KBå·¦å³çš„main.cssæ–‡ä»¶åœ¨ä½¿ç”¨äº†æœåŠ¡å™¨æ¨é€åŠŸèƒ½ä¹‹åçš„åŠ è½½æ—¶é—´ä»åŸæ¥çš„73.98mså˜ä¸º19.54msã€‚ 3ã€HTTP2åå•†æœºåˆ¶ç”±äºç›®å‰å¹¶ä¸æ˜¯æ‰€æœ‰çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒHTTP2ï¼Œå› æ­¤åœ¨å»ºç«‹HTTPè¿æ¥çš„è¿‡ç¨‹ä¸­å¿…ç„¶ä¼šå­˜åœ¨ä¸€ä¸ªåå•†çš„è¿‡ç¨‹ï¼Œå…·ä½“çš„åå•†æµç¨‹å¦‚ä¸‹ï¼š 4ã€HTTP2çš„ä¸è¶³HTTP2åœ¨æˆ‘ä¸ªäººçœ‹æ¥åœ¨åè®®çš„è®¾è®¡æ–¹é¢åº”è¯¥å·²ç»æ˜¯å‘æŒ¥äº†ç›®å‰çš„å…¨éƒ¨æ€§èƒ½ï¼Œé™¤éæœ‰ä»€ä¹ˆæƒŠäººçš„å‹ç¼©ç®—æ³•ä¹‹ç±»çš„å‡ºç°ï¼Œå¦åˆ™å¾ˆéš¾å†æœ‰æå¤§çš„æ”¹è¿›ï¼ˆå®é™…ä¸ŠHTTP2å¯¹æ¯”HTTP1.1åœ¨å®é™…åº”ç”¨ä¸Šçš„æ€§èƒ½æå‡ä¹Ÿå¹¶ä¸ç®—ç‰¹åˆ«å¤§ï¼‰ã€‚ä½†æ˜¯ç”±äºHTTPåè®®çš„ä¼ è¾“å±‚è¿˜æ˜¯ä½¿ç”¨çš„TCPï¼Œè¿™å°±å¯¼è‡´äº†å¯èƒ½ä¼šå‡ºç°TCPçš„ä¸€äº›é—®é¢˜ã€‚ ä¾‹å¦‚åœ¨å¤šè·¯å¤ç”¨çš„æƒ…å†µä¸‹ï¼Œ ä¸€èˆ¬æ¥è¯´åŒä¸€åŸŸåä¸‹åªéœ€è¦ä½¿ç”¨ä¸€ä¸ª TCP è¿æ¥ã€‚ä½†å½“è¿™ä¸ªè¿æ¥ä¸­å‡ºç°äº†ä¸¢åŒ…çš„æƒ…å†µï¼ŒTCPçš„ç‰¹æ€§ä¼šéœ€è¦é‡æ–°ä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŠŠæ‰€æœ‰çš„è¯·æ±‚éƒ½é‡æ–°ä¼ è¾“ä¸€æ¬¡ï¼Œé‚£å°±ä¼šå¯¼è‡´ HTTP/2 çš„è¡¨ç°æƒ…å†µåå€’ä¸å¦‚ HTTP/1.1 äº†ã€‚å› ä¸ºåœ¨å‡ºç°ä¸¢åŒ…çš„æƒ…å†µä¸‹ï¼Œæ•´ä¸ª TCP éƒ½è¦å¼€å§‹ç­‰å¾…é‡ä¼ ï¼Œä¹Ÿå°±å¯¼è‡´äº†åé¢çš„æ‰€æœ‰æ•°æ®éƒ½è¢«é˜»å¡äº†ã€‚ä½†æ˜¯å¯¹äº HTTP/1.1 æ¥è¯´ï¼Œå¯ä»¥å¼€å¯å¤šä¸ª TCP è¿æ¥ï¼Œå‡ºç°è¿™ç§æƒ…å†µååˆ°åªä¼šå½±å“å…¶ä¸­ä¸€ä¸ªè¿æ¥ï¼Œå‰©ä½™çš„ TCP è¿æ¥è¿˜å¯ä»¥æ­£å¸¸ä¼ è¾“æ•°æ®ã€‚è¿™ç§æƒ…å†µå’Œé˜Ÿå¤´å µå¡æƒ…å†µæœ‰äº›ç±»ä¼¼ï¼Œä½†æ˜¯HTTP2çš„è¿™ç§æƒ…å†µä¸€èˆ¬ä¼šå‡ºç°åœ¨ç½‘ç»œè¾ƒå·®çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´HTTP2ä¼šæœ‰ä¸€ç§å¿«çš„æ›´å¿«ï¼Œæ…¢çš„æ›´æ…¢çš„å€¾å‘ã€‚ Head-Of-Line Blockingï¼ˆHOLBï¼‰ï¼šå¯¼è‡´å¸¦å®½æ— æ³•è¢«å……åˆ†åˆ©ç”¨ï¼Œä»¥åŠåç»­å¥åº·è¯·æ±‚è¢«é˜»å¡ã€‚HOLBæ˜¯æŒ‡ä¸€ç³»åˆ—åŒ…ï¼ˆpackageï¼‰å› ä¸ºç¬¬ä¸€ä¸ªåŒ…è¢«é˜»å¡ï¼›å½“é¡µé¢ä¸­éœ€è¦è¯·æ±‚å¾ˆå¤šèµ„æºçš„æ—¶å€™ï¼ŒHOLBï¼ˆé˜Ÿå¤´é˜»å¡ï¼‰ä¼šå¯¼è‡´åœ¨è¾¾åˆ°æœ€å¤§è¯·æ±‚æ•°é‡æ—¶ï¼Œå‰©ä½™çš„èµ„æºéœ€è¦ç­‰å¾…å…¶ä»–èµ„æºè¯·æ±‚å®Œæˆåæ‰èƒ½å‘èµ·è¯·æ±‚ã€‚","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"SSL/TLSã€å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†å’ŒTLSv1.3","slug":"20200602-encryption-intro","date":"2020-06-02T02:00:00.000Z","updated":"2020-06-02T02:00:00.000Z","comments":true,"path":"20200602-encryption-intro/","link":"","permalink":"https://tinychen.com/20200602-encryption-intro/","excerpt":"æœ¬æ–‡ä¸»è¦å¯¹å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„åŸç†ä»¥åŠè¿‡ç¨‹è¿›è¡Œåˆ†æï¼ŒåŒæ—¶è¿˜ä¼šç®€å•ä»‹ç»ä¸€ä¸‹TLS/SSLçš„ä¸€äº›ç›¸å…³å†…å®¹ï¼Œå¹¶ä¸”å¯¹æ¯”TLSv1.2å’ŒTLSv1.3çš„ä¸åŒã€‚","text":"æœ¬æ–‡ä¸»è¦å¯¹å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„åŸç†ä»¥åŠè¿‡ç¨‹è¿›è¡Œåˆ†æï¼ŒåŒæ—¶è¿˜ä¼šç®€å•ä»‹ç»ä¸€ä¸‹TLS/SSLçš„ä¸€äº›ç›¸å…³å†…å®¹ï¼Œå¹¶ä¸”å¯¹æ¯”TLSv1.2å’ŒTLSv1.3çš„ä¸åŒã€‚ 1ã€SSLå’ŒTLSçš„å†å²å…¶å®æ—©æœŸçš„äº’è”ç½‘åè®®åŸºæœ¬éƒ½æ˜¯ä¸åŠ å¯†è¿›è¡Œä¼ è¾“çš„ï¼Œå¦‚HTTPã€FTPã€telnet.ç­‰åè®®çš„ ä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼ˆè‹±è¯­ï¼šTransport Layer Securityï¼Œç¼©å†™ï¼šTLSï¼‰åŠå…¶å‰èº«å®‰å…¨å¥—æ¥å±‚ï¼ˆè‹±è¯­ï¼šSecure Sockets Layerï¼Œç¼©å†™ï¼šSSLï¼‰çš„å†å²è¿›ç¨‹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š åè®® å‘å¸ƒæ—¶é—´ çŠ¶æ€ SSL 1.0 æœªå…¬å¸ƒ æœªå…¬å¸ƒ SSL 2.0 1995å¹´ å·²äº2011å¹´å¼ƒç”¨ SSL 3.0 1996å¹´ å·²äº2015å¹´å¼ƒç”¨ TLS 1.0 1999å¹´ å·²äº2020å¹´å¼ƒç”¨ TLS 1.1 2006å¹´ å·²äº2020å¹´å¼ƒç”¨ TLS 1.2 2008å¹´ TLS 1.3 2018å¹´ TLS 1.0 äº1999å¹´å‘å¸ƒä¸ºRFC 2246 TLS 1.1 äº2006å¹´ä½œä¸ºRFC 4346å‘å¸ƒ TLS 1.2 äº2008å¹´å‘å¸ƒä¸ºRFC 5246 TLS 1.3 äº2018å¹´8æœˆä½œä¸ºå»ºè®®æ ‡å‡†åœ¨RFC 8446å‘å¸ƒ SSLï¼ˆSecure Sockets Layerï¼‰æ˜¯ç½‘æ™¯å…¬å¸ï¼ˆNetscapeï¼‰è®¾è®¡çš„ä¸»è¦ç”¨äºWebçš„å®‰å…¨ä¼ è¾“åè®®ï¼Œè¿™ç§åè®®åœ¨Webä¸Šè·å¾—äº†å¹¿æ³›çš„åº”ç”¨ã€‚SSL1.0æ²¡æœ‰è¢«å…¬å¼€å‘å¸ƒè¿‡ï¼Œ1995 ç½‘æ™¯å…¬å¸å‘å¸ƒSSL2.0ï¼Œä½†æ˜¯ç”±äºSSL2.0æœ‰ä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼Œå› æ­¤1996å¹´åˆå‘å¸ƒäº†SSL3.0ã€‚ ä½†æ˜¯åœ¨2014å¹´10æœˆï¼ŒGoogleå‘å¸ƒåœ¨SSL 3.0ä¸­å‘ç°è®¾è®¡ç¼ºé™·ï¼Œå»ºè®®ç¦ç”¨æ­¤ä¸€åè®®ã€‚æ”»å‡»è€…å¯ä»¥å‘TLSå‘é€è™šå‡é”™è¯¯æç¤ºï¼Œç„¶åå°†å®‰å…¨è¿æ¥å¼ºè¡Œé™çº§åˆ°è¿‡æ—¶ä¸”ä¸å®‰å…¨çš„SSL 3.0ï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨å…¶ä¸­çš„è®¾è®¡æ¼æ´çªƒå–æ•æ„Ÿä¿¡æ¯ã€‚Googleåœ¨è‡ªå·±å…¬å¸ç›¸å…³äº§å“ä¸­é™†ç»­ç¦æ­¢å›æº¯å…¼å®¹ï¼Œå¼ºåˆ¶ä½¿ç”¨TLSåè®®ã€‚Mozillaä¹Ÿåœ¨11æœˆ25æ—¥å‘å¸ƒçš„Firefox 34ä¸­å½»åº•ç¦ç”¨äº†SSL 3.0ã€‚å¾®è½¯åŒæ ·å‘å‡ºäº†å®‰å…¨é€šå‘Šã€‚è¿™å°±æ˜¯SSL3.0åœ¨2015å¹´è¢«å¼ƒç”¨çš„åŸå› ã€‚ä½†æ˜¯ç”±äºSSLå­˜åœ¨çš„æ—¶é—´å¤ªé•¿äº†ï¼Œäººä»¬ä»¥åŠä¹ æƒ¯ç”¨SSLè¿™ä¸ªåè¯æ¥æŒ‡ä»£åŠ å¯†çš„å®‰å…¨ä¼ è¾“åè®®ï¼Œå› æ­¤æˆ‘ä»¬è¦çŸ¥é“ç°åœ¨è¯´çš„SSLç»å¤§å¤šæ•°éƒ½æ˜¯è¯´çš„TLSåŠ å¯†ã€‚ ä¼—æ‰€å‘¨çŸ¥å½“å¹´çš„æµè§ˆå™¨å¤§æˆ˜å¾®è½¯æˆ˜èƒœäº†ç½‘æ™¯ï¼Œè€Œåç½‘æ™¯å°†SSLåè®®çš„ç®¡ç†æƒäº¤ç»™äº†æ ‡å‡†åŒ–ç»„ç»‡IETFï¼ˆInternet Engineering Task Forceï¼‰ã€‚1999å¹´ï¼ŒIETFåœ¨SSL3.0çš„åŸºç¡€ä¸Šè¿›è¡Œå‘å¸ƒäº†TLSåè®®çš„1.0ç‰ˆæœ¬ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯TLS1.0ç‰ˆæœ¬å’ŒSSL3.0ç‰ˆæœ¬çš„åŒºåˆ«å¾ˆå°ï¼Œå¹¶ä¸”TLS1.0æ˜¯å¯ä»¥é™çº§åˆ°SSL3.0æ¥ä½¿ç”¨çš„ï¼Œä¹‹æ‰€ä»¥æ¢åå­—ä¸»è¦æ˜¯ä¸ºäº†é¿å…ä¸€äº›ç‰ˆæƒå’Œæ³•å¾‹çš„é—®é¢˜ã€‚è¿™ä¹Ÿå°±å¯¼è‡´äº†åæ¥è°·æ­Œç¦æ­¢TLSå›æº¯å…¼å®¹SSLåè®®ä»è€Œé¿å…å®‰å…¨äº‹æ•…çš„å‘é€ã€‚æ³¨æ„å…¶å®æ‰€æœ‰TLSç‰ˆæœ¬åœ¨2011å¹´3æœˆå‘å¸ƒçš„RFC 6176ä¸­åˆ é™¤äº†å¯¹SSL2.0çš„å…¼å®¹ï¼Œè¿™æ ·TLSä¼šè¯å°†æ°¸è¿œæ— æ³•åå•†ä½¿ç”¨çš„SSL 2.0ä»¥é¿å…å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯è¿˜æ˜¯å¯ä»¥é™çº§åå•†åˆ°SSL3.0çš„ã€‚ 123456RFC 6176çš„åŸæ–‡æ‘˜è¦å¦‚ä¸‹ï¼š This document requires that when Transport Layer Security (TLS) clients and servers establish connections, they never negotiate the use of Secure Sockets Layer (SSL) version 2.0. This document updates the backward compatibility sections found in the Transport Layer Security (TLS). TLS 1.1åœ¨ RFC 4346 ä¸­å®šä¹‰ï¼Œäº2006å¹´4æœˆå‘è¡¨ã€‚TLS 1.2åœ¨ RFC 5246 ä¸­å®šä¹‰ï¼Œäº2008å¹´8æœˆå‘è¡¨ã€‚TLS 1.3åœ¨ RFC 8446 ä¸­å®šä¹‰ï¼Œäº2018å¹´8æœˆå‘è¡¨ã€‚å®é™…ä¸Šç°ä»£çš„æµè§ˆå™¨å·²ç»åŸºæœ¬ä¸ä½¿ç”¨ SSLï¼Œä½¿ç”¨çš„éƒ½æ˜¯ TLSï¼Œè€Œç›®å‰ä¸»æµä½¿ç”¨çš„åŠ å¯†åè®®ç‰ˆæœ¬æ˜¯TLS1.2å’ŒTLS1.3ã€‚ 2ã€SSL/TLSå±äºå“ªä¸€å±‚è¿™ä¸ªé—®é¢˜ååˆ†æœ‰æ„æ€ï¼Œä»å‰é¢çš„å‘å±•å†å²ä¸­æˆ‘ä»¬ä¸éš¾çŸ¥é“ï¼ŒTLSå¯ä»¥è§†ä¸ºæ˜¯SSLçš„é«˜çº§ç‰ˆæœ¬ï¼ˆä¸»è¦ä½“ç°åœ¨æ›´åŠ å®‰å…¨ä¸Šï¼‰ï¼Œè€Œä»TLSçš„åå­—ï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼‰å°±ä¼šè§‰å¾—å®ƒåº”è¯¥æ˜¯ä¼ è¾“å±‚çš„åè®®ï¼Œå½“ç„¶è¿™å¯èƒ½å°±æœ›æ–‡ç”Ÿä¹‰äº†ï¼Œå®é™…ä¸Šåœ¨ç½‘ä¸Šæœ‰ä¸å°‘çš„æ–‡ç« åœ¨è®¨è®ºTLS/SSLå±äºåº”ç”¨å±‚è¿˜æ˜¯ä¼ è¾“å±‚ï¼Œå®é™…ä¸Šçš„æƒ…å†µè¦æ›´ä¸ºå¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬å…ˆæ¥ææ¸…æ¥šåœ¨ä¸åŒçš„ç½‘ç»œæ¨¡å‹ä¸­å¯¹äºä¸åŒå±‚çš„åˆ’åˆ†ã€‚ é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€èˆ¬è¯´çš„ä¸ƒå±‚åè®®æŒ‡çš„æ˜¯åœ¨OSIæ¨¡å‹åè®®ï¼Œè€Œåœ¨TCP/IPæ¨¡å‹ä¸­ç½‘ç»œè¢«åˆ’åˆ†ä¸ºå››å±‚ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸‹é¢çš„ç¤ºæ„å›¾ï¼š åŸå§‹ç‰ˆæœ¬çš„OSIæ¨¡å‹åˆ’åˆ†å¾—å¤ªç»†ï¼ŒTCP/IPæ¨¡å‹åˆåˆ’åˆ†å¾—å¤ªç²—ï¼Œäºæ˜¯äººä»¬æŠŠä¸¤è€…ç»“åˆï¼Œå°†OSIæ¨¡å‹ä¸­çš„5ã€6ã€7ä¸‰å±‚ç»Ÿä¸€ä¸ºåº”ç”¨å±‚ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªå‡çº§ç‰ˆçš„äº”å±‚ç½‘ç»œæ¨¡å‹ã€‚ é¦–å…ˆæˆ‘ä»¬å¯¹SSL/TLSçš„ä½œç”¨è¿›è¡Œåˆ†æï¼šSSL/TLSæœ€åˆæ˜¯ä¸ºäº†ç»™HTTPåè®®åŠ å¯†ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯HTTPSåè®®ï¼Œé€šå¸¸æ¥è¯´æˆ‘ä»¬å¯ä»¥è®¤ä¸ºHTTP+SSL/TLS=HTTPSï¼Œè€Œå®é™…ä¸Šç°åœ¨æˆ‘ä»¬çš„å¾ˆå¤šå…¶ä»–åº”ç”¨å±‚åè®®éƒ½å¯ä»¥ä½¿ç”¨SSL/TLSï¼Œæ¯”å¦‚SSHã€FTPSã€POP3Sã€IMAPSç­‰ç­‰ã€‚å†ä»¥HTTPSä¸ºä¾‹ï¼Œä¸€ä¸ªHTTPSå»ºç«‹è¿æ¥éœ€è¦ç»è¿‡TCPæ¡æ‰‹å»ºç«‹è¿æ¥è¿™ä¸€æ­¥éª¤çš„ï¼Œä¹Ÿå°±æ˜¯è¯´HTTPSè¿˜æ˜¯åŸºäºTCPçš„ï¼Œè€ŒTCPå±äºä¼ è¾“å±‚è¿™æ˜¯æ¯«æ— äº‰è®ºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ä»åˆ’åˆ†æœ€ç»†çš„OSIä¸ƒå±‚å‚è€ƒæ¨¡å‹æ¥çœ‹ï¼ŒSSL/TLSåº”è¯¥æ˜¯åœ¨ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ä¹‹é—´ã€‚ å®é™…ä¸Šä»SSL/TLSçš„åŠŸèƒ½æ¥åˆ†æï¼š SSL Record Protocolï¼ˆSSLè®°å½•åè®®ï¼‰ï¼Œå®ƒå»ºç«‹åœ¨å¯é çš„ä¼ è¾“åè®®ï¼ˆå¦‚TCPï¼‰ä¹‹ä¸Šï¼ŒSSL/TLSä½¿ç”¨äº†åŒå‘å­—èŠ‚æµä¼ è¾“ï¼ˆå…¨åŒå·¥ï¼‰ï¼Œä¸ºé«˜å±‚åè®®æä¾›æ•°æ®å°è£…ã€å‹ç¼©ã€åŠ å¯†ç­‰åŸºæœ¬åŠŸèƒ½çš„æ”¯æŒï¼Œä»åŠŸèƒ½ä¸Šçœ‹è¿™åº”è¯¥æ˜¯OSIçš„L6ï¼ˆè¡¨ç¤ºå±‚ï¼‰ SSL Handshake Protocolï¼ˆSSLæ¡æ‰‹åè®®ï¼‰ï¼šå®ƒå»ºç«‹åœ¨SSLè®°å½•åè®®ä¹‹ä¸Šï¼Œç”¨äºåœ¨å®é™…çš„æ•°æ®ä¼ è¾“å¼€å§‹å‰ï¼Œé€šè®¯åŒæ–¹è¿›è¡Œèº«ä»½è®¤è¯ã€åå•†åŠ å¯†ç®—æ³•ã€äº¤æ¢åŠ å¯†å¯†é’¥ç­‰ï¼Œä»åŠŸèƒ½ä¸Šçœ‹è¿™åº”è¯¥æ˜¯OSIçš„L5ï¼ˆä¼šè¯å±‚ï¼‰ é¦–å…ˆï¼ŒSSLåè®®åˆ†ä¸ºSSLæ¡æ‰‹åè®®å’ŒSSLè®°å½•åè®®ã€‚è®°å½•åè®®å·¥ä½œåœ¨TCPä¹‹ä¸Šï¼Œæ¡æ‰‹åè®®å·¥ä½œåœ¨è®°å½•åè®®ä¹‹ä¸Šã€‚ è€Œä¸ä¹‹ç›¸å¯¹åº”çš„ä¸ƒå±‚ç»“æ„ä¸­ï¼Œä¼ è¾“å±‚ä¹‹ä¸Šæ˜¯ä¼šè¯å±‚ï¼Œä¼šè¯å±‚ä¹‹ä¸Šæ˜¯è¡¨ç¤ºå±‚ã€‚ ä¸€ã€ä¼šè¯å±‚è´Ÿè´£å»ºç«‹å’Œä½ç½®ä¼šè¯ï¼Œå¾ˆæ˜æ˜¾SSLæ¡æ‰‹åè®®å°±æ˜¯å¹²è¿™ä¸ªäº‹çš„ã€‚ äºŒã€è¡¨ç¤ºå±‚å¯¹ç»Ÿä¸€ä¼ è¾“æ–¹å¼ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ä¹‹ç±»çš„å‰ç½®å¤„ç†ã€‚è¿™ä¸ªåº”è¯¥æ˜¯SSLè®°å½•åè®®è¦åšçš„äº‹æƒ…ã€‚ æ‰€ä»¥å¦‚æœçœŸè¦è¯´å¯¹åº”å…³ç³»ï¼Œåº”è¯¥æ˜¯SSLæ¡æ‰‹åè®®å¯¹åº”ä¼šè¯å±‚ï¼Œ SSLè®°å½•åè®®å¯¹åº”è¡¨ç¤ºå±‚ï¼Œä½†æ˜¯è¿™åˆä¸SSLæ¡æ‰‹åè®®åœ¨SSLè®°å½•åè®®ä¹‹ä¸Šç›¸è¿èƒŒã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºç»“è®ºï¼šOSIä¸ƒå±‚æ¨¡å‹å¹¶ä¸é€‚ç”¨äºSSL/TLSåè®®ï¼Œè¿™ä¸ªäººä¸ºè®¾è®¡çš„ç†è®ºå‚è€ƒæ¨¡å‹å¹¶ä¸èƒ½å®Œç¾åœ°å¥—ç”¨åœ¨æ¯ä¸€ä¸ªç½‘ç»œåè®®ä¸Šï¼Œå¯èƒ½è¿™ä¹Ÿæ˜¯OSIæ¨¡å‹è¢«å¼ƒç”¨çš„åŸå› ä¹‹ä¸€å§ã€‚ é‚£ä¹ˆå¯¹åº”äº”å±‚çš„ç½‘ç»œæ¨¡å‹å‘¢ï¼Ÿç”±äºOSIæ¨¡å‹ä¸­çš„L5ã€L6ã€L7éƒ½åˆå¹¶æˆäº†åº”ç”¨å±‚ï¼Œæ‰€ä»¥SSL/TLSåº”è¯¥æ˜¯å±äºä¼ è¾“å±‚å’Œåº”ç”¨å±‚äº†ã€‚ 3ã€å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†è®²åˆ°åŠ å¯†ï¼Œå¿…ç„¶éœ€è¦ç†è§£åŠ å¯†ç®—æ³•ï¼Œè€ŒåŠ å¯†ç®—æ³•ä¸€èˆ¬æ¥è¯´å¯ä»¥åˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ä¸¤ç§ã€‚ è¿™é‡Œçš„å¯¹ç§°å’Œéå¯¹ç§°æ˜¯é’ˆå¯¹åŠ å¯†å’Œè§£å¯†è¿™ä¸¤ä¸ªæ“ä½œè€Œè¨€çš„ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯æ¶ˆæ¯å‘é€æ–¹å‘é€æ¶ˆæ¯æ—¶éœ€è¦åŠ å¯†ï¼Œæ¶ˆæ¯æ¥æ”¶æ–¹åœ¨æ¥æ”¶æ¶ˆæ¯åéœ€è¦è¿›è¡Œè§£å¯†ã€‚å¦‚æœåŠ å¯†å’Œè§£å¯†ç”¨çš„å¯†é’¥æ˜¯ç›¸åŒçš„ï¼Œåˆ™æ˜¯å¯¹ç§°åŠ å¯†ï¼›å¦‚æœä¸åŒåˆ™æ˜¯éå¯¹ç§°åŠ å¯†ã€‚ 3.1 å¯¹ç§°åŠ å¯†å¯¹ç§°åŠ å¯†ç®—æ³•çš„ç‰¹ç‚¹æ˜¯ç®—æ³•å…¬å¼€ã€è®¡ç®—é‡å°ã€åŠ å¯†é€Ÿåº¦å¿«ã€åŠ å¯†æ•ˆç‡é«˜ã€‚å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰AESã€DESç­‰ã€‚ å¯¹ç§°åŠ å¯†æœ€å¤§çš„é—®é¢˜åœ¨äºå¯†é’¥çš„ä¼ è¾“ï¼šå› ä¸ºå¦‚æœä¿¡æ¯çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹æ˜¯é€šè¿‡ç½‘ç»œæ¥è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œåœ¨ç½‘ç»œä¸­ä½¿ç”¨æ˜æ–‡é€šä¿¡æ˜¯ä¸å®‰å…¨çš„ï¼Œæƒ³è¦å®‰å…¨é€šä¿¡å¿…é¡»ä½¿ç”¨å¯†é’¥åŠ å¯†ï¼ŒåŒæ—¶è¦ä¿è¯å¯†é’¥åªæœ‰é€šä¿¡åŒæ–¹çŸ¥é“ï¼Œä½†æ˜¯åœ¨ä¼ è¾“å¯†é’¥ä¹‹å‰åŒæ–¹å¹¶æ²¡æœ‰ä¸€ä¸ªå®‰å…¨å¯é åŒæ–¹éƒ½çŸ¥é“çš„å¯†é’¥ã€‚å¦‚æœæœ€å¼€å§‹çš„å¯†é’¥ä¼ è¾“è¿‡ç¨‹ä½¿ç”¨æ˜æ–‡ï¼Œå°±å¯èƒ½ä¼šè¢«åˆ«æœ‰ç”¨å¿ƒçš„äººæˆªè·å¯†é’¥ï¼Œä¹‹åçš„åŠ å¯†å°±æ¯«æ— æ„ä¹‰ã€‚æœ€ä¿é™©çš„æ–¹æ³•å°±æ˜¯çº¿ä¸‹ä¼ è¾“å¯†é’¥ç„¶åå†çº¿ä¸Šé€šä¿¡ï¼Œå¯ä»¥å‚è€ƒè°æˆ˜ç‰‡ä¸­çš„ç‰¹åŠ¡èˆç”Ÿå–ä¹‰æŠ¤é€å¯†ç æœ¬ï¼Œä½†æ˜¯è¿™åœ¨äº’è”ç½‘æ—¶ä»£æ˜¾ç„¶ä¸é è°±ã€‚ 3.2 éå¯¹ç§°åŠ å¯†è¿™æ—¶å€™éå¯¹ç§°åŠ å¯†å°±å‡ºç°äº†ï¼Œéå¯¹ç§°åŠ å¯†æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æŠŠå¯†é’¥è¿›è¡Œåˆ†ç¦»ï¼Œå°†å…¶åˆ†æˆå…¬é’¥å’Œç§é’¥ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸»è¦æœ‰ RSA ã€ DSA ã€ECCç­‰ã€‚ é¡¾åæ€ä¹‰ï¼Œå…¬é’¥æ˜¯å¯ä»¥ç”¨åœ¨äº’è”ç½‘ä¸­éšæ„ä¼ æ’­çš„ï¼Œè€Œç§é’¥åˆ™æ˜¯éœ€è¦è‡ªå·±å°å¿ƒä¿å­˜é¿å…æ³„éœ²çš„ã€‚æ¶ˆæ¯çš„å‘é€æ–¹åªéœ€è¦çŸ¥é“æ¶ˆæ¯æ¥å—æ–¹çš„å…¬é’¥ï¼Œå³å¯å°†æ˜æ–‡é€šè¿‡å…¬é’¥åŠ å¯†ç„¶åé€šè¿‡ç½‘ç»œä¼ è¾“ç»™æ¶ˆæ¯æ¥æ”¶æ–¹ã€‚æ¶ˆæ¯æ¥æ”¶æ–¹æ”¶åˆ°å¯†æ–‡åï¼Œé€šè¿‡éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œå³å¯è·å–æ¶ˆæ¯å†…å®¹ã€‚ è¿™é‡Œé¢æœ‰å‡ ä¸ªç‚¹éœ€è¦é¢å¤–å…³æ³¨ä¸€ä¸‹ï¼š å…¬é’¥æ˜¯æ‰€æœ‰äººéƒ½å¯ä»¥è·å–çš„ï¼Œå› æ­¤æƒ³è¦ç»™æ¥æ”¶æ–¹å‘é€æ¶ˆæ¯åªéœ€è¦è·å–å…¬é’¥å³å¯ï¼Œæ‰€ä»¥å…¬é’¥å¯ä»¥ç”¨æ˜æ–‡ç›´æ¥ä¼ è¾“ï¼Œå› ä¸ºå³ä½¿æ˜¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ³„éœ²äº†å…¬é’¥ï¼Œç”±äºè§£å¯†åªèƒ½ä½¿ç”¨ç§é’¥ï¼Œå› æ­¤æ•´ä¸ªæ•°æ®ä¼ è¾“ä¹Ÿè¿˜æ˜¯å®‰å…¨çš„ åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä¸€èˆ¬ä¸¤è¾¹éƒ½æ¶‰åŠåˆ°æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶ï¼Œå› æ­¤åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä¸€èˆ¬ä¼šæœ‰ä¸¤å¥—å¯†é’¥å¯¹ å¯ä»¥æ ¹æ®ç§é’¥ç”Ÿæˆå…¬é’¥ï¼Œåä¹‹ä¸è¡Œ æ¶ˆæ¯å‘é€æ–¹æ˜¯æ— æ³•å¯¹å‘é€å‡ºå»çš„å¯†æ–‡è§£å¯†çš„ï¼Œå®ƒåªèƒ½è¯»å–è‡ªå·±ä¿å­˜çš„æ˜æ–‡æ¥äº†è§£ä¹‹å‰å‘é€è¿‡çš„æ¶ˆæ¯ 3.3 æ•°å­—è¯ä¹¦åœ¨é€šä¿¡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œå› ä¸ºç§é’¥æ˜¯è‡ªå·±æ‰æœ‰çš„ï¼Œè€Œä¼ è¾“çš„ä¿¡æ¯æ˜¯ä¸å®‰å…¨çš„å¯èƒ½è¢«åˆ«äººæˆªè·çš„ï¼Œä½†æ˜¯åªè¦å¯¹å…¶è¿›è¡ŒåŠ å¯†ï¼Œç„¶åä¿è¯è‡ªå·±æ‰èƒ½è§£å¯†ï¼Œå°±å¯ä»¥è®¤ä¸ºä¼ è¾“ä¿¡æ¯æ˜¯å®‰å…¨çš„ã€‚è¿™å°±å¥½æ¯”ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆå®‰å…¨çš„ä¿é™©ç®±æ¥å­˜æ”¾é‡è¦èµ„æ–™å†å¿«é€’åˆ°åˆ«çš„åœ°æ–¹å»ï¼Œåªè¦ä¿è¯åªæœ‰è‡ªå·±èƒ½å¤Ÿè§£é”ä¿é™©ç®±ï¼Œé‚£ä¹ˆè¿è¾“è¿‡ç¨‹ä¸­ä¿é™©ç®±ä¼šè¢«è°æ¥è§¦åˆ°éƒ½ä¸é‡è¦ï¼Œåªè¦ä¿é™©ç®±é€åˆ°ç›®çš„åœ°å°±å¯ä»¥äº†ã€‚ å³ä¾¿æ˜¯éå¯¹ç§°åŠ å¯†ï¼Œä¹Ÿå­˜åœ¨ä¸€ä¸ªå…¬é’¥ä¼ è¾“çš„é—®é¢˜ã€‚åŸºæœ¬ä¸Šå­˜åœ¨ç€ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯ç›´æ¥æŠŠå…¬é’¥æ”¾åˆ°ç½‘ä¸Šï¼Œç„¶åè®©éœ€è¦ä½¿ç”¨çš„ç”¨æˆ·å»ä¸‹è½½ï¼Œå¦ä¸€ç§å°±æ˜¯åœ¨é€šä¿¡ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œç”±æœåŠ¡å™¨ç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ— æ³•ä¿è¯å…¬é’¥ä¼ è¾“çš„å®‰å…¨æ€§ï¼Œè™½ç„¶å…¬é’¥æ˜¯å¯ä»¥ç»™ä»»ä½•äººçŸ¥é“çš„ï¼Œä½†æ˜¯åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å…¬é’¥å¿…é¡»æ˜¯é€šä¿¡åŒæ–¹çš„å…¬é’¥ï¼Œå¦åˆ™å¦‚æœå‡ºç°ä¸­é—´äººåŠ«æŒäº†é€šä¿¡å¹¶ä¸”å°†å…¬é’¥æ›¿æ¢ä¸ºä¸­é—´äººè‡ªå·±çš„å…¬é’¥ï¼Œé‚£ä¹ˆä¸­é—´äººå°±å¯ä»¥è·å–åˆ°é€šä¿¡å†…å®¹ã€‚ è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ•°å­—è¯ä¹¦äº†ï¼ŒåŸºäºéå¯¹ç§°åŠ å¯†å…¬ç§é’¥åˆ†ç¦»çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å…¬é’¥è¿›è¡Œå•ç‹¬æ“ä½œï¼Œç”¨äºæ•°å­—è¯ä¹¦ï¼Œä¹Ÿå«æ•°å­—è®¤è¯ï¼ˆdigital certificateï¼‰ï¼Œå³ç›¸å½“äºç°å®ç”Ÿæ´»ä¸­çš„ç­¾åï¼Œç”¨äºè¯å®èº«ä»½ã€‚ æ•°å­—è¯ä¹¦æ˜¯éƒ¨ç½²HTTPSè®¤è¯çš„ç½‘ç«™çš„å¿…éœ€å“ï¼Œæˆ‘ä»¬åœ¨è®¿é—®ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œä¸€èˆ¬ç‚¹å‡»æµè§ˆå™¨åœ°å€æ æ—è¾¹çš„å°é”å°±å¯ä»¥çœ‹åˆ°è¿™æ—¶å€™æ­£åœ¨ä½¿ç”¨çš„æ•°å­—è¯ä¹¦ï¼š ç‚¹å‡»è¿›å»å°±å¯ä»¥çœ‹åˆ°ç›¸å…³çš„è¯ä¹¦ä¿¡æ¯ã€‚è¯ä¹¦ä¸­åŒ…å«ç€ååˆ†å¤šçš„ä¿¡æ¯ï¼Œé¦–å…ˆæœ€é‡è¦çš„å½“ç„¶æ˜¯å¯¹åº”çš„åŸŸåå’Œå…¬é’¥ï¼Œå…¶ä»–çš„è¿˜æœ‰è¯ä¹¦çš„ç”Ÿæ•ˆæ—¶é—´ï¼Œä½¿ç”¨çš„åŠ å¯†ç®—æ³•ã€ç­¾åç®—æ³•ç­‰å„ç§ç›¸å…³ä¿¡æ¯ã€‚ ç­¾å‘è¯ä¹¦çš„æœºæ„è¢«ç§°ä¸º CAï¼ˆ Certificate Authorityï¼‰ï¼Œç†è®ºä¸Šæ¯ä¸ªäººéƒ½å¯ä»¥æˆä¸ºCAï¼Œå› ä¸ºæ¯ä¸ªäººéƒ½å¯ä»¥è‡ªå·±ç­¾å‘è¯ä¹¦ï¼Œä½†æ˜¯åªæœ‰æå°‘æ•°çš„æƒå¨CAé¢å‘çš„è¯ä¹¦æ‰ä¼šè¢«æ‰¿è®¤ï¼Œè¿™å‡ å¤§æƒå¨CAçš„ç§°ä¸ºROOT CAï¼Œä»–ä»¬çš„è¯ä¹¦ä¸€èˆ¬éƒ½ä¼šå†…ç½®åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæµè§ˆå™¨é»˜è®¤æ˜¯ä¿¡ä»»è¿™äº›ROOT CAçš„è¯ä¹¦çš„ï¼Œè€Œè¿™äº›ROOT CAä¸‹å±è¿˜æœ‰å…¶ä»–çš„CAï¼Œè¿™äº›ä¸‹å±çš„CAå¯ä»¥ä¸ºå„ç§ç½‘ç«™é¢å‘è¯ä¹¦ï¼Œæ ¹æ®å±‚å±‚ä¿¡ä»»çš„åŸåˆ™ï¼Œæµè§ˆå™¨ä¹Ÿä¼šä¿¡ä»»è¿™äº›CAä¸‹å‘çš„è¯ä¹¦ï¼Œæœ€ç»ˆå°±ä¿è¯äº†é€šä¿¡ä¸­å…¬é’¥ä¼ è¾“çš„å®‰å…¨ã€‚ æ—©æœŸçš„è¯ä¹¦æ˜¯éœ€è¦æ”¶è´¹çš„ï¼Œä½†æ˜¯åˆ°äº†è¿‘å‡ å¹´åŠ å¯†é€šä¿¡çš„éœ€æ±‚å¢åŠ ï¼Œå¾ˆå¤šç½‘ç«™çš„è¿è¥è€…å¹¶æ²¡æœ‰é‚£ä¹ˆå¤šé’±æ¥è´­ä¹°è¯ä¹¦ï¼ˆè¯ä¹¦è¿‡æœŸäº†ç»­è´¹ä¹Ÿæ˜¯è¦é’±çš„ï¼‰ï¼Œè¿™æ—¶å€™å°±å‡ºç°äº†ä»¥Encryption Everywhereã€ Letâ€™s Encryptç­‰ä¸ºé¦–çš„CAå¼€å§‹å¤§é‡æ™®åŠå…è´¹çš„æ•°å­—è¯ä¹¦ï¼Œå¦‚ä»Šå›½å†…çš„å¾ˆå¤šäº‘å‚å•†ä¹Ÿæä¾›äº†å„ç§å…è´¹çš„æ•°å­—è¯ä¹¦ï¼Œä»è€Œå¾ˆå¥½çš„æ¨åŠ¨äº†åŠ å¯†é€šä¿¡çš„å‘å±•ã€‚ä¸è¿‡è¿™äº›å…è´¹çš„æ•°å­—è¯ä¹¦åœ¨å®‰å…¨æ€§ä¸Šå¹¶æ²¡æœ‰ä¼ä¸šçº§çš„æ”¶è´¹è¯ä¹¦é‚£ä¹ˆé«˜ï¼Œå¤§å¤šæ•°éƒ½åªæ˜¯DVè¯ä¹¦ï¼Œå¦‚æœå¯¹å®‰å…¨æ€§æœ‰å¾ˆé«˜çš„è¿½æ±‚ï¼Œè¿˜æ˜¯å»ºè®®è´­ä¹°æ”¶è´¹çš„è¯ä¹¦ã€‚ ä¸€èˆ¬æ¥è¯´æ•°å­—è¯ä¹¦å¯ä»¥æŒ‰ç…§å®‰å…¨ç¨‹åº¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š EVï¼š**EVè¯ä¹¦(Extended Validation Certificate)**æ˜¯ä¸€ç§æ ¹æ®ä¸€ç³»åˆ—ç‰¹å®šæ ‡å‡†é¢å‘çš„X.509ç”µå­è¯ä¹¦ï¼Œæ ¹æ®è¦æ±‚ï¼Œåœ¨é¢å‘è¯ä¹¦ä¹‹å‰ï¼Œè¯ä¹¦é¢å‘æœºæ„(CA)å¿…é¡»éªŒè¯ç”³è¯·è€…çš„èº«ä»½ã€‚ä¸åŒæœºæ„æ ¹æ®è¯ä¹¦æ ‡å‡†å‘è¡Œçš„æ‰©å±•éªŒè¯è¯ä¹¦å¹¶æ— å¤ªå¤§å·®å¼‚ï¼Œä½†æ˜¯æœ‰æ—¶å€™æ ¹æ®ä¸€äº›å…·ä½“çš„è¦æ±‚ï¼Œç‰¹å®šæœºæ„å‘è¡Œçš„è¯ä¹¦å¯ä»¥è¢«ç‰¹å®šçš„è½¯ä»¶è¯†åˆ« OVï¼š**OVè¯ä¹¦(Organization Validation SSL)**ï¼ŒæŒ‡éœ€è¦éªŒè¯ç½‘ç«™æ‰€æœ‰å•ä½çš„çœŸå®èº«ä»½çš„æ ‡å‡†å‹SSLè¯ä¹¦ï¼Œæ­¤ç±»è¯ä¹¦ä¸ä»…èƒ½å¤Ÿèµ·åˆ°ç½‘ç«™ä¿¡æ¯åŠ å¯†çš„ä½œç”¨ï¼Œè€Œä¸”èƒ½å‘ç”¨æˆ·è¯æ˜ç½‘ç«™çš„çœŸå®èº«ä»½ DVï¼š**DVè¯ä¹¦(Domain Validation SSL)**ï¼ŒæŒ‡éœ€è¦éªŒè¯åŸŸåçš„æœ‰æ•ˆæ€§ã€‚è¯¥ç±»è¯ä¹¦åªæä¾›åŸºæœ¬çš„åŠ å¯†ä¿éšœï¼Œä¸èƒ½æä¾›åŸŸåæ‰€æœ‰è€…çš„ä¿¡æ¯ 4ã€TLSåŠ å¯†çš„æ¡æ‰‹è¿‡ç¨‹TLSæœ¬èº«æ˜¯ä¸€ä¸ªæ··åˆåŠ å¯†ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä½¿ç”¨äº†å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ä¸¤ç§æ–¹å¼ï¼Œé¦–å…ˆæ˜¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†æ¥ä¼ è¾“åœ¨è¿™æ¬¡ä¼šè¯è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ç”¨äºç”Ÿæˆå¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼ˆ pre-master keyï¼‰ï¼Œç»“åˆæ˜æ–‡ä¼ è¾“çš„éšæœºæ•°å’Œç®—æ³•ç”Ÿæˆå †æˆåŠ å¯†çš„å¯†é’¥ä¹‹åå†ä½¿ç”¨å¯¹ç§°åŠ å¯†è¿›è¡Œé€šä¿¡ã€‚è¿™æ ·é€šä¿¡çš„åŸå› æ˜¯å› ä¸ºéå¯¹ç§°åŠ å¯†è™½ç„¶å¾ˆå®‰å…¨ï¼Œä½†æ˜¯æ•ˆç‡å®åœ¨æ˜¯å¤ªä½äº†ï¼ˆæ¯”å¯¹ç§°åŠ å¯†æ…¢å‡ ä¸ªæ•°é‡çº§ï¼‰ï¼Œå› æ­¤åªç”¨æ¥ä¼ è¾“å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œä¹‹åå°±ä½¿ç”¨æ•ˆç‡æ›´é«˜çš„å¯¹ç§°åŠ å¯†æ¥é€šä¿¡ã€‚ TLSæ”¯æŒå¤šç§å¯†é’¥äº¤æ¢ç®—æ³•ï¼ˆkey exchange algorithmsï¼‰ å’ŒåŠ å¯†ç®—æ³•ï¼ˆciphersuitesï¼‰ï¼Œä¸åŒçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ”¯æŒçš„ä¹Ÿå„ä¸ç›¸åŒï¼Œå› æ­¤åœ¨åŠ å¯†é€šä¿¡ä¹‹é—´å°±éœ€è¦è¿›è¡Œåå•†ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éœ€è¦åå•†æ¸…æ¥šä½¿ç”¨ä½•ç§ç®—æ³•ï¼Œä½¿ç”¨ä½•ç§åŠ å¯†æ–¹å¼ï¼Œä½¿ç”¨ä»€ä¹ˆå¯†é’¥ç­‰ç­‰é—®é¢˜ï¼Œè¿™ä¸€ä¸ªè¿‡ç¨‹ç§°ä¸ºæ¡æ‰‹è¿‡ç¨‹ï¼ˆhandshakeï¼‰ã€‚å°±å¥½åƒTCPè¿æ¥åœ¨å»ºç«‹å‰éœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ä¸€æ ·ï¼Œæ‰€æœ‰çš„TLSé€šä¿¡åœ¨å¼€å§‹ä¹‹å‰éƒ½éœ€è¦è¿›è¡Œæ¡æ‰‹ï¼ˆhandshakeï¼‰ã€‚å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®ŒæˆTCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹TCPè¿æ¥ä¹‹åï¼Œå°±å¼€å§‹è¿›è¡ŒTLSçš„æ¡æ‰‹è¿‡ç¨‹ï¼Œå…·ä½“çš„æµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆç”±å®¢æˆ·ç«¯å‘é€Client Hello æ¶ˆæ¯åˆ°æœåŠ¡å™¨ï¼Œæ¶ˆæ¯ä¸­ä¸»è¦åŒ…å«äº†å®¢æˆ·ç«¯æ”¯æŒçš„ciphersuitesï¼Œ TLS ç‰ˆæœ¬ä¿¡æ¯å’Œå®¢æˆ·ç«¯éšæœºæ•°ã€‚æ³¨æ„æ­¤æ—¶æ˜¯æ˜æ–‡ä¼ è¾“ æœåŠ¡å™¨æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œè¿”å›è‡ªå·±æ”¯æŒçš„ciphersuitesï¼Œ TLS ç‰ˆæœ¬ï¼Œè‡ªå·±çš„æ•°å­—è¯ä¹¦å’ŒæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„éšæœºæ•°ã€‚æ³¨æ„æ­¤æ—¶æ˜¯æ˜æ–‡ä¼ è¾“ å®¢æˆ·ç«¯å¼€å§‹éªŒè¯æ•°å­—è¯ä¹¦ï¼Œå¯èƒ½ä¼šä¸æ–­å¾€ä¸Šè¿½æº¯ CAã€CA çš„ CAã€CA çš„ CA çš„ CAï¼Œç›´åˆ°ä¸€ä¸ªæˆä¿¡çš„ CAã€‚éªŒè¯å®Œè¯ä¹¦ä¹‹åç”Ÿæˆä¸€ä¸ªæ–°çš„pre-master keyï¼Œå†ä½¿ç”¨è¯ä¹¦ä¸­çš„å…¬é’¥æ¥å¯¹pre-master keyè¿›è¡ŒåŠ å¯†ï¼Œç„¶åå‘é€ç»™æœåŠ¡å™¨ã€‚æ³¨æ„æ­¤æ—¶æ˜¯éå¯¹ç§°åŠ å¯†ä¼ è¾“ æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„éå¯¹ç§°åŠ å¯†çš„å¯†æ–‡ï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè·å¾—äº†pre-master keyã€‚æ³¨æ„æ­¤æ—¶æ˜¯éå¯¹ç§°åŠ å¯†ä¼ è¾“ åˆ°è¿™é‡Œä¸ºæ­¢ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½æœ‰ä¸‰ç»„æ•°å­—ï¼Œåˆ†åˆ«æ˜¯å®¢æˆ·ç«¯çš„éšæœºæ•°ã€æœåŠ¡å™¨çš„éšæœºæ•°å’Œpre-master keyã€‚å…¶ä¸­ç”±äºå®¢æˆ·ç«¯çš„éšæœºæ•°å’ŒæœåŠ¡å™¨çš„éšæœºæ•°éƒ½æ˜¯ä½¿ç”¨æ˜æ–‡ä¼ è¾“ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ•°å­—æ˜¯æœ‰è¢«æš´éœ²çš„é£é™©çš„ï¼Œä½†æ˜¯ç”±äºpre-master keyæ˜¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†ä¼ è¾“ï¼Œååˆ†å®‰å…¨ï¼Œæ‰€ä»¥å°†è¿™ä¸‰è€…ç»“åˆï¼Œä½¿ç”¨ä¹‹å‰åå•†å¥½çš„ç‰¹å®šçš„ç®—æ³•å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œè¿™ä¸ªå¯†é’¥ç§°ä¸ºshared secertã€‚ä¹Ÿå°±æ˜¯ä¹‹åç”¨æ¥å¯¹ç§°åŠ å¯†çš„å¯†é’¥ã€‚ å®¢æˆ·ç«¯åœ¨è®¡ç®—å‡ºå¯¹ç§°åŠ å¯†çš„å¯†é’¥ä¹‹åï¼Œä½¿ç”¨è¯¥å¯†é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†é€šä¿¡ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨ä¹‹åéƒ½ä½¿ç”¨è¯¥å¯†é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†ã€‚æ³¨æ„æ­¤æ—¶æ˜¯å¯¹ç§°åŠ å¯†ä¼ è¾“ æœåŠ¡å™¨æ¥æ”¶åˆ°å¯†æ–‡åï¼Œä½¿ç”¨ä¹‹å‰è®¡ç®—å‡ºçš„å¯†é’¥æ¥è¿›è¡Œå¯¹ç§°è§£å¯†ï¼Œè§£å¯†æˆåŠŸä¹‹åï¼Œå†ä½¿ç”¨è¯¥å¯†é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†é€šä¿¡ã€‚å‘ŠçŸ¥å®¢æˆ·ç«¯å¯†é’¥ç¡®è®¤æ— è¯¯ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å¯†é’¥è¿›è¡Œé€šä¿¡ã€‚æ³¨æ„æ­¤æ—¶æ˜¯å¯¹ç§°åŠ å¯†ä¼ è¾“ è‡³æ­¤ï¼Œæ•´ä¸ªTLSçš„æ¡æ‰‹è¿‡ç¨‹å®Œæ•´ï¼Œä¹‹åå°±å¯ä»¥å¼€å§‹å¯¹ç§°åŠ å¯†çš„é€šä¿¡äº†ã€‚ å…¨è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨RFC5246æ–‡æ¡£ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°å¯¹åº”çš„ç®€å•å›¾ç¤º æ•´ä½“æµç¨‹å’Œä¸Šé¢çš„åŸºæœ¬ç›¸åŒï¼Œéƒ½æ˜¯éœ€è¦è¿›è¡Œä¸¤ä¸ªRTTæ“ä½œã€‚ 5ã€TLS1.2çš„é—®é¢˜çºµè§‚æ•´ä¸ªSSL/TLSåè®®çš„å‘å±•å²ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ•´ä¸ªSSL/TLSåè®®å°±æ˜¯ä¸æ–­åœ°å¡«å‘çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œä¸æ–­åœ°å¯¹æ—§ç‰ˆæœ¬çš„åè®®ä¸­çš„å„ç§æ¼æ´è¿›è¡Œä¿®è¡¥è¿­ä»£æ›´æ–°ï¼Œç„¶åå‘å¸ƒæ–°çš„ç‰ˆæœ¬ï¼Œç›´åˆ°TLSv1.2ç‰ˆæœ¬æ‰ç®—æ˜¯ä¸€ä¸ªä¸é”™çš„å¯ç”¨çš„åŠ å¯†åè®®ç‰ˆæœ¬ã€‚å³ä¾¿å¦‚æ­¤ï¼Œå¯¹åº”TLSv1.2æ¥è¯´è¿˜æ˜¯æœ‰ç€å¤ªå¤šçš„å†å²åŒ…è¢±å’Œå…¼å®¹æ€§çš„é—®é¢˜ï¼Œå°½ç®¡åœ¨åŠŸèƒ½å®ç°ä¸Šçš„æ¼æ´å¯ä»¥é€šè¿‡è¡¥ä¸æ¥è¿›è¡Œä¿®è¡¥ï¼Œä½†æ˜¯åœ¨åè®®è®¾è®¡ä¹‹åˆå°±å­˜åœ¨çš„é—®é¢˜æ˜¯æ²¡æœ‰åŠæ³•ä¿®å¤çš„ï¼Œåªèƒ½æ¨å€’é‡æ¥ï¼Œäºæ˜¯å°±å‡ºç°äº†åé¢çš„TLSv1.3ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹TLSv1.2ç‰ˆæœ¬ä¸­çš„ä¸€äº›ä¸»è¦çš„é—®é¢˜ï¼š 5.1 å®‰å…¨é—®é¢˜ä½œä¸ºä¸€ä¸ªæä¾›å®‰å…¨é€šä¿¡çš„åè®®ï¼Œå®‰å…¨é—®é¢˜æ˜¯é¦–è¦çš„ä¹Ÿæ˜¯è‡´å‘½çš„é—®é¢˜ã€‚TLSå‘å±•åˆ°1.2ä»¥æ¥ï¼Œå·²ç»è¢«å¾ˆå¤šæœºæ„å’Œå­¦è€…æ›å‡ºæœ‰å„ç§å„æ ·çš„å®‰å…¨æ¼æ´ï¼ŒåŒ…æ‹¬å¯†é’¥äº¤æ¢ç®—æ³•ï¼ˆkey exchange algorithmsï¼‰ã€åŠ å¯†å¥—ä»¶ï¼ˆciphersuitesï¼‰å’Œæ•°å­—ç­¾åï¼ˆdigital signaturesï¼‰å„ä¸ªæ–¹é¢éƒ½å­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¾ˆå¤šéƒ½æ˜¯ç”±äºå†å²åŸå› å…¼å®¹é—®é¢˜è€Œé—ç•™ä¸‹æ¥çš„é—®é¢˜ã€‚ è¿˜æœ‰ä¸€äº›åˆ™æ˜¯è®¾è®¡åè®®æœ¬èº«å°±å­˜åœ¨çš„é—®é¢˜å¦‚TLSé‡æ–°åè®®ï¼ˆrenegotiationï¼‰å¯ä»¥è®©å¿ƒæ€€ä¸è½¨çš„äººå°†é«˜ç‰ˆæœ¬çš„TLSåè®®é‡æ–°åå•†é™çº§åˆ°ä½ç‰ˆæœ¬çš„ä¸å®‰å…¨çš„åè®®ç„¶åè¿›è¡Œæ”»å‡»ã€‚åˆæˆ–è€…æ˜¯SNIçš„ä¸åŠ å¯†é—®é¢˜ï¼ŒTLS1.2åŠä¹‹å‰çš„åè®®éƒ½ä¸å¯¹SNIè¿›è¡ŒåŠ å¯†ï¼Œè¿™ä¹Ÿå­˜åœ¨äº†å¾ˆå¤§çš„é£é™©ã€‚ 5.2 æ€§èƒ½é—®é¢˜äº’è”ç½‘ä¸Šä¸€ç›´å­˜åœ¨ç€åŠ å¯†ä¼ è¾“å¯¹æ€§èƒ½æœ‰å¾ˆå¤§æŸè€—çš„è¯´æ³•ï¼Œå®é™…ä¸Šäº†è§£äº†ä¸Šé¢çš„TLSv1.2æ¡æ‰‹è¿‡ç¨‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“åŠ å¯†ä¼ è¾“å¯¹æ€§èƒ½ç¡®å®æœ‰æŸè€—ï¼Œä½†æ˜¯è¿œæ²¡æœ‰åˆ°å¾ˆå¤šäººé¼“å¹çš„é‚£ä¹ˆä¸¥é‡çš„ç¨‹åº¦ã€‚è€Œä¸”åœ¨åé¢ä¹ŸåŠ å…¥äº†å¾ˆå¤šè¯¸å¦‚OCSPã€HSTSç­‰æŠ€æœ¯æ¥æé«˜å…¶æ€§èƒ½è¡¨ç°ï¼Œä½†æ˜¯å³ä¾¿å¦‚æ­¤ï¼Œæ•´ä¸ªTLSv1.2çš„æ¡æ‰‹è¿‡ç¨‹ä¹Ÿéœ€è¦2-RTTï¼Œä¹Ÿå°±æ˜¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ¥å›ä¸¤æ¬¡æ‰èƒ½é¡ºåˆ©å»ºç«‹TLSä¼ è¾“ï¼Œè¿™è¿˜æ˜¯åœ¨ä¸€åˆ‡éƒ½è¿›è¡Œé¡ºåˆ©çš„æƒ…å†µä¸‹ã€‚ 6ã€TLS1.3çš„æ”¹è¿›TLSv1.3æ˜¯TLSåè®®æ›´æ–°ä¸­å˜åŒ–éå¸¸å¤§çš„ä¸€ä¸ªç‰ˆæœ¬ï¼ŒåŠ å…¥äº†è®¸å¤šæ–°çš„ç‰¹æ€§å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œå¹¶ä¸”ä¸å®Œå…¨å‰å‘å…¼å®¹ï¼Œå› æ­¤ä¹Ÿæœ‰äº›äººè®¤ä¸ºåº”è¯¥ç§°ä¸ºTLSv2.0ï¼Œä¸è¿‡æœ€åè¿˜æ˜¯å‘½åä¸ºTLSv1.3ã€‚ é’ˆå¯¹TLSv1.2ä¸­å­˜åœ¨çš„å®‰å…¨å’Œæ€§èƒ½é—®é¢˜ï¼ŒTLSv1.3åœ¨è®¾è®¡çš„æ—¶å€™å°±æ”¾å¼ƒäº†å‰å‘å…¼å®¹æ€§ï¼Œä¸å†å¯¹ä¹‹å‰çš„ç‰ˆæœ¬è¿›è¡Œå…¼å®¹ï¼ŒåŒæ—¶ç¦ç”¨äº†å¤§é‡ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä½¿ç”¨äº†å°‘é‡å®‰å…¨çš„ç®—æ³•æ¥è®¾è®¡åè®®ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯å¯ä»¥ç®€åŒ–æ¡æ‰‹è¿‡ç¨‹ä¸­çš„æ“ä½œï¼Œä½¿å¾—æ¡æ‰‹è¿‡ç¨‹ä»2-RTTå˜ä¸º1-RTTï¼ŒåŒæ—¶æœ‰æ•ˆæé«˜å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚ 6.1 TLS1.3å’ŒTLS1.2çš„ä¸»è¦ä¸åŒ éƒ¨åˆ†æ–°çš„å¯†ç å¥—ä»¶ï¼ˆciphersuiteï¼‰åªèƒ½åœ¨TLSv1.3ä¸­å·¥ä½œï¼Œå¹¶ä¸”TLSv1.3ä¸æ”¯æŒä¹‹å‰åœ¨TLSv1.2å‰ç”¨çš„æ—§çš„å¯†ç å¥—ä»¶ciphersuitesã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœéœ€è¦ä½¿ç”¨TLSv1.3å°±å¿…é¡»è¦æ·»åŠ æ–°çš„åªèƒ½åœ¨TLSv1.3ä¸­ä½¿ç”¨çš„å¯†ç å¥—ä»¶ æ–°çš„å¯†ç å¥—ä»¶ï¼ˆciphersuitesï¼‰å’Œä¹‹å‰çš„å¯†ç å¥—ä»¶å®šä¹‰ä¸åŒï¼Œå¹¶ä¸éœ€è¦æŒ‡å®šå¯¹åº”çš„è¯ä¹¦ç±»å‹(e.g. RSA, DSA, ECDSA) æˆ–è€…æ˜¯å¯†é’¥äº¤æ¢æœºåˆ¶ (e.g. DHE or ECHDE) TLSv1.3ä¸å†æ”¯æŒDSAè¯ä¹¦ TLS1.3ä¸­ä¸å†æ”¯æŒé‡æ–°åå•†ï¼ˆRenegotiationï¼‰ï¼Œå³ä¸å¯èƒ½åƒTLSv1.2ä¹‹å‰é‚£æ ·é€šè¿‡é‡æ–°åå•†æ¥å›é€€åˆ°æ›´æ—©çš„æ›´ä¸å®‰å…¨çš„ç‰ˆæœ¬ TLS1.3ä¸­æ›´å¤šçš„æ¡æ‰‹è¿‡ç¨‹éƒ½è¢«åŠ å¯†äº†ï¼ˆServer Helloä¹‹åéƒ½ä¼šè¿›è¡ŒåŠ å¯†ï¼‰ TLSv1.3æ”¯æŒæ›´å¤šçš„çš„æ¶ˆæ¯ç±»å‹ï¼Œå³å¯¹è‡ªå®šä¹‰çš„æ‰©å±•APIå’Œè®¤è¯ä¼ è¾“æœ‰æ›´å¥½çš„æ‰©å±•æ€§ å®¢æˆ·ç«¯åœ¨TLSæ¡æ‰‹é˜¶æ®µå‘é€ClientHelloæ•°æ®åŒ…çš„æ—¶å€™éœ€è¦æä¾›æ”¯æŒçš„å¯†ç å¥—ä»¶ï¼ˆciphersuiteï¼‰å’Œå¯†é’¥å…±äº«ï¼ˆkey_shareï¼‰ä»è€Œæé«˜é€Ÿåº¦ï¼Œå¦‚æœclientå‘é€çš„keyshareç±»å‹æ˜¯serverä¸æ”¯æŒï¼Œé‚£å°±ä¸æ˜¯1-RTTã€‚ sessionsä¼šè¯åœ¨TLSæ¡æ‰‹å®Œæˆä¹‹åæ‰ä¼šå»ºç«‹ï¼Œæ‰€ä»¥åœ¨sessionå’ŒTLSæ¡æ‰‹ä¹‹é—´å¯èƒ½ä¼šæœ‰ç©ºéš™ï¼ˆå³ä¸æ˜¯è¿ç»­çš„ï¼‰ 6.2 TLS1.3ä¸­çš„å¯†é’¥äº¤æ¢ç®—æ³•TLS 1.3çš„æ ¸å¿ƒå®—æ—¨æ˜¯ç®€å•æ€§ã€‚åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œé™¤å»äº†Diffie-Hellmanï¼ˆDHï¼‰å¯†é’¥äº¤æ¢ä»¥å¤–çš„æ‰€æœ‰å¯†é’¥äº¤æ¢ç®—æ³•ã€‚TLS 1.3è¿˜å®šä¹‰äº†ä¸€ç»„ç»è¿‡æµ‹è¯•çš„DHå‚æ•°ï¼Œæ— éœ€ä¸æœåŠ¡å™¨åå•†å‚æ•°ã€‚ç”±äºåªæœ‰ä¸€ä¸ªå¯†é’¥äº¤æ¢ç®—æ³•ï¼ˆå…·æœ‰å†…ç½®å‚æ•°ï¼‰å’Œå°‘æ•°æ”¯æŒçš„å¯†ç ï¼Œå› æ­¤è®¾ç½®TLS 1.3é€šé“æ‰€éœ€çš„ç»å¯¹å¸¦å®½æ¯”æ—©æœŸç‰ˆæœ¬è¦å°‘å¾—å¤šã€‚ æˆ‘ä»¬æ¥çœ‹DHç®—æ³•äº¤æ¢å¯†é’¥çš„æ­¥éª¤ã€‚å‡è®¾å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ–¹éœ€è¦ä¼ é€’å¯†é’¥ï¼Œä»–ä»¬ä¹‹é—´å¯ä»¥è¿™ä¹ˆåšï¼š å®¢æˆ·ç«¯é¦–é€‰é€‰æ‹©ä¸€ä¸ªç´ æ•°pï¼Œä¾‹å¦‚509ï¼Œåº•æ•°gï¼Œä»»é€‰ï¼Œä¾‹å¦‚5ï¼Œéšæœºæ•°aï¼Œä¾‹å¦‚123ï¼Œç„¶åè®¡ç®—A=g^a mod pï¼Œç»“æœæ˜¯215ï¼Œç„¶åï¼Œå®¢æˆ·ç«¯å‘é€pï¼509ï¼Œg=5ï¼ŒA=215ç»™æœåŠ¡å™¨ï¼› æœåŠ¡å™¨æ”¶åˆ°åï¼Œä¹Ÿé€‰æ‹©ä¸€ä¸ªéšæœºæ•°bï¼Œä¾‹å¦‚ï¼Œ456ï¼Œç„¶åè®¡ç®—B=g^b mod pï¼Œç»“æœæ˜¯181ï¼ŒæœåŠ¡å™¨å†åŒæ—¶è®¡ç®—s=A^b mod pï¼Œç»“æœæ˜¯121ï¼› æœåŠ¡å™¨æŠŠè®¡ç®—çš„B=181å‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è®¡ç®—sï¼B^a mod pçš„ä½™æ•°ï¼Œè®¡ç®—ç»“æœä¸æœåŠ¡å™¨ç®—å‡ºçš„ç»“æœä¸€æ ·ï¼Œéƒ½æ˜¯121ã€‚ æ‰€ä»¥æœ€ç»ˆåŒæ–¹åå•†å‡ºçš„å¯†é’¥sæ˜¯121ã€‚æ³¨æ„åˆ°è¿™ä¸ªå¯†é’¥så¹¶æ²¡æœ‰åœ¨ç½‘ç»œä¸Šä¼ è¾“ã€‚è€Œé€šè¿‡ç½‘ç»œä¼ è¾“çš„pï¼Œgï¼ŒAå’ŒBæ˜¯æ— æ³•æ¨ç®—å‡ºsçš„ï¼Œå› ä¸ºå®é™…ç®—æ³•é€‰æ‹©çš„ç´ æ•°æ˜¯éå¸¸å¤§çš„ã€‚æ‰€ä»¥ï¼Œæ›´ç¡®åˆ‡åœ°è¯´ï¼ŒDHç®—æ³•æ˜¯ä¸€ä¸ªå¯†é’¥åå•†ç®—æ³•ï¼ŒåŒæ–¹æœ€ç»ˆåå•†å‡ºä¸€ä¸ªå…±åŒçš„å¯†é’¥ï¼Œè€Œè¿™ä¸ªå¯†é’¥ä¸ä¼šé€šè¿‡ç½‘ç»œä¼ è¾“ã€‚ 6.3 TLS1.3æ¡æ‰‹è¿‡ç¨‹ æ•´ä¸ªæµç¨‹çš„ç›®çš„å’ŒTLS 1.2æ˜¯ç›¸ä¼¼çš„ï¼ŒTLSæ¡æ‰‹è¿‡ç¨‹å°±æ˜¯ä¸ºäº†è®©åŒæ–¹èƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ªå®‰å…¨çš„å¯ç”¨äºå¯¹ç§°åŠ å¯†çš„å¯†é’¥ã€‚å’Œä¹‹å‰ä¸ä¸€æ ·çš„å°±æ˜¯ï¼Œæ— éå°±æ˜¯å®¢æˆ·ç«¯æå‰æŠŠæ‰€æœ‰çš„å…¬é’¥è®¡ç®—äº†ä¸€éï¼Œå‘ç»™serverï¼Œserverå†æŒ‘é€‰ã€‚ 7ã€wiresharkæŠ“åŒ…ä½¿ç”¨wiresharkå¯¹TLSv1.3æ¡æ‰‹è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…ï¼Œæœªè§£å¯†çš„æƒ…å†µå¦‚ä¸‹å›¾ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨Server Helloé˜¶æ®µä¹‹åçš„æ•°æ®å°±å·²ç»è¢«åŠ å¯†äº†ï¼Œæ— æ³•æŸ¥çœ‹å…·ä½“çš„æ•°æ®æƒ…å†µï¼Œå‡æ˜¾ç¤ºä¸ºApplication Data å¯¹å…¶è¿›è¡Œè§£å¯†æ“ä½œä¹‹åå°±å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„æ•°æ®æƒ…å†µï¼Œå…¶ä¸­çš„Encrypted Extensionså°±æ˜¯å¯¹SNIéƒ¨åˆ†è¿›è¡Œäº†åŠ å¯†ã€‚ è§£å¯†å‰çš„TLSv1.2æ¡æ‰‹è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°ç›´åˆ°Change Cipher Specé˜¶æ®µéƒ½æ˜¯æ²¡æœ‰è¿›è¡ŒåŠ å¯†çš„ã€‚ è§£å¯†åçš„TLSv1.2æ¡æ‰‹è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¢«åŠ å¯†çš„éƒ¨åˆ†ä¹Ÿå°±æ˜¯Encrypted Handshake Messageå®é™…ä¸Šå°±æ˜¯Finishedæ¶ˆæ¯ï¼Œç”¨äºæ£€éªŒå¯¹ç§°åŠ å¯†çš„å¯†é’¥æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"tls","slug":"tls","permalink":"https://tinychen.com/tags/tls/"}]},{"title":"nginxç¯‡07-å¯ç”¨HTTP2å’ŒTLSv1.3","slug":"20200519-nginx-07-enable-http2-tls13","date":"2020-05-19T02:00:00.000Z","updated":"2020-05-19T02:00:00.000Z","comments":true,"path":"20200519-nginx-07-enable-http2-tls13/","link":"","permalink":"https://tinychen.com/20200519-nginx-07-enable-http2-tls13/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ç¼–è¯‘çš„æ–¹å¼å‡çº§opensslåº“å’Œnginxç”¨äºæ”¯æŒHTTP2å’ŒTLSv1.3å¹¶ä¸”ä»‹ç»äº†ä¸€äº›ç®€å•çš„æé«˜nginxå®‰å…¨æ€§çš„é…ç½®ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ç¼–è¯‘çš„æ–¹å¼å‡çº§opensslåº“å’Œnginxç”¨äºæ”¯æŒHTTP2å’ŒTLSv1.3å¹¶ä¸”ä»‹ç»äº†ä¸€äº›ç®€å•çš„æé«˜nginxå®‰å…¨æ€§çš„é…ç½®ã€‚ 1ã€ç¼–è¯‘å®‰è£…opensslè€ƒè™‘åˆ°Linuxç³»ç»Ÿä¸­æœ‰è®¸å¤šç»„ä»¶éƒ½éœ€è¦ä½¿ç”¨opensslåº“ï¼Œè€Œç°åœ¨é»˜è®¤ä½¿ç”¨çš„opensslåº“ç»å¤§å¤šæ•°éƒ½æ²¡åˆ°è¾¾èƒ½å¤Ÿæ”¯æŒTLS1.3çš„openssl1.1.1ç‰ˆæœ¬ä»¥ä¸Šï¼Œå› æ­¤ä¸ªäººå»ºè®®ä¸è¦ç›´æ¥ä¿®æ”¹ç³»ç»Ÿå·²æœ‰çš„é»˜è®¤opensslåº“è€Œæ˜¯å¦å¤–ä½¿ç”¨ä¸€ä¸ªæ–°ç›®å½•æ¥ç¼–è¯‘å®‰è£…æ–°ç‰ˆæœ¬çš„opensslã€‚ å…·ä½“çš„æ”¯æŒä¿¡æ¯å¯ä»¥æŸ¥çœ‹opensslå®˜ç½‘çš„TLSv1.3éƒ¨åˆ†ã€‚ è§£å‹ä¸‹è½½çš„ç¨³å®šç‰ˆopenssl1.1.1gè¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œæ³¨æ„ä½¿ç”¨--prefix=æŒ‡å®šå®‰è£…ç›®å½• 1234567891011# ä¸‹è½½wget https://www.openssl.org/source/openssl-1.1.1g.tar.gz# è§£å‹tar -zxvf openssl-1.1.1g.tar.gz# é…ç½®ã€ç¼–è¯‘./config --prefix=/home/opensslmake# æ£€æŸ¥æ˜¯å¦å‡ºé”™make test# å®‰è£…make install å®‰è£…å®Œæˆåæ£€æŸ¥é“¾æ¥åº“æ˜¯å¦æ­£å¸¸ï¼Œå°†ç¼ºå°‘çš„æ–‡ä»¶ç›´æ¥è½¯é“¾æ¥åˆ°ç³»ç»Ÿçš„/usr/lib64ç›®å½•ä¸‹ 12ln -s /home/openssl/lib/libssl.so.1.1 /usr/lib64/libssl.so.1.1ln -s /home/openssl/lib/libcrypto.so.1.1 /usr/lib64/libcrypto.so.1.1 æœ€åæ£€æŸ¥ç³»ç»Ÿä½¿ç”¨çš„opensslçš„ç‰ˆæœ¬æ˜¯å¦ä¸ºæ–°ç‰ˆä»¥åŠç³»ç»Ÿçš„åº“æŒ‡å‘æ˜¯å¦æ­£ç¡® 2ã€ç¼–è¯‘å®‰è£…nginx2.1 nginxçš„TLS1.3å’ŒHTTP2æƒ³è¦åœ¨nginxä¸­å¼€å¯TLS1.3çš„æ”¯æŒï¼Œåªéœ€è¦ä½¿ç”¨æ”¯æŒTLS1.3çš„opensslåº“æ¥è¿›è¡Œç¼–è¯‘å³å¯ã€‚ æŸ¥çœ‹nginxçš„ç‰ˆæœ¬æ›´æ–°è¯´æ˜æˆ‘ä»¬å¯ä»¥çŸ¥é“nginxä»1.9.5ç‰ˆæœ¬å¼€å§‹æ”¯æŒHTTP2ï¼š ä»1.13ç‰ˆæœ¬å¼€å§‹æ”¯æŒTLS1.3 2.2 æŒ‡å®šopensslç›®å½•è¿›è¡Œnginxç¼–è¯‘å®‰è£…nginxçš„ç¼–è¯‘å®‰è£…æ­¤å‰å·²ç»ä»‹ç»è¿‡äº†ï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥ç‚¹å‡»è¿™é‡Œå›é¡¾ã€‚ 1wget http://nginx.org/download/nginx-1.18.0.tar.gz è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æˆªæ­¢2020å¹´5æœˆ19å·æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬nginx1.18.0ï¼Œä¸€äº›æ³¨æ„çš„äº‹é¡¹å¦‚ä¸‹ï¼š --with-http_v2_moduleå’Œ--with-http_ssl_moduleç”¨äºæ”¯æŒHTTP2å’ŒsslåŠ å¯†ï¼Œ --with-openssl=ç”¨äºæŒ‡å®šopensslåº“çš„å®‰è£…ç›®å½• --with-openssl-opt=enable-tls1_3ç”¨äºå¼€å¯opensslåº“çš„tls1.3æ”¯æŒï¼Œä½†æ˜¯ç°åœ¨çš„æ–°ç‰ˆæœ¬å·²ç»é»˜è®¤å¼€å¯ï¼Œæ— éœ€é¢å¤–æ·»åŠ è¿™ä¸ªå‚æ•° å‰©ä¸‹çš„å°±å’Œå¸¸è§„çš„ç¼–è¯‘å®‰è£…æ— å¼‚ï¼Œä¸‹é¢æ˜¯æ­¤æ¬¡ç¼–è¯‘çš„å‚æ•°ï¼š 1234567891011121314151617181920212223242526272829303132333435./configure --prefix=/home/nginx \\--sbin-path=/home/nginx/sbin/nginx \\--with-openssl-opt=enable-tls1_3 \\--with-openssl=/home/openssl \\--conf-path=/home/nginx/nginx.conf \\--error-log-path=/home/nginx/logs/error.log \\--http-log-path=/home/nginx/logs/access.log \\--pid-path=/home/nginx/nginx.pid \\--lock-path=/home/nginx/nginx.lock \\--http-client-body-temp-path=/home/nginx/cache/client_temp \\--http-proxy-temp-path=/home/nginx/cache/proxy_temp \\--http-fastcgi-temp-path=/home/nginx/cache/fastcgi_temp \\--http-uwsgi-temp-path=/home/nginx/cache/uwsgi_temp \\--http-scgi-temp-path=/home/nginx/cache/scgi_temp \\--user=nginx \\--group=nginx \\--with-compat \\--with-file-aio \\--with-threads \\--with-http_addition_module \\--with-http_auth_request_module \\--with-http_dav_module \\--with-http_flv_module \\--with-http_gunzip_module \\--with-http_gzip_static_module \\--with-http_mp4_module \\--with-http_random_index_module \\--with-http_realip_module \\--with-http_secure_link_module \\--with-http_slice_module \\--with-http_ssl_module \\--with-http_stub_status_module \\--with-http_sub_module \\--with-http_v2_module \\--with-stream ç¼–è¯‘çš„æ—¶å€™å‡ºç°æŠ¥é”™ï¼š ä¿®æ”¹nginxæºç ç›®å½•ä¸­auto/lib/openssl/confä¸­çš„opensslè·¯å¾„å‚æ•°ï¼Œåœ¨40è¡Œå·¦å³çš„ä½ç½®å¯¹åº”å››ä¸ªå‚æ•°ä¸­çš„.opensslå»æ‰ï¼Œä¿®æ”¹åçš„å†…å®¹å¦‚ä¸‹ï¼š 123439 CORE_INCS=&quot;$CORE_INCS $OPENSSL/include&quot;40 CORE_DEPS=&quot;$CORE_DEPS $OPENSSL/include/openssl/ssl.h&quot;41 CORE_LIBS=&quot;$CORE_LIBS $OPENSSL/lib/libssl.a&quot;42 CORE_LIBS=&quot;$CORE_LIBS $OPENSSL/lib/libcrypto.a&quot; ç„¶åé‡æ–°ç¼–è¯‘å®‰è£…ã€‚ 2.3 nginxé…ç½®ä¿®æ”¹å®‰è£…å®Œæˆä¹‹åå°†åŸæ¥çš„é…ç½®æ–‡ä»¶å’Œhtmlæ–‡ä»¶å…¨éƒ¨è¿ç§»åˆ°æ–°çš„nginxç›®å½•ä¸‹å¹¶è¿›è¡Œç›¸åº”çš„ä¿®æ”¹å°±å¯ä»¥æ­£å¸¸çš„å¯ç”¨nginxäº†ã€‚å¦‚æœæ­¤å‰çš„nginxæ˜¯ç›´æ¥ä½¿ç”¨yumå®‰è£…å¹¶ä¸”ä½¿ç”¨systemdè¿›è¡Œå®ˆæŠ¤è¿›ç¨‹çš„æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹åº”çš„systemd unitæ–‡ä»¶ä¸­çš„ç›®å½•è¿›è¡Œä¿®æ”¹ï¼Œä¸€èˆ¬æ¥è¯´åªéœ€è¦ä¿®æ”¹ç›¸å…³è·¯å¾„çš„å‚æ•°å³å¯ï¼š é¦–å…ˆæˆ‘ä»¬åœæ­¢æœåŠ¡ï¼Œç„¶åä¿®æ”¹æ–‡ä»¶ï¼Œæ¥ç€é‡å¯æœåŠ¡å³å¯ï¼š 1234567891011121314151617181920212223# åœæ­¢nginxsystemctl stop nginx# ä¿®æ”¹é…ç½®æ–‡ä»¶vim /usr/lib/systemd/system/nginx.service[Unit]Description=nginx - high performance web serverDocumentation=http://nginx.org/en/docs/After=network-online.target remote-fs.target nss-lookup.targetWants=network-online.target[Service]Type=forkingPIDFile=/home/nginx/nginx.pidExecStart=/home/nginx/sbin/nginx -c /home/nginx/nginx.confExecReload=/bin/kill -s HUP $MAINPIDExecStop=/bin/kill -s TERM $MAINPID[Install]WantedBy=multi-user.target# é‡å¯daemonè¿›ç¨‹systemctl daemon-reload å¦‚æœè¿˜æƒ³ä½¿ç”¨å…¨å±€å‘½ä»¤nginxçš„è¯ï¼Œå¯ä»¥å…ˆæŠŠåŸæ¥çš„yumå®‰è£…çš„ç§»é™¤å†å°†ç¼–è¯‘å®‰è£…çš„æ–°ç‰ˆæœ¬æŒ‡å‘ç³»ç»Ÿç›®å½• 12345#ä½¿ç”¨which nginxæŸ¥çœ‹nginxçš„æŒ‡å‘[root@aliyun bin]# which nginx/usr/sbin/nginx[root@aliyun bin]# mv /usr/sbin/nginx /usr/sbin/nginx.bak[root@aliyun bin]# ln -s /home/nginx/sbin/nginx /usr/sbin/nginx æœ€åæˆ‘ä»¬æŸ¥çœ‹nginxç‰ˆæœ¬ä¿¡æ¯ï¼š 3ã€é…ç½®http2å’Œtls1.33.1 nginxé…ç½®nginxä¸­å¼€å¯http2å’Œtls1.3ååˆ†ç®€å•ï¼Œè¿™é‡Œé…ç½®å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334server&#123; listen 80; server_name tinychen.com www.tinychen.com; if ($server_port = 80)&#123; return 301 https://$host$request_uri; &#125;&#125;server&#123; listen 443 ssl http2 default_server; server_name tinychen.com www.tinychen.com; add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;; ssl_ciphers TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-256-GCM-SHA384:TLS13-AES-128-GCM-SHA256:EECDH+CHACHA20:EECDH+AESGCM:EECDH+AES; #ssl_ciphers TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:TLS_AES_128_CCM_8_SHA256:TLS_AES_128_CCM_SHA256; ssl_protocols TLSv1.2 TLSv1.3; ssl_stapling on; ssl_stapling_verify on; ssl_trusted_certificate certs/tinychen.com.pem; ssl_prefer_server_ciphers on; ssl_certificate certs/tinychen.com.pem; ssl_certificate_key certs/tinychen.com.key; ssl_session_cache shared:SSL:1m; ssl_verify_depth 10; ssl_session_timeout 30m; location / &#123; root html/; index index.html index.htm; &#125;&#125; ç”±äºhttp2é»˜è®¤éœ€è¦ä½¿ç”¨åŠ å¯†ï¼Œå› æ­¤ç›´æ¥åœ¨nginxå¯¹åº”çš„sslç›‘å¬ç«¯å£ä¸ŠåŠ ä¸Šhttp2å­—æ®µå³å¯ TLS1.3åˆ™åªéœ€è¦åœ¨ssl_protocolsæŒ‡ä»¤ä¸­åŠ ä¸ŠTLSv1.3 ssl_ciphersè¿™é‡Œçš„é…ç½®é‡‡ç”¨äº†æ¯”è¾ƒæ¿€è¿›çš„é…ç½®ï¼Œç”±äºå‰é¢åè®®åªå¯ç”¨äº†TLSv1.2å’ŒTLSv1.3ï¼Œå› æ­¤è¿™é‡Œå¯¹åº”çš„ssl_ciphersä¹Ÿç›´æ¥å¼ƒç”¨äº†å¤§é‡æ—§çš„å’Œå¼±çš„åŠ å¯†å¥—ä»¶ add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;;è¿™ä¸ªå­—æ®µå¤´ç”¨äºå¼€å¯HSTSé¿å…åœ¨è¿›è¡Œ301è·³è½¬çš„æ—¶å€™è¢«ä¸­é—´äººæ”»å‡»ï¼Œæ·»åŠ äº†preloadå­—æ®µè¿˜éœ€è¦åœ¨HSTSçš„å®˜ç½‘æ·»åŠ è‡ªå·±çš„ç½‘å€ï¼Œæ³¨æ„HSTSä¸åº”è¯¥æ·»åŠ åœ¨HTTPè¯·æ±‚çš„ç½‘ç«™ä¸Šï¼Œæ‰€ä»¥ä¸Šé¢å°†80ç«¯å£å’Œ443ç«¯å£åˆ†ä¸ºä¸¤ä¸ªserverå— ssl_stapling onç”¨äºå¼€å¯OCSPï¼ˆOnline Certificate Status Protocolï¼‰ï¼Œå¯ä»¥å‡ç¼“ç½‘ç»œå’Œå®¢æˆ·ç«¯èµ„æºè´Ÿæ‹… ssl_stapling_verify onç”¨äºå¼€å¯OCSP Staplingï¼ˆOCSPè£…è®¢ï¼‰ï¼Œè¿™æ˜¯TLSè¯ä¹¦çŠ¶æ€æŸ¥è¯¢æ‰©å±•ï¼ŒæœåŠ¡å™¨åœ¨TLSæ¡æ‰‹æ—¶å‘é€äº‹å…ˆç¼“å­˜çš„OCSPå“åº”ï¼Œç”¨æˆ·åªè¦éªŒè¯è¯¥å“åº”çš„æ—¶æ•ˆæ€§è€Œä¸ç”¨å†å‘æ•°å­—è¯ä¹¦è®¤è¯æœºæ„(CA)å‘é€è¯·æ±‚ï¼Œå¯ä»¥åŠ å¿«æ¡æ‰‹é€Ÿåº¦ 3.2 æ£€æµ‹ä½¿ç”¨mysslè¿›è¡Œæ£€æµ‹ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆé¡ºåˆ©åœ°æ˜¾ç¤ºå·²ç»æ”¯æŒäº†HTTP2å’ŒTLS1.3åè®®ã€‚ åŒæ—¶å¯ä»¥çœ‹åˆ°ç”±äºå…³é—­äº†TLS1.2ä»¥ä¸‹çš„åŠ å¯†åè®®æ”¯æŒå¹¶ä¸”å¼ºåˆ¶å¯ç”¨äº†httpsä¹‹åå¾ˆå¤šæ—§æµè§ˆå™¨å·²ç»ä¸å†æ”¯æŒäº†ï¼š åœ¨ä¸è€ƒè™‘æ—§ç‰ˆæµè§ˆå™¨çš„å…¼å®¹ä¹‹åå¯ä»¥å¾ˆè½»æ¾è·å¾—A+è¯„åˆ†å¹¶ä¸”ä¸Šæ¦œï¼š åŒæ ·çš„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ssllabæ¥è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•ç»“æœä¹Ÿæ˜¯å¤§åŒå°å¼‚ï¼š 3.3 ä¸»æµç½‘ç«™æµ‹è¯•ä¸‹è¡¨æ˜¯æˆªæ­¢2020å¹´6æœˆ6æ—¥ä½¿ç”¨Chromeï¼ˆ83.0.4103.97ï¼ˆæ­£å¼ç‰ˆæœ¬ï¼‰ï¼‰å¯¹ä¸€äº›ä¸»è¦çš„ç½‘ç«™é¦–é¡µè¿›è¡Œçš„ç®€å•æµ‹è¯• ç®€ç§° ç½‘ç«™ HTTP TLS è°·æ­Œ google.com/ H2+quic/46 TLS1.3 è‹¹æœ apple.com.cn/ H2 TLS1.3 GitHub github.com/ H2 TLS1.3 ç»´åŸºç™¾ç§‘ en.wikipedia.org/ H2 TLS1.3 k8s kubernetes.io/ H2 TLS1.3 nginxå•†ä¸šç‰ˆ nginx.com/ H2 TLS1.3 é˜¿é‡ŒCDN *.alicdn.com H2 TLS1.3 163é¦–é¡µ 163.com/ H2+HTTP1.1 TLS1.3 ssllab ssllabs.com/index.html HTTP1.1 TLS1.3 å¾®è½¯ microsoft.com/zh-cn/ H2 TLS1.2 docker docker.com/ H2 TLS1.2 å¾®ä¿¡ weixin.qq.com/ H2 TLS1.2 ä¸¥é€‰ you.163.com/ H2 TLS1.2 æ·˜å® taobao.com/ H2 TLS1.2 å¤©çŒ« tmall.com/ H2 TLS1.2 é˜¿é‡Œå·´å·´ alibaba.com/ H2 TLS1.2 csdn csdn.net/ H2 TLS1.2 è…¾è®¯äº‘ cloud.tencent.com/ H2 TLS1.2 äºšé©¬é€Š amazon.com/ H2+HTTP1.1 TLS1.2 QQ qq.com/ H2+HTTP1.1 TLS1.2 Bç«™ bilibili.com/ H2+HTTP1.1 TLS1.2 ç™¾åº¦ baidu.com/ H2+HTTP1.1 TLS1.2 ä»Šæ—¥å¤´æ¡ toutiao.com/ H2+HTTP1.1 TLS1.2 å°ç±³ mi.com/ H2+HTTP1.1 TLS1.2 æ‹¼å¤šå¤š pinduoduo.com/ H2+HTTP1.1 TLS1.2 ç¾å›¢ meituan.com/ HTTP1.1+H2(æå°‘) TLS1.2 ç½‘æ˜“ä¼ä¸šé‚® qiye.163.com/ HTTP1.1 TLS1.2 126é‚®ç®± 126.com/ HTTP1.1 TLS1.2 myssl myssl.com/ HTTP1.1 TLS1.2 openssl openssl.org/ HTTP1.1 TLS1.2 nginxå¼€æºç‰ˆ nginx.org/ HTTP1.1 TLS1.2 åä¸º huawei.com/cn/ HTTP1.1 TLS1.2","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"},{"name":"tls","slug":"tls","permalink":"https://tinychen.com/tags/tls/"}]},{"title":"Wiresharkå¯¹IMAPæŠ“åŒ…åˆ†æ","slug":"20200513-wireshark-analysis-imap","date":"2020-05-13T02:00:00.000Z","updated":"2020-05-13T02:00:00.000Z","comments":true,"path":"20200513-wireshark-analysis-imap/","link":"","permalink":"https://tinychen.com/20200513-wireshark-analysis-imap/","excerpt":"æœ¬æ–‡ä¸»è¦ä½¿ç”¨Wiresharkå¯¹é‚®ä»¶å®¢æˆ·ç«¯ä½¿ç”¨IMAPåè®®æ¥æ”¶é‚®ä»¶çš„è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…åˆ†æå¹¶ä½¿ç”¨telnetå‘½ä»¤è¿›è¡Œç®€å•æ“ä½œã€‚","text":"æœ¬æ–‡ä¸»è¦ä½¿ç”¨Wiresharkå¯¹é‚®ä»¶å®¢æˆ·ç«¯ä½¿ç”¨IMAPåè®®æ¥æ”¶é‚®ä»¶çš„è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…åˆ†æå¹¶ä½¿ç”¨telnetå‘½ä»¤è¿›è¡Œç®€å•æ“ä½œã€‚ 1ã€IMAPç®€ä»‹IMAPå’ŒPOP3ä¸¤ä¸ªåè®®åŸºæœ¬ä¸Šæ˜¯ç›®å‰æ”¯æŒå’Œä½¿ç”¨æœ€å¹¿æ³›çš„é‚®ä»¶æ¥æ”¶åè®®ï¼ŒIMAPå’ŒPOP3ç›¸æ¯”æœ‰ç€è®¸å¤šä¼˜ç‚¹ï¼Œå‚è€ƒwikiå’Œåé¢çš„æŠ“åŒ…ç»“æœè¿›è¡Œåˆ†æï¼Œè¿™é‡Œåˆ—å‡ºä¸€äº›åé¢æŠ“åŒ…çš„æ—¶å€™å¯ä»¥éªŒè¯çš„ä¼˜ç‚¹ï¼š æ”¯æŒè¿æ¥å’Œæ–­å¼€ä¸¤ç§æ“ä½œæ¨¡å¼ å’ŒPOP3åè®®åœ¨æ¥æ”¶å®Œé‚®ä»¶ä¹‹åå°±å’ŒæœåŠ¡å™¨æ–­å¼€è¿æ¥ä¸åŒï¼ŒIMAPåè®®å¯ä»¥ä¸€ç›´å’ŒæœåŠ¡å™¨ä¿æŒè¿æ¥ä»è€Œä½¿å¾—æ¥æ”¶æ–°é‚®ä»¶çš„å»¶è¿Ÿå¤§å¤§é™ä½ã€‚ æ”¯æŒå¤šä¸ªå®¢æˆ·åŒæ—¶è¿æ¥åˆ°ä¸€ä¸ªé‚®ç®± POP3åè®®å‡å®šé‚®ç®±å½“å‰çš„è¿æ¥æ˜¯å”¯ä¸€çš„è¿æ¥ã€‚ç›¸åï¼ŒIMAP4åè®®å…è®¸å¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®é‚®ç®±åŒæ—¶æä¾›ä¸€ç§æœºåˆ¶è®©å®¢æˆ·èƒ½å¤Ÿæ„ŸçŸ¥å…¶ä»–å½“å‰è¿æ¥åˆ°è¿™ä¸ªé‚®ç®±çš„ç”¨æˆ·æ‰€åšçš„æ“ä½œã€‚ æ”¯æŒåœ¨æœåŠ¡å™¨ä¿ç•™æ¶ˆæ¯çŠ¶æ€ä¿¡æ¯ é€šè¿‡ä½¿ç”¨åœ¨IMAP4åè®®ä¸­å®šä¹‰çš„æ ‡å¿—å®¢æˆ·ç«¯å¯ä»¥è·Ÿè¸ªæ¶ˆæ¯çŠ¶æ€ï¼Œä¾‹å¦‚é‚®ä»¶æ˜¯å¦è¢«è¯»å–ï¼Œå›å¤ï¼Œæˆ–è€…åˆ é™¤ã€‚è¿™äº›æ ‡è¯†å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥å¤šä¸ªå®¢æˆ·åœ¨ä¸åŒæ—¶é—´è®¿é—®ä¸€ä¸ªé‚®ç®±å¯ä»¥æ„ŸçŸ¥å…¶ä»–ç”¨æˆ·æ‰€åšçš„æ“ä½œã€‚ æ”¯æŒåœ¨æœåŠ¡å™¨ä¸Šè®¿é—®å¤šä¸ªé‚®ç®± IMAP4å®¢æˆ·ç«¯å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºï¼Œé‡å‘½åï¼Œæˆ–åˆ é™¤é‚®ç®±ï¼ˆé€šå¸¸ä»¥æ–‡ä»¶å¤¹å½¢å¼æ˜¾ç°ç»™ç”¨æˆ·ï¼‰ã€‚æ”¯æŒå¤šä¸ªé‚®ç®±è¿˜å…è®¸æœåŠ¡å™¨æä¾›å¯¹äºå…±äº«å’Œå…¬å…±æ–‡ä»¶å¤¹çš„è®¿é—®ã€‚ æ”¯æŒè®¿é—®æ¶ˆæ¯ä¸­çš„MIMEéƒ¨åˆ†å’Œéƒ¨åˆ†è·å–ã€‚ å‡ ä¹æ‰€æœ‰çš„Interneté‚®ä»¶éƒ½æ˜¯ä»¥MIMEæ ¼å¼ä¼ è¾“çš„ã€‚MIMEå…è®¸æ¶ˆæ¯åŒ…å«ä¸€ä¸ªæ ‘å‹ç»“æ„ï¼Œè¿™ä¸ªæ ‘å‹ç»“æ„çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯å•ä¸€å†…å®¹ç±»å‹è€Œéå¶å­èŠ‚ç‚¹éƒ½æ˜¯å¤šå—ç±»å‹çš„ç»„åˆã€‚IMAP4åè®®å…è®¸å®¢æˆ·ç«¯è·å–ä»»ä½•ç‹¬ç«‹çš„MIMEéƒ¨åˆ†å’Œè·å–ä¿¡æ¯çš„ä¸€éƒ¨åˆ†æˆ–è€…å…¨éƒ¨ã€‚è¿™äº›æœºåˆ¶ä½¿å¾—ç”¨æˆ·æ— éœ€ä¸‹è½½é™„ä»¶å°±å¯ä»¥æµè§ˆæ¶ˆæ¯å†…å®¹æˆ–è€…åœ¨è·å–å†…å®¹çš„åŒæ—¶æµè§ˆã€‚ 2ã€æŠ“åŒ…åˆ†æMUAä¸­çš„è®¾ç½®å¦‚ä¸‹ï¼ŒåŒæ ·ä¸ä½¿ç”¨åŠ å¯†åè®®æ–¹ä¾¿åˆ†ææ•°æ®ã€‚ é…ç½®å®Œæˆå¼€å§‹æŠ“åŒ…ä¹‹åå‘ç°é‚®ç®±å¤§å¸ˆæœ‰å¤šçº¿ç¨‹å¹¶å‘æ”¶ä»¶çš„æ“ä½œï¼Œè¿™ä¹Ÿç®—æ˜¯åˆ©ç”¨äº†IMAPåè®®çš„èƒ½å¤Ÿå…è®¸å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨çš„ç‰¹ç‚¹ï¼Œä½†æ˜¯æ˜¾ç„¶ä¸åˆ©äºæˆ‘ä»¬åˆ†æä¸²è¡Œæ¨¡å¼ä¸‹å•ä¸ªè¿æ¥æ”¶ä»¶çš„å®Œæ•´è¿‡ç¨‹ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥å¯¹æ¯”å¤šä¸ªè¿æ¥ä¹‹é—´çš„å·®å¼‚ã€‚ ç”±äºå»ºç«‹IMAPé€šä¿¡è¿æ¥å¿…é¡»è¦ç™»å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŸ¥çœ‹æŠ¥æ–‡å°±å¯ä»¥çŸ¥é“ä¸€å…±å¹¶è¡Œå‘èµ·äº†å¤šå°‘ä¸ªè¿æ¥ï¼Œåœ¨è¿™æ¬¡çš„æŠ¥æ–‡ä¸­ä¸€å…±å‘ç°äº†æœ‰ä¸‰ä¸ªLOGINçš„è¯·æ±‚æŠ¥æ–‡ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­åº”è¯¥ä¸€å…±å…ˆåå‘èµ·äº†ä¸‰ä¸ªè¿æ¥ï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªè¿æ¥æ˜¯åœ¨ç¬¬ä¸€ä¸ªè¿æ¥ç»“æŸä¹‹åå‘èµ·çš„ï¼Œå…·ä½“åˆ†æå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°æœ€å¼€å§‹å‡ ä¹åŒæ—¶å‘èµ·äº†ä¸¤ä¸ªIMAPè¿æ¥ï¼š 2.1 ç¬¬ä¸€ä¸ªè¿æ¥æˆ‘ä»¬å…ˆæ¥å¯¹ç¬¬ä¸€ä¸ªè¿æ¥è¿›è¡Œåˆ†æï¼š é¦–å…ˆæˆ‘ä»¬å¯ä»¥ç¡®å®šIMAPçš„ä¼ è¾“å±‚åè®®ä¹Ÿæ˜¯ä½¿ç”¨çš„TCPåè®®ï¼ŒåŒæ ·è¿™é‡Œç•¥å»TCPä¸‰æ¡å››æŒ¥çš„åˆ†æï¼Œç›´æ¥çœ‹IMAPç›¸å…³éƒ¨åˆ†çš„æŠ¥æ–‡ï¼š å®¢æˆ·ç«¯ä¸IMAPæœåŠ¡å™¨åœ¨TCPä¸‰æ¬¡æ¡æ‰‹ä¹‹åå»ºç«‹è¿æ¥ IMAPæœåŠ¡å™¨è¿”å›OKä¿¡æ¯ï¼Œå¹¶è¯´æ˜è‡ªèº«é‚®ä»¶ç³»ç»Ÿçš„ç±»å‹ä¸ºcoremail å®¢æˆ·ç«¯å‘é€CAPABILITYå‘½ä»¤æŸ¥è¯¢å¯ç”¨çš„å‘½ä»¤ï¼Œè¿™ä¸ªå’ŒPOP3ä¸­çš„CAPAå‘½ä»¤åŠŸèƒ½ç›¸åŒ IMAPæœåŠ¡å™¨è¿”å›å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ å®¢æˆ·ç«¯å‘é€IDå‘½ä»¤ï¼Œé™„å¸¦äº†MUAå’ŒOSçš„ç›¸å…³ä¿¡æ¯ IMAPæœåŠ¡å™¨è¿”å›IDå­—ç¬¦ä¸²ï¼ŒåŒæ ·é™„å¸¦äº†é‚®ä»¶æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ å®¢æˆ·ç«¯å‘é€LOGINå‘½ä»¤è¿›è¡Œç™»å½•ï¼ŒåŒå¼•å·å†…çš„ä¸ºé‚®ç®±è´¦å·ï¼Œåé¢åŠ ä¸€ä¸ªç©ºæ ¼ç„¶åç´§è·Ÿç€çš„æ˜¯å¯†ç  IMAPæœåŠ¡å™¨è¿”å›OKæŒ‡ä»¤æç¤ºç™»å½•æˆåŠŸ å®¢æˆ·ç«¯å‘é€LISTå‘½ä»¤æŸ¥è¯¢è¯¥è´¦å·å†…çš„é‚®ä»¶ä¿¡æ¯ï¼Œä½†æ˜¯å¯èƒ½å‘½ä»¤çš„æ ¼å¼ä¸å¯¹ï¼Œå¹¶æ²¡æœ‰æŸ¥è¯¢åˆ°ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ IMAPæœåŠ¡å™¨è¿”å›æŸ¥è¯¢ç»“æœä¸ºç©ºï¼š å¦‚æœæŠŠæŸ¥è¯¢å‘½ä»¤æ¢ä¸ºLIST &quot;&quot; &quot;*&quot;åˆ™å¯ä»¥æŸ¥è¯¢åˆ°è¯¥è´¦å·çš„æ‰€æœ‰é‚®ç®±æ–‡ä»¶å¤¹ï¼š å®¢æˆ·ç«¯å‘é€NOOPæŒ‡ä»¤ï¼Œä¸ä¹‹å‰çš„POP3åè®®ç±»ä¼¼ï¼ŒNOOPæŒ‡ä»¤çš„ä½œç”¨åº”è¯¥æ˜¯ç”¨äºä¿æŒè¿æ¥ï¼Œé»˜è®¤ç›¸å½“äºæ— æ“ä½œï¼Œä½†æ˜¯åœ¨æ­¤æ¬¡è¿æ¥è¿˜æ²¡ä½¿ç”¨è¿‡SELECTå‘½ä»¤å¹¶ä¸”æ˜¯ç¬¬ä¸€æ¬¡å‘é€NOOPæŒ‡ä»¤çš„æ—¶å€™ï¼ŒIMAPæœåŠ¡å™¨ä¼šè¿”å›è¯¥è´¦å·ä¸‹æ‰€æœ‰ç›®å½•çš„é‚®ä»¶æ€»æ•° IMAPæœåŠ¡å™¨è¿”å›OKæŒ‡ä»¤å¹¶ä¸”è¿”å›äº†é‚®ä»¶æ€»æ•°ã€ å®¢æˆ·ç«¯ä½¿ç”¨SELECTæŒ‡ä»¤ï¼Œå¹¶ä¸”é€‰ä¸­äº†INBOXæ–‡ä»¶å¤¹ï¼ˆä¸€èˆ¬å¯¹åº”æ”¶ä»¶ç®±ï¼‰ï¼Œç›¸å½“äºåœ¨æ•°æ®åº“ä¸­é€‰ä¸­äº†ä¸€ä¸ªæ•°æ®è¡¨ ç„¶åè¿æ¥å°±è«åæ²¡äº† 2.2 ç¬¬äºŒä¸ªè¿æ¥ç¬¬äºŒæ¬¡è¿æ¥çš„æ•°æ®åŒ…è¾ƒé•¿ï¼Œæˆ‘ä»¬æˆªå–éƒ¨åˆ†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼š å¯¹æ¯”ç¬¬ä¸€æ¬¡è¿æ¥ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸åŒç‚¹ï¼š ä½¿ç”¨äº†XLIST &quot;&quot; &quot;*&quot;æŸ¥è¯¢åˆ°äº†é‚®ä»¶è´¦å·ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹ï¼ˆæ”¶ä»¶ç®±ã€å‘ä»¶ç®±ã€è‰ç¨¿ç®±ã€åƒåœ¾ç®±ã€åƒåœ¾é‚®ä»¶ç­‰ï¼‰ ä¾æ¬¡ä½¿ç”¨SELECTå‘½ä»¤å’ŒUID SEARCH UID å‘½ä»¤æ¥å¯¹æ¯ä¸ªæ–‡ä»¶å¤¹è¿›è¡Œæ“ä½œï¼Œè¿›è€Œè·å–åˆ°è¯¥è´¦å·å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰é‚®ä»¶çš„æ€»æ•°å’Œå¯¹åº”çš„UID 2.3 ç¬¬ä¸‰ä¸ªè¿æ¥ä»wiresharkä¸Šå¯¹æ•°æ®åŒ…æ ‡è®°çš„åºå·æ¥çœ‹ï¼Œç¬¬ä¸‰ä¸ªè¿æ¥æ˜¯åœ¨ç¬¬ä¸€ä¸ªè¿æ¥ç»“æŸä¹‹åæ‰å‘èµ·çš„ã€‚å¯¹åº”çš„å®¢æˆ·ç«¯ä¸»è¦æ“ä½œå¦‚ä¸‹ï¼š ä¸Šé¢çš„å†…å®¹é‡å¤æ“ä½œè¾ƒå¤šï¼Œä¸»è¦å°±æ˜¯å¯¹æ¯ä¸ªæ–‡ä»¶å¤¹éƒ½è¿›è¡ŒSELECTï¼Œç„¶åè·å–é‡Œé¢çš„é‚®ä»¶å…·ä½“å†…å®¹ï¼Œä¸»è¦çš„æ ¸å¿ƒæ“ä½œæœ‰ä»¥ä¸‹ä¸¤ä¸ª UID FETCH 1557156839:1557156846 (UID FLAGS RFC822.SIZE BODYSTRUCTURE INTERNALDATE BODY.PEEK[HEADER.FIELDS (Date Subject From Sender Reply-To To Cc Bcc Message-ID References In-Reply-To X-MailMaster-ShowOneRcpt X-CUSTOM-MAIL-MASTER-SENT-ID Disposition-Notification-To X-CM-CTRLMSGS)]) UID FETCH 1557156844 BODY.PEEK[1] ä¸Šé¢ä¸¤ä¸ªè¯·æ±‚å‘½ä»¤ä¸­çš„1557156844å°±æ˜¯åœ¨ç¬¬ä¸€ä¸ªè¿æ¥ä¸­ä½¿ç”¨UID SEARCHå‘½ä»¤æŸ¥è¯¢åˆ°çš„é‚®ä»¶çš„UIDï¼Œè¿™é‡Œä½¿ç”¨äº†UID FETCHå‘½ä»¤æ¥è·å–é‚®ä»¶çš„å¯¹åº”å†…å®¹ã€‚ç”±äºå‰é¢æˆ‘ä»¬æåˆ°é‚®ä»¶çš„æ ¼å¼æ˜¯ç¬¦åˆMIMEæ ‡å‡†çš„ï¼Œè€ŒIMAPåè®®åˆæ˜¯å…è®¸MUAä¸‹è½½ç¬¦åˆMIMEæ ‡å‡†çš„éƒ¨åˆ†é‚®ä»¶å†…å®¹ï¼Œå› æ­¤è¿™ä¸¤æ¡UIDå‘½ä»¤å°±æ˜¯ç”¨äºè·å–å¯¹åº”çš„é‚®ä»¶çš„ç‰¹å®šéƒ¨åˆ†çš„å†…å®¹ã€‚ 2.4 å°ç»“åœ¨æ¢äº†å¦ä¸€ä¸ªæµ‹è¯•è´¦å·è¿›è¡ŒåŒæ ·çš„æŠ“åŒ…æ“ä½œä¹‹åæˆ‘å‘ç°ä¸¤æ¬¡çš„æ•°æ®è¯·æ±‚æ“ä½œå‡ ä¹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æœ‰ä¸‰ä¸ªè¿æ¥ï¼Œæ“ä½œä¹Ÿå’Œä¸Šé¢ç›¸åŒã€‚ç”±æ­¤å¯ä»¥åˆ†æIMAPåè®®çš„å¯æ“ä½œæ€§è¦æ¯”POP3å¼ºå¾ˆå¤šï¼Œå› æ­¤åœ¨å…·ä½“çš„åŠŸèƒ½å®ç°ä¸Šå¯¹äºä¸åŒçš„MUAè€Œè¨€ä¹Ÿæœ‰ä¸åŒã€‚ 3ã€telnetæ“ä½œåŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥telnetåˆ°é‚®ä»¶æœåŠ¡å™¨çš„143ç«¯å£æ¥è¿›è¡Œå‘½ä»¤æ“ä½œï¼š 123456789101112131415161718192021222324252627282930313233343536373839[root@www coremail]# telnet localhost 143Trying 127.0.0.1...Connected to localhost.Escape character is &#x27;^]&#x27;.* OK Coremail System IMap Server Ready(126com[c92b4e18679ada4069d0bde6e2528ad1])C1 LOGIN &quot;test02@coremail.cn&quot; passwordC1 OK LOGIN completedC2 LIST &quot;&quot; &quot;&quot;* LIST (\\Noselect) &quot;/&quot; &quot;&quot;C2 OK LIST CompletedC3 LIST &quot;&quot; &quot;*&quot;* LIST () &quot;/&quot; &quot;INBOX&quot;* LIST (\\Drafts) &quot;/&quot; &quot;Drafts&quot;* LIST (\\Sent) &quot;/&quot; &quot;Sent Items&quot;* LIST (\\Trash) &quot;/&quot; &quot;Trash&quot;* LIST (\\Junk) &quot;/&quot; &quot;Junk E-mail&quot;* LIST () &quot;/&quot; &quot;Virus Items&quot;C3 OK LIST CompletedC4 SELECT INBOX* 8 EXISTS* 0 RECENT* OK [UIDVALIDITY 1] UIDs valid* FLAGS (\\Answered \\Seen \\Deleted \\Draft \\Flagged)* OK [PERMANENTFLAGS (\\Answered \\Seen \\Deleted \\Draft \\Flagged)] LimitedC4 OK [READ-WRITE] SELECT completedC5 UID SEARCH 1:** SEARCH 1557156839 1557156840 1557156841 1557156842 1557156843 1557156844 1557156845 1557156846C5 OK SEARCH completedC6 UID FETCH 1557156839C6 BAD Parse command errorC7 UID FETCH 1557156839 FULL* 1 FETCH (UID 1557156839 INTERNALDATE &quot; 6-May-2019 23:33:59 +0800&quot; FLAGS (\\Seen) ENVELOPE (&quot;Mon, 6 May 2019 23:33:59 +0800 (GMT+08:00)&quot; &quot;=?UTF-8?B?5qyi6L+O5L2/55SoQ29yZW1haWznlLXlrZDpgq7ku7bns7vnu58vV2VsY29tZSB0byB0aGUgQ29yZW1haWwgZS1tYWlsIHN5c3RlbQ==?=&quot; ((NIL NIL &quot;postmaster&quot; &quot;coremail.cn&quot;)) ((NIL NIL &quot;postmaster&quot; &quot;coremail.cn&quot;)) ((NIL NIL &quot;postmaster&quot; &quot;coremail.cn&quot;)) ((NIL NIL &quot;test02&quot; &quot;coremail.cn&quot;)) NIL NIL NIL &quot;&lt;1106604853.1.1557156839490@www.example.com&gt;&quot;) BODY ((&quot;text&quot; &quot;html&quot; (&quot;charset&quot; &quot;UTF-8&quot;) NIL NIL &quot;quoted-printable&quot; 7274 152) &quot;related&quot;) RFC822.SIZE 7959)C7 OK Fetch completedC8 UID FETCH 1557156846 FULL* 8 FETCH (UID 1557156846 INTERNALDATE &quot; 8-May-2019 09:43:11 +0800&quot; FLAGS (\\Seen) ENVELOPE (&quot;Wed, 8 May 2019 09:43:11 +0800 (CST)&quot; &quot;=?UTF-8?B?dGVsbmV0IHRlc3QgbWFpbCBBdXRoZW50aWNhdGVk?=&quot; ((&quot;=?UTF-8?B?InRlc3QwMSI=?=&quot; NIL &quot;test01&quot; &quot;coremail.cn&quot;)) ((&quot;=?UTF-8?B?InRlc3QwMSI=?=&quot; NIL &quot;test01&quot; &quot;coremail.cn&quot;)) ((&quot;=?UTF-8?B?InRlc3QwMSI=?=&quot; NIL &quot;test01&quot; &quot;coremail.cn&quot;)) ((&quot;=?UTF-8?B?InRlc3QwMiI=?=&quot; NIL &quot;test02&quot; &quot;coremail.cn&quot;)) NIL NIL NIL &quot;&lt;5CD2342F.000006.02460@coremail.cn&gt;&quot;) BODY (&quot;TEXT&quot; &quot;PLAIN&quot; NIL NIL NIL &quot;7BIT&quot; 0 0) RFC822.SIZE 656)C8 OK Fetch completedC9 UID FETCH 1557156844 FULL* 6 FETCH (UID 1557156844 INTERNALDATE &quot; 8-May-2019 16:59:38 +0800&quot; FLAGS (\\Seen) ENVELOPE (&quot;Wed, 8 May 2019 16:59:38 +0800 (CST)&quot; &quot;=?UTF-8?B?dGVsbmV0IHRlc3QgbWFpbA==?=&quot; ((&quot;=?UTF-8?B?InRlc3QwMSI=?=&quot; NIL &quot;test01&quot; &quot;coremail.cn&quot;)) ((&quot;=?UTF-8?B?InRlc3QwMSI=?=&quot; NIL &quot;test01&quot; &quot;coremail.cn&quot;)) ((&quot;=?UTF-8?B?InRlc3QwMSI=?=&quot; NIL &quot;test01&quot; &quot;coremail.cn&quot;)) ((&quot;=?UTF-8?B?InRlc3QwMiI=?=&quot; NIL &quot;test02&quot; &quot;coremail.cn&quot;)) NIL NIL NIL &quot;&lt;5CD29A7A.000004.02460@coremail.cn&gt;&quot;) BODY (&quot;TEXT&quot; &quot;PLAIN&quot; NIL NIL NIL &quot;7BIT&quot; 0 0) RFC822.SIZE 642)C9 OK Fetch completed","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"wireshark","slug":"wireshark","permalink":"https://tinychen.com/tags/wireshark/"},{"name":"mail","slug":"mail","permalink":"https://tinychen.com/tags/mail/"},{"name":"imap","slug":"imap","permalink":"https://tinychen.com/tags/imap/"}]},{"title":"Windows Terminal + WSL2 + CENTOS é…ç½®Windowså‘½ä»¤ç»ˆç«¯","slug":"20200512-windows-terminal-wsl2-centos-installation","date":"2020-05-12T02:00:00.000Z","updated":"2020-05-12T02:00:00.000Z","comments":true,"path":"20200512-windows-terminal-wsl2-centos-installation/","link":"","permalink":"https://tinychen.com/20200512-windows-terminal-wsl2-centos-installation/","excerpt":"æœ¬æ–‡ä¸»è¦ç”¨äºè®°å½•åœ¨Windowsä¸Šä½¿ç”¨WSL2å’Œcentosç³»ç»Ÿæ‰“é€ ä¸€ä¸ªå…è´¹é«˜æ•ˆçš„shellç»ˆç«¯çš„é…ç½®è¿‡ç¨‹ä»¥åŠç•Œé¢ä¼˜åŒ–è¿‡ç¨‹ã€‚","text":"æœ¬æ–‡ä¸»è¦ç”¨äºè®°å½•åœ¨Windowsä¸Šä½¿ç”¨WSL2å’Œcentosç³»ç»Ÿæ‰“é€ ä¸€ä¸ªå…è´¹é«˜æ•ˆçš„shellç»ˆç«¯çš„é…ç½®è¿‡ç¨‹ä»¥åŠç•Œé¢ä¼˜åŒ–è¿‡ç¨‹ã€‚ 1ã€é€‰å‹åˆ†æä¹‹å‰ä¸€ç›´éƒ½æ˜¯ä½¿ç”¨termiuså’Œwindowsæ¥è¿›è¡Œsshç®¡ç†ï¼Œä½†æ˜¯æœ€è¿‘termiusè¦è¿‡æœŸäº†ï¼ˆæ²¡é’±ç»­è´¹ï¼‰ï¼Œä¸ç”¨ç›—ç‰ˆï¼ˆç‰ˆæƒæ„è¯†ï¼‰ï¼Œsshçš„Agent ForwardingåŠŸèƒ½æ˜¯ä¸ªäººåˆšéœ€ä¸”ä¸ºtermiusçš„ä»˜è´¹ç‰ˆæ‰æœ‰çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¼€å§‹ç ”ç©¶windowsä¸Šå…è´¹çš„sshå®¢æˆ·ç«¯ç®¡ç†å·¥å…·æˆ–è€…æ˜¯æ–¹å¼ã€‚ ï¼ˆmacç³»ç»Ÿç”¨æˆ·å¯ä»¥è·³è¿‡è¿™ç¯‡æ–‡ç« ï¼‰é¦–å…ˆè€ƒè™‘åˆ°äº†macï¼Œå› ä¸ºmacç³»ç»Ÿæ˜¯ç±»unixç³»ç»Ÿï¼Œåœ¨å‘½ä»¤è¡Œç»ˆç«¯æ“ä½œä¸Šè¦æ¯”windowså¥½å¤ªå¤šï¼Œä½†æ˜¯æ²¡é’±ä¹°macï¼Œæ‰€ä»¥pass ç„¶åå¦‚æœç›´æ¥ä½¿ç”¨linuxç³»ç»Ÿçš„è¯è™½ç„¶shellçš„é—®é¢˜å¾ˆå®¹æ˜“è§£å†³ï¼Œä½†æ˜¯å…¶ä»–çš„åŠå…¬è½¯ä»¶æ— æ³•ä½¿ç”¨æˆ–è€…å¾ˆéš¾ç”¨ï¼›å¦‚æœç”¨è™šæ‹Ÿæœºè·‘linuxï¼Œå¯åŠ¨éº»çƒ¦ï¼Œè€—è´¹æ€§èƒ½ï¼Œæ–‡ä»¶ç®¡ç†ä¹Ÿååˆ†éº»çƒ¦ï¼›æ‰€ä»¥pass è¿˜æœ‰å°±æ˜¯å„ç§windowsä¸Šçš„å„ç§å…è´¹ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¦‚powershellã€GitBashã€cmderç­‰ç­‰ï¼Œèƒ½å®ç°ä¸€å®šçš„Linuxå‘½ä»¤å’ŒshellåŠŸèƒ½ï¼Œä½†æ˜¯ç›¸æ¯”åŸç”Ÿlinuxè¿˜æ˜¯åŠŸèƒ½æ®‹ç¼ºã€‚ ä½†æ˜¯å¦‚æœåªè¦ç®¡ç†å„ç§sshå®¢æˆ·ç«¯çš„è¯å¾ˆå¤šå…è´¹å·¥å…·å·²ç»è¶³å¤Ÿä¼˜ç§€äº†ï¼Œè€Œç¬”è€…æœ¬æ¬¡é™¤äº†ç®¡ç†sshä¹‹å¤–è¿˜æƒ³è¦å®ç°ä¸€å®šçš„shellåŠŸèƒ½ï¼Œå› æ­¤æœ€åé”å®šWindows10ä¸Šé¢çš„2004ç‰ˆæœ¬çš„wsl2å·¥å…·ï¼Œç”¨å®ƒæ¥è¿è¡Œä¸€ä¸ªlinuxç³»ç»Ÿï¼Œè™½ç„¶æ˜¯æ®‹ç¼ºçš„Linuxï¼Œä½†æ˜¯åœ¨shellåŠŸèƒ½å’ŒsshåŠŸèƒ½ä¸Šå’Œç›´æ¥è¿è¡ŒLinuxå¹¶æ— å·®å¼‚ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯windowsçš„ç‰ˆæœ¬è¦æ¯”è¾ƒæ–°ã€‚ WSL 2 is only available in Windows 10 builds 18917 or higher 2ã€å®‰è£…wslwindowså®˜ç½‘çš„å®‰è£…æ•™ç¨‹æ¯”è¾ƒè¯¦ç»†ï¼Œå¹¶ä¸”wslçš„å®‰è£…å¯ç”¨æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç®¡ç†å‘˜æ¨¡å¼çš„powershellé€šè¿‡å‘½ä»¤è¡Œæ¥å¯ç”¨ï¼š 12dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestartdism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart å‘½ä»¤é¡ºåˆ©æ‰§è¡Œå®Œåéœ€è¦é‡å¯ï¼Œè¿™æ—¶å€™è¾“å…¥wsl --helpå°±å¯ä»¥çœ‹åˆ°wslå·²ç»å®‰è£…æˆåŠŸã€‚ 3ã€å®‰è£…centosWindowsçš„åº”ç”¨å•†åº—ä¸­æœ‰ä¸€äº›ä¸é”™çš„linuxå‘è¡Œç‰ˆï¼ŒåŒ…æ‹¬å¾ˆå¤šåŒå­¦éƒ½å¾ˆå–œæ¬¢çš„ubuntuï¼Œä½†æ˜¯ä¸ªäººæ¯”è¾ƒç†Ÿæ‚‰ä½¿ç”¨centosï¼Œè€Œåº”ç”¨å•†åº—ä¸­çš„centosæ˜¯è¦æ”¶è´¹çš„ï¼Œä¸è¿‡å¥½åœ¨githubä¸Šé¢æœ‰CENTOSå®˜æ–¹å¼€æºçš„å®‰è£…åŒ…ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨githubä¸Šçš„å®‰è£…åŒ…è¿›è¡Œå®‰è£…ã€‚ å¦‚æœä½¿ç”¨åº”ç”¨å•†åº—ä¸­çš„å‘è¡Œç‰ˆç›´æ¥ç‚¹å‡»å®‰è£…å³å¯ã€‚éšåä¾¿å¯ä»¥è·³è¿‡ä¸‹é¢çš„centosçš„å®‰è£…éƒ¨åˆ†ã€‚ é¦–å…ˆæˆ‘ä»¬å»centosçš„GitHubé¡µé¢ä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…ï¼š æ³¨æ„è¿™é‡Œè¦åˆ‡æ¢åˆ†æ”¯è¿›è¡Œä¸‹è½½ï¼Œä»¥centos7-x86.64ä¸ºä¾‹ï¼Œè¿™é‡Œå¯¹åº”çš„å°±æ˜¯æœ€æ–°çš„centos7.8ç³»ç»Ÿï¼Œæˆ‘ä»¬åªéœ€è¦ä¸‹è½½å¯¹åº”çš„tar.xzå‹ç¼©åŒ…å³å¯ã€‚ 1wget https://github.com/CentOS/sig-cloud-instance-images/blob/CentOS-7-x86_64/docker/centos-7-x86_64-docker.tar.xz æ¥ç€æˆ‘ä»¬ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ä¸€ä¸ªpowershellçª—å£ï¼š 1234# å®‰è£… ChocolateySet-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString(&#x27;https://chocolatey.org/install.ps1&#x27;))# å®‰è£… LxRunOfflinechoco install lxrunoffline æ³¨æ„è¿™é‡Œå®‰è£…å®Œæˆä¹‹åéœ€è¦é‡å¯powershellæ¥è¿›è¡Œä¸‹ä¸€æ­¥çš„å®‰è£… 12345LxRunOffline install -n è‡ªå®šä¹‰ç³»ç»Ÿåç§° -d å®‰è£…ç›®å½•è·¯å¾„ -f tar.xzå®‰è£…åŒ…è·¯å¾„# æ³¨æ„windowsç³»ç»Ÿå‘½ä»¤è¡Œä¸­çš„æ–‡ä»¶è·¯å¾„å’Œlinuxç³»ç»Ÿå·®åˆ«å¾ˆå¤§# æ¯”å¦‚æˆ‘è¿™é‡Œçš„å®‰è£…å‘½ä»¤å°±æ˜¯LxRunOffline.exe install -n centos -d D:/centos -f .\\centos-7-x86_64-docker.tar.xz# å°†centoså®‰è£…åˆ°Dç›˜çš„centosæ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶ä¸”å‘½åä¸ºcentos æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ä¸‹è¿°ä¸¤ç§æ–¹å¼å°è¯•å¯åŠ¨ 12LxRunOffline run -n è‡ªå®šä¹‰ç³»ç»Ÿåç§°wsl -d è‡ªå®šä¹‰ç³»ç»Ÿåç§° 4ã€å‡çº§centosä¸ºwsl2windowså®˜ç½‘æ•™ç¨‹ 123456# åˆ—å‡ºå·²ç»å®‰è£…çš„wslçš„ä¿¡æ¯wsl -l -v# å°†å¯¹åº”çš„wslè®¾ä¸ºwsl2ï¼Œæ³¨æ„&lt;Distro&gt;è¦å’Œä¸Šé¢æŸ¥è¯¢åˆ°çš„ä¿¡æ¯ä¸€è‡´wsl --set-version &lt;Distro&gt; 2# è®¾ç½®é»˜è®¤ä½¿ç”¨çš„å‘è¡Œç‰ˆwsl -s &lt;Distro&gt; 5ã€é…ç½®windows terminalä½¿ç”¨windowsçš„cmdæˆ–è€…powershelléƒ½å¯ä»¥ç›´æ¥è¾“å…¥wslå‘½ä»¤è¿›å…¥åˆ°wslç³»ç»Ÿä¸­è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯ç”±äºè¿™ä¸¤è€…çš„ç•Œé¢æ¯”è¾ƒä¸‘ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œä½¿ç”¨å¯ä»¥å®šåˆ¶æ›´å¤šå‚æ•°çš„windows terminalæ¥è¿›è¡Œæ›¿æ¢ã€‚ ä¸è¿‡windows terminalç›®å‰æ¥è¯´å±äºæ¯”è¾ƒè½»é‡çº§çš„äº§å“ï¼Œå¦‚æœéœ€è¦æ›´å¤šçš„åŠŸèƒ½å¯ä»¥è€ƒè™‘ä¸€ä¸‹å…¶ä»–çš„è½¯ä»¶ï¼Œè¿™é‡Œé¢å¤–æ¨èä¸€ä¸ªå…è´¹çš„å…¨å¹³å°ç»ˆç«¯terminusï¼Œæ³¨æ„æ¯”æ”¶è´¹çš„termiusè¦å¤šä¸€ä¸ªå­—æ¯nï¼Œä¹Ÿæ˜¯githubä¸Šé¢çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå…è´¹é«˜æ•ˆä¸”å†…ç½®å¤šç§ä¸»é¢˜å’Œå°‘é‡è¿˜å¯ä»¥çš„æ’ä»¶ã€‚ 5.1 å®‰è£…windows terminalwindows terminalç›´æ¥ä½¿ç”¨win10è‡ªå¸¦çš„åº”ç”¨å•†åº—å³å¯æœç´¢ä¸‹è½½å®‰è£…ã€‚ 5.2 å®‰è£…powerline/fontspowerline/fontsæ˜¯githubä¸Šé¢çš„ä¸€ä¸ªé¡¹ç›®ï¼Œæ¶µç›–äº†è¾ƒå¤šçš„å­—ä½“ï¼Œwindowsæœ¬èº«å†…ç½®çš„å­—ä½“å¯èƒ½åœ¨shellä¸­æ˜¾ç¤ºä¸å¤ªç¾è§‚ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦åœ¨windowsç³»ç»Ÿä¸­å’Œwslä¸­éƒ½å®‰è£…å­—ä½“ã€‚ é¦–å…ˆåœ¨wslä¸­ä½¿ç”¨gitæ‹‰å–é¡¹ç›®å¹¶ä¸”å®‰è£… 123git clone https://github.com/powerline/fonts.git --depth=1cd fonts./install.sh åœ¨Windowsä¸­ä¹Ÿéœ€è¦å®‰è£…è¯¥å­—ä½“ï¼Œä»¥UbuntuMonoä¸ºä¾‹ï¼ŒåŒæ ·æ˜¯ä¸‹è½½ä¹‹åè¿›å…¥åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­æ‰‹åŠ¨å®‰è£…æ‰€æœ‰çš„ttfå­—ä½“å³å¯ï¼š ï¼ˆæ³¨æ„å°½é‡ä»¥ç®¡ç†å‘˜èº«ä»½ä¸ºæœ¬æœºæ‰€æœ‰ç”¨æˆ·å®‰è£…ï¼‰ 5.3 é…ç½®iTerm2-Color-Schemesä¸»é¢˜çš„æ•ˆæœæˆ‘ä»¬å¯ä»¥åœ¨å®˜ç½‘è¿›è¡Œé¢„è§ˆï¼Œé…ç½®å‚æ•°æˆ‘ä»¬å¯ä»¥åœ¨å¯¹åº”çš„GitHubä¸­æ‰¾åˆ°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¦æ‰¾åˆ°å¯¹åº”çš„windows terminalç›®å½•ä¸­çš„é…ç½®ã€‚ 5.4 é…ç½®setting.jsonsetting.jsonçš„å‚æ•°éå¸¸å¤šï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯è®¾å®šæ˜¾ç¤ºç•Œé¢å’Œå¿«æ·é”®ç­‰æ“ä½œï¼Œå¹¶ä¸”è¿˜å¯ä»¥æ·»åŠ èƒŒæ™¯å›¾ç‰‡ï¼Œè‡ªå®šä¹‰ä¸åŒshellçš„å›¾æ ‡iconå’Œä¸»é¢˜ç­‰ç”¨ä»¥åŒºåˆ†ä¸åŒçš„shellé¿å…è¯¯æ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899// To view the default settings, hold &quot;alt&quot; while clicking on the &quot;Settings&quot; button.// For documentation on these settings, see: https://aka.ms/terminal-documentation&#123; &quot;$schema&quot;: &quot;https://aka.ms/terminal-profiles-schema&quot;, &quot;defaultProfile&quot;: &quot;&#123;aabae64a-7cf7-5add-b5d6-744e54ab56d6&#125;&quot;, //è®¾å®šé»˜è®¤å¯åŠ¨ä½¿ç”¨çš„shellã€‚è¿™é‡Œä½¿ç”¨åé¢å¯¹åº”çš„guid &quot;initialRows&quot;: 40, //åˆå§‹åŒ–çª—å£çš„è¡Œæ•° &quot;initialCols&quot;: 150,//åˆå§‹åŒ–çª—å£çš„åˆ—æ•° &quot;alwaysShowTabs&quot;: true, &quot;showTerminalTitleInTitlebar&quot;: true, &quot;profiles&quot;: &#123; &quot;defaults&quot;: &#123; // Put settings here that you want to apply to all profiles &#125;, &quot;list&quot;: [ &#123; &quot;guid&quot;: &quot;&#123;07b52e3e-de2c-5db4-bd2d-ba144ed6c273&#125;&quot;, &quot;hidden&quot;: false, &quot;name&quot;: &quot;Ubuntu-20.04&quot;, &quot;source&quot;: &quot;Windows.Terminal.Wsl&quot;, &quot;fontFace&quot;: &quot;Fira Mono for Powerline&quot;, &quot;fontSize&quot;: 12, &quot;colorScheme&quot;: &quot;Ubuntu&quot;, //è¿™é‡Œçš„colorè¦å’Œåé¢çš„schemesä¸­çš„ä¸€è‡´ &quot;useAcrylic&quot; : false, // æ˜¯å¦å¯ç”¨çª—å£é€æ˜åº¦ï¼Œæ•ˆæœç±»ä¼¼æ¯›ç»ç’ƒç‰¹æ•ˆ &quot;acrylicOpacity&quot; : 0.6 // çª—å£é€æ˜åº¦ &#125; &#123; &quot;guid&quot;: &quot;&#123;aabae64a-7cf7-5add-b5d6-744e54ab56d6&#125;&quot;, &quot;hidden&quot;: false, &quot;name&quot;: &quot;centos&quot;, &quot;source&quot;: &quot;Windows.Terminal.Wsl&quot;, &quot;fontFace&quot;: &quot;Fira Mono for Powerline&quot;, &quot;fontSize&quot;: 12, &quot;colorScheme&quot;: &quot;Atom&quot;, &quot;useAcrylic&quot; : true, // çª—å£é€æ˜åº¦ &quot;acrylicOpacity&quot; : 0.8 // çª—å£é€æ˜åº¦ &#125;, &#123; // Make changes here to the cmd.exe profile &quot;guid&quot;: &quot;&#123;0caa0dad-35be-5f56-a8ff-afceeeaa6101&#125;&quot;, &quot;name&quot;: &quot;cmd&quot;, &quot;commandline&quot;: &quot;cmd.exe&quot;, &quot;hidden&quot;: false, &quot;fontSize&quot;: 12, &quot;colorScheme&quot;: &quot;MaterialDark&quot;, &quot;useAcrylic&quot; : false, // çª—å£é€æ˜åº¦ &quot;acrylicOpacity&quot; : 0.5 // çª—å£é€æ˜åº¦ &#125; ] &#125;, // Add custom color schemes to this array &quot;schemes&quot;: [ &#123; &quot;name&quot;: &quot;Atom&quot;, &quot;black&quot;: &quot;#000000&quot;, &quot;red&quot;: &quot;#fd5ff1&quot;, &quot;green&quot;: &quot;#87c38a&quot;, &quot;yellow&quot;: &quot;#ffd7b1&quot;, &quot;blue&quot;: &quot;#85befd&quot;, &quot;purple&quot;: &quot;#b9b6fc&quot;, &quot;cyan&quot;: &quot;#85befd&quot;, &quot;white&quot;: &quot;#e0e0e0&quot;, &quot;brightBlack&quot;: &quot;#000000&quot;, &quot;brightRed&quot;: &quot;#fd5ff1&quot;, &quot;brightGreen&quot;: &quot;#94fa36&quot;, &quot;brightYellow&quot;: &quot;#f5ffa8&quot;, &quot;brightBlue&quot;: &quot;#96cbfe&quot;, &quot;brightPurple&quot;: &quot;#b9b6fc&quot;, &quot;brightCyan&quot;: &quot;#85befd&quot;, &quot;brightWhite&quot;: &quot;#e0e0e0&quot;, &quot;background&quot;: &quot;#161719&quot;, &quot;foreground&quot;: &quot;#c5c8c6&quot; &#125; ], &quot;keybindings&quot;: [//è¿™é‡Œå¯ä»¥è®¾ç½®å¿«æ·é”® &#123; &quot;command&quot; : &quot;copy&quot;, &quot;keys&quot; : [ &quot;ctrl+c&quot; ] &#125;, &#123; &quot;command&quot; : &quot;paste&quot;, &quot;keys&quot; : [ &quot;ctrl+v&quot; ] &#125; ]&#125; 5.5 ssh_configæœ€åæˆ‘ä»¬å†æ­é…sshè‡ªå¸¦çš„ssh_configæ¥æ·»åŠ å„ç§è‡ªå®šä¹‰sshå‚æ•°ï¼Œå¦‚æœéœ€è¦åœ¨è¿™ä¸Šé¢å¼€å¯sshçš„Agent ForwardingåŠŸèƒ½ï¼Œä¸ªäººä¹ æƒ¯æ˜¯å•ç‹¬åˆ›å»ºä¸€ä¸ªè„šæœ¬å¹¶ä¸”åœ¨bashä¸­è®¾ç½®aliaså¿«æ·æ“ä½œã€‚ 12345678# è„šæœ¬å†…å®¹ç¤ºä¾‹# å¼€å¯ssh Agent Forwardingeval `ssh-agent`# å°†è¦ä½¿ç”¨çš„ssh keyæ·»åŠ åˆ°ssh-addä¸­# å¦‚æœåé¢ä¸æŒ‡æ˜æ–‡ä»¶åˆ™ä½¿ç”¨é»˜è®¤çš„~/.ssh/id_rsa# ä¹Ÿå¯ä»¥ä¸€æ¬¡æ·»åŠ å¤šä¸ªssh-add ~/.ssh/id_rsassh user@host ç„¶ååœ¨bashrcæ–‡ä»¶ä¸­æ·»åŠ aliaså³å¯å¿«é€Ÿæ“ä½œï¼Œå¯¹åº”çš„ssh_configå‚æ•°å¯ä»¥ä½¿ç”¨man ssh_configå‘½ä»¤æ¥æŸ¥çœ‹ã€‚ è¿™é‡Œè´´å‡ºå‡ ä¸ªå¸¸ç”¨çš„å‚æ•°ï¼š 123456789101112131415Host example.host.com# sshè¿œç¨‹å®¢æˆ·ç«¯çš„åˆ«åï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ssh example.host.comæ¥è¿›è¡Œè¿æ¥ HostName 192.168.1.1# sshè¿œç¨‹å®¢æˆ·ç«¯çš„ipåœ°å€ User root# sshè¿œç¨‹çš„ç”¨æˆ· Port 22# sshçš„ç«¯å£ IdentityFile ~/.ssh/id_rsa# sshçš„è®¤è¯å¯†é’¥ ForwardAgent yes# æ˜¯å¦å¼€å¯Agent Forwardingï¼Œé»˜è®¤ä¸å¼€å¯ AddKeysToAgent yes# æ˜¯å¦è‡ªåŠ¨å°† key åŠ å…¥åˆ° ssh-agentï¼Œå€¼å¯ä»¥ä¸º no(default)/confirm/ask/yes# å¦‚æœæ˜¯ yesï¼Œkey å’Œå¯†ç éƒ½å°†è¯»å–æ–‡ä»¶å¹¶ä»¥åŠ å…¥åˆ° agent ï¼Œå°±åƒ ssh-addã€‚å…¶ä»–åˆ†åˆ«æ˜¯è¯¢é—®ã€ç¡®è®¤ã€ä¸åŠ å…¥çš„æ„æ€ã€‚æ·»åŠ åˆ° ssh-agent æ„å‘³ç€å°†ç§é’¥å’Œå¯†ç äº¤ç»™å®ƒç®¡ç†ï¼Œè®©å®ƒæ¥è¿›è¡Œèº«ä»½è®¤è¯ã€‚ 6ã€æ•ˆæœå±•ç¤ºwsl2ä½¿ç”¨çš„åº”è¯¥æ˜¯windowså®šåˆ¶çš„å†…æ ¸ï¼ˆç›®å‰æˆ‘çš„ç³»ç»Ÿå†…æ ¸æ˜¯4.19.84-microsoft-standardï¼‰ï¼ŒåŒæ—¶æ— æ³•ä½¿ç”¨systemdå·¥å…·ï¼Œä½†æ˜¯ä½œä¸ºterminalæ¥ä½¿ç”¨å·²ç»æ˜¯ç»°ç»°æœ‰ä½™äº†ï¼Œå‘½ä»¤çš„ä¸°å¯Œç¨‹åº¦ä¹Ÿè¦è¿œèƒœäºpowershellã€gitbashå’Œå…¶ä»–çš„ç¬¬ä¸‰æ–¹å‘½ä»¤è¡Œï¼Œå®‰è£…ä¸€äº›å¸¸ç”¨å‘½ä»¤çš„æ–¹ä¾¿ç¨‹åº¦ä¹Ÿè¦è¿œèƒœäºcygwinç­‰ã€‚windowsç³»ç»Ÿçš„ç¡¬ç›˜ä¹Ÿä¼šç›´æ¥æŒ‚è½½åœ¨wslä¸­çš„/mntç›®å½•ä¸‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Linuxçš„sedã€awkã€pasteç­‰å‘½ä»¤æ¥å¯¹windowsä¸‹çš„æ–‡æœ¬è¿›è¡Œæ“ä½œã€‚ æ³¨æ„åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šæŠŠç³»ç»Ÿæœ¬èº«çš„ç¡¬ç›˜ä¹ŸæŒ‚è½½åˆ°/mntç›®å½•ä¸‹ï¼Œæ³¨æ„ä¸è¦è¯¯æ“ä½œrmå‘½ä»¤","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"ssh","slug":"ssh","permalink":"https://tinychen.com/tags/ssh/"},{"name":"bash","slug":"bash","permalink":"https://tinychen.com/tags/bash/"},{"name":"linux","slug":"linux","permalink":"https://tinychen.com/tags/linux/"},{"name":"wsl","slug":"wsl","permalink":"https://tinychen.com/tags/wsl/"},{"name":"shell","slug":"shell","permalink":"https://tinychen.com/tags/shell/"}]},{"title":"Wiresharkå¯¹pop3æŠ“åŒ…åˆ†æ","slug":"20200511-wireshark-analysis-pop3","date":"2020-05-11T02:00:00.000Z","updated":"2020-05-11T02:00:00.000Z","comments":true,"path":"20200511-wireshark-analysis-pop3/","link":"","permalink":"https://tinychen.com/20200511-wireshark-analysis-pop3/","excerpt":"æœ¬æ–‡ä¸»è¦ä½¿ç”¨Wiresharkå¯¹é‚®ä»¶å®¢æˆ·ç«¯ä½¿ç”¨POP3åè®®æ”¶å–é‚®ä»¶çš„è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…åˆ†æå¹¶ä½¿ç”¨telnetå‘½ä»¤è¿›è¡Œç®€å•æ“ä½œã€‚","text":"æœ¬æ–‡ä¸»è¦ä½¿ç”¨Wiresharkå¯¹é‚®ä»¶å®¢æˆ·ç«¯ä½¿ç”¨POP3åè®®æ”¶å–é‚®ä»¶çš„è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…åˆ†æå¹¶ä½¿ç”¨telnetå‘½ä»¤è¿›è¡Œç®€å•æ“ä½œã€‚ 1ã€POP3ç®€ä»‹é‚®å±€åè®®ï¼ˆè‹±è¯­ï¼šPost Office Protocolï¼Œç¼©å†™ï¼šPOPï¼‰å±äºTCP/IPåè®®æ—ä¸­çš„ä¸€å‘˜ï¼Œç”±RFC 1939å®šä¹‰ã€‚æ­¤åè®®ä¸»è¦ç”¨äºæ”¯æŒä½¿ç”¨å®¢æˆ·ç«¯è¿œç¨‹ç®¡ç†åœ¨æœåŠ¡å™¨ä¸Šçš„ç”µå­é‚®ä»¶ã€‚æœ€æ–°ç‰ˆæœ¬ä¸ºPOP3ï¼Œå…¨åâ€œPost Office Protocol - Version 3â€ï¼Œè€Œæä¾›äº†SSLåŠ å¯†çš„POP3åè®®è¢«ç§°ä¸ºPOP3Sã€‚ POPæ”¯æŒç¦»çº¿é‚®ä»¶å¤„ç†ã€‚å…¶å…·ä½“è¿‡ç¨‹æ˜¯ï¼šå‘ä»¶äººå°†é‚®ä»¶å‘é€åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ”¶ä»¶äººå®¢æˆ·ç«¯ä½¿ç”¨MUAä»¥è¿æ¥æœåŠ¡å™¨ï¼Œå¹¶ä¸‹è½½æ‰€æœ‰æœªé˜…è¯»çš„ç”µå­é‚®ä»¶ã€‚è¿™ç§ç¦»çº¿è®¿é—®æ¨¡å¼æ˜¯ä¸€ç§å­˜å‚¨è½¬å‘æœåŠ¡ï¼Œå°†é‚®ä»¶ä»é‚®ä»¶æœåŠ¡å™¨ç«¯é€åˆ°ä¸ªäººå®¢æˆ·ç«¯ä¸Šï¼Œå¯ä»¥æ˜¯PCæˆ–è€…æ‰‹æœºç­‰å¤šç§è®¾å¤‡ã€‚æ—§ç‰ˆçš„POP3åè®®åœ¨é‚®ä»¶è¢«ä¸‹è½½åï¼Œä¼šåˆ é™¤æ‰é‚®ä»¶æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ã€‚æ”¹è¿›çš„POP3åè®®å¯ä»¥åœ¨é…ç½®ä¸­é€‰æ‹©å¯ä»¥â€œåªä¸‹è½½é‚®ä»¶ï¼ŒæœåŠ¡å™¨ç«¯å¹¶ä¸åˆ é™¤â€ï¼Œä¹Ÿæ˜¯ç›®å‰POP3çš„ä¸»æµæ“ä½œæ–¹å¼ã€‚ 2ã€æŠ“åŒ…ç¯å¢ƒæŠ“åŒ…å·¥å…·è¿˜æ˜¯ä½¿ç”¨çš„wiresharkï¼Œæµ‹è¯•çš„åè®®æ˜¯POP3ï¼Œé»˜è®¤ç«¯å£110ï¼ŒåŒæ ·åœ°ä¸ºäº†æ–¹ä¾¿åˆ†ææ•°æ®æ²¡æœ‰ä½¿ç”¨TLS/SSLåŠ å¯†ï¼Œä½†æ˜¯ç»“æœéƒ½é—®é¢˜ä¸å¤§ã€‚ æµ‹è¯•çš„è´¦å·ç™»å½•ä¹‹åè‡ªåŠ¨åŒæ­¥äº†æ”¶ä»¶ç®±ä¸­å·²æœ‰çš„5å°é‚®ä»¶ï¼Œç„¶åæˆ‘åˆç»™æµ‹è¯•è´¦å·å‘äº†ä¸€å°é‚®ä»¶ï¼Œå› æ­¤æŠ“åŒ…çš„æ—¶å€™MUAå®¢æˆ·ç«¯ä¸Šåº”è¯¥æ˜¯åªæœ‰æœ¬åœ°å·²ç¼“å­˜çš„5å°å·²è¯»é‚®ä»¶å’ŒæœåŠ¡å™¨ç«¯å°šæœªä¸‹è½½çš„1å°æœªè¯»é‚®ä»¶ï¼Œè¿™æ ·æ¯”è¾ƒç¬¦åˆå®é™…çš„æƒ…å†µã€‚ å¼€å¯wiresharkç›‘å¬å¯¹åº”çš„ç½‘å¡ï¼Œè®¾å®šFilterä¸ºé‚®ä»¶æœåŠ¡å™¨çš„IPå¹¶ä¸”è®¾å®šåè®®ä¸ºpopåŸºæœ¬å°±èƒ½æŠ“å–åˆ°éœ€è¦çš„æ•°æ®åŒ…ï¼Œç„¶åæˆ‘ä»¬å†Followè¿™æ¡POPæ•°æ®æµå¯¹åº”çš„TCP streamå°±å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„å®Œæ•´ä¿¡æ¯ã€‚ æ¯«æ— æ„å¤–åœ°å¯ä»¥çœ‹åˆ°TCPçš„ä¸‰æ¡å››æŒ¥ï¼Œè¿™é‡Œä¸ä½œèµ˜è¿°ã€‚ 3ã€POP3æ•°æ®åŒ…åˆ†æé¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡ç«¯å‘é€æŠ¥æ–‡ç»™å®¢æˆ·ç«¯å‘ŠçŸ¥é¡ºåˆ©å’ŒPOP3æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼š æ¥ä¸‹æ¥å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªCAPAå‘½ä»¤ï¼š wikié‡Œé¢æœ‰åˆ—å‡ºå¸¸ç”¨çš„POP3å‘½ä»¤ï¼Œä½†æ˜¯å´å¹¶æ²¡æœ‰CAPAè¿™æ¡å‘½ä»¤ï¼Œé¡ºç€ä¸‹é¢çš„å‚è€ƒæ–‡æ¡£æŸ¥äº†ä¸€ä¸‹ï¼Œåœ¨RFCçš„æ–‡æ¡£RFC2449ä¸­æ‰¾åˆ°äº†æ¯”è¾ƒè¯¦ç»†çš„å®šä¹‰ï¼š Section 3 describes the CAPA response using [ABNF]. When a capability response describes an optional command, the SHOULD be identical to the command keyword. CAPA response tags are case-insensitive. â€‹ CAPA â€‹ Arguments:â€‹ none â€‹ Restrictions:â€‹ none â€‹ Discussion:â€‹ An -ERR response indicates the capability command is notâ€‹ implemented and the client will have to probe forâ€‹ capabilities as before. â€‹ An +OK response is followed by a list of capabilities, oneâ€‹ per line. Each capability name MAY be followed by a singleâ€‹ space and a space-separated list of parameters. Eachâ€‹ capability line is limited to 512 octets (including theâ€‹ CRLF). The capability list is terminated by a lineâ€‹ containing a termination octet (â€œ.â€) and a CRLF pair. â€‹ Possible Responses:â€‹ +OK -ERR ä¹Ÿå°±æ˜¯è¯´å®¢æˆ·ç«¯å‘é€CAPAå‘½ä»¤ä¸»è¦æ˜¯ç”¨äºè·å–POP3æœåŠ¡ç«¯å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ï¼Œç„¶åPOP3æœåŠ¡å™¨æœç„¶å°±è¿”å›äº†å¯¹åº”çš„+OK responseå’ŒCapability list follows æ¥ä¸‹æ¥å®¢æˆ·ç«¯å¼€å§‹ä¼ è¾“è´¦å·å¯†ç ç”¨äºç™»å½•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ç™»å½•æˆåŠŸä¹‹åï¼ŒPOP3æœåŠ¡ç«¯è¿”å›äº†æ¶ˆæ¯æç¤ºæœ‰6å°é‚®ä»¶ï¼ˆ6 messagesï¼‰å’Œé‚®ä»¶çš„æ€»å¤§å°ï¼ˆ25568 bytesï¼‰ï¼Œç„¶åå®¢æˆ·ç«¯å‘é€UTF8å‘½ä»¤æŒ‡å®šç¼–ç æ–¹å¼ï¼Œæ”¶åˆ°æœåŠ¡ç«¯è¿”å›çš„ç¡®è®¤æ¶ˆæ¯åå†å‘é€STATå‘½ä»¤æ¥è¯·æ±‚æœåŠ¡å™¨å‘å›å…³äºé‚®ç®±çš„ç»Ÿè®¡èµ„æ–™ï¼ˆæ­¤å¤„ä¸ºé‚®ä»¶æ€»æ•°å’Œæ€»å­—èŠ‚æ•°ï¼‰ã€‚ ç´§æ¥ç€å®¢æˆ·ç«¯ç»§ç»­å‘é€UIDLå‘½ä»¤ï¼ŒPOP3æœåŠ¡å™¨ç«¯è¿”å›é‚®ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ŒPOP3ä¼šè¯çš„æ¯ä¸ªæ ‡è¯†ç¬¦éƒ½å°†æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æ˜¯å…¨å±€å§‹ç»ˆå”¯ä¸€ã€‚å³åŒä¸€å°é‚®ä»¶åœ¨æ¯æ¬¡é€šä¿¡çš„æ—¶å€™çš„æ ‡è¯†ç¬¦éƒ½æ˜¯ä¸å˜çš„ï¼Œè¿™æ ·å°±æœ‰åˆ©äºMUAå°†æœ¬åœ°å­˜å‚¨çš„é‚®ä»¶å’ŒæœåŠ¡å™¨ç«¯çš„é‚®ä»¶è¿›è¡Œå¯¹æ¯”ä»è€ŒçŸ¥é“å“ªäº›é‚®ä»¶è¿˜æ²¡æœ‰è¢«ä¸‹è½½åˆ°æœ¬åœ°ã€‚ è·å–é‚®ä»¶æ ‡è¯†ç¬¦åï¼Œå®¢æˆ·ç«¯ä¼šå‘é€LISTå‘½ä»¤æŸ¥è¯¢é‚®ä»¶æ•°é‡å’Œæ¯ä¸ªé‚®ä»¶çš„å¤§å°ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‚®ä»¶çš„æ€»æ•°é‡å’Œæ€»å¤§å°æ˜¯å’Œä¸Šé¢çš„STATå‘½ä»¤æŸ¥è¯¢çš„ä¸€è‡´çš„ã€‚ å‰é¢æˆ‘ä»¬è¯´è¿‡åœ¨æŠ“åŒ…ä¹‹å‰MUAä¸­æ˜¯å­˜ç€5å°é‚®ä»¶å¹¶ä¸”ç¬¬6å°é‚®ä»¶æ˜¯æœªè¯»çš„ï¼Œå› æ­¤è¿™æ—¶å®¢æˆ·ç«¯å°±ä¼šå‘é€RETRè¯·æ±‚è·å–ç¬¬6å°é‚®ä»¶çš„ä¿¡æ¯ï¼š æœåŠ¡å™¨é¦–å…ˆè¿”å›ä¸€æ¡ä¿¡æ¯è¡¨ç¤ºOKï¼Œå¹¶ä¸”è¯´æ˜è¿™å°é‚®ä»¶çš„å¤§å°æ˜¯1199ä¸ªå­—èŠ‚ï¼Œç„¶åå¼€å§‹ä¼ è¾“æ•´å°é‚®ä»¶çš„å†…å®¹ï¼Œæ•´ä¸ªé‚®ä»¶å†…å®¹åŒ…å«äº†æ ‡å‡†çš„ä¸€äº›é‚®ä»¶ä¿¡æ¯ï¼ˆä¸»é¢˜ã€æ­£æ–‡ã€æ”¶å‘ä»¶äººã€æ—¶é—´ç­‰ï¼‰å’Œä¸€äº›å¯¹åº”çš„é‚®ä»¶ç³»ç»Ÿçš„ä¸“å±ä¿¡æ¯ã€‚ æœ€åé‚®ä»¶ä»¥.ç»“æŸä¼ è¾“ï¼Œå®¢æˆ·ç«¯å‘é€QUITè¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿”å›OKç»“æŸæœ¬æ¬¡ä¼ è¾“ã€‚ 4ã€telnetæ“ä½œå’Œä¹‹å‰çš„SMTPä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨telnetå‘½ä»¤å¯¹æœåŠ¡å™¨çš„110ç«¯å£è¿›è¡Œæ“ä½œï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142[root@www coremail]# telnet localhost 110Trying 127.0.0.1...Connected to localhost.Escape character is &#x27;^]&#x27;.+OK Welcome to coremail Mail Pop3 Server (126coms[c92b4e18679ada4069d0bde6e2528ad1s])CAPA+OK Capability list followsTOPUSERPIPELININGUIDLLANGUTF8SASL PLAINSTLS.USER test01@coremail.cn+OK core mailPASS password+OK 6 message(s) [25568 byte(s)]UTF8+OK UTF-8 OKSTAT+OK 6 25568UIDL+OK 6 255681 1tbiAQACE10Y3LsAAAAAsy2 1tbiAQACE10Y3LsAAAACsw3 1tbiAQACE10Y3LsAAAADsx4 1tbiAQACE10Y3LsAAAAEs25 1tbiAQACE10Y3LsAAAAFs36 1tbiAQACE10Y3LsAAAAGs0.LIST+OK 6 255681 79592 11993 64454 64695 22976 1199. åˆ°è¿™é‡Œçš„æ“ä½œæ˜¯å’Œä¹‹å‰ä¸€æ ·çš„ï¼Œå®é™…ä¸Šæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨RETRå‘½ä»¤æŸ¥çœ‹ä»»æ„ä¸€å°é‚®ä»¶çš„å†…å®¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183RETR 5+OK 2297 octetsReceived: from TINYDESKTOP (unknown [10.228.12.149]) by www.example.com (Coremail) with SMTP id AQAAfwBXc7qLVrZeWAAAAA--.16S2; Sat, 09 May 2020 15:06:51 +0800 (CST)From: &quot;Microsoft Outlook&quot; &lt;test01@coremail.cn&gt;Sender: test01@coremail.cnTo: &lt;test01@coremail.cn&gt;Subject: =?utf-8?B?TWljcm9zb2Z0IE91dGxvb2sg5rWL6K+V5raI5oGv?=MIME-Version: 1.0Content-Type: multipart/alternative; boundary=&quot;----=_NextPart_000_0000_01D62613.778669A0&quot;X-CM-TRANSID:AQAAfwBXc7qLVrZeWAAAAA--.16S2Message-Id:&lt;5EB6568B.000001.04520@coremail.cn&gt;X-Coremail-Antispam: 1UD129KBjDUn29KB7ZKAUJUUUUU529EdanIXcx71UUUUU7v73 VFW2AGmfu7bjvjm3AaLaJ3UjIYCTnIWjp_UUUYK7AC8VAFwI0_Jr0_Gr1l1xkIjI8I6I8E 6xAIw20EY4v20xvaj40_Wr0E3s1l1IIY67AEw4v_Jr0_Jr4l8cAvFVAK0II2c7xJM28Cjx kF64kEwVA0rcxSw2x7M28EF7xvwVC0I7IYx2IY67AKxVWUJVWUCwA2z4x0Y4vE2Ix0cI8I cVCY1x0267AKxVWUJVW8JwA2z4x0Y4vEx4A2jsIE14v26r1j6r4UM28EF7xvwVC2z280aV CY1x0267AKxVWUJVW8JwAac4AC62xK8xCEY4vEwIxC4wAS0I0E0xvYzxvE52x082IY62kv 0487Mc02F40E4c8EcI0Er2xKeI8DMcIj6xIIjxv20xvE14v26r1j6r18McIj6I8E87Iv67 AKxVWUJVW8JwAm72CE4IkC6x0Yz7v_Jr0_Gr1lF7xvr2IY64vIr41lF7I21c0EjII2zVCS 5cI20VAGYxC7M4xvF2IEb7IF0Fy264kE64k0F24lw4CEF2IF47xS0VAv8wCF04k20xvY0x 0EwIxGrwCF04k20xvE0xIIj40Ec7CjxwCFx2IqxVCFs4IE7xkEbVWUJVW8JwC20s026c02 F40E14v26r106r1rMI8I3I0E7480Y4vE14v26r106r1rMI8E67AF67kF1VAFwI0_Jr0_Jr ylIxkGc2Ij64vIr41lIxAIcVC0I7IYx2IY67AKxVWUJVWUCwCI42IY6xIIjxv20xvEc7Cj xVAFwI0_Jr0_Gr1lIxAIcVCF04k26cxKx2IYs7xG6rW3Jr0E3s1lIxAIcVC2z280aVAFwI 0_Jr0_Gr1lIxAIcVC2z280aVCY1x0267AKxVWUJVW8JbIYCTnIWIevJa73UjIFyTuYvjfU jiiSDUUUUDate: Sat, 9 May 2020 15:06:51 +0800 (CST)X-CM-SenderInfo: hwhv3imr6f02phpdxzgofq/This is a multipart message in MIME format.------=_NextPart_000_0000_01D62613.778669A0Content-Type: text/plain; charset=&quot;utf-8&quot;Content-Transfer-Encoding: base646L+Z5piv5Zyo5rWL6K+V5L2g55qE5biQ5oi36K6+572u5pe2IE1pY3Jvc29mdCBPdXRsb29rIOiHquWKqOWPkemAgeeahOeUteWtkOmCruS7tuOAgg0K------=_NextPart_000_0000_01D62613.778669A0Content-Type: text/html; charset=&quot;utf-8&quot;Content-Transfer-Encoding: base64PGh0bWw+PGJvZHk+PHA+6L+Z5piv5Zyo5rWL6K+V5L2g55qE5biQ5oi36K6+572u5pe2IE1pY3Jvc29mdCBPdXRsb29rIOiHquWKqOWPkemAgeeahOeUteWtkOmCruS7tuOAgg0KPC9wPjwvYm9keT48L2h0bWw+------=_NextPart_000_0000_01D62613.778669A0--.RETR 6+OK 1199 octetsReceived: by ajax-webmail-www.example.com (Coremail) ; Sat, 9 May 2020 15:35:01 +0800 (GMT+08:00)X-Originating-IP: [10.228.12.149]Date: Sat, 9 May 2020 15:35:01 +0800 (GMT+08:00)X-CM-HeaderCharset: UTF-8From: test02@coremail.cnTo: test01@coremail.cnSubject: awesome popX-Priority: 3X-Mailer: Coremail Webmail Server Version XT5.0.8a build 20190308(983496cf) Copyright (c) 2002-2020 www.mailtech.cn 126comContent-Type: multipart/alternative; boundary=&quot;----=_Part_5_1271853342.1589009701828&quot;MIME-Version: 1.0Message-ID: &lt;4d02717c.1.171f85bdbc6.Coremail.test02@coremail.cn&gt;X-Coremail-Locale: zh_CNX-CM-TRANSID:AQAAfwAXM7olXbZeXAAAAA--.0WX-CM-SenderInfo: hwhv3ims6f02phpdxzgofq/1tbiAQADCV0Y3LsAAwAIsiX-Coremail-Antispam: 1Ur529EdanIXcx71UUUUU7IcSsGvfJ3GIAIbVAYFVCjjxCrMI AIbVAFxVCF77xC64kEw24lV2xY67C26IkvcIIF6IxKo4kEV4DvcSsGvfC2KfnxnUU==------=_Part_5_1271853342.1589009701828Content-Type: text/plain; charset=UTF-8Content-Transfer-Encoding: 7bitThis is for pop test!------=_Part_5_1271853342.1589009701828Content-Type: text/html; charset=UTF-8Content-Transfer-Encoding: 7bitThis is for pop test!------=_Part_5_1271853342.1589009701828--.RETR 4+OK 6469 octetsReceived: from TINY-DESKTOP (unknown [10.228.12.149]) by www.example.com (Coremail) with SMTP id AQAAfwCngFa5lNFcYQAAAA--.16S2; Tue, 07 May 2019 22:22:50 +0800 (CST)Date: Thu, 7 May 2020 14:22:46 +0800From: test02 &lt;test02@coremail.cn&gt;To: =?utf-8?Q?test01=40coremail.cn?= &lt;test01@coremail.cn&gt;Message-ID: &lt;305443E1-9258-4260-AA18-1A5CDFBD60EE@coremail.cn&gt;Subject: smtp testX-Mailer: MailMasterPC/4.14.1.1004 (Windows 10 RS5)X-CUSTOM-MAIL-MASTER-SENT-ID: 710FAD56-B1F1-48B7-B72F-543A5E51C5F2MIME-Version: 1.0Content-Type: text/html; charset=&quot;utf-8&quot;Content-Transfer-Encoding: base64X-CM-TRANSID:AQAAfwCngFa5lNFcYQAAAA--.16S2X-Coremail-Antispam: 1UD129KBjDUn29KB7ZKAUJUUUUU529EdanIXcx71UUUUU7v73 VFW2AGmfu7bjvjm3AaLaJ3UjIYCTnIWjp_UUUol7kC6x804xWl14x267AKxVWUJVW8JwAF c2x0x2IEx4CE42xK8VAvwI8IcIk0rVWUJVWUGwAFIxvE14AKwVWUJVWUGwA2jI8I6cxK62 vIxIIY0VWkZVCq3wA2ocxC64kIII0Yj41l84x0c7CEw4AK67xGY2AK021l84ACjcxK6xII jxv20xvE14v26r1j6r1xM28EF7xvwVC0I7IYx2IY6xkF7I0E14v26r1j6r4UM28EF7xvwV C2z280aVAFwI0_Jr0_Gr1l84ACjcxK6I8E87Iv6xkF7I0E14v26r1j6r4UM2vYz4IE04k2 4VAvwVAKI4IrM2AIxVAIcxkEcVAq07x20xvEncxIr21l5I8CrVAqjxCE14ACF2xKxwAqx4 xG6xAIxVCFxsxG0wAqx4xG6I80eVA0xI0YY7vIx2IE14AGzxvEb7x7Mc02F40Ex7xS62Iq YxC26I8Yz20kMcIj6xIIjxv20xvE14v26r1j6r18McIj6I8E87Iv67AKxVWUJVW8JwAm72 CE4IkC6x0Yz7v_Jr0_Gr1lF7xvr2IYc2Ij64vIr41lF7I21c0EjII2zVCS5cI20VAGYxC7 M4xvF2IEb7IF0Fy264kE64k0F24lFcxC0VAqx4xG64AKrs4lw4CE7480Y4vE14AKx2xKxV C2ax8xMxAIw28IcxkI7VAKI48JMxC20s026xCaFVCjc4AY6r1j6r4UMI8I3I0E5I8CrVAF wI0_JrI_JrWlx2IqxVCjr7xvwVAFwI0_Jr0_Jr4lx4CE17CEb7AF67AKxVWUJVWUXwCIc4 0Y0x0EwIxGrwCI42IY6xIIjxv20xvE14v26r1j6r1xMIIF0xvE2Ix0cI8IcVCY1x0267AK xVWUJVW8JwCI42IY6xAIw20EY4v20xvaj40_Wr1j6rW3Jr1lIxAIcVC2z280aVAFwI0_Jr 0_Gr1lIxAIcVC2z280aVCY1x0267AKxVWUJVW8JwCE64xvF2IEb7IF0Fy7YxBIdaVFxhVj vjDU0xZFpf9x0zEzBTiUUUUU=X-CM-SenderInfo: hwhv3ims6f02phpdxzgofq/PGh0bWw+DQo8aGVhZD4NCiAgICA8bWV0YSBodHRwLWVxdWl2PSdDb250ZW50LVR5cGUnIGNvbnRlbnQ9J3RleHQvaHRtbDsgY2hhcnNldD1VVEYtOCc+DQo8L2hlYWQ+DQo8Ym9keT4NCjxzdHlsZT4NCiAgICBmb250ew0KICAgICAgICBsaW5lLWhlaWdodDogMS42Ow0KICAgIH0NCiAgICB1bCxvbHsNCiAgICAgICAgcGFkZGluZy1sZWZ0OiAyMHB4Ow0KICAgICAgICBsaXN0LXN0eWxlLXBvc2l0aW9uOiBpbnNpZGU7DQogICAgfQ0KPC9zdHlsZT4NCjxkaXYgc3R5bGUgPSAnZm9udC1mYW1pbHk65b6u6L2v6ZuF6buRLFZlcmRhbmEsJnF1b3Q7TWljcm9zb2Z0IFlhaGVpJnF1b3Q7LFNpbVN1bixzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxNHB4OyBsaW5lLWhlaWdodDoxLjY7Jz4NCiAgICA8ZGl2ID48L2Rpdj48ZGl2PgogICAgPGRpdj4KICAgICAgICA8c3Bhbj5zbXRwIHRlc3QKICAgICAgICA8L3NwYW4+PC9kaXY+CiAgICA8ZGl2PgogICAgICAgIDxzcGFuPgogICAgICAgICAgICA8YnI+CiAgICAgICAgPC9zcGFuPgogICAgPC9kaXY+CiAgICA8ZGl2IGlkPSJudGVzLXBjbWFjLXNpZ25hdHVyZSIgc3R5bGU9ImZvbnQtZmFtaWx5Oiflvq7ova/pm4Xpu5EnIj4KICAgICAKICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxNHB4OyBwYWRkaW5nOiAwOyAgbWFyZ2luOjA7bGluZS1oZWlnaHQ6MTRweDsiPgogICAgICAgIDxkaXYgc3R5bGU9InBhZGRpbmctYm90dG9tOjZweDttYXJnaW4tYm90dG9tOjEwcHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2U2ZTZlNjtkaXNwbGF5OmlubGluZS1ibG9jazsiPgogICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9Imh0dHBzOi8vbWFhcy5tYWlsLjE2My5jb20vZGFzaGktd2ViLWV4dGVuZC9odG1sL3Byb1NpZ25hdHVyZS5odG1sP2Z0bElkPTEmYW1wO25hbWU9dGVzdDAyJmFtcDt1aWQ9dGVzdDAyJTQwY29yZW1haWwuY24mYW1wO2ljb25Vcmw9aHR0cHMlM0ElMkYlMkZtYWlsLW9ubGluZS5ub3Nkbi4xMjcubmV0JTJGcWl5ZWxvZ28lMkZkZWZhdWx0QXZhdGFyLnBuZyZhbXA7aXRlbXM9JTVCJTIydGVzdDAyJTQwY29yZW1haWwuY24lMjIlNUQiIHN0eWxlPSJkaXNwbGF5OmJsb2NrO2JhY2tncm91bmQ6I2ZmZjsgbWF4LXdpZHRoOiA0MDBweDsgX3dpZHRoOiA0MDBweDtwYWRkaW5nOjE1cHggMCAxMHB4IDA7dGV4dC1kZWNvcmF0aW9uOiBub25lOyBvdXRsaW5lOm5vbmU7LXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOnRyYW5zcGFyZW50Oy13ZWJraXQtdGV4dC1zaXplLWFkanVzdDpub25lICFpbXBvcnRhbnQ7dGV4dC1zaXplLWFkanVzdDpub25lICFpbXBvcnRhbnQ7Ij4KICAgICAgICAgICAgPHRhYmxlIGNlbGxwYWRkaW5nPSIwIiBzdHlsZT0id2lkdGg6IDEwMCU7IG1heC13aWR0aDogMTAwJTsgdGFibGUtbGF5b3V0OiBmaXhlZDsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTtjb2xvcjogIzliOWVhMTtmb250LXNpemU6IDE0cHg7bGluZS1oZWlnaHQ6MS4zOy13ZWJraXQtdGV4dC1zaXplLWFkanVzdDpub25lICFpbXBvcnRhbnQ7dGV4dC1zaXplLWFkanVzdDpub25lICFpbXBvcnRhbnQ7Ij4KICAgICAgICAgICAgICAgIDx0Ym9keSBzdHlsZT0iZm9udC1mYW1pbHk6ICdQaW5nRmFuZyBTQycsICdIaXJhZ2lubyBTYW5zIEdCJywnV2VuUXVhbllpIE1pY3JvIEhlaScsICdNaWNyb3NvZnQgWWFoZWknLCAn5b6u6L2v6ZuF6buRJywgdmVyZGFuYSAhaW1wb3J0YW50OyB3b3JkLXdyYXA6YnJlYWstd29yZDsgd29yZC1icmVhazpicmVhay1hbGw7LXdlYmtpdC10ZXh0LXNpemUtYWRqdXN0Om5vbmUgIWltcG9ydGFudDt0ZXh0LXNpemUtYWRqdXN0Om5vbmUgIWltcG9ydGFudDsiPgogICAgICAgICAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCB3aWR0aD0iMzgiIHN0eWxlPSJwYWRkaW5nOjA7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IHdpZHRoOiAzOHB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGltZyB3aWR0aD0iMzgiIGhlaWdodD0iMzgiIHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7IHdpZHRoOiAzOHB4OyBoZWlnaHQ6IDM4cHg7IGJvcmRlci1yYWRpdXM6NTAlOyIgc3JjPSJodHRwczovL21haWwtb25saW5lLm5vc2RuLjEyNy5uZXQvcWl5ZWxvZ28vZGVmYXVsdEF2YXRhci5wbmciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0icGFkZGluZzogMCAwIDAgMTBweDsgY29sb3I6ICMzMTM1M2I7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6IDE2cHg7Zm9udC13ZWlnaHQ6Ym9sZDsgd2lkdGg6MTAwJTsgd2hpdGUtc3BhY2U6IG5vd3JhcDsgb3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOyI+dGVzdDAyPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciB3aWR0aD0iMTAwJSIgc3R5bGU9ImZvbnQtc2l6ZTogMTRweCAhaW1wb3J0YW50OyB3aWR0aDogMTAwJTsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjIiIHN0eWxlPSJwYWRkaW5nOjEwcHggMCAwIDA7IGZvbnQtc2l6ZToxNHB4ICFpbXBvcnRhbnQ7IHdpZHRoOiAxMDAlOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOiAxMDAlO2ZvbnQtc2l6ZTogMTRweCAhaW1wb3J0YW50O3dvcmQtd3JhcDpicmVhay13b3JkO3dvcmQtYnJlYWs6YnJlYWstYWxsOyI+dGVzdDAyQGNvcmVtYWlsLmNuPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgPC90YWJsZT4KICAgICAgICA8L2E+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4O2NvbG9yOiNiNWI5YmQ7bGluZS1oZWlnaHQ6MThweDsiPgogICAgICAgIDxzcGFuPuetvuWQjeeUsTwvc3Bhbj4KICAgICAgICA8YSBzdHlsZT0idGV4dC1kZWNvcmF0aW9uOiBub25lO2NvbG9yOiM0MTk2ZmY7cGFkZGluZzowIDVweDsiIGhyZWY9Imh0dHBzOi8vbWFpbC4xNjMuY29tL2Rhc2hpL2RscHJvLmh0bWw/ZnJvbT1tYWlsODEiPue9keaYk+mCrueuseWkp+W4iDwvYT4KICAgICAgICA8c3Bhbj7lrprliLY8L3NwYW4+CiAgICA8L2Rpdj4KIDwvZGl2Pgo8L2Rpdj48IS0t8J+YgC0tPg0KPC9kaXY+DQo8L2JvZHk+DQo8L2h0bWw+. å‘é€NOOPå‘½ä»¤å¹¶æ— å®é™…ä½œç”¨ï¼Œä¸»è¦æ˜¯ç”¨äºå’ŒæœåŠ¡å™¨ä¿æŒæ•°æ®è¿æ¥ä¸è¦ä¸­æ–­ã€‚ 12NOOP+OK core mail æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨DELEå‘½ä»¤æ¥åˆ é™¤æŒ‡å®šçš„é‚®ä»¶ï¼Œåˆ é™¤åä½¿ç”¨LISTæŸ¥çœ‹æ•ˆæœï¼š 12345678910DELE 4+OK core mailLIST+OK 5 190991 79592 11993 64455 22976 1199. è¿˜å¯ä»¥ä½¿ç”¨RSETå‘½ä»¤æ¥è¿›è¡Œæ’¤é”€åˆ é™¤çš„æ“ä½œå¹¶ä¸”ä½¿ç”¨LISTå‘½ä»¤æŸ¥çœ‹æ•ˆæœ 1234567891011RSET+OK core mailLIST+OK 6 255681 79592 11993 64454 64695 22976 1199. æœ€åä½¿ç”¨QUITå‘½ä»¤æ–­å¼€è¿æ¥é€€å‡ºç³»ç»Ÿï¼š 123QUIT+OK core mailConnection closed by foreign host.","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"wireshark","slug":"wireshark","permalink":"https://tinychen.com/tags/wireshark/"},{"name":"mail","slug":"mail","permalink":"https://tinychen.com/tags/mail/"},{"name":"pop3","slug":"pop3","permalink":"https://tinychen.com/tags/pop3/"}]},{"title":"RFC8314æ–‡æ¡£ä¸­å¯¹465ç«¯å£å’Œ587ç«¯å£çš„é˜è¿°","slug":"20200508-rfc8314-465-587-part-translation","date":"2020-05-08T02:00:00.000Z","updated":"2020-05-08T02:00:00.000Z","comments":true,"path":"20200508-rfc8314-465-587-part-translation/","link":"","permalink":"https://tinychen.com/20200508-rfc8314-465-587-part-translation/","excerpt":"æœ€è¿‘åœ¨å­¦ä¹ SMTPçš„æ—¶å€™å‘ç°SMTPåœ¨ä½¿ç”¨åŠ å¯†ä¼ è¾“çš„æ—¶å€™æ¶‰åŠåˆ°465å’Œ587ä¸¤ä¸ªç«¯å£ï¼Œç½‘ä¸Šå¯¹ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ä¼—è¯´çº·çº­ï¼Œåæ¥æŸ¥åˆ°äº†RFCå®˜æ–¹æ–‡æ¡£ä¸­å¯¹äºè¿™ä¸ªäº‰è®ºè¾ƒä¹…çš„é—®é¢˜çš„å®šä¹‰å’Œè¯¦ç»†è¯´æ˜ï¼Œè¿™é‡Œåšè½¬è½½å’Œç¿»è¯‘ç”¨äºè®°å½•ã€‚","text":"æœ€è¿‘åœ¨å­¦ä¹ SMTPçš„æ—¶å€™å‘ç°SMTPåœ¨ä½¿ç”¨åŠ å¯†ä¼ è¾“çš„æ—¶å€™æ¶‰åŠåˆ°465å’Œ587ä¸¤ä¸ªç«¯å£ï¼Œç½‘ä¸Šå¯¹ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ä¼—è¯´çº·çº­ï¼Œåæ¥æŸ¥åˆ°äº†RFCå®˜æ–¹æ–‡æ¡£ä¸­å¯¹äºè¿™ä¸ªäº‰è®ºè¾ƒä¹…çš„é—®é¢˜çš„å®šä¹‰å’Œè¯¦ç»†è¯´æ˜ï¼Œè¿™é‡Œåšè½¬è½½å’Œç¿»è¯‘ç”¨äºè®°å½•ã€‚ 1ã€RFC8314åŸæ–‡æˆ‘ä»¬æŸ¥çœ‹RFC8314å®˜æ–¹æ–‡æ¡£ä¸­çš„ç›¸å…³å™è¿°ï¼Œå’Œè¯¥é—®é¢˜ç›¸å…³çš„ä¸»è¦æ˜¯3.3ã€4.2ã€5.5å’Œ7.3è¿™å››ä¸ªéƒ¨åˆ†ï¼Œç”±äºæœ¬æ–‡åªè®¨è®ºä¸¤ä¸ªç«¯å£çš„ä½œç”¨å’Œå†å²ç¼˜ç”±ï¼Œå› æ­¤æ¶‰åŠåˆ°åŠ å¯†è¿‡ç¨‹å’ŒåŸç†çš„4.2ã€5.5ä¸¤ä¸ªéƒ¨åˆ†ä¸åœ¨è¿™é‡ŒæåŠï¼Œå…¶ä½™éƒ¨åˆ†çš„åŸæ–‡å†…å®¹å¦‚ä¸‹ï¼š 3.3. Implicit TLS for SMTP Submission When a TCP connection is established for the â€œsubmissionsâ€ service (default port 465), a TLS handshake begins immediately. Clients MUST implement the certificate validation mechanism described in [RFC7817]. Once the TLS session is established, Message Submission protocol data [RFC6409] is exchanged as TLS application data for the remainder of the TCP connection. (Note: The â€œsubmissionsâ€ service name is defined in Section 7.3 of this document and follows the usual convention that the name of a service layered on top of Implicit TLS consists of the name of the service as used without TLS, with an â€œsâ€ appended.) The STARTTLS mechanism on port 587 is relatively widely deployed due to the situation with port 465 (discussed in Section 7.3). This differs from IMAP and POP services where Implicit TLS is more widely deployed on servers than STARTTLS. It is desirable to migrate core protocols used by MUA software to Implicit TLS over time, for consistency as well as for the additional reasons discussed in Appendix A. However, to maximize the use of encryption for submission, it is desirable to support both mechanisms for Message Submission over TLS for a transition period of several years. As a result, clients and servers SHOULD implement both STARTTLS on port 587 and Implicit TLS on port 465 for this transition period. Note that there is no significant difference between the security properties of STARTTLS on port 587 and Implicit TLS on port 465 if the implementations are correct and if both the client and the server are configured to require successful negotiation of TLS prior to Message Submission. Note that the â€œsubmissionsâ€ port provides access to a Message Submission Agent (MSA) as defined in [RFC6409], so requirements and recommendations for MSAs in that document, including the requirement to implement SMTP AUTH [RFC4954] and the requirements of Email Submission Operations [RFC5068], also apply to the submissions port. See Sections 5.5 and 4.2 for additional information on client certificate authentication. See Section 7.3 for port registration information. 7.3. Submissions Port Registration IANA has assigned an alternate usage of TCP port 465 in addition to the current assignment using the following template [RFC6335]: â€‹ Service Name: submissionsâ€‹ Transport Protocol: TCPâ€‹ Assignee: IESG &#x69;&#101;&#x73;&#x67;&#x40;&#x69;&#x65;&#116;&#x66;&#x2e;&#111;&#114;&#x67;â€‹ Contact: IETF Chair &#99;&#104;&#x61;&#105;&#x72;&#x40;&#105;&#101;&#116;&#x66;&#46;&#111;&#x72;&#103;â€‹ Description: Message Submission over TLS protocolâ€‹ Reference: RFC 8314â€‹ Port Number: 465 This is a one-time procedural exception to the rules in [RFC6335]. This requires explicit IESG approval and does not set a precedent. Note: Since the purpose of this alternate usage assignment is to align with widespread existing practice and there is no known usage of UDP port 465 for Message Submission over TLS, IANA has not assigned an alternate usage of UDP port 465. Historically, port 465 was briefly registered as the â€œsmtpsâ€ port. This registration made no sense, as the SMTP transport MX infrastructure has no way to specify a port, so port 25 is always used. As a result, the registration was revoked and was subsequently reassigned to a different service. In hindsight, the â€œsmtpsâ€ registration should have been renamed or reserved rather than revoked. Unfortunately, some widely deployed mail software interpreted â€œsmtpsâ€ as â€œsubmissionsâ€ [RFC6409] and used that port for email submission by default when an end user requested security during account setup. If a new port is assigned for the submissions service, either (a) email software will continue with unregistered use of port 465 (leaving the port registry inaccurate relative to de facto practice and wasting a well-known port) or (b) confusion between the de facto and registered ports will cause harmful interoperability problems that will deter the use of TLS for Message Submission. The authors of this document believe that both of these outcomes are less desirable than a â€œwartâ€ in the registry documenting real-world usage of a port for two purposes. Although STARTTLS on port 587 has been deployed, it has not replaced the deployed use of Implicit TLS submission on port 465. 2ã€ä¸ªäººç†è§£å°†ä¸Šé¢çš„å‡ æ®µåŸæ–‡é˜…è¯»æ•´åˆä¹‹åï¼Œä¸ªäººçš„ç†è§£å¦‚ä¸‹ï¼š é¦–å…ˆè¦è¯´æ˜åŸæ–‡ä¸­å¤šæ¬¡å‡ºç°çš„submissionçš„æ„æ€å®é™…ä¸Šæ˜¯æŒ‡å®¢æˆ·ç«¯ä½¿ç”¨SMTPåè®®æ¥å¯¹æœåŠ¡ç«¯è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä¸‹é¢æåŠçš„SMTPSç­‰ä»·äºåŸæ–‡çš„TLS submissionã€‚ å½“å¹´IANAä¸ºTCPçš„465ç«¯å£æ³¨å†Œäº†ç”¨é€”ï¼Œç”¨äºSMTPçš„TLSåŠ å¯†ä¼ è¾“ï¼Œä¸”æ²¡æœ‰æŒ‡å®šUDPçš„465ç«¯å£ç”¨é€”ï¼Œè¿™å°±æ˜¯465ç«¯å£åœ¨å†å²ä¸Šè¢«ç”¨ä¸ºSMTPSç«¯å£çš„ç”±æ¥ã€‚ ä¸ºä»€ä¹ˆè¯´æ˜¯å†å²ä¸Šå‘¢ï¼Œå› ä¸ºè¿™ä¸ªæ³¨å†Œåœ¨ä¸ä¹…ä¹‹åå°±è¢«æ’¤é”€äº†ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ³¨å†Œæ²¡ç”¨äº†ï¼Œ465ç«¯å£è¦è¢«å›æ”¶æ‹¿å»ç»™å…¶ä»–çš„æœåŠ¡ç”¨äº†ã€‚è€Œæ’¤é”€çš„åŸå› æ˜¯â€œè¿™ç§æ³¨å†Œæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºSMTPä¼ è¾“MXåŸºç¡€ç»“æ„æ— æ³•æŒ‡å®šç«¯å£ï¼Œå› æ­¤å§‹ç»ˆä½¿ç”¨ç«¯å£25ã€‚ï¼ˆThis registration made no sense, as the SMTP transport MX infrastructure has no way to specify a port, so port 25 is always used. ï¼‰â€ ä½†æ˜¯åæ¥åˆè§‰å¾—å½“æ—¶åº”è¯¥æŠŠè¿™ä¸ª465çš„SMTPSï¼ˆéšå¼TLSï¼‰ç«¯å£ä¿ç•™æˆ–è€…æ˜¯é‡å‘½åè€Œä¸æ˜¯æ’¤é”€ï¼Œå› ä¸ºå·²ç»æœ‰è®¸å¤šé‚®ä»¶æœåŠ¡è½¯ä»¶ä½¿ç”¨äº†465ç«¯å£ä½œä¸ºSMTPSï¼ˆéšå¼TLSï¼‰çš„ä¼ è¾“ç«¯å£ï¼Œå¦‚æœä¸ºSMTPSï¼ˆéšå¼TLSï¼‰æœåŠ¡åˆ†é…äº†æ–°ç«¯å£ï¼Œåˆ™å·²ç»ä½¿ç”¨è¢«æ³¨é”€çš„465ç«¯å£ä½œä¸ºSMTPSæœåŠ¡ç«¯å£çš„ç”µå­é‚®ä»¶è½¯ä»¶ç›¸å½“äºæ˜¯ä½¿ç”¨äº†ä¸€ä¸ªå’Œå®é™…SMTPSï¼ˆéšå¼TLSï¼‰ç«¯å£ä¸åŒ¹é…çš„ç«¯å£ï¼Œå¹¶ä¸”å®é™…ä½¿ç”¨ç«¯å£å’Œç†è®ºæ³¨å†Œç«¯å£çš„ä¸åŒä¹Ÿæœ‰å¯èƒ½å¯¼è‡´å„ç§é—®é¢˜ã€‚ å› æ­¤å°½ç®¡å·²åœ¨ç«¯å£587ä¸Šéƒ¨ç½²äº†STARTTLSï¼Œä½†å®ƒå°šæœªå–ä»£åœ¨ç«¯å£465ä¸Šéƒ¨ç½²çš„SMTPSï¼ˆéšå¼TLSï¼‰çš„ä½¿ç”¨ã€‚ éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå‡ºäºä¸€è‡´æ€§ä»¥åŠå…¶ä»–åŸå› ï¼Œéœ€è¦å°†MUAè½¯ä»¶ä½¿ç”¨çš„æ ¸å¿ƒåè®®è¿ç§»åˆ°éšå¼TLSã€‚ä½†æ˜¯ï¼Œä¸ºäº†æœ€å¤§ç¨‹åº¦åœ°ä½¿ç”¨åŠ å¯†æ¥è¿›è¡Œæäº¤ï¼Œéœ€è¦åœ¨å‡ å¹´çš„è¿‡æ¸¡æœŸå†…æ”¯æŒä¸¤ç§é€šè¿‡TLSè¿›è¡Œæ¶ˆæ¯æäº¤çš„æœºåˆ¶ã€‚å› æ­¤ï¼Œåœ¨æ­¤è¿‡æ¸¡æœŸé—´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”åœ¨ç«¯å£587ä¸Šå®æ–½STARTTLSï¼Œå¹¶åœ¨ç«¯å£465ä¸Šå®æ–½éšå¼TLSã€‚è¯·æ³¨æ„ï¼Œå¦‚æœå®æ–½æ­£ç¡®ä¸”å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½é…ç½®ä¸ºè¦æ±‚åœ¨æ¶ˆæ¯æäº¤ä¹‹å‰æˆåŠŸåå•†TLSï¼Œåˆ™ç«¯å£587ä¸Šçš„STARTTLSå’Œç«¯å£465ä¸Šçš„éšå¼TLSçš„å®‰å…¨å±æ€§ä¹‹é—´æ²¡æœ‰æ˜¾ç€å·®å¼‚ã€‚ A mail user agent (MUA) is a program that allows you to receive and send e-mail messages; itâ€™s usually just called an e-mail program. MUAè½¯ä»¶å³æŒ‡æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„é›†æ”¶å‘è¯»å†™é‚®ä»¶äºä¸€ä½“çš„é‚®ä»¶å®¢æˆ·ç«¯è½¯ä»¶ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œ465ç«¯å£æœ€å¼€å§‹è¢«æ³¨å†Œç”¨äºSMTPSï¼Œéšåè¢«æ’¤é”€ï¼Œä½†æ˜¯å› ä¸ºå·²ç»è¢«ç”¨äº†ï¼Œç°åœ¨åˆæ¢å¤äº†ï¼Œå¹¶ä¸”è¿˜å¤šå¢åŠ äº†ä¸€ä¸ª587ç«¯å£ç”¨äºSTARTTLSåŠ å¯†ä¼ è¾“ï¼Œå¹¶ä¸”åœ¨é…ç½®æ­£ç¡®çš„å‰æä¸‹ä¸¤è€…ä¸€æ ·å®‰å…¨ã€‚ç›®å‰çš„ä¸»è¦ä»»åŠ¡æ˜¯æŠŠé‚®ä»¶ä»æ˜æ–‡ä¼ è¾“è¿ç§»åˆ°åŠ å¯†ä¼ è¾“ï¼Œåœ¨è¿ç§»çš„è¿‡æ¸¡æœŸé—´åº”å½“æ”¯æŒ587ç«¯å£çš„STARTTLSå’Œ465ç«¯å£çš„éšå¼TLSã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"mail","slug":"mail","permalink":"https://tinychen.com/tags/mail/"},{"name":"smtp","slug":"smtp","permalink":"https://tinychen.com/tags/smtp/"}]},{"title":"Wiresharkå¯¹SMTPæŠ“åŒ…åˆ†æ","slug":"20200507-wireshark-analysis-smtp","date":"2020-05-07T02:00:00.000Z","updated":"2020-05-07T02:00:00.000Z","comments":true,"path":"20200507-wireshark-analysis-smtp/","link":"","permalink":"https://tinychen.com/20200507-wireshark-analysis-smtp/","excerpt":"æœ¬æ–‡ä¸»è¦ä½¿ç”¨Wiresharkå¯¹é‚®ä»¶å®¢æˆ·ç«¯ä½¿ç”¨SMTPåè®®å‘é€é‚®ä»¶çš„è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…åˆ†æå¹¶ä½¿ç”¨telnetå‘½ä»¤è¿›è¡Œç®€å•æ“ä½œã€‚","text":"æœ¬æ–‡ä¸»è¦ä½¿ç”¨Wiresharkå¯¹é‚®ä»¶å®¢æˆ·ç«¯ä½¿ç”¨SMTPåè®®å‘é€é‚®ä»¶çš„è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…åˆ†æå¹¶ä½¿ç”¨telnetå‘½ä»¤è¿›è¡Œç®€å•æ“ä½œã€‚ 1ã€SMTPç®€ä»‹ç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼ˆè‹±è¯­ï¼šSimple Mail Transfer Protocolï¼Œç¼©å†™ï¼šSMTPï¼‰æ˜¯ä¸€ä¸ªåœ¨äº’è”ç½‘ä¸Šä¼ è¾“ç”µå­é‚®ä»¶çš„æ ‡å‡†ã€‚ SMTPæ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„åŸºäºæ–‡æœ¬çš„åè®®ã€‚åœ¨å…¶ä¹‹ä¸ŠæŒ‡å®šäº†ä¸€æ¡æ¶ˆæ¯çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ¥æ”¶è€…ï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¢«ç¡®è®¤æ˜¯å­˜åœ¨çš„ï¼‰ï¼Œç„¶åæ¶ˆæ¯æ–‡æœ¬ä¼šè¢«ä¼ è¾“ã€‚å¯ä»¥å¾ˆç®€å•åœ°é€šè¿‡telnetç¨‹åºæ¥æµ‹è¯•ä¸€ä¸ªSMTPæœåŠ¡å™¨ã€‚SMTPä½¿ç”¨TCPç«¯å£25ã€‚è¦ä¸ºä¸€ä¸ªç»™å®šçš„åŸŸåå†³å®šä¸€ä¸ªSMTPæœåŠ¡å™¨ï¼Œéœ€è¦ä½¿ç”¨DNSçš„MXè®°å½•ã€‚ æ— è®ºä½¿ç”¨POP3è¿˜æ˜¯IMAP4æ¥è·å–æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å‡ä½¿ç”¨SMTPåè®®æ¥å‘é€æ¶ˆæ¯ã€‚é‚®ä»¶å®¢æˆ·ç«¯å¯èƒ½æ˜¯POPå®¢æˆ·ç«¯æˆ–è€…IMAPå®¢æˆ·ç«¯ï¼Œä½†éƒ½ä¼šä½¿ç”¨SMTPã€‚ 2ã€WiresharkæŠ“åŒ…åˆ†æç”±äºå¤§å¤šæ•°äººå¹³æ—¶æ¥è§¦åˆ°çš„ç¨‹åºé™¤äº†é‚®ä»¶å®¢æˆ·ç«¯åœ¨å‘ä»¶çš„æ—¶å€™ä¼šä½¿ç”¨SMTPåè®®ä¹‹å¤–ï¼Œå…¶ä½™çš„å‡ ä¹ä¸ä¼šç”¨åˆ°ï¼Œå› æ­¤ç›¸å…³çš„æŠ“åŒ…åˆ†æéå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨Wiresharkçš„Filterä¸­è®¾å®šæŠ“å–çš„åè®®ä¸ºSMTPå³å¯é¡ºåˆ©è¿‡æ»¤å‡ºç»å¤§å¤šæ•°çš„åŒ…ï¼Œå¦‚æœæ‹…å¿ƒè¿‡æ»¤æ•ˆæœä¸ä½³å¯ä»¥å†åŠ ä¸Šé‚®ä»¶æœåŠ¡å™¨çš„IPåœ°å€ã€‚ ç‚¹å‡»å¼€å§‹æŠ“åŒ…ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨é…ç½®äº†SMTPçš„é‚®ä»¶å®¢æˆ·ç«¯æ¥å‘é€ä¸€å°é‚®ä»¶å³å¯æŠ“å–åˆ°å…¨éƒ¨çš„æ•°æ®åŒ…ã€‚ 2.1 220æ³¨æ„è¿™é‡Œä¸ºäº†æ–¹ä¾¿åˆ†ææ•°æ®åŒ…å†…å®¹å¹¶æ²¡æœ‰ä½¿ç”¨åŠ å¯†åè®®ï¼ŒæŠ“å–åˆ°çš„ä¸€ä¸ªå®Œæ•´çš„SMTPå‘é€è¿‡ç¨‹å¦‚ä¸‹ï¼š éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œç­›æ‰äº†TCPåè®®ï¼Œå› æ­¤æœ€å¼€å§‹çš„TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥åœ¨è¿™é‡Œæ˜¯çœ‹ä¸åˆ°çš„ï¼Œå› æ­¤åœ¨å›¾ä¸­çš„ç¬¬ä¸€ä¸ªåŒ…å°±æ˜¯SMTPçš„æœåŠ¡å™¨ç«¯å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®åŒ…ï¼š å“åº”ä»£ç 220è¡¨ç¤ºè¿æ¥å»ºç«‹æˆåŠŸï¼Œåé¢çš„Anti-spamè¡¨æ˜æ˜¯è¯¥é‚®ä»¶ç³»ç»Ÿçš„ååƒåœ¾é‚®ä»¶æ¨¡å—ï¼Œå³çŒœæµ‹åœ¨è¿™é‡Œå°±æœ‰ååƒåœ¾é‚®ä»¶æ¨¡å—æ¥æŠµæŒ¡åƒåœ¾é‚®ä»¶çš„æ”»å‡»ã€‚ 2.2 EHLO/HELOæœåŠ¡ç«¯è¿”å›220ä»£ç ä¹‹åï¼Œå®¢æˆ·ç«¯ç»§ç»­å‘é€è¯·æ±‚ï¼Œé¦–å…ˆæ˜¯å‘é€EHLOå‘½ä»¤ï¼š ä¸€èˆ¬æ¥è¯´å®¢æˆ·ç«¯å’ŒSMTPæœåŠ¡ç«¯å»ºç«‹è¿æ¥ä¹‹åå°±éœ€è¦å‘é€EHLOæˆ–è€…æ˜¯HELOå‘½ä»¤ï¼Œåé¢é™„å¸¦çš„å‚æ•°æ˜¯ï¼Œå³ç›¸å½“äºå®¢æˆ·ç«¯çš„ä¸»æœºåŸŸåæˆ–è€…æ˜¯ä¸»æœºåï¼Œè¿™ä¸€æ­¥çš„ä¸»è¦ä½œç”¨æ˜¯å£°æ˜èº«ä»½ï¼ŒEHLO/HELOå‘½ä»¤ç›¸å½“äºæ˜¯HELLOå‘½ä»¤ï¼Œä¸¤è€…ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ˜¯EHLOå¸¦èº«ä»½éªŒè¯è€ŒHELOä¸å¸¦èº«ä»½éªŒè¯ï¼Œå› æ­¤EHLOè¦æ›´åŠ å®‰å…¨ åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨telnetå‘½ä»¤å¯ä»¥å¾ˆç›´æ¥çš„çœ‹åˆ°ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼ŒEHLOä¼šè¿”å›èº«ä»½éªŒè¯æ–¹å¼è€ŒHELOå‘½ä»¤åˆ™ç›´æ¥è¿”å›250 OKä»£ç ã€‚ 2.3 AUTHæœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„EHLOè¯·æ±‚ä¹‹åï¼Œè¿”å›äº†ä¸€ä¸ª250ä»£ç å¹¶ä¸”é™„å¸¦äº†æ”¯æŒçš„èº«ä»½éªŒè¯æ–¹å¼ï¼š å®¢æˆ·ç«¯ä½¿ç”¨AUTHå‘½ä»¤è¿›è¡Œèº«ä»½éªŒè¯ï¼š èº«ä»½éªŒè¯æˆåŠŸåä¼šè¿”å›235çš„æˆåŠŸä»£ç ï¼š åˆ°è¿™é‡Œå°±å®Œæˆäº†å’ŒSMTPæœåŠ¡å™¨å»ºç«‹è¿æ¥å’Œèº«ä»½éªŒè¯çš„æ­¥éª¤ã€‚ 2.4 MAIL FROMæ¥ä¸‹æ¥å®¢æˆ·ç«¯å‘é€MAIL FROMå‘½ä»¤å£°æ˜é‚®ä»¶çš„å‘ä»¶äººï¼š æœåŠ¡å™¨è¿”å›250ä»£ç ç¡®å®šæ“ä½œæˆåŠŸï¼š 2.5 RCPT TOç„¶åå®¢æˆ·ç«¯å‘é€RCPT TOå‘½ä»¤å£°æ˜é‚®ä»¶çš„æ”¶ä»¶äººï¼š æœåŠ¡å™¨è¿”å›250ä»£ç ç¡®å®šæ“ä½œæˆåŠŸï¼š 2.6 DATAå®¢æˆ·ç«¯ä½¿ç”¨DATAå‘½ä»¤ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨è¦å¼€å§‹ä¼ è¾“é‚®ä»¶çš„æ­£æ–‡å†…å®¹ï¼š æœåŠ¡ç«¯è¿”å›354ä»£ç ï¼Œå‘ŠçŸ¥é‚®ä»¶çš„å†…å®¹ç»“æŸä»¥&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;ä¸ºæ ‡è®°ï¼š windowsä¸­çš„æ¢è¡Œç¬¦æ ‡è®°ä¸ºCRLFè€ŒLinuxä¸­çš„ä¸ºLFï¼Œ&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;å³è¡¨æ˜å½“æœåŠ¡å™¨æ”¶åˆ°å•ç‹¬ä¸€è¡Œçš„.å³å®Œæˆæœ¬æ¬¡é‚®ä»¶æ­£æ–‡ä¼ è¾“ã€‚ å®¢æˆ·ç«¯æ¥æ”¶åˆ°254ä»£ç åï¼Œå¼€å§‹ä¼ è¾“é‚®ä»¶å†…å®¹ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ä¸Šé¢çš„æ•°æ®åŒ…ä¸­åŒ…å«äº†SMTPå’ŒIMFä¸¤ä¸ªéƒ¨åˆ†ï¼Œå› ä¸ºæŠ“åŒ…å‘é€çš„é‚®ä»¶å†…å®¹éƒ½æ˜¯æ–‡æœ¬ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨IMFåè®®å°±å¯ä»¥ä¼ è¾“ï¼Œè€ŒSMTPåè®®ä¸­çš„æŠ¥æ–‡å†…å®¹åˆ™æ˜¯DATAå‘½ä»¤çš„ç»ˆæ­¢æ ‡å¿—. 2.7 QUITåœ¨å®¢æˆ·ç«¯å‘é€å®Œé‚®ä»¶å†…å®¹ä¹‹åï¼Œè¿˜ä¼šæ¥ç€å‘é€ä¸€ä¸ªQUITå‘½ä»¤æ¥è¡¨ç¤ºç»“æŸè¿™æ¬¡çš„SMTPä¼ è¾“ï¼š æœåŠ¡å™¨åœ¨æ¥å—åˆ°æ•°æ®ä¹‹åä¼šè¿”å›250ä»£ç è¡¨ç¤ºæ¥å—æˆåŠŸå¹¶ä¸”å†è¿”å›221ä»£ç è¡¨ç¤ºç»“æŸæœ¬æ¬¡SMTPä¼ è¾“ã€‚ 3ã€telnetæµ‹è¯•SMTPç”±äºSMTPåè®®ååˆ†ç®€å•ä¸”æ²¡æœ‰åŠ å¯†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨telnetå‘½ä»¤è¿æ¥åˆ°é‚®ä»¶æœåŠ¡å™¨ä¹Ÿå¯ä»¥æ‰§è¡ŒåŒæ ·çš„æ“ä½œï¼š 1234567891011121314151617181920212223242526272829303132# ä½¿ç”¨telnetå’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥telnet localhost 25# è¿™é‡Œæ ¹æ®é‚®ä»¶ç³»ç»Ÿçš„ä¸åŒé€‰æ‹©EHLOæˆ–è€…æ˜¯HELOHELO TINY-DESKTOPEHLO TINY-DESKTOP# ä½¿ç”¨EHLOè¿˜å¯ä»¥è¿›è¡Œèº«ä»½éªŒè¯# ä½¿ç”¨AUTHå‘½ä»¤è¿›è¡Œèº«ä»½éªŒè¯å’Œç™»å½•# éœ€è¦æ³¨æ„è¦å°†è´¦å·å¯†ç è½¬ç æˆbase64ç¼–ç çš„æ–‡æœ¬æ‰å¯ä»¥æˆåŠŸç™»å½•AUTH LOGIN# è½¬ç å‰çš„è´¦å·test01@coremail.cndGVzdDAxQGNvcmVtYWlsLmNu# è½¬ç å‰çš„å¯†ç password01cGFzc3dvcmQwMQ==# ç¡®å®šå‘ä»¶äººMAIL FROM: &lt;test01@coremail.cn&gt;# ç¡®å®šæ”¶ä»¶äººRCPT TO: &lt;test02@coremail.cn&gt;# å¼€å§‹ä¼ è¾“æ­£æ–‡DATASubject: telnet test mailFrom:&quot;test01&quot;&lt;test01@coremail.cn&gt;To:&quot;test02&quot;&lt;test02@coremail.cn&gt;Hello,This is a smtp test via telnet.Goodbye..# ç»“æŸä¼ è¾“å¹¶é€€å‡ºQUIT å¦‚å›¾ä¸­æ‰€ç¤ºä½¿ç”¨AUTHå‘½ä»¤ç™»å½•è®¤è¯æˆåŠŸä¹‹åæ˜¯ä¼šæ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„235ä»£ç çš„ã€‚æˆ‘ä»¬æ“ä½œå®Œæˆä¹‹åæŸ¥çœ‹é‚®ç®±ç¡®å®šæ”¶åˆ°äº†æµ‹è¯•çš„é‚®ä»¶åˆ™è¯´æ˜æ“ä½œæˆåŠŸã€‚ åœ¨ä½¿ç”¨AUTHè®¤è¯çš„æƒ…å†µå¦‚ä¸‹ï¼š å®é™…ä¸Šè¿”å›çš„334ä»£ç åé¢çš„dXNlcm5hbWU6å’ŒUGFzc3dvcmQ6å°±æ˜¯base64ç¼–ç çš„usernameå’ŒPasswordã€‚ ç”±äºæ˜æ–‡ä¼ è¾“çš„ä¸å®‰å…¨æ€§ï¼Œç°åœ¨å•çº¯çš„SMTPå·²ç»å‡ ä¹æ²¡æœ‰ä½¿ç”¨äº†ï¼Œä½¿ç”¨çš„è¾ƒå¤šçš„éƒ½æ˜¯å®ƒçš„åŠ å¯†ç‰ˆæœ¬SMTPSï¼ˆ465ç«¯å£ï¼ŒSSLåŠ å¯†ï¼Œä¸æ¨èä½¿ç”¨ï¼‰å’ŒSTARTTLSï¼ˆ587ç«¯å£ï¼ŒTLSåŠ å¯†ï¼Œæ¨èä½¿ç”¨ï¼‰ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"wireshark","slug":"wireshark","permalink":"https://tinychen.com/tags/wireshark/"},{"name":"mail","slug":"mail","permalink":"https://tinychen.com/tags/mail/"},{"name":"smtp","slug":"smtp","permalink":"https://tinychen.com/tags/smtp/"}]},{"title":"IPv6ç½‘ç»œé…ç½®LVSçš„DRæ¨¡å¼","slug":"20200505-lvs-deploy-dr-mode-in-ipv6","date":"2020-05-05T02:00:00.000Z","updated":"2020-05-05T02:00:00.000Z","comments":true,"path":"20200505-lvs-deploy-dr-mode-in-ipv6/","link":"","permalink":"https://tinychen.com/20200505-lvs-deploy-dr-mode-in-ipv6/","excerpt":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬LVS DRæ¨¡å¼åœ¨IPv4ç½‘ç»œå’ŒIPv6ç½‘ç»œä¸‹é…ç½®çš„ä¸€äº›å·®å¼‚å¯¹æ¯”ã€‚","text":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬LVS DRæ¨¡å¼åœ¨IPv4ç½‘ç»œå’ŒIPv6ç½‘ç»œä¸‹é…ç½®çš„ä¸€äº›å·®å¼‚å¯¹æ¯”ã€‚ 1ã€LVS DR via IPv4é¦–å…ˆè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸‰å°ä¸»æœºé…ç½®lvsé›†ç¾¤ï¼Œå¯¹åº”çš„ç³»ç»Ÿå’Œå†…æ ¸ç‰ˆæœ¬å¦‚ä¸‹ 12345678[root@lvs81 ~]# lsb_release -aLSB Version: :base-4.0-amd64:base-4.0-noarch:core-4.0-amd64:core-4.0-noarch:graphics-4.0-amd64:graphics-4.0-noarch:printing-4.0-amd64:printing-4.0-noarchDistributor ID: CentOSDescription: CentOS release 6.10 (Final)Release: 6.10Codename: Final[root@lvs81 ~]# uname -r2.6.32-754.28.1.el6.x86_64 å¯¹åº”çš„IPåœ°å€å¦‚ä¸‹ 123456789192.168.100.80 lvsipv4192.168.100.81 lvs81192.168.100.82 lvs82192.168.100.83 lvs83240e:c331:dead:beef::3c80 lvsipv6240e:c331:dead:beef::3c81 lvs81240e:c331:dead:beef::3c82 lvs82240e:c331:dead:beef::3c83 lvs83 å…¶ä¸­lvs81å¯¹åº”ä¸ºLBï¼Œlvs82å’Œlvs83ä¸ºRSï¼ŒRSä¸Šéƒ¨ç½²nginxåˆ†åˆ«ç›‘å¬æœ¬æœºå¯¹åº”ipv4å’Œipv6åœ°å€çš„80ç«¯å£ç”¨äºæµ‹è¯•ã€‚ 1.1 LBé…ç½®æ­¤å¤„ç•¥å»ipvsæ¨¡å—çš„åŠ è½½å’Œipvsadmçš„å®‰è£…ã€‚ 1234ifconfig eth1:1 192.168.100.80 broadcast 192.168.100.81 netmask 255.255.255.255 upipvsadm -A -t 192.168.100.80:80 -s rr ipvsadm -a -t 192.168.100.80:80 -r 192.168.100.82 -gipvsadm -a -t 192.168.100.80:80 -r 192.168.100.83 -g ä¿®æ”¹ip_vsæ¨¡å—å¯¹åº”çš„å“ˆå¸Œè¡¨çš„å¤§å° 1echo &#x27;options ip_vs conn_tab_bits=20&#x27; &gt;/etc/modprobe.d/ipvs.conf 1.2 RSé…ç½®1ifconfig lo:1 192.168.100.80 broadcast 192.168.100.80 netmask 255.255.255.255 up åŒæ—¶éœ€è¦ä¿®æ”¹å†…æ ¸å‚æ•°ï¼Œä¿®æ”¹ARPè¯·æ±‚å¯¹åº”çš„å“åº”é™åˆ¶ 12345[root@lvs82 ~]# cat /etc/sysctl.conf | grep arpnet.ipv4.conf.all.arp_ignore=1net.ipv4.conf.lo.arp_ignore=1net.ipv4.conf.all.arp_announce=2net.ipv4.conf.lo.arp_announce=2 1.3 æµ‹è¯• 2ã€ipv6å’Œipv4çš„ä¸€äº›å·®åˆ« ipv6ä¸­æ²¡æœ‰å¹¿æ’­åœ°å€çš„æ¦‚å¿µ åœ¨IPv4ä¸­å¹¿æ³›çš„ä½¿ç”¨å•æ’­ã€å¹¿æ’­ã€ç»„æ’­çš„æ–¹å¼ã€‚è€Œåœ¨IPv6çš„åº”ç”¨ç¯å¢ƒä¸­ï¼Œä½¿ç”¨å•æ’­ï¼Œç»„æ’­ã€ä»»æ„æ’­çš„æ–°æ–¹å¼ã€‚ ipv6ä¸­æ²¡æœ‰ARPåè®®ï¼Œä½¿ç”¨äº†å‡çº§ç‰ˆæœ¬çš„é‚»å±…å‘ç°åè®®ï¼ˆNDRï¼‰åè®® é‚»å±…å‘ç°çš„è¿™äº›åŠŸèƒ½ä¸»è¦é€šè¿‡é‚»å±…å‘ç°åè®®æŠ¥æ–‡å®ç°ï¼Œé‚»å±…å‘ç°åè®®åˆ†ç»„è£…è½½åœ¨ICMPv6åˆ†ç»„å†…éƒ¨ã€‚é‚»å±…å‘ç°åè®®ä¸­å®šä¹‰äº†äº”ç§ICMPv6åˆ†ç»„ç±»å‹ï¼Œå®ƒä»¬çš„åç§°å’Œä½œç”¨å¦‚ä¸‹ã€‚ è·¯ç”±å™¨è¯·æ±‚ï¼ˆRSï¼ŒRouter Solicitationï¼‰æŠ¥æ–‡ å½“ä¸»æœºçš„æ¥å£å¼€å§‹å·¥ä½œæ—¶ï¼Œä¸»æœºä¼šå‘é€è·¯ç”±å™¨è¯·æ±‚æ¶ˆæ¯ï¼Œè¯·æ±‚å¯èƒ½å­˜åœ¨çš„è·¯ç”±å™¨ç­”å¤ï¼Œå³æ˜¯ä¸ºäº†æ¢å¯»ä¸è‡ªå·±ç›¸è¿çš„è·¯ç”±å™¨çš„æƒ…å†µã€‚ è·¯ç”±å™¨é€šå‘Šï¼ˆRAï¼ŒRouter Advertisementï¼‰æŠ¥æ–‡ è·¯ç”±å™¨é€šå‘Šç”±è·¯ç”±å™¨å‘¨æœŸæ€§åœ°å‘é€ï¼Œä¹Ÿå¯ä½œä¸ºæ”¶åˆ°çš„è·¯ç”±å™¨è¯·æ±‚ï¼ˆæ¥è‡ªä¸»æœºï¼‰çš„å“åº”å‘é€å‡ºå»ã€‚æ¯ä¸ªè·¯ç”±å™¨é€šå‘Šä¸­è¿˜å¯èƒ½åŒ…å«å‰ç¼€ä¿¡æ¯ã€é“¾è·¯é…ç½®å’ŒIPv6åè®®å‚æ•°ç­‰ä¿¡æ¯ã€‚è·¯ç”±å™¨é€šå‘Šå®£å‘Šç€è·¯ç”±å™¨çš„å­˜åœ¨å’Œä¸€äº›è‡ªèº«é…ç½®ã€‚ é‚»å±…è¯·æ±‚ï¼ˆNSï¼ŒNeighbor Solicitationï¼‰æŠ¥æ–‡ èŠ‚ç‚¹å¯ä»¥å‘é€é‚»å±…è¯·æ±‚ç”¨ä»¥è§£æå¦ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾è·¯å±‚åœ°å€å’ŒéªŒè¯å¦ä¸€ä¸ªèŠ‚ç‚¹çš„å¯è¾¾æ€§ã€‚é‚»å±…è¯·æ±‚è¿˜ç”¨æ¥éªŒè¯ä¸€æ¡ç‰¹å®šé“¾è·¯ä¸Šçš„åœ°å€æ˜¯å¦æ˜¯å”¯ä¸€çš„ï¼šå½“èŠ‚ç‚¹ä¸Šäº§ç”Ÿäº†ä¸€ä¸ªæ–°åœ°å€æ—¶ï¼Œä¼šå‘æ•´ä¸ªé“¾è·¯ä¸Šçš„å…¶å®ƒèŠ‚ç‚¹å‘é€é‚»å±…è¯·æ±‚ï¼Œè¯¢é—®è¯¥åœ°å€æ˜¯å¦å·²ç»è¢«å ç”¨ã€‚å¦‚æœè¯¥åœ°å€å·²ç»è¢«å ç”¨ï¼Œé‚£ä¹ˆå ç”¨è¯¥åœ°å€çš„èŠ‚ç‚¹ä¼šå›å¤é‚»å±…é€šå‘Šï¼Œå¦åˆ™å¤šæ¬¡æ£€æµ‹åæ²¡æœ‰æ”¶åˆ°å›å¤ï¼Œåˆ™è¯¥æ–°åœ°å€ç”Ÿæ•ˆã€‚ é‚»å±…é€šå‘Šï¼ˆNAï¼ŒNeighbor Advertisementï¼‰æŠ¥æ–‡ èŠ‚ç‚¹å¯ä»¥å‘é€é‚»å±…é€šå‘Šæ¥å“åº”é‚»å±…è¯·æ±‚åˆ†ç»„ï¼Œå®ƒè¿˜ä¼šå‘é€æœªç»è¯·æ±‚çš„é‚»å±…é€šå‘Šï¼Œå°†èŠ‚ç‚¹çš„é“¾è·¯å±‚åœ°å€å˜åŒ–é€šçŸ¥å…¶å®ƒèŠ‚ç‚¹ã€‚ é‡å®šå‘ï¼ˆRedirectï¼‰æŠ¥æ–‡ è·¯ç”±å™¨é€šè¿‡é‡å®šå‘æŠ¥æ–‡é€šçŸ¥ä¸»æœºï¼Œå¯¹äºä¸€æ¡ç‰¹å®šçš„è·¯ç”±ï¼Œå¦‚æœä¸æ˜¯æœ€ä½³è·¯ç”±ï¼Œåˆ™é€šçŸ¥ä¸»æœºæœ€ä½³è·¯ç”±åŠä¸‹ä¸€è·³ã€‚ å®é™…ä¸Šåœ¨IPv6åè®®è¿‡ç¨‹ä¸­ä½¿ç”¨NDPåè®®æ ¹æ®IPæŸ¥æ‰¾MACçš„è¿‡ç¨‹ä¸»è¦ä½¿ç”¨çš„æ˜¯NSå’ŒNAä¸¤ç§æŠ¥æ–‡ï¼Œå®ƒä»¬ç›¸å½“äºARPåè®®ä¸­çš„ARP Requestå’ŒARP Replyã€‚ 2.1 ipv6çš„åœ°å€åˆ†ç±»2.1.1 ipv6çš„åœ°å€è¡¨ç¤ºIPv6åœ°å€çš„é•¿åº¦æ˜¯IPv4ï¼ˆ32ä½ï¼‰çš„4å€ï¼Œè¾¾åˆ°äº†128ä½ï¼Œå¤æ‚ç¨‹åº¦å¤§å¤§æå‡ï¼Œè¡¨è¾¾ä¸Šä½¿ç”¨äº†8ç»„ä¸åŒºåˆ†å¤§å°å†™çš„16è¿›åˆ¶æ•°æ¥è¡¨ç¤ºï¼Œæ¯ç»„ç”±4ä¸ª16è¿›åˆ¶æ•°ç»„æˆã€‚IPv6åœ°å€ä¸€èˆ¬ä½¿ç”¨â€œé›¶ç¼©æ³•â€æ¥è¡¨ç¤ºï¼Œä¸»è¦é™åˆ¶å¦‚ä¸‹ï¼š 16ä½åœ°å€å—ä¸­çš„å‰å¯¼0å¯ä»¥çœç•¥ï¼Œå¦‚æœ16ä½å…¨ä¸º0ï¼Œå¯ä»¥åªå†™ä¸€ä¸ª0 å½“IPv6åœ°å€ä¸­æœ‰å¤šä¸ªè¿ç»­çš„ï¼Œå€¼ä¸º0çš„16ä½åœ°å€å—æ—¶ï¼Œå¯ä»¥ç”¨1ä¸ªåŒå†’å·è½¬æ¢è¿™ äº›è¿ç»­çš„0ï¼Œä½†åŒå†’å·åœ¨ä¸€ä¸ªIPv6åœ°å€ä¸­åªèƒ½å‡ºç°ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªIPv6åœ°å€åª èƒ½ç”¨ä¸€ä¸ªåŒå†’å·è½¬æ¢ä¸€ä¸ªè¿ç»­çš„ã€å€¼ä¸º0çš„16ä½åœ°å€å— ä¸èƒ½ç”¨åŒå†’å·è½¬æ¢å±äº16ä½åœ°å€å—ä¸­ä¸€éƒ¨åˆ†çš„0ï¼Œå³ä½¿æ˜¯åœ°å€å—ä¸­çš„æœ€åä¸€ä¸ª16 è¿›åˆ¶æ•°0 2.1.2 ipv6åœ°å€ç±»å‹IPv6åè®®ä¸»è¦å®šä¹‰äº†ä¸‰ç§åœ°å€ç±»å‹ï¼šå•æ’­åœ°å€ï¼ˆUnicast Addressï¼‰ã€ç»„æ’­åœ°å€ ï¼ˆMulticast Addressï¼‰å’Œä»»æ’­åœ°å€ï¼ˆAnycast Addressï¼‰ã€‚ç›¸æ¯”IPv4è€Œè¨€å–æ¶ˆäº†å¹¿æ’­åœ°å€ï¼Œæ–°å¢äº†ä»»æ„æ’­ï¼Œè€ŒIPv4ä¸­çš„å¹¿æ’­åŠŸèƒ½åœ¨IPv6ä¸­ä¸»è¦é€šè¿‡ç»„æ’­å®ç°ã€‚ç”±äºä¸¤è€…çš„ç»„æ’­æ ‡å‡†å¹¶æ— è¿‡å¤šçš„æ”¹åŠ¨ï¼Œå› æ­¤IPv6ä¸­çš„ç»„æ’­åœ°å€å…¶å®ä¸IPv4ä¸­çš„ç»„æ’­åœ°å€æ˜¯ç±»ä¼¼çš„ã€‚ å•æ’­åœ°å€ï¼šç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªæ¥å£ï¼Œç±»ä¼¼äºIPv4ä¸­çš„å•æ’­åœ°å€ã€‚å‘é€åˆ°å•æ’­åœ°å€ çš„æ•°æ®æŠ¥æ–‡å°†è¢«ä¼ é€ç»™æ­¤åœ°å€æ‰€æ ‡è¯†çš„ä¸€ä¸ªæ¥å£ã€‚ ç»„æ’­åœ°å€ï¼šç”¨æ¥æ ‡è¯†ä¸€ç»„æ¥å£ï¼ˆé€šå¸¸è¿™ç»„æ¥å£å±äºä¸åŒçš„èŠ‚ç‚¹ï¼‰ï¼Œç±»ä¼¼äºIPv4ä¸­çš„ç»„æ’­åœ°å€ã€‚å‘é€åˆ°ç»„æ’­åœ°å€çš„æ•°æ®æŠ¥æ–‡è¢«ä¼ é€ç»™æ­¤åœ°å€æ‰€æ ‡è¯†çš„æ‰€æœ‰æ¥å£ã€‚ ä»»æ’­åœ°å€ï¼šç”¨æ¥æ ‡è¯†ä¸€ç»„æ¥å£ï¼ˆé€šå¸¸è¿™ç»„æ¥å£å±äºä¸åŒçš„èŠ‚ç‚¹ï¼‰ã€‚å‘é€åˆ°ä»»æ’­åœ° å€çš„æ•°æ®æŠ¥æ–‡è¢«ä¼ é€ç»™æ­¤åœ°å€æ‰€æ ‡è¯†çš„ä¸€ç»„æ¥å£ä¸­è·ç¦»æºèŠ‚ç‚¹æœ€è¿‘ï¼ˆæ ¹æ®ä½¿ç”¨çš„è·¯ ç”±åè®®è¿›è¡Œåº¦é‡ï¼‰çš„ä¸€ä¸ªæ¥å£ã€‚ æ•´ä¸ªIPv6å•æ’­åœ°å€åŒ…æ‹¬ä»¥ä¸‹äº”ä¸ªç±»å‹ï¼šå…¨å±€å•æ’­åœ°å€ã€é“¾è·¯æœ¬åœ°åœ°å€ã€ç«™ç‚¹æœ¬åœ°åœ°å€ã€ç‰¹æ®Šåœ°å€ã€å…¼å®¹æ€§åœ°å€ã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œé‡ç‚¹è®²ä¸€ä¸‹å’ŒLVSè¦ç”¨åˆ°çš„å…¨å±€å•æ’­åœ°å€å’Œé“¾è·¯æœ¬åœ°åœ°å€ã€‚ å…¨å±€å•æ’­åœ°å€ç­‰åŒäºIPv4ä¸­çš„å…¬ç½‘åœ°å€ï¼Œå¯ä»¥åœ¨IPv6 Internetä¸Šè¿›è¡Œå…¨å±€è·¯ç”±å’Œè®¿é—®ã€‚ åœ¨IPv6ä¸­ï¼Œæœ¬åœ°å•æ’­åœ°å€å°±æ˜¯æŒ‡æœ¬åœ°ç½‘ç»œä½¿ç”¨çš„å•æ’­åœ°å€ï¼Œä¹Ÿå°±æ˜¯IPV4åœ°å€ä¸­ç»å¸¸ æ‰€è¯´çš„å±€åŸŸç½‘ä¸“ç”¨åœ°å€ã€‚æœ¬åœ°å•æ’­åœ°å€åˆæœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯é“¾è·¯æœ¬åœ°åœ°å€å’Œç«™ç‚¹æœ¬åœ° åœ°å€ã€‚æ¯ä¸ªæ¥å£ä¸Šè‡³å°‘è¦æœ‰ä¸€ä¸ªé“¾è·¯æœ¬åœ°å•æ’­åœ°å€ï¼Œå¦å¤–è¿˜å¯åˆ†é…ä»»ä½•ç±»å‹ï¼ˆå• æ’­ã€ä»»æ’­å’Œç»„æ’­ï¼‰æˆ–èŒƒå›´çš„IPv6åœ°å€ã€‚ é“¾è·¯æœ¬åœ°åœ°å€ä»…ç”¨äºå•ä¸ªé“¾è·¯ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œçš„â€œé“¾è·¯â€å°±ç›¸å½“äºIPv4ä¸­çš„å­ç½‘ï¼‰ï¼Œ ä¸èƒ½åœ¨ä¸åŒå­ç½‘ä¸­è·¯ç”±ã€‚ç»“ç‚¹ä½¿ç”¨é“¾è·¯æœ¬åœ°åœ°å€ä¸åŒä¸€ä¸ªé“¾è·¯ä¸Šçš„ç›¸é‚»ç»“ç‚¹è¿›è¡Œé€š ä¿¡ã€‚ é“¾è·¯æœ¬åœ°åœ°å€ç­‰æ•ˆäº169.254.0.0/16ç½‘æ®µçš„è‡ªåŠ¨ä¸“ç”¨IPå¯»å€ï¼ˆAPIPAï¼‰IPv4åœ°å€ ï¼ˆåœ¨è¿è¡ŒWindowsç³»ç»Ÿçš„è®¡ç®—æœºä¸Šè‡ªåŠ¨é…ç½®ï¼‰ã€‚é‚»å±…å‘ç°è¿‡ç¨‹è¦æ±‚ä½¿ç”¨é“¾è·¯æœ¬åœ°åœ° å€ï¼Œè¯¥åœ°å€å§‹ç»ˆè‡ªåŠ¨é…ç½®ï¼ˆä¹Ÿå°±æ˜¯æ— é¡»æ‰‹å·¥é…ç½®ï¼‰ï¼Œå³ä½¿æ‰€æœ‰å…¶ä»–å•æ’­åœ°å€éƒ½ä¸å­˜ åœ¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œé“¾è·¯æœ¬åœ°åœ°å€å§‹ç»ˆä»¥â€œ1111111010â€ï¼ˆFE80ï¼‰å¼€å¤´ã€‚åé¢ç´§è·Ÿç€ çš„54ä½å‡ä¸º0ï¼Œæœ€åçš„64ä½æ˜¯ç”¨æ¥æ ‡è¯†æ¥å£ï¼Œç§°ä¸ºæ¥å£IDã€‚åœ¨IPv6å•æ’­åœ°å€ä¸­çš„æ¥ å£IDç”¨æ¥æ ‡è¯†ä¸€ä¸ªé“¾è·¯ä¸Šçš„æ¥å£ï¼Œä¸èƒ½åœ¨åŒä¸€ä¸ªé“¾è·¯ä¸Šä¸ºä¸åŒç»“ç‚¹åˆ†é…ç›¸åŒçš„æ¥å£ IDã€‚æ‰€ä»¥å¯¹äºé“¾è·¯æœ¬åœ°åœ°å€çš„å‰ç¼€å§‹ç»ˆæ˜¯FE80ï¼š/64ã€‚IPv6è·¯ç”±å™¨æ°¸è¿œä¸ä¼šå°†é“¾è·¯ æœ¬åœ°é€šä¿¡è½¬å‘å‡ºè¯¥é“¾è·¯ã€‚ 2.2 ipv6çš„NDPåè®®è¦ç†è§£IPv6çš„ç»„æ’­ï¼Œé¦–å…ˆéœ€è¦æ˜ç™½ä¸‰ä¸ªå…³é”®ç‚¹ï¼š ä»»ä½•èŠ‚ç‚¹éƒ½èƒ½å¤Ÿæˆä¸ºä¸€ä¸ªå¤šæ’­ç»„æˆå‘˜ä¹Ÿå«åšç»„æ’­ç»„æˆå‘˜ æºèŠ‚ç‚¹å¯ä»¥å‘é€æ•°æ®åŒ…åˆ°å¤šæ’­ç»„ åœ¨ä¸€ä¸ªå¤šæ’­ç»„çš„èŠ‚ç‚¹éƒ½èƒ½æ”¶åˆ°å‘å¾€è¯¥ç»„æ’­ç»„çš„æ•°æ® åœ¨IPv4ç¯å¢ƒçš„çš„ARPåœ°å€è§£æåè®®æ˜¯ä½¿ç”¨ç›®æ ‡åœ°å€ä¸ºå¹¿æ’­ï¼ˆ255.255.255.255æˆ–è€…FFFF.FFFF.FFFFï¼‰å°†MACåœ°å€è¯·æ±‚æ¶ˆæ¯å‘é€åˆ°æ•´ä¸ªä»¥å¤ªç½‘é“¾è·¯ä¸Šçš„æ‰€æœ‰ä¸»æœºï¼Œå³ä¾¿æ˜¯LBï¼ˆlvs81ï¼‰ä¸»æœºè¯·æ±‚RSï¼ˆlvs82ï¼‰ä¸»æœºçš„MACï¼ŒRSï¼ˆlvs82ï¼‰ä¸»æœºä¸RSï¼ˆlvs83ï¼‰ä¸»æœºæ˜¯åŒæ ·ä¼šæ”¶åˆ°è¿™ä¸ªè¯·æ±‚å¹¿æ’­ï¼Œä»æ€§èƒ½ä¸æ•ˆç‡ä¸Šè®²è¿™æ˜æ˜¾ä¸ç§‘å­¦ã€‚ æ‰€ä»¥åœ¨IPv6çš„ç¯å¢ƒä¸­æ”¾å¼ƒäº†å¹¿æ’­çš„çš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨ç»„æ’­æ–¹å¼å°†MACåœ°å€çš„è§£æè¯·æ±‚ï¼Œä»¥ç‚¹å¯¹ç‚¹çš„å½¢å¼ç›´æ¥ç»„æ’­åˆ°lvs82ä¸»æœºçš„è¯·æ±‚èŠ‚ç‚¹ç»„æ’­åœ°å€ã€‚è€Œä¸å†å°†è¯·æ±‚æ¶ˆæ¯å‘é€åˆ°æ— å…³çš„lvs83ä¸»æœºï¼Œæ‰€ä»¥IPv6çš„èŠ‚ç‚¹è¯·æ±‚çš„ç¡®æ˜¯é«˜æ•ˆç‡å»æ›¿ä»£IPv4çš„ARPåè®®ã€‚æ€»è€Œè¨€ä¹‹å°±æ˜¯ä½¿ç”¨ç‚¹åˆ°ç‚¹çš„æ–¹å¼å»ä»£æ›¿å¹¿æ’­ã€‚ é‚£ä¹ˆå¯¹äºIPv6æ¥è¯´ï¼Œå‘é€ç»„æ’­æ•°æ®åŒ…çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä¸çŸ¥é“ç›®æ ‡IPä¸»æœºçš„MACåœ°å€çš„ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ°IPv6ä¸­å¯¹åº”çš„ç»„æ’­IPåœ°å€å’Œç»„æ’­MACåœ°å€äº†ï¼š ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»„æ’­çš„IPv6åœ°å€æ˜¯æ ¹æ®ç›®æ ‡IPv6åœ°å€ç”Ÿæˆçš„ï¼Œç»„æ’­IPv6åœ°å€ä¼šå–ç›®æ ‡IPv6åœ°å€çš„ä½24ä½ï¼ˆ2è¿›åˆ¶ï¼‰æ¥åŠ ä¸Šå›ºå®šçš„å‰ç¼€FF02::1:FFï¼ˆ16è¿›åˆ¶ï¼‰ä»è€Œç”Ÿæˆå¯¹åº”çš„ç»„æ’­åœ°å€ï¼Œè€Œç»„æ’­çš„MACåœ°å€åˆ™æ˜¯æ ¹æ®ç»„æ’­çš„IPv6åœ°å€çš„ä½32ä½ï¼ˆ2è¿›åˆ¶ï¼‰å†åŠ ä¸Šå›ºå®šå‰ç¼€3333ï¼ˆ16è¿›åˆ¶ï¼‰ç”Ÿæˆã€‚ ç”±äºåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ä¸­ï¼ŒIPv6åœ°å€ä½24ä½ç›¸åŒçš„æ¦‚ç‡ååˆ†å°ï¼Œå› æ­¤ç»„æ’­åŒ…å‘é€å‡ºå»ä¹‹åï¼Œæ¥å—è¯¥ç»„æ’­åŒ…çš„å®¢æˆ·ç«¯å‡ ä¹åªæœ‰ä¸€ä¸ªï¼Œå°±æ— é™æ¥è¿‘äºä¸€å¯¹ä¸€çš„å•æ’­æ•ˆæœï¼Œä»è€Œæœ‰æ•ˆåœ°é¿å…äº†ARPåè®®ä½¿ç”¨å¹¿æ’­æ–¹å¼çš„è¯¸å¤šé—®é¢˜ã€‚ 3ã€LVS DR via IPv6åŒæ ·è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„ä¸‰å°æœºå™¨ï¼Œç”±äºIPv6ä¸­æ²¡æœ‰ARPçš„å›°æ‰°ï¼Œæ‰€ä»¥åœ¨é…ç½®çš„æ—¶å€™åè€Œè¦æ¯”IPv4æ›´åŠ ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦ç›´æ¥æ·»åŠ ipå³å¯ï¼š IPv6æ¨¡å¼ä¸‹è¿˜ä½¿ç”¨äº†elrepoåº“ä¸­çš„ltç‰ˆæœ¬çš„4.4.219-1å†…æ ¸è¿›è¡Œæµ‹è¯•ï¼Œä¸¤è€…ç»“æœä¸€è‡´ã€‚å‡å¯ç›´æ¥æ­£å¸¸å·¥ä½œã€‚ 3.1 LBé…ç½®ä¸éœ€è¦å¯¹å†…æ ¸å‚æ•°è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œç¡®è®¤å¯ç”¨äº†ipv6ç½‘ç»œå³å¯ 1234ifconfig eth2 inet6 add 240e:c331:dead:beef::3c80/128ipvsadm -A -t [240e:c331:dead:beef::3c80]:80 -s rripvsadm -a -t [240e:c331:dead:beef::3c80]:80 -r [240e:c331:dead:beef::3c82]:80 -gipvsadm -a -t [240e:c331:dead:beef::3c80]:80 -r [240e:c331:dead:beef::3c83]:80 -g 3.2 RSé…ç½®ä¸éœ€è¦å¯¹å†…æ ¸å‚æ•°è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œç¡®è®¤å¯ç”¨äº†ipv6ç½‘ç»œå³å¯ 1ifconfig lo inet6 add 240e:c331:dead:beef::3c80/128 3.3 æµ‹è¯•ä½¿ç”¨å®¢æˆ·ç«¯è¿›è¡Œè®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›çš„æ˜¯ipv6çš„ç»“æœï¼Œå¹¶ä¸”äº§ç”Ÿäº†é¢„è®¾çš„è½®è¯¢æ•ˆæœã€‚ æŸ¥çœ‹ipv6ç½‘ç»œä¸­çš„é‚»å±…è¡¨ï¼Œå¯ä»¥çœ‹åˆ°å¯¹åº”çš„ä¸¤ä¸ªRSçŠ¶æ€ä¸ºå¯è¾¾ï¼ˆREACHABLEï¼‰,å¹¶ä¸”å¯¹åº”çš„MACåœ°å€ä¸ºRIPçš„ipv6åœ°å€æ‰€åœ¨çš„ç½‘å¡ã€‚æ­¤å¤–å’ŒIPv4ä¸­ä¸åŒçš„æ˜¯ï¼Œå¯¹åº”çš„ä¸¤å°RSä¸Šé¢çš„Link-localåœ°å€åœ¨é‚»å±…è¡¨ä¸­çš„çŠ¶æ€ä¹Ÿæ˜¾ç¤ºä¸ºå¯è¾¾ï¼ˆREACHABLEï¼‰ã€‚ æŸ¥çœ‹LBä¸Šé¢çš„ipvsadmä¸­çš„è¿æ¥çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿æ¥å·²ç»å»ºç«‹å¹¶ä¸”ç¡®å®è½¬å‘åˆ°äº†åç«¯çš„RSä¸Šã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"},{"name":"lvs","slug":"lvs","permalink":"https://tinychen.com/tags/lvs/"},{"name":"ipv6","slug":"ipv6","permalink":"https://tinychen.com/tags/ipv6/"}]},{"title":"Tomcatç¯‡04-éƒ¨ç½²å’Œç®¡ç†","slug":"20200504-tomcat-04-deploy-manager-serverxml","date":"2020-05-04T02:00:00.000Z","updated":"2020-05-04T02:00:00.000Z","comments":true,"path":"20200504-tomcat-04-deploy-manager-serverxml/","link":"","permalink":"https://tinychen.com/20200504-tomcat-04-deploy-manager-serverxml/","excerpt":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬tomcatæœåŠ¡å™¨çš„webåº”ç”¨éƒ¨ç½²å’Œç®¡ç†ï¼Œä»¥åŠserver.xmlçš„ä¸»è¦é…ç½®ã€‚","text":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬tomcatæœåŠ¡å™¨çš„webåº”ç”¨éƒ¨ç½²å’Œç®¡ç†ï¼Œä»¥åŠserver.xmlçš„ä¸»è¦é…ç½®ã€‚ 1ã€manageråº”ç”¨tomcatæœ¬èº«å†…ç½®äº†ä¸¤ä¸ªwebåº”ç”¨ï¼Œä¸“é—¨ç”¨æ¥ç®¡ç†tomcatï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯host-managerï¼ˆç®¡ç†virtual hostï¼‰å’Œmanagerï¼ˆç®¡ç†webåº”ç”¨ï¼‰ã€‚ 12http://localhost:8080/host-manager/htmlhttp://localhost:8080/manager/html åœ¨å¯åŠ¨tomcatä¹‹åï¼Œæˆ‘ä»¬è®¿é—®ä¸Šé¢çš„è¿™ä¸¤ä¸ªç½‘å€å¯ä»¥å‘ç°è¢«403äº†ã€‚å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ ç›¸å…³çš„ç”¨æˆ·ï¼Œä¸ºäº†ä¿è¯å®‰å…¨ï¼Œè¿™é‡Œçš„ç”¨æˆ·é»˜è®¤éƒ½æ˜¯ç¦ç”¨çš„ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±åˆ›å»ºã€‚ æˆ‘ä»¬ç¼–è¾‘tomcatç›®å½•ä¸‹çš„confå­ç›®å½•ä¸­çš„tomcat-users.xmlï¼Œæ·»åŠ å¯¹åº”çš„é…ç½®å³å¯ï¼š 123456789101112131415161718&lt;!--adminå¯¹åº”çš„æ˜¯host-managerçš„ç”¨æˆ·--&gt;&lt;!--allows access to the HTML GUI--&gt;&lt;role rolename=&quot;admin-gui&quot;/&gt;&lt;!--allows access to the text interface--&gt;&lt;role rolename=&quot;adminâ€script&quot;/&gt;&lt;!--managerå¯¹åº”çš„æ˜¯managerçš„ç”¨æˆ·--&gt;&lt;!--allows access to the HTML GUI and the status pages--&gt;&lt;role rolename=&quot;manager-gui&quot;/&gt;&lt;!--allows access to the text interface and the status pages--&gt;&lt;role rolename=&quot;managerâ€script&quot;/&gt;&lt;!--allows access to the JMX proxy and the status pages--&gt;&lt;role rolename=&quot;manager-jmx&quot;/&gt;&lt;!--allows access to the status pages only--&gt;&lt;role rolename=&quot;manager-status&quot;/&gt;&lt;!--æˆ‘ä»¬è¿™é‡Œæ·»åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åå®šä¹‰è§’è‰²å³å¯--&gt;&lt;user username=&quot;tinychen&quot; password=&quot;tinychen#321&quot; roles=&quot;adminâ€gui,manager-gui&quot;/&gt; Users with the admin-gui role should not be granted the admin-script role. æ³¨æ„è¢«æˆäºˆadmin-guiæƒé™çš„ç”¨æˆ·ä¸åº”è¯¥æˆäºˆadmin-scriptæƒé™ Users with the manager-gui role should not be granted either the manager-script or manager-jmx roles. æ³¨æ„è¢«æˆäºˆmanager-guiæƒé™çš„ç”¨æˆ·ä¸åº”è¯¥æˆäºˆmanager-scriptæˆ–manager-jmxæƒé™ tomcat9ä¸­é»˜è®¤æ˜¯åªå…è®¸éƒ¨ç½²tomcatçš„æœºå™¨è®¿é—®mangerå’Œhost-managerçš„é¡µé¢çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¿®æ”¹tomcatç›®å½•ä¸‹å¯¹åº”çš„webåº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼š 12vim /home/tomcat9/webapps/host-manager/META-INF/context.xml vim /home/tomcat9/webapps/manager/META-INF/context.xml ç„¶åä¿®æ”¹é‡Œé¢é™åˆ¶çš„IPåœ°å€ä¸ºå…¨éƒ¨æˆ–è€…è‡ªå·±çš„IPåœ°å€å³å¯ã€‚ 12345678910&lt;Context antiResourceLocking=&quot;false&quot; privileged=&quot;true&quot; &gt; &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot; allow=&quot;127\\.\\d+\\.\\d+\\.\\d+|::1|0:0:0:0:0:0:0:1&quot; /&gt; &lt;Manager sessionAttributeValueClassNameFilter=&quot;java\\.lang\\.(?:Boolean|Integer|Long|Number|String)|org\\.apache\\.catalina\\.filters\\.CsrfPreventionFilter\\$LruCache(?:\\$1)?|java\\.util\\.(?:Linked)?HashMap&quot;/&gt;&lt;/Context&gt;# å°†allowå‚æ•°æ”¹ä¸º &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot; allow=&quot;^.*$&quot; /&gt; ç„¶åæˆ‘ä»¬å°±å¯ä»¥è®¿é—®webç•Œé¢æ¥æŸ¥çœ‹tomcatæœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€äº†ã€‚ managerçš„webç•Œé¢ host-managerçš„webç•Œé¢ 2ã€Tomcatçš„å®¹å™¨æ¶æ„Tomcatè®¾è®¡äº†4ç§å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯Engineã€Hostã€Contextå’ŒWrapperã€‚è¿™4ç§å®¹å™¨æ˜¯çˆ¶å­å…³ç³»ï¼Œ Tomcaté€šè¿‡ä¸€ç§åˆ†å±‚çš„æ¶æ„ï¼Œä½¿å¾—Servletå®¹å™¨å…·æœ‰å¾ˆå¥½çš„çµæ´»æ€§ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š ä¸€å°æœºå™¨ä¸Šå¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„CATALINA_BASEæ¥è¿è¡Œå¤šä¸ªtomcatå®ä¾‹ï¼Œå³å¯ä»¥è¿è¡Œå¤šä¸ªserver ä¸€ä¸ªserverä¸­åªæœ‰ä¸€ä¸ªEngineï¼Œè€ŒEngineå°±æ˜¯å®ç°äº†servletè§„èŒƒçš„å¼•æ“ï¼Œè¿™é‡Œå°±æ˜¯Catalina ä¸€ä¸ªengineä¸­å¯ä»¥åŒ…å«å¤šä¸ªhostï¼Œå³å’Œapacheã€nginxç­‰æœåŠ¡å™¨ç›¸åŒï¼Œå¯ä»¥é…ç½®å¤šä¸ªvirtual hostç«™ç‚¹ ä¸€ä¸ªhostä¸­å¯ä»¥åŒ…å«å¤šä¸ªcontextï¼Œå³å¯ä»¥åŒ…å«å¤šä¸ªwebåº”ç”¨ ä¸€ä¸ªwarpperè¡¨ç¤ºä¸€ä¸ªServletï¼Œwrapper ä½œä¸ºå®¹å™¨ä¸­çš„æœ€åº•å±‚ï¼Œä¸èƒ½åŒ…å«å­å®¹å™¨ Tomcatä½¿ç”¨ç»„åˆæ¨¡å¼æ¥ç®¡ç†è¿™äº›å®¹å™¨ï¼Œæ‰€æœ‰å®¹å™¨ç»„ä»¶éƒ½å®ç°äº†Containeræ¥å£ï¼Œå› æ­¤ç»„åˆæ¨¡å¼å¯ä»¥ä½¿å¾—ç”¨æˆ·å¯¹å•å®¹å™¨å¯¹è±¡ï¼ˆæœ€åº•å±‚çš„Wrapperï¼‰å’Œç»„åˆå®¹å™¨å¯¹è±¡ï¼ˆContextã€Hostæˆ–è€…Engineï¼‰çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚ Tomcat æœåŠ¡å™¨çš„é…ç½®ä¸»è¦é›†ä¸­äº tomcat/conf ä¸‹çš„ catalina.policyã€ catalina.propertiesã€context.xmlã€server.xmlã€tomcat-users.xmlã€web.xml æ–‡ä»¶ã€‚ Tomcatçš„è¿™ä¸€è®¾è®¡æ€æƒ³åœ¨å…¶é…ç½®æ–‡ä»¶server.xmlä¸­å¾—åˆ°äº†å¾ˆå¥½çš„è¯ é‡Šï¼Œserver.xml æ˜¯tomcat æœåŠ¡å™¨çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼ŒåŒ…å«äº†Tomcatçš„ Servlet å®¹å™¨ ï¼ˆCatalinaï¼‰çš„æ‰€æœ‰é…ç½®ã€‚ä¸‹é¢æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹server.xmlæ–‡ä»¶ä¸­çš„ä¸€äº›ä¸»è¦é…ç½®ã€‚ 3ã€server.xml3.1 server.xmlæ•´ä½“æ¶æ„é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“server.xmlä¸­çš„xmlä»£ç å—åˆ†ç±»ï¼Œtomcatå®˜ç½‘å°†å…¶ä¸»è¦åˆ†ä¸ºå››ç±»ï¼š Top Level Elementsï¼šserverå—æ˜¯æ•´ä¸ªé…ç½®æ–‡ä»¶çš„æ ¹å…ƒç´ ï¼Œè€Œserviceå—ä»£è¡¨ä¸å¼•æ“å…³è”çš„ä¸€ç»„è¿æ¥å™¨ï¼ˆconnectorï¼‰ã€‚ Connectors ï¼šè¡¨ç¤ºå¤–éƒ¨å®¢æˆ·ç«¯å‘ç‰¹å®šæœåŠ¡å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”çš„æ¥å£ï¼ˆæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„coyoteè¿æ¥å™¨ä»¥åŠå¯¹åº”çš„NIOç­‰IOæ¨¡å¼éƒ½æ˜¯æ•´ä¸ªèŒƒç•´å†…çš„æ¦‚å¿µï¼‰ã€‚ Containersï¼šå®¹å™¨ï¼ˆContainerï¼‰è´Ÿè´£å¤„ç†ä¼ å…¥çš„è¯·æ±‚å¹¶åˆ›å»ºç›¸åº”çš„å“åº”ã€‚Engineå¤„ç†å¯¹Serviceçš„æ‰€æœ‰è¯·æ±‚ï¼ŒHostå¤„ç†å¯¹ç‰¹å®švirtual hostçš„æ‰€æœ‰è¯·æ±‚ï¼Œè€ŒContextå¤„ç†å¯¹ç‰¹å®šWebåº”ç”¨ç¨‹åºçš„æ‰€æœ‰è¯·æ±‚ã€‚ Nested Componentsï¼šè¡¨ç¤ºå¯ä»¥åµŒå¥—åœ¨Containerå…ƒç´ å†…çš„å…ƒç´ ã€‚ æ³¨æ„ä¸€äº›å…ƒç´ å¯ä»¥åµŒå¥—åœ¨ä»»ä½•Containerä¸­ï¼Œè€Œå¦ä¸€äº›å…ƒç´ åªèƒ½åµŒå¥—åœ¨Contextä¸­ã€‚ 3.2 Top Level Elements3.2.1 Serverå—Serverå—ä»£è¡¨çš„æ˜¯æ•´ä¸ªcatalina servletå®¹å™¨ã€‚å› æ­¤ï¼Œå®ƒå¿…é¡»æ˜¯conf/server.xmlé…ç½®æ–‡ä»¶ä¸­æœ€å¤–é¢çš„å•ä¸ªå…ƒç´ ã€‚å®ƒçš„å±æ€§ä»£è¡¨äº†æ•´ä¸ªservletå®¹å™¨çš„ç‰¹å¾ã€‚Tomcat9ä¸­é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸­Serverå—å†…åµŒçš„å­å…ƒç´ ä¸º Listenerã€GlobalNamingResourcesã€Serviceï¼ˆå¯ä»¥åµŒå¥—å¤šä¸ªï¼‰ã€‚å…·ä½“çš„æ¯ä¸ªå±æ€§å‚æ•°æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢å®˜ç½‘ï¼Œä¸‹é¢è§£é‡Šé»˜è®¤çš„å‚æ•°é…ç½®ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt; &lt;!-- port ï¼š Tomcatç›‘å¬çš„å…³é—­æœåŠ¡å™¨çš„ç«¯å£ shutdown ï¼š å…³é—­æœåŠ¡å™¨çš„æŒ‡ä»¤å­—ç¬¦ä¸² --&gt; &lt;!-- ä»¥æ—¥å¿—å½¢å¼è¾“å‡ºæœåŠ¡å™¨ã€æ“ä½œç³»ç»Ÿã€JVMçš„ç‰ˆæœ¬ä¿¡æ¯ --&gt; &lt;Listener className=&quot;org.apache.catalina.startup.VersionLoggerListener&quot; /&gt; &lt;!-- å¯åŠ¨å’Œåœæ­¢APRã€‚å¦‚æœæ‰¾ä¸åˆ°APRåº“ä¼šè¾“å‡ºæ—¥å¿—ä½†å¹¶ä¸å½±å“tomcatæ­£å¸¸å¯åŠ¨ --&gt; &lt;Listener className=&quot;org.apache.catalina.core.AprLifecycleListener&quot; SSLEngine=&quot;off&quot; /&gt; &lt;!-- æ³¨æ„è¿™é‡Œçš„SSLEngineé»˜è®¤æ˜¯æ‰“å¼€çš„ï¼ˆonï¼‰ å¦‚æœå¯ç”¨äº†aprä½œä¸ºè¿æ¥å™¨çš„åè®® ä½†æ˜¯åªé…ç½®äº†httpè€Œæ²¡æœ‰é…ç½®https åˆ™ä¼šæŠ¥é”™ --&gt; &lt;!-- ç”¨äºé¿å…JREå†…å­˜æ³„æ¼é—®é¢˜ --&gt; &lt;Listener className=&quot;org.apache.catalina.core.JreMemoryLeakPreventionListener&quot; /&gt; &lt;!-- ç”¨æˆ·åŠ è½½ï¼ˆæœåŠ¡å™¨å¯åŠ¨ï¼‰å’Œé”€æ¯ï¼ˆæœåŠ¡å™¨åœæ­¢ï¼‰å…¨å±€å‘½åæœåŠ¡ --&gt; &lt;Listener className=&quot;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener&quot; /&gt; &lt;!-- ç”¨äºåœ¨Contextåœæ­¢æ—¶é‡å»ºExecutoræ± ä¸­çš„çº¿ç¨‹ï¼Œ ä»¥é¿å…ThreadLocalç›¸å…³çš„å†…å­˜æ³„æ¼ --&gt; &lt;Listener className=&quot;org.apache.catalina.core.ThreadLocalLeakPreventionListener&quot; /&gt; &lt;!-- GlobalNamingResourcesä¸­å®šä¹‰äº†å…¨å±€å‘½åæœåŠ¡ï¼š --&gt; &lt;GlobalNamingResources&gt; &lt;Resource name=&quot;UserDatabase&quot; auth=&quot;Container&quot; type=&quot;org.apache.catalina.UserDatabase&quot; description=&quot;User database that can be updated and saved&quot; factory=&quot;org.apache.catalina.users.MemoryUserDatabaseFactory&quot; pathname=&quot;conf/tomcat-users.xml&quot; /&gt; &lt;!--è¿™é‡Œå®šä¹‰çš„æ–‡ä»¶å°±æ˜¯æˆ‘ä»¬å‰é¢é…ç½®managerå’Œhost managerçš„ç”¨æˆ·çš„æ–‡ä»¶--&gt; &lt;/GlobalNamingResources&gt; &lt;Service&gt; ... &lt;/Service&gt; &lt;/Server&gt; 3.2.2 Serviceå— Serviceå…ƒç´ ç”¨äºåˆ›å»º Service å®ä¾‹ï¼Œé»˜è®¤ä½¿ç”¨ org.apache.catalina.core.StandardServiceã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒTomcat9ä¸­é»˜è®¤ä»…æŒ‡å®šäº†Serviceçš„åç§°ä¸ºCatalinaã€‚ 123&lt;Service name=&quot;Catalina&quot;&gt;...&lt;/Service&gt; Service å¯ä»¥å†…åµŒçš„å…ƒç´ ä¸º ï¼š Listenerã€Executorã€Connectorã€Engine ï¼Œè¯¦ç»†çš„å‚æ•°å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹å®˜ç½‘ Listener ç”¨äºä¸ºService æ·»åŠ ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨ Executor ç”¨äºé…ç½®Service å…±äº«çº¿ç¨‹æ±  Connector ç”¨äºé…ç½® Service åŒ…å«çš„é“¾æ¥å™¨ Engine ç”¨äºé…ç½®Serviceä¸­è¿æ¥å™¨ï¼ˆconnectorï¼‰å¯¹åº”çš„Servlet å®¹å™¨å¼•æ“ 3.3 Executorexecutorè¡¨ç¤ºå¯ç»„ä»¶ä¹‹é—´Tomcatä¸­å…±äº«çš„çº¿ç¨‹æ± ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒServiceå¹¶æœªæ·»åŠ å…±äº«çº¿ç¨‹æ± é…ç½®ã€‚executorå®ç°äº†tomcatä¸­çš„org.apache.catalina.Executoræ¥å£ã€‚ å¦‚æœä¸é…ç½®å…±äº«çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆCatalina å„ç»„ä»¶åœ¨ç”¨åˆ°çº¿ç¨‹æ± æ—¶ä¼šç‹¬ç«‹åˆ›å»ºã€‚ç”±äºexecutoræ˜¯Serviceå…ƒç´ çš„åµŒå¥—å…ƒç´ ã€‚ä¸ºäº†ä½¿å®ƒèƒ½å¤Ÿè¢«Connectorä½¿ç”¨ï¼ŒExecutorå…ƒç´ å¿…é¡»å‡ºç°åœ¨server.xmlä¸­çš„Connectorå…ƒç´ ä¹‹å‰ã€‚ä¸‹é¢å±•ç¤ºçš„æ˜¯ä¸€ä¸ªç®€å•çš„executorçš„é…ç½®ï¼Œå…·ä½“çš„é…ç½®å‚æ•°å¯ä»¥ç‚¹è¿™é‡ŒæŸ¥çœ‹å®˜ç½‘ï¼š 12345678910&lt;Executor name=&quot;tomcatThreadPool&quot; namePrefix=&quot;catalinaâ€execâ€&quot; maxThreads=&quot;200&quot; minSpareThreads=&quot;100&quot; maxIdleTime=&quot;60000&quot; maxQueueSize=&quot;Integer.MAX_VALUE&quot; prestartminSpareThreads=&quot;false&quot; threadPriority=&quot;5&quot; className=&quot;org.apache.catalina.core.StandardThreadExecutor&quot;/&gt; å±æ€§ å«ä¹‰ name çº¿ç¨‹æ± åç§°ï¼Œç”¨äºConnectorä¸­æŒ‡å®šã€‚ namePrefix æ‰€åˆ›å»ºçš„æ¯ä¸ªçº¿ç¨‹çš„åç§°å‰ç¼€ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹åç§°ä¸º namePrefix+threadNumberã€‚ daemon æ˜¯å¦ä½œä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼ˆç±»ä¼¼äºå®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œé»˜è®¤ä¸ºtrue maxThreads çº¿ç¨‹æ± ä¸­æœ€å¤§çº¿ç¨‹æ•°ã€‚ minSpareThreads æ´»è·ƒçº¿ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯æ ¸å¿ƒæ± çº¿ç¨‹æ•°ï¼Œè¿™äº›çº¿ç¨‹ä¸ä¼šè¢«é”€æ¯ï¼Œä¼šä¸€ç›´å­˜åœ¨ã€‚ maxIdleTime çº¿ç¨‹ç©ºé—²æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´åï¼Œç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ï¼Œé»˜ è®¤å€¼ä¸º6000ï¼ˆ1åˆ†é’Ÿï¼‰ï¼Œå•ä½æ¯«ç§’ã€‚ maxQueueSize åœ¨è¢«æ‰§è¡Œå‰æœ€å¤§çº¿ç¨‹æ’é˜Ÿæ•°ç›®ï¼Œé»˜è®¤ä¸ºintçš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯å¹¿ä¹‰çš„æ— é™ã€‚é™¤éç‰¹æ®Šæƒ…å†µï¼Œè¿™ä¸ªå€¼ä¸éœ€è¦æ›´æ”¹ï¼Œ å¦åˆ™ä¼šæœ‰è¯·æ±‚ä¸ä¼šè¢«å¤„ç†çš„æƒ…å†µå‘ç”Ÿã€‚ prestartminSpareThreads å¯åŠ¨çº¿ç¨‹æ± æ—¶æ˜¯å¦å¯åŠ¨ minSpareThreadséƒ¨åˆ†çº¿ç¨‹ã€‚ é»˜è®¤å€¼ä¸ºfalseï¼Œå³ä¸å¯åŠ¨ã€‚ threadPriority çº¿ç¨‹æ± ä¸­çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé»˜è®¤å€¼ä¸º5ï¼Œå€¼ä»1åˆ°10ã€‚ className çº¿ç¨‹æ± å®ç°ç±»ï¼ŒæœªæŒ‡å®šæƒ…å†µä¸‹ï¼Œé»˜è®¤å®ç°ç±»ä¸º org.apache.catalina.core.StandardThreadExecutorã€‚ å¦‚æœæƒ³ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± é¦–å…ˆéœ€è¦å®ç° org.apache.catalina.Executoræ¥å£ã€‚ 3.4 ConnectorConnector ç”¨äºåˆ›å»ºé“¾æ¥å™¨å®ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œserver.xml é…ç½®äº†ä¸¤ä¸ªé“¾æ¥å™¨ï¼Œä¸€ä¸ªæ”¯ æŒHTTPåè®®ï¼Œä¸€ä¸ªæ”¯æŒAJPåè®®ã€‚å› æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ–°å¢é“¾æ¥å™¨é…ç½®ï¼Œ åªæ˜¯æ ¹æ®éœ€è¦å¯¹å·²æœ‰é“¾æ¥å™¨è¿›è¡Œä¼˜åŒ–ã€‚ 123&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot;redirectPort=&quot;8443&quot; /&gt;&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt; portä¸ºç›‘å¬çš„ç«¯å£ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼ŒTomcatå°†ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ç«¯å£å·ç»™å½“å‰Connector ä½¿ç”¨ protocolä¸ºConnectorçš„åè®®ï¼Œè¿™é‡Œé»˜è®¤çš„æ˜¯HTTPå’ŒAJPä¸¤ç§åè®®ï¼Œåé¢å¯ä»¥æŒ‡å®šå¯¹åº”åè®®çš„ä¸åŒç‰ˆæœ¬ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæ£€æµ‹æœ¬æœºæ˜¯å¦é…ç½®äº†APRåº“ï¼Œå¦‚æœæœ‰å¹¶ä¸” useAprConnectorè®¾ç½®ä¸ºtrueåˆ™ä¼šé»˜è®¤ä½¿ç”¨APRæ¨¡å¼çš„IOåè®®ï¼Œå¦‚æœæ— åˆ™ä¼šä½¿ç”¨NIOæ¨¡å¼ connectionTimeOut ï¼šConnector æ¥æ”¶é“¾æ¥åçš„ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚ -1è¡¨ç¤ºæ°¸ä¸è¶…æ—¶ redirectPortï¼šå½“å‰Connector ä¸æ”¯æŒSSLè¯·æ±‚ï¼Œ æ¥æ”¶åˆ°äº†ä¸€ä¸ªè¯·æ±‚ï¼Œ å¹¶ä¸”ä¹Ÿç¬¦åˆ security-constraint çº¦æŸï¼Œ éœ€è¦SSLä¼ è¾“ï¼ŒCatalinaè‡ªåŠ¨å°†è¯·æ±‚é‡å®šå‘åˆ°æŒ‡å®šçš„ç«¯å£ executor ï¼š æŒ‡å®šå‰é¢æåˆ°çš„å…±äº«çº¿ç¨‹æ± çš„åç§°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡maxThreadsã€minSpareThreads ç­‰å±æ€§å¯¹è¯¥connectorè¿›è¡Œå•ç‹¬é…ç½®å¯¹åº”çš„å†…éƒ¨çº¿ç¨‹æ±  URIEncoding : ç”¨äºæŒ‡å®šç¼–ç URIçš„å­—ç¬¦ç¼–ç ï¼Œ Tomcat8.xå’ŒTomcat9.xç‰ˆæœ¬é»˜è®¤çš„ç¼–ç ä¸º UTF-8 , Tomcat7.xç‰ˆæœ¬é»˜è®¤ä¸ºISO-8859-1 3.5 engineEngine ä½œä¸ºServlet å¼•æ“çš„é¡¶çº§å…ƒç´ ï¼Œå†…éƒ¨å¯ä»¥åµŒå…¥ï¼š Clusterã€Listenerã€Realmã€ Valveå’ŒHostã€‚ 123&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt; â€¦â€¦&lt;/Engine&gt; nameï¼šç”¨äºæŒ‡å®šEngine çš„åç§°ï¼Œ é»˜è®¤ä¸ºCatalina defaultHostï¼šé»˜è®¤ä½¿ç”¨çš„è™šæ‹Ÿä¸»æœºåç§°ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è®¿é—®çš„hostæ— æ•ˆæ—¶ï¼Œä¼šè·³è½¬åˆ°é»˜è®¤çš„hostæ¥å¤„ç†è¯·æ±‚ 3.6 HostHost å…ƒç´ ç”¨äºé…ç½®ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå®ƒæ”¯æŒä»¥ä¸‹åµŒå…¥å…ƒç´ ï¼šAliasã€Clusterã€Listenerã€ Valveã€Realmã€Context å¦‚æœåœ¨Engineä¸‹é…ç½®Realmï¼Œé‚£ä¹ˆæ­¤é…ç½®å°†åœ¨å½“å‰Engineä¸‹çš„æ‰€æœ‰Hostä¸­å…±äº«ã€‚ åŒæ ·ï¼Œå¦‚æœåœ¨Hostä¸­é…ç½®Realm ï¼Œåˆ™åœ¨å½“å‰Hostä¸‹çš„æ‰€æœ‰Context ä¸­å…±äº« Contextä¸­çš„Realmä¼˜å…ˆçº§ &gt; Hostçš„Realmä¼˜å…ˆçº§ &gt; Engineä¸­çš„Realmä¼˜å…ˆçº§ 12345678&lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt; &lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot; prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot; pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt; &lt;Alias&gt;www.example.com&lt;/Alias&gt; &lt;Alias&gt;www.example2.com&lt;/Alias&gt;&lt;/Host&gt; ä¸Šé¢è¿™ä¸€æ®µHostçš„é…ç½®æ–‡ä»¶ä¸­è¿˜é¢å¤–æ·»åŠ äº†Valveé…ç½®æ¥å®ç°è‡ªå®šä¹‰çš„æ—¥å¿—è®°å½•ã€‚å…¶ä¸­ä¸€äº›å‚æ•°çš„è¯¦ç»†ä¿¡æ¯å’Œé…ç½®æ–¹å¼å¯ä»¥æŸ¥çœ‹å®˜ç½‘çš„è¯´æ˜ã€‚ The shorthand pattern pattern=&quot;common&quot; corresponds to the Common Log Format defined by â€˜%h %l %u %t â€œ%râ€ %s %bâ€™. name: å½“å‰Hosté€šç”¨çš„ç½‘ç»œåç§°ï¼Œä¹Ÿå°±æ˜¯å¸¸ç”¨çš„åŸŸåï¼Œå¦‚æœæœ‰å¤šä¸ªåŸŸåå¯¹åº”åŒä¸€ä¸ªHostçš„åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªAliasæ¥å®ç°è®¿é—® appBaseï¼šå½“å‰Hoståº”ç”¨å¯¹åº”çš„ç›®å½•ï¼Œå½“å‰Hostä¸Šéƒ¨ç½²çš„Webåº”ç”¨å‡åœ¨è¯¥ç›®å½•ä¸‹ï¼ˆç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„å‡å¯ï¼‰ï¼Œé»˜è®¤ä¸ºwebapps unpackWARsï¼šè®¾ç½®ä¸ºtrueï¼ŒHoståœ¨å¯åŠ¨æ—¶ä¼šå°†appBaseç›®å½•ä¸‹waråŒ…è§£å‹ä¸ºç›® å½•ã€‚è®¾ç½®ä¸ºfalseï¼ŒHostå°†ç›´æ¥ä»waræ–‡ä»¶å¯åŠ¨ autoDeployï¼š æ§åˆ¶tomcatæ˜¯å¦åœ¨è¿è¡Œæ—¶å®šæœŸæ£€æµ‹å¹¶è‡ªåŠ¨éƒ¨ç½²æ–°å¢æˆ–å˜æ›´çš„webåº”ç”¨ 3.7 ContextContextçš„å®Œæ•´é…ç½®å®˜ç½‘æ–‡æ¡£ï¼ŒContext ç”¨äºé…ç½®ä¸€ä¸ªWebåº”ç”¨ï¼Œé»˜è®¤çš„é…ç½®å¦‚ä¸‹ã€‚å®ƒæ”¯æŒçš„å†…åµŒå…ƒç´ ä¸ºï¼šCookieProcessorï¼ŒLoaderï¼ŒManagerï¼ŒRealmï¼ŒResourcesï¼ŒWatchedResourceï¼ŒJarScannerï¼ŒValveã€‚ 123456&lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt; &lt;Context docBase=&quot;myAppDeploy&quot; path=&quot;/myApp&quot;&gt; .... &lt;/Context&gt;&lt;/Host&gt; docBaseï¼šWebåº”ç”¨ç›®å½•æˆ–è€…WaråŒ…çš„éƒ¨ç½²è·¯å¾„ã€‚å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºè¯¥Contextæ‰€å±çš„Hostä¸­çš„appBaseçš„ç›¸å¯¹è·¯å¾„ã€‚ pathï¼šWebåº”ç”¨çš„Contextçš„è®¿é—®è·¯å¾„ã€‚ å‡è®¾tomcatçš„å®‰è£…ç›®å½•ä¸º/home/tomcat9ï¼ŒHostä¸ºé»˜è®¤çš„localhostï¼Œ åˆ™è¯¥webåº”ç”¨è®¿é—®çš„æ ¹è·¯å¾„ä¸ºï¼š http://localhost:8080/myAppï¼Œå¯¹åº”çš„éƒ¨ç½²æ–‡ä»¶æ‰€å­˜æ”¾çš„è·¯å¾„ä¸ºï¼š/home/tomcat9/webapps/myAppDeployã€‚","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://tinychen.com/tags/tomcat/"}]},{"title":"LVSä¸‰ç§æ¨¡å¼çš„å·¥ä½œåŸç†","slug":"20200427-lvs-principle-introduction","date":"2020-04-27T02:00:00.000Z","updated":"2020-04-27T02:00:00.000Z","comments":true,"path":"20200427-lvs-principle-introduction/","link":"","permalink":"https://tinychen.com/20200427-lvs-principle-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬LVSä¸‰ç§æ¨¡å¼çš„åŸºæœ¬å·¥ä½œåŸç†ä»‹ç»å’Œå¯èƒ½æ¶‰åŠçš„ARPé—®é¢˜åŸç†ã€‚","text":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬LVSä¸‰ç§æ¨¡å¼çš„åŸºæœ¬å·¥ä½œåŸç†ä»‹ç»å’Œå¯èƒ½æ¶‰åŠçš„ARPé—®é¢˜åŸç†ã€‚ 1ã€LVSç®€ä»‹1.1 LVSèµ·æºLVSæ˜¯Linux Virtual Serverçš„ç®€ç§°ï¼Œä¹Ÿå«Linuxè™šæ‹ŸæœåŠ¡å™¨, ä¹Ÿå°±æ˜¯ç°åœ¨å¸¸è¯´çš„å››å±‚è´Ÿè½½å‡è¡¡ã€‚ å®ƒæ˜¯ä¸€ä¸ªç”±ç« æ–‡åµ©åšå£«å‘èµ·çš„è‡ªç”±è½¯ä»¶é¡¹ç›®ã€‚ç°åœ¨LVSå·²ç»æ˜¯ Linuxæ ‡å‡†å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨Linux2.4å†…æ ¸ä»¥å‰ï¼Œä½¿ç”¨LVSæ—¶å¿…é¡»è¦é‡æ–°ç¼–è¯‘å†…æ ¸ä»¥æ”¯æŒLVSåŠŸèƒ½æ¨¡å—ï¼Œä½†æ˜¯ä»Linux2.4å†…æ ¸ä»¥åï¼Œå·²ç»å®Œå…¨å†…ç½®äº†LVSçš„å„ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œæ— éœ€ç»™å†…æ ¸æ‰“ä»»ä½•è¡¥ä¸ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨LVSæä¾›çš„å„ç§åŠŸèƒ½ã€‚ 1.2 LVSå¸¸ç”¨åè¯æ¦‚å¿µ loadbalanceï¼šLoad Balancerï¼Œè´Ÿè½½å‡è¡¡å™¨ï¼Œè¿è¡ŒLVSè´Ÿè´£è´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨ DSï¼šDirector Serverï¼ŒæŒ‡çš„æ˜¯å‰ç«¯è´Ÿè½½å‡è¡¡å™¨èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¿è¡ŒLVSçš„æœåŠ¡å™¨ï¼› RSï¼šReal Serverï¼Œåç«¯çœŸå®çš„å·¥ä½œæœåŠ¡å™¨ï¼› VIPï¼šVirtual Server IPï¼Œå‘å¤–éƒ¨ç›´æ¥é¢å‘ç”¨æˆ·è¯·æ±‚ï¼Œä½œä¸ºç”¨æˆ·è¯·æ±‚çš„ç›®æ ‡çš„IPåœ°å€ï¼Œä¸€èˆ¬ä¹Ÿæ˜¯DSçš„å¤–éƒ¨IPåœ°å€ï¼› DIPï¼šDirector Server IPï¼Œä¸»è¦ç”¨äºå’Œå†…éƒ¨ä¸»æœºé€šè®¯çš„IPåœ°å€ï¼Œä¸€èˆ¬ä¹Ÿæ˜¯DSçš„å†…éƒ¨IPåœ°å€ï¼› RIPï¼šReal Server IPï¼Œåç«¯æœåŠ¡å™¨çš„IPåœ°å€ï¼› CIPï¼šClient IPï¼Œè®¿é—®å®¢æˆ·ç«¯çš„IPåœ°å€ï¼› 2ã€LVSåŸºæœ¬åŸç†ä¸€èˆ¬è¯´çš„LVSé›†ç¾¤æŒ‡çš„æ˜¯å¯¹äºå®¢æˆ·ç«¯æ¥è¯´çš„ä¸€ä¸ªå¤§å‹å¿«é€Ÿå¯é é«˜å¯ç”¨çš„æœåŠ¡å™¨é›†ç¾¤ã€‚LVSçš„æ ¸å¿ƒæ˜¯åœ¨LVS directorä¸Šçš„Linuxå†…æ ¸ä¸­çš„ip_vså†…æ ¸æ¨¡å— å¯¹äºLVSé›†ç¾¤ä¸­çš„Director Serverï¼ˆä»¥ä¸‹ç®€ç§°DSï¼‰æ¥è¯´ï¼š LVSå±äºå››å±‚è´Ÿè½½å‡è¡¡ï¼ŒDSå±äºå››å±‚äº¤æ¢ï¼Œå®ƒåœ¨ç½‘ç»œä¸­æ˜¾ç¤ºä¸ºè·¯ç”±å™¨ï¼Œå…¶è§„åˆ™ä¸æ™®é€šè·¯ç”±å™¨ç•¥æœ‰ä¸åŒï¼› DSæ¥å—ä»å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸”ä»åç«¯ï¼ˆbackendï¼‰çš„çœŸå®æœåŠ¡å™¨RSä¸­æŒ‘é€‰ä¸€ä¸ªç”¨æ¥å¤„ç†è¯·æ±‚ï¼› RSå¯ä»¥æä¾›æ­£å¸¸äº’è”ç½‘æœåŠ¡ä¸­çš„ä»»ä½•æœåŠ¡ï¼Œå› ä¸ºLVSæ˜¯å››å±‚è½¬å‘ï¼Œå…¼å®¹æ€§å¾ˆå¥½ï¼Œå¯¹ä¸šåŠ¡æ— ä¾µå…¥æ€§ï¼› RSå¯ä»¥åœ¨å®¢æˆ·ç«¯æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹æ·»åŠ æˆ–åˆ é™¤åˆ°LVSé›†ç¾¤ä¸­ï¼Œå› æ­¤å…è®¸åç«¯çš„RSå‡ºç°å®•æœºã€å‡çº§ã€å¼¹æ€§ä¼¸ç¼©ã€‚ åœ¨è°ƒåº¦å™¨çš„å®ç°æŠ€æœ¯ä¸­ï¼ŒIPè´Ÿè½½å‡è¡¡æŠ€æœ¯æ˜¯æ•ˆç‡æœ€é«˜çš„ã€‚åœ¨å·²æœ‰çš„IPè´Ÿè½½å‡è¡¡æŠ€æœ¯ä¸­æœ‰é€šè¿‡ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNetwork Address Translationï¼‰å°†ä¸€ç»„æœåŠ¡å™¨æ„æˆä¸€ä¸ªé«˜æ€§èƒ½çš„ã€é«˜å¯ç”¨çš„è™šæ‹ŸæœåŠ¡å™¨ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºVS/NATæŠ€æœ¯ï¼ˆVirtual Server via Network Address Translationï¼‰ï¼Œåœ¨åˆ†æVS/NATçš„ç¼ºç‚¹å’Œç½‘ç»œæœåŠ¡çš„éå¯¹ç§°æ€§çš„åŸºç¡€ä¸Šï¼ŒLVSæå‡ºé€šè¿‡IPéš§é“å®ç°è™šæ‹ŸæœåŠ¡å™¨çš„æ–¹æ³•VS/TUN ï¼ˆVirtual Server via IP Tunnelingï¼‰ï¼Œå’Œé€šè¿‡ç›´æ¥è·¯ç”±å®ç°è™šæ‹ŸæœåŠ¡å™¨çš„æ–¹æ³•VS/DRï¼ˆVirtual Server via Direct Routingï¼‰ï¼Œå®ƒä»¬å¯ä»¥æå¤§åœ°æé«˜ç³»ç»Ÿçš„ä¼¸ç¼©æ€§ã€‚æ‰€ä»¥ï¼ŒIPVSè½¯ä»¶å®ç°äº†è¿™ä¸‰ç§IPè´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œå®ƒä»¬çš„å¤§è‡´åŸç†å¦‚ä¸‹ 3ã€LVS NATæ¨¡å¼NATæ¨¡å¼çš„ä¸»è¦å®ç°åŸç†æ˜¯é€šè¿‡ç½‘ç»œåœ°å€è½¬æ¢ï¼ŒLBé‡å†™è¯·æ±‚æŠ¥æ–‡çš„ç›®æ ‡åœ°å€(åŒ…æ‹¬IPå’ŒMAC)ï¼Œæ ¹æ®é¢„è®¾çš„è°ƒåº¦ç®—æ³•ï¼Œå°†è¯·æ±‚åˆ†æ´¾ç»™åç«¯çš„RSï¼›RSçš„å“åº”æŠ¥æ–‡é€šè¿‡LBè¿”å›æ—¶ï¼ŒæŠ¥æ–‡çš„æºåœ°å€è¢«é‡å†™ï¼Œä¿®æ”¹ä¸ºLBçš„MACå’ŒIPï¼Œå†è¿”å›ç»™å®¢æˆ·ï¼Œå®Œæˆæ•´ä¸ªè´Ÿè½½è°ƒåº¦è¿‡ç¨‹ã€‚ å½“ç”¨æˆ·è®¿é—®æœåŠ¡å™¨ç¾¤é›†æä¾›çš„æœåŠ¡æ—¶ï¼Œå‘å¾€è™šæ‹ŸæœåŠ¡å™¨IPï¼ˆVIP/LBçš„å¤–éƒ¨IPåœ°å€ï¼‰çš„æ•°æ®åŒ…å°†åˆ°è¾¾LB LBæ£€æŸ¥æ•°æ®åŒ…çš„ç›®æ ‡åœ°å€å’Œç«¯å£å·ã€‚å¦‚æœç¬¦åˆåœ¨LVSçš„è§„åˆ™è¡¨ä¸­å®šä¹‰æ·»åŠ çš„æœåŠ¡ï¼Œåˆ™æ ¹æ®è°ƒåº¦ç®—æ³•ä»åç«¯ç¾¤é›†ä¸­é€‰æ‹©ä¸€ä¸ªRSï¼Œå¹¶å°†è¯¥è¿æ¥æ·»åŠ åˆ°è®°å½•å·²å»ºç«‹è¿æ¥çš„å“ˆå¸Œè¡¨ä¸­ ç„¶åï¼Œå°†æ•°æ®åŒ…çš„ç›®æ ‡åœ°å€å’Œç«¯å£é‡å†™ä¸ºæ‰€é€‰RSçš„åœ°å€å’Œç«¯å£ï¼Œç„¶åå°†æ•°æ®åŒ…è½¬å‘åˆ°RS å½“ä¼ å…¥çš„æ•°æ®åŒ…ç¬¦åˆåœ¨LVSçš„è§„åˆ™è¡¨ä¸­å®šä¹‰æ·»åŠ çš„æœåŠ¡å¹¶ä¸”å¯ä»¥åœ¨å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°æ‰€é€‰çš„RSæ—¶ï¼Œè¯¥æ•°æ®åŒ…å°†è¢«é‡å†™å¹¶ç›´æ¥è½¬å‘åˆ°æ‰€é€‰çš„RS å½“RSå¤„ç†å®Œè¯·æ±‚ä¹‹åï¼Œä¼šæŠŠå›å¤æ•°æ®åŒ…è¿”å›ç»™LBï¼Œæ­¤æ—¶LBä¼šå°†æ•°æ®åŒ…çš„æºåœ°å€å’Œç«¯å£é‡å†™ä¸ºè™šæ‹ŸæœåŠ¡çš„æºåœ°å€å’Œç«¯å£ï¼Œç„¶åå‘é€ç»™å®¢æˆ·ç«¯ è¿æ¥ç»ˆæ­¢æˆ–è¶…æ—¶åï¼Œè¿æ¥è®°å½•å°†åœ¨å“ˆå¸Œè¡¨ä¸­åˆ é™¤ LVSçš„NATæ¨¡å¼éœ€è¦å¼€å¯LBçš„å†…æ ¸ä¸­çš„ip_forwardåŠŸèƒ½ 1echo 1 &gt; /proc/sys/net/ipv4/ip_forward 4ã€LVS via IP Tunneling(TUN)é‡‡ç”¨NATæŠ€æœ¯æ—¶ï¼Œè™½ç„¶å¯¹äºå®¢æˆ·ç«¯æ¥è¯´æ•´ä¸ªæœåŠ¡å™¨é›†ç¾¤ä¸­çš„LVSè´Ÿè½½å‡è¡¡è¿‡ç¨‹æ˜¯æ— æ„Ÿçš„ï¼ˆå› ä¸ºå¯¹äºå®¢æˆ·ç«¯æ¥è¯´è¯·æ±‚åŒ…å‘é€çš„ç›®æ ‡IPå’Œå“åº”åŒ…è¿”å›çš„æºIPéƒ½æ²¡æœ‰æ”¹å˜ï¼‰ï¼Œä½†æ˜¯ç”±äºè¯·æ±‚å’Œå“åº”æŠ¥æ–‡éƒ½å¿…é¡»ç»è¿‡LBè¿›è¡Œé‡å†™ï¼Œå½“å®¢æˆ·è¯·æ±‚è¶Šæ¥è¶Šå¤šæ—¶ï¼ŒLBçš„å¤„ç†èƒ½åŠ›å°†æˆä¸ºæ•´ä¸ªé›†ç¾¤ä¸­çš„ç“¶é¢ˆã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒLBæŠŠè¯·æ±‚æŠ¥æ–‡é€šè¿‡IPéš§é“è½¬å‘è‡³RSï¼Œè€ŒRSå°†å“åº”ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥LBåªéœ€è¦å¤„ç†è¯·æ±‚æŠ¥æ–‡ã€‚ç”±äºä¸€èˆ¬ç½‘ç»œæœåŠ¡åº”ç­”çš„æ•°æ®åŒ…è¦æ¯”è¯·æ±‚æ•°æ®åŒ…å¤§è®¸å¤šï¼Œé‡‡ç”¨ VS/TUNæŠ€æœ¯åï¼Œé›†ç¾¤ç³»ç»Ÿçš„æœ€å¤§ååé‡å¯ä»¥å¤§å¤§æé«˜ã€‚ å®¢æˆ·ç«¯è¯·æ±‚LVSé›†ç¾¤æä¾›çš„æœåŠ¡ï¼Œæ•°æ®åŒ…å‘é€åˆ°VIP LBæ£€æŸ¥æ•°æ®åŒ…çš„ç›®çš„åœ°å€å’Œç«¯å£ï¼Œå¦‚æœç¬¦åˆåœ¨LVSçš„è§„åˆ™è¡¨ä¸­å®šä¹‰æ·»åŠ çš„æœåŠ¡ï¼Œåˆ™æ ¹æ®è°ƒåº¦ç®—æ³•ä»åç«¯ç¾¤é›†ä¸­é€‰æ‹©ä¸€ä¸ªRSï¼Œå¹¶å°†è¯¥è¿æ¥æ·»åŠ åˆ°è®°å½•å·²å»ºç«‹è¿æ¥çš„å“ˆå¸Œè¡¨ä¸­ LBå¯¹è¯·æ±‚çš„æ•°æ®åŒ…è¿›è¡Œå°è£…ï¼Œåœ¨VIPå¤–é¢å†å°è£…ä¸€å±‚ç›®æ ‡RSçš„IPåœ°å€ï¼Œç„¶åå°†å®ƒå‘é€åˆ°å¯¹åº”çš„RSä¸Š å½“ä¼ å…¥çš„æ•°æ®åŒ…ç¬¦åˆåœ¨LVSçš„è§„åˆ™è¡¨ä¸­å®šä¹‰æ·»åŠ çš„æœåŠ¡å¹¶ä¸”å¯ä»¥åœ¨å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°æ‰€é€‰çš„RSæ—¶ï¼Œè¯¥æ•°æ®åŒ…å°†è¢«ç›´æ¥å°è£…IPå¹¶è½¬å‘åˆ°æ‰€é€‰çš„RS RSæ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œå¯¹å…¶è¿›è¡Œè§£å°å¹¶ä¸”å¤„ç†è¯·æ±‚ï¼Œç„¶åå°†å“åº”æ•°æ®åŒ…ç›´æ¥å‘é€åˆ°å®¢æˆ·ç«¯ è¿æ¥ç»ˆæ­¢æˆ–è¶…æ—¶åï¼Œè¿æ¥è®°å½•å°†åœ¨å“ˆå¸Œè¡¨ä¸­åˆ é™¤ æ³¨æ„åœ¨è¿™ç§æ¨¡å¼ä¸‹çš„RSå¯ä»¥æ˜¯åœ¨ç‰©ç†ä½ç½®ä¸Šåˆ†ç¦»çš„æœåŠ¡å™¨ï¼ˆå¦‚å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒåœ°åŒºçš„æœºæˆ¿ï¼‰ï¼Œåªè¦æ‹¥æœ‰åœ¨ä»»æ„ç½‘ç»œä¸­çš„ä»»æ„çœŸå®IPå³å¯ï¼ˆç›¸å¯¹VIPè€Œè¨€ï¼‰ã€‚æ­¤å¤–ï¼Œæ­¤æ—¶çš„RSéœ€è¦æ”¯æŒIPå°è£…åè®®å¹¶ä¸”éœ€è¦å’ŒLBç›´æ¥é…ç½®å¥½IPéš§é“ï¼ŒåŒæ—¶VIPéœ€è¦é…ç½®åˆ°éARPå“åº”çš„ç½‘å¡è®¾å¤‡ä¸Šã€‚ éœ€è¦LBå’ŒRSä¸Šé¢çš„æœåŠ¡ä½¿ç”¨çš„ç«¯å£å¿…é¡»ä¿æŒä¸€è‡´ï¼Œå› æ­¤åœ¨æ·»åŠ é…ç½®è§„åˆ™çš„æ—¶å€™æ— éœ€æŒ‡å®šRSçš„ç«¯å£ã€‚ Note that the services running on the real servers must run on the same port as virtual service, so it is not necessary to specify the service port on the real servers. 5ã€LVS via Direct Routing(DR)VS/DRé€šè¿‡æ”¹å†™è¯·æ±‚æŠ¥æ–‡çš„MACåœ°å€ï¼Œå°†è¯·æ±‚å‘é€åˆ°RSï¼Œè€ŒRSå°†å“åº”ç›´æ¥è¿”å›ç»™å®¢æˆ·ã€‚å’ŒVS/TUNæŠ€æœ¯ä¸€æ ·ï¼ŒVS/DRæŠ€æœ¯å¯æå¤§åœ°æé«˜é›†ç¾¤ç³»ç»Ÿçš„ä¼¸ç¼©æ€§ã€‚è¿™ç§æ–¹æ³•æ²¡æœ‰IPéš§é“çš„å¼€é”€ï¼Œå¯¹é›†ç¾¤ä¸­çš„RSä¹Ÿæ²¡æœ‰å¿…é¡»æ”¯æŒIPéš§é“åè®®çš„è¦æ±‚ï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨çš„æ˜¯MACåœ°å€è¿›è¡ŒäºŒå±‚è½¬å‘ï¼Œæ‰€ä»¥è¦æ±‚LBå’ŒRSéƒ½æœ‰ä¸€å—ç½‘å¡è¿åœ¨åŒä¸€ç‰©ç†ç½‘æ®µä¸Šã€‚ å®¢æˆ·ç«¯è¯·æ±‚LVSé›†ç¾¤æä¾›çš„æœåŠ¡ï¼Œæ•°æ®åŒ…å‘é€åˆ°VIP LBæ£€æŸ¥æ•°æ®åŒ…çš„ç›®çš„åœ°å€å’Œç«¯å£ï¼Œå¦‚æœç¬¦åˆåœ¨LVSçš„è§„åˆ™è¡¨ä¸­å®šä¹‰æ·»åŠ çš„æœåŠ¡ï¼Œåˆ™æ ¹æ®è°ƒåº¦ç®—æ³•ä»åç«¯ç¾¤é›†ä¸­é€‰æ‹©ä¸€ä¸ªRSï¼Œå¹¶å°†è¯¥è¿æ¥æ·»åŠ åˆ°è®°å½•å·²å»ºç«‹è¿æ¥çš„å“ˆå¸Œè¡¨ä¸­ LBå¯¹è¯·æ±‚çš„æ•°æ®åŒ…è¿›è¡Œå°è£…ï¼Œåœ¨VIPå¤–é¢å†å°è£…ä¸€å±‚ç›®æ ‡RSçš„MACåœ°å€ï¼Œç„¶åå°†å®ƒå‘é€åˆ°å¯¹åº”çš„RSä¸Š å½“ä¼ å…¥çš„æ•°æ®åŒ…ç¬¦åˆåœ¨LVSçš„è§„åˆ™è¡¨ä¸­å®šä¹‰æ·»åŠ çš„æœåŠ¡å¹¶ä¸”å¯ä»¥åœ¨å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°æ‰€é€‰çš„RSæ—¶ï¼Œè¯¥æ•°æ®åŒ…å°†è¢«ç›´æ¥å°è£…IPå¹¶è½¬å‘åˆ°æ‰€é€‰çš„RS ç”±äºRSçš„æœ¬åœ°loæ¥å£ä¸Šé¢ç»‘å®šäº†VIPï¼Œä¸”è¿™æ—¶MACåœ°å€æ˜¯RSè‡ªèº«çš„MACåœ°å€ï¼Œæ‰€ä»¥RSæ¥æ”¶åˆ°æ•°æ®åŒ…åä¼šå¤„ç†è¯·æ±‚ï¼Œç„¶åå°†å“åº”æ•°æ®åŒ…ç›´æ¥å‘é€åˆ°å®¢æˆ·ç«¯ è¿æ¥ç»ˆæ­¢æˆ–è¶…æ—¶åï¼Œè¿æ¥è®°å½•å°†åœ¨å“ˆå¸Œè¡¨ä¸­åˆ é™¤ ç”±äºLBåªæ˜¯ç®€å•åœ°å¯¹æ•°æ®åŒ…çš„MACåœ°å€æ›´æ”¹ä¸ºRSçš„MACåœ°å€å¹¶ä¸”å°†å…¶é‡æ–°å‘é€åˆ°å±€åŸŸç½‘ä¸­ï¼Œæ‰€ä»¥è¦æ±‚LBå’ŒRSå¿…é¡»è¦åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ä¸­ï¼Œè¿™æ ·æ‰èƒ½ç›´æ¥åˆ©ç”¨MACæ¥è¿›è¡ŒäºŒå±‚ä¼ è¾“ã€‚ æ³¨æ„DRæ¨¡å¼ä¹ŸåŒæ ·ä¸æ”¯æŒæŒ‡å®šRSçš„æœåŠ¡ç«¯å£ï¼Œå› æ­¤LBå’ŒRSçš„ç«¯å£ä¹Ÿå¿…é¡»ä¿æŒä¸€è‡´ã€‚ 6ã€ARP in LVSç»†å¿ƒè§‚å¯Ÿä¸Šé¢çš„DRæ¨¡å¼ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼š LBæŠŠæ•°æ®åŒ…å‘é€ç»™RSçš„æ—¶å€™åªä¿®æ”¹äº†MACï¼Œå°½ç®¡åœ¨äº¤æ¢æœºä¸Šä¼šæ ¹æ®MACç›´æ¥æŠŠåŒ…å‘é€ç»™RSï¼Œä½†æ˜¯RSåœ¨æ¥å—åˆ°æ•°æ®åŒ…ä¹‹åè¿˜æ˜¯ä¼šæ£€æŸ¥æ•°æ®åŒ…çš„ç›®çš„IPå’Œç«¯å£ï¼Œæ­¤æ—¶æ•°æ®åŒ…çš„ç›®çš„IPä¾æ—§æ˜¯VIPã€‚æ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦åœ¨RSçš„ç½‘å¡ä¸Šé¢ä¹Ÿç»‘å®šVIPçš„åŸå› ã€‚ï¼ˆä¸€èˆ¬ç»‘å®šåœ¨loopbackæ¥å£ï¼‰ é‚£ä¹ˆå½“LBå’ŒRSéƒ½ç»‘å®šäº†VIPçš„æ—¶å€™ï¼Œé—®é¢˜åˆæ¥äº†ï¼š å½“å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°æ®åŒ…ä¼ åˆ°LVSé›†ç¾¤æ‰€åœ¨çš„ç½‘å…³çš„æ—¶å€™ï¼Œå®ƒæ˜¯ä¸çŸ¥é“LBçš„MACåœ°å€çš„ï¼Œå› æ­¤éœ€è¦é€šè¿‡ARPåè®®æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯åœ¨å±€åŸŸç½‘ä¸­å‘é€ARPè¯·æ±‚ï¼Œçœ‹è°ä¼šå“åº”ï¼Œå“åº”çš„å°±æ˜¯è¦å‘é€çš„MACåœ°å€ã€‚è€Œè¿™ä¸ªæ—¶å€™ï¼Œç”±äºDRæ¨¡å¼ä¸‹çš„LBå’ŒRSéƒ½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ä¸­ä¸”éƒ½ç»‘å®šäº†VIPï¼Œé‚£ä¹ˆå®ƒä»¬å°±éƒ½ä¼šå“åº”è¿™ä¸ªARPè¯·æ±‚ã€‚è¿™æ ·ä¸€æ¥å®¢æˆ·ç«¯çš„æ•°æ®åŒ…å°±ä¸ä¸€å®šä¼šå‘é€åˆ°LBä¸Šé¢ï¼Œä¹Ÿå°±ä¸ä¸€å®šä¼šè§¦å‘æ•´ä¸ªè´Ÿè½½å‡è¡¡æ•ˆæœã€‚ å› æ­¤è¿™ç§æƒ…å†µä¸‹ä¸€èˆ¬éƒ½ä¼šå¯¹RSä¸Šé¢çš„ç½‘å¡æ¥å£çš„ARPè¯·æ±‚è®¾ç½®è¿›è¡Œä¿®æ”¹ï¼š 1234echo &quot;1&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_ignoreecho &quot;2&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_announceecho &quot;1&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_ignoreecho &quot;2&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_announce æˆ‘ä»¬çœ‹ä¸€ä¸‹kernelçš„æ–‡æ¡£ä¸­å¯¹è¿™ä¸¤ä¸ªå‚æ•°çš„ç›¸å…³æè¿° arp_ignoreçš„æ„ä¹‰ arp_ignore - INTEGER Define different modes for sending replies in response to received ARP requests that resolve local target IP addresses: 0 - (default): reply for any local target IP address, configured on any interface 1 - reply only if the target IP address is local address configured on the incoming interface 2 - reply only if the target IP address is local address configured on the incoming interface and both with the senderâ€™s IP address are part from same subnet on this interface 3 - do not reply for local addresses configured with scope host, only resolutions for global and link addresses are replied 4-7 - reserved 8 - do not reply for all local addresses The max value from conf/{all,interface}/arp_ignore is used when ARP request is received on the {interface} arp_ignoreè®¾ç½®ä¸º0æ—¶ï¼Œæ— è®ºæ”¶åˆ°çš„ARPè¯·æ±‚çš„IPæ˜¯å¦æ˜¯ethä¸Šé¢çš„IPï¼Œåªè¦åœ¨å®¿ä¸»æœºä¸Šæœ‰ç½‘å¡æœ‰å¯¹åº”çš„IPï¼Œå°±ä¼šå‘é€ARPåº”ç­”ã€‚ arp_ignoreè®¾ç½®ä¸º1å³æ„å‘³ç€å¯¹åº”çš„ç½‘å¡åœ¨æ”¶åˆ°äº†ç›®æ ‡IPä¸æ˜¯è‡ªå·±çš„ç½‘å¡çš„IPçš„æ•°æ®åŒ…çš„ARPè¯·æ±‚æ—¶ä¸ä¼šè¿›è¡Œå›åº”ï¼Œè€Œåœ¨DRæ¨¡å¼ä¸­ï¼Œå¯¹åº”çš„VIPæ˜¯ç»‘å®šåœ¨loæ¥å£ä¸Šçš„ï¼Œè€Œloæ¥å£å¹¶ä¸æ˜¯ç‰©ç†ç½‘å¡ï¼Œå®é™…ä¸Šæ•°æ®åŒ…éƒ½æ˜¯ä»ç‰©ç†ç½‘å¡ethä¸Šè¿›æ¥ï¼Œå› æ­¤è¿™æ—¶å°±ä¸ä¼šå¯¹ç›®æ ‡IPæ˜¯VIPçš„æ•°æ®åŒ…è¿›è¡ŒARPå›åº”ã€‚ä½¿å¾—è®¿é—®èƒ½å¤Ÿé¡ºåˆ©åœ°åˆ°è¾¾LBä¸Šé¢ï¼Œå†ä»LBä¸Šé¢è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ arp_annouceçš„æ„ä¹‰ arp_announce - INTEGER Define different restriction levels for announcing the local source IP address from IP packets in ARP requests sent on interface: 0 - (default) Use any local address, configured on any interface 1 - Try to avoid local addresses that are not in the targetâ€™s subnet for this interface. This mode is useful when target hosts reachable via this interface require the source IP address in ARP requests to be part of their logical network configured on the receiving interface. When we generate the request we will check all our subnets that include the target IP and will preserve the source address if it is from such subnet. If there is no such subnet we select source address according to the rules for level 2. 2 - Always use the best local address for this target. In this mode we ignore the source address in the IP packet and try to select local address that we prefer for talks with the target host. Such local address is selected by looking for primary IP addresses on all our subnets on the outgoing interface that include the target IP address. If no suitable local address is found we select the first local address we have on the outgoing interface or on all other interfaces, with the hope we will receive reply for our request and even sometimes no matter the source IP address we announce. The max value from conf/{all,interface}/arp_announce is used. æ¯ä¸ªæœºå™¨æˆ–è€…äº¤æ¢æœºä¸­éƒ½æœ‰ä¸€å¼ ARPè¡¨ï¼ŒARPè¡¨çš„ä½œç”¨å°±æ˜¯ç”¨äºè®°å½•IPåœ°å€å’ŒMACåœ°å€çš„å¯¹åº”å…³ç³»ã€‚å½“æ”¶åˆ°ä¸€ä¸ªARPè¡¨ä¸­æ²¡æœ‰è®°å½•çš„IPåœ°å€çš„ARPè¯·æ±‚ï¼Œå°±ä¼šåœ¨æœ¬æœºçš„ARPè¡¨ä¸­æ–°å¢å¯¹åº”çš„IPå’ŒMACè®°å½•ï¼›å½“æ”¶åˆ°ä¸€ä¸ªå·²çŸ¥IPåœ°å€ï¼ˆarpè¡¨ä¸­å·²æœ‰è®°å½•çš„åœ°å€ï¼‰çš„arpè¯·æ±‚ï¼Œåˆ™ä¼šæ ¹æ®arpè¯·æ±‚ä¸­çš„æºMACåˆ·æ–°è‡ªå·±çš„arpè¡¨ã€‚ å¦‚æœarp_announceå‚æ•°é…ç½®ä¸º0ï¼Œåˆ™ç½‘å¡åœ¨å‘é€arpè¯·æ±‚æ—¶ï¼Œå¯èƒ½é€‰æ‹©çš„æºIPåœ°å€å¹¶ä¸æ˜¯è¯¥ç½‘å¡è‡ªèº«çš„IPåœ°å€ï¼Œè¿™æ—¶å€™æ”¶åˆ°è¯¥arpè¯·æ±‚çš„å…¶ä»–èŠ‚ç‚¹æˆ–è€…äº¤æ¢æœºä¸Šçš„arpè¡¨ä¸­è®°å½•çš„è¯¥ç½‘å¡IPå’ŒMACçš„å¯¹åº”å…³ç³»å°±ä¸æ­£ç¡®ã€‚ æ‰€ä»¥DRæ¨¡å¼ä¸‹è¦æ±‚arp_announceå‚æ•°è¦æ±‚é…ç½®ä¸º2ã€‚ åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ä¼šå¿½ç•¥IPæ•°æ®åŒ…ä¸­çš„æºåœ°å€å¹¶ä¸”å°è¯•é€‰æ‹©èƒ½ä¸ç›®æ ‡åœ°å€ä¸»æœºé€šä¿¡çš„æœ¬æœºåœ°å€ é¦–å…ˆå°±æ˜¯æŸ¥æ‰¾æœ¬æœºæ‰€æœ‰çš„å‡ºå£ç½‘å¡ä¸Šçš„IPåœ°å€æ‰€å±çš„å­ç½‘é‡Œé¢åŒ…å«äº†ç›®æ ‡çš„IPåœ°å€çš„IP å¦‚æœæ²¡æœ‰ä¸Šè¿°çš„åˆé€‚çš„IPåœ°å€ï¼Œé‚£ä¹ˆå°±ä¼šé€‰æ‹©å‡ºå£ç½‘å¡çš„ç¬¬ä¸€ä¸ªIPåœ°å€æˆ–è€…æ˜¯åœ¨æ‰€æœ‰çš„ç½‘å¡ä¸­æœ€æœ‰å¯èƒ½èƒ½å¤Ÿæ¥æ”¶åˆ°è¯·æ±‚çš„IPåœ°å€ ç”±äºåœ¨DRæ¨¡å¼ä¸­RSå’ŒLBçš„ç‰©ç†ç½‘å¡æ˜¯å¤„äºåŒä¸€ä¸ªå±€åŸŸç½‘ä¸­çš„ï¼Œæ‰€ä»¥ä¼šç›´æ¥è§£æåˆ°å¯¹åº”çš„ç‰©ç†ç½‘å¡çš„MACåœ°å€ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"},{"name":"nat","slug":"nat","permalink":"https://tinychen.com/tags/nat/"},{"name":"lvs","slug":"lvs","permalink":"https://tinychen.com/tags/lvs/"}]},{"title":"NoSQLæ•°æ®åº“ç®€ä»‹","slug":"20200424-nosql-base-introduction","date":"2020-04-24T02:00:00.000Z","updated":"2020-04-24T02:00:00.000Z","comments":true,"path":"20200424-nosql-base-introduction/","link":"","permalink":"https://tinychen.com/20200424-nosql-base-introduction/","excerpt":"NoSQLåŸºæœ¬æ¦‚å¿µç®€ä»‹ï¼Œå¸¸è§çš„NoSQLæ•°æ®åº“ç±»å‹ä»‹ç»ä»¥åŠMongoDBã€Memcachedå’ŒRedisçš„ç®€å•æ¦‚å¿µä»¥åŠç‰¹æ€§ä»‹ç»ã€‚","text":"NoSQLåŸºæœ¬æ¦‚å¿µç®€ä»‹ï¼Œå¸¸è§çš„NoSQLæ•°æ®åº“ç±»å‹ä»‹ç»ä»¥åŠMongoDBã€Memcachedå’ŒRedisçš„ç®€å•æ¦‚å¿µä»¥åŠç‰¹æ€§ä»‹ç»ã€‚ 1ã€ä»€ä¹ˆæ˜¯NoSQLNoSQL(Not only SQL)æ˜¯å¯¹ä¸åŒäºä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç»Ÿç§°ï¼Œå³å¹¿ä¹‰åœ°æ¥è¯´å¯ä»¥æŠŠæ‰€æœ‰ä¸æ˜¯å…³ç³»å‹æ•°æ®åº“çš„æ•°æ®åº“ç»Ÿç§°ä¸ºNoSQLã€‚ NoSQL æ•°æ®åº“ä¸“é—¨æ„å»ºç”¨äºç‰¹å®šçš„æ•°æ®æ¨¡å‹ï¼Œå¹¶ä¸”å…·æœ‰çµæ´»çš„æ¶æ„æ¥æ„å»ºç°ä»£åº”ç”¨ç¨‹åºã€‚NoSQL æ•°æ®åº“ä½¿ç”¨å„ç§æ•°æ®æ¨¡å‹æ¥è®¿é—®å’Œç®¡ç†æ•°æ®ã€‚è¿™äº›ç±»å‹çš„æ•°æ®åº“ä¸“é—¨é’ˆå¯¹éœ€è¦å¤§æ•°æ®é‡ã€ä½å»¶è¿Ÿå’Œçµæ´»æ•°æ®æ¨¡å‹çš„åº”ç”¨ç¨‹åºè¿›è¡Œäº†ä¼˜åŒ–ï¼Œè¿™æ˜¯é€šè¿‡æ”¾å®½å…¶ä»–æ•°æ®åº“çš„æŸäº›æ•°æ®ä¸€è‡´æ€§é™åˆ¶æ¥å®ç°çš„ã€‚ æ•°åå¹´æ¥ï¼Œç”¨äºåº”ç”¨ç¨‹åºå¼€å‘çš„ä¸»è¦æ•°æ®æ¨¡å‹æ˜¯ç”±å…³ç³»æ•°æ®åº“ï¼ˆå¦‚ Oracleã€DB2ã€SQL Serverã€MySQL å’Œ PostgreSQLï¼‰ä½¿ç”¨çš„å…³ç³»æ•°æ®æ¨¡å‹ã€‚ç›´åˆ° 21 ä¸–çºªä¸­åæœŸï¼Œæ‰å¼€å§‹å¤§è§„æ¨¡é‡‡ç”¨å’Œä½¿ç”¨å…¶ä»–æ•°æ®æ¨¡å‹ã€‚ä¸ºäº†å¯¹è¿™äº›æ–°ç±»åˆ«çš„æ•°æ®åº“å’Œæ•°æ®æ¨¡å‹è¿›è¡ŒåŒºåˆ†å’Œåˆ†ç±»ï¼Œåˆ›é€ äº†æœ¯è¯­â€œNoSQLâ€ã€‚é€šå¸¸æœ¯è¯­â€œNoSQLâ€ä¸â€œéå…³ç³»â€å¯äº’æ¢ä½¿ç”¨ã€‚ 1.1 NoSQLçš„å¸¸è§ç±»å‹é”®å€¼æ•°æ®åº“é”®å€¼ï¼šé”®å€¼æ•°æ®åº“æ˜¯é«˜åº¦å¯åˆ†åŒºçš„ï¼Œå¹¶ä¸”å…è®¸ä»¥å…¶ä»–ç±»å‹çš„æ•°æ®åº“æ— æ³•å®ç°çš„è§„æ¨¡è¿›è¡Œæ°´å¹³æ‰©å±•ã€‚è¯¸å¦‚æ¸¸æˆã€å¹¿å‘ŠæŠ€æœ¯å’Œ IoT ç­‰ä½¿ç”¨æ¡ˆä¾‹æœ¬èº«ç‰¹åˆ«é€‚åˆé”®å€¼æ•°æ®æ¨¡å‹ã€‚Amazon DynamoDB æ—¨åœ¨ä¸ºä»»æ„è§„æ¨¡çš„å·¥ä½œè´Ÿè½½æä¾›ä¸€è‡´ä¸”ä½äº 10 æ¯«ç§’çš„å»¶è¿Ÿã€‚è¿™ç§ä¸€è‡´çš„æ€§èƒ½æ˜¯ä¸ºä½•ä½¿ç”¨ Snapchat Stories åŠŸèƒ½çš„ä¸»è¦åŸå› ï¼Œè¯¥åŠŸèƒ½åŒ…å«ç§»è‡³ DynamoDB çš„ Snapchat çš„æœ€å¤§å­˜å‚¨å†™å…¥å·¥ä½œè´Ÿè½½ã€‚ é”®å€¼æ•°æ®åº“æ˜¯ä¸€ç§éå…³ç³»æ•°æ®åº“ï¼Œå®ƒä½¿ç”¨ç®€å•çš„é”®å€¼æ–¹æ³•æ¥å­˜å‚¨æ•°æ®ã€‚é”®å€¼æ•°æ®åº“å°†æ•°æ®å­˜å‚¨ä¸ºé”®å€¼å¯¹é›†åˆï¼Œå…¶ä¸­é”®ä½œä¸ºå”¯ä¸€æ ‡è¯†ç¬¦ã€‚é”®å’Œå€¼éƒ½å¯ä»¥æ˜¯ä»ç®€å•å¯¹è±¡åˆ°å¤æ‚å¤åˆå¯¹è±¡çš„ä»»ä½•å†…å®¹ã€‚é”®å€¼æ•°æ®åº“æ˜¯é«˜åº¦å¯åˆ†åŒºçš„ï¼Œå¹¶ä¸”å…è®¸ä»¥å…¶ä»–ç±»å‹çš„æ•°æ®åº“æ— æ³•å®ç°çš„è§„æ¨¡è¿›è¡Œæ°´å¹³æ‰©å±•ã€‚ å†…å­˜æ•°æ®åº“å†…å­˜ï¼šæ¸¸æˆå’Œå¹¿å‘ŠæŠ€æœ¯åº”ç”¨ç¨‹åºå…·æœ‰æ’è¡Œæ¦œã€ä¼šè¯å­˜å‚¨å’Œå®æ—¶åˆ†æç­‰ä½¿ç”¨æ¡ˆä¾‹ï¼Œå®ƒä»¬éœ€è¦å¾®ç§’å“åº”æ—¶é—´å¹¶ä¸”å¯èƒ½éšæ—¶å‡ºç°å¤§è§„æ¨¡çš„æµé‡é«˜å³°ã€‚ æ–‡æ¡£æ•°æ®åº“æ–‡æ¡£ï¼šåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ï¼Œæ•°æ®é€šå¸¸è¡¨ç¤ºä¸ºå¯¹è±¡æˆ– JSON æ–‡æ¡£ï¼Œå› ä¸ºå¯¹å¼€å‘äººå‘˜è€Œè¨€å®ƒæ˜¯é«˜æ•ˆå’Œç›´è§‚çš„æ•°æ®æ¨¡å‹ã€‚æ–‡æ¡£æ•°æ®åº“è®©å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ä»–ä»¬åœ¨å…¶åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨çš„ç›¸åŒæ–‡æ¡£æ¨¡å‹æ ¼å¼ï¼Œæ›´è½»æ¾åœ°åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å’ŒæŸ¥è¯¢æ•°æ®ã€‚æ–‡æ¡£å’Œæ–‡æ¡£æ•°æ®åº“çš„çµæ´»ã€åŠç»“æ„åŒ–å’Œå±‚çº§æ€§è´¨å…è®¸å®ƒä»¬éšåº”ç”¨ç¨‹åºçš„éœ€æ±‚è€Œå˜åŒ–ã€‚æ–‡æ¡£æ¨¡å‹å¯ä»¥å¾ˆå¥½åœ°ä¸ç›®å½•ã€ç”¨æˆ·é…ç½®æ–‡ä»¶å’Œå†…å®¹ç®¡ç†ç³»ç»Ÿé…åˆä½¿ç”¨ï¼Œå…¶ä¸­æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¼šéšæ—¶é—´è€Œå˜åŒ–ã€‚ æ–‡æ¡£æ•°æ®åº“æ˜¯ä¸€ç§éå…³ç³»æ•°æ®åº“ï¼Œæ—¨åœ¨å°†æ•°æ®ä½œä¸ºç±» JSON æ–‡æ¡£å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚æ–‡æ¡£æ•°æ®åº“è®©å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ä»–ä»¬åœ¨å…¶åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨çš„ç›¸åŒæ–‡æ¡£æ¨¡å‹æ ¼å¼ï¼Œæ›´è½»æ¾åœ°åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å’ŒæŸ¥è¯¢æ•°æ®ã€‚æ–‡æ¡£å’Œæ–‡æ¡£æ•°æ®åº“çš„çµæ´»ã€åŠç»“æ„åŒ–å’Œå±‚çº§æ€§è´¨å…è®¸å®ƒä»¬éšåº”ç”¨ç¨‹åºçš„éœ€æ±‚è€Œå˜åŒ–ã€‚æ–‡æ¡£æ¨¡å‹å¯ä»¥å¾ˆå¥½åœ°ä¸ç›®å½•ã€ç”¨æˆ·é…ç½®æ–‡ä»¶å’Œå†…å®¹ç®¡ç†ç³»ç»Ÿç­‰ä½¿ç”¨æ¡ˆä¾‹é…åˆä½¿ç”¨ï¼Œå…¶ä¸­æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¼šéšæ—¶é—´è€Œå˜åŒ–ã€‚æ–‡æ¡£æ•°æ®åº“æ”¯æŒçµæ´»çš„ç´¢å¼•ã€å¼ºå¤§çš„ä¸´æ—¶æŸ¥è¯¢å’Œæ–‡æ¡£é›†åˆåˆ†æã€‚ å›¾å½¢æ•°æ®åº“å›¾å½¢ï¼šå›¾å½¢æ•°æ®åº“æ—¨åœ¨è½»æ¾æ„å»ºå’Œè¿è¡Œä¸é«˜åº¦è¿æ¥çš„æ•°æ®é›†ä¸€èµ·ä½¿ç”¨çš„åº”ç”¨ç¨‹åºã€‚å›¾å½¢æ•°æ®åº“çš„å…¸å‹ä½¿ç”¨æ¡ˆä¾‹åŒ…æ‹¬ç¤¾äº¤ç½‘ç»œã€æ¨èå¼•æ“ã€æ¬ºè¯ˆæ£€æµ‹å’ŒçŸ¥è¯†å›¾å½¢ã€‚çƒ­é—¨å›¾å½¢æ•°æ®åº“åŒ…æ‹¬ Neo4j å’Œ Giraphã€‚å›¾å½¢æ•°æ®åº“ä¸“é—¨ç”¨äºå­˜å‚¨å’Œå¯¼èˆªå…³ç³»ã€‚å…³ç³»æ˜¯å›¾å½¢æ•°æ®åº“ä¸­çš„ä¸€ç­‰å…¬æ°‘ï¼Œå›¾å½¢æ•°æ®åº“çš„å¤§éƒ¨åˆ†ä»·å€¼éƒ½æºè‡ªäºè¿™äº›å…³ç³»ã€‚å›¾å½¢æ•°æ®åº“ä½¿ç”¨èŠ‚ç‚¹æ¥å­˜å‚¨æ•°æ®å®ä½“ï¼Œå¹¶ä½¿ç”¨è¾¹ç¼˜æ¥å­˜å‚¨å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚è¾¹ç¼˜å§‹ç»ˆæœ‰ä¸€ä¸ªå¼€å§‹èŠ‚ç‚¹ã€ç»“æŸèŠ‚ç‚¹ã€ç±»å‹å’Œæ–¹å‘ï¼Œå¹¶ä¸”è¾¹ç¼˜å¯ä»¥æè¿°çˆ¶å­å…³ç³»ã€æ“ä½œã€æ‰€æœ‰æƒç­‰ã€‚ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰çš„å…³ç³»çš„æ•°é‡å’Œç±»å‹æ²¡æœ‰é™åˆ¶ã€‚ å›¾å½¢æ•°æ®åº“ä¸­çš„å›¾å½¢å¯ä¾æ®å…·ä½“çš„è¾¹ç¼˜ç±»å‹è¿›è¡Œéå†ï¼Œæˆ–è€…ä¹Ÿå¯å¯¹æ•´ä¸ªå›¾å½¢è¿›è¡Œéå†ã€‚åœ¨å›¾å½¢æ•°æ®åº“ä¸­ï¼Œéå†è”ç»“æˆ–å…³ç³»éå¸¸å¿«ï¼Œå› ä¸ºèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ä¸æ˜¯åœ¨æŸ¥è¯¢æ—¶è®¡ç®—çš„ï¼Œè€Œæ˜¯ç•™å­˜åœ¨æ•°æ®åº“ä¸­ã€‚åœ¨ç¤¾äº¤ç½‘ç»œã€æ¨èå¼•æ“å’Œæ¬ºè¯ˆæ£€æµ‹ç­‰ä½¿ç”¨æ¡ˆä¾‹ä¸­ï¼Œæ‚¨éœ€è¦åœ¨æ•°æ®ä¹‹é—´åˆ›å»ºå…³ç³»å¹¶å¿«é€ŸæŸ¥è¯¢è¿™äº›å…³ç³»ï¼Œæ­¤æ—¶ï¼Œå›¾å½¢æ•°æ®åº“æ›´å…·ä¼˜åŠ¿ã€‚ æœç´¢æ•°æ®åº“æœç´¢ï¼šè®¸å¤šåº”ç”¨ç¨‹åºè¾“å‡ºæ—¥å¿—ä»¥å¸®åŠ©å¼€å‘äººå‘˜è§£å†³é—®é¢˜ã€‚æœç´¢å¼•æ“æ•°æ®åº“æ˜¯ä¸€ç§éå…³ç³»æ•°æ®åº“ï¼Œä¸“ç”¨äºæ•°æ®å†…å®¹çš„æœç´¢ã€‚æœç´¢å¼•æ“æ•°æ®åº“ä½¿ç”¨ç´¢å¼•å¯¹æ•°æ®ä¹‹é—´çš„ç›¸ä¼¼ç‰¹å¾è¿›è¡Œåˆ†ç±»ï¼Œå¹¶å¢å¼ºæœç´¢åŠŸèƒ½ã€‚æœç´¢å¼•æ“æ•°æ®åº“ç»è¿‡ä¼˜åŒ–ï¼Œå¯å¤„ç†å¯èƒ½æ˜¯é•¿æ•°æ®ï¼ŒåŠç»“æ„æ•°æ®æˆ–éç»“æ„æ•°æ®çš„æ•°æ®ï¼Œå¹¶ä¸”å®ƒä»¬é€šå¸¸æä¾›ä¸“é—¨çš„æ–¹æ³•ï¼Œä¾‹å¦‚å…¨æ–‡æœç´¢ï¼Œå¤æ‚çš„æœç´¢è¡¨è¾¾å¼å’Œæœç´¢ç»“æœæ’åã€‚ 1.2 å…³ç³»å‹æ•°æ®åº“å’ŒNoSQL å…³ç³»æ•°æ®åº“ NoSQL æ•°æ®åº“ æœ€ä½³å·¥ä½œè´Ÿè½½ å…³ç³»æ•°æ®åº“ä¸“ä¸ºäº‹åŠ¡æ€§å’Œé«˜åº¦ä¸€è‡´çš„è”æœºäº‹åŠ¡å¤„ç† (OLTP) åº”ç”¨ç¨‹åºè€Œè®¾è®¡ï¼Œå¹¶ä¸”é€‚ç”¨äºè”æœºåˆ†æå¤„ç† (OLAP)ã€‚ NoSQL æ•°æ®åº“é€‚ç”¨äºåŒ…æ‹¬ä½å»¶è¿Ÿåº”ç”¨ç¨‹åºåœ¨å†…çš„å¤šç§æ•°æ®è®¿é—®æ¨¡å¼ã€‚NoSQL æœç´¢æ•°æ®åº“è®¾è®¡ç”¨äºå¯¹åŠç»“æ„åŒ–æ•°æ®è¿›è¡Œåˆ†æã€‚ æ•°æ®æ¨¡å‹ å…³ç³»æ¨¡å‹å¯å°†æ•°æ®æ ‡å‡†åŒ–ä¸ºç”±è¡Œå’Œåˆ—ç»„æˆçš„è¡¨ã€‚é‡‡ç”¨ä¸€ç§æ¶æ„æ¥ä¸¥æ ¼å®šä¹‰è¡¨ã€è¡Œã€åˆ—ã€ç´¢å¼•ã€å„ä¸ªè¡¨ä¹‹é—´çš„å…³ç³»åŠå…¶ä»–æ•°æ®åº“å…ƒç´ ã€‚æ•°æ®åº“åœ¨è¡¨ä¹‹é—´çš„å…³ç³»ä¸­å¼ºåˆ¶å®æ–½å¼•ç”¨å®Œæ•´æ€§ã€‚ NoSQL æ•°æ®åº“æä¾›äº†å„ç§æ•°æ®æ¨¡å‹ï¼Œå¦‚é”®å€¼ã€æ–‡æ¡£å’Œå›¾å½¢ï¼Œè¿™äº›æ¨¡å‹é’ˆå¯¹æ€§èƒ½å’Œè§„æ¨¡è¿›è¡Œäº†ä¼˜åŒ–ã€‚ ACID å±æ€§ å…³ç³»æ•°æ®åº“æä¾›åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ (ACID) å±æ€§ï¼š åŸå­æ€§è¦æ±‚äº‹åŠ¡å®Œå…¨æ‰§è¡Œæˆ–æ ¹æœ¬ä¸æ‰§è¡Œã€‚ä¸€è‡´æ€§è¦æ±‚äº‹åŠ¡æäº¤ä¹‹åï¼Œæ•°æ®å¿…é¡»ç¬¦åˆæ•°æ®åº“æ¶æ„ã€‚éš”ç¦»æ€§è¦æ±‚å¹¶å‘äº‹åŠ¡å½¼æ­¤åˆ†å¼€æ‰§è¡Œã€‚æŒä¹…æ€§è¦æ±‚èƒ½å¤Ÿä»æ„å¤–ç³»ç»Ÿæ•…éšœæˆ–æ–­ç”µæƒ…å†µä¸­æ¢å¤åˆ°ä¸Šä¸€ä¸ªå·²çŸ¥çŠ¶æ€ã€‚ NoSQL æ•°æ®åº“é€šå¸¸é€šè¿‡æ”¾å®½å…³ç³»æ•°æ®åº“çš„ä¸€äº› ACID å±æ€§æ¥è¿›è¡Œæƒè¡¡ï¼Œä»¥è·å¾—å¯ä»¥æ°´å¹³æ‰©å±•çš„æ›´çµæ´»çš„æ•°æ®æ¨¡å‹ã€‚è¿™å°†ä½¿ NoSQL æ•°æ®åº“æˆä¸ºé«˜ååé‡ã€ä½å»¶è¿Ÿä½¿ç”¨æ¡ˆä¾‹çš„ç»ä½³é€‰æ‹©ï¼Œè¿™äº›ä½¿ç”¨æ¡ˆä¾‹éœ€è¦æ°´å¹³æ‰©å±•è¶…å‡ºå•ä¸ªå®ä¾‹çš„é™åˆ¶ã€‚ æ€§èƒ½ æ€§èƒ½é€šå¸¸å–å†³äºç£ç›˜å­ç³»ç»Ÿã€‚è¦è·å¾—æœ€ä½³æ€§èƒ½ï¼Œé€šå¸¸éœ€è¦ä¼˜åŒ–æŸ¥è¯¢ã€ç´¢å¼•å’Œè¡¨ç»“æ„ã€‚ æ€§èƒ½é€šå¸¸ç”±åº•å±‚ç¡¬ä»¶é›†ç¾¤å¤§å°ã€ç½‘ç»œå»¶è¿Ÿä»¥åŠè°ƒç”¨åº”ç”¨ç¨‹åºæ¥å†³å®šã€‚ æ‰©å±• å…³ç³»æ•°æ®åº“é€šå¸¸é€šè¿‡å¢åŠ ç¡¬ä»¶çš„è®¡ç®—èƒ½åŠ›è¿›è¡Œçºµå‘æ‰©å±•æˆ–é€šè¿‡ä¸ºåªè¯»å·¥ä½œè´Ÿè½½æ·»åŠ å‰¯æœ¬è¿›è¡Œæ¨ªå‘æ‰©å±•ã€‚ NoSQL æ•°æ®åº“é€šå¸¸æ˜¯å¯åˆ†åŒºçš„ï¼Œå› ä¸ºè®¿é—®æ¨¡å¼å¯ä»¥é€šè¿‡ä½¿ç”¨åˆ†å¸ƒå¼ä½“ç³»ç»“æ„è¿›è¡Œæ¨ªå‘æ‰©å±•æ¥æé«˜ååé‡ï¼Œä»è€Œä»¥æ¥è¿‘æ— é™çš„è§„æ¨¡æä¾›ä¸€è‡´çš„æ€§èƒ½ã€‚ API å­˜å‚¨å’Œæ£€ç´¢æ•°æ®çš„è¯·æ±‚é€šè¿‡ä½¿ç”¨ç¬¦åˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ (SQL) çš„æŸ¥è¯¢æ¥ä¼ è¾¾ã€‚è¿™äº›æŸ¥è¯¢ç”±å…³ç³»æ•°æ®åº“è§£æå’Œæ‰§è¡Œã€‚ å€ŸåŠ©åŸºäºå¯¹è±¡çš„ APIï¼Œåº”ç”¨å¼€å‘äººå‘˜å¯ä»¥è½»æ¾å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ç»“æ„ã€‚é€šè¿‡åˆ†åŒºé”®ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æŸ¥æ‰¾é”®å€¼å¯¹ã€åˆ—é›†æˆ–åŒ…å«åºåˆ—åŒ–åº”ç”¨ç¨‹åºå¯¹è±¡å’Œå±æ€§çš„åŠç»“æ„åŒ–æ–‡æ¡£ã€‚ 1.3 åˆ†å¸ƒå¼ç³»ç»Ÿçš„CAPåŸç†åœ¨ç†è®ºè®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒCAPå®šç†ï¼ˆCAP theoremï¼‰ï¼Œåˆè¢«ç§°ä½œå¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s theoremï¼‰ï¼Œå®ƒæŒ‡å‡ºå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿæ¥è¯´ï¼Œä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹ï¼š ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ ï¼ˆç­‰åŒäºæ‰€æœ‰èŠ‚ç‚¹è®¿é—®åŒä¸€ä»½æœ€æ–°çš„æ•°æ®å‰¯æœ¬ï¼‰ å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½èƒ½è·å–åˆ°éé”™çš„å“åº”â€”â€”ä½†æ˜¯ä¸ä¿è¯è·å–çš„æ•°æ®ä¸ºæœ€æ–°æ•°æ®ï¼‰ åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ï¼ˆä»¥å®é™…æ•ˆæœè€Œè¨€ï¼Œåˆ†åŒºç›¸å½“äºå¯¹é€šä¿¡çš„æ—¶é™è¦æ±‚ã€‚ç³»ç»Ÿå¦‚æœä¸èƒ½åœ¨æ—¶é™å†…è¾¾æˆæ•°æ®ä¸€è‡´æ€§ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†åˆ†åŒºçš„æƒ…å†µï¼Œå¿…é¡»å°±å½“å‰æ“ä½œåœ¨Cå’ŒAä¹‹é—´åšå‡ºé€‰æ‹©ã€‚ï¼‰ æ ¹æ®å®šç†ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½æ»¡è¶³ä¸‰é¡¹ä¸­çš„ä¸¤é¡¹è€Œä¸å¯èƒ½æ»¡è¶³å…¨éƒ¨ä¸‰é¡¹ã€‚ç†è§£CAPç†è®ºçš„æœ€ç®€å•æ–¹å¼æ˜¯æƒ³è±¡ä¸¤ä¸ªèŠ‚ç‚¹åˆ†å¤„åˆ†åŒºä¸¤ä¾§ã€‚å…è®¸è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹æ›´æ–°çŠ¶æ€ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œå³ä¸§å¤±äº†Cæ€§è´¨ã€‚å¦‚æœä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œå°†åˆ†åŒºä¸€ä¾§çš„èŠ‚ç‚¹è®¾ç½®ä¸ºä¸å¯ç”¨ï¼Œé‚£ä¹ˆåˆä¸§å¤±äº†Aæ€§è´¨ã€‚é™¤éä¸¤ä¸ªèŠ‚ç‚¹å¯ä»¥äº’ç›¸é€šä¿¡ï¼Œæ‰èƒ½æ—¢ä¿è¯Cåˆä¿è¯Aï¼Œè¿™åˆä¼šå¯¼è‡´ä¸§å¤±Pæ€§è´¨ã€‚ 1.3 NoSQLçš„BASEåŸåˆ™BASEï¼šBasically Available, Soft-state, Eventually Consistentã€‚ ç”± Eric Brewer å®šä¹‰ã€‚BASEæ˜¯NoSQLæ•°æ®åº“é€šå¸¸å¯¹å¯ç”¨æ€§åŠä¸€è‡´æ€§çš„å¼±è¦æ±‚åŸåˆ™: Basically Availble â€“åŸºæœ¬å¯ç”¨ Soft-state â€“è½¯çŠ¶æ€/æŸ”æ€§äº‹åŠ¡ã€‚ â€œSoft stateâ€ å¯ä»¥ç†è§£ä¸ºâ€æ— è¿æ¥â€çš„, è€Œ â€œHard stateâ€ æ˜¯â€é¢å‘è¿æ¥â€çš„ Eventual Consistency â€“ æœ€ç»ˆä¸€è‡´æ€§ï¼Œ ä¹Ÿæ˜¯æ˜¯ ACID çš„æœ€ç»ˆç›®çš„ã€‚ BASEæ¨¡å‹æ˜¯ä¼ ç»ŸACIDæ¨¡å‹çš„åé¢ï¼Œä¸åŒäºACIDï¼ŒBASEå¼ºè°ƒç‰ºç‰²é«˜ä¸€è‡´æ€§ï¼Œä»è€Œè·å¾—å¯ç”¨æ€§ï¼Œæ•°æ®å…è®¸åœ¨ä¸€æ®µæ—¶é—´å†…çš„ä¸ä¸€è‡´ï¼Œåªè¦ä¿è¯æœ€ç»ˆä¸€è‡´å°±å¯ä»¥äº†ã€‚ 2ã€MongoDBMongoDB æ˜¯ç”±C++è¯­è¨€ç¼–å†™çš„åŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„å¼€æºæ•°æ®åº“ç³»ç»Ÿï¼ˆdocument databaseï¼‰ã€‚MongoDBæ•°æ®åº“ä¸­çš„è®°å½•ç§°ä¸ºæ–‡æ¡£ï¼ˆdocumentï¼‰ï¼Œæ˜¯ä¸€ç§ç”±å­—æ®µå’Œå€¼ï¼ˆfield and valueï¼‰æˆå¯¹ç»„æˆçš„key-valueé”®å€¼å‹æ•°æ®ç»“æ„ï¼Œæ ¼å¼ä¸Šå’Œå¸¸ç”¨çš„jsonæ ¼å¼ç±»ä¼¼ï¼Œå­—æ®µçš„å€¼å¯ä»¥åŒ…æ‹¬å…¶ä»–æ–‡æ¡£ï¼Œæ•°ç»„å’Œæ–‡æ¡£æ•°ç»„ã€‚ 123456&#123; name: &quot;sue&quot;, age: 26, status: &quot;A&quot;, groups: [&quot;news&quot;,&quot;sports&quot;]&#125; ä½¿ç”¨æ–‡æ¡£çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºå¯ä»¥æ”¯æŒè®¸å¤šç¼–ç¨‹è¯­è¨€çš„åŸç”Ÿæ•°æ®ç±»å‹ï¼Œé¿å…ä¸å¿…è¦çš„joinæ“ä½œä»¥åŠåŠ¨æ€çš„schemaæ¨¡å¼å¯ä»¥æµç•…åœ°æ”¯æŒå¤šæ€ç±»å‹ã€‚ Dynamic schema supports fluent polymorphismã€‚ MongoDBå°†æ–‡æ¡£å­˜å‚¨åˆ°é›†åˆï¼ˆcollectionsï¼‰ä¸­ï¼Œé›†åˆä¸å…³ç³»å‹æ•°æ®åº“ä¸­çš„æ•°æ®è¡¨ç±»ä¼¼ã€‚é™¤äº†é›†åˆä¹‹å¤–ï¼ŒMongoDBè¿˜æ”¯æŒåªè¯»è§†å›¾ï¼ˆ3.4ï¼‰å’ŒæŒ‰éœ€å®ä¾‹åŒ–è§†å›¾ï¼ˆ4.2ï¼‰ã€‚ é™¤äº†æœ€ä¸»è¦çš„æ–‡æ¡£ç‰¹æ€§å¤–ï¼ŒMongoDBè¿˜å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š 2.1 High PerformanceMongoDBæä¾›äº†é«˜æ€§èƒ½çš„æ•°æ®æŒä¹…åŒ–å­˜å‚¨åŠŸèƒ½ï¼Œä¸»è¦æ˜¯ é€šè¿‡æ”¯æŒåµŒå…¥å¼çš„æ•°æ®æ¨¡å‹æ¥å‡å°‘æ•°æ®åº“ç³»ç»Ÿçš„I/Oæ“ä½œ ç´¢å¼•æ”¯æŒæ›´å¿«çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”å¯ä»¥åŒ…æ‹¬æ¥è‡ªåµŒå…¥å¼æ–‡æ¡£å’Œæ•°ç»„çš„é”® 2.2 Rich Query LanguageMongoDBæä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢è¯­å¥ç”¨äºæ”¯æŒCRUDç­‰æ“ä½œï¼Œé™¤äº†å¸¸è§„çš„æŸ¥è¯¢è¯­å¥è¿˜æ”¯æŒå¦‚ Data Aggregationï¼ˆæ•°æ®èšåˆï¼‰ã€Text Search ã€ Geospatial Querieså’Œmappingç­‰æ“ä½œ èšåˆæ“ä½œï¼ˆData Aggregationï¼‰å¤„ç†æ•°æ®è®°å½•å¹¶è¿”å›è®¡ç®—ç»“æœã€‚èšåˆæ“ä½œå°†æ¥è‡ªå¤šä¸ªæ–‡æ¡£çš„å€¼ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å¯ä»¥å¯¹åˆ†ç»„çš„æ•°æ®æ‰§è¡Œå„ç§æ“ä½œä»¥è¿”å›å•ä¸ªç»“æœã€‚MongoDBæä¾›äº†ä¸‰ç§æ‰§è¡Œèšåˆçš„æ–¹å¼ï¼šèšåˆç®¡é“ï¼Œmap-reduceå‡½æ•°å’Œå•ä¸€ç›®çš„èšåˆæ–¹æ³•ã€‚ MongoDBæ”¯æŒä½¿ç”¨æ–‡æœ¬ç´¢å¼•å’Œ$textè¿ç®—ç¬¦æ‰§è¡Œå­—ç¬¦ä¸²å†…å®¹çš„æ–‡æœ¬æœç´¢çš„æŸ¥è¯¢æ“ä½œã€‚ MongoDBè¿˜æ”¯æŒåœ°ç†ç©ºé—´ä½ç½®çš„æŸ¥è¯¢æ“ä½œ 2.3 High AvailabilityMongoDBçš„å¤åˆ¶å·¥å…·ï¼ˆç§°ä¸ºå‰¯æœ¬é›† ï¼‰æä¾›è‡ªåŠ¨æ•…éšœè½¬ç§»å’Œæ•°æ®å†—ä½™åŠŸèƒ½ã€‚å‰¯æœ¬é›†æ˜¯ä¸€ç»„ç»´æŠ¤ç›¸åŒæ•°æ®é›†çš„MongoDBæœåŠ¡å™¨ï¼Œå¯æä¾›å†—ä½™å¹¶æé«˜æ•°æ®å¯ç”¨æ€§. 2.4 Horizontal ScalabilityMongoDBçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯æä¾›æ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚ åˆ†ç‰‡å°†æ•°æ®åˆ†å¸ƒåœ¨ä¸€ç»„è®¡ç®—æœºä¸Šã€‚ ä»3.4å¼€å§‹ï¼ŒMongoDBæ”¯æŒåŸºäºåˆ†ç‰‡é”®åˆ›å»ºæ•°æ®åŒºåŸŸã€‚åœ¨å‡è¡¡çš„é›†ç¾¤ä¸­ï¼ŒMongoDBä»…å°†åŒºåŸŸè¦†ç›–çš„è¯»å†™å®šå‘åˆ°åŒºåŸŸå†…çš„é‚£äº›åˆ†ç‰‡ã€‚ 2.5 Support for Multiple Storage EnginesMongoDBæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œå¦‚WiredTigerå’ŒIn-Memory ã€‚æ­¤å¤–ï¼ŒMongoDBè¿˜æä¾›äº†å­˜å‚¨å¼•æ“çš„APIæ’ä»¶ä¾›ç¬¬ä¸‰æ–¹å¼€å‘è€…å¼€å‘å­˜å‚¨å¼•æ“ã€‚ 3ã€Memcachedè‡ªç”±å’Œå¼€æ”¾æºä»£ç ï¼Œé«˜æ€§èƒ½ï¼Œåˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œæœ¬è´¨ä¸Šæ˜¯é€šç”¨çš„ï¼Œä½†æ—¨åœ¨é€šè¿‡å‡è½»æ•°æ®åº“è´Ÿè½½æ¥åŠ é€ŸåŠ¨æ€Webåº”ç”¨ç¨‹åºã€‚Memcachedæ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„é”®å€¼å­˜å‚¨ï¼Œç”¨äºå­˜å‚¨æ¥è‡ªæ•°æ®åº“è°ƒç”¨ï¼ŒAPIè°ƒç”¨æˆ–é¡µé¢æ¸²æŸ“ç»“æœçš„ä»»æ„æ•°æ®ï¼ˆå­—ç¬¦ä¸²ï¼Œå¯¹è±¡ï¼‰ã€‚Memcachedç®€å•ä½†åŠŸèƒ½å¼ºå¤§ã€‚å…¶ç®€å•çš„è®¾è®¡å¯ä¿ƒè¿›å¿«é€Ÿéƒ¨ç½²ï¼Œæ˜“äºå¼€å‘ï¼Œå¹¶è§£å†³äº†å¤§å‹æ•°æ®ç¼“å­˜é¢ä¸´çš„è®¸å¤šé—®é¢˜ã€‚å®ƒçš„APIé€‚ç”¨äºå¤§å¤šæ•°æµè¡Œè¯­è¨€ã€‚Memcachedå¯¹å…¶ç‰¹ç‚¹ä»‹ç»ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š 3.1 Simple Key/Value StoreMemcachedçš„æœåŠ¡ç«¯å¹¶ä¸åœ¨ä¹ç”¨æˆ·çš„æ•°æ®å…·ä½“æ˜¯æ€ä¹ˆæ ·çš„ï¼Œæ¯ä¸€ä¸ªé¡¹ç›®/Itemï¼ˆç›¸å½“äºMySQLä¸­çš„è¡Œï¼‰æ˜¯ç”±keyã€è¿‡æœŸæ—¶é—´ã€æ ‡è®°/flagsï¼ˆå¯é€‰ï¼‰å’ŒåŸå§‹æ•°æ®ç»„æˆã€‚Memcachedå¹¶ä¸çŸ¥é“æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤ç”¨æˆ·ç«¯å¿…é¡»è¦ä¸Šä¼ é¢„åºåˆ—åŒ–çš„æ•°æ®ã€‚ 3.2 Logic Half in Client, Half in Serverä¸€ä¸ªå®Œæ•´çš„memcachedè¿‡ç¨‹å®ç°æ˜¯éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±åŒå®Œæˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰éƒ¨åˆ†æ“ä½œåœ¨å®¢æˆ·ç«¯å®Œæˆè€Œå¦ä¸€éƒ¨åˆ†åœ¨æœåŠ¡ç«¯å®Œæˆã€‚å®¢æˆ·ç«¯è´Ÿè´£é€‰æ‹©å“ªä¸€ä¸ªæœåŠ¡å™¨æ¥è¿›è¡Œè¯»å†™å’Œæ— æ³•ä¸æœåŠ¡å™¨å»ºç«‹é€šä¿¡è¿æ¥çš„æ—¶å€™è¯¥å¦‚ä½•æ“ä½œï¼›æœåŠ¡å™¨è´Ÿè´£å­˜å‚¨å’Œæ‹‰å–itemï¼ŒåŒæ—¶è¿˜è´Ÿè´£å†…å­˜çš„é‡Šæ”¾å’Œå¤ç”¨ç­‰å·¥ä½œã€‚ 3.3 Servers are Disconnected From Each OtherMemcachedé›†ç¾¤ä¹‹é—´çš„æœåŠ¡å™¨äº’ç›¸å¹¶ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼Œä»–ä»¬ä¸äº¤æµã€ä¸åŒæ­¥ã€ä¸å¹¿æ’­ã€ä¸å¤åˆ¶ï¼Œå¾€é›†ç¾¤ä¸­æ·»åŠ æœåŠ¡å™¨å°±å¯ä»¥ç›´æ¥å¢åŠ æ•´ä¸ªé›†ç¾¤çš„å¯ç”¨å†…å­˜ã€‚å½“å®¢æˆ·ç«¯åˆ é™¤æˆ–è€…è¦†ç›–äº†è®°å½•è¯¥å®¢æˆ·ç«¯çš„ç¼“å­˜æ•°æ®çš„æœåŠ¡å™¨çš„æ—¶å€™ï¼Œç¼“å­˜å°±ä¼šå¤±æ•ˆã€‚ 3.4 O(1)æ‰€æœ‰çš„å‘½ä»¤å®ç°èµ·æ¥éƒ½å¾ˆå¿«å¹¶ä¸”å¯¹åŠ é”ååˆ†å‹å¥½ï¼Œè¿™ä¸ºæ‰€æœ‰ç”¨ä¾‹æä¾›äº†è¿‘ä¹ç¡®å®šçš„æŸ¥è¯¢é€Ÿåº¦ã€‚å®˜æ–¹è¡¨ç¤ºå¯¹äºæ¯”è¾ƒæ…¢çš„æœºå™¨æ¯æ¬¡æŸ¥è¯¢éƒ½åœ¨1msä»¥ä¸‹ï¼Œè€Œé«˜ç«¯æœåŠ¡å™¨å¯ä»¥å®ç°æ¯ç§’ç™¾ä¸‡çš„ååã€‚ Queries on slow machines should run in well under 1ms. High end servers can serve millions of keys per second in throughput. 3.5 Forgetting is a FeatureMemcachedé»˜è®¤ä½¿ç”¨LRUç®—æ³•å’Œæ‡’æƒ°å›æ”¶æœºåˆ¶ã€‚itemsä¼šåœ¨æŒ‡å®šçš„æ—¶é—´åå¤±æ•ˆï¼Œä½†ä¸æ˜¯å¤±æ•ˆåå°±é©¬ä¸ŠæŠŠitemä»å†…å­˜ä¸­åˆ é™¤ï¼Œè€Œæ˜¯å½“å†…å­˜ä¸è¶³éœ€è¦æ–°çš„å†…å­˜æ¥å»ºç«‹itemæ—¶å†å»æŸ¥æ‰¾å·²ç»è¿‡æœŸçš„itemå°†å…¶åˆ é™¤å¹¶é‡Šæ”¾å†…å­˜ã€‚å½“æ²¡æœ‰è¿‡æœŸçš„itemä¸”å½“å†…å­˜ä¸è¶³æ—¶ï¼ŒMemcachedä¼šæ¸…é™¤å†…å­˜ä¸­å°šæœªè¿‡æœŸä½†æ˜¯å¾ˆä¹…æ²¡æœ‰è¢«ä½¿ç”¨çš„æ•°æ®æ¥é‡Šæ”¾å†…å­˜ä»è€Œä¿ç•™é‚£äº›è¢«é¢‘ç¹è®¿é—®çš„æ•°æ® 3.6 Cache InvalidationMemcachedä½¿ç”¨å“ˆå¸Œç®—æ³•ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸æ˜¯ç›´æ¥å‘æ‰€æœ‰å¯ç”¨ä¸»æœºå¹¿æ’­æ›´æ”¹ï¼Œè€Œæ˜¯æ ¹æ®å“ˆå¸Œè¡¨çš„è®°å½•ç›´æ¥è®¿é—®ä¿å­˜æœ‰å¾…å¤±æ•ˆæ•°æ®çš„æœåŠ¡å™¨ã€‚ 4ã€RedisRedis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker. It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams. Redis has built-in replication, Lua scripting, LRU eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster. Redisæ˜¯ä¸€ä¸ªåŸºäºBSDå¼€æºåè®®çš„ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨äºæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒæ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚ å­—ç¬¦ä¸²ï¼ˆstringsï¼‰ï¼Œ æ•£åˆ—ï¼ˆhashesï¼‰ï¼Œ åˆ—è¡¨ï¼ˆlistsï¼‰ï¼Œ é›†åˆï¼ˆsetsï¼‰ï¼Œ æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ ä¸èŒƒå›´æŸ¥è¯¢ï¼Œ bitmapsï¼Œ hyperloglogs å’Œ åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰ ç´¢å¼•åŠå¾„æŸ¥è¯¢ã€‚ Redis å†…ç½®äº†å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUAè„šæœ¬ï¼ˆLua scriptingï¼‰ï¼Œ LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„æ•°æ®æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼Œ å¹¶é€šè¿‡ Rediså“¨å…µï¼ˆSentinelï¼‰å’Œredisé›†ç¾¤çš„è‡ªåŠ¨åˆ†åŒºæä¾›é«˜å¯ç”¨æ€§ã€‚ 4.1 Redis vs Memcachedç¼“å­˜ä¸­é—´ä»¶ Memcache å’Œ Redis çš„åŒºåˆ« Memcached Redis æ•°æ®ç±»å‹ æ”¯æŒç®€å•æ•°æ®ç±»å‹ æ•°æ®ç±»å‹ä¸°å¯Œ æ•°æ®æŒä¹…åŒ–å­˜å‚¨ N Y ä¸»ä» N Y åˆ†ç‰‡ N Y 4.2 Redisçš„ç‰¹ç‚¹ redis å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚ redis ä½¿ç”¨å•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å‹çš„ï¼ˆKï¼ŒVï¼‰æ•°æ®åº“ï¼Œå°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå­˜å–å‡ä¸ä¼šå—åˆ°ç¡¬ç›˜ IO çš„é™åˆ¶ï¼Œå› æ­¤å…¶æ‰§è¡Œé€Ÿåº¦æå¿«ã€‚ å¦å¤–å•çº¿ç¨‹ä¹Ÿèƒ½å¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼Œè¿˜å¯ä»¥é¿å…é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”çš„ç«äº‰ï¼Œå¦‚æœæƒ³è¦å¤šæ ¸è¿è¡Œä¹Ÿå¯ä»¥å¯åŠ¨å¤šä¸ªå®ä¾‹ã€‚ å½“ç„¶äº†ï¼Œå•çº¿ç¨‹ä¹Ÿä¼šæœ‰å®ƒçš„ç¼ºç‚¹ï¼Œä¹Ÿæ˜¯Redisçš„å™©æ¢¦ï¼šé˜»å¡ã€‚å¦‚æœæ‰§è¡Œä¸€ä¸ªå‘½ä»¤è¿‡é•¿ï¼Œé‚£ä¹ˆä¼šé€ æˆå…¶ä»–å‘½ä»¤çš„é˜»å¡ï¼Œå¯¹äºRedisæ˜¯ååˆ†è‡´å‘½çš„ï¼Œæ‰€ä»¥Redisæ˜¯é¢å‘å¿«é€Ÿæ‰§è¡Œåœºæ™¯çš„æ•°æ®åº“ã€‚ æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ï¼ŒRedis ä¸ä½¿ç”¨è¡¨ï¼Œä¸ä¼šå¼ºåˆ¶ç”¨æˆ·å¯¹å„ä¸ªå…³ç³»è¿›è¡Œå…³è”ï¼Œä¸ä¼šæœ‰å¤æ‚çš„å…³ç³»é™åˆ¶ï¼Œå…¶å­˜å‚¨ç»“æ„å°±æ˜¯é”®å€¼å¯¹ï¼Œç±»ä¼¼äº HashMapï¼ŒHashMap æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯å­˜å–çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚ redis ä½¿ç”¨I/O å¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œå±äºéé˜»å¡ IOã€‚Redisä½¿ç”¨epollä½œä¸ºI/Oå¤šè·¯å¤ç”¨æŠ€æœ¯çš„å®ç°ï¼Œå†åŠ ä¸ŠRedisè‡ªèº«çš„äº‹ä»¶å¤„ç†æ¨¡å‹å°†epollçš„readã€writeã€closeç­‰éƒ½è½¬æ¢æˆäº‹ä»¶ï¼Œä¸åœ¨ç½‘ç»œI/Oä¸Šæµªè´¹è¿‡å¤šçš„æ—¶é—´ã€‚å®ç°å¯¹å¤šä¸ªFDè¯»å†™çš„ç›‘æ§ï¼Œæé«˜æ€§èƒ½ã€‚","categories":[{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"database","slug":"database","permalink":"https://tinychen.com/tags/database/"}]},{"title":"DNSåŸç†ç¯‡01-DNSåŸç†ä»‹ç»","slug":"20200417-dns-01-dns-theory-01-dns-introduction","date":"2020-04-17T02:00:00.000Z","updated":"2020-04-17T02:00:00.000Z","comments":true,"path":"20200417-dns-01-dns-theory-01-dns-introduction/","link":"","permalink":"https://tinychen.com/20200417-dns-01-dns-theory-01-dns-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬DNSçš„ç®€å•ä»‹ç»ï¼ŒDNSæŸ¥è¯¢çš„åŸç†ä»‹ç»å’ŒDNSè´Ÿè½½å‡è¡¡åº”ç”¨çš„ç®€å•ä»‹ç»ã€‚","text":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬DNSçš„ç®€å•ä»‹ç»ï¼ŒDNSæŸ¥è¯¢çš„åŸç†ä»‹ç»å’ŒDNSè´Ÿè½½å‡è¡¡åº”ç”¨çš„ç®€å•ä»‹ç»ã€‚ 1ã€DNSç®€ä»‹1.1 ä»€ä¹ˆæ˜¯DNSé¦–å…ˆæˆ‘ä»¬æ¥äº†è§£DNSæ˜¯ä»€ä¹ˆã€‚ä¸‹é¢å¼•ç”¨ç»´åŸºç™¾ç§‘çš„è§£é‡Šï¼š åŸŸåç³»ç»Ÿï¼ˆè‹±è¯­ï¼šDomain Name Systemï¼Œç¼©å†™ï¼šDNSï¼‰æ˜¯äº’è”ç½‘çš„ä¸€é¡¹æœåŠ¡ã€‚å®ƒä½œä¸ºå°†åŸŸåå’ŒIPåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œèƒ½å¤Ÿä½¿äººæ›´æ–¹ä¾¿åœ°è®¿é—®äº’è”ç½‘ã€‚DNSä½¿ç”¨TCPå’ŒUDPç«¯å£53ã€‚å½“å‰ï¼Œå¯¹äºæ¯ä¸€çº§åŸŸåé•¿åº¦çš„é™åˆ¶æ˜¯63ä¸ªå­—ç¬¦ï¼ŒåŸŸåæ€»é•¿åº¦åˆ™ä¸èƒ½è¶…è¿‡253ä¸ªå­—ç¬¦ã€‚ æˆ‘ä»¬çŸ¥é“è®¡ç®—æœºç½‘ç»œä¸­çš„é€šä¿¡å®é™…ä¸Šæ˜¯éœ€è¦é€šè¿‡IPæ¥è¿›è¡Œçš„ï¼Œä½†æ˜¯è®©ä½¿ç”¨è€…è®°ä½é‚£ä¹ˆå¤šå¤æ‚æ— è§„å¾‹çš„IPåœ°å€æ˜¯ä¸ç°å®çš„ï¼Œå› æ­¤äººä»¬å‘æ˜äº†åŸŸåï¼Œä½¿ç”¨è€…åªéœ€è¦è®°ä½åŸŸåï¼Œç„¶åé€šè¿‡åŸŸåå³å¯è®¿é—®å¯¹åº”çš„ç½‘ç«™ï¼Œè€ŒDNSå°±æ˜¯è´Ÿè´£å°†æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„åŸŸåå¦‚163.comã€google.comç­‰è§£ææˆå¯¹åº”çš„IPåœ°å€ï¼Œç„¶åè®©å®¢æˆ·ç«¯å’Œè¯¥IPåœ°å€è¿›è¡Œé€šä¿¡çš„è¿™æ ·ä¸€ä¸ªç³»ç»Ÿã€‚ ä¸Šé¢çš„ç»´åŸºç™¾ç§‘è¯´DNSæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ•°æ®åº“å…¶å®ä¹Ÿæ˜¯åˆç†çš„ï¼Œå› ä¸ºDNSä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å­˜å‚¨ç€å„ç±»åŸŸåå’Œå¯¹åº”çš„IPåœ°å€ï¼ŒDNSè¯·æ±‚å¯ä»¥ç†è§£æˆæŸ¥è¯¢æ•°æ®åº“çš„æ“ä½œã€‚è€Œå› ä¸ºDNSéœ€è¦ç»™å…¨çƒæ‰€æœ‰ä¸Šç½‘çš„ç”¨æˆ·é¢‘ç¹ä½¿ç”¨ï¼Œå› æ­¤å®ƒå¿…é¡»æ˜¯åˆ†å¸ƒå¼ï¼ˆåœ°åŸŸå¹¿ï¼‰ã€é«˜å¹¶å‘ï¼ˆè¯·æ±‚å¤šï¼‰ã€é«˜å¯ç”¨ï¼ˆé‡è¦æ€§é«˜ï¼‰çš„ä¸€ä¸ªç³»ç»Ÿã€‚ 1.2 DNSè§£æç±»å‹DNSçš„è§£æç±»å‹å…¶å®ä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œæˆ‘ä»¬æ¯”è¾ƒå¸¸æ¥è§¦åˆ°çš„å°±æ˜¯Aç±»å’ŒCNAMEï¼Œå½“ç„¶ç°åœ¨IPv6å¼€å§‹æ™®åŠäº†ä¹Ÿå°±æœ‰AAAAç±»ï¼ˆç›¸å½“äºIPv6ç‰ˆçš„Aç±»ï¼‰ã€‚ A-å°†åŸŸåæŒ‡å‘ä¸€ä¸ªIPV4åœ°å€ æ¯”å¦‚å°†wikipedia.orgè¿™ä¸ªåŸŸåè§£æåˆ°103.102.166.224è¿™ä¸ªIPv4åœ°å€ï¼› CNAME-å°†åŸŸåæŒ‡å‘å¦å¤–ä¸€ä¸ªåŸŸå æ¯”å¦‚å°†wikipedia.orgè¿™ä¸ªåŸŸåè§£æåˆ°wikipedia.org.cn AAAA-å°†åŸŸåæŒ‡å‘ä¸€ä¸ªIPV6åœ°å€ æ¯”å¦‚å°†wikipedia.orgè¿™ä¸ªåŸŸåè§£æåˆ°2001:df2:e500:ed1a::1è¿™ä¸ªIPv6åœ°å€ï¼› NS-å°†å­åŸŸåæŒ‡å®šå…¶ä»–DNSæœåŠ¡å™¨è§£æ æ¯”å¦‚ä½ åœ¨é˜¿é‡Œäº‘è´­ä¹°çš„åŸŸåï¼Œä½†æ˜¯æƒ³è¦ä½¿ç”¨ç½‘æ˜“äº‘æ¥æä¾›DNSè§£ææœåŠ¡ï¼Œé‚£å°±æ·»åŠ ä¸€ä¸ªNSè®°å½•ï¼Œå°†è®°å½•å€¼è®¾ç½®æˆç½‘æ˜“äº‘çš„DNSæœåŠ¡å™¨åŸŸåï¼› MX-å°†åŸŸåæŒ‡å‘é‚®ä»¶æœåŠ¡å™¨åœ°å€ è®¾ç½®é‚®ç®±æ—¶ï¼Œè®©é‚®ç®±èƒ½æ”¶åˆ°é‚®ä»¶ï¼Œå°±éœ€è¦æ·»åŠ  MX è®°å½•ã€‚MXå…¨ç§°ä¸ºmail exchangerï¼Œç”¨äºç”µå­é‚®ä»¶ç³»ç»Ÿå‘é‚®ä»¶æ—¶æ ¹æ®æ”¶ä¿¡äººçš„åœ°å€åç¼€æ¥å®šä½é‚®ä»¶æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œå½“æœ‰äººå‘é‚®ä»¶ç»™wikipediauser@wikipedia.orgæ—¶ï¼Œç³»ç»Ÿå°†å¯¹wikipedia.orgè¿›è¡ŒDNSä¸­çš„MXè®°å½•è§£æã€‚å¦‚æœMXè®°å½•å­˜åœ¨ï¼Œç³»ç»Ÿå°±æ ¹æ®MXè®°å½•çš„ä¼˜å…ˆçº§ï¼Œå°†é‚®ä»¶è½¬å‘åˆ°ä¸è¯¥MXç›¸åº”çš„é‚®ä»¶æœåŠ¡å™¨ä¸Šã€‚ TXT-æ–‡æœ¬é•¿åº¦é™åˆ¶ä¸€èˆ¬ä¸º255ï¼Œé€šå¸¸åšSPFè®°å½•ï¼ˆååƒåœ¾é‚®ä»¶ï¼‰ SPFæ˜¯ Sender Policy Framework çš„ç¼©å†™ï¼Œä¸€ç§ä»¥IPåœ°å€è®¤è¯ç”µå­é‚®ä»¶å‘ä»¶äººèº«ä»½çš„æŠ€æœ¯ã€‚æ¥æ”¶é‚®ä»¶æ–¹ä¼šé¦–å…ˆæ£€æŸ¥åŸŸåçš„SPFè®°å½•ï¼Œæ¥ç¡®å®šå‘ä»¶äººçš„IPåœ°å€æ˜¯å¦è¢«åŒ…å«åœ¨SPFè®°å½•é‡Œé¢ï¼Œå¦‚æœåœ¨ï¼Œå°±è®¤ä¸ºæ˜¯ä¸€å°æ­£ç¡®çš„é‚®ä»¶ï¼Œå¦åˆ™ä¼šè®¤ä¸ºæ˜¯ä¸€å°ä¼ªé€ çš„é‚®ä»¶è¿›è¡Œé€€å›ã€‚ CAA-CAè¯ä¹¦é¢å‘æœºæ„æˆæƒæ ¡éªŒ CAA(Certificate Authority Authorization)ï¼Œå³è¯ä¹¦é¢å‘æœºæ„æˆæƒã€‚æ˜¯ä¸€é¡¹æ–°çš„å¯ä»¥æ·»åŠ åˆ°DNSè®°å½•ä¸­çš„é¢å¤–å­—æ®µ,é€šè¿‡DNSæœºåˆ¶åˆ›å»ºCAAèµ„æºè®°å½•ï¼Œå¯ä»¥é™å®šåŸŸåé¢å‘çš„è¯ä¹¦å’ŒCAï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰ä¹‹é—´çš„è”ç³»ã€‚æœªç»æˆæƒçš„ç¬¬ä¸‰æ–¹å°è¯•é€šè¿‡å…¶ä»–CAæ³¨å†Œè·å–ç”¨äºè¯¥åŸŸåçš„SSL/TLSè¯ä¹¦å°†è¢«æ‹’ç»ã€‚ åŸŸåè®¾ç½® CAA è®°å½•ï¼Œä½¿ç½‘ç«™æ‰€æœ‰è€…ï¼Œå¯æˆæƒæŒ‡å®šCAæœºæ„ä¸ºè‡ªå·±çš„åŸŸåé¢å‘è¯ä¹¦ï¼Œä»¥é˜²æ­¢HTTPSè¯ä¹¦é”™è¯¯ç­¾å‘ï¼Œä»è€Œæé«˜ç½‘ç«™å®‰å…¨æ€§ã€‚ å…¶ä»–çš„è¿˜æœ‰è¯¸å¦‚SRVã€æ˜¾æ€§/éšæ€§URLç­‰è§£æï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„åŸŸåä¾›åº”å•†æä¾›çš„DNSè§£ææœåŠ¡è¯´æ˜æ–‡æ¡£ã€‚ 2ã€DNSæŸ¥è¯¢è¿‡ç¨‹2.1 DNSæœåŠ¡å™¨ç±»å‹DNSæœåŠ¡å™¨ä¸€èˆ¬åˆ†ä¸‰ç§ï¼Œæ ¹DNSæœåŠ¡å™¨ï¼Œé¡¶çº§DNSæœåŠ¡å™¨ï¼Œæƒå¨DNSæœåŠ¡å™¨ã€‚ æ ¹DNSæœåŠ¡å™¨æ˜¯æœ€é«˜å±‚æ¬¡çš„DNSæœåŠ¡å™¨ï¼Œå…¨çƒå…±æœ‰13å¥—ï¼Œå®ƒå¹¶ä¸æä¾›ç›´æ¥çš„DNSåŸŸåè§£ææœåŠ¡ï¼Œè€Œæ˜¯è´Ÿè´£å°†å¯¹åº”çš„é¡¶çº§åŸŸåDNSæœåŠ¡å™¨çš„åœ°å€è¿”å›ç»™æŸ¥è¯¢çš„å®¢æˆ·ç«¯ é¡¶çº§åŸŸåï¼ˆtop level domainï¼Œç®€å†™ä¸º TLDï¼‰ï¼Œå³å¯¹åº”å›¾ä¸­ç¬¬äºŒå±‚çš„é¡¶çº§DNSæœåŠ¡å™¨è´Ÿè´£çš„é¡¶çº§åŸŸåï¼ŒåŒæ ·çš„ï¼Œé¡¶çº§åŸŸåæœåŠ¡å™¨ä¹Ÿä¸æä¾›ç›´æ¥çš„DNSåŸŸåè§£ææœåŠ¡ï¼Œè€Œæ˜¯è´Ÿè´£å°†å¯¹åº”çš„æƒå¨åŸŸåæœåŠ¡å™¨è¿”å›ç»™æŸ¥è¯¢çš„å®¢æˆ·ç«¯ æƒå¨DNSæœåŠ¡å™¨ä¸ºå›¾ä¸­çš„ç¬¬ä¸‰å±‚ï¼Œè¿™æ—¶å€™æƒå¨DNSæœåŠ¡å™¨ä¼šè¿”å›å¯¹åº”åŸŸåçš„IPåœ°å€ï¼Œå®¢æˆ·ç«¯æ‹¿åˆ°äº†IPåœ°å€å°±å¯ä»¥è¿›è¡Œè®¿é—®äº†ã€‚ é‚£ä¹ˆå›¾ä¸­çš„ç¬¬å››å±‚example.wikipedia.orgä¸ºwikipedia.orgçš„å­åŸŸåï¼Œä¹Ÿå¯ä»¥å«åšäºŒçº§åŸŸåï¼Œç¬¬äº”å±‚www.example.wikipedia.orgæ˜¯ç¬¬å››å±‚example.wikipedia.orgçš„å­åŸŸåï¼Œä¹Ÿå¯ä»¥å«åšä¸‰çº§åŸŸåï¼Œä»¥æ­¤ç±»æ¨ã€‚ 2.2 DNSè¯·æ±‚è¿‡ç¨‹æ¥ä¸‹æ¥æˆ‘ä»¬ä»¥è®¿é—®ç»´åŸºç™¾ç§‘(wikipedia.org)ä¸ºä¾‹ï¼Œå¯¹åº”ä¸‹å›¾è¿›è¡Œè§£æï¼š é¦–å…ˆå®¢æˆ·ç«¯å‘é€è¯·æ±‚éœ€è¦è®¿é—®wikipedia.orgï¼Œç„¶åç¬¬ä¸€æ­¥æ˜¯è®¿é—®æœ¬åœ°çš„DNSç¼“å­˜ï¼› æœ¬åœ°çš„DNSç¼“å­˜ä¼šè¯»å–ç³»ç»Ÿä¸‹å¯¹åº”çš„hostsæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯Linuxä¸‹çš„/etc/hostsæˆ–Windowsä¸‹çš„C:\\Windows\\System32\\drivers\\etc\\hsotsï¼Œå¦‚æœè¿™é‡Œé¢å®šä¹‰äº†wikipedia.orgè¿™ä¸ªåŸŸåå¯¹åº”çš„IPåœ°å€ï¼Œåˆ™ç›´æ¥è®¿é—®è¿™ä¸ªIPï¼Œå°±æ²¡æœ‰åé¢ä»€ä¹ˆäº‹å„¿äº†ï¼› å¦‚æœæœ¬åœ°çš„ç¼“å­˜æ–‡ä»¶æ²¡æœ‰è®°å½•ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼šå‘é€è¯·æ±‚åˆ°æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œä¸€èˆ¬æ¥è¯´ä¼šæ˜¯ISPé»˜è®¤æä¾›çš„DNSæœåŠ¡å™¨ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæˆç¬¬ä¸‰æ–¹çš„DNSæœåŠ¡å™¨ã€‚æœ¬åœ°DNSæœåŠ¡å™¨æŸ¥è¯¢æœåŠ¡å™¨å†…çš„è®°å½•ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›è®°å½•ç»™å®¢æˆ·ç«¯ï¼› å¦‚æœæœ¬åœ°DNSæœåŠ¡å™¨æ²¡æœ‰è®°å½•ï¼Œé‚£ä¹ˆå°±ä¼šè®¿é—®æ ¹åŸŸåæœåŠ¡å™¨ï¼Œè¯¢é—®wikipedia.orgå¯¹åº”çš„é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼› æ ¹åŸŸåæœåŠ¡å™¨æ ¹æ®è¯·æ±‚åˆ¤æ–­å‡ºæ˜¯è®¿é—®.orgåŸŸåçš„è¯·æ±‚ï¼Œå°±ä¼šç»™å®¢æˆ·ç«¯è¿”å›.orgçš„é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ï¼› æœ¬åœ°DNSæœåŠ¡å™¨è·å–åˆ°åœ°å€ä¹‹åï¼Œå‘é€è¯·æ±‚ç»™.orgçš„é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼Œè¯¢é—®wikipedia.orgå¯¹åº”çš„æƒå¨åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼› .orgçš„é¡¶çº§åŸŸåæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯è¿”å›äº†wikipedia.orgçš„æƒå¨åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼› æœ¬åœ°DNSæœåŠ¡å™¨è·å–åˆ°åœ°å€ä¹‹åï¼Œå‘é€è¯·æ±‚ç»™wikipedia.orgçš„æƒå¨åŸŸåæœåŠ¡å™¨ï¼Œè¯¢é—®wikipedia.orgçš„IPåœ°å€ï¼› wikipedia.orgçš„æƒå¨åŸŸåæœåŠ¡å™¨ç»™æœ¬åœ°DNSæœåŠ¡å™¨è¿”å›äº†wikipedia.orgçš„IPåœ°å€ï¼› æœ¬åœ°DNSæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯è¿”å›äº†wikipedia.orgçš„IPåœ°å€ï¼Œå®¢æˆ·ç«¯å’Œè¿™ä¸ªIPå»ºç«‹è¿æ¥ï¼Œå¼€å§‹ä¼ è¾“æ•°æ®ï¼Œè¯¥æ¬¡DNSè¯·æ±‚ç»“æŸã€‚ å®é™…ä¸Šä¸Šé¢çš„æ˜¯æœ€é•¿çš„DNSæŸ¥è¯¢æƒ…å†µï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬çš„DNSæœ¬åœ°æœåŠ¡å™¨å°±ä¼šå­˜ç€å¯¹åº”çš„DNSç¼“å­˜è®°å½•ï¼Œè¿™æ ·åœ¨DNSæŸ¥è¯¢çš„æ—¶å€™ç›´æ¥å°±å¯ä»¥è¿”å›æœ¬åœ°çš„ç¼“å­˜ç»™å®¢æˆ·ç«¯ï¼Œä»è€Œé¿å…äº†åé¢çš„é€’å½’æŸ¥è¯¢ã€‚ é‚£ä¹ˆè¦æ˜¯æˆ‘ä»¬ä¿®æ”¹äº†åŸŸåçš„DNSè§£æè®°å½•å‘¢ï¼Ÿæ¯”å¦‚wikipedia.orgçš„IPåœ°å€ä»103.102.166.224ä¿®æ”¹æˆ103.102.166.225ï¼Œè¿™å°±æ¶‰åŠåˆ°è§£æç”Ÿæ•ˆçš„æ—¶é—´é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„TTLï¼Œè§£æç”Ÿæ•ˆæ—¶é—´å–å†³äºæœ¬åœ°DNSç¼“å­˜çš„è§£æè®°å½•çš„TTLåˆ°æœŸæ—¶é—´ï¼Œä¸€èˆ¬é»˜è®¤ä¸º10åˆ†é’Ÿã€‚ä¾‹å¦‚è§£æè®°å½•è®¾ç½®çš„TTLå€¼ä¸º 10 åˆ†é’Ÿï¼Œåˆ™ç†è®ºä¸Šå…¨çƒè§£æç”Ÿæ•ˆæ—¶é—´éœ€è¦10åˆ†é’Ÿï¼›è§£æè®°å½•è®¾ç½®çš„TTLå€¼ä¸º60ç§’ï¼Œåˆ™ç†è®ºä¸Šå…¨çƒè§£æç”Ÿæ•ˆæ—¶é—´éœ€è¦60ç§’ã€‚ 3ã€DNSçš„ç”¨é€”æˆ‘ä»¬å·²ç»çŸ¥é“DNSæœ€åŸºæœ¬ä¹Ÿæ˜¯æœ€é‡è¦çš„ä½œç”¨å°±æ˜¯è¿›è¡ŒåŸŸåå’ŒIPåœ°å€ä¹‹é—´å¯¹åº”å…³ç³»çš„è®°å½•å’ŒæŸ¥è¯¢ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒDNSè¿˜å¯ä»¥ç”¨ä½œè´Ÿè½½å‡è¡¡ã€‚ é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼ŒåŸŸåå’ŒIPå¹¶ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œè€Œæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªIPå¯ä»¥ç»‘å®šå¤šä¸ªåŸŸåï¼Œä¸€ä¸ªåŸŸåä¹Ÿå¯ä»¥è§£æåˆ°å¤šä¸ªIPã€‚æœ‰äº†è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨DNSæ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ æ³¨æ„è´Ÿè½½å‡è¡¡å¹¶éåªæœ‰DNSè¿™ä¸€ç§æ–¹å¼ 3.1 å†…éƒ¨è´Ÿè½½å‡è¡¡ï¼ˆSLBï¼‰ä¾‹å¦‚ï¼Œä¸€ä¸ªåº”ç”¨è¦è®¿é—®æ•°æ®åº“ï¼Œåœ¨è¿™ä¸ªåº”ç”¨é‡Œé¢åº”è¯¥é…ç½®è¿™ä¸ªæ•°æ®åº“çš„IPåœ°å€ï¼Œè¿˜æ˜¯åº”è¯¥é…ç½®è¿™ä¸ªæ•°æ®åº“çš„åŸŸåå‘¢ï¼Ÿæ˜¾ç„¶åº”è¯¥é…ç½®åŸŸåï¼Œå› ä¸ºä¸€æ—¦è¿™ä¸ªæ•°æ®åº“ï¼Œå› ä¸ºæŸç§åŸå› ï¼Œæ¢åˆ°äº†å¦å¤–ä¸€å°æœºå™¨ä¸Šï¼Œè€Œå¦‚æœæœ‰å¤šä¸ªåº”ç”¨éƒ½é…ç½®äº†è¿™å°æ•°æ®åº“çš„è¯ï¼Œä¸€æ¢IPåœ°å€ï¼Œå°±éœ€è¦å°†è¿™äº›åº”ç”¨å…¨éƒ¨ä¿®æ”¹ä¸€éã€‚ä½†æ˜¯å¦‚æœé…ç½®äº†åŸŸåï¼Œåˆ™åªè¦åœ¨DNSæœåŠ¡å™¨é‡Œï¼Œå°†åŸŸåæ˜ å°„ä¸ºæ–°çš„IPåœ°å€ï¼Œè¿™ä¸ªå·¥ä½œå°±å®Œæˆäº†ï¼Œå¤§å¤§ç®€åŒ–äº†è¿ç»´ã€‚ åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å†è¿›ä¸€æ­¥ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªåº”ç”¨è¦è®¿é—®å¦å¤–ä¸€ä¸ªåº”ç”¨ï¼Œå¦‚æœé…ç½®å¦å¤–ä¸€ä¸ªåº”ç”¨çš„IPåœ°å€ï¼Œé‚£ä¹ˆè¿™ä¸ªè®¿é—®å°±æ˜¯ä¸€å¯¹ä¸€çš„ã€‚ä½†æ˜¯å½“è¢«è®¿é—®çš„åº”ç”¨æ’‘ä¸ä½çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥éƒ¨ç½²å¤šä¸ªã€‚ä½†æ˜¯ï¼Œè®¿é—®å®ƒçš„åº”ç”¨ï¼Œå¦‚ä½•åœ¨å¤šä¸ªä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Ÿåªè¦é…ç½®æˆä¸ºåŸŸåå°±å¯ä»¥äº†ã€‚åœ¨åŸŸåè§£æçš„æ—¶å€™ï¼Œæˆ‘ä»¬åªè¦é…ç½®ç­–ç•¥ï¼Œè¿™æ¬¡è¿”å›ç¬¬ä¸€ä¸ªIPï¼Œä¸‹æ¬¡è¿”å›ç¬¬äºŒä¸ªIPï¼Œå°±å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡äº†ã€‚ 3.2 å…¨å±€è´Ÿè½½å‡è¡¡ï¼ˆGSLBï¼‰ è¿˜æ˜¯åˆšåˆšä¸Šé¢çš„é‚£ä¸ªå›¾ï¼Œæˆ‘ä»¬åŠ å…¥äº†GSLB1å’ŒGSLB2åœ¨æƒå¨åŸŸåæœåŠ¡å™¨åé¢ï¼Œæƒå¨æœåŠ¡å™¨ä¹‹å‰çš„è®¿é—®è¿‡ç¨‹å’Œä¸Šé¢æåˆ°çš„DNSè¯·æ±‚è¿‡ç¨‹ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä»¥è®¿é—®ç»´åŸºç™¾ç§‘(wikipedia.org)ä¸ºä¾‹ã€‚ æˆ‘ä»¬å…ˆå¯¹ç»´åŸºç™¾ç§‘(wikipedia.org)åšä¸€ä¸ªCNAMEè§£æï¼Œè®©å®ƒè§£æåˆ°glsb.wikipedia.orgè¿™ä¸ªGSLB1æœåŠ¡å™¨ï¼› å®¢æˆ·ç«¯è¯·æ±‚åˆ°æƒå¨åŸŸåæœåŠ¡å™¨ä¹‹åï¼Œè·å¾—äº†ä¸€ä¸ªglsb.wikipedia.orgçš„åœ°å€ï¼Œç„¶åå®¢æˆ·ç«¯å°±è®¿é—®glsb.wikipedia.orgè¿™ä¸ªæœåŠ¡å™¨ï¼Œæ³¨æ„è¿™ä¸ªæ—¶å€™glsb.wikipedia.orgåº”è¯¥æ˜¯å……å½“äº†æƒå¨åŸŸåæœåŠ¡å™¨çš„è§’è‰²ï¼› glsb.wikipedia.orgæ¥å—åˆ°è¯·æ±‚ä¹‹åï¼Œå¯ä»¥æ ¹æ®æ¥æºçš„IPåˆ¤æ–­æ˜¯å“ªä¸ªåœ°åŒºçš„è¯·æ±‚ï¼Œå‡è®¾æ˜¯ä¸­å›½ï¼Œé‚£å°±ç»™å®ƒè¿”å›ä¸€ä¸ªcn.glsb.wikipedia.orgçš„GSLB2çš„æœåŠ¡å™¨åœ°å€ï¼› GSLB2æ ¹æ®æ¥å—åˆ°çš„è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªç¦»å®¢æˆ·ç«¯æœ€è¿‘æœåŠ¡å™¨çš„IPåœ°å€ï¼Œä»è€Œå®ç°äº†GSLBçš„æ•ˆæœã€‚ GSLBå’Œæˆ‘ä»¬å¸¸è¯´çš„LVSã€NGINXè´Ÿè½½å‡è¡¡ç­‰æ–¹å¼çš„ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä¸åŒå°±æ˜¯åœ¨è¦†ç›–èŒƒå›´ç‰¹åˆ«å¹¿çš„æ—¶å€™ä½¿ç”¨æ•ˆæœä¼šæ›´å¥½ä¸€äº›ã€‚æ¯”å¦‚åœ¨ä¸­å›½çš„æœåŠ¡å™¨ä¸šåŠ¡ï¼Œè¦æ‰©å±•åˆ°ç¾å›½ï¼Œå‡è®¾ä¸šåŠ¡çš„è®¿é—®é‡ç¿»å€ï¼Œè¦å¢åŠ ä¸€å€çš„æœºå™¨ï¼Œå¯ä»¥é€‰æ‹©åœ¨åŸæœ‰çš„é›†ç¾¤ä¸Šå¢åŠ ä¸€å€çš„æœºå™¨ï¼Œæˆ–è€…åœ¨ç¾å›½å†éƒ¨ç½²ä¸€å¥—åŒæ ·çš„æœåŠ¡å™¨ï¼Œç„¶åé…ç½®DNSçš„GSLBæœåŠ¡å™¨æ¥å®ç°ã€‚æ˜¾ç„¶åè€…çš„æ•ˆæœä¼šæ›´å¥½ï¼Œå› ä¸ºç¾å›½çš„ç”¨æˆ·è®¿é—®ä¸­å›½çš„æœåŠ¡å™¨åœ¨é€Ÿåº¦ä¸Šè‚¯å®šæ˜¯æ²¡æœ‰è®¿é—®ç¾å›½çš„æœåŠ¡å™¨å¿«ã€‚ è¿™é‡Œåªæ˜¯æ‰“ä¸€ä¸ªä¸å¤ªæ°å½“çš„æ¯”å–»ï¼Œå®é™…ä¸Šè®¿é—®é‡ç¿»å€è‚¯å®šæ²¡è¿™ä¹ˆç®€å•ã€‚ä½†æ˜¯åœ¨è¿™ç§è·¨åœ°åŸŸçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸Šï¼ŒDNSçš„GSLBæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"},{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"}]},{"title":"iptablesçš„å››è¡¨äº”é“¾ä¸NATå·¥ä½œåŸç†","slug":"20200414-iptables-principle-introduction","date":"2020-04-14T02:00:00.000Z","updated":"2020-04-14T02:00:00.000Z","comments":true,"path":"20200414-iptables-principle-introduction/","link":"","permalink":"https://tinychen.com/20200414-iptables-principle-introduction/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†iptablesçš„åŸºæœ¬å·¥ä½œåŸç†å’Œå››è¡¨äº”é“¾ç­‰åŸºæœ¬æ¦‚å¿µä»¥åŠNATçš„å·¥ä½œåŸç†ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†iptablesçš„åŸºæœ¬å·¥ä½œåŸç†å’Œå››è¡¨äº”é“¾ç­‰åŸºæœ¬æ¦‚å¿µä»¥åŠNATçš„å·¥ä½œåŸç†ã€‚ 1ã€iptablesç®€ä»‹æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹netfilterå®˜ç½‘å¯¹iptablesçš„æè¿°ï¼š iptables is the userspace command line program used to configure the Linux 2.4.x and later packet filtering ruleset. It is targeted towards system administrators. Since Network Address Translation is also configured from the packet filter ruleset, iptables is used for this, too. The iptables package also includes ip6tables. ip6tables is used for configuring the IPv6 packet filter. ä¹Ÿå°±æ˜¯è¯´iptableså®é™…ä¸Šåªæ˜¯ä½äºç”¨æˆ·ç©ºé—´çš„ä¸€ä¸ªé¢å‘ç³»ç»Ÿç®¡ç†å‘˜çš„Linuxé˜²ç«å¢™çš„ç®¡ç†å·¥å…·è€Œå·²ï¼Œè€ŒçœŸæ­£å®ç°é˜²ç«å¢™åŠŸèƒ½çš„æ˜¯netfilterï¼Œå®ƒæ˜¯Linuxå†…æ ¸ä¸­å®ç°åŒ…è¿‡æ»¤çš„å†…æ ¸æ¨¡å—ï¼Œiptableså¯¹åº”åœ¨å†…æ ¸ä¸­çš„æ¨¡å—åº”è¯¥æ˜¯ip_tablesï¼Œæˆ‘ä»¬æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸ä¸­ip_tablesçš„ä¿¡æ¯çš„æ—¶å€™å¯ä»¥çœ‹åˆ°ip_tables.koè¿™ä¸ªæ¨¡å—æ˜¯åœ¨netfilterè¿™ä¸ªç›®å½•ä¸‹çš„ã€‚ å®é™…ä¸Šé™¤äº†iptablesè¿˜æœ‰å¦‚nftablesã€firewalldç­‰é˜²ç«å¢™å·¥å…·éƒ½æ˜¯åœ¨ç”¨æˆ·ç©ºé—´ï¼ˆç”¨æˆ·å±‚ï¼‰å¯¹ç›¸åº”çš„å†…æ ¸ç©ºé—´ä¸­å¯¹åº”çš„netfilterç›¸å…³çš„æ¨¡å—è¿›è¡Œæ“ä½œçš„å·¥å…·ã€‚ 2ã€iptablesçš„å››è¡¨äº”é“¾2.1 iptablesæµç¨‹å›¾é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™å¼ å›¾äº†è§£ä¸€ä¸‹iptablesä¸­çš„è¡¨å’Œé“¾çš„æ¦‚å¿µã€‚å›¾ä¸­ä½¿ç”¨ç®­å¤´å±•ç¤ºäº†ç”¨æˆ·è®¿é—®ä½¿ç”¨äº†iptablesçš„æœºå™¨çš„è¿‡ç¨‹ï¼Œå…¶ä¸­æŒ‰ç…§ç®­å¤´çš„é¡ºåºæˆ‘ä»¬å°±å¯ä»¥å°†å…¶æ¢³ç†ä¸ºä¸€æ¡å¤§çš„å¸¦æœ‰åˆ†æ”¯çš„é“¾æ¡ï¼Œåœ¨æ¯ä¸ªéœ€è¦è¿›è¡Œæ“ä½œçš„æ¨¡å—å¤„éƒ½æ ‡æœ‰åç§°å’Œç›¸åº”çš„æ‹¬å·ï¼Œæ‹¬å·å†…çš„å°±æ˜¯iptablesçš„å››è¡¨ï¼Œè€Œæ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥è§†ä¸ºä¸€ä¸ªé“¾ã€‚ CentOS7ä¸­çš„inputé“¾ä¸­è¿˜æœ‰natè¡¨ï¼Œä½†æ˜¯åœ¨CentOS6ä¸­å¹¶æ²¡æœ‰ã€‚ ä¹‹æ‰€ä»¥å«åšé“¾å°±æ˜¯å› ä¸ºåœ¨è®¿é—®è¯¥é“¾çš„æ—¶å€™ä¼šæŒ‰ç…§æ¯ä¸ªé“¾å¯¹åº”çš„è¡¨ä¾æ¬¡è¿›è¡ŒæŸ¥è¯¢åŒ¹é…æ‰§è¡Œçš„æ“ä½œï¼Œå¦‚PREROUTINGé“¾å¯¹åº”çš„å°±æ˜¯(raw-&gt;mangle-&gt;nat)ï¼Œæ¯ä¸ªè¡¨æŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºè¿›è¡Œè¿æ¥ï¼Œæ¯ä¸ªè¡¨ä¸­è¿˜å¯èƒ½æœ‰å¤šä¸ªè§„åˆ™ï¼Œå› æ­¤æœ€åçœ‹èµ·æ¥å°±åƒé“¾ä¸€æ ·ï¼Œå› æ­¤ç§°ä¸ºé“¾ã€‚è€Œiptablesçš„è¡¨ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹åº”çš„è§„åˆ™å’Œéœ€è¦æ‰§è¡Œçš„æ“ä½œï¼Œè¿™é‡Œä»¥è·¯ç”±å™¨ä¸ºä¾‹æŸ¥çœ‹å…¶ä¸­iptablesçš„filterè¡¨ï¼š æ³¨æ„æ¯ä¸€ä¸ªé“¾å¯¹åº”çš„è¡¨éƒ½æ˜¯ä¸å®Œå…¨ä¸€æ ·çš„ï¼Œè¡¨å’Œé“¾ä¹‹é—´æ˜¯å¤šå¯¹å¤šçš„å¯¹åº”å…³ç³»ã€‚ä½†æ˜¯ä¸ç®¡ä¸€ä¸ªé“¾å¯¹åº”å¤šå°‘ä¸ªè¡¨ï¼Œå®ƒçš„è¡¨éƒ½æ˜¯æŒ‰ç…§ä¸‹é¢çš„ä¼˜å…ˆé¡ºåºæ¥è¿›è¡ŒæŸ¥æ‰¾åŒ¹é…çš„ã€‚ è¡¨çš„å¤„ç†ä¼˜å…ˆçº§ï¼šraw&gt;mangle&gt;nat&gt;filterã€‚ 2.2 å››è¡¨iptablesçš„å››ä¸ªè¡¨iptable_filterï¼Œiptable_mangleï¼Œiptable_natï¼Œiptable_rawï¼Œé»˜è®¤è¡¨æ˜¯filterï¼ˆæ²¡æœ‰æŒ‡å®šè¡¨çš„æ—¶å€™å°±æ˜¯filterè¡¨ï¼‰ã€‚ filter è¡¨ï¼šç”¨æ¥å¯¹æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ï¼Œå…·ä½“çš„è§„åˆ™è¦æ±‚å†³å®šå¦‚ä½•å¤„ç†ä¸€ä¸ªæ•°æ®åŒ…ã€‚ å¯¹åº”çš„å†…æ ¸æ¨¡å—ä¸ºï¼šiptable_filterï¼Œå…¶è¡¨å†…åŒ…æ‹¬ä¸‰ä¸ªé“¾ï¼šinputã€forwardã€output; nat è¡¨ï¼šnat å…¨ç§°ï¼šnetwork address translation ç½‘ç»œåœ°å€è½¬æ¢ï¼Œä¸»è¦ç”¨æ¥ä¿®æ”¹æ•°æ®åŒ…çš„ IP åœ°å€ã€ç«¯å£å·ä¿¡æ¯ã€‚ å¯¹åº”çš„å†…æ ¸æ¨¡å—ä¸ºï¼šiptable_natï¼Œå…¶è¡¨å†…åŒ…æ‹¬ä¸‰ä¸ªé“¾ï¼špreroutingã€postroutingã€output; mangle è¡¨ï¼šä¸»è¦ç”¨æ¥ä¿®æ”¹æ•°æ®åŒ…çš„æœåŠ¡ç±»å‹ï¼Œç”Ÿå­˜å‘¨æœŸï¼Œä¸ºæ•°æ®åŒ…è®¾ç½®æ ‡è®°ï¼Œå®ç°æµé‡æ•´å½¢ã€ç­–ç•¥è·¯ç”±ç­‰ã€‚ å¯¹åº”çš„å†…æ ¸æ¨¡å—ä¸ºï¼šiptable_mangleï¼Œå…¶è¡¨å†…åŒ…æ‹¬äº”ä¸ªé“¾ï¼špreroutingã€postroutingã€inputã€outputã€forward; raw è¡¨ï¼šä¸»è¦ç”¨æ¥å†³å®šæ˜¯å¦å¯¹æ•°æ®åŒ…è¿›è¡ŒçŠ¶æ€è·Ÿè¸ªã€‚ å¯¹åº”çš„å†…æ ¸æ¨¡å—ä¸ºï¼šiptable_rawï¼Œå…¶è¡¨å†…åŒ…æ‹¬ä¸¤ä¸ªé“¾ï¼šoutputã€prerouting; rawè¡¨åªä½¿ç”¨åœ¨PREROUTINGé“¾å’ŒOUTPUTé“¾ä¸Š,å› ä¸ºä¼˜å…ˆçº§æœ€é«˜ï¼Œä»è€Œå¯ä»¥å¯¹æ”¶åˆ°çš„æ•°æ®åŒ…åœ¨ç³»ç»Ÿè¿›è¡Œip_conntrackï¼ˆè¿æ¥è·Ÿè¸ªï¼‰å‰è¿›è¡Œå¤„ç†ã€‚ä¸€ä½†ç”¨æˆ·ä½¿ç”¨äº†rawè¡¨,åœ¨æŸä¸ªé“¾ä¸Šï¼Œrawè¡¨å¤„ç†å®Œåï¼Œå°†è·³è¿‡NATè¡¨å’Œip_conntrackå¤„ç†ï¼Œå³ä¸å†åšåœ°å€è½¬æ¢å’Œæ•°æ®åŒ…çš„é“¾æ¥è·Ÿè¸ªå¤„ç†äº†ã€‚RAWè¡¨å¯ä»¥åº”ç”¨åœ¨é‚£äº›ä¸éœ€è¦åšnatçš„æƒ…å†µä¸‹ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ 2.3 äº”é“¾iptablesçš„äº”ä¸ªé“¾PREROUTINGï¼ŒINPUTï¼ŒFORWARDï¼ŒOUTPUTï¼ŒPOSTROUTINGã€‚ input é“¾ï¼šå½“æ”¶åˆ°è®¿é—®é˜²ç«å¢™æœ¬æœºåœ°å€çš„æ•°æ®åŒ…æ—¶ï¼Œå°†åº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ï¼› output é“¾ï¼šå½“é˜²ç«å¢™æœ¬æœºå‘å¤–å‘é€æ•°æ®åŒ…æ—¶ï¼Œå°†åº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ï¼› forward é“¾ï¼šå½“æ”¶åˆ°éœ€è¦é€šè¿‡é˜²ç«ä¸­è½¬å‘ç»™å…¶ä»–åœ°å€çš„æ•°æ®åŒ…æ—¶ï¼Œå°†åº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ï¼Œæ³¨æ„å¦‚æœéœ€è¦å®ç°forwardè½¬å‘éœ€è¦å¼€å¯Linuxå†…æ ¸ä¸­çš„ip_forwardåŠŸèƒ½ï¼› prerouting é“¾ï¼šåœ¨å¯¹æ•°æ®åŒ…åšè·¯ç”±é€‰æ‹©ä¹‹å‰ï¼Œå°†åº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ï¼› postrouting é“¾ï¼šåœ¨å¯¹æ•°æ®åŒ…åšè·¯ç”±é€‰æ‹©ä¹‹åï¼Œå°†åº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ï¼› 2.4 iptablesçš„å¸¸è§æƒ…å†µä¸‹é¢æˆ‘ä»¬åˆ©ç”¨ä¸Šé¢çš„æµç¨‹å›¾æ¥å¯¹å‡ ç§å¸¸è§çš„æƒ…å†µè§£æï¼šå…³é”®ç‚¹åœ¨äºå‘å¾€iptablesä¸»æœºçš„æ•°æ®åŒ…çš„ç›®çš„åœ°å€æ˜¯å¦æ˜¯iptablesä¸»æœºæœ¬æœºã€‚å¦‚æœæ˜¯ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ç†è§£ä¸ºå¸¸è§çš„å¼€å¯äº†iptablesé˜²ç«å¢™çš„ç½‘ç«™æœåŠ¡å™¨ä¸»æœºï¼›å¦‚æœä¸æ˜¯ï¼Œé‚£å°±æ˜¯èµ°ip_forwardè¿›è¡Œè½¬å‘ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„NATè·¯ç”±å™¨çš„NATæœåŠ¡å’Œç­–ç•¥è·¯ç”±ç­‰ã€‚å¦‚ä¸‹å›¾ä¸ºå¼€å¯äº†ip_forwardåŠŸèƒ½çš„openwrtè·¯ç”±å™¨ã€‚ 3ã€NATå·¥ä½œåŸç†æ¥ä¸‹æ¥ä»‹ç»ä¸€äº›NAT(Network Address Translationï¼Œç½‘ç»œåœ°å€è½¬æ¢)çš„åŸºæœ¬çŸ¥è¯†ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼ŒIPv4çš„å…¬ç½‘IPåœ°å€å·²ç»æ¯ç«­ï¼Œä½†æ˜¯éœ€è¦æ¥å…¥äº’è”ç½‘çš„è®¾å¤‡è¿˜åœ¨ä¸æ–­å¢åŠ ï¼Œè¿™å…¶ä¸­NATå°±å‘æŒ¥äº†å¾ˆå¤§çš„ä½œç”¨ï¼ˆæ­¤å¤„ä¸è®¨è®ºIPv6ï¼‰ã€‚NATæœåŠ¡å™¨æä¾›äº†ä¸€ç»„ç§æœ‰çš„IPåœ°å€æ± ï¼ˆ10.0.0.0/8ã€172.16.0.0/12ã€192.168.0.0/16ï¼‰ï¼Œä½¿å¾—è¿æ¥è¯¥NATæœåŠ¡å™¨çš„è®¾å¤‡èƒ½å¤Ÿè·å¾—ä¸€ä¸ªç§æœ‰çš„IPåœ°å€ï¼ˆä¹Ÿç§°å±€åŸŸç½‘IP/å†…ç½‘IPï¼‰ï¼Œå½“è®¾å¤‡éœ€è¦è¿æ¥äº’è”ç½‘çš„æ—¶å€™ï¼ŒNATæœåŠ¡å™¨å°†è¯¥è®¾å¤‡çš„ç§æœ‰IPè½¬æ¢æˆå¯ä»¥åœ¨äº’è”ç½‘ä¸Šè·¯ç”±çš„å…¬ç½‘IPï¼ˆå…¨çƒå”¯ä¸€ï¼‰ã€‚NATçš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸‰ç§ï¼šé™æ€NATã€åŠ¨æ€NATå’Œç½‘ç»œåœ°å€ç«¯å£è½¬æ¢ï¼ˆNAPTï¼‰ã€‚ 3.1 BNAT é™æ€NATï¼šLVSçš„å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿç§°ä¸º(N-to-N mapping)ï¼Œå‰é¢çš„NæŒ‡çš„æ˜¯å±€åŸŸç½‘ä¸­éœ€è¦è”ç½‘çš„è®¾å¤‡æ•°é‡ï¼Œåé¢çš„NæŒ‡çš„æ˜¯è¯¥NATæœåŠ¡å™¨æ‰€æ‹¥æœ‰çš„å…¬ç½‘IPçš„æ•°é‡ã€‚æ—¢ç„¶æ•°é‡ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ç°é™æ€è½¬æ¢ï¼Œå³ä¸€ä¸ªè®¾å¤‡å¯¹åº”ä¸€ä¸ªå…¬ç½‘IPï¼Œè¿™æ—¶å€™çš„NATæœåŠ¡å™¨åªéœ€è¦ç»´æŠ¤ä¸€å¼ é™æ€çš„NATæ˜ å°„è½¬æ¢è¡¨ã€‚ å†…ç½‘IP å¤–ç½‘IP 192.168.1.55 219.152.168.222 192.168.1.59 219.152.168.223 192.168.1.155 219.152.168.224 åŠ¨æ€NATï¼šLVSçš„å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿç§°ä¸º(M-to-N mapping)ï¼Œæ³¨æ„è¿™æ—¶å€™çš„M&gt;Nï¼Œä¹Ÿå°±æ˜¯è¯´å±€åŸŸç½‘ä¸­éœ€è¦è”ç½‘çš„è®¾å¤‡æ•°é‡å¤šäºNATæœåŠ¡å™¨æ‹¥æœ‰çš„å…¬ç½‘IPæ•°é‡ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”±NATæœåŠ¡å™¨æ¥å®ç°åŠ¨æ€çš„è½¬æ¢ï¼Œè¿™æ ·æ¯ä¸ªå†…ç½‘è®¾å¤‡è®¿é—®å…¬ç½‘çš„æ—¶å€™ä½¿ç”¨çš„å…¬ç½‘IPå°±ä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªIPã€‚ åœ¨ä¸€äº›å®¶ç”¨è·¯ç”±å™¨ä¸­ï¼ŒDMZæ˜¯æŒ‡ä¸€éƒ¨æ‰€æœ‰ç«¯å£éƒ½æš´éœ²åœ¨å¤–éƒ¨ç½‘ç»œçš„å†…éƒ¨ç½‘ç»œä¸»æœºï¼Œé™¤æ­¤ä»¥å¤–çš„ç«¯å£éƒ½è¢«è½¬å‘ã€‚ä¸¥æ ¼æ¥è¯´è¿™ä¸æ˜¯çœŸæ­£çš„DMZï¼Œå› ä¸ºè¯¥ä¸»æœºä»èƒ½è®¿é—®å†…éƒ¨ç½‘ç»œï¼Œå¹¶éç‹¬ç«‹äºå†…éƒ¨ç½‘ç»œä¹‹å¤–çš„ã€‚ä½†çœŸæ­£çš„DMZæ˜¯ä¸å…è®¸è®¿é—®å†…éƒ¨ç½‘ç»œçš„ï¼ŒDMZå’Œå†…éƒ¨ç½‘ç»œæ˜¯åˆ†å¼€çš„ã€‚è¿™ç§ DMZä¸»æœºå¹¶æ²¡æœ‰çœŸæ­£DMZæ‰€æ‹¥æœ‰çš„å­ç½‘åˆ’åˆ†çš„å®‰å…¨ä¼˜åŠ¿ï¼Œå…¶å¸¸å¸¸ä»¥ä¸€ç§ç®€å•çš„æ–¹æ³•å°†æ‰€æœ‰ç«¯å£è½¬å‘åˆ°å¦å¤–çš„é˜²ç«å¢™æˆ–NATè®¾å¤‡ä¸Šã€‚ 3.2 NAPTä»¥ä¸Šçš„è¿™ä¸¤ç§éƒ½å±äºåŸºæœ¬ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆBasic NATï¼‰ï¼Œè¿™ç§è½¬æ¢åœ¨æŠ€æœ¯ä¸Šæ¯”è¾ƒç®€å•ï¼Œä»…æ”¯æŒåœ°å€è½¬æ¢ï¼Œä¸æ”¯æŒç«¯å£æ˜ å°„ï¼Œè¿™ä¹Ÿå°±å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯èµ„æºçš„æµªè´¹ã€‚æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªIPå®é™…ä¸Šå¯ä»¥å¯¹åº”å¤šä¸ªç«¯å£ï¼Œè€Œæˆ‘ä»¬è®¿é—®åº”ç”¨å®é™…ä¸Šæ˜¯é€šè¿‡IPåœ°å€+ç«¯å£å·çš„å½¢å¼æ¥è®¿é—®çš„ï¼Œå³å®¢æˆ·ç«¯è®¿é—®çš„æ—¶å€™å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºç›‘å¬çš„ç«¯å£å³å¯å®ç°è®¿é—®ã€‚é‚£ä¹ˆNAPTå°±æ˜¯åœ¨è¿™åŸºç¡€ä¸Šçš„æ‰©å±•å»¶ç”³ï¼Œå®ƒåœ¨IPåœ°å€çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†ç«¯å£å·ï¼Œæ”¯æŒäº†ç«¯å£æ˜ å°„çš„åŠŸèƒ½ã€‚ NAPTï¼šNAPTå®é™…ä¸Šè¿˜å¯ä»¥åˆ†ä¸ºæºåœ°å€è½¬æ¢ï¼ˆSNATï¼‰å’Œç›®çš„åœ°å€è½¬æ¢ï¼ˆDNATï¼‰ä¸¤ç§ã€‚æ³¨æ„è¿™ä¸ªæºåœ°å€å’Œç›®çš„åœ°å€æ˜¯é’ˆå¯¹NATæœåŠ¡å™¨è€Œè¨€ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢ä¸€å¼ å›¾æ¥è¯´æ˜ï¼š é¦–å…ˆæˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä¸Šé¢è¿è¡Œç€ä¸€ä¸ªæµè§ˆå™¨ï¼Œå‡è®¾å®ƒä½¿ç”¨çš„æ˜¯5566ç«¯å£ï¼Œå®ƒéœ€è¦è®¿é—®14.25.23.47è¿™ä¸ªWebæœåŠ¡å™¨çš„HTTPSæœåŠ¡çš„443ç«¯å£ï¼Œå®ƒåœ¨è®¿é—®çš„æ—¶å€™éœ€è¦ç»è¿‡å±€åŸŸç½‘å‡ºå£çš„è¿™ä¸ªè·¯ç”±å™¨ç½‘å…³ï¼ˆåŒæ—¶ä¹Ÿæ˜¯NATæœåŠ¡å™¨ï¼‰ï¼Œè·¯ç”±å™¨å¯¹å®ƒè¿›è¡Œä¸€ä¸ªNAPTçš„æºåœ°å€è½¬æ¢ï¼ˆSNATï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯çš„è¯·æ±‚ç»è¿‡NATæœåŠ¡å™¨ä¹‹åå˜æˆäº†222.17.23.45:7788è¿™ä¸ªIPç«¯å£å¯¹WebæœåŠ¡å™¨çš„443ç«¯å£è¿›è¡Œè®¿é—®ã€‚æ³¨æ„åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç›®æ ‡æœåŠ¡å™¨ï¼ˆWebæœåŠ¡å™¨ï¼‰çš„IPå’Œç«¯å£æ˜¯ä¸€ç›´æ²¡æœ‰æ”¹å˜çš„ã€‚ æ¥ä¸‹æ¥åœ¨WebæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œéœ€è¦è¿”å›æ•°æ®ç»™å‘é€è¯·æ±‚çš„è®¾å¤‡ï¼Œæ³¨æ„è¿™æ—¶å€™webæœåŠ¡å™¨è¿”å›æ•°æ®çš„æŒ‡å‘IPåº”è¯¥æ˜¯åˆšåˆšNATæœåŠ¡å™¨å‘é€è¯·æ±‚çš„227.17.23.45:7788è¿™ä¸ªIPç«¯å£ï¼Œè¿™æ—¶å€™è·¯ç”±å™¨ç½‘å…³å†è¿›è¡Œä¸€æ¬¡NAPTçš„ç›®æ ‡åœ°å€è½¬æ¢ï¼ˆDNATï¼‰ï¼Œç›®æ ‡çš„IPç«¯å£å°±æ˜¯æœ€å¼€å§‹å‘é€è¯·æ±‚çš„192.168.1.77:5566è¿™ä¸ªç«¯å£ã€‚ å®é™…ä¸Šå¯¹äºå¤§å¤šæ•°äººæ¥è¯´æ—¥å¸¸æ¥è§¦åˆ°æœ€å¤šçš„å°±æ˜¯è·¯ç”±å™¨åšçš„SNATå’ŒDNATæ“ä½œï¼Œå®ƒä»¬ä¸€èˆ¬æˆå¯¹å‡ºç°ç”¨äºè§£å†³å…¬ç½‘IPèµ„æºä¸è¶³çš„é—®é¢˜ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯NATæ˜¯å¯ä»¥è¿›è¡ŒåµŒå¥—æ“ä½œçš„ï¼Œå³NATä¸‹é¢çš„ç½‘ç»œè®¾å¤‡è¿˜å¯ä»¥ç»§ç»­åšNATï¼Œåªè¦åšNATçš„ç½‘æ®µä¸å’Œä¸Šå±‚çš„NATçš„ç½‘æ®µç›¸åŒå³å¯ã€‚ 4ã€iptablesé…ç½®åœ¨äº†è§£æ¸…æ¥šiptablesçš„å·¥ä½œåŸç†å’Œæ¯ä¸ªè¡¨ä»¥åŠé“¾çš„ä½œç”¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å…¶ç‰¹ç‚¹è¿›è¡Œé’ˆå¯¹æ€§çš„é…ç½®ã€‚ iptables çš„åŸºæœ¬è¯­æ³•å‘½ä»¤æ ¼å¼ 1iptables [-t è¡¨å] ç®¡ç†é€‰é¡¹ [é“¾å] [åŒ¹é…æ¡ä»¶] [-j æ§åˆ¶ç±»å‹] è¡¨åã€é“¾åï¼šæŒ‡å®šiptableså‘½ä»¤æ‰€æ“ä½œçš„è¡¨å’Œé“¾ï¼ŒæœªæŒ‡å®šè¡¨åæ—¶å°†é»˜è®¤ä½¿ç”¨filterè¡¨ï¼› ç®¡ç†é€‰é¡¹ï¼šè¡¨ç¤ºiptablesè§„åˆ™çš„æ“ä½œæ–¹å¼ï¼Œæ¯”å¦‚ï¼šæ’å…¥ã€å¢åŠ ã€åˆ é™¤ã€æŸ¥çœ‹ç­‰ï¼› åŒ¹é…æ¡ä»¶ï¼šæŒ‡å®šè¦å¤„ç†çš„æ•°æ®åŒ…çš„ç‰¹å¾ï¼Œä¸ç¬¦åˆæŒ‡å®šæ¡ä»¶çš„æ•°æ®åŒ…ä¸å¤„ç†ï¼› æ§åˆ¶ç±»å‹ï¼šæŒ‡æ•°æ®åŒ…çš„å¤„ç†æ–¹å¼ï¼Œæ¯”å¦‚ï¼šå…è®¸acceptã€æ‹’ç»rejectã€ä¸¢å¼ƒdropã€æ—¥å¿—LOGç­‰ï¼› 123456789101112iptables å‘½ä»¤çš„å¸¸ç”¨ç®¡ç†é€‰é¡¹-A:åœ¨æŒ‡å®šé“¾çš„æœ«å°¾æ·»åŠ ä¸€æ¡æ–°çš„è§„åˆ™-D:åˆ é™¤æŒ‡å®šé“¾ä¸­çš„æŸä¸€æ¡è§„åˆ™ï¼Œå¯åˆ é™¤æŒ‡å®šåºå·æˆ–å…·ä½“å†…å®¹-I:åœ¨æŒ‡å®šé“¾ä¸­æ’å…¥ä¸€æ¡æ–°è§„åˆ™ï¼ŒæœªæŒ‡å®šåºå·æ—¶é»˜è®¤ä½œä¸ºç¬¬ä¸€æ¡è§„åˆ™-R:ä¿®æ”¹ã€æ›¿æ¢æŒ‡å®šé“¾ä¸­çš„æŸä¸€æ¡è§„åˆ™ï¼Œå¯æŒ‡å®šè§„åˆ™åºå·æˆ–å…·ä½“å†…å®¹-L:åˆ—å‡ºæŒ‡å®šé“¾ä¸­æ‰€æœ‰çš„è§„åˆ™ï¼ŒæœªæŒ‡å®šé“¾åï¼Œåˆ™åˆ—å‡ºè¡¨ä¸­çš„æ‰€æœ‰é“¾-F:æ¸…ç©ºæŒ‡å®šé“¾ä¸­æ‰€æœ‰çš„è§„åˆ™ï¼ŒæœªæŒ‡å®šé“¾åï¼Œåˆ™æ¸…ç©ºè¡¨ä¸­çš„æ‰€æœ‰é“¾-P:è®¾ç½®æŒ‡å®šé“¾çš„é»˜è®¤ç­–ç•¥-n:ä½¿ç”¨æ•°å­—å½¢å¼æ˜¾ç¤ºè¾“å‡ºç»“æœ-v:æŸ¥çœ‹è§„åˆ™åˆ—è¡¨æ—¶æ˜¾ç¤ºè¯¦ç»†çš„ä¿¡æ¯-h:æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ä¿¡æ¯--line-numbers:æŸ¥çœ‹è§„åˆ™åˆ—è¡¨æ—¶ï¼ŒåŒæ—¶æ˜¾ç¤ºè§„åˆ™åœ¨é“¾ä¸­çš„é¡ºåºå· åœ¨æ·»åŠ è§„åˆ™ä¹‹å‰æˆ‘ä»¬å…ˆå¼€å¯iptablesçš„ç‹¬ç«‹logåŠŸèƒ½ï¼Œå¯¹äºcentos6ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š 1234echo &quot;kern.* /var/log/iptables.log&quot; &gt;&gt; /etc/rsyslog.conf# è®°å½•æ‰€æœ‰çº§åˆ«çš„æ—¥å¿—åˆ°æŒ‡å®šç›®å½•ä¸­service rsyslog restart# é‡å¯rsyslogæœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ æ¥ç€æˆ‘ä»¬å¼€å§‹æ·»åŠ ä¸€æ¡æ¯”è¾ƒæœ‰é’ˆå¯¹æ€§çš„è§„åˆ™ï¼š 12iptables -A INPUT -j LOG --log-prefix &quot;*** INPUT ***&quot; --log-level debugiptables -t filter -A INPUT -p tcp -s 192.168.100.100 --dport 80 -j REJECT ä¸Šè¿°ä¸¤æ¡å‘½ä»¤ç¬¬ä¸€æ¡å¢åŠ äº†ä¸€æ¡è®°å½•æ—¥å¿—çš„è§„åˆ™ï¼Œå¯¹äºINPUTé“¾ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œæ·»åŠ æ—¥å¿—å‰ç¼€*** INPUT ***å¹¶è®¾å®šæ—¥å¿—çº§åˆ«ä¸ºdebug ç¬¬äºŒæ¡æ˜¯åœ¨INPUTé“¾çš„filterè¡¨ä¸­æ’å…¥ä¸€æ¡è§„åˆ™ï¼Œé™å®šå¯¹192.168.100.100è¿™ä¸ªIPä½¿ç”¨tcpåè®®è®¿é—®æœ¬æœºçš„ç›®çš„ç«¯å£80ç«¯å£çš„æ—¶å€™æ‹’ç»æ‰æ•°æ®åŒ…ã€‚ æ¥ç€æˆ‘ä»¬å°è¯•è®¿é—®å‘ç°æ— æ³•æ­£å¸¸æ˜¾ç¤ºé¡µé¢ã€‚ å†æŸ¥çœ‹æ—¥å¿—å‘ç°iptablesæ—¥å¿—ä¸­å¤šäº†å¾ˆå¤šè¯·æ±‚è¢«æ‹’ç»çš„è®°å½•ã€‚ å†æ¸…ç©ºæ‰€æœ‰çš„è§„åˆ™ï¼Œæ­¤æ—¶å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä¸”ä¸å†ç»§ç»­è®°å½•æ—¥å¿—ï¼Œå› ä¸ºè®°å½•æ—¥å¿—çš„é‚£æ¡è§„åˆ™ä¹Ÿè¢«æˆ‘ä»¬æ¸…ç©ºæ‰äº†ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"iptables","slug":"iptables","permalink":"https://tinychen.com/tags/iptables/"},{"name":"nat","slug":"nat","permalink":"https://tinychen.com/tags/nat/"}]},{"title":"Cephç³»åˆ—02-ä½¿ç”¨ceph-deployéƒ¨ç½²cephé›†ç¾¤","slug":"20200410-ceph-02-ceph-deploy-deploy-ceph","date":"2020-04-10T02:00:00.000Z","updated":"2020-04-10T02:00:00.000Z","comments":true,"path":"20200410-ceph-02-ceph-deploy-deploy-ceph/","link":"","permalink":"https://tinychen.com/20200410-ceph-02-ceph-deploy-deploy-ceph/","excerpt":"ä½¿ç”¨ceph-deployéƒ¨ç½²cephé›†ç¾¤å¹¶é…ç½®ceph-dashboardã€‚","text":"ä½¿ç”¨ceph-deployéƒ¨ç½²cephé›†ç¾¤å¹¶é…ç½®ceph-dashboardã€‚ 1ã€å‡†å¤‡å·¥ä½œ1.1 å…³é—­selinuxï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰1234setenforce 0sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=disabled/&#x27; /etc/selinux/config# ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹/etc/selinux/configæ–‡ä»¶ 1.2 é…ç½®ntpæ—¶é—´åŒæ­¥ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰å…·ä½“çš„æ“ä½œå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ã€‚ 1.3 å®‰è£…epelæº1sudo yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm 1.4 å¯¼å…¥repoä»“åº“123456789cat &lt;&lt; EOM &gt; /etc/yum.repos.d/ceph.repo[ceph-noarch]name=Ceph noarch packagesbaseurl=https://download.ceph.com/rpm-&#123;ceph-stable-release&#125;/el7/noarchenabled=1gpgcheck=1type=rpm-mdgpgkey=https://download.ceph.com/keys/release.ascEOM æ³¨æ„è¿™é‡Œçš„{ceph-stable-release}è¦æ¢æˆå¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œå¦‚æˆ‘è¿™é‡Œå°±æ˜¯ï¼š 123456789cat &lt;&lt; EOM &gt; /etc/yum.repos.d/ceph.repo[ceph-noarch]name=Ceph noarch packagesbaseurl=https://download.ceph.com/rpm-octopus/el7/noarchenabled=1gpgcheck=1type=rpm-mdgpgkey=https://download.ceph.com/keys/release.ascEOM ç„¶åæ›´æ–°yum repo 12yum clean allyum repolist 1.5 å®‰è£…pythonå·¥å…·1sudo yum install python-setuptools 1.6 å®‰è£…ceph-deploy12sudo yum updatesudo yum install ceph-deploy æ³¨æ„è¿™é‡Œçš„ç‰ˆæœ¬ä¸º2.0.1è¦æ¯”epelä¸­çš„1.5.xè¦æ–°ä¸€äº›ï¼Œåé¢çš„repoä¹Ÿåº”è¯¥æ˜¯åˆšåˆšå¯¼å…¥çš„ceph repo 1.7 åˆ›å»ºcephéƒ¨ç½²ç”¨æˆ·ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·ä¸“é—¨ç”¨æ¥ç»™ceph-deployéƒ¨ç½²ï¼Œä½¿ç”¨ceph-deployéƒ¨ç½²çš„æ—¶å€™åªéœ€è¦åŠ ä¸Š--usernameé€‰é¡¹å³å¯æŒ‡å®šç”¨æˆ·ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š ä¸å»ºè®®ä½¿ç”¨root ä¸èƒ½ä½¿ç”¨cephä¸ºç”¨æˆ·åï¼Œå› ä¸ºåé¢çš„éƒ¨ç½²ä¸­éœ€è¦ç”¨åˆ°è¯¥ç”¨æˆ·åï¼Œå¦‚æœç³»ç»Ÿä¸­å·²å­˜åœ¨è¯¥ç”¨æˆ·åˆ™ä¼šå…ˆåˆ é™¤æ‰è¯¥ç”¨æˆ·ï¼Œç„¶åå°±ä¼šå¯¼è‡´éƒ¨ç½²å¤±è´¥ è¯¥ç”¨æˆ·éœ€è¦å…·å¤‡è¶…çº§ç”¨æˆ·æƒé™ï¼ˆsudoï¼‰ï¼Œå¹¶ä¸”ä¸éœ€è¦è¾“å…¥å¯†ç ä½¿ç”¨sudoæƒé™ æ‰€æœ‰çš„èŠ‚ç‚¹å‡éœ€è¦åˆ›å»ºè¯¥ç”¨æˆ· è¯¥ç”¨æˆ·éœ€è¦åœ¨cephé›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨ä¹‹é—´å…å¯†sshç™»å½• åˆ›å»ºæ–°ç”¨æˆ· 12sudo useradd -d /home/&#123;username&#125; -m &#123;username&#125;sudo passwd &#123;username&#125; é…ç½®sudoæƒé™å¹¶è®¾ç½®å…å¯† 12echo &quot;&#123;username&#125; ALL = (root) NOPASSWD:ALL&quot; | sudo tee /etc/sudoers.d/&#123;username&#125;sudo chmod 0440 /etc/sudoers.d/&#123;username&#125; å¦‚æœæˆ‘ä»¬çš„èŠ‚ç‚¹å·²ç»è®¾ç½®äº†sshå…å¯†ç™»å½•ï¼Œå¯ä»¥ç›´æ¥æŠŠå…å¯†ç™»å½•ç”¨æˆ·çš„sshæ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ–°å»ºçš„ç”¨æˆ·ç›®å½•ä¸‹ï¼Œè¿™é‡Œä»¥rootç”¨æˆ·ä¸ºä¾‹ã€‚{username}è¯·æ›¿æ¢æˆéœ€è¦æ–°å»ºçš„ç”¨æˆ·åã€‚ 12sudo cp -R /root/.ssh/ /home/&#123;username&#125;/sudo chown &#123;username&#125;:&#123;username&#125; /home/&#123;username&#125;/.ssh/ -R ç¼–è¾‘deployèŠ‚ç‚¹çš„sshæ–‡ä»¶ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–è¾‘deployèŠ‚ç‚¹çš„sshé…ç½®æ–‡ä»¶æ¥æŒ‡å®šç™»å½•åˆ°cephå…¶ä»–èŠ‚ç‚¹çš„ç”¨æˆ·ï¼š 123456789Host node1 Hostname node1 User &#123;username&#125;Host node2 Hostname node2 User &#123;username&#125;Host node3 Hostname node3 User &#123;username&#125; åœ¨æˆ‘è¿™é‡Œæ›¿æ¢æˆ 123456789Host ceph71 Hostname ceph71 User cephDeployHost ceph72 Hostname ceph72 User cephDeployHost ceph73 Hostname ceph73 User cephDeploy 1.8 é˜²ç«å¢™ä¸­æ”¾è¡Œç«¯å£1234567sudo firewall-cmd --zone=public --add-service=ceph-mon --permanent# on monitorssudo firewall-cmd --zone=public --add-service=ceph --permanent# on OSDs and MDSssudo firewall-cmd --reload ä¹Ÿå¯ä»¥ç›´æ¥å…³é—­æˆ–ç¦ç”¨é˜²ç«å¢™ 1.9 å®‰è£…yumæ’ä»¶1sudo yum install yum-plugin-priorities Ensure that your package manager has priority/preferences packages installed and enabled. On CentOS, you may need to install EPEL. On RHEL, you may need to enable optional repositories. 2ã€éƒ¨ç½²ceph2.1 åˆ›å»ºéƒ¨ç½²ç›®å½•1234[cephDeploy@ceph71 ~]$ mkdir my-cluster[cephDeploy@ceph71 ~]$ cd my-cluster[cephDeploy@ceph71 my-cluster]$ pwd/home/cephDeploy/my-cluster ç”±äºéƒ¨ç½²è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆè®¸å¤šæ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸“é—¨åˆ›å»ºä¸€ä¸ªç›®å½•ç”¨äºå­˜æ”¾ã€‚ 2.2 åˆå§‹åŒ–monèŠ‚ç‚¹123456789101112131415161718192021222324252627282930313233343536[cephDeploy@ceph71 my-cluster]$ ceph-deploy new ceph71[ceph_deploy.conf][DEBUG ] found configuration file at: /home/cephDeploy/.cephdeploy.conf[ceph_deploy.cli][INFO ] Invoked (2.0.1): /usr/bin/ceph-deploy new ceph71[ceph_deploy.cli][INFO ] ceph-deploy options:[ceph_deploy.cli][INFO ] username : None[ceph_deploy.cli][INFO ] func : &lt;function new at 0x7f7f15a43e60&gt;[ceph_deploy.cli][INFO ] verbose : False[ceph_deploy.cli][INFO ] overwrite_conf : False[ceph_deploy.cli][INFO ] quiet : False[ceph_deploy.cli][INFO ] cd_conf : &lt;ceph_deploy.conf.cephdeploy.Conf instance at 0x7f7f151ba950&gt;[ceph_deploy.cli][INFO ] cluster : ceph[ceph_deploy.cli][INFO ] ssh_copykey : True[ceph_deploy.cli][INFO ] mon : [&#x27;ceph71&#x27;][ceph_deploy.cli][INFO ] public_network : None[ceph_deploy.cli][INFO ] ceph_conf : None[ceph_deploy.cli][INFO ] cluster_network : None[ceph_deploy.cli][INFO ] default_release : False[ceph_deploy.cli][INFO ] fsid : None[ceph_deploy.new][DEBUG ] Creating new cluster named ceph[ceph_deploy.new][INFO ] making sure passwordless SSH succeeds[ceph71][DEBUG ] connection detected need for sudo[ceph71][DEBUG ] connected to host: ceph71 [ceph71][DEBUG ] detect platform information from remote host[ceph71][DEBUG ] detect machine type[ceph71][DEBUG ] find the location of an executable[ceph71][INFO ] Running command: sudo /usr/sbin/ip link show[ceph71][INFO ] Running command: sudo /usr/sbin/ip addr show[ceph71][DEBUG ] IP addresses found: [u&#x27;240e:f8:a903:2455:5054:ff:fe99:871&#x27;, u&#x27;192.168.122.71&#x27;, u&#x27;192.168.100.71&#x27;][ceph_deploy.new][DEBUG ] Resolving host ceph71[ceph_deploy.new][DEBUG ] Monitor ceph71 at 192.168.122.71[ceph_deploy.new][DEBUG ] Monitor initial members are [&#x27;ceph71&#x27;][ceph_deploy.new][DEBUG ] Monitor addrs are [&#x27;192.168.122.71&#x27;][ceph_deploy.new][DEBUG ] Creating a random mon key...[ceph_deploy.new][DEBUG ] Writing monitor keyring to ceph.mon.keyring...[ceph_deploy.new][DEBUG ] Writing initial config to ceph.conf...[cephDeploy@ceph71 my-cluster]$ 2.3 æŒ‡å®šç½‘å¡ç”±äºæˆ‘ä»¬è¿™é‡Œçš„è™šæ‹Ÿæœºæ¯å°éƒ½æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŒ‡å®šcephé›†ç¾¤ç”¨äºé€šä¿¡çš„ç½‘å¡æ‰€åœ¨çš„ç½‘æ®µ 2.4 å®‰è£…cephåœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šéƒ½å®‰è£…ceph 1ceph-deploy install ceph71 ceph72 ceph73 åˆå§‹åŒ–mon 1ceph-deploy mon create-initial é¡ºåˆ©æ‰§è¡Œåä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ç³»åˆ—ç›¸å…³çš„å¯†é’¥æ–‡ä»¶ ä½¿ç”¨ceph-deployå¤åˆ¶é…ç½®æ–‡ä»¶å’Œå¯†é’¥ Use ceph-deploy to copy the configuration file and admin key to your admin node and your Ceph Nodes so that you can use the ceph CLI without having to specify the monitor address and ceph.client.admin.keyring each time you execute a command. 1ceph-deploy admin ceph71 ceph72 ceph73 2.5 éƒ¨ç½²manager1ceph-deploy mgr create ceph71 2.6 æ·»åŠ OSDè¿™é‡Œæˆ‘ä»¬æ·»åŠ ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šé¢çš„å…±è®¡6ä¸ªç¡¬ç›˜åˆ°cephé›†ç¾¤ä¸­ä½œä¸ºosd 123456ceph-deploy osd create --data /dev/vdb ceph71ceph-deploy osd create --data /dev/vdb ceph72ceph-deploy osd create --data /dev/vdb ceph73ceph-deploy osd create --data /dev/vdc ceph71ceph-deploy osd create --data /dev/vdc ceph72ceph-deploy osd create --data /dev/vdc ceph73 2.7 æ£€æµ‹ç»“æœ123# æŸ¥çœ‹cephé›†ç¾¤çŠ¶æ€sudo ceph healthsudo ceph -s 3ã€é…ç½®dashboardè¯¦ç»†çš„å®˜ç½‘éƒ¨ç½²æ–‡æ¡£é“¾æ¥ï¼šhttps://docs.ceph.com/docs/master/mgr/dashboard/ 3.1 å¯ç”¨dashboard1ceph mgr module enable dashboard 3.2 ç¦ç”¨sslåŠ å¯†1ceph config set mgr mgr/dashboard/ssl false 3.3 é‡å¯ceph-dashboard12ceph mgr module disable dashboardceph mgr module enable dashboard 3.4 é…ç½®IPå’Œç«¯å£123$ ceph config set mgr mgr/dashboard/$name/server_addr $IP$ ceph config set mgr mgr/dashboard/$name/server_port $PORT$ ceph config set mgr mgr/dashboard/$name/ssl_server_port $PORT åˆ°æˆ‘è¿™é‡Œæ˜¯ 123ceph config set mgr mgr/dashboard/ceph71/server_addr 192.168.100.71ceph config set mgr mgr/dashboard/ceph71/server_port 8080ceph config set mgr mgr/dashboard/ceph71/ssl_server_port 8443 3.5 åˆ›å»ºdashboardç”¨æˆ·1ceph dashboard ac-user-create &lt;username&gt; &lt;password&gt; administrator åˆ°æˆ‘è¿™é‡Œæ˜¯ 1[root@ceph71 my-cluster]# ceph dashboard set-login-credentials tinychen tinychen ç™»å½•åå¯ä»¥çœ‹åˆ°é¦–é¡µ æœ€åå¯ä»¥çœ‹åˆ°çš„ç•Œé¢å¦‚ä¸Šã€‚","categories":[{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"ceph","slug":"ceph","permalink":"https://tinychen.com/tags/ceph/"}]},{"title":"Tomcatç¯‡03-ä½¿ç”¨Jmeterå¯¹Tomcat9çš„ä¸‰ç§IOæ¨¡å‹è¿›è¡ŒæŒç»­å‹åŠ›æµ‹è¯•","slug":"20200409-tomcat-03-jmeter-nio-nio2-apr","date":"2020-04-09T06:00:00.000Z","updated":"2020-04-09T06:00:00.000Z","comments":true,"path":"20200409-tomcat-03-jmeter-nio-nio2-apr/","link":"","permalink":"https://tinychen.com/20200409-tomcat-03-jmeter-nio-nio2-apr/","excerpt":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬Tomcat9çš„NIOã€NIO2ã€APRä¸‰ç§I/Oæ¨¡å‹çš„å·¥ä½œåŸç†ä»¥åŠä½¿ç”¨Jmeterå¯¹å…¶è¿›è¡ŒæŒç»­å‹åŠ›æµ‹è¯•ã€‚","text":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬Tomcat9çš„NIOã€NIO2ã€APRä¸‰ç§I/Oæ¨¡å‹çš„å·¥ä½œåŸç†ä»¥åŠä½¿ç”¨Jmeterå¯¹å…¶è¿›è¡ŒæŒç»­å‹åŠ›æµ‹è¯•ã€‚ 1ã€connectorçš„å·¥ä½œåŸç†è¿™é‡Œæˆ‘ä»¬è¯´çš„Tomcatä¸­ä¸‰ç§ä¸åŒçš„I/Oæ¨¡å‹ä¸»è¦æŒ‡çš„æ˜¯å…¶è¿æ¥å™¨ï¼ˆconnectorï¼‰çš„å·¥ä½œæ¨¡å‹ï¼Œå¯¹äºtomcatè€Œè¨€ï¼Œè¿æ¥å™¨ä¸€èˆ¬æŒ‡çš„æ˜¯coyoteï¼Œå…¶å·¥ä½œåŸç†å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿æ¥å™¨ä¸­çš„å„ä¸ªç»„ä»¶çš„ä½œç”¨å¦‚ä¸‹ï¼š 1.1 EndPointEndPointå³Coyoteé€šä¿¡ç«¯ç‚¹ï¼Œæ˜¯é€šä¿¡ç›‘å¬çš„æ¥å£ï¼Œæ˜¯å…·ä½“Socketæ¥æ”¶å’Œå‘é€å¤„ç†å™¨ï¼Œæ˜¯å¯¹ä¼ è¾“å±‚ï¼ˆå››å±‚ï¼‰çš„æŠ½è±¡ï¼Œå› æ­¤EndPointç”¨æ¥å®ç°TCP/IPåè®®çš„ã€‚Tomcat å¹¶æ²¡æœ‰EndPointæ¥å£ï¼Œè€Œæ˜¯æä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»AbstractEndpointï¼Œ é‡Œé¢å®šä¹‰äº†ä¸¤ä¸ªå†…éƒ¨ç±»ï¼šAcceptorå’ŒSocketProcessorã€‚Acceptorç”¨äºç›‘å¬Socketè¿æ¥è¯·æ±‚ã€‚ SocketProcessorç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„Socketè¯·æ±‚ï¼Œå®ƒå®ç°Runnableæ¥å£ï¼Œåœ¨Runæ–¹æ³•é‡Œ è°ƒç”¨åè®®å¤„ç†ç»„ä»¶Processorè¿›è¡Œå¤„ç†ã€‚ä¸ºäº†æé«˜å¤„ç†èƒ½åŠ›ï¼ŒSocketProcessorè¢«æäº¤åˆ°çº¿ç¨‹æ± æ¥æ‰§è¡Œï¼Œè€Œè¿™ä¸ªçº¿ç¨‹æ± å«ä½œæ‰§è¡Œå™¨ï¼ˆExecutor)ã€‚ 1.2 ProcessorProcessoræ˜¯coyoteçš„åè®®å¤„ç†æ¥å£ ã€‚å¦‚æœè¯´EndPointæ˜¯ç”¨æ¥å®ç°TCP/IPåè®®çš„ï¼Œé‚£ä¹ˆ Processorç”¨æ¥å®ç°HTTPåè®®ï¼ŒProcessoræ¥æ”¶æ¥è‡ªEndPointçš„Socketï¼Œè¯»å–å­—èŠ‚æµè§£ææˆTomcatçš„Requestå’ŒResponseå¯¹è±¡ï¼Œå¹¶é€šè¿‡Adapterå°†å…¶æäº¤åˆ°å®¹å™¨å¤„ç†ï¼Œ Processoræ˜¯å¯¹åº”ç”¨å±‚ï¼ˆä¸ƒå±‚ï¼‰åè®®çš„æŠ½è±¡ã€‚ 1.3 ProtocolHandlerProtocolHandleræ˜¯Coyoteçš„åè®®æ¥å£ï¼Œé€šè¿‡Endpointå’ŒProcessor ï¼Œå®ç°å¯¹å…·ä½“åè®®ï¼ˆHTTPæˆ–AJPï¼‰çš„å¤„ç†ã€‚Tomcat æŒ‰ç…§åè®®å’ŒI/O æä¾›äº†6ä¸ªå®ç°ç±» ï¼š AjpNioProtocol ï¼Œ AjpAprProtocolï¼Œ AjpNio2Protocol ï¼Œ Http11NioProtocol ï¼ŒHttp11Nio2Protocol ï¼Œ Http11AprProtocolã€‚æˆ‘ä»¬åœ¨é…ç½®tomcat/conf/server.xml ä¸­çš„connecterå—æ—¶ ï¼Œ è‡³å°‘è¦æŒ‡å®šå…·ä½“çš„ProtocolHandler , å½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šåè®®åç§°ï¼ˆå¦‚HTTP/1.1ï¼‰ã€‚ 1.4 Adapterç”±äºåè®®ä¸åŒï¼Œå®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚ä¿¡æ¯ä¹Ÿä¸å°½ç›¸åŒï¼ŒTomcatå®šä¹‰äº†è‡ªå·±çš„Requestç±»æ¥å­˜æ”¾è¿™äº›è¯·æ±‚ä¿¡æ¯ã€‚ProtocolHandleræ¥å£è´Ÿè´£è§£æè¯·æ±‚å¹¶ç”ŸæˆTomcatçš„Requestç±»ã€‚ ä½†æ˜¯è¿™ä¸ªRequestå¯¹è±¡ä¸æ˜¯æ ‡å‡†çš„ServletRequestï¼Œä¸èƒ½ç”¨æ¥ä½œä¸ºå‚æ•°æ¥è°ƒç”¨å®¹å™¨ã€‚å› æ­¤éœ€è¦å¼•å…¥CoyoteAdapterï¼Œè¿æ¥å™¨è°ƒç”¨CoyoteAdapterçš„Seviceæ–¹æ³•ï¼Œä¼ å…¥Tomcatçš„Requestå¯¹è±¡ï¼ŒCoyoteAdapterå°†Requestè½¬æˆServletRequestï¼Œå†è°ƒç”¨å®¹å™¨çš„Serviceæ–¹æ³•ã€‚ 2ã€ä¸‰ç§I/Oæ¨¡å‹åŸç†åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹tomcatå®˜ç½‘ç»™å‡ºçš„è¿™ä¸‰ç§I/Oæ¨¡å‹çš„å·¥ä½œå‚æ•°çš„ä¸€ä¸ªå¯¹æ¯”å›¾ï¼š è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€èˆ¬è¯´çš„NIOã€NIO2å’ŒAPRä½¿ç”¨çš„æ˜¯éé˜»å¡æ–¹å¼æŒ‡çš„å°±æ˜¯åœ¨è¯»å–è¯·æ±‚æŠ¥å¤´å’Œç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™æ˜¯ä½¿ç”¨çš„éé˜»å¡æ–¹å¼ã€‚ Tomcatçš„NIOæ˜¯åŸºäºI/Oå¤ç”¨ï¼ˆåŒæ­¥I/Oï¼‰æ¥å®ç°çš„ï¼Œè€ŒNIO2æ˜¯ä½¿ç”¨çš„å¼‚æ­¥I/Oã€‚å‚è€ƒç»å…¸ä¹¦ç±ã€ŠUNIXç½‘ç»œç¼–ç¨‹ å·1 å¥—æ¥å­—è”ç½‘APIã€‹ï¼Œä¸¤è€…çš„ä¸»è¦åŸç†å¦‚ä¸‹ï¼š I/Oå¤ç”¨ï¼ˆNIOï¼‰I/Oå¤ç”¨ï¼ˆI/O multiplexingï¼‰å¯ä»¥è°ƒç”¨selectæˆ–pollï¼Œé˜»å¡åœ¨è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ä¸­çš„æŸä¸€ä¸ªä¹‹ä¸Šï¼Œè€Œä¸æ˜¯é˜»å¡åœ¨çœŸæ­£çš„I/Oç³»ç»Ÿè°ƒç”¨ä¸Šã€‚è¿›ç¨‹é˜»å¡äºselectè°ƒç”¨ï¼Œç­‰å¾…æ•°æ®æŠ¥å¥—æ¥å­—å˜ä¸ºå¯è¯»ã€‚å½“selectè¿”å›å¥—æ¥å­—å¯è¯»è¿™ä¸€æ¡ä»¶æ—¶ï¼Œè¿›ç¨‹è°ƒç”¨recvfromæŠŠæ‰€è¯»æ•°æ®æŠ¥å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºï¼Œå°½ç®¡è¿™é‡Œéœ€è¦ä½¿ç”¨selectå’Œrecvfromä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œä½†æ˜¯ä½¿ç”¨selectçš„å¯ä»¥ç­‰å¾…å¤šä¸ªæè¿°ç¬¦å°±ç»ªï¼Œå³å¯ä»¥ç­‰å¾…å¤šä¸ªè¯·æ±‚ã€‚ å¼‚æ­¥IOï¼ˆNIO2ï¼‰å¼‚æ­¥I/Oï¼ˆasynchronous I/Oï¼‰çš„å·¥ä½œæœºåˆ¶æ˜¯ï¼šå‘ŠçŸ¥å†…æ ¸å¯åŠ¨æŸä¸ªæ“ä½œï¼Œå¹¶è®©å†…æ ¸åœ¨æ•´ä¸ªæ“ä½œï¼ˆåŒ…æ‹¬å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨ç¨‹åºçš„ç¼“å†²åŒºï¼‰å®Œæˆåé€šçŸ¥åº”ç”¨ç¨‹åºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¼‚æ­¥I/Oæ¨¡å‹æ˜¯ç”±å†…æ ¸é€šçŸ¥åº”ç”¨è¿›ç¨‹I/Oæ“ä½œä½•æ—¶å®Œæˆã€‚ æœ€åæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„è¿‡ç¨‹ç»“åˆå‰©ä¸‹æ²¡æœ‰æåˆ°çš„ä¸‰ç§UNIXç³»ç»Ÿä¸­çš„IOæ¨¡å‹è¿›è¡Œå¯¹æ¯”å¾—åˆ°ä¸‹å›¾ï¼š NIOã€NIO2å’ŒAPRçš„åŒºåˆ« NIO NIO2 APR å®ç° JAVA NIOåº“ JDK1.7 NIO2åº“ C IOæ¨¡å‹ åŒæ­¥éé˜»å¡ å¼‚æ­¥éé˜»å¡ å–å†³äºç³»ç»Ÿ APRçš„é‡ç‚¹åœ¨äºä½¿ç”¨Cè¯­è¨€å®ç°å¹¶ä¸”èƒ½å¤Ÿè·¨å¹³å°ä½¿ç”¨ï¼Œå®ƒç›¸å½“äºå°†UNIXç³»ç»Ÿä¸­çš„IOæ“ä½œè¿›è¡Œäº†ä¸€å±‚å°è£…ä½¿å¾—ç¼–ç¨‹å¼€å‘æ›´å®¹æ˜“ 3ã€connectorçš„å‡ ä¸ªé‡è¦å‚æ•°connectionTimeout The number of milliseconds this Connector will wait, after accepting a connection, for the request URI line to be presented. Use a value of -1 to indicate no (i.e. infinite) timeout. The default value is 60000 (i.e. 60 seconds) but note that the standard server.xml that ships with Tomcat sets this to 20000 (i.e. 20 seconds). Unless disableUploadTimeout is set to false, this timeout will also be used when reading the request body (if any). åœ¨connectorå’Œè¯·æ±‚çš„å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ä¹‹åå¼€å§‹è®¡æ—¶ï¼Œå½“è¶…è¿‡è¯¥å€¼çš„æ—¶å€™å°±ä¼šè¶…æ—¶ï¼Œç„¶åæ–­å¼€è¿æ¥ã€‚ä½¿ç”¨å€¼-1è¡¨ç¤ºæ— è¶…æ—¶ï¼Œé»˜è®¤å€¼ä¸º60000ï¼ˆå³60ç§’ï¼‰ï¼Œä½†Tomcatä¸­çš„server.xmlå°†æ­¤å€¼è®¾ç½®ä¸º20000ï¼ˆå³20ç§’ï¼‰ã€‚ é™¤édisableUploadTimeoutè®¾ç½®ä¸ºfalseï¼Œå¦åˆ™åœ¨è¯»å–è¯·æ±‚æ­£æ–‡ï¼ˆå¦‚æœæœ‰ï¼‰æ—¶ä¹Ÿä¼šä½¿ç”¨æ­¤è¶…æ—¶ã€‚ maxThreads The maximum number of request processing threads to be created by this Connector, which therefore determines the maximum number of simultaneous requests that can be handled. If not specified, this attribute is set to 200. If an executor is associated with this connector, this attribute is ignored as the connector will execute tasks using the executor rather than an internal thread pool. Note that if an executor is configured any value set for this attribute will be recorded correctly but it will be reported (e.g. via JMX) as -1 to make clear that it is not used. æœ€å¤§çº¿ç¨‹æ•°ï¼Œå¤§å¹¶å‘è¯·æ±‚æ—¶ï¼Œtomcatèƒ½åˆ›å»ºæ¥å¤„ç†è¯·æ±‚çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œè¶…è¿‡åˆ™æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­è¿›è¡Œæ’é˜Ÿï¼Œé»˜è®¤å€¼ä¸º200ã€‚ acceptCount The maximum queue length for incoming connection requests when all possible request processing threads are in use. Any requests received when the queue is full will be refused. The default value is 100. å½“æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaxThreadsï¼‰è¢«ä½¿ç”¨å®Œæ—¶ï¼Œå¯ä»¥æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—æ’é˜Ÿä¸ªæ•°ï¼Œè¶…è¿‡è¿™ä¸ªæ•°è¿”å›connection refusedï¼ˆè¯·æ±‚è¢«æ‹’ç»ï¼‰ï¼Œé»˜è®¤å€¼ä¸º100ï¼› maxConnections The maximum number of connections that the server will accept and process at any given time. When this number has been reached, the server will accept, but not process, one further connection. This additional connection be blocked until the number of connections being processed falls below maxConnections at which point the server will start accepting and processing new connections again. Note that once the limit has been reached, the operating system may still accept connections based on the acceptCount setting. The default value is 8192.For NIO/NIO2 only, setting the value to -1, will disable the maxConnections feature and connections will not be counted. Tomcatåœ¨ä»»æ„æ—¶åˆ»æ¥æ”¶å’Œå¤„ç†çš„æœ€å¤§è¿æ¥æ•°ã€‚å½“Tomcatæ¥æ”¶çš„è¿æ¥æ•°è¾¾åˆ°maxConnectionsæ—¶ï¼ŒAcceptorçº¿ç¨‹ä¸ä¼šè¯»å–accepté˜Ÿåˆ—ä¸­çš„è¿æ¥ï¼›è¿™æ—¶accepté˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ç€ï¼Œç›´åˆ°Tomcatæ¥æ”¶çš„è¿æ¥æ•°å°äºmaxConnectionsã€‚é»˜è®¤å€¼ä¸º8192ã€‚ å¯¹äºNIO / NIO2ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸º-1å°†ç¦ç”¨maxConnectionsåŠŸèƒ½ï¼Œå¹¶ä¸”ä¸è®¡ç®—è¿æ¥æ•°ã€‚ å›¾è§£æŒ‰ç…§è¢«å¤„ç†çš„å…ˆåé¡ºåºæˆ‘ä»¬å¯ä»¥æŠŠtomcatä¸­çš„çº¿ç¨‹é˜Ÿåˆ—å’Œä»¥ä¸Šå››ä¸ªå‚æ•°ä½¿ç”¨è¯¥å›¾è¿›è¡Œè¡¨ç¤º å½“maxThreads + acceptCount &lt; maxConnectionsçš„æ—¶å€™å°†ä¸ä¼šæœ‰çº¿ç¨‹è¢«é˜»å¡ å½“é˜»å¡çš„çº¿ç¨‹æ—¶é—´è¶…è¿‡connectionTimeoutè¿˜æ²¡å¾—åˆ°è¿”å›å€¼å°†è¿”å›è¿æ¥è¶…æ—¶ 4ã€é…ç½®æµ‹è¯•ç¯å¢ƒ4.1 é…ç½®connectoré¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨tomcatä¸­é…ç½®ä¸‰ä¸ªconnectorï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ç§I/Oæ¨¡å‹ï¼š 123456789101112131415161718&lt;Connector port=&quot;8080&quot; protocol=&quot;org.apache.coyote.http11.Http11AprProtocol&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; acceptCount=&quot;20000&quot; maxThreads=&quot;16&quot; maxConnections=&quot;22000&quot;/&gt;&lt;Connector port=&quot;8081&quot; protocol=&quot;org.apache.coyote.http11.Http11Nio2Protocol&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8444&quot; acceptCount=&quot;20000&quot; maxThreads=&quot;200&quot; maxConnections=&quot;22000&quot;/&gt;&lt;Connector port=&quot;8082&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8445&quot; acceptCount=&quot;20000&quot; maxThreads=&quot;16&quot; maxConnections=&quot;22000&quot;/&gt; 4.2 é…ç½®jmeter4.2.1 æµ‹è¯•ç¯å¢ƒjmeteræ˜¯apacheæ——ä¸‹çš„ä¸€æ¬¾å¼€æºçš„ä½¿ç”¨JAVAç¼–å†™çš„æœåŠ¡å™¨å‹åŠ›æµ‹è¯•è½¯ä»¶ï¼Œæˆ‘ä»¬ä»å®˜ç½‘ä¸‹è½½æºç åŒ…ï¼Œåˆ†åˆ«éƒ¨ç½²åœ¨windowså’ŒLinuxç³»ç»Ÿä¸Šï¼Œå› ä¸ºwindowsç³»ç»Ÿçš„ç¡¬ä»¶é…ç½®å¤ªå·®äº†ï¼Œæ²¡åŠæ³•è¿›è¡Œé«˜å¹¶å‘çš„å‹åŠ›æµ‹è¯•ï¼Œæ‰€ä»¥windowså¹³å°åªè¿›è¡Œjmeterçš„æµ‹è¯•æ–‡ä»¶jmxçš„é…ç½®ï¼Œé…ç½®å®Œæˆåå†ä½¿ç”¨Linuxæµ‹è¯•æœºæ¥è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚(æ³¨æ„jmeterç‰ˆæœ¬éœ€è¦ä¿æŒä¸€è‡´) ä½¿ç”¨jmeterè¿›è¡Œæµ‹è¯•çš„æœºå™¨ç³»ç»Ÿå’Œå†…æ ¸ç‰ˆæœ¬ä¸ºï¼š 12345678[root@www ~]# lsb_release -aLSB Version: :base-4.0-amd64:base-4.0-noarch:core-4.0-amd64:core-4.0-noarch:graphics-4.0-amd64:graphics-4.0-noarch:printing-4.0-amd64:printing-4.0-noarchDistributor ID: RedHatEnterpriseServerDescription: Red Hat Enterprise Linux Server release 6.9 (Santiago)Release: 6.9Codename: Santiago[root@www ~]# uname -r2.6.32-696.el6.x86_64 å®‰è£…tomcat9çš„æœåŠ¡å™¨ç³»ç»Ÿå’Œå†…æ ¸ç‰ˆæœ¬ä¸ºï¼š 12345678[root@tmpsys conf]# lsb_release -aLSB Version: :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarchDistributor ID: n/aDescription: NAME=&quot;Red Hat Enterprise Linux Server&quot;Release: n/aCodename: n/a[root@tmpsys conf]# uname -r3.10.0-1062.18.1.el7.x86_64 4.2.2 é…ç½®jmeterjmeterä½¿ç”¨å‰éœ€è¦é…ç½®JDKå’Œç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆJDKé…ç½®è¿™é‡Œä¸å†èµ˜è¿°ï¼‰ï¼Œæˆ‘ä»¬åœ¨/etc/profileä¸­å¯¼å…¥ç›¸å…³å˜é‡å¹¶ä½¿ç”¨sourceå‘½ä»¤ä¿è¯ç”Ÿæ•ˆã€‚ 123export JMETER_HOME=/home/jmeterexport CLASSPATH=$JMETER_HOME/lib/ext/ApacheJMeter_core.jar:$JMETER_HOME/lib/jorphan.jar:$CLASSPATHexport PATH=$JMETER_HOME/bin:$PATH é…ç½®æˆåŠŸååº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡º 4.3 ç¼–è¾‘JMXæ–‡ä»¶JMXçš„æ–‡ä»¶é…ç½®ä¸ç®—å¤æ‚ï¼Œæœ€é‡è¦çš„æ˜¯æµ‹è¯•çš„æ—¶é—´å’Œå¹¶å‘çº¿ç¨‹æ•°é‡ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æŒç»­å‹åŠ›æµ‹è¯•æ¨¡å¼ï¼Œè®¾ç½®å¾ªç¯æ¬¡æ•°ä¸ºæ°¸è¿œï¼Œç„¶åè®¾ç½®æŒç»­æ—¶é—´ä¸º300ç§’å³5åˆ†é’Ÿï¼Œè®¾ç½®çº¿ç¨‹æ•°ä¸º200å¹¶ä¸”ramp-upæ—¶é—´ä¸º1så³æ¯ç§’200å¹¶å‘æ•°ï¼Œå¦‚æœramp-upæ—¶é—´ä¸º10så³æ¯ç§’200Ã·10=20å¹¶å‘æ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¯¹åº”åˆ°jmxæ–‡ä»¶ä¸­çš„xmlæ–‡ä»¶å—ä¸ºï¼š 12345678910111213&lt;ThreadGroup guiclass=&quot;ThreadGroupGui&quot; testclass=&quot;ThreadGroup&quot; testname=&quot;çº¿ç¨‹ç»„&quot; enabled=&quot;true&quot;&gt; &lt;stringProp name=&quot;ThreadGroup.on_sample_error&quot;&gt;continue&lt;/stringProp&gt; &lt;elementProp name=&quot;ThreadGroup.main_controller&quot; elementType=&quot;LoopController&quot; guiclass=&quot;LoopControlPanel&quot; testclass=&quot;LoopController&quot; testname=&quot;å¾ªç¯æ§åˆ¶å™¨&quot; enabled=&quot;true&quot;&gt; &lt;boolProp name=&quot;LoopController.continue_forever&quot;&gt;false&lt;/boolProp&gt; &lt;intProp name=&quot;LoopController.loops&quot;&gt;-1&lt;/intProp&gt; &lt;/elementProp&gt; &lt;stringProp name=&quot;ThreadGroup.num_threads&quot;&gt;200&lt;/stringProp&gt; &lt;stringProp name=&quot;ThreadGroup.ramp_time&quot;&gt;1&lt;/stringProp&gt; &lt;boolProp name=&quot;ThreadGroup.scheduler&quot;&gt;true&lt;/boolProp&gt; &lt;stringProp name=&quot;ThreadGroup.duration&quot;&gt;300&lt;/stringProp&gt; &lt;stringProp name=&quot;ThreadGroup.delay&quot;&gt;&lt;/stringProp&gt; &lt;boolProp name=&quot;ThreadGroup.same_user_on_next_iteration&quot;&gt;true&lt;/boolProp&gt;&lt;/ThreadGroup&gt; 4.4 æµ‹è¯•ç±»å‹è¿™é‡Œæˆ‘ä»¬åˆ†åˆ«æµ‹è¯•äº”åˆ†é’ŸæŒç»­å‹æµ‹æƒ…å†µä¸‹200ã€400ã€600ã€800ã€1000çš„å¹¶å‘æƒ…å†µï¼Œæµ‹è¯•çš„é¡µé¢ä¸ºtomcatçš„é»˜è®¤é¦–é¡µï¼Œtomcatè‡ªå¸¦çš„examplesä¸­çš„/examples/servlets/nonblocking/bytecounter.htmlå’Œ/examples/servlets/nonblocking/numberwriterã€‚å¯ä»¥çœ‹åˆ°åé¢çš„ä¸¤ä¸ªexampleéƒ½æ˜¯ä½¿ç”¨éé˜»å¡çš„æ–¹å¼è¿›è¡Œç¼–å†™çš„sevletã€‚ä¸‰è€…çš„ä¸»è¦æ“ä½œå¦‚ä¸‹ï¼š tomcaté¦–é¡µå‡ ä¹ç›¸å½“äºä¸€ä¸ªé™æ€é¡µé¢ï¼Œå±äºç®€å•çš„ç½‘é¡µè¯·æ±‚æ“ä½œï¼Œåº”ç”¨ç¨‹åºå‘é€è¯·æ±‚åˆ°å†…æ ¸ï¼Œå†…æ ¸ä»IOä»è¯»å–ç›¸åº”æ–‡ä»¶å¹¶è¿”å›ï¼› numberwriteræ˜¯ç”Ÿæˆè¿”å›ä¸€ä¸²å¾ˆé•¿çš„æ•°å­—ï¼Œåº”ç”¨ç¨‹åºå‘é€è¯·æ±‚åˆ°å†…æ ¸å¹¶æ¥æ”¶ä»å†…æ ¸ç”Ÿæˆè¿”å›çš„è¾ƒå¤§çš„æ•°æ®ï¼› bytecounteréœ€è¦ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ç„¶åå†è®¡ç®—å­—æ•°ï¼ˆè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªå¤§å°çº¦30KBçš„markdownæ–‡ä»¶ä½œä¸ºæµ‹è¯•ï¼‰ï¼Œéœ€è¦è¿›è¡ŒIOä¼ è¾“å’ŒCPUè®¡ç®—å†ä»å†…æ ¸è¿”å›ä¸€ä¸ªç®€å•çš„æ•°å€¼åˆ°åº”ç”¨ç¨‹åºï¼› 4.5 tomcat9å¯åŠ¨å‚æ•°æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨çš„ä¾æ—§æ˜¯systemdè°ƒç”¨jsvcå¯åŠ¨tomcatï¼Œå¯åŠ¨å‚æ•°å¦‚ä¸‹: 12345678910111213141516171819ExecStart=/home/tomcat9/bin/jsvc \\ -user tomcat \\ -nodetach \\ -java-home $&#123;JAVA_HOME&#125; \\ -Xms4096m \\ -Xmx8192m \\ -XX:NewRatio=3 \\ -XX:SurvivorRatio=4 \\ -pidfile $&#123;CATALINA_BASE&#125;/tomcat.pid \\ -classpath $&#123;CATALINA_HOME&#125;/bin/bootstrap.jar:$&#123;CATALINA_HOME&#125;/bin/tomcat-juli.jar \\ -outfile $&#123;CATALINA_BASE&#125;/logs/catalina.out \\ -errfile $&#123;CATALINA_BASE&#125;/logs/catalina.err \\ -Dcatalina.home=$&#123;CATALINA_HOME&#125; \\ -Dcatalina.base=$&#123;CATALINA_BASE&#125; \\ -Djava.io.tmpdir=$&#123;CATALINA_TMPDIR&#125; \\ -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \\ -Djava.util.logging.config.file=$&#123;CATALINA_BASE&#125;/conf/logging.properties \\ -Djava.library.path=/usr/local/apr/lib \\ org.apache.catalina.startup.Bootstrap 5ã€æµ‹è¯•ç»“æœ5.1 tomcaté¦–é¡µæµ‹è¯•ç»“æœ å¯¹äºç®€å•çš„è¯·æ±‚ï¼Œä¸‰ç§æ¨¡å¼çš„æ‰€æœ‰è¡¨ç°æ•°æ®éƒ½å‡ ä¹ä¸€æ ·ï¼ŒåŸºæœ¬ä¸å­˜åœ¨æµ‹è¯•è¯¯å·®èŒƒå›´å¤–çš„å·®è·ã€‚ 5.2 numberwriteræµ‹è¯•ç»“æœ åˆ°äº†numberwriteè¿™ä¸€ç§è¿”å›è¾ƒé•¿æ•°æ®çš„è¯·æ±‚ï¼ŒNIO2æ¨¡å‹çš„é”™è¯¯ç‡è¦æ¯”å…¶ä»–ä¸¤è€…ä½å¾—å¤šï¼Œåˆ°äº†1200å¹¶å‘çš„æ—¶å€™apræ¨¡å‹å’ŒNIOæ¨¡å‹çš„é”™è¯¯ç‡éƒ½å·²ç»è¶…è¿‡äº†å…­æˆï¼Œä¸ªäººè®¤ä¸ºæ­¤æ—¶çš„å“åº”æ—¶é—´ä¸å…·æœ‰å‚è€ƒæ€§ã€‚ 5.3 wordcountæµ‹è¯•ç»“æœ å’Œä¹‹å‰çš„numberwriteä¸€æ ·ï¼ŒåŒæ ·æ˜¯ç‰ºç‰²äº†å“åº”æ—¶é—´è€Œé™ä½äº†é”™è¯¯ç‡ã€‚","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://tinychen.com/tags/tomcat/"},{"name":"jmeter","slug":"jmeter","permalink":"https://tinychen.com/tags/jmeter/"}]},{"title":"CentOSåˆ›å»ºKVMè™šæ‹Ÿæœº","slug":"20200405-centos-create-kvm-vm","date":"2020-04-05T02:00:00.000Z","updated":"2020-04-05T02:00:00.000Z","comments":true,"path":"20200405-centos-create-kvm-vm/","link":"","permalink":"https://tinychen.com/20200405-centos-create-kvm-vm/","excerpt":"ä½¿ç”¨qemu-kvmåœ¨CentOS8ä¸Šé€šè¿‡GUIåˆ›å»ºè™šæ‹Ÿæœºã€‚","text":"ä½¿ç”¨qemu-kvmåœ¨CentOS8ä¸Šé€šè¿‡GUIåˆ›å»ºè™šæ‹Ÿæœºã€‚ 1ã€å®‰è£…ç³»ç»Ÿç»„ä»¶é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…epelæºå’Œç›¸åº”çš„è™šæ‹Ÿæœºå·¥å…· 12345678910111213yum install epel-release -yyum install qemu-kvm qemu-img libvirt virt-manager virt-top.x86_64 virtio-win.noarch virt-viewer.x86_64 virt-install.noarch -yvirt-install libvirt #å®‰è£…libvirtä¼šå°†libvirt-clientä½œä¸ºä¾èµ–è¿›è¡Œå®‰è£…ï¼Œlibvirt-clientå³libvirtçš„å®¢æˆ·ç«¯ï¼Œæœ€é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å°±åœ¨å®¿ä¸»æœºå…³æœºæ—¶å¯ä»¥é€šçŸ¥è™šæ‹Ÿæœºä¹Ÿå…³æœºï¼Œä½¿è™šæ‹Ÿæœºç³»ç»Ÿæ­£å¸¸å…³æœºï¼Œè€Œä¸æ˜¯è¢«å¼ºåˆ¶å…³æœºï¼Œé€ æˆæ•°æ®ä¸¢å¤±ipxe-roms-qemu #è™šæ‹ŸæœºiPXEçš„å¯åŠ¨å›ºä»¶ï¼Œæ”¯æŒè™šæ‹Ÿæœºä»ç½‘ç»œå¯åŠ¨qemu-kvm #KVMåœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œçš„ç¨‹åºvirt-manager #åŸºäº Libvirt çš„å›¾åƒåŒ–è™šæ‹Ÿæœºç®¡ç†è½¯ä»¶libvirt #ç”¨äºç®¡ç†è™šæ‹Ÿæœºï¼Œå®ƒæä¾›äº†ä¸€å¥—è™šæ‹Ÿæœºæ“ä½œAPIvirt-viewer #æ˜¾ç¤ºè™šæ‹Ÿæœºçš„æ§åˆ¶å°consolevirt-top #ç±»ä¼¼äºtopå‘½ä»¤ï¼ŒæŸ¥çœ‹è™šæ‹Ÿæœºçš„èµ„æºä½¿ç”¨æƒ…å†µvirt-what #åœ¨è™šæ‹Ÿæœºå†…éƒ¨æ‰§è¡Œï¼ŒæŸ¥çœ‹è™šæ‹Ÿæœºè¿è¡Œçš„è™šæ‹ŸåŒ–å¹³å°qemu-img #ç”¨äºæ“ä½œè™šæ‹Ÿæœºç¡¬ç›˜é•œåƒçš„åˆ›å»ºã€æŸ¥çœ‹å’Œæ ¼å¼è½¬åŒ– ä¸€äº›ä¸»è¦ç»„ä»¶çš„åŠŸèƒ½ä»‹ç»å¦‚ä¸‹ï¼š virt-install Description : Package includes several command line utilities, including virt-install : (build and install new VMs) and virt-clone (clone an existing virtual : machine). virt-who Description : Agent that collects information about virtual guests present in the system and : report them to the subscription manager. virt-top Description : virt-top is a â€˜top(1)â€™-like utility for showing stats of virtualized : domains. Many keys and command line options are the same as for : ordinary &#39;top&#39;. : : It uses libvirt so it is capable of showing stats across a variety of : different virtualization systems. virt-viewer Description : Virtual Machine Viewer provides a graphical console client for connecting : to virtual machines. It uses the GTK-VNC or SPICE-GTK widgets to provide : the display, and libvirt for looking up VNC/SPICE server details. virt-manager Description : Virtual Machine Manager provides a graphical tool for administering virtual : machines for KVM, Xen, and LXC. Start, stop, add or remove virtual devices, : connect to a graphical or serial console, and see resource usage statistics : for existing VMs on local or remote machines. Uses libvirt as the backend : management API. libvirt Description : Libvirt is a C toolkit to interact with the virtualization capabilities : of recent versions of Linux (and other OSes). The main package includes : the libvirtd server exporting the virtualization support. qemu-kvm Description : qemu-kvm is an open source virtualizer that provides hardware : emulation for the KVM hypervisor. qemu-kvm acts as a virtual : machine monitor together with the KVM kernel modules, and emulates the : hardware for a full system such as a PC and its associated peripherals. 2ã€åˆ›å»ºè™šæ‹Ÿæœº2.1 é…ç½®è™šæ‹Ÿæœºå­˜å‚¨ç›®å½•è¿™é‡Œæˆ‘ä»¬ç›´æ¥å¼€å¯å®¿ä¸»æœºLinuxç³»ç»Ÿä¸Šé¢çš„GUIæ¨¡å¼å¹¶ä¸”ä½¿ç”¨xrdpè¿œç¨‹åˆ°æ¡Œé¢ï¼Œç„¶åä½¿ç”¨virt-manageræ¥è¿›è¡ŒGUIæ¨¡å¼çš„åˆ›å»ºè™šæ‹Ÿæœºã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ISOé•œåƒæ–‡ä»¶æ¥è¿›è¡Œè™šæ‹Ÿæœºç³»ç»Ÿçš„å®‰è£…ï¼Œå› æ­¤å¿…é¡»éœ€è¦ä¸€ä¸ªGUIç•Œé¢æ¥è¿›è¡Œæœ€å¼€å§‹çš„ç³»ç»Ÿå®‰è£…ï¼Œç­‰å¾…ç³»ç»Ÿå®‰è£…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œæ“ä½œæ¥å…‹éš†è™šæ‹Ÿæœºï¼Œå°±ä¸ç”¨æ¯æ¬¡éƒ½æ‰“å¼€GUIæ¨¡å¼å®‰è£…ç³»ç»Ÿè¿™ä¹ˆéº»çƒ¦äº†ã€‚ æ¥ç€æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç›®å½•ä¸“é—¨ç”¨æ¥å­˜æ”¾è™šæ‹Ÿæœºç›¸å…³çš„é•œåƒå’Œæ–‡ä»¶ï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„æƒé™çš„é—®é¢˜ï¼š 12sudo mkdir -p /kvm/isosudo chown tinychen:tinychen /kvm -R æ¥ç€æˆ‘ä»¬æŠŠç›¸åº”çš„ç³»ç»Ÿå®‰è£…é•œåƒå¤åˆ¶è¿›å»ï¼ˆå¯¹åº”çš„ç³»ç»Ÿå®‰è£…é•œåƒæ–‡ä»¶å‡å¯ç›´æ¥åœ¨å¯¹åº”çš„å®˜ç½‘ä¸‹è½½ï¼‰ï¼Œç„¶åæ‰“å¼€Virtual Machine Managerï¼ˆä»¥ä¸‹ç®€ç§°VMMï¼‰æ¥åˆ›å»ºè™šæ‹Ÿæœº é¦–å…ˆæˆ‘ä»¬åœ¨Editâ†’Preferencesé‡Œé¢å¼€å¯XMLæ–‡ä»¶ç¼–è¾‘åŠŸèƒ½ï¼ŒXMLæ¨¡å¼å¯ä»¥æœ€å¤§ç¨‹åº¦çš„æ§åˆ¶è™šæ‹Ÿæœºçš„æ‰€æœ‰é…ç½®ï¼Œä¸€äº›ç‰¹æ®Šçš„é…ç½®æˆ–è€…ç»„ä»¶æ“ä½œæ— æ³•é€šè¿‡VMMçš„GUIç•Œé¢å®Œæˆçš„æˆ‘ä»¬å¯ä»¥ç›´æ¥ç¼–è¾‘å¯¹åº”çš„XMLæ–‡ä»¶å—æ¥å®ç°ã€‚ 2.2 åˆ›å»ºè™šæ‹Ÿæœºç›´æ¥ç‚¹å‡»åŠ å·æˆ–è€…ä¸Šé¢çš„Fileâ†’New Virtual Machineç„¶åé€‰æ‹©ä½¿ç”¨æœ¬åœ°åª’ä½“åˆ›å»ºè™šæ‹Ÿæœºï¼ˆè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆšåˆšå¤åˆ¶è¿›å»çš„ISOé•œåƒæ–‡ä»¶ï¼‰ æ¥ç€æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰å››ç§åˆ›å»ºè™šæ‹Ÿæœºçš„æ–¹å¼ï¼š ä»æœ¬åœ°çš„åª’ä½“èµ„æºå®‰è£…ï¼ˆisoæ–‡ä»¶æˆ–è€…CDå…‰ç›˜ï¼‰ é€šè¿‡ç½‘ç»œåè®®è·å–å®‰è£…çš„é•œåƒæ–‡ä»¶ç„¶åè¿›è¡Œå®‰è£… é€šè¿‡PXEè¿›è¡Œå®‰è£… å¯¼å…¥å·²æœ‰çš„è™šæ‹Ÿæœºç¡¬ç›˜é•œåƒæ–‡ä»¶ æˆ‘ä»¬é€‰æ‹©ç¬¬ä¸€ç§æ–¹å¼è¿›è¡Œæ–°å»ºè™šæ‹Ÿæœºæ“ä½œã€‚ ç”±äºæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºè™šæ‹Ÿæœºï¼Œæˆ‘ä»¬éœ€è¦å…ˆåœ¨VMMä¸­æ·»åŠ ä¸€ä¸ªæ± ï¼ˆpoolï¼‰ï¼ŒæŠŠå…ˆå‰åˆ›å»ºçš„å­˜æ”¾isoé•œåƒæ–‡ä»¶çš„ç›®å½•ä½œä¸ºä¸€ä¸ªæ± æ·»åŠ åˆ°VMMä¸­ã€‚ æ·»åŠ å®Œæˆä¹‹åæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°é‡Œé¢çš„é•œåƒæ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©CentOS7çš„ç‰ˆæœ¬è¿›è¡Œå®‰è£…ã€‚ é€‰æ‹©é•œåƒä¹‹åVMMä¼šè‡ªåŠ¨æ£€æµ‹é•œåƒæ–‡ä»¶å†…åŒ…å«çš„æ“ä½œç³»ç»Ÿã€‚ æ¥ä¸‹æ¥æ˜¯è®¾å®šCPUå’Œå†…å­˜ï¼Œæ³¨æ„è¿™é‡Œçš„å†…å­˜å•ä½æ˜¯MBï¼Œè€ŒCPUçš„å•ä½æ˜¯ä¸ªï¼Œå³å¹¶ä¸æ˜¯æˆ‘ä»¬å¸¸è¯´çš„CPUæ ¸å¿ƒæ•°é‡æˆ–è€…æ˜¯è¶…çº¿ç¨‹çš„çº¿ç¨‹æ•°é‡ï¼Œè€Œæ˜¯è™šæ‹Ÿè®¾å®šçš„å¤šå°‘ä¸ªCPUï¼Œè¿™é‡Œé€‰æ‹©4å³ä¸º4ä¸ªCPUè€Œä¸æ˜¯ä¸€ä¸ª4æ ¸CPUï¼Œè¿™ä¸ªé€‰é¡¹æˆ‘ä»¬åé¢éœ€è¦å†è¿›è¡Œä¿®æ”¹ã€‚ æ¥ä¸‹æ¥ä¾¿æ˜¯è¿›è¡Œè™šæ‹Ÿæœºçš„ç¡¬ç›˜å‚æ•°è®¾ç½®ï¼Œæˆ‘ä»¬è¿™é‡Œé€‰æ‹©æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªç¡¬ç›˜ã€‚ å’Œä¹‹å‰ä¸€æ ·æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªæ± ä¸“é—¨ç”¨æ¥å­˜æ”¾è™šæ‹Ÿæœºçš„ç³»ç»Ÿé•œåƒæ–‡ä»¶ã€‚ æ¥ç€åœ¨å¯¹åº”çš„æ± ä¸­æ–°å»ºä¸€ä¸ªqcow2ç£ç›˜æ–‡ä»¶ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¡¬ç›˜çš„æ ¼å¼ä¸»è¦æœ‰rawå’Œqcow2ä¸¤ç§ã€‚qcow2 é•œåƒæ ¼å¼æ˜¯ QEMU æ¨¡æ‹Ÿå™¨æ”¯æŒçš„ä¸€ç§ç£ç›˜é•œåƒã€‚å®ƒä¹Ÿæ˜¯å¯ä»¥ç”¨ä¸€ä¸ªæ–‡ä»¶çš„å½¢å¼æ¥è¡¨ç¤ºä¸€å—å›ºå®šå¤§å°çš„å—è®¾å¤‡ç£ç›˜ã€‚ä¸æ™®é€šçš„ raw æ ¼å¼çš„é•œåƒç›¸æ¯”ï¼Œæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š æ›´å°çš„ç©ºé—´å ç”¨ï¼Œå³ä½¿æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒç©ºæ´(holes)ï¼› æ”¯æŒå†™æ—¶æ‹·è´ï¼ˆCOW, copy-on-writeï¼‰ï¼Œé•œåƒæ–‡ä»¶åªåæ˜ åº•å±‚ç£ç›˜çš„å˜åŒ–ï¼› æ”¯æŒå¿«ç…§ï¼ˆsnapshotï¼‰ï¼Œé•œåƒæ–‡ä»¶èƒ½å¤ŸåŒ…å«å¤šä¸ªå¿«ç…§çš„å†å²ï¼› å¯é€‰æ‹©åŸºäº zlib çš„å‹ç¼©æ–¹å¼ å¯ä»¥é€‰æ‹© AES åŠ å¯† qcow2æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥èŠ‚çœç¡¬ç›˜ç©ºé—´ï¼Œåªæœ‰åœ¨è™šæ‹Ÿæœºå®é™…å ç”¨äº†ç£ç›˜ç©ºé—´æ—¶ï¼Œå…¶æ–‡ä»¶æ‰ä¼šå¢é•¿ã€‚æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª40Gçš„ç¡¬ç›˜é•œåƒæ–‡ä»¶ï¼Œä½†æ˜¯å®é™…å ç”¨å¹¶æ²¡æœ‰40Gï¼Œåªæœ‰åœ¨è™šæ‹Ÿæœºå®é™…ä½¿ç”¨äº†ç¡¬ç›˜ç©ºé—´ä¹‹åï¼Œqcow2æ ¼å¼çš„é•œåƒæ–‡ä»¶æ‰ä¼šå¢å¤§ã€‚ æœ€åéœ€è¦è®¾ç½®çš„å°±æ˜¯è™šæ‹Ÿæœºçš„ç½‘å¡ï¼Œè¿™é‡Œæˆ‘ä»¬è¦å‹¾é€‰Customize configuration before installï¼Œåœ¨ç³»ç»Ÿå¼€å§‹å®‰è£…ä¹‹å‰è¿›è¡Œä¸€äº›å‚æ•°çš„è®¾ç½®ã€‚ 2.3 é…ç½®è™šæ‹Ÿæœºå…¶ä»–å‚æ•°é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°Overviewä¸­çš„Chipsetå’ŒFirmwareä¸¤ä¸ªå‚æ•°ï¼Œå®ƒä»¬åˆ†åˆ«ç›¸å½“äºç‰©ç†æœºç”µè„‘ä¸»æ¿çš„èŠ¯ç‰‡ç»„å’Œå›ºä»¶æ¨¡å¼ï¼ˆBIOSæˆ–UEFIï¼‰ï¼Œå¦‚æœæœ‰æ–°ç‰ˆæœ¬çš„éœ€æ±‚ï¼ˆå¦‚è™šæ‹ŸæœºKVMç›´é€šGPUï¼‰å¯ä»¥é€‰æ‹©UEFIï¼ˆOVMFï¼‰æ¥è¿›è¡Œå¯åŠ¨ï¼Œéœ€è¦æ³¨æ„VMMä¸­çš„å¿«ç…§ï¼ˆsnapshotï¼‰åŠŸèƒ½ä¸æ”¯æŒUEFIï¼ˆOVMFï¼‰å›ºä»¶çš„è™šæ‹Ÿæœºï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬é€‰æ‹©é»˜è®¤çš„Q35å’ŒBIOSå³å¯ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¯¹å‰é¢è®¾å®šçš„CPUå‚æ•°è¿›è¡Œæ›´æ”¹ã€‚è¿™é‡Œæˆ‘ä»¬ç¼–è¾‘å¯¹åº”çš„XMLæ–‡ä»¶å°†CPUæ¨¡å¼ä¿®æ”¹ä¸ºhost-passthroughä»¥ä¾¿å°†CPUçš„å…¨éƒ¨ç‰¹æ€§ä¼ é€’åˆ°è™šæ‹Ÿæœºä¸­ï¼ŒåŒæ—¶ä¿®æ”¹CPUä¸ªæ•°ä¸º1ï¼Œæ ¸å¿ƒæ•°ä¸º4ï¼Œæ¯ä¸ªæ ¸å¿ƒçš„çº¿ç¨‹æ•°ä¸º1ã€‚ 123&lt;cpu mode=&quot;host-passthrough&quot;&gt; &lt;topology sockets=&quot;1&quot; cores=&quot;4&quot; threads=&quot;1&quot;/&gt;&lt;/cpu&gt; è®¾å®šå®‰è£…ç³»ç»Ÿçš„ISOä¸ºåªè¯»ï¼Œä¿è¯ISOæ–‡ä»¶ä¸ä¼šè¢«ä¿®æ”¹ï¼ŒåŒæ—¶è®¾ç½®æ•°æ®æ€»çº¿æ–¹å¼ä¸ºSATAä¿è¯æœ€å¥½çš„å…¼å®¹æ€§ã€‚ é…ç½®ä¸¤ä¸ªç½‘å¡ï¼Œåˆ†åˆ«ä¸ºæ¡¥æ¥å®¿ä¸»æœºçš„ç½‘å¡å’ŒNATæ¨¡å¼ï¼Œå…¶ä¸­æ¡¥æ¥ç½‘å¡ä½¿ç”¨e1000eå‹å·ä¿è¯æœ€å¥½çš„å…¼å®¹æ€§ï¼ŒNATæ¨¡å¼çš„ç½‘å¡ä½¿ç”¨VirtIOå‹å·å¯ä»¥è¾¾åˆ°æœ€å¤§100Gçš„ä¼ è¾“é€Ÿåº¦ã€‚ å…¶ä»–è¿˜ä¼šé»˜è®¤æ·»åŠ ä¸€äº›å¸¸ç”¨çš„ç»„ä»¶ï¼Œæˆ‘ä»¬æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œæˆ‘åªä¿ç•™äº†å¸¸ç”¨çš„USBé‡å®šå‘è®¾å¤‡ï¼Œå£°å¡ã€ç½‘å¡ã€ä¸²è¡Œæ€»çº¿ç­‰åŸºæœ¬è®¾å¤‡ï¼Œå¦‚æœä¸æ¸…æ¥šå…·ä½“éœ€æ±‚ï¼Œå»ºè®®ä¿ç•™ã€‚ æœ€åæ•´ä¸ªå®Œæ•´çš„xmlæ–‡ä»¶å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576&lt;domain type=&quot;kvm&quot;&gt; &lt;name&gt;centos7_demo&lt;/name&gt; &lt;uuid&gt;2e80a698-c4f9-464b-bb3e-28c4987cbe9a&lt;/uuid&gt; &lt;metadata&gt; &lt;libosinfo:libosinfo xmlns:libosinfo=&quot;http://libosinfo.org/xmlns/libvirt/domain/1.0&quot;&gt; &lt;libosinfo:os id=&quot;http://centos.org/centos/7.0&quot;/&gt; &lt;/libosinfo:libosinfo&gt; &lt;/metadata&gt; &lt;memory&gt;8388608&lt;/memory&gt; &lt;currentMemory&gt;8388608&lt;/currentMemory&gt; &lt;vcpu current=&quot;4&quot;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&quot;x86_64&quot; machine=&quot;q35&quot;&gt;hvm&lt;/type&gt; &lt;boot dev=&quot;hd&quot;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;vmport state=&quot;off&quot;/&gt; &lt;/features&gt; &lt;cpu mode=&quot;host-passthrough&quot;&gt; &lt;topology sockets=&quot;1&quot; cores=&quot;4&quot; threads=&quot;1&quot;/&gt; &lt;/cpu&gt; &lt;clock offset=&quot;utc&quot;&gt; &lt;timer name=&quot;rtc&quot; tickpolicy=&quot;catchup&quot;/&gt; &lt;timer name=&quot;pit&quot; tickpolicy=&quot;delay&quot;/&gt; &lt;timer name=&quot;hpet&quot; present=&quot;no&quot;/&gt; &lt;/clock&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&quot;no&quot;/&gt; &lt;suspend-to-disk enabled=&quot;no&quot;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt; &lt;disk type=&quot;file&quot; device=&quot;disk&quot;&gt; &lt;driver name=&quot;qemu&quot; type=&quot;qcow2&quot;/&gt; &lt;source file=&quot;/kvm/vm/centos7_demo.qcow2&quot;/&gt; &lt;target dev=&quot;vda&quot; bus=&quot;virtio&quot;/&gt; &lt;/disk&gt; &lt;disk type=&quot;file&quot; device=&quot;cdrom&quot;&gt; &lt;driver name=&quot;qemu&quot; type=&quot;raw&quot;/&gt; &lt;source file=&quot;/kvm/iso/centos7.7.iso&quot;/&gt; &lt;target dev=&quot;sda&quot; bus=&quot;sata&quot;/&gt; &lt;readonly/&gt; &lt;/disk&gt; &lt;interface type=&quot;network&quot;&gt; &lt;source network=&quot;default&quot;/&gt; &lt;mac address=&quot;52:54:00:83:cc:6d&quot;/&gt; &lt;model type=&quot;virtio&quot;/&gt; &lt;/interface&gt; &lt;console type=&quot;pty&quot;/&gt; &lt;channel type=&quot;unix&quot;&gt; &lt;source mode=&quot;bind&quot;/&gt; &lt;target type=&quot;virtio&quot; name=&quot;org.qemu.guest_agent.0&quot;/&gt; &lt;/channel&gt; &lt;channel type=&quot;spicevmc&quot;&gt; &lt;target type=&quot;virtio&quot; name=&quot;com.redhat.spice.0&quot;/&gt; &lt;/channel&gt; &lt;input type=&quot;tablet&quot; bus=&quot;usb&quot;/&gt; &lt;graphics type=&quot;spice&quot; port=&quot;-1&quot; tlsPort=&quot;-1&quot; autoport=&quot;yes&quot;&gt; &lt;image compression=&quot;off&quot;/&gt; &lt;/graphics&gt; &lt;video&gt; &lt;model type=&quot;qxl&quot;/&gt; &lt;/video&gt; &lt;memballoon model=&quot;virtio&quot;/&gt; &lt;rng model=&quot;virtio&quot;&gt; &lt;backend model=&quot;random&quot;&gt;/dev/urandom&lt;/backend&gt; &lt;/rng&gt; &lt;interface type=&quot;direct&quot;&gt; &lt;source dev=&quot;enp6s0&quot; mode=&quot;bridge&quot;/&gt; &lt;mac address=&quot;52:54:00:31:ad:1d&quot;/&gt; &lt;model type=&quot;e1000e&quot;/&gt; &lt;/interface&gt; &lt;/devices&gt;&lt;/domain&gt; 2.4å¼€å§‹å®‰è£… æ¥ä¸‹æ¥çš„å®‰è£…å°±å’Œæ­£å¸¸çš„ç‰©ç†æœºå®‰è£…æ“ä½œç³»ç»Ÿä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸å†èµ˜è¿°äº†ï¼Œç”±äºæ˜¯CentOSçš„è™šæ‹Ÿæœºï¼Œä¸ºäº†èŠ‚çº¦ç³»ç»Ÿèµ„æºï¼Œæˆ‘é€‰æ‹©äº†æœ€å°åŒ–å®‰è£…ï¼ˆMinimal Installï¼‰ã€å…³é—­äº†KDUMPåŠŸèƒ½ï¼Œå¹¶ä¸”ä½¿ç”¨LVMæ¥è®¾å®šåˆ†åŒºä»¥ä¾¿åæœŸæ‰©å®¹ æœ€åå¯ä»¥é€šè¿‡virshå‘½ä»¤æ¥æŸ¥çœ‹è™šæ‹Ÿæœºçš„çŠ¶æ€ å¦‚æœéœ€è¦å¼€å¯è™šæ‹Ÿæœºåªéœ€è¦ä½¿ç”¨virsh start è™šæ‹Ÿæœºåå³å¯ã€‚","categories":[{"name":"â€Œvirtualization","slug":"â€Œvirtualization","permalink":"https://tinychen.com/categories/%E2%80%8Cvirtualization/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"kvm","slug":"kvm","permalink":"https://tinychen.com/tags/kvm/"}]},{"title":"Tomcatç¯‡02-æ•´ä½“æ¶æ„å’ŒI/Oæ¨¡å‹","slug":"20200402-tomcat-02-structure-io-model","date":"2020-04-02T02:00:00.000Z","updated":"2020-04-02T02:00:00.000Z","comments":true,"path":"20200402-tomcat-02-structure-io-model/","link":"","permalink":"https://tinychen.com/20200402-tomcat-02-structure-io-model/","excerpt":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬tomcatæœåŠ¡å™¨çš„ç›®å½•ç»“æ„ã€å·¥ä½œæ¨¡å¼ã€æ•´ä½“æ¶æ„ã€I/Oæ¨¡å‹ä»¥åŠNIOã€NIO2ã€APRä¸‰è€…çš„å¯¹æ¯”ä»‹ç»ã€‚","text":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬tomcatæœåŠ¡å™¨çš„ç›®å½•ç»“æ„ã€å·¥ä½œæ¨¡å¼ã€æ•´ä½“æ¶æ„ã€I/Oæ¨¡å‹ä»¥åŠNIOã€NIO2ã€APRä¸‰è€…çš„å¯¹æ¯”ä»‹ç»ã€‚ 1ã€Tomcatçš„ç›®å½•ç»“æ„æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹tomcat8.5å’Œtomcat9ä¸­çš„homeç›®å½•ä¸­çš„æ–‡ä»¶ï¼š å¯ä»¥çœ‹åˆ°é™¤æ‰ä¸€äº›è¯´æ˜æ–‡ä»¶ä¹‹åï¼Œè¿˜æœ‰7ä¸ªç›®å½•ï¼š ç›®å½•å ç”¨é€” bin å­˜æ”¾ç”¨äºå¯åŠ¨åŠå…³é—­çš„æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è„šæœ¬ã€‚å…¶ä¸­ï¼ŒUNIX ç³»ç»Ÿä¸“ç”¨çš„ *.sh æ–‡ä»¶åœ¨åŠŸèƒ½ä¸Šç­‰åŒäº windows ç³»ç»Ÿä¸“ç”¨çš„ *.bat æ–‡ä»¶ã€‚å› ä¸º Win32 çš„å‘½ä»¤è¡Œç¼ºä¹æŸäº›åŠŸèƒ½ï¼Œæ‰€ä»¥åˆé¢å¤–åœ°åŠ å…¥äº†ä¸€äº›æ–‡ä»¶ conf é…ç½®æ–‡ä»¶åŠç›¸å…³çš„ DTDï¼ˆdocument type definition æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ŒDTDæ–‡ä»¶ä¸€èˆ¬å’ŒXMLæ–‡ä»¶é…åˆä½¿ç”¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†çº¦æŸXMLæ–‡ä»¶ï¼‰ã€‚å…¶ä¸­æœ€é‡è¦çš„æ–‡ä»¶æ˜¯ server.xmlï¼Œè¿™æ˜¯å®¹å™¨çš„ä¸»é…ç½®æ–‡ä»¶ lib å­˜æ”¾tomcatæœåŠ¡å™¨è‡ªèº«å’Œæ‰€æœ‰çš„webåº”ç”¨éƒ½å¯ä»¥è®¿é—®çš„JARæ–‡ä»¶ logs æ—¥å¿—æ–‡ä»¶çš„é»˜è®¤ç›®å½• temp å­˜æ”¾ä¸´æ—¶æ–‡ä»¶çš„é»˜è®¤ç›®å½• webapps åœ¨tomcatä¸Šå‘å¸ƒJava webåº”ç”¨çš„æ—¶å€™ï¼Œé»˜è®¤æŠŠwebåº”ç”¨çš„æ–‡ä»¶å­˜æ”¾åœ¨è¿™ä¸ªç›®å½• work tomcatçš„å·¥ä½œç›®å½•ï¼ŒtomcatæŠŠè¿è¡Œæ—¶ç”Ÿæˆçš„ä¸€äº›å·¥ä½œæ–‡ä»¶å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ï¼Œå¦‚é»˜è®¤æƒ…å†µä¸‹tomcatä¼šæŠŠç¼–è¯‘JSPç”Ÿæˆçš„Servletç±»æ–‡ä»¶å­˜æ”¾åœ¨è¿™é‡Œ å®é™…ä¸Šé™¤äº†ä¸»ç›®å½•é‡Œæœ‰libç›®å½•ï¼Œåœ¨webappsç›®å½•ä¸‹çš„webåº”ç”¨ä¸­çš„WEB-INFç›®å½•ä¸‹ä¹Ÿå­˜åœ¨ä¸€ä¸ªlibç›®å½•ï¼š ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼š â— Tomcatä¸»ç›®å½•ä¸‹çš„libç›®å½•ï¼šå­˜æ”¾çš„JARæ–‡ä»¶ä¸ä»…èƒ½è¢«Tomcatè®¿é—®ï¼Œè¿˜èƒ½è¢«æ‰€æœ‰åœ¨Tomcatä¸­å‘å¸ƒçš„Java Webåº”ç”¨è®¿é—®â— webappsç›®å½•ä¸‹çš„Java Webåº”ç”¨çš„libç›®å½•ï¼šå­˜æ”¾çš„JARæ–‡ä»¶åªèƒ½è¢«å½“å‰Java Webåº”ç”¨è®¿é—® æ—¢ç„¶æœ‰å¤šä¸ªlibç›®å½•ï¼Œé‚£ä¹ˆè‚¯å®šå°±æœ‰ä½¿ç”¨çš„ä¼˜å…ˆé¡ºåºï¼ŒTomcatç±»åŠ è½½å™¨çš„ç›®å½•åŠ è½½ä¼˜å…ˆé¡ºåºå¦‚ä¸‹ï¼š Tomcatçš„ç±»åŠ è½½å™¨è´Ÿè´£ä¸ºTomcatæœ¬èº«ä»¥åŠJava Webåº”ç”¨åŠ è½½ç›¸å…³çš„ç±»ã€‚å‡å¦‚Tomcatçš„ç±»åŠ è½½å™¨è¦ä¸ºä¸€ä¸ªJava Webåº”ç”¨åŠ è½½ä¸€ä¸ªç±»ï¼Œç±»åŠ è½½å™¨ä¼šæŒ‰ç…§ä»¥ä¸‹ä¼˜å…ˆé¡ºåºåˆ°å„ä¸ªç›®å½•ä¸­å»æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼Œå¦‚æœæ‰€æœ‰ç›®å½•ä¸­éƒ½ä¸å­˜åœ¨è¯¥ç±»çš„.classæ–‡ä»¶ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š åœ¨Java Webåº”ç”¨çš„WEB-INF/classesç›®å½•ä¸‹æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ åœ¨Java Webåº”ç”¨çš„WEB-INF/libç›®å½•ä¸‹çš„JARæ–‡ä»¶ä¸­æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ åœ¨Tomcatçš„libå­ç›®å½•ä¸‹ç›´æ¥æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ åœ¨Tomcatçš„libå­ç›®å½•ä¸‹çš„JARæ–‡ä»¶ä¸­æŸ¥æ‰¾è¯¥ç±»çš„.classæ–‡ä»¶ 2ã€Tomcatçš„å·¥ä½œæ¨¡å¼Tomcatä¸ä»…å¯ä»¥å•ç‹¬è¿è¡Œï¼Œè¿˜å¯ä»¥ä¸å…¶ä»–çš„WebæœåŠ¡å™¨é›†æˆï¼Œä½œä¸ºå…¶ä»–WebæœåŠ¡å™¨çš„è¿›ç¨‹å†…æˆ–è¿›ç¨‹å¤–çš„servletå®¹å™¨ã€‚é›†æˆçš„æ„ä¹‰åœ¨äºï¼šå¯¹äºä¸æ”¯æŒè¿è¡ŒJava Servletçš„å…¶ä»–WebæœåŠ¡å™¨ï¼Œå¯é€šè¿‡é›†æˆTomcatæ¥æä¾›è¿è¡ŒServletçš„åŠŸèƒ½ã€‚ Tomcatæœ‰ä¸‰ç§å·¥ä½œæ¨¡å¼ï¼š ç¬¬ä¸€ç§ï¼šTomcatåœ¨ä¸€ä¸ªJavaè™šæ‹Ÿæœºè¿›ç¨‹ä¸­ç‹¬ç«‹è¿è¡Œï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ç›´æ¥å’Œtomcaté€šä¿¡ã€‚Tomcatå¯çœ‹ä½œæ˜¯èƒ½è¿è¡ŒServletçš„ç‹¬ç«‹WebæœåŠ¡å™¨ã€‚Servletå®¹å™¨ç»„ä»¶ä½œä¸ºWebæœåŠ¡å™¨ä¸­çš„ä¸€éƒ¨åˆ†è€Œå­˜åœ¨ã€‚è¿™æ˜¯Tomcatçš„é»˜è®¤å·¥ä½œæ¨¡å¼ã€‚ ç¬¬äºŒç§ï¼šTomcatè¿è¡Œåœ¨å…¶ä»–WebæœåŠ¡å™¨çš„è¿›ç¨‹ä¸­ï¼ŒTomcatä¸ç›´æ¥å’Œå®¢æˆ·ç«¯é€šä¿¡ï¼Œä»…ä»…ä¸ºå…¶ä»–WebæœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è®¿é—®Servletçš„è¯·æ±‚ã€‚è¿›ç¨‹å†…çš„Servletå®¹å™¨å¯¹äºå•è¿›ç¨‹ã€å¤šçº¿ç¨‹çš„WebæœåŠ¡å™¨éå¸¸åˆé€‚ï¼Œå¯ä»¥æä¾›è¾ƒé«˜çš„è¿è¡Œé€Ÿåº¦ï¼Œä½†ç¼ºä¹ä¼¸ç¼©æ€§ã€‚ åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒTomcatåˆ†ä¸ºWebæœåŠ¡å™¨æ’ä»¶å’ŒServletå®¹å™¨ç»„ä»¶ä¸¤éƒ¨åˆ†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒWebæœåŠ¡å™¨æ’ä»¶åœ¨å…¶ä»–WebæœåŠ¡å™¨è¿›ç¨‹çš„å†…éƒ¨åœ°å€ç©ºé—´å¯åŠ¨ä¸€ä¸ªJavaè™šæ‹Ÿæœºï¼ŒServletå®¹å™¨ç»„ä»¶åœ¨æ­¤Javaè™šæ‹Ÿæœºä¸­è¿è¡Œã€‚å¦‚æœ‰å®¢æˆ·ç«¯å‘å‡ºè°ƒç”¨Servletçš„è¯·æ±‚ï¼ŒWebæœåŠ¡å™¨æ’ä»¶è·å¾—å¯¹æ­¤è¯·æ±‚çš„æ§åˆ¶å¹¶å°†å®ƒè½¬å‘ï¼ˆä½¿ç”¨JNIé€šä¿¡æœºåˆ¶ï¼‰ç»™Servletå®¹å™¨ç»„ä»¶ã€‚ JNIï¼ˆJava Native Interfaceï¼‰æŒ‡çš„æ˜¯Javaæœ¬åœ°è°ƒç”¨æ¥å£ï¼Œé€šè¿‡è¿™ä¸€æ¥å£ï¼ŒJavaç¨‹åºå¯ä»¥å’Œé‡‡ç”¨å…¶ä»–è¯­è¨€ç¼–å†™çš„æœ¬åœ°ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ ç¬¬ä¸‰ç§ï¼šTomcatåœ¨ä¸€ä¸ªJavaè™šæ‹Ÿæœºè¿›ç¨‹ä¸­ç‹¬ç«‹è¿è¡Œï¼Œä½†æ˜¯å®ƒä¸ç›´æ¥å’Œå®¢æˆ·ç«¯é€šä¿¡ï¼Œä»…ä»…ä¸ºä¸å®ƒé›†æˆçš„å…¶ä»–WebæœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è®¿é—®Servletçš„è¯·æ±‚ã€‚ åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒTomcatåˆ†ä¸ºWebæœåŠ¡å™¨æ’ä»¶å’ŒServletå®¹å™¨ç»„ä»¶ä¸¤éƒ¨åˆ†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒWebæœåŠ¡å™¨æ’ä»¶åœ¨å…¶ä»–WebæœåŠ¡å™¨çš„å¤–éƒ¨åœ°å€ç©ºé—´å¯åŠ¨ä¸€ä¸ªJVMè¿›ç¨‹ï¼ŒServletå®¹å™¨ç»„ä»¶åœ¨æ­¤JVMä¸­è¿è¡Œã€‚å¦‚æœ‰å®¢æˆ·ç«¯å‘å‡ºè°ƒç”¨Servletçš„è¯·æ±‚ï¼ŒWebæœåŠ¡å™¨æ’ä»¶è·å¾—å¯¹æ­¤è¯·æ±‚çš„æ§åˆ¶å¹¶å°†å®ƒè½¬å‘ï¼ˆé‡‡ç”¨IPCé€šä¿¡æœºåˆ¶ï¼‰ç»™Servletå®¹å™¨ã€‚ è¿›ç¨‹å¤–Servletå®¹å™¨å¯¹å®¢æˆ·è¯·æ±‚çš„å“åº”é€Ÿåº¦ä¸å¦‚è¿›ç¨‹å†…Servletå®¹å™¨ï¼Œä½†è¿›ç¨‹å¤–å®¹å™¨å…·æœ‰æ›´å¥½çš„ä¼¸ç¼©æ€§å’Œç¨³å®šæ€§ã€‚ IPCï¼ˆInter-Process Communicationï¼Œè¿›ç¨‹é—´é€šä¿¡ï¼‰æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡çš„ä¸€ç§æœºåˆ¶ã€‚ 3ã€Tomcatçš„æ•´ä½“æ¶æ„æˆ‘ä»¬å…ˆä»tomcatçš„æºç ç›®å½•æ¥åˆ†æä¸€ä¸‹tomcatçš„æ•´ä½“æ¶æ„ï¼Œå‰é¢æˆ‘ä»¬é…ç½®jsvcè¿è¡Œtomcatçš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“tomcatä¸­å¯åŠ¨è¿è¡Œçš„æœ€ä¸»è¦çš„ç±»æ˜¯org.apache.catalina.startup.Bootstrapï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨tomcatçš„æºç ä¸­çš„javaç›®å½•ä¸‹çš„orgç›®å½•çš„apacheç›®å½•å¯ä»¥æ‰¾åˆ°ä¸»è¦çš„æºç çš„ç›¸å¯¹åº”çš„ç±»ã€‚ å›¾ä¸­çš„ç›®å½•å¦‚æœç”»æˆæ¶æ„å›¾ï¼Œå¯ä»¥è¿™æ ·è¡¨ç¤ºï¼š Tomcat æœ¬è´¨ä¸Šå°±æ˜¯ä¸€æ¬¾Servlet å®¹å™¨ï¼Œå› æ­¤catalinaæ‰æ˜¯Tomcatçš„æ ¸å¿ƒ ï¼Œå…¶ä»–æ¨¡å—éƒ½æ˜¯ä¸ºcatalinaæä¾›æ”¯æ’‘çš„ã€‚ coyoteæ¨¡å—ä¸»è¦è´Ÿè´£é“¾æ¥é€šä¿¡ï¼ŒTomcatä½œä¸ºhttpæœåŠ¡å™¨ï¼Œéœ€è¦ä»socketä¸­è·å¾—HTTPæ•°æ®æµï¼›è€ŒTomcatä½œä¸ºå®¹å™¨ï¼Œåªèƒ½å¤„ç†å°è£…å¥½çš„org.apache.coyote.Requestï¼Œå› æ­¤ä»socketåˆ°Requestä¹‹é—´çš„è½¬æ¢å°±äº¤ç»™coyoteæ¥è´Ÿè´£äº†ã€‚å› æ­¤ï¼Œè¿æ¥socketå’Œå®¹å™¨ä¹‹é—´çš„é‡ä»»å°±äº¤ç»™äº†Coyoteã€‚ç®€å•è¯´å°±æ˜¯coyoteæ¥å¤„ç†åº•å±‚çš„socketï¼Œå¹¶å°†httpè¯·æ±‚ã€å“åº”ç­‰å­—èŠ‚æµå±‚é¢çš„ä¸œè¥¿ï¼ŒåŒ…è£…æˆRequestå’ŒResponseä¸¤ä¸ªç±»ï¼ˆè¿™ä¸¤ä¸ªç±»æ˜¯tomcatå®šä¹‰çš„ï¼Œè€Œéservletä¸­çš„ServletRequestå’ŒServletResponseï¼‰ï¼Œä¾›å®¹å™¨ä½¿ç”¨ï¼›åŒæ—¶ï¼Œä¸ºäº†èƒ½è®©æˆ‘ä»¬ç¼–å†™çš„servletèƒ½å¤Ÿå¾—åˆ°ServletRequestï¼Œtomcatä½¿ç”¨äº†facadeæ¨¡å¼ï¼Œå°†æ¯”è¾ƒåº•å±‚ã€ä½çº§çš„RequeståŒ…è£…æˆä¸ºServletRequestï¼ˆè¿™ä¸€è¿‡ç¨‹é€šå¸¸å‘ç”Ÿåœ¨Wrapperå®¹å™¨ä¸€çº§ï¼‰ jasperæ¨¡å—æä¾›JSPå¼•æ“ï¼Œåœ¨jspæ–‡ä»¶è¢«åˆæ¬¡è®¿é—®çš„æ—¶å€™åšå‡ºå“åº”ï¼Œå°†jspé¡µé¢ç¿»è¯‘æˆservletè¯·æ±‚ï¼Œç„¶åè°ƒç”¨javaç¼–è¯‘å™¨å¯¹servletè¿›è¡Œç¼–è¯‘å¾—åˆ°classæ–‡ä»¶ï¼Œå†è°ƒç”¨jvmæ¥æ‰§è¡Œclassæ–‡ä»¶ç”Ÿæˆåº”ç­”ï¼Œæœ€åæŠŠåº”ç­”å‘é€å›å®¢æˆ·ç«¯ã€‚ elå…¨åä¸ºExpression Languageï¼Œä¹Ÿå«JUELï¼Œä¸»è¦åœ¨Java Webåº”ç”¨ä¸­ç”¨äºå°†è¡¨è¾¾å¼åµŒå…¥åˆ°webé¡µé¢ namingæä¾›JNDI æœåŠ¡(Java Naming and Directory Interface,Javaå‘½åå’Œç›®å½•æ¥å£)ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†æŸ¥æ‰¾å’Œè®¿é—®å„ç§å‘½åå’Œç›®å½•æœåŠ¡çš„é€šç”¨ã€ç»Ÿä¸€çš„æ¥å£ï¼Œç”±ç®¡ç†è€…å°†JNDI APIæ˜ å°„ä¸ºç‰¹å®šçš„å‘½åæœåŠ¡å’Œç›®å½•ç³»ç»Ÿï¼Œä½¿å¾—Javaåº”ç”¨ç¨‹åºå¯ä»¥å’Œè¿™äº›å‘½åæœåŠ¡å’Œç›®å½•æœåŠ¡ä¹‹é—´è¿›è¡Œäº¤äº’ã€‚ juliæä¾›æ—¥å¿—æœåŠ¡ï¼ŒJDK æ‰€æä¾›çš„é»˜è®¤ java.util.logging å®ç°åŠŸèƒ½å¤ªè¿‡å±€é™ï¼Œä¸èƒ½å®ç°é’ˆå¯¹æ¯ä¸€åº”ç”¨è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œå› ä¸ºé…ç½®æ˜¯é’ˆå¯¹VMçš„ã€‚è€Œjulié€šè¿‡è‡ªå®šä¹‰çš„ LogManager èƒ½åˆ†è¾¨è¿è¡Œåœ¨ Tomcat ä¸Šçš„ä¸åŒ Web åº”ç”¨ï¼ˆä»¥åŠå®ƒä»¬æ‰€ç”¨çš„ä¸åŒçš„ç±»åŠ è½½å™¨ï¼‰ï¼Œè¿˜èƒ½é’ˆå¯¹æ¯ä¸€åº”ç”¨è¿›è¡Œç§æœ‰çš„æ—¥å¿—é…ç½®ã€‚ 4ã€Tomcatçš„I/Oæ¨¡å‹4.1 é˜»å¡I/Oå¤„ç†æ¨¡å‹4.1.1 å•çº¿ç¨‹é˜»å¡I/Oæ¨¡å‹å•çº¿ç¨‹é˜»å¡I/Oæ¨¡å‹æ˜¯æœ€ç®€å•çš„ä¸€ç§æœåŠ¡å™¨I/Oæ¨¡å‹ï¼Œå•çº¿ç¨‹å³åŒæ—¶åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œé˜»å¡å³è¯¥çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å¤„ç†å®Œæˆä¸ºæ­¢ã€‚å¯¹äºå¤šä¸ªå®¢æˆ·ç«¯è®¿é—®ï¼Œå¿…é¡»è¦ç­‰åˆ°å‰ä¸€ä¸ªå®¢æˆ·ç«¯è®¿é—®ç»“æŸæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªè®¿é—®çš„å¤„ç†ï¼Œè¯·æ±‚ä¸€ä¸ªä¸€ä¸ªæ’é˜Ÿï¼Œåªæä¾›ä¸€é—®ä¸€ç­”æœåŠ¡ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šè¿™æ˜¯ä¸€ä¸ªåŒæ­¥é˜»å¡æœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯è®¿é—®çš„æ—¶é—´èŠ‚ç‚¹å›¾ã€‚ é¦–å…ˆï¼ŒæœåŠ¡å™¨å¿…é¡»åˆå§‹åŒ–ä¸€ä¸ªå¥—æ¥å­—æœåŠ¡å™¨ï¼Œå¹¶ç»‘å®šæŸä¸ªç«¯å£å·å¹¶ä½¿ä¹‹ç›‘å¬å®¢æˆ·ç«¯çš„è®¿é—® æ¥ç€ï¼Œå®¢æˆ·ç«¯1è°ƒç”¨æœåŠ¡å™¨çš„æœåŠ¡ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œåå†™æ•°æ®å›å®¢æˆ·ç«¯1ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œé¢å®Œæˆçš„ æœ€åï¼Œå¤„ç†å®¢æˆ·ç«¯2çš„è¯·æ±‚å¹¶å†™æ•°æ®å›å®¢æˆ·ç«¯2ï¼ŒæœŸé—´å°±ç®—å®¢æˆ·ç«¯2åœ¨æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·ç«¯1ä¹‹å‰å°±è¿›è¡Œè¯·æ±‚ï¼Œä¹Ÿè¦ç­‰æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯1å“åº”å®Œåæ‰ä¼šå¯¹å®¢æˆ·ç«¯2è¿›è¡Œå“åº”å¤„ç† è¿™ç§æ¨¡å‹çš„ç‰¹ç‚¹åœ¨äºå•çº¿ç¨‹å’Œé˜»å¡I/Oã€‚å•çº¿ç¨‹å³æœåŠ¡å™¨ç«¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯çš„æ‰€æœ‰è¯·æ±‚ï¼Œå®¢æˆ·ç«¯è¿æ¥ä¸æœåŠ¡å™¨ç«¯çš„å¤„ç†çº¿ç¨‹æ¯”æ˜¯n:1ï¼Œå®ƒæ— æ³•åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ï¼Œåªèƒ½ä¸²è¡Œå¤„ç†è¿æ¥ã€‚è€Œé˜»å¡I/Oæ˜¯æŒ‡æœåŠ¡å™¨åœ¨è¯»å†™æ•°æ®æ—¶æ˜¯é˜»å¡çš„ï¼Œè¯»å–å®¢æˆ·ç«¯æ•°æ®æ—¶è¦ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ®å¹¶ä¸”æŠŠæ“ä½œç³»ç»Ÿå†…æ ¸å¤åˆ¶åˆ°ç”¨æˆ·è¿›ç¨‹ä¸­ï¼Œè¿™æ—¶æ‰è§£é™¤é˜»å¡çŠ¶æ€ã€‚å†™æ•°æ®å›å®¢æˆ·ç«¯æ—¶è¦ç­‰å¾…ç”¨æˆ·è¿›ç¨‹å°†æ•°æ®å†™å…¥å†…æ ¸å¹¶å‘é€åˆ°å®¢æˆ·ç«¯åæ‰è§£é™¤é˜»å¡çŠ¶æ€ã€‚è¿™ç§é˜»å¡å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼ŒæœåŠ¡å™¨å¿…é¡»è¦ç­‰åˆ°å®¢æˆ·ç«¯æˆåŠŸæ¥æ”¶æ‰èƒ½ç»§ç»­å¾€ä¸‹å¤„ç†å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œåœ¨æ­¤æœŸé—´çº¿ç¨‹å°†æ— æ³•å“åº”ä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚ã€‚ è¯¥æ¨¡å‹çš„ç‰¹ç‚¹ï¼šå®ƒæ˜¯æœ€ç®€å•çš„æœåŠ¡å™¨æ¨¡å‹ï¼Œæ•´ä¸ªè¿è¡Œè¿‡ç¨‹éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œåªèƒ½æ”¯æŒåŒæ—¶å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚(å¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯è®¿é—®ï¼Œå°±å¿…é¡»æ’é˜Ÿç­‰å¾…)ï¼ŒæœåŠ¡å™¨ç³»ç»Ÿèµ„æºæ¶ˆè€—è¾ƒå°ï¼Œä½†å¹¶å‘èƒ½åŠ›ä½ï¼Œå®¹é”™èƒ½åŠ›å·®ã€‚ 4.1.2 å¤šçº¿ç¨‹é˜»å¡I/Oæ¨¡å‹å¤šçº¿ç¨‹é˜»å¡I/Oæ¨¡å‹åœ¨å•çº¿ç¨‹é˜»å¡I/Oæ¨¡å‹çš„åŸºç¡€ä¸Šå¯¹å…¶è¿›è¡Œæ”¹è¿›ï¼ŒåŠ å…¥å¤šçº¿ç¨‹ï¼Œæé«˜å¹¶å‘èƒ½åŠ›ï¼Œä½¿å…¶èƒ½å¤ŸåŒæ—¶å¯¹å¤šä¸ªå®¢æˆ·ç«¯è¿›è¡Œå“åº”ï¼Œå¤šçº¿ç¨‹çš„æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨å¤šçº¿ç¨‹æœºåˆ¶ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªçº¿ç¨‹ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæœåŠ¡å™¨ç«¯å¼€å§‹ç›‘å¬å®¢æˆ·ç«¯çš„è®¿é—®ï¼Œå‡å¦‚æœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘é€è¯·æ±‚è¿‡æ¥ï¼ŒæœåŠ¡å™¨ç«¯åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ååˆ†åˆ«åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹å¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ï¼Œæ¯æ¡çº¿ç¨‹è´Ÿè´£ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œç›´åˆ°å“åº”å®Œæˆã€‚æœŸé—´ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘åœ°ä¸ºå„è‡ªå¯¹åº”çš„å®¢æˆ·ç«¯å¤„ç†è¯·æ±‚ï¼ŒåŒ…æ‹¬è¯»å–å®¢æˆ·ç«¯æ•°æ®ã€å¤„ç†å®¢æˆ·ç«¯æ•°æ®ã€å†™æ•°æ®å›å®¢æˆ·ç«¯ç­‰æ“ä½œã€‚ è¿™ç§æ¨¡å‹çš„I/Oæ“ä½œä¹Ÿæ˜¯é˜»å¡çš„ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°è¯»å–æˆ–å†™å…¥æ“ä½œæ—¶éƒ½å°†è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°è¯»å–åˆ°å®¢æˆ·ç«¯çš„æ•°æ®æˆ–æ•°æ®æˆåŠŸå†™å…¥å®¢æˆ·ç«¯åæ‰è§£é™¤é˜»å¡çŠ¶æ€ã€‚å°½ç®¡I/Oæ“ä½œé˜»å¡ï¼Œä½†è¿™ç§æ¨¡å¼æ¯”å•çº¿ç¨‹å¤„ç†çš„æ€§èƒ½æ˜æ˜¾é«˜äº†ï¼Œå®ƒä¸ç”¨ç­‰åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œæ‰å¤„ç†ç¬¬äºŒä¸ªï¼Œè€Œæ˜¯å¹¶å‘åœ°å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå®¢æˆ·ç«¯è¿æ¥ä¸æœåŠ¡å™¨ç«¯å¤„ç†çº¿ç¨‹çš„æ¯”ä¾‹æ˜¯1:1ã€‚ å¤šçº¿ç¨‹é˜»å¡I/Oæ¨¡å‹çš„ç‰¹ç‚¹ï¼šæ”¯æŒå¯¹å¤šä¸ªå®¢æˆ·ç«¯å¹¶å‘å“åº”ï¼Œå¤„ç†èƒ½åŠ›å¾—åˆ°å¤§å¹…æé«˜ï¼Œæœ‰è¾ƒå¤§çš„å¹¶å‘é‡ï¼Œä½†æœåŠ¡å™¨ç³»ç»Ÿèµ„æºæ¶ˆè€—é‡è¾ƒå¤§ï¼Œè€Œä¸”å¦‚æœçº¿ç¨‹æ•°è¿‡å¤šï¼Œå¤šçº¿ç¨‹ä¹‹é—´ä¼šäº§ç”Ÿè¾ƒå¤§çš„çº¿ç¨‹åˆ‡æ¢æˆæœ¬ï¼ŒåŒæ—¶æ‹¥æœ‰è¾ƒå¤æ‚çš„ç»“æ„ã€‚ 4.2 éé˜»å¡I/Oæ¨¡å‹4.2.1 éé˜»å¡æƒ…å†µä¸‹çš„äº‹ä»¶æ£€æµ‹åœ¨æ¢è®¨å•çº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹å‰å¿…é¡»è¦å…ˆäº†è§£éé˜»å¡æƒ…å†µä¸‹å¥—æ¥å­—äº‹ä»¶çš„æ£€æµ‹æœºåˆ¶ï¼Œå› ä¸ºå¯¹äºå•çº¿ç¨‹éé˜»å¡æ¨¡å‹æœ€é‡è¦çš„äº‹æƒ…æ˜¯æ£€æµ‹å“ªäº›è¿æ¥æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿã€‚ä¸€èˆ¬ä¼šæœ‰å¦‚ä¸‹ä¸‰ç§æ£€æµ‹æ–¹å¼ã€‚ æ­¤å¤„â€œæœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿâ€æŒ‡çš„æ˜¯éœ€è¦è¿›è¡Œè¯»å†™æ•°æ®ç­‰æ“ä½œã€‚ (1)åº”ç”¨ç¨‹åºéå†å¥—æ¥å­—çš„äº‹ä»¶æ£€æµ‹å½“å¤šä¸ªå®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¼šä¿å­˜ä¸€ä¸ªå¥—æ¥å­—è¿æ¥åˆ—è¡¨ä¸­ï¼Œåº”ç”¨å±‚çº¿ç¨‹å¯¹å¥—æ¥å­—åˆ—è¡¨è½®è¯¢å°è¯•è¯»å–æˆ–å†™å…¥ã€‚å¦‚æœæˆåŠŸåˆ™è¿›è¡Œå¤„ç†ï¼Œå¦‚æœå¤±è´¥åˆ™ä¸‹æ¬¡ç»§ç»­ã€‚è¿™æ ·ä¸ç®¡æœ‰å¤šå°‘ä¸ªå¥—æ¥å­—è¿æ¥ï¼Œå®ƒä»¬éƒ½å¯ä»¥è¢«ä¸€ä¸ªçº¿ç¨‹ç®¡ç†ï¼Œè¿™å¾ˆå¥½åœ°åˆ©ç”¨äº†é˜»å¡çš„æ—¶é—´ï¼Œå¤„ç†èƒ½åŠ›å¾—åˆ°æå‡ã€‚ ä½†è¿™ç§æ¨¡å‹éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­éå†æ‰€æœ‰çš„å¥—æ¥å­—åˆ—è¡¨ï¼ŒåŒæ—¶éœ€è¦å¤„ç†æ•°æ®çš„æ‹¼æ¥ï¼Œè¿æ¥ç©ºé—²æ—¶å¯èƒ½ä¹Ÿä¼šå ç”¨è¾ƒå¤šCPUèµ„æºï¼Œä¸é€‚åˆå®é™…ä½¿ç”¨ã€‚ (2)å†…æ ¸éå†å¥—æ¥å­—çš„äº‹ä»¶æ£€æµ‹è¿™ç§æ–¹å¼å°†å¥—æ¥å­—çš„éå†å·¥ä½œäº¤ç»™äº†æ“ä½œç³»ç»Ÿå†…æ ¸ï¼ŒæŠŠå¯¹å¥—æ¥å­—éå†çš„ç»“æœç»„ç»‡æˆä¸€ç³»åˆ—çš„äº‹ä»¶åˆ—è¡¨å¹¶è¿”å›åº”ç”¨å±‚å¤„ç†ã€‚å¯¹äºåº”ç”¨å±‚ï¼Œå®ƒä»¬éœ€è¦å¤„ç†çš„å¯¹è±¡å°±æ˜¯è¿™äº›äº‹ä»¶ï¼Œè¿™æ˜¯ä¸€ç§äº‹ä»¶é©±åŠ¨çš„éé˜»å¡æ–¹å¼ã€‚ æœåŠ¡å™¨ç«¯æœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œåº”ç”¨å±‚å‘å†…æ ¸è¯·æ±‚è¯»å†™äº‹ä»¶åˆ—è¡¨ã€‚å†…æ ¸éå†æ‰€æœ‰å¥—æ¥å­—å¹¶ç”Ÿæˆå¯¹åº”çš„å¯è¯»åˆ—è¡¨readListå’Œå¯å†™åˆ—è¡¨writeListã€‚readListå’ŒwriteListåˆ™æ ‡æ˜äº†æ¯ä¸ªå¥—æ¥å­—æ˜¯å¦å¯è¯»/å¯å†™ã€‚åº”ç”¨å±‚éå†è¯»å†™äº‹ä»¶åˆ—è¡¨readListå’ŒwriteListï¼Œåšç›¸åº”çš„è¯»å†™æ“ä½œã€‚ å†…æ ¸éå†å¥—æ¥å­—æ—¶å·²ç»ä¸ç”¨åœ¨åº”ç”¨å±‚å¯¹æ‰€æœ‰å¥—æ¥å­—è¿›è¡Œéå†ï¼Œå°†éå†å·¥ä½œä¸‹ç§»åˆ°å†…æ ¸å±‚ï¼Œè¿™ç§æ–¹å¼æœ‰åŠ©äºæé«˜æ£€æµ‹æ•ˆç‡ã€‚ç„¶è€Œï¼Œå®ƒéœ€è¦å°†æ‰€æœ‰è¿æ¥çš„å¯è¯»äº‹ä»¶åˆ—è¡¨å’Œå¯å†™äº‹ä»¶åˆ—è¡¨ä¼ åˆ°åº”ç”¨å±‚ï¼Œå‡å¦‚å¥—æ¥å­—è¿æ¥æ•°é‡å˜å¤§ï¼Œåˆ—è¡¨ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨å±‚ä¹Ÿæ˜¯ä¸å°çš„å¼€é”€ã€‚å¦å¤–ï¼Œå½“æ´»è·ƒè¿æ¥è¾ƒå°‘æ—¶ï¼Œå†…æ ¸ä¸åº”ç”¨å±‚ä¹‹é—´å­˜åœ¨å¾ˆå¤šæ— æ•ˆçš„æ•°æ®å‰¯æœ¬ï¼Œå› ä¸ºå®ƒå°†æ´»è·ƒå’Œä¸æ´»è·ƒçš„è¿æ¥çŠ¶æ€éƒ½å¤åˆ¶åˆ°åº”ç”¨å±‚ä¸­ã€‚ (3)å†…æ ¸åŸºäºå›è°ƒçš„äº‹ä»¶æ£€æµ‹é€šè¿‡éå†çš„æ–¹å¼æ£€æµ‹å¥—æ¥å­—æ˜¯å¦å¯è¯»å¯å†™æ˜¯ä¸€ç§æ•ˆç‡æ¯”è¾ƒä½çš„æ–¹å¼ï¼Œä¸ç®¡æ˜¯åœ¨åº”ç”¨å±‚ä¸­éå†è¿˜æ˜¯åœ¨å†…æ ¸ä¸­éå†ã€‚æ‰€ä»¥éœ€è¦å¦å¤–ä¸€ç§æœºåˆ¶æ¥ä¼˜åŒ–éå†çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯å›è°ƒå‡½æ•°ã€‚å†…æ ¸ä¸­çš„å¥—æ¥å­—éƒ½å¯¹åº”ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å®¢æˆ·ç«¯å¾€å¥—æ¥å­—å‘é€æ•°æ®æ—¶ï¼Œå†…æ ¸ä»ç½‘å¡æ¥æ”¶æ•°æ®åå°±ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­ç»´æŠ¤äº‹ä»¶åˆ—è¡¨ï¼Œåº”ç”¨å±‚è·å–æ­¤äº‹ä»¶åˆ—è¡¨å³å¯å¾—åˆ°æ‰€æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚ å†…æ ¸åŸºäºå›è°ƒçš„äº‹ä»¶æ£€æµ‹æ–¹å¼æœ‰ä¸¤ç§ æ–¹å¼ä¸€ï¼šç¬¬ä¸€ç§æ˜¯ç”¨å¯è¯»åˆ—è¡¨readListå’Œå¯å†™åˆ—è¡¨writeListæ ‡è®°è¯»å†™äº‹ä»¶ï¼Œå¥—æ¥å­—çš„æ•°é‡ä¸readListå’ŒwriteListä¸¤ä¸ªåˆ—è¡¨çš„é•¿åº¦ä¸€æ ·ã€‚ æœåŠ¡å™¨ç«¯æœ‰å¤šä¸ªå®¢æˆ·ç«¯å¥—æ¥å­—è¿æ¥ å½“å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥æ—¶ï¼Œå†…æ ¸ä»ç½‘å¡å¤åˆ¶æ•°æ®æˆåŠŸåè°ƒç”¨å›è°ƒå‡½æ•°å°†readList/writeListå¯¹åº”çš„å…ƒç´ æ ‡è®°ä¸ºå¯è¯»/å¯å†™ åº”ç”¨å±‚å‘é€è¯·æ±‚è¯»ã€å†™äº‹ä»¶åˆ—è¡¨ï¼Œå†…æ ¸è¿”å›åŒ…å«äº†äº‹ä»¶æ ‡è¯†çš„readListå’ŒwriteListäº‹ä»¶åˆ—è¡¨ï¼Œæ­¤æ—¶è¿”å›çš„ä¸¤ä¸ªåˆ—è¡¨å†…å®¹å¤§è‡´å¦‚ä¸‹ å¥—æ¥å­— readList 1 1 2 0 3 1 â€¦â€¦ â€¦â€¦ n â€¦â€¦ å¥—æ¥å­— writeList 1 0 2 1 3 0 â€¦â€¦ â€¦â€¦ n â€¦â€¦ åº”ç”¨ç¨‹åºæ¥ç€åˆ†è¡¨éå†è¯»äº‹ä»¶åˆ—è¡¨readListå’Œå†™äº‹ä»¶åˆ—è¡¨writeListï¼Œå¯¹ç½®ä¸º1çš„å…ƒç´ å¯¹åº”çš„å¥—æ¥å­—è¿›è¡Œè¯»æˆ–å†™æ“ä½œ è¿™æ ·å°±é¿å…äº†éå†å¥—æ¥å­—çš„æ“ä½œï¼Œä½†ä»ç„¶æœ‰å¤§é‡æ— ç”¨çš„æ•°æ®(çŠ¶æ€ä¸º0çš„å…ƒç´ )ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨å±‚ä¸­ã€‚ä»ä¸Šé¢çš„è¡¨æ ¼ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®é™…ä¸Šæœ‰ç”¨çš„æ•°æ®åªæ˜¯åœ¨Listä¸­è¢«æ ‡è®°ä¸º1çš„æ•°æ®ï¼ˆæ„å‘³ç€å¯è¯»æˆ–å¯å†™ï¼‰ï¼Œå…¶ä»–çš„æ•°æ®å¹¶æ²¡æœ‰ä¼ é€å›å»çš„å¿…è¦ã€‚ æ–¹å¼äºŒï¼š æœåŠ¡å™¨ç«¯æœ‰å¤šä¸ªå®¢æˆ·ç«¯å¥—æ¥å­—è¿æ¥ã€‚ åº”ç”¨å±‚å‘Šè¯‰å†…æ ¸æ¯ä¸ªå¥—æ¥å­—æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œè¿™æ—¶å€™ç›´æ¥å‘é€ä¸€ä¸ªåˆ—è¡¨ç»™å†…æ ¸ å¥—æ¥å­— æ“ä½œ 1 read 2 write 3 read â€¦â€¦ â€¦â€¦ n â€¦â€¦ æ¥ç€ï¼Œå½“å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥æ—¶ï¼Œå¯¹åº”ä¼šæœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå†…æ ¸ä»ç½‘å¡å¤åˆ¶æ•°æ®æˆåŠŸåå³è°ƒå›è°ƒå‡½æ•°å°†å¥—æ¥å­—1ä½œä¸ºå¯è¯»äº‹ä»¶event1åŠ å…¥åˆ°äº‹ä»¶åˆ—è¡¨ï¼ŒåŒæ ·åœ°ï¼Œå†…æ ¸å‘ç°ç½‘å¡å¯å†™æ—¶å°±å°†å¥—æ¥å­—2ä½œä¸ºå¯å†™äº‹ä»¶event2æ·»åŠ åˆ°äº‹ä»¶åˆ—è¡¨ä¸­ åº”ç”¨å±‚å‘å†…æ ¸è¯·æ±‚è¯»ã€å†™äº‹ä»¶åˆ—è¡¨ï¼Œå†…æ ¸å°†åŒ…å«äº†event1å’Œevent2çš„äº‹ä»¶åˆ—è¡¨è¿”å›åº”ç”¨å±‚ï¼Œæ­¤æ—¶çš„åˆ—è¡¨å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š å¥—æ¥å­— å¯ä»¥è¿›è¡Œçš„æ“ä½œ 1 read 2 write æ³¨æ„è¿™æ—¶ä¸èƒ½è¿›è¡Œè¯»å†™æ“ä½œçš„å¥—æ¥å­—æ˜¯ä¸ä¼šè¢«è®°å½•åˆ°åˆ—è¡¨ä¸­è¿”å›ç»™åº”ç”¨å±‚çš„ï¼Œè¿™å°±å¤§å¤§åœ°å‡å°‘äº†æ•°æ®çš„ä¼ è¾“é‡ã€‚ åº”ç”¨å±‚é€šè¿‡éå†äº‹ä»¶åˆ—è¡¨å¾—çŸ¥å“ªäº›å¥—æ¥å­—å¯ä»¥è¿›è¡Œå“ªäº›æ“ä½œï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚ ä¸Šé¢ä¸¤ç§æ–¹å¼ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç»´æŠ¤å®¢æˆ·ç«¯çš„æ‰€æœ‰è¿æ¥å¹¶é€šè¿‡å›è°ƒå‡½æ•°ä¸æ–­æ›´æ–°äº‹ä»¶åˆ—è¡¨ï¼Œè€Œåº”ç”¨å±‚çº¿ç¨‹åªè¦éå†è¿™äº›äº‹ä»¶åˆ—è¡¨å³å¯çŸ¥é“å¯è¯»å–æˆ–å¯å†™å…¥çš„è¿æ¥ï¼Œè¿›è€Œå¯¹è¿™äº›è¿æ¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œæå¤§æé«˜äº†æ£€æµ‹æ•ˆç‡ï¼Œè‡ªç„¶å¤„ç†èƒ½åŠ›ä¹Ÿæ›´å¼ºã€‚ 4.2.2 å•çº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹å•çº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹æœ€é‡è¦çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œåœ¨è°ƒç”¨è¯»å–æˆ–å†™å…¥æ¥å£åç«‹å³è¿”å›ï¼Œè€Œä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚è™½ç„¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å®ƒé€šè¿‡æŠŠéé˜»å¡è¯»å†™æ“ä½œä¸ä¸Šé¢å‡ ç§æ£€æµ‹æœºåˆ¶é…åˆå°±å¯ä»¥å®ç°å¯¹å¤šä¸ªè¿æ¥çš„åŠæ—¶å¤„ç†ï¼Œè€Œä¸ä¼šå› ä¸ºæŸä¸ªè¿æ¥çš„é˜»å¡æ“ä½œå¯¼è‡´å…¶ä»–è¿æ¥æ— æ³•å¤„ç†ã€‚åœ¨å®¢æˆ·ç«¯è¿æ¥å¤§å¤šæ•°éƒ½ä¿æŒæ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªçº¿ç¨‹ä¼šä¸€ç›´å¾ªç¯å¤„ç†è¿™äº›è¿æ¥ï¼Œå®ƒå¾ˆå¥½åœ°åˆ©ç”¨äº†é˜»å¡çš„æ—¶é—´ï¼Œå¤§å¤§æé«˜äº†è¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚ å•çº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹çš„ä¸»è¦ä¼˜åŠ¿ä½“ç°åœ¨å¯¹å¤šä¸ªè¿æ¥çš„ç®¡ç†ï¼Œä¸€èˆ¬åœ¨åŒæ—¶éœ€è¦å¤„ç†å¤šä¸ªè¿æ¥çš„å‘åœºæ™¯ä¸­ä¼šä½¿ç”¨éé˜»å¡NIOæ¨¡å¼ï¼Œæ­¤æ¨¡å‹ä¸‹åªé€šè¿‡ä¸€ä¸ªçº¿ç¨‹å»ç»´æŠ¤å’Œå¤„ç†è¿æ¥ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†æœºå™¨çš„æ•ˆç‡ã€‚ä¸€èˆ¬æœåŠ¡å™¨ç«¯æ‰ä¼šä½¿ç”¨NIOæ¨¡å¼ï¼Œè€Œå¯¹äºå®¢æˆ·ç«¯ï¼Œå‡ºäºæ–¹ä¾¿åŠä¹ æƒ¯ï¼Œå¯ä½¿ç”¨é˜»å¡æ¨¡å¼çš„å¥—æ¥å­—è¿›è¡Œé€šä¿¡ã€‚ 4.2.3 å¤šçº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹åœ¨å¤šæ ¸çš„æœºå™¨ä¸Šå¯ä»¥é€šè¿‡å¤šçº¿ç¨‹ç»§ç»­æé«˜æœºå™¨æ•ˆç‡ã€‚æœ€æœ´å®ã€æœ€è‡ªç„¶çš„åšæ³•å°±æ˜¯å°†å®¢æˆ·ç«¯è¿æ¥æŒ‰ç»„åˆ†é…ç»™è‹¥å¹²çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£å¤„ç†å¯¹åº”ç»„å†…çš„è¿æ¥ã€‚æ¯”å¦‚æœ‰4ä¸ªå®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†å¥—æ¥å­—1å’Œå¥—æ¥å­—2äº¤ç”±çº¿ç¨‹1ç®¡ç†ï¼Œè€Œçº¿ç¨‹2åˆ™ç®¡ç†å¥—æ¥å­—3å’Œå¥—æ¥å­—4ï¼Œé€šè¿‡äº‹ä»¶æ£€æµ‹åŠéé˜»å¡è¯»å†™å°±å¯ä»¥è®©æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½é«˜æ•ˆå¤„ç†ã€‚ å¤šçº¿ç¨‹éé˜»å¡I/Oæ¨¡å¼è®©æœåŠ¡å™¨ç«¯å¤„ç†èƒ½åŠ›å¾—åˆ°å¾ˆå¤§æé«˜ï¼Œå®ƒå……åˆ†åˆ©ç”¨æœºå™¨çš„CPUï¼Œé€‚åˆç”¨äºå¤„ç†é«˜å¹¶å‘çš„åœºæ™¯ï¼Œä½†å®ƒä¹Ÿè®©ç¨‹åºæ›´å¤æ‚ï¼Œæ›´å®¹æ˜“å‡ºç°é—®é¢˜ï¼ˆæ­»é”ã€æ•°æ®ä¸ä¸€è‡´ç­‰ç»å…¸å¹¶å‘é—®é¢˜ï¼‰ã€‚ 4.2.4 Reactoræ¨¡å¼æœ€ç»å…¸çš„å¤šçº¿ç¨‹éé˜»å¡I/Oæ¨¡å‹æ–¹å¼æ˜¯Reactoræ¨¡å¼ã€‚é¦–å…ˆçœ‹å•çº¿ç¨‹ä¸‹çš„Reactorï¼ŒReactorå°†æœåŠ¡å™¨ç«¯çš„æ•´ä¸ªå¤„ç†è¿‡ç¨‹åˆ†æˆè‹¥å¹²ä¸ªäº‹ä»¶ï¼Œä¾‹å¦‚åˆ†ä¸ºæ¥æ”¶äº‹ä»¶ã€è¯»äº‹ä»¶ã€å†™äº‹ä»¶ã€æ‰§è¡Œäº‹ä»¶ç­‰ã€‚Reactoré€šè¿‡äº‹ä»¶æ£€æµ‹æœºåˆ¶å°†è¿™äº›äº‹ä»¶åˆ†å‘ç»™ä¸åŒå¤„ç†å™¨å»å¤„ç†ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­åªè¦æœ‰å¾…å¤„ç†çš„äº‹ä»¶å­˜åœ¨ï¼Œå³å¯ä»¥è®©Reactorçº¿ç¨‹ä¸æ–­å¾€ä¸‹æ‰§è¡Œï¼Œè€Œä¸ä¼šé˜»å¡åœ¨æŸå¤„ï¼Œæ‰€ä»¥å¤„ç†æ•ˆç‡å¾ˆé«˜ã€‚ åŸºäºå•çº¿ç¨‹Reactoræ¨¡å‹ï¼Œæ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯ï¼ŒæŠŠå®ƒæ”¹è¿›æˆå¤šçº¿ç¨‹æ¨¡å¼ã€‚å¸¸è§çš„æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯åœ¨è€—æ—¶çš„processå¤„ç†å™¨ä¸­å¼•å…¥å¤šçº¿ç¨‹ï¼Œå¦‚ä½¿ç”¨çº¿ç¨‹æ± ï¼›å¦ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨å¤šä¸ªReactorå®ä¾‹ï¼Œæ¯ä¸ªReactorå®ä¾‹å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚ Reactoræ¨¡å¼çš„ä¸€ç§æ”¹è¿›æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…¶æ•´ä½“ç»“æ„åŸºæœ¬ä¸Šä¸å•çº¿ç¨‹çš„Reactorç±»ä¼¼ï¼Œåªæ˜¯å¼•å…¥äº†ä¸€ä¸ªçº¿ç¨‹æ± ã€‚ç”±äºå¯¹è¿æ¥çš„æ¥æ”¶ã€å¯¹æ•°æ®çš„è¯»å–å’Œå¯¹æ•°æ®çš„å†™å…¥ç­‰æ“ä½œåŸºæœ¬ä¸Šéƒ½è€—æ—¶è¾ƒå°‘ï¼Œå› æ­¤æŠŠå®ƒä»¬éƒ½æ”¾åˆ°Reactorçº¿ç¨‹ä¸­å¤„ç†ã€‚ç„¶è€Œï¼Œå¯¹äºé€»è¾‘å¤„ç†å¯èƒ½æ¯”è¾ƒè€—æ—¶çš„å·¥ä½œï¼Œå¯ä»¥åœ¨processå¤„ç†å™¨ä¸­å¼•å…¥çº¿ç¨‹æ± ï¼Œprocesså¤„ç†å™¨è‡ªå·±ä¸æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯äº¤ç»™çº¿ç¨‹æ± ï¼Œä»è€Œåœ¨Reactorçº¿ç¨‹ä¸­é¿å…äº†è€—æ—¶çš„æ“ä½œã€‚å°†è€—æ—¶çš„æ“ä½œè½¬ç§»åˆ°çº¿ç¨‹æ± ä¸­åï¼Œå°½ç®¡Reactoråªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¹Ÿèƒ½ä¿è¯Reactorçš„é«˜æ•ˆã€‚ Reactoræ¨¡å¼çš„å¦ä¸€ç§æ”¹è¿›æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…¶ä¸­æœ‰å¤šä¸ªReactorå®ä¾‹ï¼Œæ¯ä¸ªReactorå®ä¾‹å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚å› ä¸ºæ¥æ”¶äº‹ä»¶æ˜¯ç›¸å¯¹äºæœåŠ¡å™¨ç«¯è€Œè¨€çš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯çš„è¿æ¥æ¥æ”¶å·¥ä½œç»Ÿä¸€ç”±ä¸€ä¸ªacceptå¤„ç†å™¨è´Ÿè´£ï¼Œacceptå¤„ç†å™¨ä¼šå°†æ¥æ”¶çš„å®¢æˆ·ç«¯è¿æ¥å‡åŒ€åˆ†é…ç»™æ‰€æœ‰Reactorå®ä¾‹ï¼Œæ¯ä¸ªReactorå®ä¾‹è´Ÿè´£å¤„ç†åˆ†é…åˆ°è¯¥Reactorä¸Šçš„å®¢æˆ·ç«¯è¿æ¥ï¼ŒåŒ…æ‹¬è¿æ¥çš„è¯»æ•°æ®ã€å†™æ•°æ®å’Œé€»è¾‘å¤„ç†ã€‚è¿™å°±æ˜¯å¤šReactorå®ä¾‹çš„åŸç†ã€‚ 4.3 Tomcatçš„I/Oæ¨¡å‹Tomcatæ”¯æŒçš„I/Oæ¨¡å‹å¦‚ä¸‹è¡¨ï¼ˆè‡ª8.5/9.0 ç‰ˆæœ¬èµ·ï¼ŒTomcatç§»é™¤äº†å¯¹BIOçš„æ”¯æŒï¼‰ï¼Œåœ¨ 8.0 ä¹‹å‰ ï¼Œ Tomcat é»˜è®¤é‡‡ç”¨çš„I/Oæ–¹å¼ä¸º BIO ï¼Œ ä¹‹åæ”¹ä¸º NIOã€‚ æ— è®º NIOã€NIO2 è¿˜æ˜¯ APRï¼Œ åœ¨æ€§èƒ½æ–¹é¢å‡ä¼˜äºä»¥å¾€çš„BIOã€‚ IOæ¨¡å‹ æè¿° NIO åŒæ­¥éé˜»å¡I/Oï¼Œé‡‡ç”¨Java NIOç±»åº“å®ç° NIO2 å¼‚æ­¥éé˜»å¡I/Oï¼Œé‡‡ç”¨JDK 7æœ€æ–°çš„NIO2ç±»åº“å®ç° APR é‡‡ç”¨Apacheå¯ç§»æ¤è¿è¡Œåº“å®ç°ï¼Œæ˜¯C/C++ç¼–å†™çš„æœ¬åœ°åº“ï¼Œéœ€è¦å•ç‹¬å®‰è£…APRåº“ 4.3.1 NIOï¼ˆNew I/O APIsã€åŒæ­¥éé˜»å¡ï¼‰Tomcatä¸­çš„NIOæ¨¡å‹æ˜¯ä½¿ç”¨çš„JAVAçš„NIOç±»åº“ï¼Œå…¶å†…éƒ¨çš„IOå®ç°æ˜¯åŒæ­¥çš„ï¼ˆä¹Ÿå°±æ˜¯åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ•°æ®äº¤æ¢ä¸Šæ˜¯åŒæ­¥æœºåˆ¶ï¼‰ï¼Œé‡‡ç”¨åŸºäºselectorå®ç°çš„å¼‚æ­¥äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼ˆè¿™é‡Œçš„å¼‚æ­¥æŒ‡çš„æ˜¯selectorè¿™ä¸ªå®ç°æ¨¡å‹æ˜¯ä½¿ç”¨çš„å¼‚æ­¥æœºåˆ¶ï¼‰ã€‚è€Œå¯¹äºJavaæ¥è¯´ï¼Œéé˜»å¡I/Oçš„å®ç°å®Œå…¨æ˜¯åŸºäºæ“ä½œç³»ç»Ÿå†…æ ¸çš„éé˜»å¡I/Oï¼Œå®ƒå°†æ“ä½œç³»ç»Ÿçš„éé˜»å¡I/Oçš„å·®å¼‚å±è”½å¹¶æä¾›ç»Ÿä¸€çš„APIï¼Œè®©æˆ‘ä»¬ä¸å¿…å…³å¿ƒæ“ä½œç³»ç»Ÿã€‚JDKä¼šå¸®æˆ‘ä»¬é€‰æ‹©éé˜»å¡I/Oçš„å®ç°æ–¹å¼ã€‚ è¿™é‡Œéœ€è¦æä¸€ä¸‹åŒæ­¥å¼‚æ­¥å’Œé˜»å¡éé˜»å¡çš„æ¦‚å¿µï¼š åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ï¼ŒåŒæ­¥å¼‚æ­¥æŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºå‘èµ·çš„è°ƒç”¨è¯·æ±‚å’Œè·å¾—çš„è¿”å›å€¼æ˜¯å¦ä¸€èµ·è¿”å›ï¼Œå¦‚æœä¸€èµ·è¿”å›å°±æ˜¯åŒæ­¥ï¼Œå¦åˆ™å°±æ˜¯å¼‚æ­¥ï¼Œå¼‚æ­¥å¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°ç­‰æ–¹å¼å®ç°ã€‚ é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœæ—¶çš„çŠ¶æ€ï¼Œåº”ç”¨ç¨‹åºå‘èµ·è°ƒç”¨è¯·æ±‚ä¹‹åä¸èƒ½å¹²åˆ«çš„äº‹æƒ…ç›´åˆ°è¯·æ±‚å¤„ç†å®Œæˆäº†å°±æ˜¯é˜»å¡ï¼Œå¦åˆ™å°±æ˜¯éé˜»å¡ã€‚ æ‰€ä»¥æˆ‘ä¸ªäººè®¤ä¸ºï¼Œå¯¹äºé˜»å¡I/Oè°ˆåŒæ­¥å¼‚æ­¥æ˜¯æ²¡æœ‰å¤ªå¤§æ„ä¹‰çš„ï¼Œå› ä¸ºæ­¤æ—¶è¿›ç¨‹å·²ç»é˜»å¡ï¼Œæƒ³è¦å»å¹²åˆ«çš„äº‹æƒ…å¿…é¡»å¾—ç­‰è¯·æ±‚å¤„ç†å®Œï¼Œè€Œè¯·æ±‚å¤„ç†å®Œå¿…ç„¶ä¼šå¾—åˆ°è¿”å›å€¼ã€‚ ä¸Šé¢æˆ‘ä»¬æåˆ°å¾—å†…æ ¸åŸºäºå›è°ƒå¾—äº‹ä»¶æ£€æµ‹æ–¹å¼äºŒå°±æ˜¯å…¸å‹çš„å¼‚æ­¥éé˜»å¡I/Oæ¨¡å‹ã€‚ 4.3.2 NIO2ï¼ˆNew I/O APIs 2ã€å¼‚æ­¥éé˜»å¡ã€AIOï¼‰NIO2å’Œå‰è€…ç›¸æ¯”çš„æœ€å¤§ä¸åŒå°±åœ¨äºå¼•å…¥äº†å¼‚æ­¥é€šé“æ¥å®ç°å¼‚æ­¥IOæ“ä½œï¼Œå› æ­¤ä¹Ÿå«AIOï¼ˆAsynchronous I/Oï¼‰ã€‚NIO.2 çš„å¼‚æ­¥é€šé“ APIs æä¾›æ–¹ä¾¿çš„ã€å¹³å°ç‹¬ç«‹çš„æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ ‡å‡†æ–¹æ³•ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜èƒ½å¤Ÿä»¥æ›´æ¸…æ™°çš„æ–¹å¼æ¥ç¼–å†™ç¨‹åºï¼Œè€Œä¸å¿…å®šä¹‰è‡ªå·±çš„ Java çº¿ç¨‹ï¼Œæ­¤å¤–ï¼Œè¿˜å¯é€šè¿‡ä½¿ç”¨åº•å±‚ OS æ‰€æ”¯æŒçš„å¼‚æ­¥åŠŸèƒ½æ¥æé«˜æ€§èƒ½ã€‚å¦‚åŒå…¶ä»– Java API ä¸€æ ·ï¼ŒAPI å¯åˆ©ç”¨çš„ OS è‡ªæœ‰å¼‚æ­¥åŠŸèƒ½çš„æ•°é‡å–å†³äºå…¶å¯¹è¯¥å¹³å°çš„æ”¯æŒç¨‹åº¦ã€‚ å¼‚æ­¥é€šé“æä¾›æ”¯æŒè¿æ¥ã€è¯»å–ã€ä»¥åŠå†™å…¥ä¹‹ç±»éé”å®šæ“ä½œçš„è¿æ¥ï¼Œå¹¶æä¾›å¯¹å·²å¯åŠ¨æ“ä½œçš„æ§åˆ¶æœºåˆ¶ã€‚Java 7 ä¸­ç”¨äº Java Platformï¼ˆNIO.2ï¼‰çš„ More New I/O APIsï¼Œé€šè¿‡åœ¨ java.nio.channels åŒ…ä¸­å¢åŠ å››ä¸ªå¼‚æ­¥é€šé“ç±»ï¼Œä»è€Œå¢å¼ºäº† Java 1.4 ä¸­çš„ New I/O APIsï¼ˆNIOï¼‰ï¼Œè¿™äº›ç±»åœ¨é£æ ¼ä¸Šä¸ NIO é€šé“ API å¾ˆç›¸ä¼¼ã€‚ä»–ä»¬å…±äº«ç›¸åŒçš„æ–¹æ³•ä¸å‚æ•°ç»“æ„ä½“ï¼Œå¹¶ä¸”å¤§å¤šæ•°å¯¹äº NIO é€šé“ç±»å¯ç”¨çš„å‚æ•°ï¼Œå¯¹äºæ–°çš„å¼‚æ­¥ç‰ˆæœ¬ä»ç„¶å¯ç”¨ã€‚ä¸»è¦åŒºåˆ«åœ¨äºæ–°é€šé“å¯ä½¿ä¸€äº›æ“ä½œå¼‚æ­¥æ‰§è¡Œã€‚ å¼‚æ­¥é€šé“ API æä¾›ä¸¤ç§å¯¹å·²å¯åŠ¨å¼‚æ­¥æ“ä½œçš„ç›‘æµ‹ä¸æ§åˆ¶æœºåˆ¶ã€‚ç¬¬ä¸€ç§æ˜¯é€šè¿‡è¿”å›ä¸€ä¸ª java.util.concurrent.Future å¯¹è±¡æ¥å®ç°ï¼Œå®ƒå°†ä¼šå»ºæ¨¡ä¸€ä¸ªæŒ‚èµ·æ“ä½œï¼Œå¹¶å¯ç”¨äºæŸ¥è¯¢å…¶çŠ¶æ€ä»¥åŠè·å–ç»“æœã€‚ç¬¬äºŒç§æ˜¯é€šè¿‡ä¼ é€’ç»™æ“ä½œä¸€ä¸ªæ–°ç±»çš„å¯¹è±¡ï¼Œjava.nio.channels.CompletionHandlerï¼Œæ¥å®Œæˆï¼Œå®ƒä¼šå®šä¹‰åœ¨æ“ä½œå®Œæ¯•åæ‰€æ‰§è¡Œçš„å¤„ç†ç¨‹åºæ–¹æ³•ã€‚æ¯ä¸ªå¼‚æ­¥é€šé“ç±»ä¸ºæ¯ä¸ªæ“ä½œå®šä¹‰ API å‰¯æœ¬ï¼Œè¿™æ ·å¯é‡‡ç”¨ä»»ä¸€æœºåˆ¶ã€‚ 4.3.3 APRApacheå¯ç§»æ¤è¿è¡Œæ—¶ï¼ˆApache Portable Runtimeï¼ŒAPRï¼‰æ˜¯Apache HTTPæœåŠ¡å™¨çš„æ”¯æŒåº“ï¼Œæœ€åˆï¼ŒAPRæ˜¯ä½œä¸ºApache HTTPæœåŠ¡å™¨çš„ä¸€éƒ¨åˆ†è€Œå­˜åœ¨çš„ï¼Œåæ¥æˆä¸ºä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ã€‚å…¶ä»–çš„åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨APRæ¥å®ç°å¹³å°æ— å…³æ€§ï¼ˆè·¨å¹³å°ï¼‰ã€‚APRæä¾›äº†ä¸€ç»„æ˜ å°„åˆ°ä¸‹å±‚æ“ä½œç³»ç»Ÿçš„APIï¼Œå¦‚æœæ“ä½œç³»ç»Ÿä¸æ”¯æŒæŸä¸ªç‰¹å®šçš„åŠŸèƒ½ï¼ŒAPRå°†æä¾›ä¸€ä¸ªæ¨¡æ‹Ÿçš„å®ç°ã€‚è¿™æ ·ç¨‹åºå‘˜ä½¿ç”¨APRç¼–å†™çœŸæ­£å¯åœ¨ä¸åŒå¹³å°ä¸Šç§»æ¤çš„ç¨‹åºã€‚ 4.3.4 Tomcaté…ç½®APR1234567891011121314151617181920# æ‰‹åŠ¨ç¼–è¯‘å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„aprcd /homewget https://dlcdn.apache.org//apr/apr-1.7.0.tar.gzyum group install &quot; Development Tools &quot; -ytar -zxvf apr-1.7.0.tar.gz/home/apr-1.7.0./buildconf./configure &amp;&amp; make &amp;&amp; make install# ä¹Ÿå¯ä»¥ä½¿ç”¨yumæ¥å®‰è£…apryum install apr apr-devel# è¿›å…¥tomcatç›®å½•ä¸‹å¯¹tomcat-nativeè¿›è¡Œè§£å‹cd /home/tomcat9/bin/tar -zxvf tomcat-native.tar.gz cd tomcat-native-1.2.23-src/native/# ç¼–è¯‘å®‰è£…./configure makemake install é¡ºåˆ©å®‰è£…å®Œæˆåä¼šæ˜¾ç¤ºaprçš„libåº“è·¯å¾„ï¼Œä¸€èˆ¬éƒ½æ˜¯/usr/local/apr/lib å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ç¯å¢ƒå˜é‡å’Œé…ç½®å‚æ•° è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯systemdè°ƒç”¨jsvcæ¥å¯åŠ¨tomcatï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥åœ¨systemdå¯¹åº”çš„tomcatçš„unitæ–‡ä»¶ä¸­çš„ExecStartä¸­æ·»åŠ ä¸€ä¸ªè·¯å¾„å‚æ•°-Djava.library.path=/usr/local/apr/libæŒ‡å‘apråº“çš„è·¯å¾„ï¼š 123456789101112131415ExecStart=/home/tomcat9/bin/jsvc \\ -user tomcat \\ -nodetach \\ -java-home $&#123;JAVA_HOME&#125; \\ -pidfile $&#123;CATALINA_BASE&#125;/tomcat.pid \\ -classpath $&#123;CATALINA_HOME&#125;/bin/bootstrap.jar:$&#123;CATALINA_HOME&#125;/bin/tomcat-juli.jar \\ -outfile $&#123;CATALINA_BASE&#125;/logs/catalina.out \\ -errfile $&#123;CATALINA_BASE&#125;/logs/catalina.err \\ -Dcatalina.home=$&#123;CATALINA_HOME&#125; \\ -Dcatalina.base=$&#123;CATALINA_BASE&#125; \\ -Djava.io.tmpdir=$&#123;CATALINA_TMPDIR&#125; \\ -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \\ -Djava.util.logging.config.file=$&#123;CATALINA_BASE&#125;/conf/logging.properties \\ -Djava.library.path=/usr/local/apr/lib \\ org.apache.catalina.startup.Bootstrap ç„¶åæˆ‘ä»¬åœ¨tomcatçš„homeç›®å½•ä¸‹çš„confå­ç›®å½•ä¸­å¯¹server.xmlæ–‡ä»¶è¿›è¡Œä¿®æ”¹ æŠŠ8080ç«¯å£å¯¹åº”çš„é…ç½®ä¿®æ”¹æˆaprï¼šï¼ˆå…¶ä»–ç«¯å£é…ç½®ä¹Ÿç±»ä¼¼ï¼‰ 123&lt;Connector port=&quot;8080&quot; protocol=&quot;org.apache.coyote.http11.Http11AprProtocol&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt; é‡å¯tomcatæœåŠ¡æˆ‘ä»¬ä»tomcatçš„æ—¥å¿—ä¸­å°±å¯ä»¥çœ‹åˆ°åè®®å·²ç»ä»é»˜è®¤çš„NIOå˜æˆäº†aprã€‚ 4.3.5 ä¸‰è€…ä¹‹é—´çš„åŒºåˆ«ï¼šNIOæ€§èƒ½æ˜¯æœ€å·®çš„è¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„ï¼Œå¦‚æœæ˜¯è€ƒè™‘åˆ°é«˜å¹¶å‘çš„æƒ…å†µï¼Œæ˜¾ç„¶å¼‚æ­¥éé˜»å¡I/Oæ¨¡å¼çš„NIO2å’ŒAPRåº“åœ¨æ€§èƒ½ä¸Šæ›´æœ‰ä¼˜åŠ¿ï¼Œå®é™…ä¸ŠNIO2çš„æ€§èƒ½è¡¨ç°ä¹Ÿå’ŒAPRä¸ç›¸ä¸Šä¸‹ï¼Œä½†æ˜¯NIO2è¦æ±‚Tomcatçš„ç‰ˆæœ¬è¦åœ¨8.0ä»¥ä¸Šï¼Œè€ŒAPRåªéœ€è¦5.5ä»¥ä¸Šå³å¯ï¼Œä½†æ˜¯APRéœ€è¦é¢å¤–é…ç½®åº“ç¯å¢ƒï¼Œç›¸å¯¹äºå†…ç½®é›†æˆçš„NIO2æ¥è¯´APRè¿™ä¸ªæ“ä½œæ¯”è¾ƒéº»çƒ¦ï¼Œä¸¤è€…å„æœ‰ä¼˜åŠ£ã€‚å…·ä½“ä½¿ç”¨å“ªä¸ªè¿˜æ˜¯éœ€è¦ç»“åˆå®é™…ä¸šåŠ¡éœ€æ±‚å’Œç¯å¢ƒè¿›è¡Œæµ‹è¯•æ‰èƒ½å†³å®šã€‚","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://tinychen.com/tags/tomcat/"}]},{"title":"windowsç³»ç»ŸRDPè¿œç¨‹æ¡Œé¢é…ç½®å¯ä¿¡è¯ä¹¦","slug":"20200331-mstsc-deploy-tls-cert","date":"2020-03-31T02:00:00.000Z","updated":"2020-03-31T02:00:00.000Z","comments":true,"path":"20200331-mstsc-deploy-tls-cert/","link":"","permalink":"https://tinychen.com/20200331-mstsc-deploy-tls-cert/","excerpt":"ä¸ºå¾®è½¯windowsç³»ç»Ÿè‡ªå¸¦çš„RDPè¿œç¨‹æ¡Œé¢é…ç½®æƒå¨CAç­¾å‘çš„è¯ä¹¦ï¼Œä½¿å¾—å¯ä»¥å®‰å…¨åŠ å¯†è¿œç¨‹ã€‚","text":"ä¸ºå¾®è½¯windowsç³»ç»Ÿè‡ªå¸¦çš„RDPè¿œç¨‹æ¡Œé¢é…ç½®æƒå¨CAç­¾å‘çš„è¯ä¹¦ï¼Œä½¿å¾—å¯ä»¥å®‰å…¨åŠ å¯†è¿œç¨‹ã€‚ é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šå¯ä»¥é€šè¿‡å…¬ç½‘IP:ç«¯å£å·çš„æ–¹å¼æ¥è¿œç¨‹è®¿é—®è‡ªå·±çš„windowsä¸»æœºï¼Œå¦‚æœåªæ˜¯åœ¨å†…ç½‘è¿œç¨‹ï¼Œwindowsæœ¬èº«è‡ªå·±ç­¾å‘çš„è¯ä¹¦ä¾¿è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœæš´éœ²åœ¨å…¬ç½‘ä¸Šè¿˜æ˜¯ä½¿ç”¨æƒå¨CAç­¾å‘çš„å¯ä¿¡è¯ä¹¦æ¯”è¾ƒå®‰å…¨ã€‚ å¦‚æœå®¶é‡Œçš„å®½å¸¦æœ‰å…¬ç½‘IPçš„å¯ä»¥ä½¿ç”¨DDNS+ç«¯å£è½¬å‘çš„æ–¹å¼æš´éœ²å‡ºè¿œç¨‹æ¡Œé¢ç«¯å£å·ï¼Œæ²¡æœ‰å…¬ç½‘IPåˆ™å¯ä»¥è€ƒè™‘FRPå†…ç½‘ç©¿é€ç­‰æ–¹å¼ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬è¦å‡†å¤‡ä¸€ä¸ªåŸŸåå’Œä¸€å¼ åŸŸåç›¸å…³çš„è¯ä¹¦ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘è´­ä¹°çš„ä¸‡ç½‘åŸŸåï¼Œè¯ä¹¦ä¹Ÿæ˜¯ä½¿ç”¨çš„é˜¿é‡Œäº‘ä¸Šç”³è¯·çš„å…è´¹è¯ä¹¦ã€‚ä¸‹è½½è¯ä¹¦ä¸€èˆ¬æ¥è¯´å¯ä»¥å¾—åˆ°ä¸€ä¸ªpemæ–‡ä»¶å’Œä¸€ä¸ªkeyæ–‡ä»¶ã€‚ é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨opensslæ¥ç”Ÿæˆp12æ–‡ä»¶ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ã€‚å¦‚æœæ²¡æœ‰å®‰è£…opensslï¼Œå¯ä»¥å…ˆå®‰è£…ä¸€ä¸ªgitï¼Œç„¶åæ‰“å¼€git bashå³å¯ä½¿ç”¨opensslã€‚ 1openssl pkcs12 -export -clcerts -in [your_domain_crt.pem] -inkey [your_domain_key.key] -out [your_domain.p12] é¦–å…ˆæˆ‘ä»¬æŒ‰win+rç„¶åè¾“å…¥mmcæ‰“å¼€ç®¡ç†å°ï¼š ç„¶ååœ¨æ–‡ä»¶é‡Œé¢æ·»åŠ ç®¡ç†å•å…ƒï¼Œé€‰æ‹©è¯ä¹¦ï¼Œæ³¨æ„è¿™é‡Œè´¦æˆ·è¦é€‰æ‹©è®¡ç®—æœºè´¦æˆ· ç„¶ååœ¨ä¸ªäººè¿™é‡Œå³é”®é€‰æ‹©å¯¼å…¥è¯ä¹¦ï¼Œæ¥ç€æŒ‰ç…§é»˜è®¤è®¾ç½®å¯¼å…¥æˆ‘ä»¬åˆšåˆšç”Ÿæˆçš„p12è¯ä¹¦ï¼š æ¥ç€æˆ‘ä»¬éœ€è¦ä¿®æ”¹è¯¥è¯ä¹¦çš„å±æ€§ä½¿å¾—è¿œç¨‹æ¡Œé¢èƒ½å¤Ÿä½¿ç”¨å®ƒ ç„¶åæ‰¾åˆ°æˆ‘ä»¬åˆšåˆšå¯¼å…¥çš„è¯ä¹¦ï¼Œç‚¹å‡» å³é”® ï¼Œé€‰æ‹© æ‰€æœ‰ä»»åŠ¡-ç®¡ç†ç§é’¥ ï¼Œç„¶åæŠŠè¯»å– æƒé™åˆ†é…ç»™ NETWORK SERVICE æˆåŠŸä¹‹åæˆ‘ä»¬ä½¿ç”¨è¯ä¹¦å¯¹åº”çš„åŸŸåè¿›è¡Œè¿œç¨‹çš„æ—¶å€™å°±ä¸ä¼šå†å¼¹å‡ºè¯ä¹¦ä¸å®‰å…¨çš„æé†’äº†ï¼Œå¦‚æœä¸æ˜¯ä½¿ç”¨åŸŸåè¿›è¡Œè¿æ¥è€Œæ˜¯ä½¿ç”¨IPæˆ–è€…å±€åŸŸç½‘åçš„è¯è¿˜æ˜¯ä¼šæé†’è¯ä¹¦ä¸å®‰å…¨ã€‚ é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¼šä½¿ç”¨windowsè‡ªå¸¦çš„è‡ªç­¾è¯ä¹¦è¿›è¡Œè¿æ¥ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"tls","slug":"tls","permalink":"https://tinychen.com/tags/tls/"}]},{"title":"Tomcatç¯‡01-æ¦‚å¿µç®€ä»‹å’Œå®ˆæŠ¤è¿›ç¨‹é…ç½®","slug":"20200327-tomcat-01-brief-introduction-installation","date":"2020-03-27T02:00:00.000Z","updated":"2020-03-27T02:00:00.000Z","comments":true,"path":"20200327-tomcat-01-brief-introduction-installation/","link":"","permalink":"https://tinychen.com/20200327-tomcat-01-brief-introduction-installation/","excerpt":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬tomcatæœåŠ¡å™¨çš„ä¸»è¦æ¦‚å¿µä»‹ç»ã€åœ¨systemdä¸Šçš„tomcatå®ˆæŠ¤è¿›ç¨‹çš„é…ç½®ã€jsvcçš„åŸç†ä»‹ç»å’Œsystemdçš„å¹¶å‘å®ç°åŸç†ä»‹ç»ã€‚","text":"æœ¬æ–‡ä¸»è¦åŒ…æ‹¬tomcatæœåŠ¡å™¨çš„ä¸»è¦æ¦‚å¿µä»‹ç»ã€åœ¨systemdä¸Šçš„tomcatå®ˆæŠ¤è¿›ç¨‹çš„é…ç½®ã€jsvcçš„åŸç†ä»‹ç»å’Œsystemdçš„å¹¶å‘å®ç°åŸç†ä»‹ç»ã€‚ 1ã€Tomcatç®€ä»‹åœ¨äº†è§£tomcatä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›åŸºæœ¬çš„æ¦‚å¿µã€‚ 1.1 webåº”ç”¨æ‰€è°“Webåº”ç”¨ï¼Œå°±æ˜¯æŒ‡éœ€è¦é€šè¿‡ç¼–ç¨‹æ¥åˆ›å»ºçš„Webç«™ç‚¹ã€‚Webåº”ç”¨ä¸­ä¸ä»…åŒ…æ‹¬æ™®é€šçš„é™æ€HTMLæ–‡æ¡£ï¼Œè¿˜åŒ…å«å¤§é‡å¯è¢«WebæœåŠ¡å™¨åŠ¨æ€æ‰§è¡Œçš„ç¨‹åºã€‚ç”¨æˆ·åœ¨Internetä¸Šçœ‹åˆ°çš„èƒ½å¼€å±•ä¸šåŠ¡çš„å„ç§Webç«™ç‚¹éƒ½å¯çœ‹ä½œWebåº”ç”¨ï¼Œä¾‹å¦‚ï¼Œç½‘ä¸Šå•†åº—å’Œç½‘ä¸Šé“¶è¡Œéƒ½æ˜¯Webåº”ç”¨ã€‚æ­¤å¤–ï¼Œå…¬å¸å†…éƒ¨åŸºäºWebçš„Intranetå·¥ä½œå¹³å°ä¹Ÿæ˜¯Webåº”ç”¨ã€‚ Webåº”ç”¨ä¸ä¼ ç»Ÿçš„æ¡Œé¢åº”ç”¨ç¨‹åºç›¸æ¯”ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š ä»¥æµè§ˆå™¨ä½œä¸ºå±•ç¤ºå®¢æˆ·ç«¯ç•Œé¢çš„çª—å£ã€‚ å®¢æˆ·ç«¯ç•Œé¢ä¸€å¾‹è¡¨ç°ä¸ºç½‘é¡µå½¢å¼ï¼Œç½‘é¡µç”±HTMLè¯­è¨€å†™æˆã€‚ å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯èƒ½è¿›è¡Œå’Œä¸šåŠ¡ç›¸å…³çš„åŠ¨æ€äº¤äº’ã€‚ èƒ½å®Œæˆä¸æ¡Œé¢åº”ç”¨ç¨‹åºç±»ä¼¼çš„åŠŸèƒ½ã€‚ ä½¿ç”¨æµè§ˆå™¨â€”æœåŠ¡å™¨æ¶æ„ï¼ˆB/Sï¼‰ï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´é‡‡ç”¨HTTPåè®®é€šä¿¡ã€‚ Webåº”ç”¨é€šè¿‡WebæœåŠ¡å™¨æ¥å‘å¸ƒã€‚ webåº”ç”¨çš„ä¸€å¤§å¥½å¤„å°±æ˜¯å¯ä»¥è½»æ˜“åœ°è·¨å¹³å°è¿è¡Œï¼Œä¸è®ºæ˜¯windowsã€macã€iosã€androidè¿˜æ˜¯linuxï¼Œåªè¦å®‰è£…äº†æµè§ˆå™¨ï¼Œä¸€èˆ¬éƒ½å¯ä»¥ä½¿ç”¨webåº”ç”¨ï¼Œè€Œæµè§ˆå™¨åœ¨å„ä¸ªå¹³å°éƒ½æ˜¯æ ‡é…çš„è½¯ä»¶ï¼Œå› æ­¤ç»™webåº”ç”¨çš„æ™®åŠæä¾›äº†éå¸¸è‰¯å¥½çš„æ¡ä»¶ã€‚åŒæ ·çš„ï¼Œwebåº”ç”¨ä½¿ç”¨çš„æ˜¯B/Sæ¶æ„ï¼Œå³Browser/Serveræ¶æ„ï¼Œä¸»è¦çš„è®¡ç®—ä»»åŠ¡éƒ½äº¤ç»™Serverç«¯è¿›è¡Œï¼Œå› æ­¤éƒ½å®¢æˆ·ç«¯çš„æ€§èƒ½è¦æ±‚è¾ƒä½ï¼ŒåŒæ—¶ä¹Ÿæ¨åŠ¨äº†æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡ã€é«˜å¯ç”¨ç­‰æŠ€æœ¯çš„å‘å±•ã€‚ Contextï¼šåœ¨tomcatä¸­ä¸€èˆ¬æŒ‡webåº”ç”¨ 1.2 ServletServletï¼ˆServer Appletï¼‰ï¼Œå…¨ç§°Java Servletã€‚æ˜¯ç”¨Javaç¼–å†™çš„æœåŠ¡å™¨ç«¯ç¨‹åºã€‚å…¶ä¸»è¦åŠŸèƒ½åœ¨äºäº¤äº’å¼åœ°æµè§ˆå’Œä¿®æ”¹æ•°æ®ï¼Œç”ŸæˆåŠ¨æ€Webå†…å®¹ã€‚ç‹­ä¹‰çš„Servletæ˜¯æŒ‡Javaè¯­è¨€å®ç°çš„ä¸€ä¸ªæ¥å£ï¼Œå¹¿ä¹‰çš„Servletæ˜¯æŒ‡ä»»ä½•å®ç°äº†è¿™ä¸ªServletæ¥å£çš„ç±»åˆ«ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯´çš„Servletä¸ºåè€…ã€‚ Servletè¿è¡Œäºæ”¯æŒJavaçš„åº”ç”¨æœåŠ¡å™¨ä¸­ã€‚ä»å®ç°ä¸Šè®²ï¼ŒServletå¯ä»¥å“åº”ä»»ä½•ç±»å‹çš„è¯·æ±‚ï¼Œä½†ç»å¤§å¤šæ•°æƒ…å†µä¸‹Servletåªç”¨æ¥æ‰©å±•åŸºäºHTTPåè®®çš„WebæœåŠ¡å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´WebæœåŠ¡å™¨å¯ä»¥è®¿é—®ä»»æ„ä¸€ä¸ªWebåº”ç”¨ä¸­æ‰€æœ‰å®ç°Servletæ¥å£çš„ç±»ã€‚è€ŒWebåº”ç”¨ä¸­ç”¨äºè¢«WebæœåŠ¡å™¨åŠ¨æ€è°ƒç”¨çš„ç¨‹åºä»£ç ä½äºServletæ¥å£çš„å®ç°ç±»ä¸­ã€‚æ—¢ç„¶servletå’Œjavaå…³ç³»å¯†åˆ‡ï¼Œé‚£ä¹ˆservletæ¥å£çš„æ ‡å‡†åˆ¶å®šæ¯«æ— ç–‘é—®ä¹Ÿæ˜¯ç”±ç”²éª¨æ–‡å…¬å¸æ¥ä¸»å¯¼ã€‚ Servletè§„èŒƒæŠŠèƒ½å¤Ÿå‘å¸ƒå’Œè¿è¡ŒJava Webåº”ç”¨çš„WebæœåŠ¡å™¨ç§°ä¸ºServletå®¹å™¨ã€‚Servletå®¹å™¨æœ€ä¸»è¦çš„ç‰¹å¾æ˜¯åŠ¨æ€æ‰§è¡ŒJava Webåº”ç”¨ä¸­Servletå®ç°ç±»çš„ç¨‹åºä»£ç ã€‚ç”±Apacheå¼€æºè½¯ä»¶ç»„ç»‡åˆ›å»ºçš„Tomcatæ˜¯ä¸€ä¸ªç¬¦åˆServletè§„èŒƒçš„ä¼˜ç§€Servletå®¹å™¨ã€‚ 1.3 jspJSPï¼ˆå…¨ç§°JavaServer Pagesï¼‰æ˜¯ç”±Sun Microsystemså…¬å¸ä¸»å¯¼å»ºç«‹çš„ä¸€ç§åŠ¨æ€ç½‘é¡µæŠ€æœ¯æ ‡å‡†ã€‚JSPæ˜¯HttpServletçš„æ‰©å±•ã€‚JSPå°†Javaä»£ç å’Œç‰¹å®šå˜åŠ¨å†…å®¹åµŒå…¥åˆ°é™æ€çš„é¡µé¢ä¸­ï¼Œå®ç°ä»¥é™æ€é¡µé¢ä¸ºæ¨¡æ¿ï¼ŒåŠ¨æ€ç”Ÿæˆå…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ã€‚JSPåœ¨é¦–æ¬¡è¢«è®¿é—®çš„æ—¶å€™è¢«åº”ç”¨æœåŠ¡å™¨è½¬æ¢ä¸ºservletï¼Œåœ¨ä»¥åçš„è¿è¡Œä¸­ï¼Œå®¹å™¨ç›´æ¥è°ƒç”¨è¿™ä¸ªservletï¼Œè€Œä¸å†è®¿é—®JSPé¡µé¢ã€‚JSPçš„å®è´¨ä»ç„¶æ˜¯servletã€‚ 1.4 TomcatTomcatæ˜¯åœ¨Oracleå…¬å¸çš„JSWDKï¼ˆJavaServer Web DevelopmentKitï¼Œæ˜¯Oracleå…¬å¸æ¨å‡ºçš„å°å‹Servlet/JSPè°ƒè¯•å·¥å…·ï¼‰çš„åŸºç¡€ä¸Šå‘å±•èµ·æ¥çš„ä¸€ä¸ªä¼˜ç§€çš„Servletå®¹å™¨ï¼ŒTomcatæœ¬èº«å®Œå…¨ç”¨Javaè¯­è¨€ç¼–å†™ã€‚ä½œä¸ºä¸€ä¸ªå¼€æºè½¯ä»¶ï¼ŒTomcaté™¤äº†è¿è¡Œç¨³å®šã€å¯é ï¼Œå¹¶ä¸”æ•ˆç‡é«˜ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å’Œç›®å‰å¤§éƒ¨åˆ†çš„ä¸»æµWebæœåŠ¡å™¨ï¼ˆå¦‚IISã€Apacheã€Nginxç­‰ï¼‰ä¸€èµ·å·¥ä½œã€‚ tomcatçš„ç‰ˆæœ¬å®é™…ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œç›®å‰æœ‰7ã€8ã€9ã€10å››ä¸ªç‰ˆæœ¬å¹¶è¡Œå‘å¸ƒï¼Œå…·ä½“çš„å„ä¸ªç‰ˆæœ¬çš„å…¼å®¹ä¿¡æ¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å®˜ç½‘æŸ¥è¯¢ã€‚ 2ã€Tomcatå®‰è£…é…ç½®tomcatçš„é…ç½®å®‰è£…éœ€è¦å…ˆåœ¨ç³»ç»Ÿä¸Šé…ç½®å¥½jdkç¯å¢ƒï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨centos7.7ç‰ˆæœ¬çš„Linuxç³»ç»Ÿå’Œjdk8ç‰ˆæœ¬ã€‚ 2.1 é…ç½®jdk8æˆ‘ä»¬é¦–å…ˆåˆ°å®˜ç½‘ä¸‹è½½JDK8çš„å®‰è£…åŒ…ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©tar.gzæ ¼å¼çš„å‹ç¼©åŒ…ä¸‹è½½ï¼Œéœ€è¦æ³¨æ„å»ºè®®å…ˆä½¿ç”¨æµè§ˆå™¨ä¸‹è½½å†ä½¿ç”¨å·¥å…·ä¼ è¾“åˆ°Linuxä¸Šï¼Œå› ä¸ºä¸‹è½½éœ€è¦ç™»å½•æ³¨å†Œè´¦å·ã€‚ æ¥ç€æˆ‘ä»¬è§£å‹å°†å®‰è£…åŒ…è§£å‹åˆ°è‡ªå·±æƒ³è¦é…ç½®çš„jdkå®‰è£…ç›®å½•ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨/home/ç›®å½• 1tar -zxvf jdk-8u241-linux-x64.tar.gz -C /home/ åœ¨/etc/profileä¸­æ·»åŠ ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°å¹¶å¯¼å…¥ 1234JAVA_HOME=/home/jdk_1.8.0_241CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/libPATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/binexport JAVA_HOME CLASSPATH PATH é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶ 1source /etc/profile æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Œå¦‚ä¸ç”Ÿæ•ˆå¯ä»¥é‡å¯ç»ˆç«¯è¯•è¯•ï¼š 1234[root@tiny-yun ~]# java -versionjava version &quot;1.8.0_241&quot;Java(TM) SE Runtime Environment (build 1.8.0_241-b07)Java HotSpot(TM) 64-Bit Server VM (build 25.241-b07, mixed mode) 2.2 é…ç½®tomcattomcatçš„å®‰è£…é…ç½®å’Œä¸Šé¢å‡ ä¹ä¸€æ ·ï¼Œç”±äºæˆ‘ä»¬å·²ç»åœ¨/etc/profileä¸­è®¾å®šäº†å…¨å±€çš„javaç¯å¢ƒå˜é‡ï¼Œå› æ­¤åœ¨tomcatä¸­å°±ä¸ç”¨å†ç‰¹æ®Šé…ç½®ï¼Œç›´æ¥å°±ä¼šä½¿ç”¨é»˜è®¤çš„å…¨å±€å˜é‡ã€‚ è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨å®˜ç½‘æä¾›çš„tar.gzå‹ç¼©åŒ…æ¥å®‰è£…ã€‚ 123456# tomcatå¯ä»¥ç›´æ¥ä½¿ç”¨wgetä¸‹è½½wget https://downloads.apache.org/tomcat/tomcat-8/v8.5.53/bin/apache-tomcat-8.5.53.tar.gz# è§£å‹åˆ°å®‰è£…ç›®å½•å¹¶é‡å‘½åtar -zxvf apache-tomcat-8.5.53.tar.gz /home/cd /homemv apache-tomcat-8.5.53 tomcat-8.5.53 tomcatç›®å½•é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹tomcatä¸­çš„ä¸»è¦ç›®å½•ï¼š /bin å­˜æ”¾ç”¨äºå¯åŠ¨åŠå…³é—­çš„æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è„šæœ¬ã€‚å…¶ä¸­ï¼ŒUNIX ç³»ç»Ÿä¸“ç”¨çš„ *.sh æ–‡ä»¶åœ¨åŠŸèƒ½ä¸Šç­‰åŒäº Windows ç³»ç»Ÿä¸“ç”¨çš„ *.bat æ–‡ä»¶ã€‚å› ä¸º Win32 çš„å‘½ä»¤è¡Œç¼ºä¹æŸäº›åŠŸèƒ½ï¼Œæ‰€ä»¥åˆé¢å¤–åœ°åŠ å…¥äº†ä¸€äº›æ–‡ä»¶ã€‚ /conf é…ç½®æ–‡ä»¶åŠç›¸å…³çš„ DTDã€‚å…¶ä¸­æœ€é‡è¦çš„æ–‡ä»¶æ˜¯ server.xmlï¼Œè¿™æ˜¯å®¹å™¨çš„ä¸»é…ç½®æ–‡ä»¶ã€‚ /log æ—¥å¿—æ–‡ä»¶çš„é»˜è®¤ç›®å½•ã€‚ /webapps å­˜æ”¾ Web åº”ç”¨çš„ç›¸å…³æ–‡ä»¶ã€‚ æ¥ç€æˆ‘ä»¬è¿›å…¥tomcatç›®å½•ä¸‹çš„binç›®å½•å°±å¯ä»¥çœ‹åˆ°å„ç§å„æ ·çš„è„šæœ¬æ–‡ä»¶ï¼Œä¸»è¦åˆ†ä¸ºbatå’Œshä¸¤ç±»ï¼Œå…¶ä¸­batä¸»è¦æ˜¯åœ¨windowsç³»ç»Ÿä¸Šä½¿ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬åˆ æ‰ï¼Œæ¥ç€æˆ‘ä»¬æ‰§è¡Œä¸€äº›version.shè¿™ä¸ªè„šæœ¬å°±å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å’Œtomcatç›¸å…³çš„å‡ ä¸ªå˜é‡ï¼š JRE_HOME è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°JRE_HOMEè¿™ä¸ªå˜é‡æ˜¯ä¹‹å‰è®¾ç½®äº†çš„JAVA_HOMEç¯å¢ƒå˜é‡ã€‚ å¦‚æœåŒæ—¶å®šä¹‰äº†JRE_HOMEå’ŒJAVA_HOMEè¿™ä¸¤ä¸ªå˜é‡ï¼Œé‚£ä¹ˆä½¿ç”¨çš„æ˜¯JRE_HOME å¦‚æœåªå®šä¹‰äº†JAVA_HOMEï¼Œé‚£ä¹ˆJRE_HOMEå˜é‡å€¼å°±æ˜¯JAVA_HOMEçš„å˜é‡å€¼ å¦‚æœä¸¤ä¸ªå˜é‡éƒ½æ²¡å®šä¹‰ï¼Œé‚£ä¹ˆtomcatæ— æ³•è¿è¡Œ å‰é¢æˆ‘ä»¬æåˆ°è¿‡tomcatæ˜¯ä½¿ç”¨Javaç¼–å†™çš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å®ƒåœ¨è¿è¡Œçš„æ—¶å€™éœ€è¦åˆ›å»ºä¸€ä¸ªJVMè™šæ‹Ÿæœºï¼Œæ‰€ä»¥å¦‚æœæ²¡å®šä¹‰JAVAç¯å¢ƒå˜é‡ï¼Œtomcatæ˜¯æ— æ³•è¿è¡Œçš„ CATALINA_HOMEtomcatå®‰è£…ç›®å½•çš„æ ¹ç›®å½• CATALINA_BASEtomcatå®ä¾‹è¿è¡Œçš„ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ç­‰äºCATALINA_HOMEï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ªtomcatå®ä¾‹ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªCATALINA_BASE setenv.shè¿™ä¸ªè„šæœ¬é»˜è®¤æ˜¯ä¸å­˜åœ¨çš„ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨åˆ›å»ºåœ¨binç›®å½•ä¸‹ï¼Œåœ¨windowsç³»ç»Ÿåˆ™åº”è¯¥æ˜¯setenv.batï¼Œæˆ‘ä»¬åœ¨é‡Œé¢æŒ‡å®šäº†JRE_HOMEç¯å¢ƒå˜é‡ä»¥åŠPIDæ–‡ä»¶çš„ä½ç½®ï¼Œè¿™æ ·åœ¨è¿è¡Œçš„æ—¶å€™å°±èƒ½æ¯”è¾ƒæ–¹ä¾¿çš„å®šä½åˆ°è¿è¡Œè¿›ç¨‹ æ³¨æ„å‰é¢æåˆ°çš„CATALINA_HOMEå’ŒCATALINA_BASEä¸¤ä¸ªå˜é‡ä¸èƒ½åœ¨è¿™é‡Œè®¾å®šï¼Œå› ä¸ºtomcatå°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªå˜é‡æ¥æ‰¾åˆ° setenv.shçš„ã€‚ 123[admin@tiny-yun bin]$ cat setenv.sh JRE_HOME=/home/jdk1.8.0_241/jreCATALINA_PID=&quot;$CATALINA_BASE/tomcat.pid&quot; è¿™æ—¶å€™è¿è¡Œ./catalina.sh startæˆ–è€…æ˜¯./startup.shæ–‡ä»¶å°±å¯ä»¥å¯åŠ¨tomcatï¼Œæ³¨æ„è¦åœ¨é˜²ç«å¢™ä¸­æ”¾è¡Œé»˜è®¤çš„8080ç«¯å£ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šPIDæ–‡ä»¶çš„ä½ç½®ï¼Œåœ¨å…³é—­tomcatçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚æ­¤å¤–ï¼Œä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨rootç”¨æˆ·æ¥è¿è¡Œtomcatã€‚ ä¸ªäººæ„Ÿè§‰ä½¿ç”¨catalina.shåŠ å‚æ•°çš„æ–¹å¼æ¥æ§åˆ¶tomcatè¿›ç¨‹è¦æ›´åŠ çµæ´»å¼ºå¤§ä¸€äº›ã€‚ 123456789101112131415161718192021222324[admin@tiny-yun bin]$ ./catalina.sh -hUsing CATALINA_BASE: /home/tomcat-8.5.53Using CATALINA_HOME: /home/tomcat-8.5.53Using CATALINA_TMPDIR: /home/tomcat-8.5.53/tempUsing JRE_HOME: /home/jdk1.8.0_241/jreUsing CLASSPATH: /home/tomcat-8.5.53/bin/bootstrap.jar:/home/tomcat-8.5.53/bin/tomcat-juli.jarUsing CATALINA_PID: /home/tomcat-8.5.53/tomcat.pidUsage: catalina.sh ( commands ... )commands: debug Start Catalina in a debugger debug -security Debug Catalina with a security manager jpda start Start Catalina under JPDA debugger run Start Catalina in the current window run -security Start in the current window with security manager start Start Catalina in a separate window start -security Start in a separate window with security manager stop Stop Catalina, waiting up to 5 seconds for the process to end stop n Stop Catalina, waiting up to n seconds for the process to end stop -force Stop Catalina, wait up to 5 seconds and then use kill -KILL if still running stop n -force Stop Catalina, wait up to n seconds and then use kill -KILL if still running configtest Run a basic syntax check on server.xml - check exit code for result version What version of tomcat are you running?Note: Waiting for the process to end and use of the -force option require that $CATALINA_PID is defined[admin@tiny-yun bin]$ 3ã€ jsvcé…ç½®daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰åœ¨Windowsä¸Šï¼Œtomcatä¼šé»˜è®¤æ³¨å†Œæˆç³»ç»ŸæœåŠ¡ï¼Œè¿™æ ·è®¾ç½®å¯åŠ¨å’Œè¿è¡Œéƒ½æ–¹ä¾¿å¾ˆå¤šï¼Œè€Œåœ¨Linuxä¸Šï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©jsvcæ¥å®ç°è¿™ä¸€æ•ˆæœã€‚ 3.1 ä»€ä¹ˆæ˜¯jsvcCommons Daemonï¼ˆå…±äº«å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼ŒåŸåJSVCï¼Œæ˜¯ä¸€ä¸ªå±äºApacheçš„Commonsé¡¹ç›®çš„Javaåº“ã€‚å®ˆæŠ¤ç¨‹åºæä¾›äº†ä¸€ç§å¯åŠ¨å’Œåœæ­¢æ­£åœ¨è¿è¡ŒæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºçš„Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰çš„ä¾¿æºå¼æ–¹æ³•ã€‚å®ˆæŠ¤ç¨‹åºåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šç”¨Cç¼–å†™çš„æ“ä½œç³»ç»Ÿæ¥å£çš„åŸç”Ÿåº“ ï¼Œä»¥åŠæä¾›ç”¨Javaç¼–å†™çš„Daemon APIçš„åº“ã€‚ æœ‰ä¸¤ç§ä½¿ç”¨Commonså®ˆæŠ¤ç¨‹åºçš„æ–¹æ³•ï¼šç›´æ¥è°ƒç”¨å®ç°å®ˆæŠ¤ç¨‹åºæ¥å£ï¼ˆinterfaceï¼‰æˆ–è°ƒç”¨ä¸ºå®ˆæŠ¤ç¨‹åºæä¾›æ‰€éœ€æ–¹æ³•ï¼ˆmethodï¼‰çš„ç±»ï¼ˆclassï¼‰ã€‚ä¾‹å¦‚ï¼ŒTomcat-4.1.xä½¿ç”¨å®ˆæŠ¤ç¨‹åºæ¥å£ï¼Œè€ŒTomcat-5.0.xæä¾›äº†ä¸€ä¸ªç±»ï¼Œè¯¥ç±»çš„æ–¹æ³•ç›´æ¥ç”±JSVCè°ƒç”¨ã€‚ 3.2 jsvcå·¥ä½œåŸç†jsvcä½¿ç”¨äº†ä¸‰ä¸ªè¿›ç¨‹æ¥å·¥ä½œï¼šä¸€ä¸ªå¯åŠ¨è¿›ç¨‹ã€ä¸€ä¸ªæ§åˆ¶è¿›ç¨‹ã€ä¸€ä¸ªè¢«æ§åˆ¶è¿›ç¨‹ã€‚å…¶ä¸­è¢«æ§åˆ¶è¿›ç¨‹ä¸€èˆ¬æ¥è¯´å°±æ˜¯javaä¸»çº¿ç¨‹ï¼ˆæˆ‘ä»¬è¿™é‡Œå°±æ˜¯tomcatï¼‰ï¼Œå¦‚æœJVMè™šæ‹Ÿæœºå´©æºƒäº†ï¼Œé‚£ä¹ˆæ§åˆ¶è¿›ç¨‹ä¼šåœ¨ä¸‹ä¸€åˆ†é’Ÿé‡å¯ã€‚å› ä¸ºjsvcæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œæ‰€ä»¥å®ƒåº”è¯¥ä½¿ç”¨rootç”¨æˆ·æ¥å¯åŠ¨ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨-userå‚æ•°æ¥è¿›è¡Œç”¨æˆ·çš„é™çº§ï¼ˆdowngradeï¼‰ï¼Œå³å…ˆä½¿ç”¨rootç”¨æˆ·æ¥åˆ›å»ºè¿›ç¨‹ï¼Œç„¶åå†é™çº§åˆ°æŒ‡å®šçš„érootç”¨æˆ·è€Œä¸ä¸¢å¤±rootç”¨æˆ·çš„ç‰¹æ®Šæƒé™ï¼Œå¦‚ç›‘å¬1024ä»¥ä¸‹çš„ç«¯å£ã€‚ 3.3 jsvcé…ç½®tomcatå®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰tomcatçš„äºŒè¿›åˆ¶å®‰è£…åŒ…ä¸­çš„binç›®å½•ä¸‹å°±æœ‰jsvcçš„å®‰è£…åŒ…ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨GCCç¼–è¯‘å™¨å¯¹å…¶è¿›è¡Œç¼–è¯‘å®‰è£…ã€‚åŒæ—¶åœ¨ç¼–è¯‘çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æŒ‡å®šjdkçš„è·¯å¾„ï¼Œç”±äºæˆ‘ä»¬å‰é¢å·²ç»æ‰‹åŠ¨æŒ‡å®šäº†ï¼Œè¿™é‡Œä¸éœ€è¦å†æŒ‡å®šã€‚å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥ä½¿ç”¨./configure --with-java=$JAVA_HOMEæ¥è¿›è¡Œæ“ä½œã€‚ 1234567891011# é¦–å…ˆæˆ‘ä»¬è¿›å…¥tomcatçš„binç›®å½•è¿›è¡Œç¼–è¯‘cd $CATALINA_HOME/bintar xvfz commons-daemon-native.tar.gzcd commons-daemon-1.2.2-native-src/unix./configuremake# ç¼–è¯‘å®Œæˆåï¼Œä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ç”Ÿæˆä¸€ä¸ªjsvcçš„æ–‡ä»¶ï¼Œå°†å®ƒæ‹·è´åˆ°tomcatçš„/bin/ç›®å½•ä¸‹cp jsvc ../..cd ../..# æ¥ç€æˆ‘ä»¬å¯ä»¥è¿™æ ·æŸ¥çœ‹jsvcçš„å¸®åŠ©æ–‡æ¡£./jsvc -help ä½¿ç”¨jsvcæ¥å¯åŠ¨tomcatï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‚æ•°æ¥è¿›è¡Œå¯åŠ¨ 12345678910./jsvc \\ -user tomcat \\ -classpath $CATALINA_HOME/bin/bootstrap.jar:$CATALINA_HOME/bin/tomcat-juli.jar \\ -outfile $CATALINA_BASE/logs/catalina.out \\ -errfile $CATALINA_BASE/logs/catalina.err \\ -Dcatalina.home=$CATALINA_HOME \\ -Dcatalina.base=$CATALINA_BASE \\ -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \\ -Djava.util.logging.config.file=$CATALINA_BASE/conf/logging.properties \\ org.apache.catalina.startup.Bootstrap æ³¨æ„çœ‹è¿™æ—¶çš„ç”¨æˆ·å’ŒPIDï¼Œä¸Šé¢çš„12839çš„ç”¨æˆ·ä¸ºrootï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„æ§åˆ¶è¿›ç¨‹ï¼Œåé¢è¢«12839è¿›ç¨‹æ§åˆ¶çš„12840è¿›ç¨‹æ‰æ˜¯æˆ‘ä»¬ä¸»è¦è¿è¡Œçš„tomcatè¿›ç¨‹ï¼Œè€Œè¿™é‡Œçš„ç”¨æˆ·ä¹Ÿç¬¦åˆæˆ‘ä»¬ä½¿ç”¨-userå‚æ•°æŒ‡å®šçš„tomcatç”¨æˆ·ã€‚å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šè¿›ç¨‹çš„PIDæ–‡ä»¶ä½ç½®ï¼Œé‚£ä¹ˆé»˜è®¤å°±ä¼šåœ¨/var/runç›®å½•ä¸‹ç”ŸæˆPIDæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªjsvc.pidå¯¹åº”çš„æ­£å¥½æ˜¯jsvcè¿è¡Œçš„ä¸‰ä¸ªè¿›ç¨‹ä¸­çš„è¢«æ§åˆ¶è¿›ç¨‹ã€‚ å¦‚æœéœ€è¦å…³é—­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š 1234./jsvc -stop org.apache.catalina.startup.Bootstrap stop# è¿˜å¯ä»¥æŒ‡å®špidæ–‡ä»¶ä½ç½®ï¼Œå¦‚æœå‰é¢æ²¡æœ‰ä½¿ç”¨é»˜è®¤çš„pidæ–‡ä»¶ç›®å½•çš„è¯./jsvc -stop -pidfile /var/run/jsvc.pid org.apache.catalina.startup.Bootstrap stop è¿™ä¸ªæ—¶å€™å¯èƒ½å°±ä¼šæœ‰åŒå­¦å‘ç°ï¼Œå‰é¢ä¸æ˜¯è¯´jsvcä¸»è¦æœ‰ä¸‰ä¸ªè¿›ç¨‹æ¥å·¥ä½œçš„å—ï¼Œæ€ä¹ˆè¿™é‡Œåªæœ‰ä¸¤ä¸ªè¿›ç¨‹å‘¢ï¼Ÿ æˆ‘ä»¬åœ¨ä¸Šé¢çš„å¯åŠ¨å‘½ä»¤çš„é€‰é¡¹é‡Œé¢åŠ å…¥ä¸€ä¸ª-wait 10çš„å‚æ•°ï¼Œç„¶åå¯åŠ¨ä¹‹åè¿…é€ŸæŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯åŠ¨è¿›ç¨‹åœ¨å¯åŠ¨äº†æ§åˆ¶è¿›ç¨‹ä¹‹åå°±ä¼šç»“æŸï¼Œè€Œå½“æˆ‘ä»¬ä½¿ç”¨äº†-waitå‚æ•°ä¹‹åï¼Œå¯åŠ¨è¿›ç¨‹ä¼šç­‰å¾…è¢«æ§åˆ¶è¿›ç¨‹å¯åŠ¨å¥½äº†ä¹‹åå‘å…¶å‘é€ä¸€ä¸ªâ€I am readyâ€ä¿¡å·ï¼Œå¯åŠ¨è¿›ç¨‹åœ¨æ”¶åˆ°ä¿¡å·ä¹‹åå°±ä¼šç»“æŸã€‚-wait 10è¡¨ç¤ºç­‰å¾…æ—¶é—´ä¸º10ç§’ï¼Œéœ€è¦æ³¨æ„ç­‰å¾…æ—¶é—´è¦æ˜¯10çš„å€æ•°ã€‚ è¿™æ—¶å€™å¯ä»¥çœ‹åˆ°å­˜åœ¨ä¸‰ä¸ªjsvcç›¸å…³çš„è¿›ç¨‹ï¼Œç­‰tomcatå¯åŠ¨å®Œä¹‹åå†æŸ¥çœ‹çš„æ—¶å€™æˆ‘ä»¬å°±ä¼šå‘ç°æœ€ä¸Šé¢çš„19347å·è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯jsvcå¯åŠ¨è¿›ç¨‹æ¶ˆå¤±äº†ã€‚å¹¶ä¸”æ§åˆ¶è¿›ç¨‹19350çš„çˆ¶è¿›ç¨‹å˜æˆäº†1å·è¿›ç¨‹ã€‚ æˆ‘ä»¬å†è¿›ä¸€æ­¥æŸ¥çœ‹ä»¥ä¸‹è¿›ç¨‹çš„å…³ç³»ï¼š æ¥ç€æˆ‘ä»¬å†æ¥æŸ¥çœ‹ä¸€ä¸‹1å·è¿›ç¨‹ã€‚å¯ä»¥å‘ç°ï¼Œåœ¨centos7ä¸­çš„1å·è¿›ç¨‹æ˜¯systemdã€‚ æ¥ç€æˆ‘ä»¬å¯ä»¥æ€»ç»“ä»¥ä¸Šçš„æ•´ä¸ªè¿‡ç¨‹ä¸ºä¸‹åˆ—æ­¥éª¤ï¼š ç³»ç»Ÿå¯åŠ¨ï¼Œ0å·è¿›ç¨‹å¯åŠ¨ï¼Œ0å·é€šè¿‡fork()ç”Ÿæˆ1å·è¿›ç¨‹systemdï¼› 1å·è¿›ç¨‹systemdé€šè¿‡fork()åˆ›å»ºè¿›ç¨‹sshdï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„sshæœåŠ¡çš„è¿›ç¨‹ï¼› ç”¨æˆ·ä½¿ç”¨sshè¿œç¨‹ç™»å½•ç³»ç»Ÿï¼Œsshdè¿›ç¨‹åˆ›å»ºäº†å¯¹åº”çš„ç»ˆç«¯è¿›ç¨‹ptsï¼› ç”¨æˆ·åœ¨ç»ˆç«¯è¾“å…¥æŒ‡ä»¤ï¼Œptsæ ¹æ®ç³»ç»Ÿä¸­æŒ‡å®šçš„è¯¥ç”¨æˆ·ä½¿ç”¨çš„shellï¼ˆæ­¤å¤„ä¸ºbash shellï¼‰æ¥æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼Œè¿™é‡Œå…·ä½“è¡¨ç°ä¸ºæ ¹æ®æˆ‘ä»¬è¾“å…¥çš„æŒ‡ä»¤æ¥åˆ›å»ºjsvcçš„å¯åŠ¨è¿›ç¨‹ï¼› jsvcå¯åŠ¨è¿›ç¨‹åˆ›å»ºjsvcæ§åˆ¶è¿›ç¨‹ï¼Œå¹¶æ ¹æ®å¯åŠ¨å‚æ•°å†³å®šæ˜¯å¦åœ¨ç­‰å¾…jsvcæ§åˆ¶è¿›ç¨‹çš„â€I am readyâ€ä¿¡å·å†ç»“æŸï¼ŒåŒæ—¶jsvcå¯åŠ¨è¿›ç¨‹åœ¨ç»“æŸä¹‹å‰ä¼šæŠŠjsvcæ§åˆ¶è¿›ç¨‹äº¤ç»™1å·è¿›ç¨‹systemdæ¥ç®¡ç†æ§åˆ¶ï¼› jsvcæ§åˆ¶è¿›ç¨‹åˆ›å»ºjsvcè¢«æ§åˆ¶è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ä¸»è¦è¿›ç¨‹tomcatï¼ŒåŒæ—¶jsvcæ§åˆ¶è¿›ç¨‹ä¼šç›‘è§†jsvcè¢«æ§åˆ¶è¿›ç¨‹ï¼Œå¦‚æœå®ƒå´©æºƒäº†ï¼Œjsvcæ§åˆ¶è¿›ç¨‹åˆ™ä¼šé‡å¯ï¼Œç¡®ä¿å…¶æ­£å¸¸è¿è¡Œï¼› è¿™é‡Œä½¿ç”¨jsvcæ¥å¯åŠ¨tomcatçš„å¥½å¤„å°±æ˜¯å¯åŠ¨å®Œæˆäº†ä¹‹åå³ä½¿æˆ‘ä»¬çš„shellç»ˆç«¯å…³é—­äº†ä¹Ÿä¸ä¼šå½±å“å®ƒçš„è¿è¡Œï¼Œå½“ç„¶å¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨tomcatçš„binç›®å½•ä¸‹çš„å¯åŠ¨è„šæœ¬æ¥è¿›è¡Œå¯åŠ¨ç„¶åå†é€å…¥åå°è¿è¡Œä¹Ÿæ˜¯å¯ä»¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœã€‚å®é™…ä¸Šæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç¼–å†™systemdçš„unitå•å…ƒé…ç½®æ–‡ä»¶ï¼Œå°†tomcatæ³¨å†Œæˆç³»ç»ŸæœåŠ¡ã€‚ 3.4 daemon.shåŒæ ·çš„ï¼Œåœ¨tomcatçš„binç›®å½•ä¸‹ï¼Œé›†æˆäº†ä¸€ä¸ªdaemon.shçš„è„šæœ¬ï¼Œç”¨æ¥è°ƒç”¨jsvcä»è€Œå®ç°tomcatçš„å®ˆæŠ¤è¿›ç¨‹ã€‚daemon.shçš„å®ç°åŸç†è¿˜æ˜¯jsvcï¼Œåªä¸è¿‡åœ¨è„šæœ¬ä¸­åŠ å…¥äº†å¤§é‡çš„å˜é‡åˆ¤æ–­å’Œç¯å¢ƒé…ç½®æ–‡ä»¶è¯»å–ç­‰æ“ä½œ åœ¨å®˜ç½‘ä¸Šä¼šå»ºè®®æˆ‘ä»¬ç›´æ¥æŠŠdaemon.shè„šæœ¬å¤åˆ¶åˆ° /etc/init.d ç›®å½•ä¸‹ï¼Œå°±å¯ä»¥å®ç°å¼€æœºè‡ªåŠ¨å¯åŠ¨äº†ã€‚ä¸è¿‡åœ¨CentOS7ç­‰ä½¿ç”¨äº†systemdçš„ç³»ç»Ÿä¸Šï¼Œæˆ‘ä¸ªäººæ›´æ¨èä½¿ç”¨systemdæ¥ç®¡ç†ã€‚ 4ã€systemdé…ç½® è¿™é‡Œå…ˆæ”¾ä¸Šarchwikiå’Œfedoraprojectå®˜ç½‘ä¸Šé¢çš„é“¾æ¥ä½œä¸ºå‚è€ƒèµ„æ–™ï¼š https://wiki.archlinux.org/index.php/Systemd https://docs.fedoraproject.org/en-US/quick-docs/understanding-and-administering-systemd/index.html 4.1 systemdç®€ä»‹systemd æ˜¯ Linux ä¸‹ä¸€ä¸ªä¸ SysV å’Œ LSB åˆå§‹åŒ–è„šæœ¬å…¼å®¹çš„ç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨ï¼Œæ˜¯ Linux ç³»ç»Ÿä¸­æœ€æ–°çš„åˆå§‹åŒ–ç³»ç»Ÿï¼ˆinitï¼‰ï¼Œå®ƒä¸»è¦çš„è®¾è®¡ç›®æ ‡æ˜¯å…‹æœ sysvinit å›ºæœ‰çš„ç¼ºç‚¹ï¼Œæé«˜ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦ã€‚systemd å’Œ ubuntu çš„ upstart æ˜¯ç«äº‰å¯¹æ‰‹ï¼Œä¸è¿‡ç°åœ¨ubuntuä¹Ÿä½¿ç”¨äº†systemdã€‚ systemd ä½¿ç”¨ socket å’Œ D-Bus æ¥å¼€å¯æœåŠ¡ï¼Œæä¾›åŸºäºå®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰çš„æŒ‰éœ€å¯åŠ¨ç­–ç•¥ï¼Œä¿ç•™äº† Linux cgroups çš„è¿›ç¨‹è¿½è¸ªåŠŸèƒ½ï¼Œæ”¯æŒå¿«ç…§å’Œç³»ç»ŸçŠ¶æ€æ¢å¤ï¼Œç»´æŠ¤æŒ‚è½½å’Œè‡ªæŒ‚è½½ç‚¹ï¼Œå®ç°äº†å„æœåŠ¡é—´åŸºäºä»å±å…³ç³»çš„ä¸€ä¸ªæ›´ä¸ºç²¾ç»†çš„é€»è¾‘æ§åˆ¶ï¼Œæ‹¥æœ‰å‰å«çš„å¹¶è¡Œæ€§èƒ½ã€‚systemd æ— éœ€ç»è¿‡ä»»ä½•ä¿®æ”¹ä¾¿å¯ä»¥æ›¿ä»£ sysvinit ã€‚ systemd å¼€å¯å’Œç›‘ç£æ•´ä¸ªç³»ç»Ÿæ˜¯åŸºäº unit çš„æ¦‚å¿µã€‚unit æ˜¯ç”±ä¸€ä¸ªä¸é…ç½®æ–‡ä»¶å¯¹åº”çš„åå­—å’Œç±»å‹ç»„æˆçš„(ä¾‹å¦‚ï¼šavahi.service unit æœ‰ä¸€ä¸ªå…·æœ‰ç›¸åŒåå­—çš„é…ç½®æ–‡ä»¶ï¼Œæ˜¯å®ˆæŠ¤è¿›ç¨‹ Avahi çš„ä¸€ä¸ªå°è£…å•å…ƒ)ã€‚ä¸€ä¸ªunitå•å…ƒé…ç½®æ–‡ä»¶å¯ä»¥æè¿°çš„å†…å®¹æœ‰ï¼šç³»ç»ŸæœåŠ¡ï¼ˆ.serviceï¼‰ã€æŒ‚è½½ç‚¹ï¼ˆ.mountï¼‰ã€socketsï¼ˆ.socketsï¼‰ ã€ç³»ç»Ÿè®¾å¤‡ï¼ˆ.deviceï¼‰ã€äº¤æ¢åˆ†åŒºï¼ˆ.swapï¼‰ã€æ–‡ä»¶è·¯å¾„ï¼ˆ.pathï¼‰ã€å¯åŠ¨ç›®æ ‡ï¼ˆ.targetï¼‰ã€ç”± systemd ç®¡ç†çš„è®¡æ—¶å™¨ï¼ˆ.timerï¼‰ã€‚ service ï¼šå®ˆæŠ¤è¿›ç¨‹çš„å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’Œé‡è½½æ˜¯æ­¤ç±» unit ä¸­æœ€ä¸ºæ˜æ˜¾çš„å‡ ä¸ªç±»å‹ã€‚ socket ï¼šæ­¤ç±» unit å°è£…ç³»ç»Ÿå’Œäº’è”ç½‘ä¸­çš„ä¸€ä¸ª socket ã€‚å½“ä¸‹ï¼Œsystemd æ”¯æŒæµå¼ã€æ•°æ®æŠ¥å’Œè¿ç»­åŒ…çš„ AF_INETã€AF_INET6ã€AF_UNIX socket ã€‚ä¹Ÿæ”¯æŒä¼ ç»Ÿçš„ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ ä¼ è¾“æ¨¡å¼ã€‚æ¯ä¸€ä¸ª socket unit éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„æœåŠ¡ unit ã€‚ç›¸åº”çš„æœåŠ¡åœ¨ç¬¬ä¸€ä¸ªè¿æ¥ï¼ˆconnectionï¼‰è¿›å…¥ socket æˆ– FIFO æ—¶å°±ä¼šå¯åŠ¨(ä¾‹å¦‚ï¼šnscd.socket åœ¨æœ‰æ–°è¿æ¥åä¾¿å¯åŠ¨ nscd.service)ã€‚ device ï¼šæ­¤ç±» unit å°è£…ä¸€ä¸ªå­˜åœ¨äº Linux è®¾å¤‡æ ‘ä¸­çš„è®¾å¤‡ã€‚æ¯ä¸€ä¸ªä½¿ç”¨ udev è§„åˆ™æ ‡è®°çš„è®¾å¤‡éƒ½å°†ä¼šåœ¨ systemd ä¸­ä½œä¸ºä¸€ä¸ªè®¾å¤‡ unit å‡ºç°ã€‚udev çš„å±æ€§è®¾ç½®å¯ä»¥ä½œä¸ºé…ç½®è®¾å¤‡ unit ä¾èµ–å…³ç³»çš„é…ç½®æºã€‚ mount ï¼šæ­¤ç±» unit å°è£…ç³»ç»Ÿç»“æ„å±‚æ¬¡ä¸­çš„ä¸€ä¸ªæŒ‚è½½ç‚¹ã€‚ automount ï¼šæ­¤ç±» unit å°è£…ç³»ç»Ÿç»“æ„å±‚æ¬¡ä¸­çš„ä¸€ä¸ªè‡ªæŒ‚è½½ç‚¹ã€‚æ¯ä¸€ä¸ªè‡ªæŒ‚è½½ unit å¯¹åº”ä¸€ä¸ªå·²æŒ‚è½½çš„æŒ‚è½½ unit (éœ€è¦åœ¨è‡ªæŒ‚è½½ç›®å½•å¯ä»¥å­˜å–çš„æƒ…å†µä¸‹å°½æ—©æŒ‚è½½)ã€‚ target ï¼šæ­¤ç±» unit ä¸ºå…¶ä»– unit è¿›è¡Œé€»è¾‘åˆ†ç»„ã€‚å®ƒä»¬æœ¬èº«å®é™…ä¸Šå¹¶ä¸åšä»€ä¹ˆï¼Œåªæ˜¯å¼•ç”¨å…¶ä»– unit è€Œå·²ã€‚è¿™æ ·ä¾¿å¯ä»¥å¯¹ unit åšä¸€ä¸ªç»Ÿä¸€çš„æ§åˆ¶ã€‚(ä¾‹å¦‚ï¼šmulti-user.target ç›¸å½“äºåœ¨ä¼ ç»Ÿä½¿ç”¨ SysV çš„ç³»ç»Ÿä¸­è¿è¡Œçº§åˆ«5ï¼Œå³GUIå›¾å½¢åŒ–ç•Œé¢)ï¼›bluetooth.target åªæœ‰åœ¨è“ç‰™é€‚é…å™¨å¯ç”¨çš„æƒ…å†µä¸‹æ‰è°ƒç”¨ä¸è“ç‰™ç›¸å…³çš„æœåŠ¡ï¼Œå¦‚ï¼šbluetooth å®ˆæŠ¤è¿›ç¨‹ã€obex å®ˆæŠ¤è¿›ç¨‹ç­‰ï¼‰ snapshot ï¼šä¸ target unit ç›¸ä¼¼ï¼Œå¿«ç…§æœ¬èº«ä¸åšä»€ä¹ˆï¼Œå”¯ä¸€çš„ç›®çš„å°±æ˜¯å¼•ç”¨å…¶ä»– unit ã€‚ systemdçš„unitæ–‡ä»¶å¯ä»¥ä»å¤šä¸ªåœ°æ–¹åŠ è½½ï¼Œä½¿ç”¨systemctl show --property=UnitPath å¯ä»¥æŒ‰ä¼˜å…ˆçº§ä»ä½åˆ°é«˜æ˜¾ç¤ºåŠ è½½ç›®å½•ã€‚ ä¸»è¦çš„unitæ–‡ä»¶åœ¨ä¸‹é¢çš„ä¸¤ä¸ªç›®å½•ä¸­ï¼š /usr/lib/systemd/system/ ï¼šè½¯ä»¶åŒ…å®‰è£…çš„å•å…ƒ /etc/systemd/system/ ï¼šç³»ç»Ÿç®¡ç†å‘˜å®‰è£…çš„å•å…ƒ 4.2 systemdåŸç†è¿™é‡Œæˆ‘ä»¬é‡ç‚¹åˆ†æä¸€ä¸‹systemdçš„å¹¶è¡Œæ“ä½œæ€§èƒ½ä»¥åŠserviceæœåŠ¡çš„é…ç½®å•å…ƒã€‚ å’Œå‰ä»»çš„sysvinitçš„å®Œå…¨ä¸²è¡Œç›¸æ¯”ï¼Œsystemdä¸ºäº†åŠ é€Ÿæ•´ä¸ªç³»ç»Ÿå¯åŠ¨ï¼Œå®ç°äº†å‡ ä¹æ‰€æœ‰çš„è¿›ç¨‹éƒ½å¹¶è¡Œå¯åŠ¨ï¼ˆåŒ…æ‹¬éœ€è¦ä¸Šä¸‹è¿›ç¨‹ä¾èµ–çš„è¿›ç¨‹ä¹Ÿå¹¶è¡Œå¯åŠ¨ï¼‰ã€‚æƒ³è¦å®ç°è¿™ä¸€ç‚¹ï¼Œä¸»è¦éœ€è¦è§£å†³ä¸‰ä¸ªæ–¹é¢çš„ä¾èµ–é—®é¢˜ï¼šsocketã€D-Buså’Œæ–‡ä»¶ç³»ç»Ÿã€‚ socket ä¾èµ–(inetd)ç»å¤§å¤šæ•°çš„æœåŠ¡ä¾èµ–æ˜¯å¥—æ¥å­—ä¾èµ–ã€‚æ¯”å¦‚æœåŠ¡ A é€šè¿‡ä¸€ä¸ªå¥—æ¥å­—ç«¯å£ S1 æä¾›è‡ªå·±çš„æœåŠ¡ï¼Œå…¶ä»–çš„æœåŠ¡å¦‚æœéœ€è¦æœåŠ¡ Aï¼Œåˆ™éœ€è¦è¿æ¥ S1ã€‚å› æ­¤å¦‚æœæœåŠ¡ A å°šæœªå¯åŠ¨ï¼ŒS1 å°±ä¸å­˜åœ¨ï¼Œå…¶ä»–çš„æœåŠ¡å°±ä¼šå¾—åˆ°å¯åŠ¨é”™è¯¯ã€‚ æ‰€ä»¥ä¼ ç»Ÿåœ°ï¼Œäººä»¬éœ€è¦å…ˆå¯åŠ¨æœåŠ¡ Aï¼Œç­‰å¾…å®ƒè¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå†å¯åŠ¨å…¶ä»–éœ€è¦å®ƒçš„æœåŠ¡ã€‚ systemd è®¤ä¸ºï¼Œåªè¦æˆ‘ä»¬é¢„å…ˆæŠŠå¥—æ¥å­—ç«¯å£S1å»ºç«‹å¥½ï¼Œé‚£ä¹ˆå…¶ä»–æ‰€æœ‰çš„æœåŠ¡å°±å¯ä»¥åŒæ—¶å¯åŠ¨è€Œæ— éœ€ç­‰å¾…æœåŠ¡ Aæ¥åˆ›å»ºå¥—æ¥å­—ç«¯å£S1äº†ã€‚å¦‚æœæœåŠ¡ A å°šæœªå¯åŠ¨ï¼Œé‚£ä¹ˆå…¶ä»–è¿›ç¨‹å‘å¥—æ¥å­—ç«¯å£S1å‘é€çš„æœåŠ¡è¯·æ±‚å®é™…ä¸Šä¼šè¢« Linux æ“ä½œç³»ç»Ÿç¼“å­˜ï¼Œå…¶ä»–è¿›ç¨‹ä¼šåœ¨è¿™ä¸ªè¯·æ±‚çš„åœ°æ–¹ç­‰å¾…ï¼ˆè¿™é‡Œä½¿ç”¨FIFOæ–¹å¼ï¼‰ã€‚ä¸€æ—¦æœåŠ¡Aå¯åŠ¨å°±ç»ªï¼Œå°±å¯ä»¥ç«‹å³å¤„ç†ç¼“å­˜çš„è¯·æ±‚ï¼Œä¸€åˆ‡éƒ½å¼€å§‹æ­£å¸¸è¿è¡Œã€‚ é‚£ä¹ˆæœåŠ¡å¦‚ä½•ä½¿ç”¨ç”± init è¿›ç¨‹åˆ›å»ºçš„å¥—æ¥å­—å‘¢ï¼Ÿ Linux æ“ä½œç³»ç»Ÿæœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå½“è¿›ç¨‹è°ƒç”¨forkæˆ–è€…execåˆ›å»ºå­è¿›ç¨‹ä¹‹åï¼Œæ‰€æœ‰åœ¨çˆ¶è¿›ç¨‹ä¸­è¢«æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ (file descriptor) éƒ½è¢«å­è¿›ç¨‹æ‰€ç»§æ‰¿ã€‚å¥—æ¥å­—ä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶å¥æŸ„ï¼Œè¿›ç¨‹Aå¯ä»¥åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œæ­¤åå½“è¿›ç¨‹ Aè°ƒç”¨ exec å¯åŠ¨ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹æ—¶ï¼Œåªè¦ç¡®ä¿è¯¥å¥—æ¥å­—çš„close_on_execæ ‡å¿—ä½è¢«æ¸…ç©ºï¼Œé‚£ä¹ˆæ–°çš„å­è¿›ç¨‹å°±å¯ä»¥ç»§æ‰¿è¿™ä¸ªå¥—æ¥å­—ã€‚å­è¿›ç¨‹çœ‹åˆ°çš„å¥—æ¥å­—å’Œçˆ¶è¿›ç¨‹åˆ›å»ºçš„å¥—æ¥å­—æ˜¯åŒä¸€ä¸ªç³»ç»Ÿå¥—æ¥å­—ï¼Œå°±ä»¿ä½›è¿™ä¸ªå¥—æ¥å­—æ˜¯å­è¿›ç¨‹è‡ªå·±åˆ›å»ºçš„ä¸€æ ·ï¼Œæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ è¿™ä¸ªç‰¹æ€§ä»¥å‰è¢«ä¸€ä¸ªå«åšinetdçš„ç³»ç»ŸæœåŠ¡æ‰€åˆ©ç”¨ã€‚Inetdè¿›ç¨‹ä¼šè´Ÿè´£ç›‘æ§ä¸€äº›å¸¸ç”¨å¥—æ¥å­—ç«¯å£ï¼Œæ¯”å¦‚ sshï¼Œå½“è¯¥ç«¯å£æœ‰è¿æ¥è¯·æ±‚æ—¶ï¼Œinetdæ‰å¯åŠ¨telnetdè¿›ç¨‹ï¼Œå¹¶æŠŠæœ‰è¿æ¥çš„å¥—æ¥å­—ä¼ é€’ç»™æ–°çš„telnetdè¿›ç¨‹è¿›è¡Œå¤„ç†ã€‚è¿™æ ·ï¼Œå½“ç³»ç»Ÿæ²¡æœ‰ ssh å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œå°±ä¸éœ€è¦å¯åŠ¨ sshd è¿›ç¨‹ã€‚Inetd å¯ä»¥ä»£ç†å¾ˆå¤šçš„ç½‘ç»œæœåŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥èŠ‚çº¦å¾ˆå¤šçš„ç³»ç»Ÿè´Ÿè½½å’Œå†…å­˜èµ„æºï¼Œåªæœ‰å½“æœ‰çœŸæ­£çš„è¿æ¥è¯·æ±‚æ—¶æ‰å¯åŠ¨ç›¸åº”æœåŠ¡ï¼Œå¹¶æŠŠå¥—æ¥å­—ä¼ é€’ç»™ç›¸åº”çš„æœåŠ¡è¿›ç¨‹ã€‚ å’Œ inetd ç±»ä¼¼ï¼Œsystemd(1å·è¿›ç¨‹)æ˜¯æ‰€æœ‰å…¶ä»–è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œå®ƒå¯ä»¥å…ˆå»ºç«‹æ‰€æœ‰éœ€è¦çš„å¥—æ¥å­—ï¼Œç„¶ååœ¨è°ƒç”¨ exec çš„æ—¶å€™å°†è¯¥å¥—æ¥å­—ä¼ é€’ç»™æ–°çš„æœåŠ¡è¿›ç¨‹ï¼Œè€Œæ–°è¿›ç¨‹ç›´æ¥ä½¿ç”¨è¯¥å¥—æ¥å­—è¿›è¡ŒæœåŠ¡å³å¯ã€‚ D-Bus ä¾èµ–(bus activation)D-Bus æ˜¯ desktop-bus çš„ç®€ç§°ï¼Œæ˜¯ä¸€ä¸ªä½å»¶è¿Ÿã€ä½å¼€é”€ã€é«˜å¯ç”¨æ€§çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚å®ƒè¶Šæ¥è¶Šå¤šåœ°ç”¨äºåº”ç”¨ç¨‹åºä¹‹é—´é€šä¿¡ï¼Œä¹Ÿç”¨äºåº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¹‹é—´çš„é€šä¿¡ã€‚å¾ˆå¤šç°ä»£çš„æœåŠ¡è¿›ç¨‹éƒ½ä½¿ç”¨D-Bus å–ä»£å¥—æ¥å­—ä½œä¸ºè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚ Linuxçš„ NetworkManager æœåŠ¡å°±ä½¿ç”¨ D-Bus å’Œå…¶ä»–çš„åº”ç”¨ç¨‹åºæˆ–è€…æœåŠ¡è¿›è¡Œäº¤äº’ï¼šLinuxä¸Šå¸¸è§çš„é‚®ä»¶å®¢æˆ·ç«¯è½¯ä»¶ evolution å¯ä»¥é€šè¿‡ D-Bus ä» NetworkManager æœåŠ¡è·å–ç½‘ç»œçŠ¶æ€çš„æ”¹å˜ï¼Œä»¥ä¾¿åšå‡ºç›¸åº”çš„å¤„ç†ã€‚ D-Bus æ”¯æŒæ‰€è°“&quot;bus activation&quot;åŠŸèƒ½ã€‚å¦‚æœæœåŠ¡ A éœ€è¦ä½¿ç”¨æœåŠ¡ B çš„ D-Bus æœåŠ¡ï¼Œè€ŒæœåŠ¡ B å¹¶æ²¡æœ‰è¿è¡Œï¼Œåˆ™ D-Bus å¯ä»¥åœ¨æœåŠ¡ A è¯·æ±‚æœåŠ¡ B çš„ D-Bus æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡ Bã€‚è€ŒæœåŠ¡ A å‘å‡ºçš„è¯·æ±‚ä¼šè¢« D-Bus ç¼“å­˜ï¼ŒæœåŠ¡ A ä¼šç­‰å¾…æœåŠ¡ B å¯åŠ¨å°±ç»ªã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä¾èµ– D-Bus çš„æœåŠ¡å°±å¯ä»¥å®ç°å¹¶è¡Œå¯åŠ¨ã€‚ æ–‡ä»¶ç³»ç»Ÿä¾èµ–(automounter)ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„æ´»åŠ¨æ˜¯æœ€è€—æ—¶çš„ï¼Œæ¯”å¦‚æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œå¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œç£ç›˜æ£€æŸ¥ï¼ˆfsckï¼‰ï¼Œç£ç›˜é…é¢æ£€æŸ¥ç­‰éƒ½æ˜¯éå¸¸è€—æ—¶çš„æ“ä½œã€‚åœ¨ç­‰å¾…è¿™äº›å·¥ä½œå®Œæˆçš„åŒæ—¶ï¼Œç³»ç»Ÿå¤„äºç©ºé—²çŠ¶æ€ã€‚é‚£äº›æƒ³ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„æœåŠ¡ä¼¼ä¹å¿…é¡»ç­‰å¾…æ–‡ä»¶ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆæ‰å¯ä»¥å¯åŠ¨ã€‚ä½†æ˜¯ systemd å‘ç°è¿™ç§ä¾èµ–ä¹Ÿæ˜¯å¯ä»¥é¿å…çš„ã€‚ systemd å‚è€ƒäº† autofs çš„è®¾è®¡æ€è·¯ï¼Œä½¿å¾—ä¾èµ–æ–‡ä»¶ç³»ç»Ÿçš„æœåŠ¡å’Œæ–‡ä»¶ç³»ç»Ÿæœ¬èº«åˆå§‹åŒ–ä¸¤è€…å¯ä»¥å¹¶è¡Œå·¥ä½œã€‚autofs å¯ä»¥ç›‘æµ‹åˆ°æŸä¸ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹çœŸæ­£è¢«è®¿é—®åˆ°çš„æ—¶å€™æ‰è§¦å‘æŒ‚è½½æ“ä½œï¼Œè¿™æ˜¯é€šè¿‡å†…æ ¸ automounter æ¨¡å—çš„æ”¯æŒè€Œå®ç°çš„ã€‚systemd é›†æˆäº†autofsçš„å®ç°ï¼Œå¯¹äºç³»ç»Ÿä¸­çš„æŒ‚è½½ç‚¹ï¼Œæ¯”å¦‚/homeï¼Œå½“ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œsystemd ä¸ºå…¶åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„è‡ªåŠ¨æŒ‚è½½ç‚¹ã€‚åœ¨è¿™ä¸ªæ—¶åˆ»/home çœŸæ­£çš„æŒ‚è½½è®¾å¤‡å°šæœªå¯åŠ¨å¥½ï¼ŒçœŸæ­£çš„æŒ‚è½½æ“ä½œè¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ–‡ä»¶ç³»ç»Ÿæ£€æµ‹ä¹Ÿè¿˜æ²¡æœ‰å®Œæˆã€‚å¯æ˜¯é‚£äº›ä¾èµ–è¯¥ç›®å½•çš„è¿›ç¨‹å·²ç»å¯ä»¥å¹¶å‘å¯åŠ¨ï¼Œä»–ä»¬çš„ open()æ“ä½œè¢«å†…å»ºåœ¨ systemd ä¸­çš„ autofs æ•è·ï¼Œå°†è¯¥ open()è°ƒç”¨æŒ‚èµ·ï¼ˆå¯ä¸­æ–­ç¡çœ çŠ¶æ€ï¼‰ã€‚ç„¶åç­‰å¾…çœŸæ­£çš„æŒ‚è½½æ“ä½œå®Œæˆï¼Œæ–‡ä»¶ç³»ç»Ÿæ£€æµ‹ä¹Ÿå®Œæˆåï¼Œsystemd å°†è¯¥è‡ªåŠ¨æŒ‚è½½ç‚¹æ›¿æ¢ä¸ºçœŸæ­£çš„æŒ‚è½½ç‚¹ï¼Œå¹¶è®© open()è°ƒç”¨è¿”å›ã€‚ç”±æ­¤ï¼Œå®ç°äº†é‚£äº›ä¾èµ–äºæ–‡ä»¶ç³»ç»Ÿçš„æœåŠ¡å’Œæ–‡ä»¶ç³»ç»Ÿæœ¬èº«åŒæ—¶å¹¶å‘å¯åŠ¨ã€‚ å¯¹äº/æ ¹ç›®å½•çš„ä¾èµ–å®é™…ä¸Šä¸€å®šè¿˜æ˜¯è¦ä¸²è¡Œæ‰§è¡Œï¼Œå› ä¸º systemd è‡ªå·±ä¹Ÿå­˜æ”¾åœ¨/æ ¹ç›®å½•ä¹‹ä¸‹ï¼Œå¿…é¡»ç­‰å¾…ç³»ç»Ÿæ ¹ç›®å½•æŒ‚è½½æ£€æŸ¥å¥½ã€‚ ä¸è¿‡å¯¹äºç±»ä¼¼/homeç­‰æŒ‚è½½ç‚¹ï¼Œè¿™ç§å¹¶å‘å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯å½“/homeæ˜¯è¿œç¨‹çš„ NFS èŠ‚ç‚¹ï¼Œæˆ–è€…æ˜¯åŠ å¯†ç›˜ç­‰ï¼Œéœ€è¦è€—è´¹è¾ƒé•¿çš„æ—¶é—´æ‰å¯ä»¥å‡†å¤‡å°±ç»ªçš„æƒ…å†µä¸‹ï¼Œå› ä¸ºå¹¶å‘å¯åŠ¨ï¼Œè¿™æ®µæ—¶é—´å†…ï¼Œç³»ç»Ÿå¹¶ä¸æ˜¯å®Œå…¨æ— äº‹å¯åšï¼Œè€Œæ˜¯å¯ä»¥åˆ©ç”¨è¿™æ®µç©ºä½™æ—¶é—´åšæ›´å¤šçš„å¯åŠ¨è¿›ç¨‹çš„äº‹æƒ…ï¼Œæ€»çš„æ¥è¯´å°±ç¼©çŸ­äº†ç³»ç»Ÿå¯åŠ¨æ—¶é—´ã€‚ æ€»ç»“ä»ä¸Šé¢çš„ä¸‰ä¸ªåŠæ³•æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œsystemdè®©å¤šä¸ªç¨‹åºå¹¶è¡Œå¯åŠ¨çš„è§£å†³æ€è·¯å°±æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç‚¹ï¼Œè®©å„ç±»éœ€è¦ä¾èµ–çš„æœåŠ¡å…ˆè¿è¡Œèµ·æ¥ï¼Œæœ€åå†æŠŠè™šæ‹Ÿç‚¹æ¢æˆå®é™…çš„æœåŠ¡ä½¿å¾—èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ 4.3 systemdå®ç°tomcatçš„daemonè¿›ç¨‹æˆ‘ä»¬åœ¨/usr/lib/systemd/system/ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªtomcat9.serviceæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨systemctlå‘½ä»¤æ¥è¿›è¡Œæ§åˆ¶ï¼š ä½¿ç”¨ systemctl æ§åˆ¶å•å…ƒæ—¶ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨unitæ–‡ä»¶çš„å…¨åï¼ŒåŒ…æ‹¬æ‰©å±•åï¼ˆä¾‹å¦‚ sshd.service ï¼‰ã€‚ä½†æ˜¯æœ‰äº›unitå¯ä»¥åœ¨ systemctl ä¸­ä½¿ç”¨ç®€å†™æ–¹å¼ã€‚ å¦‚æœæ— æ‰©å±•åï¼Œsystemctl é»˜è®¤æŠŠæ‰©å±•åå½“ä½œ .service ã€‚ä¾‹å¦‚ tomcat å’Œ tomcat.service æ˜¯ç­‰ä»·çš„ã€‚ æŒ‚è½½ç‚¹ä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºç›¸åº”çš„ .mount å•å…ƒã€‚ä¾‹å¦‚ /home ç­‰ä»·äº home.mount ã€‚ è®¾å¤‡ä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºç›¸åº”çš„ .device å•å…ƒï¼Œæ‰€ä»¥ /dev/sda1 ç­‰ä»·äº dev-sda1.device ã€‚ ä½¿ç”¨daemon.shé¦–å…ˆæˆ‘ä»¬å°è¯•åœ¨systemdä¸­ä½¿ç”¨è‡ªå¸¦çš„è„šæœ¬è¿›è¡Œå¯åŠ¨å’Œå…³é—­tomcatï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæŠŠstartup.shå’Œshutdown.shä¸¤ä¸ªè„šæœ¬ç»™æ’é™¤æ‰ï¼Œè™½ç„¶å®ƒä»¬æ— æ³•å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹çš„ç¼ºé™·å¯ä»¥ä½¿ç”¨systemdæ¥è¿›è¡Œå¼¥è¡¥ï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•ä½¿ç”¨jsvcï¼Œæ— æ³•åœ¨ç‰¹æƒç«¯å£å’Œè¿è¡Œç”¨æˆ·ä¹‹é—´å–å¾—ä¸¤å…¨ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨daemon.shæ¥è¿è¡Œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsystemdå¹¶ä¸ä¼šå»è¯»å–æˆ‘ä»¬å…ˆå‰åœ¨/etc/profileä¸­è®¾å®šçš„å˜é‡ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥æŠŠå˜é‡å†™è¿›unité…ç½®æ–‡ä»¶ä¸­ã€‚ 123456789101112131415161718[Unit]Description=Apache Tomcat 9[Service]User=tomcatGroup=tomcatPIDFile=/var/run/tomcat.pidEnvironment=JAVA_HOME=/home/jdk8/Environment=JRE_HOME=/home/jdk8/jreEnvironment=CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/libEnvironment=CATALINA_HOME=/home/tomcat9Environment=CATALINA_BASE=/home/tomcat9Environment=CATALINA_TMPDIR=/home/tomcat9/tempExecStart=/home/tomcat9/bin/daemon.sh startExecStop=/home/tomcat9/bin/daemon.sh stop[Install]WantedBy=multi-user.target æ·»åŠ äº†æ–°çš„unitå•å…ƒä¹‹åæˆ‘ä»¬å…ˆsystemctl daemon-reloadé‡å¯ä¸€ä¸‹daemonè¿›ç¨‹ï¼Œå†ä½¿ç”¨systemctl start tomcat9.serviceæ¥å¯åŠ¨æœåŠ¡ï¼Œæ¥ç€æŸ¥çœ‹çŠ¶æ€ï¼Œå‘ç°æ— æ³•æ­£å¸¸è¿è¡Œï¼Œä¸€å¯åŠ¨è¿›ç¨‹å°±failedæ‰äº†ï¼ŒæŸ¥çœ‹daemonè„šæœ¬é»˜è®¤çš„æ—¥å¿—æ–‡ä»¶ï¼ˆä½äºtomcatç›®å½•ä¸‹çš„logs/catalina-daemon.outï¼‰æˆ‘ä»¬å‘ç°è¿”å›äº†143é”™è¯¯ã€‚ 1Service exit with a return value of 143 ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ï¼Œæœ‰ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯æŠŠdaemon.shè„šæœ¬ä¸­çš„waitå‚æ•°æ—¶é—´ä»10è°ƒæˆ240ï¼Œåœ¨125è¡Œå·¦å³çš„ä½ç½®ï¼š 12# Set the default service-start wait time if necessarytest &quot;.$SERVICE_START_WAIT_TIME&quot; = . &amp;&amp; SERVICE_START_WAIT_TIME=10 waitå‚æ•°è°ƒå¤§ä¹‹åï¼Œç­‰å¾…å¯åŠ¨æˆåŠŸä¹‹åï¼ˆè¿™é‡Œç”¨çš„ä¸»æœºé…ç½®å¾ˆä½ï¼Œå¯åŠ¨æ¯”è¾ƒè€—æ—¶ï¼‰å°±å¯ä»¥æ­£å¸¸è®¿é—®äº† ä½†æ˜¯åœ¨å››åˆ†é’Ÿï¼ˆ240sï¼‰ä¹‹åæˆ‘ä»¬å†æŸ¥çœ‹tomcat9.serviceå°±ä¼šå‘ç°ï¼Œè¿›ç¨‹å·²ç»ç»“æŸäº†ï¼Œå†æ¬¡è®¿é—®é»˜è®¤çš„8080ç«¯å£ä¹Ÿæ— æ³•è®¿é—®ï¼ŒæŸ¥æ‰¾è¿›ç¨‹ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„è¿›ç¨‹ã€‚ è¯•å›¾åˆ†æä¸€æ³¢ æˆ‘ä»¬æ¥æ ¹æ®ä¸Šé¢çš„æƒ…å†µç»“åˆåŸç†æ¥è¯•å›¾åˆ†æä¸€ä¸‹ï¼š é¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°-waitå‚æ•°æ—¶é•¿è°ƒåˆ°240ä¹‹åï¼Œbash shellè¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿äº†ï¼Œæ ¹æ®ä¹‹å‰çš„jsvcå·¥ä½œåŸç†éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥çŸ¥é“-waitå‚æ•°ä¼šå½±å“jsvcçš„å¯åŠ¨è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä»systemdè¾“å‡ºçš„ä¿¡æ¯æ¥çœ‹ï¼Œæœ‰åŒ…æ‹¬jsvcä¸‰ä¸ªè¿›ç¨‹å’Œbash shellè¿›ç¨‹åœ¨å†…å…±è®¡å››ä¸ªè¿›ç¨‹ï¼Œè¿™å’Œä¹‹å‰æˆ‘ä»¬ç›´æ¥è¿è¡Œdaemon.shä¹‹åæœ€ç»ˆåªæœ‰jsvcçš„ä¸¤ä¸ªè¿›ç¨‹ï¼ˆæ§åˆ¶è¿›ç¨‹å’Œè¢«æ§åˆ¶è¿›ç¨‹ä¸åŒï¼‰ï¼Œä¸”Main PIDå‚æ•°æŒ‡å‘çš„æ˜¯bash shellè¿›ç¨‹ã€‚ äºæ˜¯ä¹æˆ‘ä»¬å¤§èƒ†çŒœæµ‹ä¸€ä¸‹ï¼šä½¿ç”¨daemon.sh startå‘½ä»¤å¯åŠ¨tomcatï¼Œsystemdä¼šæŠŠå¯åŠ¨daemon.shçš„bashçš„PIDä½œä¸ºæ•´ä¸ªserviceçš„PIDæ¥ç›‘æ§ï¼Œè€Œè¿™ä¸ªbashè¿›ç¨‹åœ¨å¯åŠ¨äº†jsvcä¹‹åæ˜¯ä¼šè‡ªè¡Œé€€å‡ºçš„ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†systemdè®¤ä¸ºserviceå·²ç»è¿è¡Œå¤±è´¥ï¼Œä»è€Œæ¸…ç†æ‰äº†å…³è”çš„è¿›ç¨‹ï¼Œè¿›è€Œä½¿å¾—jsvcç›¸å…³çš„tomcatè¿›ç¨‹ä¹Ÿè¢«æ¸…ç†æ‰äº†ã€‚è€Œ-waitå‚æ•°æ—¶é•¿è°ƒåˆ°240ä¹‹åï¼Œbash shellè¿›ç¨‹çš„å­˜æ´»æ—¶é—´å˜é•¿ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨tomcatå¯åŠ¨å®Œæˆä¹‹åä¸”bash shellè¿›ç¨‹ç»“æŸä¹‹å‰è®¿é—®åˆ°tomcatæœåŠ¡å™¨ã€‚ è€ƒè™‘åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹ä½¿ç”¨daemon.sh runæ¥å¯åŠ¨tomcatï¼Œå› ä¸ºåœ¨ç»ˆç«¯ä¸­ä½¿ç”¨runå‚æ•°çš„æ—¶å€™ä¼šä¸€ç›´æŠŠlogä¿¡æ¯è¾“å‡ºåˆ°ç»ˆç«¯ï¼Œæˆ‘çŒœæµ‹è¿™ä¸ªè¿è¡Œæ–¹å¼æ˜¯å’Œstartä¸å¤ªä¸€æ ·çš„ã€‚ æŠŠsystemdçš„unitæ–‡ä»¶çš„å¯åŠ¨å‚æ•°æ”¹ä¸ºrunï¼ŒåŒæ—¶å°†-waitå‚æ•°æ—¶é•¿è°ƒå›é»˜è®¤çš„10ï¼Œå†æ¬¡å¯åŠ¨æœåŠ¡ã€‚ è¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°systemdçš„Main PIDå¯¹åº”ä¸ºjsvcçš„ä¸»è¿›ç¨‹ï¼ŒtomcatæœåŠ¡ä¹Ÿèƒ½ä¸€ç›´æ­£å¸¸çš„åœ¨åå°è¿è¡Œã€‚åº”è¯¥ç®—æ˜¯æˆåŠŸçš„ä½¿ç”¨systemdæ¥ç®¡ç†jsvcå¯åŠ¨çš„tomcatè¿›ç¨‹äº†ã€‚ é‚£ä¹ˆè¿™ä¸¤è€…çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿæ¥ç€æˆ‘ä»¬æ‰“å¼€daemon.shè¿™ä¸ªè„šæœ¬æ¥æŸ¥çœ‹ä¸€ä¸‹ä¸¤è€…çš„ä¸åŒï¼š ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤è€…æœ€å¤§çš„ä¸åŒå°±æ˜¯ä½¿ç”¨runå‘½ä»¤çš„æ—¶å€™æ˜¯execè°ƒç”¨jsvcæ¥å¯åŠ¨tomcatå¹¶ä¸”ä½¿ç”¨äº†-nodetachå‚æ•°ã€‚ shellä¸­çš„execå‘½ä»¤å’Œç›´æ¥è°ƒç”¨ä¸åŒï¼Œå‘½ä»¤execå°†å¹¶ä¸å¯åŠ¨æ–°çš„shellï¼Œè€Œæ˜¯ç”¨è¦è¢«æ‰§è¡Œå‘½ä»¤æ›¿æ¢å½“å‰çš„shellè¿›ç¨‹ï¼Œå¹¶ä¸”å°†è€è¿›ç¨‹çš„ç¯å¢ƒæ¸…ç†æ‰ï¼Œè€Œä¸”execå‘½ä»¤åçš„å…¶å®ƒå‘½ä»¤å°†ä¸å†æ‰§è¡Œã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œrunå‘½ä»¤ä½¿ç”¨execè°ƒç”¨äº†jsvcï¼Œæ˜¯ç›´æ¥æ›¿ä»£åŸæ¥å¯åŠ¨daemon.shçš„bash shellè¿›ç¨‹ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªexecå‘½ä»¤æ‰§è¡Œå®Œä¹‹åæ‰ä¼šæ‰§è¡Œåé¢çš„exitå‘½ä»¤ã€‚è¿™æ ·å°±å¯ä»¥è®©systemdçš„Main PIDä»bash shellè¿›ç¨‹é¡ºç†æˆç« åœ°å˜ä¸ºjsvcçš„å¯åŠ¨è¿›ç¨‹ã€‚ é‚£ä¹ˆæˆ‘ä»¬çŸ¥é“ï¼Œjsvcçš„å¯åŠ¨è¿›ç¨‹åœ¨å¯åŠ¨å®Œjsvcæ§åˆ¶è¿›ç¨‹ä¹‹åè¿˜æ˜¯ä¼šé€€å‡ºçš„ï¼Œè¿™ä¸ªæ—¶å€™systemdè¿˜æ˜¯ä¼šç›‘å¬å¤±è´¥ã€‚è€Œ-nodetachå‚æ•°çš„ä½œç”¨å°±æ˜¯ä¸è„±ç¦»çˆ¶è¿›ç¨‹è€Œæˆä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼ˆ donâ€™t detach from parent process and become a daemonï¼‰ï¼Œè¿™æ ·å°±èƒ½é¡ºåˆ©åœ°ä½¿å¾—jsvcæ§åˆ¶è¿›ç¨‹ä»å®ƒçš„çˆ¶è¿›ç¨‹jsvcå¯åŠ¨è¿›ç¨‹é‚£é‡Œâ€œå¾—åˆ°â€systemdçš„Main PIDçš„ä½ç½®ï¼Œæˆä¸ºè¯¥serviceçš„ä¸»è¦è¿›ç¨‹ã€‚ æˆ‘ä»¬ç›´æ¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œjsvcå¹¶åŠ ä¸Š-nodetachå‚æ•°ï¼Œå¯ä»¥çœ‹åˆ°å³ä½¿æ˜¯è¿è¡ŒæˆåŠŸäº†ä¹‹åä¹Ÿä¸ä¼šé€€å‡ºï¼ˆæ§åˆ¶è¿›ç¨‹ç»§æ‰¿äº†å¯åŠ¨è¿›ç¨‹æˆä¸ºå®ˆæŠ¤è¿›ç¨‹ä¸€ç›´è¿è¡Œï¼‰ï¼Œè€Œæ²¡åŠ çš„æƒ…å†µä¸‹åˆ™æ˜¯jsvcå¯åŠ¨è¿›ç¨‹é€€å‡ºåå°±ä¼šé€€å‡ºã€‚ è¿™é‡Œå†æ”¾ä¸Šsystemdä½¿ç”¨daemon.shå¯åŠ¨tomcatçš„æ•´ä¸ªunitæ–‡ä»¶çš„é…ç½®åŠæ³¨é‡Šï¼š 1234567891011121314151617181920212223242526272829[Unit]Description=Apache Tomcat 9# å¯¹æ•´ä¸ªseriveçš„æè¿°ï¼Œç›¸å½“äºå¤‡æ³¨ï¼Œä¼šå‡ºç°åœ¨systemdçš„logä¸­After=network.target# åœ¨networkæœåŠ¡å¯åŠ¨ä¹‹åå†å¯åŠ¨[Service]User=tomcatGroup=tomcat# è¿è¡Œè¯¥serviceçš„ç”¨æˆ·åŠç”¨æˆ·ç»„PIDFile=/var/run/tomcat.pid# è¯¥serviceçš„PIDæ–‡ä»¶Environment=JAVA_HOME=/home/jdk8/Environment=JRE_HOME=/home/jdk8/jreEnvironment=CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/libEnvironment=CATALINA_HOME=/home/tomcat9Environment=CATALINA_BASE=/home/tomcat9Environment=CATALINA_TMPDIR=/home/tomcat9/temp# å®šä¹‰äº†è¿è¡Œæ—¶éœ€è¦çš„å˜é‡ExecStart=/home/tomcat9/bin/daemon.sh startExecStop=/home/tomcat9/bin/daemon.sh stop# å¯¹åº”systemdæ§åˆ¶çš„startå’Œstopå‘½ä»¤[Install]WantedBy=multi-user.target# è¿è¡Œçº§åˆ«ä¸ºç¬¬ä¸‰çº§ï¼ˆå¸¦æœ‰ç½‘ç»œçš„å¤šç”¨æˆ·æ¨¡å¼ï¼‰ ç›´æ¥ä½¿ç”¨jsvcæ—¢ç„¶ææ¸…æ¥šäº†è¿è¡ŒåŸç†ï¼Œæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥è·³è¿‡è„šæœ¬ç›´æ¥åœ¨unitæ–‡ä»¶ä¸­å®šä¹‰å„ç§å‚æ•°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[Unit]Description=Apache Tomcat 9After=network.target[Service]User=rootGroup=root# è¿™é‡Œä½¿ç”¨rootç”¨æˆ·å¯åŠ¨æ–¹ä¾¿jsvcç›‘å¬ç‰¹æƒç«¯å£# åé¢å¯ä»¥åœ¨jsvcå‚æ•°ä¸­ä½¿ç”¨-useré™æƒåˆ°tomcatç”¨æˆ·PIDFile=/var/run/tomcat.pidEnvironment=JAVA_HOME=/home/jdk8/Environment=JRE_HOME=/home/jdk8/jreEnvironment=CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/libEnvironment=CATALINA_HOME=/home/tomcat9Environment=CATALINA_BASE=/home/tomcat9Environment=CATALINA_TMPDIR=/home/tomcat9/tempExecStart=/home/tomcat9/bin/jsvc \\ -user tomcat \\ -nodetach \\ -java-home $&#123;JAVA_HOME&#125; \\ -pidfile $&#123;CATALINA_BASE&#125;/tomcat.pid \\ -classpath $&#123;CATALINA_HOME&#125;/bin/bootstrap.jar:$&#123;CATALINA_HOME&#125;/bin/tomcat-juli.jar \\ -outfile $&#123;CATALINA_BASE&#125;/logs/catalina.out \\ -errfile $&#123;CATALINA_BASE&#125;/logs/catalina.err \\ -Dcatalina.home=$&#123;CATALINA_HOME&#125; \\ -Dcatalina.base=$&#123;CATALINA_BASE&#125; \\ -Djava.io.tmpdir=$&#123;CATALINA_TMPDIR&#125; \\ -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \\ -Djava.util.logging.config.file=$&#123;CATALINA_BASE&#125;/conf/logging.properties \\ org.apache.catalina.startup.BootstrapExecStop=/home/tomcat9/bin/jsvc \\ -stop \\ -classpath $&#123;CLASSPATH&#125; \\ -Dcatalina.base=$&#123;CATALINA_BASE&#125; \\ -Dcatalina.home=$&#123;CATALINA_HOME&#125; \\ -pidfile $&#123;CATALINA_BASE&#125;/tomcat.pid \\ -Djava.io.tmpdir=$&#123;CATALINA_TMPDIR&#125; \\ -Djava.util.logging.config.file=$&#123;CATALINA_BASE&#125;/conf/logging.properties \\ -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \\ org.apache.catalina.startup.Bootstrap [Install]WantedBy=multi-user.target æ³¨æ„ï¼šExecStartå’ŒExecStopä¸¤ä¸ªå‘½ä»¤ä¸­çš„æ‰§è¡Œæ–‡ä»¶è·¯å¾„éœ€è¦ä½¿ç”¨ç»å¯¹è·¯å¾„","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://tinychen.com/tags/tomcat/"}]},{"title":"Nginxç¯‡06-SendfileæŒ‡ä»¤åŠå…¶åŸç†","slug":"20200323-nginx-06-sendfile","date":"2020-03-23T06:00:00.000Z","updated":"2020-03-23T06:00:00.000Z","comments":true,"path":"20200323-nginx-06-sendfile/","link":"","permalink":"https://tinychen.com/20200323-nginx-06-sendfile/","excerpt":"nginxä¸­httpæ¨¡å—ä¸­çš„sendfileæŒ‡ä»¤åŠå…¶åŸç†ã€‚","text":"nginxä¸­httpæ¨¡å—ä¸­çš„sendfileæŒ‡ä»¤åŠå…¶åŸç†ã€‚ 1ã€sendfile()ä»‹ç»nginxçš„httpæ¨¡å—ä¸­æœ‰ä¸€ä¸ªsendfileæŒ‡ä»¤ï¼Œé»˜è®¤æ˜¯å¼€å¯çŠ¶æ€ï¼Œå®˜ç½‘çš„æ–‡æ¡£å¯¹å…¶è§£é‡Šæ˜¯ï¼š Enables or disables the use of sendfile(). Starting from nginx 0.8.12 and FreeBSD 5.2.1, aio can be used to pre-load data for sendfile(): 12345location /video/ &#123; sendfile on; tcp_nopush on; aio on;&#125; In this configuration, sendfile() is called with the SF_NODISKIO flag which causes it not to block on disk I/O, but, instead, report back that the data are not in memory. nginx then initiates an asynchronous data load by reading one byte. On the first read, the FreeBSD kernel loads the first 128K bytes of a file into memory, although next reads will only load data in 16K chunks. This can be changed using the read_ahead directive. ç®€å•æ¥è¯´å°±æ˜¯å¯ç”¨sendfile()ç³»ç»Ÿè°ƒç”¨æ¥æ›¿æ¢read()å’Œwrite()è°ƒç”¨ï¼Œå‡å°‘ç³»ç»Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ä»è€Œæé«˜æ€§èƒ½ï¼Œå½“ nginx æ˜¯é™æ€æ–‡ä»¶æœåŠ¡å™¨æ—¶ï¼Œèƒ½æå¤§æé«˜nginxçš„æ€§èƒ½è¡¨ç°ï¼Œè€Œå½“ nginx æ˜¯åå‘ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œåˆ™æ²¡ä»€ä¹ˆç”¨äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªsendfileçš„å·¥ä½œåŸç†ï¼š 2ã€åŸç†åˆ†æé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“sendfile()å’Œread()ã€write()ä¹‹é—´æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å‰è€…æ˜¯å±äºç³»ç»Ÿè°ƒç”¨ï¼Œè€Œåè€…æ˜¯å±äºå‡½æ•°è°ƒç”¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™å¹…å›¾ æˆ‘ä»¬ä¸éš¾çœ‹å‡ºï¼Œnginxæ˜¯å±äºApplicaitonçš„ï¼Œè€Œread()ã€write()å±äºå‡½æ•°è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨Lib Funcè¿™ä¸€å±‚ï¼Œsendfile()ç³»ç»Ÿè°ƒç”¨ï¼Œä½äºSystem Callè¿™ä¸€å±‚ï¼Œè€Œæƒ³è¦å¯¹ç¡¬ç›˜è¿›è¡Œæ“ä½œï¼Œæ˜¯kernelæ‰æœ‰çš„æƒé™ï¼Œä¸Šé¢çš„é‚£äº›å±‚éƒ½éœ€è¦å¾€ä¸‹è°ƒç”¨ã€‚ ä½œä¸ºå¯¹æ¯”æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ­£å¸¸æƒ…å†µä¸‹å¦‚æœnginxè°ƒç”¨read()å’Œwrite()å‡½æ•°çš„æ“ä½œè¿‡ç¨‹ï¼š æˆ‘ä»¬éƒ½çŸ¥é“æ•°æ®æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šé¢çš„ï¼Œå½“æ•°æ®è¢«è°ƒç”¨çš„æ—¶å€™ä¼šè¢«åŠ è½½è¿›å†…å­˜å†è¢«å±‚å±‚é€’è¿›æœ€åè¢«CPUä½¿ç”¨ï¼Œè¿™é‡Œä¸ªè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬è¿›è¡Œç®€åŒ–ã€‚ æ­¥éª¤ä¸€ï¼šé¦–å…ˆnginxè°ƒç”¨readå‡½æ•°ï¼Œè¿™æ—¶dataä»harddiskä»è¢«åŠ è½½è¿›Kernel Bufferï¼ˆHard Diskï¼‰ä¸­ï¼Œæ­¤æ—¶æ˜¯ä»ä¸€å¼€å§‹çš„ç”¨æˆ·æ€ï¼ˆuser modeï¼‰é™·å…¥å†…æ ¸æ€ï¼ˆkernel modeï¼‰æ‰èƒ½å®Œæˆæ“ä½œ æ­¥éª¤äºŒï¼šæ¥ç€ç”±äºdataéœ€è¦è¢«write()å‡½æ•°è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥dataä»Kernel Bufferï¼ˆHard Diskï¼‰ä¼ è¾“åˆ°User Bufferä¸­ï¼Œæ­¤æ—¶ä»å†…æ ¸æ€ï¼ˆkernel modeï¼‰åˆ‡æ¢å›ç”¨æˆ·æ€ï¼ˆuser modeï¼‰ æ­¥éª¤ä¸‰ï¼šå†æ¥ç€dataè¢«write()å‡½æ•°ä»user bufferå†™å…¥åˆ°Kernel Bufferï¼ˆSocket Engineï¼‰ï¼Œæ­¤æ—¶ä»ç”¨æˆ·æ€ï¼ˆuser modeï¼‰é™·å…¥å†…æ ¸æ€ï¼ˆkernel modeï¼‰ æ­¥éª¤å››ï¼šdataä»Kernel Bufferï¼ˆSocket Engineï¼‰ä¼ è¾“åˆ°Socket Engineï¼Œæ­¤æ—¶ä»å†…æ ¸æ€ï¼ˆkernel modeï¼‰åˆ‡æ¢å›ç”¨æˆ·æ€ï¼ˆuser modeï¼‰ è¿™é‡Œéœ€è¦è¯´æ˜ä¸¤ç‚¹ï¼Œä¸€æ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„åˆ‡æ¢æ˜¯éœ€è¦æ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢æ“ä½œçš„ï¼Œè¿™æ˜¯ååˆ†è€—è´¹ç³»ç»Ÿèµ„æºå’Œæ—¶é—´çš„æ“ä½œï¼ŒäºŒæ˜¯å› ä¸ºread()ã€write()å±äºå‡½æ•°è°ƒç”¨ï¼Œå®ƒä»¬æ˜¯æ²¡æœ‰æƒé™åœ¨kernelä¸­æ“ä½œï¼Œæ— æ³•å°†dataç›´æ¥ä»Kernel Bufferï¼ˆHard Diskï¼‰ä¼ è¾“åˆ°Kernel Bufferï¼ˆSocket Engineï¼‰ã€‚ é‚£ä¹ˆä½¿ç”¨sendfile()å‘¢ï¼Ÿï¼Œç”±äºæ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥åœ¨æ­¥éª¤äºŒå’Œæ­¥éª¤ä¸‰çš„æ—¶å€™å°±å¯ä»¥ä¸éœ€è¦å†å°†æ•°æ®ä¼ è¾“åˆ°User Bufferï¼Œç›´æ¥åœ¨kernelä¸­è¿›è¡Œæ“ä½œï¼Œçœå»äº†ä¸¤æ¬¡çŠ¶æ€åˆ‡æ¢ï¼Œä¹Ÿå°±æ˜¯çœå»äº†ä¸¤æ¬¡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»è€Œå¤§å¹…åº¦æå‡äº†æ€§èƒ½ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™å¹…å›¾ï¼ˆçµé­‚ç”»æ‰‹ä¸Šçº¿â†’_â†’ï¼‰ æœ€åæˆ‘ä»¬å†æ¥è§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆå½“ nginx æ˜¯åå‘ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œsendfile()å°±æ²¡ä»€ä¹ˆç”¨äº†å‘¢ã€‚ é¡¾åæ€ä¹‰ï¼Œsendfile()çš„ä½œç”¨æ˜¯å‘é€æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶æ•°æ®çš„ä¸€æ®µæ˜¯æ–‡ä»¶å¥æŸ„ï¼Œå‘é€æ•°æ®çš„é‚£ä¸€ç«¯æ˜¯socketã€‚è€Œåœ¨åšåå‘ä»£ç†æœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¸¤ç«¯éƒ½æ˜¯socketï¼Œæ­¤æ—¶æ— æ³•ä½¿ç”¨sendfile()ï¼Œä¹Ÿå°±ä¸å­˜åœ¨æ€§èƒ½æå‡è¿™ä¸€è¯´äº†ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"Nginxç¯‡05-httpé•¿è¿æ¥å’Œkeeplive","slug":"20200320-nginx-05-upstream-keepalive","date":"2020-03-20T08:00:00.000Z","updated":"2020-03-20T08:00:00.000Z","comments":true,"path":"20200320-nginx-05-upstream-keepalive/","link":"","permalink":"https://tinychen.com/20200320-nginx-05-upstream-keepalive/","excerpt":"nginxä¸­httpæ¨¡å—ä½¿ç”¨httpé•¿è¿æ¥çš„ç›¸å…³é…ç½®ï¼ˆä¸»è¦æ˜¯keepaliveæŒ‡ä»¤ï¼‰å’Œhttpé•¿è¿æ¥çš„åŸç†è§£é‡Šã€‚","text":"nginxä¸­httpæ¨¡å—ä½¿ç”¨httpé•¿è¿æ¥çš„ç›¸å…³é…ç½®ï¼ˆä¸»è¦æ˜¯keepaliveæŒ‡ä»¤ï¼‰å’Œhttpé•¿è¿æ¥çš„åŸç†è§£é‡Šã€‚ 1ã€httpé•¿è¿æ¥1.1 é¢„å¤‡çŸ¥è¯†è¿æ¥ç®¡ç†æ˜¯ä¸€ä¸ª HTTP çš„å…³é”®è¯é¢˜ï¼šæ‰“å¼€å’Œä¿æŒè¿æ¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå½±å“ç€ç½‘ç«™å’Œ Web åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚åœ¨ HTTP/1.x é‡Œæœ‰å¤šç§æ¨¡å‹ï¼šçŸ­è¿æ¥, é•¿è¿æ¥, å’Œ HTTP æµæ°´çº¿ã€‚åœ¨è§£é‡Šè¿™ä¸‰ç§æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç¡®ä¸€äº›å‰æçŸ¥è¯†ï¼š HTTPæ˜¯å±äºåº”ç”¨å±‚ï¼ˆä¸ƒå±‚ï¼‰çš„åè®®ï¼ŒåŒæ—¶å®ƒçš„ä¼ è¾“å±‚ï¼ˆå››å±‚ï¼‰ä½¿ç”¨çš„æ˜¯TCPåè®®ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼ŒHTTPçš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå…¶æœ¬è´¨å°±æ˜¯TCPçš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼› HTTPæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„é¢å‘è¿æ¥çš„åè®®ï¼ˆä½¿ç”¨TCPï¼Œé¢å‘è¿æ¥ã€å¯é ä¼ è¾“ï¼‰ï¼ŒæŒ‡çš„æ˜¯åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼ŒæœåŠ¡å™¨ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Œæ— çŠ¶æ€ä¸ä»£è¡¨HTTPä¸èƒ½ä¿æŒTCPè¿æ¥ï¼Œæ›´ä¸èƒ½ä»£è¡¨HTTPä½¿ç”¨çš„æ˜¯UDPåè®®ï¼ˆæ— è¿æ¥ï¼‰ï¼› TCPå»ºç«‹è¿æ¥å’Œæ–­å¼€è¿æ¥æ˜¯éœ€è¦ä¸‰æ¡å››æŒ¥çš„ï¼Œç”±äºè¿™ä¸ªå±äºè®¡ç®—æœºç½‘ç»œåŸºæœ¬çŸ¥è¯†ï¼Œæ‰€ä»¥åŸç†è¿™é‡Œä¸å†èµ˜è¿°ï¼› æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è§£é‡Šã€‚ 1.2 HTTPçŸ­è¿æ¥æ¨¡å‹åœ¨æ—©æœŸï¼ŒHTTP ä½¿ç”¨ä¸€ä¸ªç®€å•çš„æ¨¡å‹æ¥å¤„ç†è¿™æ ·çš„è¿æ¥ã€‚è¿™äº›è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼šæ¯å‘èµ·ä¸€ä¸ªè¯·æ±‚æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå¹¶åœ¨æ”¶åˆ°åº”ç­”æ—¶ç«‹å³å…³é—­ã€‚è¿™å°±æ˜¯ç±»ä¼¼ä¸Šé¢è¯´çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œåœ¨äº’è”ç½‘å‘å±•çš„æ—©æœŸä¸€ä¸ªç½‘é¡µçš„èµ„æºå¹¶æ²¡æœ‰ç°åœ¨è¿™ä¹ˆå¤šï¼Œå¾ˆå¤šå¯èƒ½åªæ˜¯ä¸€ä¸ªç®€å•çš„é™æ€é¡µé¢è€Œå·²ï¼Œæ‰€ä»¥è¿™æ ·çš„æ¨¡å‹æ˜¾ç„¶å¾ˆOKã€‚å®¢æˆ·ç«¯è·å–å®Œæ‰€éœ€èµ„æºä¹‹åï¼Œå°±æ–­å¼€è¿æ¥ï¼Œä¸å†å ç”¨æœåŠ¡å™¨çš„èµ„æºã€‚ å¥—ç”¨TCPè¿æ¥çš„ä¸‰æ¡å››æŒ¥çš„æ¨¡å‹æ¥ä¸¾ä¾‹ï¼š ä¸‰æ¬¡æ¡æ‰‹ï¼š Aâ†’Bï¼šä»Šæ™šä¸‹ç­ä¸€èµ·åƒé¥­å—ï¼Ÿ Bâ†’Aï¼šå¥½çš„ï¼Œä»Šæ™šä¸‹ç­ä¸€èµ·åƒé¥­ã€‚ Aâ†’Bï¼šå¥½çš„ï¼Œæˆ‘çŸ¥é“ä½ ç­”åº”æˆ‘ä»Šæ™šä¸‹ç­ä¸€èµ·åƒé¥­çš„é‚€è¯·äº†ã€‚ ç„¶åå¼€å§‹å»åƒé¥­ï¼Œåƒå®Œé¥­åˆ°äº†ä¸¤ä¸ªäººéœ€è¦å„è‡ªå›å®¶çš„æ—¶å€™ï¼š å››æ¬¡æŒ¥æ‰‹ï¼š Aâ†’Bï¼šæˆ‘åƒå®Œé¥­å‡†å¤‡èµ°äº† Bâ†’Aï¼šç­‰ä¸€ä¸‹ï¼Œæˆ‘å¿«åƒå®Œäº† Bâ†’Aï¼šå¥½äº†ï¼Œæˆ‘åƒå®Œäº†å¯ä»¥èµ°äº† Aâ†’Bï¼šå¥½çš„ï¼Œæˆ‘çŸ¥é“ä½ åƒå®Œäº†æˆ‘ä»¬å¯ä»¥èµ°äº† ç„¶åä¸¤äººåƒå®Œé¥­å°±å„å›å„å®¶äº† HTTP çŸ­è¿æ¥æ¨¡å‹æ˜¯æœ€æ—©æœŸçš„æ¨¡å‹ï¼Œä¹Ÿæ˜¯ HTTP/1.0 çš„é»˜è®¤æ¨¡å‹ã€‚æ¯ä¸€ä¸ª HTTP è¯·æ±‚éƒ½ç”±å®ƒè‡ªå·±ç‹¬ç«‹çš„è¿æ¥å®Œæˆï¼›è¿™æ„å‘³ç€å‘èµ·æ¯ä¸€ä¸ª HTTP è¯·æ±‚ä¹‹å‰éƒ½ä¼šæœ‰ä¸€æ¬¡ TCP æ¡æ‰‹ï¼Œè€Œä¸”æ˜¯è¿ç»­ä¸æ–­çš„ã€‚å®é™…ä¸Šï¼ŒTCP åè®®æ¡æ‰‹æœ¬èº«å°±æ˜¯è€—è´¹æ—¶é—´çš„ï¼Œæ‰€ä»¥ TCP å¯ä»¥ä¿æŒæ›´å¤šçš„çƒ­è¿æ¥æ¥é€‚åº”è´Ÿè½½ã€‚çŸ­è¿æ¥ç ´åäº† TCP å…·å¤‡çš„èƒ½åŠ›ï¼Œæ–°çš„å†·è¿æ¥é™ä½äº†å…¶æ€§èƒ½ã€‚ åœ¨ HTTP/1.0 ä¸­å¦‚æœæ²¡æœ‰æŒ‡å®š Connectionåè®®å¤´ï¼Œæˆ–è€…æ˜¯å€¼è¢«è®¾ç½®ä¸º closeå°±ä¼šå¯ç”¨çŸ­è¿æ¥æ¨¡å‹ï¼Œè¦åœ¨ HTTP/1.0 ä¸­å¯ç”¨é•¿è¿æ¥æ¨¡å‹ï¼Œéœ€è¦åœ¨åè®®å¤´ä¸­æŒ‡å®šConnection: Keep-Alive ï¼Œä¸è¿‡å¹¶ä¸å»ºè®®è¿™æ ·æ“ä½œã€‚ è€Œåœ¨ HTTP/1.1 ä¸­ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥æ¨¡å‹ï¼Œåªæœ‰å½“ Connectionè¢«è®¾ç½®ä¸º close æ—¶æ‰ä¼šç”¨åˆ°è¿™ä¸ªçŸ­è¿æ¥æ¨¡å‹ï¼Œåè®®å¤´éƒ½ä¸ç”¨å†å»å£°æ˜å®ƒ(ä½†æ˜¯ä¸€èˆ¬è¿˜æ˜¯ä¼šæŠŠå®ƒåŠ ä¸Šï¼Œä»¥é˜²ä¸‡ä¸€å› ä¸ºæŸç§åŸå› è¦é€€å›åˆ° HTTP/1.0 )ã€‚ 1.3 HTTPé•¿è¿æ¥æ¨¡å‹åæ¥ï¼Œç½‘é¡µéœ€è¦è¯·æ±‚çš„èµ„æºè¶Šæ¥è¶Šå¤šï¼ŒçŸ­è¿æ¥æ¨¡å‹æ˜¾ç„¶å·²ç»ååˆ†åƒåŠ›äº†ã€‚å› ä¸ºçŸ­è¿æ¥æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜ï¼šåˆ›å»ºæ–°è¿æ¥è€—è´¹çš„æ—¶é—´å°¤ä¸ºæ˜æ˜¾ï¼ˆä¸‰æ¬¡æ¡æ‰‹å¾ˆè€—è´¹æ—¶é—´ï¼‰ï¼Œå¦å¤– TCP è¿æ¥çš„æ€§èƒ½åªæœ‰åœ¨è¯¥è¿æ¥è¢«ä½¿ç”¨ä¸€æ®µæ—¶é—´å(çƒ­è¿æ¥)æ‰èƒ½å¾—åˆ°æ”¹å–„ã€‚å› æ­¤åœ¨HTTP/1.1ä¸­å¼•å…¥äº†é•¿è¿æ¥æ¨¡å‹å’Œæµæ°´çº¿æ¨¡å‹ã€‚ åœ¨ HTTP/1.1 ä¹‹å‰ï¼Œé•¿è¿æ¥ä¹Ÿè¢«ç§°ä¸ºkeep-alive è¿æ¥ã€‚ ä¸€ä¸ªé•¿è¿æ¥ä¼šä¿æŒä¸€æ®µæ—¶é—´ï¼Œé‡å¤ç”¨äºå‘é€ä¸€ç³»åˆ—è¯·æ±‚ï¼ŒèŠ‚çœäº†æ–°å»º TCP è¿æ¥æ¡æ‰‹çš„æ—¶é—´ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ TCP çš„æ€§èƒ½å¢å¼ºèƒ½åŠ›ã€‚å½“ç„¶è¿™ä¸ªè¿æ¥ä¹Ÿä¸ä¼šä¸€ç›´ä¿ç•™ç€ï¼šè¿æ¥åœ¨ç©ºé—²ä¸€æ®µæ—¶é—´åä¼šè¢«å…³é—­(æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ Keep-Alive åè®®å¤´æ¥æŒ‡å®šä¸€ä¸ªæœ€å°çš„è¿æ¥ä¿æŒæ—¶é—´)ã€‚ å¥—ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¿›ä¸€æ­¥è§£é‡Šï¼š ä¸‰æ¬¡æ¡æ‰‹ï¼š Aâ†’Bï¼šä»Šæ™šä¸‹ç­ä¸€èµ·åƒé¥­å—ï¼Ÿ Bâ†’Aï¼šå¥½çš„ï¼Œä»Šæ™šä¸‹ç­ä¸€èµ·åƒé¥­ã€‚ Aâ†’Bï¼šå¥½çš„ï¼Œæˆ‘çŸ¥é“ä½ ç­”åº”æˆ‘ä»Šæ™šä¸‹ç­ä¸€èµ·åƒé¥­çš„é‚€è¯·äº†ã€‚ ç„¶åå¼€å§‹å»åƒé¥­ï¼Œä½†æ˜¯è¿™æ—¶åƒå®Œé¥­å°±ä¸æ˜¯é©¬ä¸Šå››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥ï¼ŒABä¸¤äººè¿˜é¡ºä¾¿å»é€›è¡—ã€çœ‹ç”µå½±ï¼ˆç›¸å½“äºçœå»äº†ä¸‰æ¬¡æ¡æ‰‹ä½¿ç”¨å·²å»ºç«‹çš„è¿æ¥æ¥ä¼ è¾“å¤šä¸ªèµ„æºï¼‰ æ­¤å¤„çœç•¥å››æ¬¡æŒ¥æ‰‹ æœ€åä¸¤äººå°±å„å›å„å®¶äº† é•¿è¿æ¥ä¹Ÿè¿˜æ˜¯æœ‰ç¼ºç‚¹çš„ï¼›ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„èµ„æºå ç”¨é—®é¢˜ï¼Œå°±ç®—æ˜¯åœ¨ç©ºé—²çŠ¶æ€ï¼Œå®ƒè¿˜æ˜¯ä¼šæ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œä¹Ÿæ›´å®¹æ˜“è¢«DDoSæ”»å‡»ã€‚æœ¬è´¨ä¸Šé•¿è¿æ¥æ˜¯å› ä¸ºä¸æ–­åœ°ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥æ¶ˆè€—çš„èµ„æºè¦å¤§äºç»´æŒè¿æ¥æ‰€éœ€è¦çš„èµ„æºæ‰ä½¿ç”¨çš„ï¼Œå¦‚æœæœåŠ¡å™¨å¤„äºé«˜è´Ÿè½½æ—¶æ®µæˆ–è€…è¢«DDoSï¼Œå¯ä»¥ä½¿ç”¨éé•¿è¿æ¥ï¼Œå³å°½å¿«å…³é—­é‚£äº›ç©ºé—²çš„è¿æ¥ï¼Œä¹Ÿèƒ½å¯¹æ€§èƒ½æœ‰æ‰€æå‡ã€‚ 1.4 HTTPæµæ°´çº¿æ¨¡å‹æµæ°´çº¿æ¨¡å‹çš„å®ç°è¦å¤æ‚å¾ˆå¤šï¼Œè€Œå·²æ•ˆæœä¹Ÿå¹¶ä¸æ˜¯ç‰¹åˆ«å¥½ï¼Œä¸»è¦è¿˜è¦è€ƒè™‘åˆ°å„ç§å…¼å®¹æ€§ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯ä¸å¯ç”¨è¿™ä¸ªæµæ°´çº¿æ¨¡å‹çš„ï¼Œè€Œåœ¨HTTP/2ä¸­ï¼Œæµæ°´çº¿å·²ç»è¢«æ›´å¥½çš„ç®—æ³•ç»™ä»£æ›¿ï¼Œå¦‚multiplexingã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP è¯·æ±‚æ˜¯æŒ‰é¡ºåºå‘å‡ºçš„ã€‚ä¸‹ä¸€ä¸ªè¯·æ±‚åªæœ‰åœ¨å½“å‰è¯·æ±‚æ”¶åˆ°åº”ç­”è¿‡åæ‰ä¼šè¢«å‘å‡ºã€‚ç”±äºä¼šå—åˆ°ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½çš„é™åˆ¶ï¼Œåœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚æµæ°´çº¿æ˜¯åœ¨åŒä¸€æ¡é•¿è¿æ¥ä¸Šå‘å‡ºè¿ç»­çš„è¯·æ±‚ï¼Œè€Œä¸ç”¨ç­‰å¾…åº”ç­”è¿”å›ã€‚è¿™æ ·å¯ä»¥é¿å…è¿æ¥å»¶è¿Ÿã€‚ç†è®ºä¸Šè®²ï¼Œæ€§èƒ½è¿˜ä¼šå› ä¸ºä¸¤ä¸ª HTTP è¯·æ±‚æœ‰å¯èƒ½è¢«æ‰“åŒ…åˆ°ä¸€ä¸ª TCP æ¶ˆæ¯åŒ…ä¸­è€Œå¾—åˆ°æå‡ã€‚å°±ç®— HTTP è¯·æ±‚ä¸æ–­çš„ç»§ç»­ï¼Œå°ºå¯¸ä¼šå¢åŠ ï¼Œä½†è®¾ç½® TCP çš„ MSS(Maximum Segment Size) é€‰é¡¹ï¼Œä»ç„¶è¶³å¤ŸåŒ…å«ä¸€ç³»åˆ—ç®€å•çš„è¯·æ±‚ã€‚ å¹¶ä¸æ˜¯æ‰€æœ‰ç±»å‹çš„ HTTP è¯·æ±‚éƒ½èƒ½ç”¨åˆ°æµæ°´çº¿ï¼šåªæœ‰ idempotentæ–¹å¼ï¼Œæ¯”å¦‚ GETã€HEADã€PUTå’Œ DELETEèƒ½å¤Ÿè¢«å®‰å…¨çš„é‡è¯•ï¼šå› ä¸ºæœ‰æ•…éšœå‘ç”Ÿæ—¶ï¼Œæµæ°´çº¿çš„å†…å®¹è¦èƒ½è¢«è½»æ˜“çš„é‡è¯•ï¼Œå³å‡ºç°äº†é—®é¢˜é‡è¯•çš„æˆæœ¬è¦å°½å¯èƒ½ä½ï¼Œå¦åˆ™è¿˜ä¸å¦‚ä½¿ç”¨é•¿è¿æ¥æ¨¡å‹ã€‚ æ­£ç¡®çš„å®ç°æµæ°´çº¿æ˜¯å¤æ‚çš„ï¼šä¼ è¾“ä¸­çš„èµ„æºå¤§å°ï¼Œå¤šå°‘æœ‰æ•ˆçš„ RTT ä¼šè¢«ç”¨åˆ°ï¼Œè¿˜æœ‰æœ‰æ•ˆå¸¦å®½ï¼Œæµæ°´çº¿å¸¦æ¥çš„æ”¹å–„æœ‰å¤šå¤§çš„å½±å“èŒƒå›´ã€‚ä¸çŸ¥é“è¿™äº›çš„è¯ï¼Œé‡è¦çš„æ¶ˆæ¯å¯èƒ½è¢«å»¶è¿Ÿåˆ°ä¸é‡è¦çš„æ¶ˆæ¯åé¢ã€‚è¿™ä¸ªé‡è¦æ€§çš„æ¦‚å¿µç”šè‡³ä¼šæ¼”å˜ä¸ºå½±å“åˆ°é¡µé¢å¸ƒå±€ï¼å› æ­¤ HTTP æµæ°´çº¿åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¸¦æ¥çš„æ”¹å–„å¹¶ä¸æ˜æ˜¾ã€‚æ­¤å¤–ï¼Œæµæ°´çº¿å—åˆ¶äº HOL é—®é¢˜ã€‚ æ‘˜è‡ªwiki é˜Ÿå¤´é˜»å¡ï¼ˆHead-of-line blockingæˆ–ç¼©å†™ä¸ºHOL blockingï¼‰åœ¨è®¡ç®—æœºç½‘ç»œçš„èŒƒç•´ä¸­æ˜¯ä¸€ç§æ€§èƒ½å—é™çš„ç°è±¡ã€‚å®ƒçš„åŸå› æ˜¯ä¸€åˆ—çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼ˆé˜Ÿå¤´ï¼‰å—é˜»è€Œå¯¼è‡´æ•´åˆ—æ•°æ®åŒ…å—é˜»ã€‚ä¾‹å¦‚å®ƒæœ‰å¯èƒ½åœ¨ç¼“å­˜å¼è¾“å…¥çš„äº¤æ¢æœºä¸­å‡ºç°ï¼Œæœ‰å¯èƒ½å› ä¸ºä¼ è¾“é¡ºåºé”™ä¹±è€Œå‡ºç°ï¼Œäº¦æœ‰å¯èƒ½åœ¨HTTPæµæ°´çº¿ä¸­æœ‰å¤šä¸ªè¯·æ±‚çš„æƒ…å†µä¸‹å‡ºç°ã€‚ æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¿›è¡Œè§£é‡Šï¼Œè¿™æ¬¡çš„æ¡æ‰‹è¯·æ±‚å°±å˜äº†ï¼ŒAä¸€æ¬¡å‘Bå‘å‡ºäº†ä¸‰ä¸ªè¯·æ±‚ï¼š ä¸‰æ¬¡æ¡æ‰‹ï¼š Aâ†’Bï¼šä»Šæ™šä¸‹ç­ä¸€èµ·åƒé¥­ã€é€›è¡—ã€çœ‹ç”µå½±å—ï¼Ÿ Bâ†’Aï¼šå¥½çš„ï¼Œä»Šæ™šä¸‹ç­ä¸€èµ·åƒé¥­ã€é€›è¡—ã€çœ‹ç”µå½±ã€‚ Aâ†’Bï¼šå¥½çš„ï¼Œæˆ‘çŸ¥é“ä½ ç­”åº”æˆ‘ä»Šæ™šä¸‹ç­ä¸€èµ·åƒé¥­ã€é€›è¡—ã€çœ‹ç”µå½±çš„é‚€è¯·äº†ã€‚ å®é™…ä¸Šè¿™æ ·å­æ˜¯æœ‰å¾ˆå¤§çš„é£é™©çš„ å¦‚æœæ˜¯æŒ‰ç…§é•¿è¿æ¥æ¨¡å‹ï¼ŒAå¯ä»¥æ ¹æ®Båœ¨åƒé¥­çš„æ—¶å€™çš„ååº”æ¥å†³å®šè¦ä¸è¦ç»§ç»­å»é€›è¡—çœ‹ç”µå½±ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä¼ è¾“å®Œäº†ä¸€æ¬¡æ•°æ®ä¹‹åè¿˜ä¿æŒè¿æ¥å°±ç»§ç»­ä¼ è¾“ï¼Œä¸‡ä¸€è¿æ¥çªç„¶æ–­å¼€æˆ–è€…æ˜¯ä¸ç¨³å®šï¼Œé‚£å¯èƒ½å°±è¦é‡æ–°å»ºç«‹è¿æ¥ã€‚ï¼ˆä¸‡ä¸€Båœ¨åƒé¥­çš„æ—¶å€™åƒçš„ä¸å¼€å¿ƒä¸æƒ³ç»§ç»­é€›è¡—çœ‹ç”µå½±é‚£å°±ç­‰ä¸‹æ¬¡å†åƒé¥­é€›è¡—çœ‹ç”µå½±ï¼‰ ä½†æ˜¯å¦‚æœæŒ‰ç…§æµæ°´çº¿æ¨¡å‹ï¼ŒAä¸€æ¬¡å‘é€ä¸‰ä¸ªè¯·æ±‚ï¼Œè™½ç„¶å‘é€è¯·æ±‚çš„æ—¶å€™çœäº‹å„¿äº†ï¼ˆä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™TCPæ‰“åŒ…ä¼ è¾“è¯·æ±‚æ›´çœäº‹ï¼‰ï¼Œä½†æ˜¯è°ä¹Ÿä¸çŸ¥é“åƒé¥­é€›è¡—çœ‹ç”µå½±çš„è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆæ„å¤–ï¼Œæ—¶é—´è¶Šé•¿è¶Šä¸ç¨³å®šï¼Œè€Œä¸”è¿˜å®¹æ˜“å‡ºç°ä¸‡ä¸€Bæƒ³å‡è‚¥ä¸æƒ³åƒé¥­ï¼Œåªæƒ³é€›è¡—çœ‹ç”µå½±çš„æƒ…å†µå‘¢ï¼Ÿï¼ˆHOLé—®é¢˜ï¼‰ æœ€åè¿™é‡Œè¡¥å……ä¸€å¼ å›¾ç‰‡æ¥å¯¹æ¯”ä¸‰ç§æ¨¡å‹ä¹‹é—´çš„å·®åˆ«ï¼š 2ã€Nginxä¸­çš„keepaliveæŒ‡ä»¤ å½“æˆ‘ä»¬é…ç½®Nginxä½œä¸ºä»£ç†æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæƒ³è¦æ”¯æŒHTTPé•¿è¿æ¥ï¼Œéœ€è¦clientåˆ°Nginxå’ŒNginxåˆ°serveréƒ½æ˜¯é•¿è¿æ¥ï¼Œå› ä¸ºæ­¤æ—¶Nginxæ—¢æ˜¯clientçš„serverä¹Ÿæ˜¯serverçš„clientã€‚ äº†è§£äº†ä¸Šé¢çš„åŸç†ä¹‹åï¼ŒNginxä¸­çš„keepaliveæŒ‡ä»¤æˆ‘ä»¬å°±éå¸¸å¥½ç†è§£äº†ï¼Œç›¸å…³çš„æŒ‡ä»¤ä¸»è¦æœ‰ä¸‰ä¸ªï¼Œæˆ‘ä»¬é€ä¸ªè¿›è¡Œè§£é‡Šï¼š 2.1 keepalive1234Syntax: keepalive connections;Default: â€”Context: upstreamThis directive appeared in version 1.1.4. åœ¨upstreamæ¨¡å—ä¸­é…ç½®ï¼Œå¯ç”¨è¿æ¥åˆ°upstreamä¸­çš„æœåŠ¡å™¨çš„ç¼“å­˜ï¼Œconnectionså‚æ•°çš„ä¸»è¦ä½œç”¨æ˜¯è®¾å®šæ¯ä¸ªNginxçš„å•ä¸ªworkerè¿›ç¨‹ï¼ˆeach worker processï¼‰å¯¹äºupstreamä¸­çš„serverçš„æœ€å¤§ç©ºé—²è¿æ¥æ•°ï¼Œå½“è¶…è¿‡è¯¥æ•°å­—çš„æ—¶å€™ï¼Œä¼šå…³é—­ä½¿ç”¨å¾—æœ€å°‘çš„è¿æ¥ã€‚ å¯¹äºHTTPï¼Œåº”å°†proxy_http_versionæŒ‡ä»¤è®¾ç½®ä¸ºâ€œ 1.1â€ï¼Œå¹¶ä¸”åº”æ¸…é™¤Connectionæ ‡é¢˜å­—æ®µ å¯¹äºFastCGIæœåŠ¡å™¨ï¼Œéœ€è¦è®¾ç½®fastcgi_keep_connä»¥å¯ç”¨keepaliveè¿æ¥ 1234567891011121314151617upstream http_backend &#123; server 127.0.0.1:8080; keepalive 16;&#125;server &#123; location /http/ &#123; proxy_pass http://http_backend; proxy_http_version 1.1; proxy_set_header Connection &quot;&quot;; &#125; lcaotion /FastCGI/ &#123; fastcgi_pass fastcgi_backend; fastcgi_keep_conn on; &#125;&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒkeepaliveæŒ‡ä»¤å¹¶ä¸ä¼šé™åˆ¶Nginxçš„æ‰€æœ‰workerè¿›ç¨‹èƒ½å¼€å¯çš„è¿æ¥åˆ°upstreamæœåŠ¡å™¨ä¸­çš„è¿æ¥æ€»æ•°ï¼ˆtotal numberï¼‰ã€‚ä¹Ÿå°±æ˜¯å¦‚æœè®¾å¾—å¤ªå¤§äº†ï¼Œä¼šå¯¼è‡´è¿‡å¤šçš„ç©ºé—²è¿æ¥å æ»¡äº†upstreamä¸­çš„serverèµ„æºï¼Œå¯¼è‡´æ–°çš„è¿æ¥æ— æ³•å»ºç«‹ï¼Œå› æ­¤è¿™ä¸ªæ•°å€¼çš„è®¾å®šéœ€è¦æ ¹æ®workerè¿›ç¨‹æ•°é‡æ¥è°ƒæ•´ã€‚ 2.2 keepalive_requests1234Syntax: keepalive_requests number;Default: keepalive_requests 100;Context: upstreamThis directive appeared in version 1.15.3. keepalive_requestsè®¾å®šå¯ä»¥é€šè¿‡ä¸€ä¸ªè¿æ¥ï¼ˆconnectionï¼‰å‘é€çš„è¯·æ±‚ï¼ˆrequestï¼‰æ•°é‡ï¼Œè¶…è¿‡æœ€å¤§è¯·æ±‚æ•°é‡ä¹‹åï¼Œè¯¥è¿æ¥ä¼šè¢«å…³é—­ã€‚ä¸ºäº†é‡Šæ”¾æ¯ä¸ªè¿æ¥çš„å†…å­˜åˆ†é…ï¼Œå®šæœŸå…³é—­è¿æ¥æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚å› æ­¤ï¼Œä¸å»ºè®®å°†keepalive_requestsè®¾å®šè¿‡å¤§ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´è¿‡é«˜çš„å†…å­˜å ç”¨ã€‚ 2.3 keepalive_timeout1234Syntax: keepalive_timeout timeout;Default: keepalive_timeout 60s;Context: upstreamThis directive appeared in version 1.15.3. è®¾å®šè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œåœ¨æ­¤è®¾å®šçš„æ—¶é—´å†…ï¼Œclientä¸upstreamä¸­çš„serverçš„ç©ºé—²keepaliveè¿æ¥å°†ä¿æŒæ‰“å¼€çŠ¶æ€ï¼ˆopenï¼‰ã€‚æ­¤å¤–ï¼Œè™½ç„¶å®˜æ–¹æ–‡æ¡£è¯´çš„é»˜è®¤å€¼æ˜¯60sï¼Œä½†æ˜¯1.17.9ç‰ˆæœ¬çš„Nginxåœ¨å®‰è£…ä¹‹åé…ç½®æ–‡ä»¶nginx.confä¸Šé¢è®¾å®šçš„æ˜¯65sã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"Nginxç¯‡04-mapæ¨¡å—","slug":"20200320-nginx-04-http-map-module","date":"2020-03-20T02:00:00.000Z","updated":"2020-03-20T02:00:00.000Z","comments":true,"path":"20200320-nginx-04-http-map-module/","link":"","permalink":"https://tinychen.com/20200320-nginx-04-http-map-module/","excerpt":"nginxçš„mapæ¨¡å—é…ç½®è¯­æ³•ã€‚","text":"nginxçš„mapæ¨¡å—é…ç½®è¯­æ³•ã€‚ mapæ¨¡å—æ˜¯ç”±ngx_http_map_moduleæ¨¡å—æä¾›çš„ï¼Œåªèƒ½åœ¨httpæ¨¡å—ä¸‹ä½¿ç”¨ï¼Œnginxé»˜è®¤è‡ªå¸¦å®‰è£…ã€‚map çš„ä¸»è¦ä½œç”¨ç®€å•æ¥è¯´å°±å’Œç¼–ç¨‹è¯­è¨€ä¸­çš„èµ‹å€¼è¯­å¥æœ‰ç‚¹åƒï¼Œåªä¸è¿‡è¿™é‡Œç§°ä¸ºæ˜ å°„ï¼ˆmapï¼‰ã€‚å…·ä½“æ¥è¯´æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å˜é‡ï¼Œå»åŒ¹é…æŸäº›æŒ‡å®šçš„å­—ç¬¦ä¸²æˆ–è€…æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚æœåŒ¹é…æˆåŠŸåˆ™å°†è¯¥åŒ¹é…å€¼èµ‹å€¼ç»™è¯¥è‡ªå®šä¹‰å˜é‡ï¼Œç„¶åè¯¥è‡ªå®šä¹‰å˜é‡å¯ä»¥ä½œå…¶ä»–ç”¨é€”ã€‚ 1ã€è¯­æ³•æ ¼å¼æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å®˜ç½‘ç»™å‡ºçš„è¯­æ³•æ ¼å¼ï¼š 123Syntax: map string $variable &#123; ... &#125;Default: â€”Context: http å®é™…ä¸Šç°åœ¨çš„ç‰ˆæœ¬ä¸­mapæŒ‡ä»¤åé¢çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯æºå˜é‡å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…æ˜¯å¦ä¸€ä¸ªå˜é‡ã€‚å› æ­¤è¿™æ ·è¡¨ç¤ºä¼šæ›´å®¹æ˜“ç†è§£ä¸€äº›ã€‚ 1Syntax: map $source_var $result_var &#123; ... &#125; æ­¤å¤–ï¼Œmapæ¨¡å—å†…è¿˜æœ‰defaultã€hostnamesã€includeã€volatileè¿™å››ä¸ªå…³é”®å­—å¯ä»¥ä½¿ç”¨ defaultï¼šä½¿ç”¨æ–¹æ³•ä¸º default valueï¼Œä¸»è¦ç”¨äºç»™æºå˜é‡è®¾å®šé»˜è®¤å€¼ï¼Œå¦‚æœæºå˜é‡æ²¡æœ‰åŒ¹é…åˆ°æ¨¡å—ä¸­æŒ‡å®šçš„ä»»ä½•ä¸€ä¸ªï¼Œåˆ™è®¾ä¸ºæŒ‡å®šçš„valueï¼Œå¦‚æœä¸æŒ‡å®šdefaultï¼Œåˆ™ä¼šè®¾å®šä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼ˆNULLï¼‰ hostnamesï¼šæŒ‡å®šæºå˜é‡å¯ä»¥ä¸ºåŸŸåï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å‰ç¼€æ©ç æˆ–è€…åç¼€æ©ç ï¼Œå¦‚*.example.comæˆ–è€…mail.* includeï¼šä½¿ç”¨æ–¹æ³•ä¸ºinclude fileï¼ŒæŒ‡å®šä¸€ä¸ªå¸¦æœ‰å˜é‡çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šæ¬¡ volatileï¼šæŒ‡æ˜è¯¥å˜é‡ä¸å¯ç¼“å­˜ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¤æ‚ä¸€ç‚¹çš„é…ç½®æ–‡ä»¶ 1234567891011map $http_host $name &#123; default 0; hostnames; volatile; *.example.com 1; *.example.org 2; *.example.net 3; mail.* 4; mail.example.com 5; include /var/www/html/host.list;&#125; éœ€è¦æ³¨æ„è¿™é‡Œçš„includeä½¿ç”¨çš„æ–‡ä»¶æ ¼å¼åº”è¯¥å¦‚ä¸‹ï¼š 1234$source_var0 $result_var0;$source_var1 $result_var1;...$source_varN $result_varN; ä¾‹å¦‚ï¼š 12nginx.example.com 7;awesome.example.com 8; 2ã€æ³¨æ„äº‹é¡¹è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š mapæŒ‡ä»¤åªèƒ½åœ¨httpå—ä¸­ä½¿ç”¨ï¼› å¦‚æœæºå˜é‡æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆåœ¨åŒ¹é…çš„æ—¶å€™æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼› åœ¨0.9.0ç‰ˆæœ¬ä¹‹å‰åªèƒ½æŒ‡å®šå•ä¸ªæºå˜é‡ï¼› 0.9.6ç‰ˆæœ¬ä¹‹åçš„æºå˜é‡å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ï¼› æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå¼€å¤´â€œ~â€ä¸ºå¤§å°å†™æ•æ„Ÿï¼Œâ€œ~*â€ä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼Œæ­£åˆ™è¡¨è¾¾å¼å¿…é¡»ä»¥è¿™ä¸¤è€…ä¸­çš„ä¸€ä¸ªå¼€å¤´ï¼› éœ€è¦åŒ¹é…çš„çš„æºå˜é‡ä¸­æœ‰ç‰¹æ®Šç¬¦å·çš„éœ€è¦ä½¿ç”¨åæ–œæ \\æ¥è¿›è¡Œè½¬ä¹‰ï¼› 0.9.0ç‰ˆæœ¬ä¸­æºå˜é‡å¯ä»¥ä½¿ç”¨å˜é‡ï¼Œ1.11.0ç‰ˆæœ¬ä¸­æºå˜é‡å¯ä»¥ä½¿ç”¨å˜é‡å’Œå­—ç¬¦ä¸²çš„ç»„åˆï¼› mapæŒ‡ä»¤å¯¹åº”çš„ç»“æœå˜é‡ï¼ˆ$result_varï¼‰åªæœ‰åœ¨ä¹‹åçš„é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨åˆ°äº†è¯¥ç»“æœå˜é‡çš„æ—¶å€™ï¼Œæ‰ä¼šä½¿ç”¨å‰é¢å®šä¹‰çš„mapæ¨¡å—æ¥è¿›è¡Œæ˜ å°„ï¼Œå› æ­¤å³ä½¿å®šä¹‰äº†å¾ˆå¤šä¸ªmapæ¨¡å—ï¼Œä¹Ÿä¸ä¼šå¯¹æ€§èƒ½æœ‰é¢å¤–çš„å½±å“ï¼› 3ã€åŒ¹é…é¡ºåºå½“mapå—ä¸­æŒ‡å®šçš„æ˜ å°„å…³ç³»æœ‰å¤šä¸ªå¯ä»¥åŒ¹é…çš„æ—¶å€™ï¼ŒæŒ‰ç…§ä»¥ä¸‹çš„ä¼˜å…ˆé¡ºåºè¿›è¡ŒåŒ¹é…ï¼š å®Œæ•´æŒ‡å®šæ²¡æœ‰ä½¿ç”¨æ©ç çš„æŒ‡å®šå˜é‡ï¼Œe.g.â€œmail.example.comâ€ï¼› å¸¦æœ‰å‰ç¼€æ©ç çš„æœ€é•¿å­—ç¬¦ä¸²å€¼, e.g. â€œ*.nginx.example.comâ€å°±ä¼šæ¯” â€œ*.example.comâ€ä¼˜å…ˆåŒ¹é…ï¼› å¸¦æœ‰åç¼€æ©ç çš„æœ€é•¿å­—ç¬¦ä¸²å€¼, e.g. â€œmail.nginx.*â€å°±ä¼šæ¯” â€œmail.*â€ä¼˜å…ˆåŒ¹é…ï¼› æŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­å‡ºç°çš„å…ˆåé¡ºåºåŒ¹é…çš„ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼› è®¾å®šçš„defaultå€¼ï¼› ä¸ªäººè®°å¿†å£è¯€ï¼šå…ˆæ•´å†ç¼ºï¼Œå…ˆå‰å†åï¼›å…ˆé•¿å†çŸ­ï¼Œå…ˆå®å†è™šï¼›æ— åˆ™é»˜è®¤ï¼Œä¸è¡ŒæŸ¥è¡¨ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"Nginxç¯‡03-è´Ÿè½½å‡è¡¡ç®€å•é…ç½®å’Œç®—æ³•åŸç†","slug":"20200319-nginx-03-load-balancing","date":"2020-03-19T02:00:00.000Z","updated":"2020-03-19T02:00:00.000Z","comments":true,"path":"20200319-nginx-03-load-balancing/","link":"","permalink":"https://tinychen.com/20200319-nginx-03-load-balancing/","excerpt":"nginxçš„è´Ÿè½½å‡è¡¡é…ç½®ï¼ŒåŒ…æ‹¬httpã€tcpå’Œudpè´Ÿè½½å‡è¡¡ï¼Œä»¥åŠRound robinã€Least connectionsã€Least timeï¼ˆNginx Plusä¸“å±ï¼‰ã€Generic hashã€Randomã€IP hashï¼ˆHTTPæ¨¡å—ä¸“å±ï¼‰çš„åŸç†åˆ†æã€‚","text":"nginxçš„è´Ÿè½½å‡è¡¡é…ç½®ï¼ŒåŒ…æ‹¬httpã€tcpå’Œudpè´Ÿè½½å‡è¡¡ï¼Œä»¥åŠRound robinã€Least connectionsã€Least timeï¼ˆNginx Plusä¸“å±ï¼‰ã€Generic hashã€Randomã€IP hashï¼ˆHTTPæ¨¡å—ä¸“å±ï¼‰çš„åŸç†åˆ†æã€‚ 1ã€httpè´Ÿè½½å‡è¡¡æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å°æ®µé…ç½®æ–‡ä»¶ 12345678910upstream backend &#123; server 10.0.0.1:80 weight=1; server nginx.example.com:80 weight=2; &#125;server &#123; location / &#123; proxy_pass http://backend; &#125;&#125; è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨upstreamæ¨¡å—å¯¹httpæœåŠ¡è¿›è¡ŒæŒ‡å®šæƒé‡çš„è´Ÿè½½å‡è¡¡çš„é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬å­˜æ”¾åœ¨nginxç›®å½•ä¸‹çš„conf.dæ–‡ä»¶å¤¹ä¸­ã€‚ serverå¯ä»¥ä½¿ç”¨Unix socketã€IPã€DNSã€FQDNç­‰æ¥è¿›è¡ŒæœåŠ¡å™¨çš„æŒ‡å®šï¼Œè¿™é‡Œçš„Unix socketæŒ‡çš„æ˜¯POSIXæ“ä½œç³»ç»Ÿä¸­çš„ç»„ä»¶ï¼Œå³ç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„é‚£ä¸ªUnix socketã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœåšè´Ÿè½½å‡è¡¡çš„æ—¶å€™æœ¬æœºä¹Ÿä½œä¸ºserverä¹‹ä¸€ï¼Œä½¿ç”¨scoketç¡®å®æ˜¯å¯ä»¥æœ‰æ•ˆæé«˜é€Ÿåº¦çš„ï¼ˆå¯¹æ¯”DNSå’ŒIPç­‰ï¼‰ï¼Œå› ä¸ºéƒ½åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸Šï¼Œèµ°è¿›ç¨‹é—´çš„é€šä¿¡æ¯”èµ°ç½‘ç»œé€šä¿¡è¦å°‘äº†å¾ˆå¤šéªŒè¯æ­¥éª¤å’Œåè®®ï¼Œé€šä¿¡çš„é€Ÿåº¦ä¼šæ›´å¿«ã€‚ä½†æ˜¯åœ¨å®é™…ä¸šåŠ¡ä¸­æ¯”è¾ƒå°‘ä½¿ç”¨è¿™æ ·çš„æ–¹å¼ï¼Œä¸€èˆ¬éƒ½ä¼šç›´æ¥ä½¿ç”¨IPæ–¹ä¾¿å®šä½ä¸»æœºå’Œè¿ç»´åˆ†æç­‰ã€‚IPç›¸æ¯”DNSå’ŒFQDNè¦å°‘äº†ä¸€æ­¥åŸŸåè§£æçš„è¿‡ç¨‹ï¼Œç†è®ºä¸Šé€Ÿåº¦ä¼šå¿«ä¸€äº›ï¼Œä½†æ˜¯DNSå…¶å®ä¹Ÿå¯ä»¥åšè´Ÿè½½å‡è¡¡ï¼ŒåŒæ—¶DNSå’ŒFQDNç»™äº†ç½‘ç»œè·¯ç”±æ›´å¤šçš„æ§åˆ¶æƒï¼Œå®é™…æ€ä¹ˆä½¿ç”¨è¿˜è¦çœ‹å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ã€‚ upstreamä¸­serveræŒ‡ä»¤è¯­æ³•å¦‚ä¸‹ï¼š 1server address [parameters] å…³é”®å­—serverå¿…é€‰ addressä¹Ÿå¿…é€‰ï¼Œå¯ä»¥æ˜¯ä¸»æœºåã€åŸŸåã€ipæˆ–unix socketï¼Œä¹Ÿå¯ä»¥æŒ‡å®šç«¯å£å· parametersæ˜¯å¯é€‰å‚æ•°ï¼Œå¯ä»¥æ˜¯å¦‚ä¸‹å‚æ•°ï¼š downï¼šè¡¨ç¤ºå½“å‰serverå·²åœç”¨ backupï¼šè¡¨ç¤ºå½“å‰serveræ˜¯å¤‡ç”¨æœåŠ¡å™¨ï¼Œåªæœ‰å…¶å®ƒébackupåç«¯æœåŠ¡å™¨éƒ½æŒ‚æ‰äº†æˆ–è€…å¾ˆå¿™æ‰ä¼šåˆ†é…åˆ°è¯·æ±‚ weightï¼šè¡¨ç¤ºå½“å‰serverè´Ÿè½½æƒé‡ï¼Œæƒé‡è¶Šå¤§è¢«è¯·æ±‚å‡ ç‡è¶Šå¤§ï¼Œé»˜è®¤æ˜¯1 max_failså’Œfail_timeoutä¸€èˆ¬ä¼šå…³è”ä½¿ç”¨ï¼Œå¦‚æœæŸå°serveråœ¨fail_timeoutæ—¶é—´å†…å‡ºç°äº†max_failsæ¬¡è¿æ¥å¤±è´¥ï¼Œé‚£ä¹ˆNginxä¼šè®¤ä¸ºå…¶å·²ç»æŒ‚æ‰äº†ï¼Œä»è€Œåœ¨fail_timeoutæ—¶é—´å†…ä¸å†å»è¯·æ±‚å®ƒï¼Œfail_timeouté»˜è®¤æ˜¯10s max_failsé»˜è®¤æ˜¯1ï¼Œå³é»˜è®¤æƒ…å†µæ˜¯åªè¦å‘ç”Ÿé”™è¯¯å°±è®¤ä¸ºæœåŠ¡å™¨æŒ‚æ‰äº† å¦‚æœå°†max_failsè®¾ç½®ä¸º0ï¼Œåˆ™è¡¨ç¤ºå–æ¶ˆè¿™é¡¹æ£€æŸ¥ 2ã€tcpè´Ÿè½½å‡è¡¡æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªstreamæ¨¡å—çš„é…ç½®ï¼š 123456789101112stream &#123; upstream mysql_read &#123; server mysqlread1.example.com:3306 weight=5; server mysqlread2.example.com:3306; server 10.0.0.1:3306 backup; &#125; server &#123; listen 3306; proxy_pass mysql_read; &#125; &#125; åœ¨è¿™ä¸ªé…ç½®ä¸­æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªMySQLçš„è´Ÿè½½å‡è¡¡å’Œå¤‡ä»½ã€‚æˆ‘ä»¬å…ˆçœ‹æ•´ä¸ªstreamæ¨¡å—åŒ…å«äº†upstreamæ¨¡å—å’Œserveræ¨¡å—ï¼Œåœ¨upstreamä¸­æŒ‡å®šäº†ä¸‰ä¸ªserverï¼Œå…¶ä¸­ç¬¬äºŒä¸ªserveråœ¨æ²¡æœ‰æŒ‡å®šæƒé‡weightçš„æƒ…å†µä¸‹ï¼Œ**weighté»˜è®¤ä¸º1**ï¼Œè€Œç¬¬ä¸‰ä¸ªserveråé¢æŒ‡å®šäº†å…¶çŠ¶æ€ä¸ºbackupï¼Œä¹Ÿå°±æ˜¯å¤‡ç”¨æœåŠ¡å™¨ã€‚ä¸€èˆ¬æ¥è¯´nginxä¼šåŒæ—¶ç›‘å¬è¿è¡ŒæœåŠ¡å™¨å’Œå¤‡ç”¨æœåŠ¡å™¨ï¼Œä»¥ä¾¿åœ¨activeæœåŠ¡å™¨å‡ºç°æ•…éšœçš„æ—¶å€™èƒ½è¿…é€Ÿåˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œstreamæ¨¡å—çš„é…ç½®æ–‡ä»¶ä¸å»ºè®®æ”¾åˆ°nginxä¸‹çš„conf.dç›®å½•ä¸‹ï¼ˆè¯¥ç›®å½•ä¸€èˆ¬ç”¨äºæ”¾ç½®httpæ¨¡å—ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªstream.conf.dç›®å½•ç”¨äºå­˜æ”¾streamæ¨¡å—çš„é…ç½®æ–‡ä»¶ï¼ŒåŒæ—¶éœ€è¦åœ¨nginxç›®å½•ä¸‹çš„nginx.confæ–‡ä»¶ä¸­å†™å…¥è¯¥ç›®å½•ï¼Œå¦‚ï¼š 123stream &#123; include /etc/nginx/stream.conf.d/*.conf;&#125; ç„¶åæˆ‘ä»¬åœ¨å¯¹åº”æ–°å»ºçš„stream.conf.dç›®å½•ä¸‹é¢æ–°å»ºé…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦å†æ·»åŠ stream&#123;&#125;äº†ï¼Œè¿™å’Œä¹‹å‰çš„httpæ¨¡å—å¯¹åº”çš„conf.dç›®å½•ä¸‹çš„é…ç½®ç›¸ä¼¼ï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥å°†æ•´ä¸ªstreamæ¨¡å—é…ç½®å…¨éƒ¨éƒ½æ”¾åˆ°nginxç›®å½•ä¸‹çš„nginx.confæ–‡ä»¶ä¸­ï¼Œåªä¸è¿‡è¿™æ ·ä¸æ–¹ä¾¿æ•´ç†ï¼Œå°¤å…¶æ˜¯å½“éœ€è¦é…ç½®çš„é¡¹ç›®å˜å¤šäº†çš„æ—¶å€™ã€‚ å®é™…ä¸Šæˆ‘ä»¬ä¼šå‘ç°tcpè´Ÿè½½å‡è¡¡ä½¿ç”¨çš„streamæ¨¡å—å’Œhttpæ¨¡å—ååˆ†ç›¸ä¼¼ï¼Œè¿™æ˜¯å› ä¸ºnginxä¸€å¼€å§‹æ˜¯ä½œä¸ºwebæœåŠ¡å™¨å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œtcpå’Œudpçš„è´Ÿè½½å‡è¡¡æ˜¯å±äºå››å±‚è´Ÿè½½å‡è¡¡ï¼Œè¿™é¡¹åŠŸèƒ½æ˜¯åœ¨1.9ç‰ˆæœ¬åŠ å…¥çš„ï¼Œå› æ­¤åœ¨ä¸€äº›é…ç½®å’ŒåŸç†ä¸Šéƒ½å‚è€ƒäº†httpæ¨¡å—ã€‚ 3ã€UDPè´Ÿè½½å‡è¡¡udpè´Ÿè½½å‡è¡¡å’Œä¸Šé¢çš„ä¸¤ä¸ªè´Ÿè½½å‡è¡¡æ¯”è¾ƒç±»ä¼¼ï¼Œåœ¨å®ç°çš„åŸç†ä¸Šä¹Ÿå‚è€ƒäº†tcpçš„è´Ÿè½½å‡è¡¡ã€‚ æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„æœåŠ¡ä¸­æ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨UDPåè®®çš„æœ‰NTPã€DNSç­‰ã€‚ 12345678910stream &#123; upstream ntp &#123; server ntp1.example.com:123 weight=2; server ntp2.example.com:123; &#125; server &#123; listen 123 udp; proxy_pass ntp; &#125; &#125; udpè´Ÿè½½å‡è¡¡çš„é…ç½®å’ŒtcpåŸºæœ¬ä¸€è‡´ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯è¦åœ¨ç›‘å¬çš„ç«¯å£åé¢åŠ ä¸Šudpå‚æ•°æŒ‡å®šåè®®ä¸ºudpåè®®å³å¯ã€‚ 4ã€è´Ÿè½½å‡è¡¡ç­–ç•¥é™¤äº†é»˜è®¤çš„è½®è¯¢è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œnginxè¿˜å†…ç½®äº†å…¶ä»–çš„ä¸€äº›è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®é™…ä¸Šå¯¹äºHTPPã€TCPå’ŒUDPä¸‰ç±»è´Ÿè½½å‡è¡¡ä½¿ç”¨çš„ç­–ç•¥é»˜è®¤æœ‰Round robinã€Least connectionsã€Least timeï¼ˆNginx Plusä¸“å±ï¼‰ã€Generic hashã€Randomã€IP hashï¼ˆä»…HTTPå¯ç”¨ï¼‰è¿™å…­ç§ã€‚ ç½‘ä¸Šæåˆ°è¾ƒå¤šçš„url_hashå’Œfairè¿™ä¸¤ç§ç­–ç•¥å±äºç¬¬ä¸‰æ–¹æ¨¡å—å®ç°çš„ç­–ç•¥ã€‚ 4.1 è½®è¯¢Round robinè½®è¯¢ç®—æ³•æ˜¯é»˜è®¤çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ ¹æ®è®¾å®šçš„æƒé‡å€¼æ¥è¿›è¡Œè®¿é—®ï¼Œæƒé‡å€¼è¶Šé«˜è¢«è®¿é—®çš„æ¦‚ç‡å°±è¶Šé«˜ï¼Œä¸è®¾ç½®æƒé‡å€¼çš„è¯åˆ™ä¼šé»˜è®¤è®¾ç½®ä¸º1ï¼Œæœ€åçš„è¢«è®¿é—®æ¯”ä¾‹ä»æ¦‚ç‡ç»Ÿè®¡çš„è§’åº¦ä¸Šçœ‹ç­‰äºè®¾å®šçš„æƒé‡å€¼æ¯”ä¾‹ã€‚ 123456upstream backend &#123; server backend1.example.com weight=5; server backend2.example.com weight=1; server backend3.example.com backup; server backend4.example.com down;&#125; å…·ä½“ä½¿ç”¨åˆ°çš„æ˜¯åä¸ºsmooth weighted round-robin balancingçš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå…·ä½“åŸç†å’Œæµ‹è¯•æœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¹‹å‰çš„æ–‡ç« ï¼Œè¿™é‡Œç›´æ¥æ‘˜å½•ä¹‹å‰çš„åŸç†å™è¿°éƒ¨åˆ†ã€‚ weightï¼šé…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„æƒé‡å€¼ï¼Œæ˜¯å®šå€¼ï¼Œåœ¨æ•´ä¸ªé€‰æ‹©è¿‡ç¨‹ä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼Œå¯¹åº”åˆ°è¿™é‡Œå°±æ˜¯3ã€5ã€7ã€‚ current_weightï¼šåç«¯æœåŠ¡å™¨çš„å½“å‰æƒé‡å€¼ï¼Œåˆå§‹å€¼ç­‰äº0ï¼Œåœ¨æ¯è½®é€‰æ‹©ä¸­ï¼Œè¯¥å€¼æœ€å¤§çš„æœåŠ¡å™¨å°±ä¼šè¢«é€‰ä¸­ effective_weightï¼šå˜åŒ–æƒé‡å€¼ï¼Œåˆå§‹å€¼ç­‰äºweightï¼Œç”¨äºåŠ¨æ€è°ƒæ•´æœåŠ¡å™¨è¢«é€‰æ‹©çš„æ¦‚ç‡ï¼Œå³å½“è¢«é€‰ä¸­çš„æœåŠ¡å™¨å‡ºç°äº†failureçš„æ—¶å€™ï¼Œè¯¥æœåŠ¡å™¨å¯¹åº”çš„effective_weightå°±ä¼šå‡å°ï¼Œå…·ä½“æ“ä½œæˆ‘ä»¬ä¸‹é¢å†è§£é‡Šã€‚ total_weightï¼šæ€»çš„æƒé‡å€¼ï¼Œå³æ‰€æœ‰æœåŠ¡å™¨çš„æƒé‡å€¼ç›¸åŠ ï¼Œåœ¨è¿™é‡Œä¸º3+5+7=15ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹é€æ­¥è§£æç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼š é¦–å…ˆè¿›è¡Œå„ç±»å€¼çš„åˆå§‹åŒ–ï¼Œweightèµ‹å€¼ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„weightï¼Œcurrent_weightèµ‹å€¼ä¸º0ï¼Œeffective_weightèµ‹å€¼ä¸ºweightï¼Œtotal_weightä¸ºæ‰€æœ‰weightä¹‹å’Œï¼› å¯¹äºæ¯ä¸ªæœåŠ¡å™¨çš„current_weightï¼ŒåŠ ä¸Šè¯¥æœåŠ¡å™¨å¯¹åº”çš„weightï¼› é€‰å–current_weightå€¼æœ€å¤§çš„æœåŠ¡å™¨æ¥æ¥å—è¿™æ¬¡è®¿é—®ï¼Œç„¶åè¯¥æœåŠ¡å™¨å¯¹åº”çš„current_weightéœ€è¦å‡å»total_weightï¼ˆå› æ­¤current_weightæ˜¯å¯ä»¥å‡ºç°è´Ÿå€¼çš„ï¼‰ ä¸æ–­é‡å¤æ­¥éª¤2å’Œæ­¥éª¤3ï¼Œå½“é‡å¤çš„æ¬¡æ•°ç­‰äºtotal_weightæ—¶ï¼Œæ‰€æœ‰æœåŠ¡å™¨çš„current_weightåˆšå¥½ä¸º0ï¼Œæ­¤æ—¶ç»“æŸä¸€è½®è´Ÿè½½å‡è¡¡ã€‚ 4.2 æœ€å°‘è¿æ¥æ•°Least connectionsåœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨least_connæ¥æŒ‡å®šè¯¥ç­–ç•¥ã€‚å‰é¢çš„è½®è¯¢ç®—æ³•æ˜¯ä½¿æ¯å°æœåŠ¡å™¨çš„è¿æ¥æ•°å¤§è‡´ç›¸åŒæˆ–è€…ç¬¦åˆè®¾å®šçš„æƒé‡æ¯”ä¾‹æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œå‰ææ˜¯æ¯ä¸ªè®¿é—®è¯·æ±‚æ‰€éœ€è¦çš„å¤„ç†æ—¶é—´éƒ½å¤§è‡´ç›¸åŒï¼Œå¦‚æœæ¯æ¬¡è®¿é—®éœ€è¦çš„å¤„ç†æ—¶é—´ä¸ä¸€æ ·ï¼Œä½¿ç”¨è½®è¯¢ç®—æ³•çš„æ•ˆæœå°±æ¯”è¾ƒä¸€èˆ¬ã€‚è¿™æ—¶å€™å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨æœ€å°‘è¿æ¥æ•°ç®—æ³•ã€‚ é¡¾åæ€ä¹‰ï¼Œnginxä¼šå°†è®¿é—®è´Ÿè½½åˆ°è®¿é—®æ•°æœ€å°‘çš„æœåŠ¡å™¨ä¸Šï¼ŒåŒæ—¶ä¹Ÿä¼šå°†è®¾å®šçš„æƒé‡å€¼weightçº³å…¥è€ƒè™‘å› ç´ ã€‚å…·ä½“æ¥è¯´å°±æ˜¯nginxä¼šè®°å½•åˆ†é…ç»™åç«¯æœåŠ¡å™¨çš„è¿æ¥æ•°ï¼Œå½“æœ‰è®¿é—®è¿‡æ¥çš„æ—¶å€™ä¼˜å…ˆåˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ï¼Œè€Œå¦‚æœæœ€å°‘è¿æ¥æ•°çš„æœåŠ¡å™¨å‡ºç°äº†å¤šå°ï¼Œåˆ™æ ¹æ®ä¸Šé¢çš„è½®è¯¢ç®—æ³•æ¥è¿›è¡Œé€‰æ‹©ã€‚ 12345upstream backend &#123; least_conn; server backend1.example.com; server backend2.example.com;&#125; 4.3 æœ€å¿«å“åº”æ—¶é—´Least timeï¼ˆNginx Plusä¸“å±ï¼‰å·ç§°åœ¨è¿™å‡ ç§ç®—æ³•ä¸­æœ€å¤æ‚çš„ç®—æ³•ï¼Œåœ¨æœ€å°‘è¿æ¥æ•°ç®—æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº†å“åº”æ—¶é—´è¿™ä¸€ç»´åº¦,å› æ­¤åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦åŠ ä¸Šheaderæˆ–è€…last_byte ã€‚ 12345upstream backend &#123; least_time header; server backend1.example.com; server backend2.example.com;&#125; å¯¹äºæŒ‡å®šäº†headerå‚æ•°ï¼Œnginxä¼šä½¿ç”¨æ¥æ”¶åˆ°å“åº”æŠ¥æ–‡çš„æŠ¥å¤´çš„æ—¶é—´æ¥ä½œä¸ºå“åº”æ—¶é—´ å¯¹äºæŒ‡å®šäº†last_byte å‚æ•°ï¼Œnginxä¼šä½¿ç”¨æ¥æ”¶æ•´ä¸ªå®Œæ•´æŠ¥æ–‡çš„æ—¶é—´æ¥ä½œä¸ºå“åº”æ—¶é—´ 4.4 æ™®é€šå“ˆå¸ŒGeneric hashä»¥ç”¨æˆ·è‡ªå®šä¹‰èµ„æº(æ¯”å¦‚URLã€ç‰¹å®šçš„æ–‡æœ¬ã€è¯·æ±‚çš„å˜é‡æˆ–è€…å¤šä¸ªçš„ç»„åˆç­‰)çš„æ–¹å¼è®¡ç®—hashå€¼å®Œæˆåˆ†é…ã€‚å½“æˆ‘ä»¬éœ€è¦æ›´å¥½åœ°æ§åˆ¶è¯·æ±‚çš„å‘é€åˆ°å“ªä¸ªæœåŠ¡å™¨ä¸Šæˆ–è€…ç¡®å®šæœåŠ¡å™¨æœ€æœ‰å¯èƒ½æœ‰ç¼“å­˜æ•°æ®æ—¶ï¼Œæ­¤æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚æ³¨æ„æ­¤æ—¶çš„serverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•ã€‚å½“æœ‰æœåŠ¡å™¨åŠ å…¥æˆ–è€…ç§»é™¤åç«¯çš„æœåŠ¡å™¨åˆ—è¡¨çš„æ—¶å€™ï¼Œå“ˆå¸Œè¯·æ±‚ä¼šè¢«é‡æ–°åˆ†é…ï¼Œæƒ³è¦æœ€å°åŒ–è¯¥å½±å“ï¼Œå¯ä»¥æ·»åŠ å…³é”®å­—consistentã€‚è¿™ä¸ªå…³é”®è¯ä¼šä½¿ç”¨ä¸€ç§æ–°çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³• ketama, è¯¥ç®—æ³•ä¼šè®©ç®¡ç†å‘˜æ·»åŠ æˆ–åˆ é™¤æŸä¸ªæœåŠ¡å®ä¾‹çš„æ—¶å€™ï¼Œåªæœ‰ä¸€å°éƒ¨åˆ†çš„è¯·æ±‚ä¼šè¢«è½¬å‘åˆ°ä¸ä¹‹å‰ä¸åŒçš„æœåŠ¡å®ä¾‹ä¸Šå»ï¼Œå…¶ä»–è¯·æ±‚ä»ç„¶ä¼šè¢«è½¬å‘åˆ°åŸæœ‰çš„æœåŠ¡å®ä¾‹ä¸Šå»ã€‚ 123456upstream resinserver &#123; hash $request_uri consistent; server backend1.example.com; server backend2.example.com; hash_method crc32; &#125; 4.5 éšæœºRandoméšæœºç®—æ³•å°±æ˜¯éšæœºä»åç«¯æœåŠ¡å™¨ä¸­æŒ‘é€‰ä¸€ä¸ªæ¥æ¥å—è®¿é—®ï¼Œä¸è¿‡å®ƒè¿˜æœ‰ä¸€ä¸ªé™„åŠ å‚æ•°two [parameters]ï¼Œå¯ä»¥éšæœºæŒ‘é€‰ä¸¤ä¸ªæœåŠ¡å™¨ï¼Œç„¶åæ ¹æ®æŒ‡å®šçš„å‡è¡¡ç®—æ³•ä»æœåŠ¡å™¨ä¸­æŒ‘é€‰ä¸€å°æ¥å—è®¿é—®ã€‚å¦‚æœä¸æŒ‡å®štwoåé¢çš„parametersåˆ™é»˜è®¤ä½¿ç”¨Least timeç®—æ³•è¿›è¡Œé€‰æ‹©ã€‚ 12345upstream backend &#123; random two ip_hash; server backend1.example.com; server backend2.example.com;&#125; 4.6 IPå“ˆå¸ŒIP hashï¼ˆHTTPæ¨¡å—ä¸“å±ï¼‰IPå“ˆå¸Œç®—æ³•ä½¿ç”¨ipv4åœ°å€çš„å‰ä¸‰æ®µï¼ˆæ¯”å¦‚è¯´192.168.1.1å°±ä½¿ç”¨192.168.1è¿™ä¸‰æ®µï¼‰æˆ–è€…æ˜¯æ•´ä¸ªipv6åœ°å€æ¥è¿›è¡Œå“ˆå¸Œç®—æ³•è®¡ç®—ï¼Œä»æºç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®é™…ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•æ¯”è¾ƒç®€å•ï¼Œåœ¨nginxæºç çš„\\src\\http\\modules\\ngx_http_upstream_ip_hash_module.cä¸­å¤§æ¦‚181è¡Œçš„ä½ç½®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 1hash = (hash * 113 + iphp-&gt;addr[i]) % 6271 è¿™ç§ç®—æ³•çš„å¥½å¤„æ˜¯å¯ä»¥ä¿æŒæœåŠ¡å™¨çš„sessionçš„ä¸€è‡´æ€§ï¼Œå› ä¸ºåŒä¸€ä¸ªIPæ ¹æ®å“ˆå¸Œç®—æ³•çš„ç»“æœä¸€èˆ¬éƒ½æ˜¯è®¿é—®åˆ°åŒä¸€å°æœåŠ¡å™¨ï¼ˆé™¤éä¸­é€”æœåŠ¡å™¨å´©äº†ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¯¥ç®—æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨è½®è¯¢ç®—æ³•çš„å‚æ•°ã€‚ 12345upstream backend &#123; ip_hash; server backend1.example.com weight=5; server backend2.example.com weight=1;&#125;","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"},{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"}]},{"title":"Nginxç¯‡02-upstreamæ¨¡å—ä¸­çš„åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡","slug":"20200318-nginx-02-smooth-weighted-round-robin-balancing","date":"2020-03-18T09:00:00.000Z","updated":"2020-03-18T09:00:00.000Z","comments":true,"path":"20200318-nginx-02-smooth-weighted-round-robin-balancing/","link":"","permalink":"https://tinychen.com/20200318-nginx-02-smooth-weighted-round-robin-balancing/","excerpt":"nginxçš„upstreamæ¨¡å—ä¸­çš„åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡çš„ç®—æ³•åŸç†ã€‚","text":"nginxçš„upstreamæ¨¡å—ä¸­çš„åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡çš„ç®—æ³•åŸç†ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„è´Ÿè½½å‡è¡¡ï¼š 1234upstream backend &#123; server 10.0.0.1:80; #æœåŠ¡å™¨a server 10.0.0.2:80; #æœåŠ¡å™¨b&#125; è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è´Ÿè½½å‡è¡¡ï¼Œå°†æ¥å—åˆ°çš„è®¿é—®æŒ‰ç…§é»˜è®¤çš„å‡åˆ†åŸåˆ™åˆ†é…ç»™åå°çš„ä¸¤å°æœåŠ¡å™¨ï¼Œè¿™æ—¶å€™ä¸¤å°serverçš„è®¿é—®é‡åº”è¯¥æ˜¯1ï¼š1ã€‚å¦‚æœæˆ‘ä»¬åœ¨åé¢åŠ ä¸Šæƒé‡å€¼ï¼Œä¾‹å¦‚ 1234upstream backend &#123; server 10.0.0.1:80 weight=1; #æœåŠ¡å™¨a server 10.0.0.2:80 weight=2; #æœåŠ¡å™¨b&#125; è¿™æ—¶å€™å¦‚æœè¿›è¡Œè®¿é—®ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ç»“æœå°±åº”è¯¥æ˜¯b a bï¼Œå¦‚æœå†è¿›è¡Œä¿®æ”¹æƒé‡ 1234upstream backend &#123; server 10.0.0.1:80 weight=5; #æœåŠ¡å™¨a server 10.0.0.2:80 weight=10; #æœåŠ¡å™¨b&#125; è™½ç„¶ä¸¤ä¸ªæƒé‡åŒ–ç®€ä¹‹åéƒ½æ˜¯1ï¼š2ï¼Œä½†æ˜¯è¿™æ—¶å€™è®¿é—®ç­–ç•¥å°±æœ‰ä¸¤ç§é€‰æ‹© ç¬¬ä¸€ç§æ˜¯å…ˆè¿ç»­è®¿é—®server a5æ¬¡å†è¿ç»­è®¿é—®server b10æ¬¡ ç¬¬äºŒç§æ˜¯a bä¸¤å°æœåŠ¡å™¨è½®æµè®¿é—®ï¼Œä½†æ˜¯æ€»çš„è®¿é—®æ¬¡æ•°æ¯”ä¾‹ç¬¦åˆ5ï¼š10ä¹Ÿå°±æ˜¯1ï¼š2çš„æ¯”ä¾‹ã€‚ æ˜¾ç„¶ç¬¬äºŒç§è®¿é—®ç­–ç•¥è¦æ›´åŠ ä¼˜ç§€ï¼Œå¯ä»¥é¿å…ä¸€å°æœåŠ¡å™¨è¢«è¿ç»­è®¿é—®å¤šæ¬¡è€Œå¦ä¸€å°æœåŠ¡å™¨è¿›å…¥ç©ºé—²çŠ¶æ€ã€‚åœ¨nginxä¸­çš„upstreamæ¨¡å—å®ç°è¿™ä¸ªæ“ä½œä½¿ç”¨äº†ä¸€ä¸ªåä¸ºsmooth weighted round-robin balancingçš„ç®—æ³•ï¼Œç›´è¯‘è¿‡æ¥å°±æ˜¯å¹³æ»‘åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯å®ç°ä¸Šé¢è¯´çš„ç¬¬äºŒç§æ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„é…ç½®æ¥æ£€éªŒä¸€ä¸‹ã€‚ 1234567891011121314upstream backend &#123; server 127.0.0.1:8080 weight=3; server 127.0.0.1:8081 weight=5; server 127.0.0.1:8082 weight=7;&#125;server &#123; listen 80; server_name example.com www.example.com; location / &#123; proxy_pass http://backend; &#125;&#125; è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨nginxç›‘å¬åœ¨æœ¬æœº8080~8081ä¸‰ä¸ªç«¯å£ï¼Œç„¶åè¿™ä¸‰ä¸ªç«¯å£ä½œä¸ºæœ¬æœºçš„80ç«¯å£çš„è´Ÿè½½å‡è¡¡åç«¯ï¼Œæ¥ç€æˆ‘ä»¬æŠŠæƒé‡è®¾ä¸ºæ¯”è¾ƒå¤æ‚çš„3ï¼š5ï¼š7ï¼Œç„¶åæˆ‘ä»¬è¿›è¡Œå®é™…æµ‹è¯•ã€‚ å¾—åˆ°çš„ç»“æœä¸ºï¼Œc b a c b c a c b c b c a b cï¼Œè¿™é‡Œåˆšå¥½15æ¬¡ä¹Ÿå°±æ˜¯ç¬¦åˆæƒé‡ä¸Šé¢çš„åŠ èµ·æ¥çš„æ€»å’Œï¼Œä»ç»“æœæ¥çœ‹è¿™é‡Œçš„è®¿é—®é¡ºåºæ¯”è¾ƒå‡è¡¡ï¼Œä½†æ˜¯ç»†çœ‹åˆæ¯”è¾ƒéš¾æ‰¾å‡ºè§„å¾‹ã€‚ æˆ‘ä»¬å»Githubä¸Šé¢æ‰¾åˆ°nginxçš„æºç ï¼Œå¯¹åº”çš„æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æµ‹è¯•çš„ç‰ˆæœ¬æ˜¯ç¨³å®šç‰ˆçš„1.17.9ï¼Œæˆ‘ä»¬åœ¨ç›®å½•ä¸‹çš„nginx-master\\src\\http\\ngx_http_upstream_round_robin.cå½“ä¸­å¯ä»¥çœ‹åˆ°è¿™éƒ¨åˆ†çš„å®ç°æºç ï¼Œä¸»è¦é›†ä¸­åœ¨è¯¥æ–‡ä»¶çš„å‰é¢éƒ¨åˆ†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç†è§£æºç ä¸­çš„å‡ ä¸ªå˜é‡ï¼š weightï¼šé…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„æƒé‡å€¼ï¼Œæ˜¯å®šå€¼ï¼Œåœ¨æ•´ä¸ªé€‰æ‹©è¿‡ç¨‹ä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼Œå¯¹åº”åˆ°è¿™é‡Œå°±æ˜¯3ã€5ã€7ã€‚ current_weightï¼šåç«¯æœåŠ¡å™¨çš„å½“å‰æƒé‡å€¼ï¼Œåˆå§‹å€¼ç­‰äº0ï¼Œåœ¨æ¯è½®é€‰æ‹©ä¸­ï¼Œè¯¥å€¼æœ€å¤§çš„æœåŠ¡å™¨å°±ä¼šè¢«é€‰ä¸­ effective_weightï¼šå˜åŒ–æƒé‡å€¼ï¼Œåˆå§‹å€¼ç­‰äºweightï¼Œç”¨äºåŠ¨æ€è°ƒæ•´æœåŠ¡å™¨è¢«é€‰æ‹©çš„æ¦‚ç‡ï¼Œå³å½“è¢«é€‰ä¸­çš„æœåŠ¡å™¨å‡ºç°äº†failureçš„æ—¶å€™ï¼Œè¯¥æœåŠ¡å™¨å¯¹åº”çš„effective_weightå°±ä¼šå‡å°ï¼Œå…·ä½“æ“ä½œæˆ‘ä»¬ä¸‹é¢å†è§£é‡Šã€‚ total_weightï¼šæ€»çš„æƒé‡å€¼ï¼Œå³æ‰€æœ‰æœåŠ¡å™¨çš„æƒé‡å€¼ç›¸åŠ ï¼Œåœ¨è¿™é‡Œä¸º3+5+7=15ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹é€æ­¥è§£æç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼š é¦–å…ˆè¿›è¡Œå„ç±»å€¼çš„åˆå§‹åŒ–ï¼Œweightèµ‹å€¼ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„weightï¼Œcurrent_weightèµ‹å€¼ä¸º0ï¼Œeffective_weightèµ‹å€¼ä¸ºweightï¼Œtotal_weightä¸ºæ‰€æœ‰weightä¹‹å’Œï¼› å¯¹äºæ¯ä¸ªæœåŠ¡å™¨çš„current_weightï¼ŒåŠ ä¸Šè¯¥æœåŠ¡å™¨å¯¹åº”çš„weightï¼› é€‰å–current_weightå€¼æœ€å¤§çš„æœåŠ¡å™¨æ¥æ¥å—è¿™æ¬¡è®¿é—®ï¼Œç„¶åè¯¥æœåŠ¡å™¨å¯¹åº”çš„current_weightéœ€è¦å‡å»total_weightï¼ˆå› æ­¤current_weightæ˜¯å¯ä»¥å‡ºç°è´Ÿå€¼çš„ï¼‰ ä¸æ–­é‡å¤æ­¥éª¤2å’Œæ­¥éª¤3ï¼Œå½“é‡å¤çš„æ¬¡æ•°ç­‰äºtotal_weightæ—¶ï¼Œæ‰€æœ‰æœåŠ¡å™¨çš„current_weightåˆšå¥½ä¸º0ï¼Œæ­¤æ—¶ç»“æŸä¸€è½®è´Ÿè½½å‡è¡¡ã€‚ ä»ä¸Šé¢çš„æ­¥éª¤åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå½“è¢«é€‰ä¸­çš„æœåŠ¡å™¨å‡ºç°äº†failureçš„æ—¶å€™ï¼Œè¯¥æœåŠ¡å™¨å¯¹åº”çš„effective_weightå°±ä¼šå‡å°ï¼Œåœ¨ä¸‹é¢çš„current_weightåŠ ä¸Šè¯¥æœåŠ¡å™¨å¯¹åº”çš„weightæ“ä½œä¸­å°±ä¸èƒ½å˜å¾—è¶³å¤Ÿå¤§å¯¼è‡´è¢«é€‰ä¸­ï¼Œä»è€Œå°±å¯ä»¥é¿å…è¿‡å¤šçš„è®¿é—®è¢«åˆ†é…åˆ°å‡ºç°äº†failureçš„æœåŠ¡å™¨ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œç®€å•çš„æ¼”ç®—çœ‹çœ‹æ˜¯å¦ç¬¦åˆå®é™…çš„è¾“å‡ºç»“æœï¼š æ“ä½œ current_weight é€‰ä¸­æœåŠ¡å™¨ åˆå§‹åŒ– ï¼ˆ0ï¼Œ0ï¼Œ0ï¼‰ - æ­¥éª¤2 ï¼ˆ3ï¼Œ5ï¼Œ7ï¼‰ - æ­¥éª¤3 ï¼ˆ3ï¼Œ5ï¼Œ-8ï¼‰ c æ­¥éª¤2 ï¼ˆ6ï¼Œ10ï¼Œ-1ï¼‰ - æ­¥éª¤3 ï¼ˆ6ï¼Œ-5ï¼Œ-1ï¼‰ b æ­¥éª¤2 ï¼ˆ9ï¼Œ0ï¼Œ6ï¼‰ - æ­¥éª¤3 ï¼ˆ-6ï¼Œ0ï¼Œ6ï¼‰ a æ­¥éª¤2 ï¼ˆ-3ï¼Œ5ï¼Œ13ï¼‰ - æ­¥éª¤3 ï¼ˆ-3ï¼Œ5ï¼Œ-2ï¼‰ c ä¸‹é¢çš„æ­¥éª¤å°±ä¸ç»§ç»­æ¼”ç¤ºäº†ï¼Œå½“æ­¥éª¤2å’Œæ­¥éª¤3é‡å¤äº†total_weightæ¬¡ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºä¸€è½®ä¹‹åï¼Œcurrent_weightå°±ä¼šæ­£å¥½å…¨éƒ¨å˜å›0ï¼Œè€Œå‰ææ˜¯è¿‡ç¨‹ä¸­æ²¡æœ‰å‡ºç°æœåŠ¡å™¨failureçš„æƒ…å†µã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"},{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"}]},{"title":"Nginxç¯‡01-åŸºæœ¬å®‰è£…é…ç½®å’Œé™æ€é¡µé¢è®¾ç½®","slug":"20200317-nginx-01-base-conf-static-web","date":"2020-03-17T03:00:00.000Z","updated":"2020-03-17T03:00:00.000Z","comments":true,"path":"20200317-nginx-01-base-conf-static-web/","link":"","permalink":"https://tinychen.com/20200317-nginx-01-base-conf-static-web/","excerpt":"nginxçš„ç¼–è¯‘å®‰è£…ã€æ·»åŠ æ¨¡å—ã€yumå®‰è£…ã€ç®€å•é…ç½®ã€é»˜è®¤ç›®å½•ä½œç”¨å’Œé™æ€é¡µé¢é…ç½®ã€‚","text":"nginxçš„ç¼–è¯‘å®‰è£…ã€æ·»åŠ æ¨¡å—ã€yumå®‰è£…ã€ç®€å•é…ç½®ã€é»˜è®¤ç›®å½•ä½œç”¨å’Œé™æ€é¡µé¢é…ç½®ã€‚ 0ã€ç¼–è¯‘å®‰è£…nginx0.1 å‡†å¤‡å·¥ä½œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨nginxçš„mainlineç‰ˆæœ¬çš„1.17.9æ¥è¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œnginxå„ç‰ˆæœ¬çš„å®˜ç½‘ä¸‹è½½åœ°å€ï¼šhttp://nginx.org/en/download.html é¦–å…ˆæˆ‘ä»¬ä¸‹è½½å¹¶è§£å‹nginxæºç  12wget http://nginx.org/download/nginx-1.17.9.tar.gztar -zxvf nginx-1.17.9.tar.gz åœ¨ç¼–è¯‘å®‰è£…ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦å…ˆå®‰è£…å‡ ä¸ªåˆ«çš„è½¯ä»¶ï¼š GCC/G++ç¼–è¯‘å™¨ï¼šGCCï¼ˆGNU Compiler Collectionï¼‰å¯ç”¨æ¥ç¼–è¯‘Cè¯­è¨€ç¨‹åºï¼Œå¦‚æœä½ è¿˜éœ€è¦ä½¿ç”¨C++æ¥ç¼–å†™Nginx HTTPæ¨¡å—ï¼Œè¿™æ—¶è¿˜éœ€è¦ç”¨åˆ°G++ç¼–è¯‘å™¨äº†ã€‚ PCREåº“ï¼šPCREï¼ˆPerl Compatible Regular Expressionsï¼ŒPerlå…¼å®¹æ­£åˆ™è¡¨è¾¾å¼ï¼‰æ˜¯ç”±Philip Hazelå¼€å‘çš„å‡½æ•°åº“ï¼Œç›®å‰ä¸ºå¾ˆå¤šè½¯ä»¶æ‰€ä½¿ç”¨ï¼Œè¯¥åº“æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚å®é™…ä¸Šåœ¨nginxçš„å¾ˆå¤šé«˜çº§é…ç½®ä¸­éƒ½ä¼šç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç¼–è¯‘Nginxæ—¶å°½é‡å…ˆæŠŠPCREåº“ç¼–è¯‘è¿›Nginxã€‚ zlibåº“ï¼šzlibåº“ç”¨äºå¯¹HTTPåŒ…çš„å†…å®¹åšgzipæ ¼å¼çš„å‹ç¼©ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨nginx.confé‡Œé…ç½®äº†gzip onï¼Œå¹¶æŒ‡å®šå¯¹äºæŸäº›ç±»å‹ï¼ˆcontent-typeï¼‰çš„HTTPå“åº”ä½¿ç”¨gzipæ¥è¿›è¡Œå‹ç¼©ä»¥å‡å°‘ç½‘ç»œä¼ è¾“é‡ã€‚ OpenSSLå¼€å‘åº“ï¼šHTTPSå¿…å¤‡ï¼Œè¿™ä¸ªå°±ä¸ç”¨è§£é‡Šäº† ä¸Šé¢æåˆ°çš„åº“æˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨yumæ¥è¿›è¡Œå®‰è£…ï¼š 1234yum install gcc gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel# pcre-develæ˜¯ä½¿ç”¨PCREåšäºŒæ¬¡å¼€å‘æ—¶æ‰€éœ€è¦çš„å¼€å‘åº“ï¼ŒåŒ…æ‹¬å¤´æ–‡ä»¶ç­‰ï¼Œè¿™ä¹Ÿæ˜¯ç¼–è¯‘Nginxæ‰€å¿…é¡»ä½¿ç”¨çš„ã€‚# åŒç†ï¼Œzlibæ˜¯ç›´æ¥ä½¿ç”¨çš„åº“ï¼Œzlib-develæ˜¯äºŒæ¬¡å¼€å‘æ‰€éœ€è¦çš„åº“ã€‚ Nginxæ˜¯é«˜åº¦è‡ªç”±åŒ–çš„WebæœåŠ¡å™¨ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ç”±è®¸å¤šæ¨¡å—æ¥æ”¯æŒçš„ã€‚è€Œè¿™äº›æ¨¡å—å¯æ ¹æ®æˆ‘ä»¬çš„ä½¿ç”¨éœ€æ±‚æ¥å®šåˆ¶ï¼Œå¦‚æœæŸäº›æ¨¡å—ä¸éœ€è¦ä½¿ç”¨åˆ™å®Œå…¨ä¸å¿…ç†ä¼šå®ƒã€‚åŒæ ·ï¼Œå¦‚æœä½¿ç”¨äº†æŸä¸ªæ¨¡å—ï¼Œè€Œè¿™ä¸ªæ¨¡å—ä½¿ç”¨äº†ä¸€äº›ç±»ä¼¼zlibæˆ–OpenSSLç­‰çš„ç¬¬ä¸‰æ–¹åº“ï¼Œé‚£ä¹ˆå°±å¿…é¡»å…ˆå®‰è£…è¿™äº›è½¯ä»¶ã€‚ 0.2 ç¼–è¯‘å®‰è£…æˆ‘ä»¬è¿›å…¥nginxçš„ç›®å½•ï¼Œè¾“å…¥ä¸‹é¢çš„æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹å„ç±»çš„ç¼–è¯‘å‚æ•°ï¼Œæˆ–è€…åœ¨å®˜ç½‘ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼š 1./configure --help æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„å‚æ•°æ˜¯ï¼š 1./configure --sbin-path=/usr/local/nginx/nginx --conf-path=/usr/local/nginx/nginx.conf --pid-path=/usr/local/nginx/nginx.pid --with-http_ssl_module è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨å‚æ•°é‡Œé¢å¹¶æ²¡æœ‰æŒ‡å®šä¸Šé¢æåˆ°çš„å‡ ä¸ªåº“çš„ç›®å½•ï¼Œconfigureæ–‡ä»¶ä¼šé»˜è®¤ç³»ç»Ÿå·²ç»å®‰è£…çš„åº“ç‰ˆæœ¬å’Œç›®å½•ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæŸä¸ªåº“çš„ç›®å½•æ¥æŒ‡å®šç‰ˆæœ¬ã€‚ æ¥ä¸‹æ¥è¿›è¡Œmakeå®‰è£…ï¼š 12makemake install å¦‚æ— æ„å¤–æ­¤æ—¶åº”è¯¥å·²ç»æ­£å¸¸å®‰è£…å¥½äº†ï¼Œæˆ‘ä»¬åˆ°å‰é¢æŒ‡å®šçš„å®‰è£…ç›®å½•çœ‹ä¸€ä¸‹ æ³¨æ„è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¦‚æœéœ€è¦ä½¿ç”¨nginxéœ€è¦æŒ‡å®šè¿™ä¸ªå®‰è£…ç›®å½•ï¼Œæƒ³è¦å…¨å±€ä½¿ç”¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼š 1ln -s /usr/local/nginx/nginx /usr/sbin/nginx 0.3 æ·»åŠ æ¨¡å—åŒæ—¶ï¼Œå¦‚æœä¹‹åæœ‰éœ€è¦ç”¨åˆ°çš„æ¨¡å—è€Œåœ¨ç¼–è¯‘å®‰è£…çš„æ—¶å€™å¿˜äº†å®‰è£…ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ç¼–è¯‘æ·»åŠ æ–°æ¨¡å— é¦–å…ˆæˆ‘ä»¬éœ€è¦æŸ¥çœ‹å·²ç»ç¼–è¯‘çš„å‚æ•°: 1234567[root@localhost ~]# nginx -Vnginx version: nginx/1.17.9built by gcc 4.4.7 20120313 (Red Hat 4.4.7-23) (GCC) built with OpenSSL 1.0.1e-fips 11 Feb 2013TLS SNI support enabledconfigure arguments: --sbin-path=/usr/local/nginx/nginx --conf-path=/usr/local/nginx/nginx.conf --pid-path=/usr/local/nginx/nginx.pid --with-http_ssl_module éœ€è¦æ³¨æ„ä¸Šé¢çš„Væ˜¯å¤§å†™çš„V åœ¨configure arguments: è¿™ä¸€æ é‡Œé¢æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¹‹å‰ç¼–è¯‘çš„æ—¶å€™çš„å‚æ•°ï¼Œå¯¹æ¯”ä¸Šé¢çš„è®°å½•æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œç„¶åæˆ‘ä»¬ä¼šåˆ°ä¹‹å‰ä¸‹è½½çš„æºç ç›®å½•ï¼Œæ³¨æ„æ˜¯æºç çš„ç›®å½•ä¸æ˜¯å®‰è£…çš„ç›®å½•ï¼Œç„¶åæ·»åŠ ä¸Šä¹‹å‰çš„ç¼–è¯‘å‚æ•°ï¼Œå†æ·»åŠ æ–°çš„æ¨¡å—ï¼Œ 1./configure --sbin-path=/usr/local/nginx/nginx --conf-path=/usr/local/nginx/nginx.conf --pid-path=/usr/local/nginx/nginx.pid --with-http_ssl_module --with-http_v2_module --with-mail --with-mail_ssl_module æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬æ·»åŠ äº†http_v2ã€mailã€mail_sslä¸‰ä¸ªæ¨¡å— å¦‚æœæƒ³è¦æ·»åŠ ç¬¬ä¸‰æ–¹æ¨¡å—çš„è¯ï¼Œåªéœ€è¦ä½¿ç”¨--add-module=ç„¶ååŠ ä¸Šç¬¬ä¸‰æ–¹æ¨¡å—çš„è·¯å¾„å³å¯ã€‚ 1--add-module=/home/echo-nginx-module-0.61 æœ€åæˆ‘ä»¬çš„ç¼–è¯‘å‚æ•°æ˜¯ï¼š 123456789./configure \\--sbin-path=/usr/local/nginx/nginx \\--conf-path=/usr/local/nginx/nginx.conf \\--pid-path=/usr/local/nginx/nginx.pid \\--with-http_ssl_module \\--with-http_v2_module \\--with-mail \\--with-mail_ssl_module \\--add-module=/home/echo-nginx-module-0.61 æ¥ç€æˆ‘ä»¬ä½¿ç”¨makeå®‰è£…ï¼Œå†æŸ¥çœ‹ç›®å½•ä¼šå‘ç°åŸæ¥çš„æ–‡ä»¶å·²ç»è¢«æ›¿æ¢æˆ*.defaultäº† 12makemake install æœ€åæˆ‘ä»¬å†ç¡®å®šä¸€ä¸‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š 1ã€yumå®‰è£…nginx1.1 yumä»“åº“å»ºç«‹å’Œå®‰è£…é…ç½®centosè‡ªå¸¦çš„repoä¸­å°±æœ‰nginxï¼Œå¯ä»¥ç›´æ¥å®‰è£…ï¼Œä½†æ˜¯ç‰ˆæœ¬æ¯”è¾ƒæ—§ï¼Œæƒ³è¦ä½¿ç”¨yumè¿›è¡Œå®‰è£…æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦è‡ªè¡Œé…ç½®yumä»“åº“ã€‚ 123456789101112131415[nginx-stable]name=nginx stable repobaseurl=http://nginx.org/packages/centos/$releasever/$basearch/gpgcheck=1enabled=1gpgkey=https://nginx.org/keys/nginx_signing.keymodule_hotfixes=true[nginx-mainline]name=nginx mainline repobaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/gpgcheck=1enabled=0gpgkey=https://nginx.org/keys/nginx_signing.keymodule_hotfixes=true é»˜è®¤æƒ…å†µä¸‹mainlineç‰ˆæœ¬æ˜¯ä¸ä¼šå¯ç”¨çš„ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœéœ€è¦å®‰è£…mainlineç‰ˆæœ¬çš„nginxåˆ™éœ€è¦æ‰‹åŠ¨å¯ç”¨è¿™ä¸ªrepoã€‚ 12345yum install yum-utilsyum-config-manager --enable nginx-mainlineyum clean allyum repolistyum install nginx å®‰è£…çš„æ—¶å€™éœ€è¦æ³¨æ„è¿™ä¸ªåˆ—å‡ºä¿¡æ¯ä¸­çš„repoåº”è¯¥æ˜¯æˆ‘ä»¬åˆšåˆšæ–°å»ºçš„repoã€‚ å®‰è£…å®Œæˆä¹‹åéœ€è¦è®¾ç½®å¼€æœºå¯åŠ¨å’Œé˜²ç«å¢™æ”¾è¡Œ80ç«¯å£ï¼Œå¦‚æœä½¿ç”¨httpsè¿˜éœ€è¦æ”¾è¡Œ443ç«¯å£ã€‚ 12345systemctl enable nginx systemctl start nginx firewall-cmd --permanent --zone=public --add-port=80/tcpfirewall-cmd --permanent --zone=public --add-port=443/tcpfirewall-cmd --reload æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹å®‰è£…å’Œå¯åŠ¨æ˜¯å¦æˆåŠŸã€‚ 12nginx -vcurl 127.0.0.1 1.2 masterå’Œworkerè¿›ç¨‹ä½¿ç”¨pså‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªmasterè¿›ç¨‹å’Œä¸€ä¸ªworkerè¿›ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œworkerçš„è¿›ç¨‹æ•°é‡ä¸º1ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ 1ps -ef | grep nginx åœ¨æ­£å¼æä¾›æœåŠ¡çš„äº§å“ç¯å¢ƒä¸‹ï¼Œéƒ¨ç½²Nginxæ—¶éƒ½æ˜¯ä½¿ç”¨ä¸€ä¸ªmasterè¿›ç¨‹æ¥ç®¡ç†å¤šä¸ªworkerè¿›ç¨‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œworkerè¿›ç¨‹çš„æ•°é‡ä¸æœåŠ¡å™¨ä¸Šçš„CPUæ ¸å¿ƒæ•°ç›¸ç­‰ã€‚æ¯ä¸€ä¸ªworkerè¿›ç¨‹éƒ½æ˜¯ç¹å¿™çš„ï¼Œå®ƒä»¬åœ¨çœŸæ­£åœ°æä¾›äº’è”ç½‘æœåŠ¡ï¼Œmasterè¿›ç¨‹åˆ™å¾ˆâ€œæ¸…é—²â€ï¼Œåªè´Ÿè´£ç›‘æ§ç®¡ç†workerè¿›ç¨‹ã€‚workerè¿›ç¨‹ä¹‹é—´é€šè¿‡å…±äº«å†…å­˜ã€åŸå­æ“ä½œç­‰ä¸€äº›è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶æ¥å®ç°å„ç§åŠŸèƒ½ã€‚ 2ã€nginxåŸºæœ¬é…ç½®2.1 nginxé»˜è®¤ç›®å½•/etc/nginx/è¿™ä¸ªæ˜¯nginxæœåŠ¡å™¨çš„é»˜è®¤é…ç½®ç›®å½• /etc/nginx/nginx.confè¿™ä¸ªæ˜¯nginxæœåŠ¡å™¨çš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œå¯¹nginxçš„æ‰€æœ‰å…¨å±€é…ç½®è¿›è¡Œä¿®æ”¹ï¼ŒåŒ…æ‹¬çº¿ç¨‹æ•°ç«¯å£å·ç­‰ç­‰ï¼ŒåŒæ—¶åœ¨é»˜è®¤æƒ…å†µä¸‹å®ƒä¹ŸåŒ…æ‹¬äº†ä¸‹è¿°çš„/etc/nginx/conf.d/ç›®å½•ä¸­çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚ /etc/nginx/conf.d/è¿™ä¸ªç›®å½•ä¸­åŒ…å«çš„.confé…ç½®æ–‡ä»¶ä¸»è¦ç”¨äºå•ç‹¬å®šä¹‰æŸä¸ªhttpç½‘é¡µï¼Œä»è€Œä½¿å¾—æ•´ä¸ªé…ç½®ç›®å½•æ–‡ä»¶çš„ç®¡ç†å˜å¾—æ›´åŠ ç®€æ´è€Œæ¸…æ™°ã€‚ /var/log/nginxè¿™ä¸ªç›®å½•æ˜¯é»˜è®¤çš„logæ—¥å¿—ç›®å½•ï¼Œä¸»è¦æœ‰acces.logå’Œerror.logä¸¤ä¸ªæ–‡ä»¶ï¼Œå‰è€…è´Ÿè´£è®°å½•æ¯ä¸€ä¸ªè¢«è®¿é—®çš„è®°å½•ï¼Œåè€…è´Ÿè´£è®°å½•è®¿é—®ä¸­å‡ºç°çš„é”™è¯¯ã€‚ 2.2 nginxå‘½ä»¤è¾“å…¥nginx -hå³å¯æŸ¥çœ‹æ‰€æœ‰æŒ‡ä»¤ï¼Œä¸éœ€è¦ç‰¹æ„å»è®°å¿†ï¼Œç”¨å¤šäº†å°±è‡ªç„¶è®°ä½äº†ã€‚ 3ã€nginx.confæ–‡ä»¶æˆ‘ä»¬æŠŠæ•´ä¸ªå…¨å±€é…ç½®æ–‡ä»¶æ‹¿å‡ºæ¥åˆ†æä¸€ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031user nginx;worker_processes 16;error_log /var/log/nginx/error.log warn;pid /var/run/nginx.pid;events &#123; worker_connections 1024;&#125;http &#123; include /etc/nginx/mime.types; default_type application/octet-stream; log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27; &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27; &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf;&#125; 3.1 useruseræŒ‡çš„æ˜¯ä»¥å“ªä¸ªç”¨æˆ·æ¥åˆ›å»ºnginxçš„workerè¿›ç¨‹ï¼Œmasterè¿›ç¨‹ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨rootç”¨æˆ·å¯åŠ¨ï¼Œæƒé™è¾ƒå¤§ã€‚ 3.2 worker_processesworker_processesåˆ™æ˜¯nginxçš„workerè¿›ç¨‹æ•°é‡ï¼Œä¸€èˆ¬ä¸CPUçš„æ ¸å¿ƒæ•°é‡ä¸€è‡´ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸º16ã€‚ 3.3 error_logerror_logæ˜¯æ—¥å¿—çš„å­˜æ”¾ä½ç½®å’Œè¾“å‡ºç­‰çº§ï¼Œç­‰çº§çš„å–å€¼èŒƒå›´æ˜¯debugã€infoã€noticeã€warnã€errorã€critã€alertã€emergï¼Œä»å·¦è‡³å³çº§åˆ«ä¾æ¬¡å¢å¤§ã€‚å½“è®¾å®šä¸ºä¸€ä¸ªçº§åˆ«æ—¶ï¼Œå¤§äºæˆ–ç­‰äºè¯¥çº§åˆ«çš„æ—¥å¿—éƒ½ä¼šè¢«è¾“å‡ºåˆ°è®°å½•æ–‡ä»¶ä¸­ï¼Œå°äºè¯¥çº§åˆ«çš„æ—¥å¿—åˆ™ä¸ä¼šè¾“å‡ºã€‚è¿™é‡Œé»˜è®¤è®¾å®šçš„æ˜¯warnçº§åˆ«ï¼Œåˆ™warnã€errorã€critã€alertã€emergçº§åˆ«çš„æ—¥å¿—éƒ½ä¼šè¾“å‡ºã€‚ å¦‚æœè®¾å®šçš„æ—¥å¿—çº§åˆ«æ˜¯debugï¼Œåˆ™ä¼šè¾“å‡ºæ‰€æœ‰çš„æ—¥å¿—ï¼Œè¿™æ ·æ•°æ®é‡ä¼šå¾ˆå¤§ï¼Œè¦ç¡®ä¿å­˜æ”¾æ—¥å¿—çš„ç¡¬ç›˜æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼ŒåŒæ—¶ï¼Œå¦‚æœéœ€è¦å¼€å¯æ—¥å¿—çš„debugåŠŸèƒ½ï¼Œéœ€è¦åœ¨ç¼–è¯‘å®‰è£…çš„æ—¶å€™åœ¨configureæ—¶åŠ å…¥--with-debugé…ç½®é¡¹ï¼Œå¦‚æœä¸ç¡®å®šæ˜¯å¦å¼€å¯äº†debugåŠŸèƒ½ï¼Œå¯ä»¥è¾“å…¥nginx -VæŸ¥çœ‹æ‰€æœ‰çš„configure argumentsã€‚ 3.4 pidpidæ˜¯nginxçš„masterè¿›ç¨‹çš„pidæ–‡ä»¶ï¼Œç†è®ºä¸Šåº”è¯¥å’ŒæŸ¥æ‰¾çš„nginxè¿›ç¨‹ä¸­masterè¿›ç¨‹çš„PIDä»¥åŠworkerè¿›ç¨‹çš„PPIDä¸€è‡´ã€‚ 3.5 å—é…ç½®æ¥ä¸‹æ¥çš„eventså’Œhttpéƒ½æ˜¯å±äºæ¨¡å—æˆ–è€…å—ã€‚æœ€åŸºæœ¬çš„é…ç½®é¡¹è¯­æ³•æ ¼å¼ä¸ºé…ç½®é¡¹å é…ç½®é¡¹å€¼1 é…ç½®é¡¹å€¼2 â€¦ ; ä¸€ä¸ªé…ç½®é¡¹ä»¥è‹±æ–‡åˆ†å·;ç»“æŸï¼Œä¸­é—´çš„å€¼ä½¿ç”¨ç©ºæ ¼éš”å¼€ å—é…ç½®é¡¹ç”±ä¸€ä¸ªå—é…ç½®é¡¹åå’Œä¸€å¯¹å¤§æ‹¬å·ç»„æˆã€‚ å—é…ç½®é¡¹å¯ä»¥åµŒå¥—ï¼Œå†…å±‚å—ç›´æ¥ç»§æ‰¿å¤–å±‚å—ã€‚ å½“å†…å¤–å±‚å—ä¸­çš„é…ç½®å‘ç”Ÿå†²çªæ—¶ï¼Œç©¶ç«Ÿæ˜¯ä»¥å†…å±‚å—è¿˜æ˜¯å¤–å±‚å—çš„é…ç½®ä¸ºå‡†ï¼Œå–å†³äºè§£æè¿™ä¸ªé…ç½®é¡¹çš„æ¨¡å—ã€‚ æ³¨é‡Šéƒ¨åˆ†ä½¿ç”¨äº•å·ï¼ƒ æ¯”å¦‚ä¸Šé¢çš„log_formatè¿™ä¸ªé…ç½®é¡¹ï¼Œå˜é‡éœ€è¦åœ¨å‰é¢åŠ ä¸Šç¾åˆ€ç¬¦å·$ï¼Œå¦‚æœå˜é‡ä¹‹é—´æœ‰ç©ºæ ¼ï¼Œéœ€è¦ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·é¿å…è¯­æ³•é”™è¯¯ï¼ŒåŒæ—¶å¼•å·å¯ä»¥åµŒå¥—ä½¿ç”¨ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ¨¡å—éƒ½æ”¯æŒä½¿ç”¨å˜é‡ã€‚ 123log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27; &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27; &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;; 3.6 å•ä½å½“æŒ‡å®šç©ºé—´å¤§å°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨çš„å•ä½åŒ…æ‹¬ï¼š Kæˆ–è€…kåƒå­—èŠ‚ï¼ˆKiloByteï¼ŒKBï¼‰ Mæˆ–è€…må…†å­—èŠ‚ï¼ˆMegaByteï¼ŒMBï¼‰ å½“æŒ‡å®šæ—¶é—´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨çš„å•ä½åŒ…æ‹¬ï¼š msï¼ˆæ¯«ç§’ï¼‰ sï¼ˆç§’ï¼‰ mï¼ˆåˆ†é’Ÿï¼‰ hï¼ˆå°æ—¶ï¼‰ dï¼ˆå¤©ï¼‰ wï¼ˆå‘¨ï¼Œ7å¤©ï¼‰ Mï¼ˆæœˆï¼Œ30å¤©ï¼‰ yï¼ˆå¹´ï¼Œ365å¤©ï¼‰ å•ä½ä¹‹é—´æ”¯æŒæ··åˆä½¿ç”¨ï¼Œå¦‚1h30må³ä¸º90må¦‚æœä¸æŒ‡å®šåç¼€ï¼Œé‚£ä¹ˆé»˜è®¤ä½¿ç”¨sï¼ˆç§’ï¼‰ä½œä¸ºå•ä½ã€‚ é…ç½®é¡¹åçš„å€¼ç©¶ç«Ÿæ˜¯å¦å¯ä»¥ä½¿ç”¨è¿™äº›å•ä½ï¼Œå–å†³äºè§£æè¯¥é…ç½®é¡¹çš„æ¨¡å—ã€‚å¦‚æœè¿™ä¸ªæ¨¡å—ä½¿ç”¨äº†Nginxæ¡†æ¶æä¾›çš„ç›¸åº”è§£æé…ç½®é¡¹æ–¹æ³•ï¼Œé‚£ä¹ˆé…ç½®é¡¹å€¼æ‰å¯ä»¥æºå¸¦å•ä½ã€‚ 4ã€nginxé…ç½®é™æ€é¡µé¢æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•é…ç½®ä¸€ä¸ªç®€å•çš„é™æ€é¡µé¢ï¼Œä½¿ç”¨vimå¯¹/etc/nginx/conf.d/default.confè¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤æƒ…å†µä¸‹/etc/nginx/conf.d/ä¸‹é¢çš„é…ç½®æ–‡ä»¶åªè¦æ˜¯.confå³å¯ç”Ÿæ•ˆï¼Œå‰é¢çš„åç§°å¹¶æ²¡æœ‰ç‰¹æ®Šé™åˆ¶ï¼Œæ‰€ä»¥æœ€å¥½æ ¹æ®æ–‡ä»¶çš„å®é™…ç”¨é€”è¿›è¡Œå‘½åæ–¹ä¾¿è®°å¿†å’Œç®¡ç†ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨/etc/hostsä¸­å°† www.example.com www.example.org www.example.net example.com example.org example.netçš„DNSè§£ææ‰‹åŠ¨æŒ‡å®šä¸ºæœ¬æœºIPåœ°å€ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨åŸŸåè¿›è¡Œé…ç½®é¡µé¢ 4.1 default_server12345678910111213141516171819202122232425262728293031323334[root@localhost conf.d]# llæ€»ç”¨é‡ 16-rw-r--r-- 1 root root 1093 3æœˆ 4 00:20 default.conf.bak-rw-r--r-- 1 root root 158 3æœˆ 18 00:08 example.com.conf-rw-r--r-- 1 root root 158 3æœˆ 18 00:09 example.net.conf-rw-r--r-- 1 root root 173 3æœˆ 18 00:11 example.org.conf[root@localhost conf.d]# cat example.*server &#123; listen 80; server_name example.com www.example.com; location / &#123; root /var/www/html; index example.com.html; &#125;&#125;server &#123; listen 80; server_name example.net www.example.net; location / &#123; root /var/www/html; index example.net.html; &#125;&#125;server &#123; listen 80 default_server; server_name example.org www.example.org; location / &#123; root /var/www/html; index example.org.html; &#125;&#125; è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢é…ç½®äº†ä¸‰ä¸ªserverå—ï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ç»„åŸŸåï¼Œä¸‰ç»„åŸŸåéƒ½æ˜¯æŒ‡å‘æœ¬æœºçš„IPåœ°å€ï¼ŒåŒæ ·éƒ½æ˜¯ç›‘å¬çš„80ç«¯å£ï¼Œå…¶ä¸­æˆ‘ä»¬åœ¨ç¬¬ä¸‰ä¸ªserverå—ä¸­æŒ‡å®šäº†default_serverå‚æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬è®¿é—®æœ¬æœºIPï¼Œè¿”å›çš„é¡µé¢å°±æ˜¯æˆ‘ä»¬æŒ‡å®šäº†default_serverå‚æ•°çš„è¿™ä¸ªé¡µé¢ã€‚ å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šdefault_serverå‚æ•°ï¼Œè¿”å›çš„åˆ™æ˜¯é»˜è®¤çš„ç¬¬ä¸€ä¸ªé¡µé¢ã€‚ 4.2 locationlocationå—çš„é»˜è®¤è¯­æ³•å¦‚ä¸‹ï¼Œå®˜ç½‘æ–‡æ¡£ç‚¹è¿™é‡Œã€‚ 1234Syntax: location [ = | ~ | ~* | ^~ ] uri &#123; ... &#125;location @name &#123; ... &#125;Default: â€”Context: server, location ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®è¯·æ±‚URIè®¾ç½®é…ç½®ï¼Œlocationå¯ä»¥ç”±å‰ç¼€å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰ã€‚ æ­£åˆ™è¡¨è¾¾å¼ç”±å‰é¢çš„~*ä¿®é¥°ç¬¦ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰æˆ–~ä¿®é¥°ç¬¦ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰æŒ‡å®šã€‚ ä¼˜å…ˆé¡ºåºæ˜¯ï¼Œnginxé¦–å…ˆæ£€æŸ¥ä½¿ç”¨å‰ç¼€å­—ç¬¦ä¸²å®šä¹‰çš„ä½ç½®ï¼ˆå‰ç¼€ä½ç½®ï¼‰ï¼Œå…¶ä¸­ï¼Œå°†é€‰æ‹©å¹¶è®°ä½å…·æœ‰æœ€é•¿åŒ¹é…å‰ç¼€çš„ä½ç½®ã€‚ ç„¶åæŒ‰ç…§åœ¨é…ç½®æ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ£€æŸ¥æ­£åˆ™è¡¨è¾¾å¼ã€‚ æ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢åœ¨ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ä¸Šç»ˆæ­¢ï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„é…ç½®ã€‚ å¦‚æœæœªæ‰¾åˆ°ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ï¼Œåˆ™ä½¿ç”¨å‰é¢è®°ä½çš„å‰ç¼€ä½ç½®çš„é…ç½®ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ä¾‹ï¼š 12345678910111213server &#123; listen 80; server_name example.com www.example.com; location / &#123; root /var/www/html; index example.com.html; &#125; location /images &#123; root /var/www; &#125;&#125; æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªserverå—ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡Œé¢åŒ…å«äº†ä¸¤ä¸ªlocationå—ï¼Œåœ¨/var/www/htmlå’Œ/var/wwwè¿™ä¸¤ä¸ªç›®å½•ä¸‹å‡æœ‰ä¸€ä¸ªimagesæ–‡ä»¶å¤¹ï¼Œä½†æ˜¯åœ¨wwwç›®å½•ä¸‹çš„imagesæ–‡ä»¶å¤¹æ²¡æœ‰images2.htmlè¿™ä¸ªæ–‡ä»¶ã€‚ æ¥ç€æˆ‘ä»¬å°è¯•è®¿é—®ï¼š å¯ä»¥çœ‹åˆ°å› ä¸ºæˆ‘ä»¬åœ¨wwwç›®å½•ä¸‹çš„imagesæ–‡ä»¶å¤¹æ²¡æœ‰images2.htmlè¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œcurl example.com/images/images2.htmlçš„æ—¶å€™è¿”å›äº†404è¯·æ±‚ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç»“è®ºï¼Œå½“è®¿é—®åŸŸååé¢çš„ç›®å½•ï¼ˆå¦‚è¿™é‡Œçš„/images/ï¼‰ï¼Œå¦‚æœåœ¨serverå—é‡Œé¢å•ç‹¬å®šä¹‰äº†ä¸€ä¸ªç›¸å…³çš„locationå—ï¼Œåˆ™åªä¼šåœ¨è¿™ä¸ª/images/ç›®å½•ç›¸å…³locationå—å®šä¹‰çš„ç›®å½•ä¸­å»æŸ¥æ‰¾ï¼Œä¸å­˜åœ¨åˆ™è¿”å›404ï¼Œå¹¶ä¸ä¼šå†å»æ ¹ç›®å½•/çš„locationå—ä¸­çš„ç›®å½•ä¸­æŸ¥æ‰¾ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"è™šæ‹ŸåŒ–æŠ€æœ¯çš„æ¼”å˜è¿‡ç¨‹å’ŒKVMè™šæ‹ŸåŒ–çš„ç®€ä»‹","slug":"20200301-virtualization-intro-kvm-intro","date":"2020-03-01T03:00:00.000Z","updated":"2020-03-01T03:00:00.000Z","comments":true,"path":"20200301-virtualization-intro-kvm-intro/","link":"","permalink":"https://tinychen.com/20200301-virtualization-intro-kvm-intro/","excerpt":"ä¸»è¦ä»‹ç»è™šæ‹ŸåŒ–æŠ€æœ¯çš„å†å²æ¼”è¿›è¿‡ç¨‹å’ŒKVMè™šæ‹ŸåŒ–çš„ä¸€äº›ç‰¹ç‚¹ã€‚","text":"ä¸»è¦ä»‹ç»è™šæ‹ŸåŒ–æŠ€æœ¯çš„å†å²æ¼”è¿›è¿‡ç¨‹å’ŒKVMè™šæ‹ŸåŒ–çš„ä¸€äº›ç‰¹ç‚¹ã€‚ 0ã€ç®€ä»‹è™šæ‹ŸåŒ–æŠ€æœ¯çš„æ¼”å˜è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºè½¯ä»¶æ¨¡æ‹Ÿã€è™šæ‹ŸåŒ–å±‚ç¿»è¯‘ã€å®¹å™¨è™šæ‹ŸåŒ–ä¸‰ä¸ªå¤§çš„é˜¶æ®µã€‚å…¶ä¸­ï¼Œè™šæ‹ŸåŒ–å±‚ç¿»è¯‘åˆå¯ä»¥åˆ†ä¸ºï¼šè½¯ä»¶æ•è·ç¿»è¯‘ï¼ˆè½¯ä»¶å…¨è™šæ‹ŸåŒ–ï¼‰ã€æ”¹é€ è™šæ‹Ÿæœºç³»ç»Ÿå†…æ ¸åŠ è™šæ‹ŸåŒ–å±‚ç¿»è¯‘ï¼ˆåŠè™šæ‹ŸåŒ–ï¼‰å’Œç¡¬ä»¶æ”¯æŒçš„è™šæ‹ŸåŒ–å±‚ç¿»è¯‘ï¼ˆç¡¬ä»¶æ”¯æŒçš„å…¨è™šæ‹ŸåŒ–ï¼‰ä¸‰ç§ã€‚ 1ã€è½¯ä»¶æ¨¡æ‹Ÿè½¯ä»¶æ¨¡æ‹Ÿæ˜¯é€šè¿‡è½¯ä»¶å®Œå…¨æ¨¡æ‹ŸCPUã€èŠ¯ç‰‡ç»„ã€ç£ç›˜ã€ç½‘å¡ç­‰è®¡ç®—æœºç¡¬ä»¶ã€‚å› ä¸ºæ˜¯è½¯ä»¶æ¨¡æ‹Ÿï¼Œæ‰€ä»¥ç†è®ºä¸Šå¯ä»¥æ¨¡æ‹Ÿä»»ä½•ç¡¬ä»¶ï¼Œç”šè‡³æ˜¯ä¸å­˜åœ¨çš„ç¡¬ä»¶ã€‚ä½†æ˜¯å› ä¸ºè¿™ç§æ–¹å¼å…¨éƒ¨æ˜¯è½¯ä»¶æ¨¡æ‹Ÿç¡¬ä»¶ï¼Œæ‰€ä»¥éå¸¸ä½æ•ˆï¼Œæ€§èƒ½å¾ˆå·®ï¼Œå› æ­¤ä¸€èˆ¬åªç”¨äºç ”ç©¶æµ‹è¯•çš„åœºæ™¯ã€‚é‡‡ç”¨è¿™ç§æŠ€æœ¯çš„å…¸å‹äº§å“æœ‰Bochsã€QEMUç­‰ã€‚ 2ã€è™šæ‹ŸåŒ–å±‚ç¿»è¯‘X86å¹³å°æŒ‡ä»¤é›†åˆ’åˆ†ä¸º4ä¸ªç‰¹æƒæ¨¡å¼ï¼šRing 0ã€Ring 1ã€Ring 2ã€Ring 3ã€‚æ“ä½œç³»ç»Ÿä¸€èˆ¬ä½¿ç”¨Ring 0çº§åˆ«ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨Ring 3çº§åˆ«ï¼Œé©±åŠ¨ç¨‹åºä½¿ç”¨Ring 1å’ŒRing 2çº§åˆ«ã€‚X86å¹³å°åœ¨è™šæ‹ŸåŒ–æ–¹é¢çš„ä¸€ä¸ªéš¾ç‚¹å°±æ˜¯å¦‚ä½•å°†è™šæ‹Ÿæœºè¶Šçº§çš„æŒ‡ä»¤ä½¿ç”¨è¿›è¡Œéš”ç¦»ã€‚ 2.1 è½¯ä»¶å…¨è™šæ‹ŸåŒ–VMwareå…¬å¸é¦–å…ˆæƒ³åˆ°äº†é€šè¿‡è™šæ‹ŸåŒ–å¼•æ“ï¼Œæ•è·è™šæ‹Ÿæœºçš„æŒ‡ä»¤ï¼Œå¹¶è¿›è¡Œå¤„ç†çš„è§£å†³æ–¹æ³•ã€‚ é€šè¿‡è™šæ‹ŸåŒ–å¼•æ“VMMæ¥å¯¹è™šæ‹Ÿæœºä¸Šçš„æŒ‡ä»¤è¿›è¡Œæ•è·å¹¶è§£é‡Šæ‰§è¡Œï¼Œå°±å¯ä»¥æœ‰æ•ˆåœ°éš”ç¦»å¼€è™šæ‹Ÿæœºå’Œç‰©ç†æœºä¸Šçš„æ“ä½œï¼Œæœ€å¸¸è§çš„è¡¨ç°å°±æ˜¯å…³é—­è™šæ‹Ÿæœºå¹¶ä¸ä¼šå…³é—­ç‰©ç†æœºã€‚è¿™ç§æ–¹æ¡ˆä¹Ÿå› æ­¤å«åšè½¯ä»¶å…¨è™šæ‹ŸåŒ–çš„è§£å†³æ–¹æ¡ˆã€‚ Hypervisorï¼Œåˆç§°è™šæ‹Ÿæœºç›‘è§†å™¨ï¼ˆè‹±è¯­ï¼švirtual machine monitorï¼Œç¼©å†™ä¸º VMMï¼‰ï¼Œæ˜¯ç”¨æ¥å»ºç«‹ä¸æ‰§è¡Œè™šæ‹Ÿæœºå™¨çš„è½¯ä»¶ã€å›ºä»¶æˆ–ç¡¬ä»¶ã€‚ è¢«Hypervisorç”¨æ¥æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿæœºå™¨çš„ç”µè„‘ç§°ä¸ºä¸»ä½“æœºå™¨/å®¿ä¸»æœº/ç‰©ç†æœºï¼ˆhost machineï¼‰ï¼Œè¿™äº›è™šæ‹Ÿæœºå™¨åˆ™ç§°ä¸ºå®¢ä½“æœºå™¨/è™šæ‹Ÿæœºï¼ˆguest machineï¼‰ã€‚hypervisoræä¾›è™šæ‹Ÿçš„ä½œä¸šå¹³å°æ¥æ‰§è¡Œå®¢ä½“æ“ä½œç³»ç»Ÿï¼ˆguest operating systemsï¼‰ï¼Œè´Ÿè´£ç®¡ç†å…¶ä»–å®¢ä½“æ“ä½œç³»ç»Ÿçš„æ‰§è¡Œé˜¶æ®µï¼›è¿™äº›å®¢ä½“æ“ä½œç³»ç»Ÿï¼Œå…±åŒåˆ†äº«è™šæ‹ŸåŒ–åçš„ç¡¬ä»¶èµ„æºã€‚ 2.2 åŠè™šæ‹ŸåŒ–è½¯ä»¶å…¨è™šæ‹ŸåŒ–çš„è§£å†³æ–¹æ¡ˆè™½ç„¶å¯è¡Œï¼Œä½†æ˜¯ç”±äºæŒ‡ä»¤éœ€è¦ç»è¿‡VMMï¼Œæ‰€ä»¥è¦åœ¨è™šæ‹ŸåŒ–å±‚åšå¤§é‡çš„å·¥ä½œï¼Œæ€§èƒ½ä¸Šæ¯”è¾ƒä¸€èˆ¬ï¼Œå› æ­¤Xené¡¹ç›®æå‡ºäº†ä½¿ç”¨ä¿®æ”¹è™šæ‹Ÿæœºæ“ä½œç³»ç»Ÿå†…æ ¸çš„è§£å†³æ–¹æ¡ˆã€‚å…·ä½“æ¥è¯´å°±æ˜¯åœ¨è™šæ‹Ÿæœºä¸Šä½¿ç”¨ä¿®æ”¹è¿‡çš„å†…æ ¸ï¼Œåœ¨ä¿®æ”¹è¿‡çš„å†…æ ¸ä¸­å¯¹ç‰¹æ®ŠæŒ‡ä»¤è¿›è¡Œä¿®æ”¹ä½¿å…¶ä¸ç‰©ç†æœºéš”ç¦»å¼€æ¥ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘è™šæ‹ŸåŒ–å±‚çš„å·¥ä½œï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ä½†æ˜¯åŠ£åŠ¿ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œç”±äºéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„å†…æ ¸ï¼Œå› æ­¤åœ¨é…ç½®ä¸Šä¹Ÿä¼šç›¸å¯¹éº»çƒ¦ä¸€äº›ï¼Œä¸”ç”±äºå†…æ ¸åŸå› ä¸€å¼€å§‹ä¸æ”¯æŒwindowsç³»ç»Ÿçš„è™šæ‹ŸåŒ–ï¼Œç›´åˆ°åæ¥æ‰åŠ å…¥æ”¯æŒã€‚ ä¸è¿‡ç”±äºå°†ä¸€éƒ¨åˆ†çš„æŒ‡ä»¤ç¿»è¯‘å·¥ä½œä»è™šæ‹ŸåŒ–å±‚è½¬ç§»åˆ°äº†ä¿®æ”¹è¿‡çš„å†…æ ¸å½“ä¸­ï¼Œå› æ­¤æ€§èƒ½æ¯”ä¸Šé¢æåˆ°çš„è½¯ä»¶å…¨è™šæ‹ŸåŒ–è¦é«˜å¾ˆå¤šï¼Œè¿™ç§è™šæ‹ŸåŒ–æ–¹å¼ä¹Ÿç§°ä¸ºåŠè™šæ‹ŸåŒ–ï¼ˆparavirtualizationï¼‰æˆ–è€…æ˜¯å‡†è™šæ‹ŸåŒ–ã€‚ 2.3 ç¡¬ä»¶å…¨è™šæ‹ŸåŒ–2005å¹´ï¼ŒIntelæ¨å‡ºäº†ç¡¬ä»¶çš„æ–¹æ¡ˆï¼Œå¯¹CPUæŒ‡ä»¤è¿›è¡Œæ”¹é€ ï¼Œå³VT-xï¼Œå¦‚å›¾1-5æ‰€ç¤ºã€‚VT-xå¢åŠ äº†ä¸¤ç§æ“ä½œæ¨¡å¼ï¼šVMX root operationå’ŒVMX non-root operationã€‚VMMè¿è¡Œåœ¨VMX root operationæ¨¡å¼ï¼Œè™šæ‹Ÿæœºè¿è¡Œåœ¨VMX non-root operationæ¨¡å¼ã€‚è¿™ä¸¤ç§æ“ä½œæ¨¡å¼éƒ½æ”¯æŒRing 0ï½Ring 3è¿™4ä¸ªç‰¹æƒçº§ã€‚ 2005å¹´ï¼Œéšç€Intelæ¨å‡ºæ”¯æŒx86è™šæ‹ŸåŒ–æŠ€æœ¯çš„CPUï¼ŒXenäº¦åŠ å…¥å…¨è™šæ‹ŸåŒ–æ¨¡å¼ã€‚Xençš„å…¨è™šæ‹ŸåŒ–æ¨¡å¼å…è®¸åœ¨è™šæ‹Ÿæœºä¸­è¿è¡ŒWindowsç­‰éLinuxç³»ç»Ÿã€‚ å› ä¸ºæ˜¯åŸºäºç¡¬ä»¶çš„ï¼Œæ‰€ä»¥æ•ˆç‡éå¸¸é«˜ï¼Œè¿™ç§æ–¹æ¡ˆä¹Ÿç§°ä¸ºç¡¬ä»¶æ”¯æŒçš„å…¨è™šæ‹ŸåŒ–æ–¹æ¡ˆã€‚ç°åœ¨çš„ä¸€ä¸ªå‘å±•è¶‹åŠ¿æ˜¯ä¸ä»…CPUæŒ‡ä»¤æœ‰ç¡¬ä»¶è§£å†³æ–¹æ¡ˆï¼ŒI/Oé€šä¿¡ä¹Ÿæœ‰ç¡¬ä»¶è§£å†³æ–¹æ¡ˆï¼Œç§°ä¸ºVT-dï¼›ç½‘ç»œé€šä¿¡ä¹Ÿæœ‰ç¡¬ä»¶è§£å†³æ–¹æ¡ˆï¼Œç§°ä¸ºVT-cã€‚ é™¤äº†Intelï¼ŒAMDä¹Ÿåœ¨è‡ªå®¶çš„å¤„ç†å™¨ä¸ŠåŠ å…¥äº†å¯¹ç¡¬ä»¶çº§è™šæ‹ŸåŒ–çš„æ”¯æŒï¼Œå‘½åä¸ºAMD-vã€‚ å½“å‰çš„è™šæ‹ŸåŒ–å¼•æ“ï¼Œéƒ½æ˜¯ä½¿ç”¨ç¡¬ä»¶æ”¯æŒçš„è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚å¹¶ä¸”æœ€æ–°çš„æ“ä½œç³»ç»Ÿä¸€èˆ¬éƒ½æ”¯æŒä¸€äº›åŠè™šæ‹ŸåŒ–çš„ç‰¹æ€§ï¼Œæ‰€ä»¥å®¿ä¸»æœºå’Œè™šæ‹Ÿæœºä½¿ç”¨æ¯”è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œæ€§èƒ½ä¹Ÿä¼šå¥½ä¸€äº›ã€‚ 3ã€å®¹å™¨è™šæ‹ŸåŒ–å®¹å™¨è™šæ‹ŸåŒ–çš„åŸç†æ˜¯åŸºäºCGroupsã€Namespaceç­‰æŠ€æœ¯å°†è¿›ç¨‹éš”ç¦»ï¼Œæ¯ä¸ªè¿›ç¨‹å°±åƒä¸€å°å•ç‹¬çš„è™šæ‹Ÿæœºä¸€æ ·ï¼Œæœ‰è‡ªå·±è¢«éš”ç¦»å‡ºæ¥çš„èµ„æºï¼Œä¹Ÿæœ‰è‡ªå·±çš„æ ¹ç›®å½•ã€ç‹¬ç«‹çš„è¿›ç¨‹ç¼–å·ã€è¢«éš”ç¦»çš„å†…å­˜ç©ºé—´ã€‚åŸºäºå®¹å™¨çš„è™šæ‹ŸåŒ–å¯ä»¥å®ç°åœ¨å•ä¸€å†…æ ¸ä¸Šè¿è¡Œå¤šä¸ªå®ä¾‹ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªæ›´é«˜æ•ˆç‡çš„è™šæ‹ŸåŒ–æ–¹å¼ã€‚ç›®å‰åŸºäºDocker+k8sçš„å®¹å™¨çº§è™šæ‹ŸåŒ–æŠ€æœ¯å·²ç»åœ¨å›½å†…è®¸å¤šäº’è”ç½‘å…¬å¸çš„ç”Ÿäº§ç¯å¢ƒä¸­å¤§é‡ä½¿ç”¨ã€‚ 4ã€KVMè™šæ‹ŸåŒ–4.1 kvmç®€ä»‹KVMï¼ˆKernel-based Virtual Machineï¼‰æœ€åˆæ˜¯ç”±ä»¥è‰²åˆ—çš„å…¬å¸Qumranetå¼€å‘çš„ã€‚KVMåœ¨2007å¹´2æœˆè¢«æ­£å¼åˆå¹¶åˆ°Linux 2.6.20æ ¸å¿ƒä¸­ï¼Œæˆä¸ºå†…æ ¸æºä»£ç çš„ä¸€éƒ¨åˆ†ã€‚2008å¹´9æœˆ4æ—¥ï¼ŒRedHatå…¬å¸æ”¶è´­äº†Qumranetï¼Œå¼€å§‹åœ¨RHELä¸­ç”¨KVMæ›¿æ¢Xenï¼Œç¬¬ä¸€ä¸ªåŒ…å«KVMçš„ç‰ˆæœ¬æ˜¯RHEL 5.4ã€‚ä»RHEL 6å¼€å§‹ï¼ŒKVMæˆä¸ºé»˜è®¤çš„è™šæ‹ŸåŒ–å¼•æ“ã€‚KVMå¿…é¡»åœ¨å…·å¤‡Intel VTæˆ–AMD-VåŠŸèƒ½çš„X86å¹³å°ä¸Šè¿è¡Œã€‚åœ¨Linuxå†…æ ¸3.9ç‰ˆä¸­ï¼ŒåŠ å…¥äº†å¯¹ARMæ¶æ„çš„æ”¯æŒã€‚ å…·ä½“kvmè™šæ‹ŸåŒ–æ”¯æŒçš„å¤„ç†å™¨å¯ä»¥é€šè¿‡å®˜ç½‘è¿›è¡ŒæŸ¥è¯¢ã€‚ KVMåŒ…å«ä¸€ä¸ªä¸ºå¤„ç†å™¨æä¾›åº•å±‚è™šæ‹ŸåŒ–ã€å¯åŠ è½½çš„æ ¸å¿ƒæ¨¡å—kvm.koï¼ˆkvm-intel.koæˆ–kvm-amd.koï¼‰ï¼Œä½¿ç”¨QEMUï¼ˆQEMU-KVMï¼‰ä½œä¸ºè™šæ‹Ÿæœºä¸Šå±‚æ§åˆ¶å·¥å…·ã€‚KVMä¸éœ€è¦æ”¹å˜Linuxæˆ–Windowsç³»ç»Ÿå°±èƒ½è¿è¡Œã€‚ å®é™…ä¸Šï¼Œåœ¨Linuxä¸­ï¼Œkvmå°±æ˜¯å†…æ ¸ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨æˆ·ç©ºé—´é€šè¿‡QEMUæ¨¡æ‹Ÿç¡¬ä»¶æä¾›ç»™è™šæ‹Ÿæœºä½¿ç”¨ï¼Œè€Œä¸€å°ä½¿ç”¨kvmåˆ›å»ºçš„è™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªLinuxä¸­çš„è¿›ç¨‹ï¼Œç®¡ç†è¿™ä¸ªå¯¹åº”çš„è¿›ç¨‹å°±æ˜¯ç›¸å½“äºç®¡ç†æ•´ä¸ªå¯¹åº”çš„è™šæ‹Ÿæœºã€‚ 4.2 QEMUå’ŒKVM ä»¥ä¸‹æ‘˜å½•è‡ªwikiï¼š QEMUæœ‰å¤šç§æ¨¡å¼ User modï¼šåˆç§°ä½œâ€œä½¿ç”¨è€…æ¨¡å¼â€ï¼Œåœ¨è¿™ç§æ¨¡å—ä¸‹ï¼ŒQEMUè¿è¡Œé’ˆå¯¹ä¸åŒæŒ‡ä»¤ç¼–è¯‘çš„å•ä¸ªLinuxæˆ–Darwin/macOSç¨‹åºã€‚ç³»ç»Ÿè°ƒç”¨ä¸32/64ä½æ¥å£é€‚åº”ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°äº¤å‰ç¼–è¯‘ï¼ˆcross-compilationï¼‰ä¸äº¤å‰åµé”™ï¼ˆcross- debuggingï¼‰ã€‚ System modï¼šâ€œç³»ç»Ÿæ¨¡å¼â€ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒQEMUæ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„è®¡ç®—æœºç³»ç»Ÿï¼ŒåŒ…æ‹¬å¤–å›´è®¾å¤‡ã€‚å®ƒå¯ä»¥ç”¨äºåœ¨ä¸€å°è®¡ç®—æœºä¸Šæä¾›å¤šå°è™šæ‹Ÿè®¡ç®—æœºçš„è™šæ‹Ÿä¸»æœºã€‚ QEMUå¯ä»¥å®ç°è®¸å¤šå®¢æˆ·æœºOSçš„å¼•å¯¼ï¼Œæ¯”å¦‚x86ï¼ŒMIPSï¼Œ32-bit ARMv7ï¼ŒPowerPCç­‰ç­‰ã€‚ KVM Hostingï¼šQEMUåœ¨è¿™æ—¶å¤„ç†KVMé•œåƒçš„è®¾ç½®ä¸è¿ç§»ï¼Œå¹¶å‚åŠ ç¡¬ä»¶çš„ä»¿çœŸï¼Œä½†æ˜¯å®¢æˆ·ç«¯çš„æ‰§è¡Œåˆ™ç”±KVMå®Œæˆã€‚ Xen Hostingï¼šåœ¨è¿™ç§æ‰˜ç®¡ä¸‹ï¼Œå®¢æˆ·ç«¯çš„æ‰§è¡Œå‡ ä¹å®Œå…¨åœ¨Xenä¸­å®Œæˆï¼Œå¹¶ä¸”å¯¹QEMUå±è”½ã€‚QEMUåªæä¾›ç¡¬ä»¶ä»¿çœŸçš„æ”¯æŒã€‚ å‰é¢æˆ‘ä»¬æåˆ°è¿‡QEMUçš„æ¶æ„æ˜¯çº¯è½¯ä»¶å®ç°çš„ï¼Œå› æ­¤çµæ´»æ€§å¾ˆå¼ºï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ï¼Œå› æ­¤å¯ä»¥æ­é…KVMæ¨¡å—ä½¿ç”¨ä»è€Œæœ‰æ•ˆåœ°æå‡æ€§èƒ½è¡¨ç°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„QEMU-KVMï¼Œæ­¤æ—¶çš„QEMUè¿è¡Œåœ¨ä¸Šé¢æåˆ°çš„KVM Hostingæ¨¡å¼ä¸‹ï¼Œå¤„ç†KVMé•œåƒçš„è®¾ç½®ä¸è¿ç§»ï¼Œå¹¶å‚åŠ ç¡¬ä»¶çš„ä»¿çœŸï¼Œå¯ä»¥å­˜å‚¨åŠè¿˜åŸè™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€ï¼Œè¿˜å¯ä»¥è™šæ‹Ÿå¤šç§è®¾å¤‡ï¼ŒåŒ…æ‹¬ç½‘å¡ã€å¤šCPUã€IDEè®¾å¤‡ã€è½¯é©±ã€æ˜¾å¡ã€å£°å¡ã€å¤šç§å¹¶å£è®¾å¤‡ã€å¤šç§ä¸²å£è®¾å¤‡ã€å¤šç§USBè®¾å¤‡ã€PCå–‡å­ã€PS/2é”®ç›˜é¼ æ ‡ï¼ˆé»˜è®¤ï¼‰å’ŒUSBé”®ç›˜é¼ æ ‡ã€è“ç‰™è®¾å¤‡ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çš„æ‰§è¡Œåˆ™ç”±KVMå®Œæˆã€‚ QEMU-KVMçš„åˆ†æ”¯ç‰ˆæœ¬å‘å¸ƒäº†3ä¸ªæ­£å¼çš„ç‰ˆæœ¬1.1ã€1.2ã€1.3ï¼Œéšåå’ŒQEMUçš„ä¸»ç‰ˆæœ¬åˆå¹¶ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨çš„QEMUç‰ˆæœ¬é»˜è®¤æ”¯æŒKVMï¼Œè€ŒKVMçš„æœ€åä¸€ä¸ªè‡ªå·±çš„ç‰ˆæœ¬æ˜¯KVM 83ï¼Œéšåå’Œå†…æ ¸ç‰ˆæœ¬ä¸€èµ·å‘å¸ƒï¼Œå’Œå†…æ ¸ç‰ˆæœ¬å·ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥è¦ä½¿ç”¨KVMçš„æœ€æ–°ç‰ˆæœ¬ï¼Œå°±è¦ä½¿ç”¨æœ€æ–°çš„å†…æ ¸ã€‚ 4.3 Libvirtå’ŒKVMå‰é¢æˆ‘ä»¬æåˆ°ï¼ŒåŸºäºKVMçš„è™šæ‹Ÿæœºåœ¨Linuxä¸­å¯ä»¥è§†ä¸ºä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œçº¢å¸½å…¬å¸å‘å¸ƒäº†ä¸€ä¸ªå¼€æºé¡¹ç›®Libvirtï¼ŒLibvirtæœ‰APIï¼Œä¹Ÿæœ‰ä¸€å¥—å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥å®Œæˆå¯¹è™šæ‹Ÿæœºçš„ç®¡ç†ï¼Œå¤§å¤šæ•°çš„ç®¡ç†å¹³å°éƒ½æ˜¯é€šè¿‡Libvirtæ¥å®Œæˆå¯¹KVMè™šæ‹Ÿæœºçš„ç®¡ç†çš„ï¼Œæ¯”å¦‚OpenStackã€CloudStackã€OpenNebulaç­‰ã€‚ Libvirtä¸»è¦ç”±3éƒ¨åˆ†ç»„æˆï¼š ä¸€å¥—APIçš„libåº“ï¼Œæ”¯æŒä¸»æµçš„ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬Cã€Pythonã€Rubyç­‰ LibvirtdæœåŠ¡ å‘½ä»¤è¡Œå·¥å…·virsh Libvirtçš„è®¾è®¡ç›®æ ‡æ˜¯é€šè¿‡ç›¸åŒçš„æ–¹å¼ç®¡ç†ä¸åŒçš„è™šæ‹ŸåŒ–å¼•æ“ï¼Œä½†æ˜¯ç›®å‰å®é™…ä¸Šå¤šæ•°åœºæ™¯ä½¿ç”¨Libvirtçš„æ˜¯KVMã€‚Libvirtå¯ä»¥å®ç°å¯¹è™šæ‹Ÿæœºçš„ç®¡ç†ï¼Œæ¯”å¦‚è™šæ‹Ÿæœºçš„åˆ›å»ºã€å¯åŠ¨ã€å…³é—­ã€æš‚åœã€æ¢å¤ã€è¿ç§»ã€é”€æ¯ï¼Œä»¥åŠè™šæ‹Ÿæœºç½‘å¡ã€ç¡¬ç›˜ã€CPUã€å†…å­˜ç­‰å¤šç§è®¾å¤‡çš„çƒ­æ·»åŠ ã€‚Libvirtè¿˜å¯ä»¥é€šè¿‡SSHã€TCPã€åŸºäºTCPçš„TLSæ¥å®ç°è¿œç¨‹çš„å®¿ä¸»æœºç®¡ç†ã€‚ 4.4 KVMçš„ä¼˜åŠ¿KVMè™šæ‹ŸåŒ–çš„ä¸»è¦ä¼˜åŠ¿åœ¨æˆ‘çœ‹æ¥æœ‰ä¸‰ç‚¹ï¼š å¼€æºå…è´¹ kvmæ˜¯å¼€æºçš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯ä»¥å…è´¹ä½¿ç”¨çš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€æœ‰å¾ˆå¤šæ–°æŠ€æœ¯ä¼šå…ˆåœ¨kvmä¸Šå°é²œï¼Œå†æ¨å¹¿åˆ°å…¶ä»–çš„è™šæ‹ŸåŒ–å¹³å°ï¼Œè€Œä¸”å¯¹äºä¼ä¸šæ¥è¯´ï¼Œå…è´¹è¿™ä¸€å¯¹ä¸ªäººç”¨æˆ·è€Œè¨€æ„ŸçŸ¥ä¸å¼ºçš„ç‰¹æ€§å°±ä¼šè¢«æ”¾å¤§å¾ˆå¤šå€ï¼Œè¿™ä¹Ÿæ˜¯è¯¸å¦‚openstackç­‰äº‘å¹³å°ä½¿ç”¨kvmä½œä¸ºé¦–é€‰è™šæ‹ŸåŒ–çš„åŸå› ã€‚ æ€§èƒ½ä¼˜è¶Š åŒæ ·çš„ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œç›¸æ¯”èµ·è½¯ä»¶æ¨¡æ‹Ÿã€åŠè™šæ‹ŸåŒ–ç­‰ï¼Œkvmè™šæ‹ŸåŒ–å¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ç”šè‡³äºæ¥è¿‘ç‰©ç†æœºçš„æ€§èƒ½ã€‚ æ”¯æŒå¹¿æ³› é™¤äº†å¹¿æ³›çš„ç¤¾åŒºæŠ€æœ¯æ”¯æŒï¼Œè¿˜å¯ä»¥ä»˜è´¹è´­ä¹°çº¢å¸½å…¬å¸çš„æŠ€æœ¯æ”¯æŒã€‚","categories":[{"name":"â€Œvirtualization","slug":"â€Œvirtualization","permalink":"https://tinychen.com/categories/%E2%80%8Cvirtualization/"}],"tags":[{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"docker","slug":"docker","permalink":"https://tinychen.com/tags/docker/"},{"name":"kvm","slug":"kvm","permalink":"https://tinychen.com/tags/kvm/"}]},{"title":"Linuxä¸Šå¯ç”¨kvmåµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½","slug":"20200213-kvm-nested","date":"2020-02-13T02:00:00.000Z","updated":"2020-02-13T02:00:00.000Z","comments":true,"path":"20200213-kvm-nested/","link":"","permalink":"https://tinychen.com/20200213-kvm-nested/","excerpt":"kvmæ”¯æŒåµŒå¥—è™šæ‹ŸåŒ–ï¼Œå³å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­åˆ›å»ºè™šæ‹Ÿæœºã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨ä½¿ç”¨Intelå¤„ç†å™¨çš„CentOS7ä¸­å¼€å¯KVMçš„åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ã€‚","text":"kvmæ”¯æŒåµŒå¥—è™šæ‹ŸåŒ–ï¼Œå³å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­åˆ›å»ºè™šæ‹Ÿæœºã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨ä½¿ç”¨Intelå¤„ç†å™¨çš„CentOS7ä¸­å¼€å¯KVMçš„åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ã€‚ kvmä¸»è¦æ˜¯é€šè¿‡å†…æ ¸æ¨¡å—æ¥å®ç°çš„ï¼Œå› æ­¤æˆ‘ä»¬æŸ¥çœ‹ç³»ç»Ÿæ˜¯å¦å¼€å¯äº†kvmåµŒå¥—è™šæ‹ŸåŒ–ï¼Œåªéœ€è¦ï¼š 1cat /sys/module/kvm_intel/parameters/nested æ ¹æ®è¾“å‡ºçš„ç»“æœå³å¯çŸ¥é“æ˜¯å¦æ”¯æŒã€‚ å¦‚æœä¸æ”¯æŒï¼Œæˆ‘ä»¬åˆ™éœ€è¦åœ¨/etc/modprobe.d/æ–°å»ºä¸€ä¸ªkvm-nested.confï¼š 1234options kvm-intel nested=1options kvm-intel enable_shadow_vmcs=1options kvm-intel enable_apicv=1options kvm-intel ept=1 æ¥ç€æˆ‘ä»¬é‡æ–°åŠ è½½ä¸€ä¸‹kvmæ¨¡å—ï¼š 12modprobe -r kvm_intelmodprobe -a kvm_intel æœ€åå†æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦æˆåŠŸï¼š 1cat /sys/module/kvm_intel/parameters/nested","categories":[{"name":"â€Œvirtualization","slug":"â€Œvirtualization","permalink":"https://tinychen.com/categories/%E2%80%8Cvirtualization/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"kvm","slug":"kvm","permalink":"https://tinychen.com/tags/kvm/"}]},{"title":"Cephç³»åˆ—01-Cephç®€ä»‹","slug":"20200201-ceph-01-ceph-introduction","date":"2020-02-01T03:00:00.000Z","updated":"2020-02-01T03:00:00.000Z","comments":true,"path":"20200201-ceph-01-ceph-introduction/","link":"","permalink":"https://tinychen.com/20200201-ceph-01-ceph-introduction/","excerpt":"Cephçš„åŸºæœ¬æ¦‚å¿µä»‹ç»å’Œå…¥é—¨çŸ¥è¯†å‚¨å¤‡ã€‚","text":"Cephçš„åŸºæœ¬æ¦‚å¿µä»‹ç»å’Œå…¥é—¨çŸ¥è¯†å‚¨å¤‡ã€‚ 1ã€cephç®€ä»‹Cephæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒæä¾›è½¯ä»¶å®šä¹‰çš„ã€ç»Ÿä¸€çš„å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚Cephæ˜¯ä¸€ä¸ªå¯å¤§è§„æ¨¡æ‰©å±•ã€é«˜æ€§èƒ½å¹¶ä¸”æ— å•ç‚¹æ•…éšœçš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚ä»ä¸€å¼€å§‹å®ƒå°±è¿è¡Œåœ¨é€šç”¨å•†ç”¨ç¡¬ä»¶ä¸Šï¼Œå…·æœ‰é«˜åº¦å¯ä¼¸ç¼©æ€§ï¼Œå®¹é‡å¯æ‰©å±•è‡³EBçº§åˆ«ï¼Œç”šè‡³æ›´å¤§ã€‚ Cephçš„æ¶æ„åœ¨è®¾è®¡ä¹‹åˆå°±åŒ…å«ä¸‹åˆ—ç‰¹æ€§ï¼š æ‰€æœ‰çš„ç»„ä»¶å¿…é¡»å¯æ‰©å±• ä¸èƒ½å­˜åœ¨å•ç‚¹æ•…éšœ è§£å†³æ–¹æ¡ˆå¿…é¡»æ˜¯è½¯ä»¶å®šä¹‰çš„ã€å¼€æºçš„å¹¶ä¸”å¯é€‚é… Cephè½¯ä»¶åº”è¯¥è¿è¡Œåœ¨é€šç”¨å•†ç”¨ç¡¬ä»¶ä¹‹ä¸Š æ‰€æœ‰ç»„ä»¶å¿…é¡»å°½å¯èƒ½è‡ªæˆ‘ç®¡ç† Cephå­˜å‚¨ç³»ç»Ÿåœ¨åŒä¸€ä¸ªåº•å±‚æ¶æ„ä¸Šæä¾›äº†å—ã€æ–‡ä»¶å’Œå¯¹è±¡å­˜å‚¨ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥è‡ªä¸»é€‰æ‹©ä»–ä»¬éœ€è¦çš„å­˜å‚¨æ–¹å¼ã€‚å¯¹è±¡æ˜¯Cephçš„åŸºç¡€ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„åŸºæœ¬å­˜å‚¨å•å…ƒã€‚ä»»ä½•æ ¼å¼çš„æ•°æ®ï¼Œä¸ç®¡æ˜¯å—ã€å¯¹è±¡è¿˜æ˜¯æ–‡ä»¶ï¼Œéƒ½ä»¥å¯¹è±¡çš„å½¢å¼ä¿å­˜åœ¨Cephé›†ç¾¤çš„å½’ç½®ç»„(Placement Groupï¼ŒPg)ä¸­ã€‚ä½¿ç”¨å¯¹è±¡å­˜å‚¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¹³å°å’Œç¡¬ä»¶ç‹¬ç«‹å¼€æ¥ã€‚åœ¨Cephä¸­ï¼Œç”±äºå¯¹è±¡æ²¡æœ‰ç‰©ç†å­˜å‚¨è·¯å¾„ç»‘å®šï¼Œä½¿å¾—å¯¹è±¡éå¸¸çµæ´»å¹¶ä¸”ä¸ä½ç½®æ— å…³ã€‚è¿™ä¹Ÿä½¿å¾—Cephçš„è§„æ¨¡èƒ½å¤Ÿè¿‘çº¿æ€§åœ°ä»PBçº§åˆ«æ‰©å±•åˆ°EBçº§åˆ«ã€‚ Cephæ˜¯åœ£å…‹é²å…¹åŠ åˆ©ç¦å°¼äºšå¤§å­¦çš„Sage Weilåœ¨2003å¹´å¼€å‘çš„ï¼Œä¹Ÿæ˜¯ä»–çš„åšå£«å­¦ä½é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚åˆå§‹çš„é¡¹ç›®åŸå‹æ˜¯å¤§çº¦40000è¡ŒC++ä»£ç çš„Cephæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶äº2006å¹´ä½œä¸ºå‚è€ƒå®ç°å’Œç ”ç©¶å¹³å°éµå¾ªLGPLåè®®(Lesser GUN Public License)å¼€æºã€‚ç¾å›½åŠ³ä¼¦æ–¯åˆ©ç‰©è«å›½å®¶å®éªŒå®¤(Lawrence Livermore National Laboratory)èµ„åŠ©äº†Sageçš„åˆå§‹ç ”ç©¶å·¥ä½œã€‚2003ï½2007å¹´æ˜¯Cephçš„ç ”ç©¶å¼€å‘æ—¶æœŸã€‚åœ¨è¿™æœŸé—´ï¼Œå®ƒçš„æ ¸å¿ƒç»„ä»¶é€æ­¥å½¢æˆï¼Œå¹¶ä¸”ç¤¾åŒºå¯¹é¡¹ç›®çš„è´¡çŒ®ä¹Ÿå·²ç»å¼€å§‹é€æ¸å˜å¤§ã€‚Cephæ²¡æœ‰é‡‡ç”¨åŒé‡è®¸å¯æ¨¡å¼ï¼Œä¹Ÿå°±ä¸å­˜åœ¨åªé’ˆå¯¹ä¼ä¸šç‰ˆçš„ç‰¹æ€§ã€‚ Inktankæ˜¯CephèƒŒåçš„å…¬å¸ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯ç»™ä»–ä»¬çš„ä¼ä¸šå®¢æˆ·æä¾›ä¸“ä¸šçŸ¥è¯†ã€å¤„ç†æµç¨‹ã€å·¥å…·å’Œæ”¯æ’‘ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°é‡‡ç”¨å’Œç®¡ç†Cephå­˜å‚¨ç³»ç»Ÿã€‚Sageæ˜¯Inktankçš„CTOå’Œåˆ›å§‹äººã€‚ Cephè¿™ä¸ªè¯æ˜¯å® ç‰©ç« é±¼çš„ä¸€ä¸ªå¸¸è§ç»°å·ã€‚Cephå¯ä»¥çœ‹ä½œCephalopodçš„ç¼©å†™ï¼Œå®ƒå±äºæµ·æ´‹è½¯ä½“ç±»åŠ¨ç‰©å®¶æ—ã€‚Cephä»¥ç« é±¼ä½œä¸ºè‡ªå·±çš„å‰ç¥¥ç‰©ï¼Œè¡¨è¾¾äº†Cephè·Ÿç« é±¼ä¸€æ ·çš„å¹¶è¡Œè¡Œä¸ºã€‚ Inktankè¿™ä¸ªè¯ä¸ç« é±¼æœ‰ä¸€å®šå…³ç³»ã€‚æ¸”æ°‘æœ‰æ—¶å€™ä¹ŸæŠŠç« é±¼ç§°ä¸ºå¢¨é±¼ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å–·å°„å¢¨æ±ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆç« é±¼(Ceph)è·Ÿå¢¨é±¼(Inktank)æœ‰ä¸€å®šå…³ç³»ã€‚åŒæ ·ï¼ŒCephå’ŒInktankæœ‰å¾ˆå¤šå…±åŒç‚¹ã€‚ä½ å¯ä»¥è®¤ä¸ºInktankå°±æ˜¯Cephçš„æ™ºåº“ã€‚ å¼€æºLinuxç¤¾åŒº2008å¹´å°±é¢„è§åˆ°Cephçš„æ½œåŠ›ï¼Œå¹¶å°†å…¶åŠ å…¥Linuxå†…æ ¸ä¸»çº¿ã€‚è¿™å·²ç»æˆä¸ºCephçš„é‡Œç¨‹ç¢‘äº‹ä»¶ã€‚ 2ã€Cephä¸äº‘äº‘ç¯å¢ƒè¦æ±‚å…¶å­˜å‚¨èƒ½å¤Ÿä»¥ä½æˆæœ¬çºµå‘å’Œæ¨ªå‘æ‰©å±•ï¼Œè€Œä¸”èƒ½å¤Ÿå®¹æ˜“ä¸äº‘æ¡†æ¶ä¸­å…¶ä»–ç»„ä»¶é›†æˆã€‚ OpenStacké¡¹ç›®å¤§åŠ›æ¨åŠ¨äº†å…¬æœ‰äº‘å’Œç§æœ‰äº‘çš„å‘å±•ã€‚å®ƒå·²ç»è¯æ˜äº†è‡ªå·±æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯äº‘è§£å†³æ–¹æ¡ˆã€‚å®ƒè‡ªå·±çš„å†…éƒ¨æ ¸å¿ƒå­˜å‚¨ç»„ä»¶Swiftæä¾›åŸºäºå¯¹è±¡çš„å­˜å‚¨å’ŒNova-Volume(ä¹Ÿç§°ä¸ºCinder)ï¼Œè€ŒCinderåˆ™ä¸ºVMæä¾›å—å­˜å‚¨ã€‚ ä¸Swift(å®ƒä»…æä¾›å¯¹è±¡å­˜å‚¨)ä¸åŒï¼ŒCephæ˜¯ä¸€ä¸ªåŒ…å«å—å­˜å‚¨ã€æ–‡ä»¶å­˜å‚¨å’Œå¯¹è±¡å­˜å‚¨çš„ç»Ÿä¸€å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œè¿™æ ·å¯ä»¥é€šè¿‡å•ä¸€å­˜å‚¨é›†ç¾¤ä¸ºOpenStackæä¾›å¤šç§å­˜å‚¨ç±»å‹ã€‚å› æ­¤ï¼Œä½ å¯ä»¥è½»æ¾è€Œé«˜æ•ˆåœ°ä¸ºOpenStackäº‘ç®¡ç†å­˜å‚¨ã€‚OpenStackå’ŒCephç¤¾åŒºå·²ç»ä¸€èµ·åˆä½œäº†è®¸å¤šå¹´ï¼Œè‡´åŠ›äºä¸ºOpenStackäº‘å¼€å‘ä¸€ä¸ªå®Œå…¨æ”¯æŒçš„Cephå­˜å‚¨åç«¯ã€‚ä»Folsom(OpenStackç¬¬6ä¸ªä¸»è¦ç‰ˆæœ¬)å¼€å§‹ï¼ŒCephå·²ç»å®Œå…¨ä¸OpenStacké›†æˆã€‚Cephå¼€å‘äººå‘˜ç¡®ä¿Cephèƒ½å¤Ÿé€‚ç”¨äºOpenStackçš„æœ€æ–°ç‰ˆï¼ŒåŒæ—¶è´¡çŒ®æ–°ç‰¹æ€§ä»¥åŠä¿®æ­£bugã€‚OpenStacké€šè¿‡å®ƒçš„cinderå’Œglanceç»„ä»¶ä½¿ç”¨Cephæœ€è‹›åˆ»çš„ç‰¹æ€§RADOSå—è®¾å¤‡(RBD)ã€‚Ceph RBDé€šè¿‡æä¾›ç²¾ç®€é…ç½®çš„å¿«ç…§å¤åˆ¶(snapshotted-cloned)å·å¸®åŠ©OpenStackå¿«é€Ÿé…ç½®æ•°ç™¾ä¸ªVMå®ä¾‹ï¼Œè¿™ç§æ–¹å¼æ—¢å‡å°‘ç©ºé—´éœ€æ±‚ï¼Œåˆéå¸¸å¿«é€Ÿã€‚ 3ã€Cephä¸è½¯ä»¶å®šä¹‰å­˜å‚¨ï¼ˆSDSï¼‰Cephæ˜¯ä¸€ä¸ªçœŸæ­£çš„SDSè§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯å¼€æºè½¯ä»¶ï¼Œè¿è¡Œåœ¨å•†ç”¨ç¡¬ä»¶ä¸Šï¼Œå› æ­¤ä¸å­˜åœ¨å‚å•†é”å®šï¼Œå¹¶ä¸”èƒ½æä¾›ä½æˆæœ¬å­˜å‚¨ã€‚SDSæ–¹æ¡ˆæä¾›äº†å®¢æˆ·æ€¥éœ€çš„ç¡¬ä»¶é€‰æ‹©çš„çµæ´»æ€§ã€‚å®¢æˆ·å¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€è¦é€‰æ‹©ä»»æ„åˆ¶é€ å•†çš„å•†ç”¨ç¡¬ä»¶ï¼Œå¹¶è‡ªç”±åœ°è®¾è®¡å¼‚æ„çš„ç¡¬ä»¶è§£å†³æ–¹æ¡ˆã€‚åœ¨æ­¤ç¡¬ä»¶è§£å†³æ–¹æ¡ˆä¹‹ä¸Šçš„Cephçš„è½¯ä»¶å®šä¹‰å­˜å‚¨å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œã€‚å®ƒå¯ä»¥ä»è½¯ä»¶å±‚é¢æ­£ç¡®æä¾›æ‰€æœ‰çš„ä¼ä¸šçº§å­˜å‚¨ç‰¹æ€§ã€‚ä½æˆæœ¬ã€å¯é æ€§ã€å¯æ‰©å±•æ€§æ˜¯Cephçš„ä¸»è¦ç‰¹ç‚¹ã€‚ ä»å­˜å‚¨å‚å•†çš„è§’åº¦æ¥çœ‹ï¼Œç»Ÿä¸€å­˜å‚¨çš„å®šä¹‰å°±æ˜¯åœ¨å•ä¸€çš„å¹³å°ä¸ŠåŒæ—¶æä¾›åŸºäºæ–‡ä»¶å’ŒåŸºäºå—çš„è®¿é—®ã€‚ Cephåº•å±‚ä¸­å¹¶ä¸å­˜åœ¨å—å’Œæ–‡ä»¶çš„ç®¡ç†ï¼Œè€Œæ˜¯ç®¡ç†å¯¹è±¡å¹¶ä¸”åœ¨å¯¹è±¡ä¹‹ä¸Šæ”¯æŒåŸºäºå—å’Œæ–‡ä»¶çš„å­˜å‚¨ã€‚åœ¨ä¼ ç»ŸåŸºäºæ–‡ä»¶çš„å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶æ˜¯é€šè¿‡æ–‡ä»¶ç›®å½•è¿›è¡Œå¯»å€çš„ã€‚ç±»ä¼¼åœ°ï¼ŒCephä¸­çš„å¯¹è±¡é€šè¿‡å”¯ä¸€çš„æ ‡è¯†ç¬¦è¿›è¡Œå¯»å€ï¼Œå¹¶å­˜å‚¨åœ¨ä¸€ä¸ªæ‰å¹³çš„å¯»å€ç©ºé—´ä¸­ã€‚å‰”é™¤äº†å…ƒæ•°æ®æ“ä½œä¹‹åï¼Œå¯¹è±¡æä¾›äº†æ— é™çš„è§„æ¨¡æ‰©å±•å’Œæ€§èƒ½æå‡ã€‚Cephé€šè¿‡ä¸€ä¸ªç®—æ³•æ¥åŠ¨æ€è®¡ç®—å­˜å‚¨å’Œè·å–æŸä¸ªå¯¹è±¡çš„ä½ç½®ã€‚ ä¼ ç»Ÿçš„å­˜å‚¨ç³»ç»Ÿå¹¶ä¸å…·å¤‡æ›´æ™ºèƒ½åœ°ç®¡ç†å…ƒæ•°æ®çš„æ–¹æ³•ã€‚å…ƒæ•°æ®æ˜¯å…³äºæ•°æ®çš„ä¿¡æ¯ï¼Œå®ƒå†³å®šäº†æ•°æ®å°†å¾€å“ªé‡Œå­˜å‚¨ï¼Œä»å“ªé‡Œè¯»å–ã€‚ä¼ ç»Ÿçš„å­˜å‚¨ç³»ç»Ÿé€šè¿‡ç»´æŠ¤ä¸€å¼ é›†ä¸­çš„æŸ¥æ‰¾è¡¨æ¥è·Ÿè¸ªå®ƒä»¬çš„å…ƒæ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡å‘å‡ºè¯»å†™æ“ä½œè¯·æ±‚æ—¶ï¼Œå­˜å‚¨ç³»ç»Ÿé¦–å…ˆè¦æŸ¥æ‰¾è¿™ä¸ªå·¨å¤§çš„å…ƒæ•°æ®è¡¨ï¼Œå¾—åˆ°ç»“æœä¹‹åå®ƒæ‰èƒ½æ‰§è¡Œå®¢æˆ·ç«¯è¯·æ±‚çš„æ“ä½œã€‚å¯¹äºä¸€ä¸ªå°çš„å­˜å‚¨ç³»ç»Ÿè€Œè¨€ï¼Œä½ æˆ–è®¸ä¸ä¼šæ„Ÿè§‰åˆ°æ€§èƒ½é—®é¢˜ï¼Œä½†å¯¹äºä¸€ä¸ªå¤§çš„å­˜å‚¨é›†ç¾¤æ¥è¯´ï¼Œä½ å°†ä¼šå—åˆ¶äºè¿™ç§æ–¹æ³•çš„æ€§èƒ½é™åˆ¶ã€‚å®ƒä¹Ÿä¼šé™åˆ¶ç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚ 4ã€Cephä¸­çš„æ•°æ®å‰¯æœ¬Cephæ²¡æœ‰é‡‡ç”¨ä¼ ç»Ÿçš„å­˜å‚¨æ¶æ„ï¼Œè€Œæ˜¯ç”¨ä¸‹ä¸€ä»£æ¶æ„å®Œå…¨é‡å¡‘äº†å®ƒã€‚Cephå¼•å…¥äº†ä¸€ä¸ªå«CRUSHçš„æ–°ç®—æ³•ï¼Œè€Œä¸æ˜¯ä¿å­˜å’Œæ“çºµå…ƒæ•°æ®ã€‚CRUSHæ˜¯Controlled Replication Under Scalable Hashingçš„ç¼©å†™ã€‚ CRUSHç®—æ³•åœ¨åå°è®¡ç®—æ•°æ®å­˜å‚¨å’Œè¯»å–çš„ä½ç½®ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æ‰§è¡Œå…ƒæ•°æ®è¡¨çš„æŸ¥æ‰¾ã€‚é€šè¿‡åŠ¨æ€è®¡ç®—å…ƒæ•°æ®ï¼ŒCephä¹Ÿå°±ä¸éœ€è¦ç®¡ç†ä¸€ä¸ªé›†ä¸­å¼çš„å…ƒæ•°æ®è¡¨ã€‚ç°ä»£è®¡ç®—æœºè®¡ç®—é€Ÿåº¦æå¿«ï¼Œèƒ½å¤Ÿéå¸¸å¿«åœ°å®ŒæˆCRUSHæŸ¥æ‰¾ã€‚å¦å¤–ï¼Œåˆ©ç”¨åˆ†å¸ƒå¼å­˜å‚¨çš„åŠŸèƒ½å¯ä»¥å°†ä¸€ä¸ªå°çš„è®¡ç®—è´Ÿè½½åˆ†å¸ƒåˆ°é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ã€‚CRUSHæ¸…æ™°çš„å…ƒæ•°æ®ç®¡ç†æ–¹æ³•æ¯”ä¼ ç»Ÿå­˜å‚¨ç³»ç»Ÿçš„æ›´å¥½ã€‚ CRUSHä¼šä»¥å¤šå‰¯æœ¬çš„æ–¹å¼ä¿å­˜æ•°æ®ï¼Œä»¥ä¿è¯åœ¨æ•…éšœåŒºåŸŸä¸­æœ‰äº›ç»„ä»¶æ•…éšœçš„æƒ…å†µä¸‹æ•°æ®ä¾æ—§å¯ç”¨ã€‚ç”¨æˆ·åœ¨Cephçš„CRUSH mapä¸­å¯ä»¥è‡ªç”±åœ°ä¸ºä»–ä»¬çš„åŸºç¡€è®¾æ–½å®šä¹‰æ•…éšœåŒºåŸŸã€‚è¿™ä¹Ÿå°±ä½¿å¾—Cephç®¡ç†å‘˜èƒ½å¤Ÿåœ¨è‡ªå·±çš„ç¯å¢ƒä¸­é«˜æ•ˆåœ°ç®¡ç†ä»–ä»¬çš„æ•°æ®ã€‚CRUSHä½¿å¾—Cephèƒ½å¤Ÿè‡ªæˆ‘ç®¡ç†å’Œè‡ªæˆ‘ç–—æ„ˆã€‚å½“æ•…éšœåŒºåŸŸä¸­çš„ç»„ä»¶æ•…éšœæ—¶ï¼ŒCRUSHèƒ½å¤Ÿæ„ŸçŸ¥å“ªä¸ªç»„ä»¶æ•…éšœäº†ï¼Œå¹¶ç¡®å®šå…¶å¯¹é›†ç¾¤çš„å½±å“ã€‚æ— é¡»ç®¡ç†å‘˜çš„ä»»ä½•å¹²é¢„ï¼ŒCRUSHå°±ä¼šè¿›è¡Œè‡ªæˆ‘ç®¡ç†å’Œè‡ªæˆ‘ç–—æ„ˆï¼Œä¸ºå› æ•…éšœè€Œä¸¢å¤±çš„æ®æ•°æ‰§è¡Œæ¢å¤æ“ä½œã€‚CRUSHæ ¹æ®é›†ç¾¤ä¸­ç»´æŠ¤çš„å…¶ä»–å‰¯æœ¬æ¥é‡æ–°ç”Ÿæˆä¸¢å¤±çš„æ•°æ®ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œé›†ç¾¤æ•°æ®éƒ½ä¼šæœ‰å¤šä¸ªå‰¯æœ¬åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­ã€‚ ä½¿ç”¨RAIDæŠ€æœ¯ä¿®å¤å¤šä¸ªå¤§ç¡¬ç›˜æ˜¯ä¸€ä¸ªå¾ˆç¹ççš„è¿‡ç¨‹ã€‚å¦å¤–ï¼ŒRAIDéœ€è¦å¾ˆå¤šæ•´å—çš„ç£ç›˜æ¥å……å½“å¤‡ç”¨ç›˜ã€‚è¿™ä¹Ÿä¼šå½±å“åˆ°TCOï¼Œå¦‚æœä½ ä¸é…ç½®å¤‡ç”¨ç›˜ï¼Œå°†ä¼šå°†ä¼šé‡åˆ°éº»çƒ¦ã€‚RAIDæœºåˆ¶è¦æ±‚åœ¨åŒä¸€ä¸ªRAIDç»„ä¸­çš„ç£ç›˜å¿…é¡»å®Œå…¨ç›¸åŒã€‚å¦‚æœä½ æ”¹åŠ¨äº†ç£ç›˜å®¹é‡ã€è½¬é€Ÿå’Œç£ç›˜ç±»å‹ï¼Œåˆ™ä½ å¯èƒ½è¦é¢ä¸´æƒ©ç½šã€‚è¿™æ ·åšå°†ä¼šå¯¹äºå­˜å‚¨ç³»ç»Ÿçš„å®¹é‡å’Œæ€§èƒ½äº§ç”Ÿä¸åˆ©å½±å“ã€‚ TCO ï¼ˆTotal Cost of Ownership ï¼‰ï¼Œå³æ€»æ‹¥æœ‰æˆæœ¬ï¼ŒåŒ…æ‹¬äº§å“é‡‡è´­åˆ°åæœŸä½¿ç”¨ã€ç»´æŠ¤çš„æˆæœ¬ã€‚è¿™æ˜¯ä¸€ç§å…¬å¸ç»å¸¸é‡‡ç”¨çš„æŠ€æœ¯è¯„ä»·æ ‡å‡†ã€‚ç”±äºå¸¸è§çš„RAID5ã€6ã€10ç­‰é˜µåˆ—æ–¹å¼éœ€è¦ä½¿ç”¨ç£ç›˜ä½œä¸ºé•œåƒç›˜æˆ–è€…çƒ­å¤‡ç›˜ï¼Œå› æ­¤å¦‚æœä½ ä¹°äº†10å—10Tçš„ç¡¬ç›˜å…±è®¡100Tç©ºé—´ï¼Œä½¿ç”¨é˜µåˆ—åä¼šå¯¼è‡´æœ€åå¯ä»¥ä½¿ç”¨çš„ç¡¬ç›˜å®¹é‡å°äº100Tã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¸å¦‚RAID0ä¹‹ç±»çš„ä¸æŸå¤±ç©ºé—´çš„é˜µåˆ—æ–¹å¼ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´æ•°æ®çš„å®‰å…¨æ€§å¤§å¤§åœ°é™ä½ã€‚ åŸºäºRAIDçš„ä¼ä¸šçº§å­˜å‚¨ç³»ç»Ÿé€šå¸¸éƒ½éœ€è¦æ˜‚è´µçš„ç¡¬ä»¶RAIDå¡ï¼Œè¿™ä¹Ÿå¢åŠ äº†ç³»ç»Ÿæ€»æˆæœ¬ã€‚ RAIDç³»ç»Ÿæœ€å¤§çš„é™åˆ¶å› ç´ æ˜¯å®ƒåªèƒ½é˜²æ­¢ç£ç›˜æ•…éšœï¼Œè€Œä¸èƒ½ä¸ºç½‘ç»œã€æœåŠ¡å™¨ç¡¬ä»¶ã€OSã€äº¤æ¢è®¾å¤‡çš„æ•…éšœæˆ–è€…åŒºåŸŸç¾å®³æä¾›ä¿æŠ¤æªæ–½ã€‚ RAIDæœ€å¤šèƒ½ä¸ºä½ æä¾›é˜²æ­¢ä¸¤ä¸ªç£ç›˜æ•…éšœçš„æªæ–½ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ä½ æ— æ³•å®¹å¿è¶…è¿‡ä¸¤ä¸ªçš„ç£ç›˜æ•…éšœã€‚ Cpehæ˜¯ä¸€ä¸ªè½¯ä»¶å®šä¹‰çš„å­˜å‚¨ï¼Œå› æ­¤å®ƒä¸éœ€è¦ä»»ä½•ç‰¹æ®Šç¡¬ä»¶æ¥æä¾›æ•°æ®å‰¯æœ¬åŠŸèƒ½ã€‚å¦å¤–ï¼Œæ•°æ®å‰¯æœ¬çº§åˆ«å¯ä»¥é€šè¿‡å‘½ä»¤é«˜åº¦å®šåˆ¶åŒ–ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€Cephå­˜å‚¨ç®¡ç†å‘˜èƒ½å¤Ÿè½»æ¾åœ°æ ¹æ®è‡ªèº«éœ€è¦å’Œåº•å±‚åŸºç¡€è®¾æ–½ç‰¹ç‚¹æ¥ç®¡ç†å‰¯æœ¬ç­–ç•¥ã€‚ è¿™æ ·çš„æ¢å¤æ“ä½œä¸éœ€è¦ä»»ä½•çƒ­å¤‡ç£ç›˜ï¼›æ•°æ®åªæ˜¯ç®€å•åœ°å¤åˆ¶åˆ°Cephé›†ç¾¤ä¸­å…¶ä»–çš„ç£ç›˜ä¸Šã€‚ é™¤äº†æ•°æ®å‰¯æœ¬æ–¹æ³•å¤–ï¼ŒCephè¿˜æ”¯æŒå…¶ä»–ç”¨äºä¿è¯æ•°æ®å¯é æ€§çš„æ–¹æ³•ï¼Œæ¯”å¦‚çº åˆ ç æŠ€æœ¯ã€‚çº åˆ ç æ–¹å¼ä¸‹ï¼Œæ¯æŸçš„æ•°æ®å€ŸåŠ©çº åˆ ç è®¡ç®—é€šè¿‡ç®—æ³•è¿›è¡Œæ¢å¤æˆ–å†æ¬¡ç”Ÿæˆã€‚ 5ã€Cephçš„å­˜å‚¨å…¼å®¹æ€§Cephæ˜¯ä¸€ä¸ªå®Œå¤‡çš„ä¼ä¸šçº§å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¤šç§åè®®ä»¥åŠè®¿é—®æ–¹å¼ï¼Œä¸»è¦å¯ä»¥åˆ†ä¸ºå—ã€æ–‡ä»¶å’Œå¯¹è±¡å­˜å‚¨ä¸‰å¤§ç±»ã€‚ 5.1 Cephå—å­˜å‚¨å—å­˜å‚¨æ˜¯å­˜å‚¨åŒºåŸŸç½‘ç»œä¸­ä½¿ç”¨çš„ä¸€ä¸ªæ•°æ®å­˜å‚¨ç±»åˆ«ã€‚åœ¨è¿™ç§ç±»å‹ä¸­ï¼Œæ•°æ®ä»¥å—çš„å½¢å¼å­˜å‚¨åœ¨å·é‡Œï¼Œå·ä¼šæŒ‚æ¥åˆ°èŠ‚ç‚¹ä¸Šã€‚å®ƒå¯ä»¥ä¸ºåº”ç”¨ç¨‹åºæä¾›æ›´å¤§çš„å­˜å‚¨å®¹é‡ï¼Œå¹¶ä¸”å¯é æ€§å’Œæ€§èƒ½éƒ½æ›´é«˜ã€‚è¿™äº›å—å½¢æˆçš„å·ä¼šæ˜ å°„åˆ°æ“ä½œç³»ç»Ÿä¸­ï¼Œå¹¶è¢«æ–‡ä»¶ç³»ç»Ÿå±‚æ§åˆ¶ã€‚ Cephå¼•å…¥äº†ä¸€ä¸ªæ–°çš„RBDåè®®ï¼Œä¹Ÿå°±æ˜¯Cephå—è®¾å¤‡(Ceph Block Device)ã€‚ RBDå—å‘ˆå¸¦çŠ¶åˆ†å¸ƒåœ¨å¤šä¸ªCephå¯¹è±¡ä¹‹ä¸Šï¼Œè€Œè¿™äº›å¯¹è±¡æœ¬èº«åˆåˆ†å¸ƒåœ¨æ•´ä¸ªCephå­˜å‚¨é›†ç¾¤ä¸­ï¼Œå› æ­¤èƒ½å¤Ÿä¿è¯æ•°æ®çš„å¯é æ€§ä»¥åŠæ€§èƒ½ã€‚ å‡ ä¹æ‰€æœ‰çš„Linuxæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆéƒ½æ”¯æŒRBDã€‚é™¤äº†å¯é æ€§å’Œæ€§èƒ½ä¹‹å¤–ï¼ŒRBDä¹Ÿæ”¯æŒå…¶ä»–çš„ä¼ä¸šçº§ç‰¹æ€§ï¼Œä¾‹å¦‚å®Œæ•´å’Œå¢é‡å¼å¿«ç…§ï¼Œç²¾ç®€çš„é…ç½®ï¼Œå†™æ—¶å¤åˆ¶(copy-on-write)å¼å…‹éš†ï¼Œä»¥åŠå…¶ä»–ç‰¹æ€§ã€‚RBDè¿˜æ”¯æŒå…¨å†…å­˜å¼ç¼“å­˜ï¼Œè¿™å¯ä»¥å¤§å¤§æé«˜å®ƒçš„æ€§èƒ½ã€‚Ceph RBDæ”¯æŒçš„æœ€å¤§é•œåƒä¸º16EBã€‚åœ¨OpenStackä¸­ï¼Œå¯ä»¥é€šè¿‡cinder(å—)å’Œglance(image)ç»„ä»¶æ¥ä½¿ç”¨Cephå—è®¾å¤‡ã€‚è¿™æ ·åšå¯ä»¥è®©ä½ åˆ©ç”¨Cephå—å­˜å‚¨çš„copy-on-writeç‰¹æ€§åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…åˆ›å»ºä¸Šåƒä¸ªVMã€‚ 5.2 Cephæ–‡ä»¶å­˜å‚¨Cephæ–‡ä»¶ç³»ç»Ÿ(ä¹Ÿå°±æ˜¯CephFS)æ˜¯ä¸€ä¸ªå…¼å®¹POSIXçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåˆ©ç”¨Cephå­˜å‚¨é›†ç¾¤æ¥ä¿å­˜ç”¨æˆ·æ•°æ®ã€‚CephFSå°†æ•°æ®å’Œå…ƒæ•°æ®åˆ†å¼€å­˜å‚¨ï¼Œä¸ºä¸Šå±‚çš„åº”ç”¨ç¨‹åºæä¾›è¾ƒé«˜çš„æ€§èƒ½ä»¥åŠå¯é æ€§ã€‚ Linuxå†…æ ¸é©±åŠ¨ç¨‹åºæ”¯æŒCephFSï¼Œè¿™ä¹Ÿä½¿å¾—CephFSé«˜åº¦é€‚ç”¨äºå„å¤§Linuxæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆã€‚ åœ¨Cpehé›†ç¾¤å†…éƒ¨ï¼ŒCephæ–‡ä»¶ç³»ç»Ÿåº“(libcephfs)è¿è¡Œåœ¨RADOSåº“(librados)ä¹‹ä¸Šï¼Œåè€…æ˜¯Cephå­˜å‚¨é›†ç¾¤åè®®ï¼Œç”±æ–‡ä»¶ã€å—å’Œå¯¹è±¡å­˜å‚¨å…±ç”¨ã€‚è¦ä½¿ç”¨CephFSï¼Œä½ çš„é›†ç¾¤èŠ‚ç‚¹ä¸Šæœ€å°‘è¦é…ç½®ä¸€ä¸ªCephå…ƒæ•°æ®æœåŠ¡å™¨(MDS)ã€‚ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå•ä¸€çš„MDSæœåŠ¡å™¨å°†æˆä¸ºCephæ–‡ä»¶ç³»ç»Ÿçš„å•ç‚¹æ•…éšœã€‚MDSé…ç½®åï¼Œå®¢æˆ·ç«¯å¯ä»¥é‡‡ç”¨å¤šç§æ–¹å¼ä½¿ç”¨CephFSã€‚å¦‚æœè¦æŠŠCephæŒ‚è½½æˆæ–‡ä»¶ç³»ç»Ÿï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨æœ¬åœ°Linuxå†…æ ¸çš„åŠŸèƒ½æˆ–è€…ä½¿ç”¨Cephç¤¾åŒºæä¾›çš„ceph-fuse(ç”¨æˆ·ç©ºé—´æ–‡ä»¶ç³»ç»Ÿ)é©±åŠ¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹å¼€æºç¨‹åºï¼Œä¾‹å¦‚NFSçš„Ganeshaå’ŒSMB/CIFSçš„Sambaã€‚ 5.3 Cephå¯¹è±¡å­˜å‚¨å¯¹è±¡å­˜å‚¨æ˜¯ä¸€ç§ä»¥å¯¹è±¡å½¢å¼è€Œä¸æ˜¯ä¼ ç»Ÿæ–‡ä»¶å’Œå—å½¢å¼å­˜å‚¨æ•°æ®çš„æ–¹æ³•ã€‚ Cephæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨ç³»ç»Ÿï¼Œé€šè¿‡å®ƒçš„å¯¹è±¡ç½‘å…³(object gateway)ï¼Œä¹Ÿå°±æ˜¯RADOSç½‘å…³(radosgw)æä¾›å¯¹è±¡å­˜å‚¨æ¥å£ã€‚RADOSç½‘å…³åˆ©ç”¨librgw(RADOSç½‘å…³åº“)å’Œlibradosè¿™äº›åº“ï¼Œå…è®¸åº”ç”¨ç¨‹åºè·ŸCephå¯¹è±¡å­˜å‚¨å»ºç«‹è¿æ¥ã€‚ RADOSç½‘å…³æä¾›RESTfulæ¥å£è®©ç”¨æˆ·çš„åº”ç”¨ç¨‹åºå°†æ•°æ®å­˜å‚¨åˆ°Cephé›†ç¾¤ä¸­ã€‚RADOSç½‘å…³æ¥å£æ»¡è¶³ä»¥ä¸‹ç‰¹ç‚¹ã€‚ å…¼å®¹Swiftï¼šè¿™æ˜¯ä¸ºOpenStack Swift APIæä¾›çš„å¯¹è±¡å­˜å‚¨åŠŸèƒ½ã€‚ å…¼å®¹S3ï¼šè¿™æ˜¯ä¸ºAmazon S3 APIæä¾›çš„å¯¹è±¡å­˜å‚¨åŠŸèƒ½ã€‚ Admin APIï¼šè¿™ä¹Ÿç§°ä¸ºç®¡ç†APIæˆ–è€…åŸç”ŸAPIï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒæ¥è·å–è®¿é—®å­˜å‚¨ç³»ç»Ÿçš„æƒé™ä»¥ç®¡ç†å­˜å‚¨ç³»ç»Ÿã€‚ è¦è®¿é—®Cephçš„å¯¹è±¡å­˜å‚¨ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ç»•å¼€RADOSç½‘å…³å±‚ï¼Œè¿™æ ·æ›´çµæ´»å¹¶ä¸”é€Ÿåº¦æ›´å¿«ã€‚libradosè½¯ä»¶åº“å…è®¸ç”¨æˆ·çš„åº”ç”¨ç¨‹åºé€šè¿‡Cã€C++ã€Javaã€Pythonå’ŒPHPç›´æ¥è®¿é—®Cephå¯¹è±¡å­˜å‚¨ã€‚Cephå¯¹è±¡å­˜å‚¨å…·å¤‡å¤šç«™ç‚¹(multisite)çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒèƒ½ä¸ºç¾éš¾æ¢å¤æä¾›è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡RADOSæˆ–è€…è”åˆç½‘å…³å¯ä»¥é…ç½®å¤šç«™ç‚¹çš„å¯¹è±¡å­˜å‚¨ã€‚ 6ã€å…¶ä»–å­˜å‚¨æ–¹æ¡ˆ6.1 GPFS/é€šç”¨å¹¶è¡Œæ–‡ä»¶ç³»ç»ŸGPFS(General Parallel File Systemï¼Œé€šç”¨å¹¶è¡Œæ–‡ä»¶ç³»ç»Ÿ)æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œç”±IBMå¼€å‘åŠæ‹¥æœ‰ã€‚è¿™æ˜¯ä¸€ä¸ªä¸“æœ‰ã€é—­æºçš„å­˜å‚¨ç³»ç»Ÿï¼Œè¿™ä½¿å¾—å®ƒç¼ºå°‘å¸å¼•åŠ›å¹¶ä¸”éš¾ä»¥é€‚åº”ã€‚å­˜å‚¨ç¡¬ä»¶åŠ ä¸Šæˆæƒä»¥åŠæ”¯æŒæˆæœ¬ä½¿å¾—å®ƒéå¸¸æ˜‚è´µã€‚å¦å¤–ï¼Œå®ƒæä¾›çš„å­˜å‚¨è®¿é—®æ¥å£éå¸¸æœ‰é™ï¼›å®ƒæ—¢ä¸èƒ½æä¾›å—å­˜å‚¨ï¼Œä¹Ÿä¸èƒ½æä¾›RESTfulæ¥å£æ¥è®¿é—®å­˜å‚¨ç³»ç»Ÿï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªé™åˆ¶éå¸¸ä¸¥æ ¼çš„ç³»ç»Ÿã€‚ç”šè‡³æœ€å¤§çš„æ•°æ®å‰¯æœ¬æ•°éƒ½é™åˆ¶åªæœ‰3ä¸ªï¼Œè¿™åœ¨å¤šä¸ªç»„ä»¶åŒæ—¶æ•…éšœçš„æƒ…å½¢ä¸‹é™ä½äº†ç³»ç»Ÿçš„å¯é æ€§ã€‚ 6.2 iRDOSiRDOSæ˜¯é¢å‘è§„åˆ™çš„æ•°æ®ç³»ç»Ÿçš„ä»£è¡¨ï¼Œå®ƒæ˜¯ä¾æ®ç¬¬ä¸‰æ¡æ¬¾(3-clause)BSDåè®®å‘å¸ƒçš„å¼€æºæ•°æ®ç®¡ç†è½¯ä»¶ã€‚iRDOSä¸æ˜¯ä¸€ä¸ªé«˜åº¦å¯é çš„å­˜å‚¨ç³»ç»Ÿï¼Œå› ä¸ºå®ƒçš„iCATå…ƒæ•°æ®æœåŠ¡å™¨æ˜¯å•ç‚¹(single point of failureï¼ŒSPOF)ï¼Œå¹¶ä¸”å®ƒä¸æä¾›çœŸæ­£çš„HAã€‚å¦å¤–ï¼Œå®ƒæä¾›çš„å­˜å‚¨è®¿é—®æ¥å£å¾ˆæœ‰é™ï¼›æ—¢ä¸èƒ½æä¾›å—å­˜å‚¨ï¼Œä¹Ÿä¸èƒ½æä¾›RESTfulæ¥å£æ¥è®¿é—®å­˜å‚¨ç³»ç»Ÿï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªé™åˆ¶éå¸¸ä¸¥æ ¼çš„ç³»ç»Ÿã€‚å®ƒæ›´é€‚åˆäºå­˜å‚¨å°‘é‡å¤§æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åŒæ—¶å­˜å‚¨å°æ–‡ä»¶å’Œå¤§æ–‡ä»¶ã€‚iRdosé‡‡ç”¨ä¼ ç»Ÿçš„å·¥ä½œæ–¹å¼ï¼Œç»´æŠ¤ä¸€ä¸ªå…³äºç‰©ç†ä½ç½®(ä¸æ–‡ä»¶åç›¸å…³è”)çš„ç´¢å¼•ã€‚ç”±äºå¤šä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦ä»å…ƒæ•°æ®æœåŠ¡å™¨è¯·æ±‚æ–‡ä»¶ä½ç½®ï¼Œä½¿å¾—å…ƒæ•°æ®æœåŠ¡å™¨éœ€è¦æ‰¿å—æ›´å¤šçš„è®¡ç®—è´Ÿè½½ï¼Œä»è€Œå¯¼è‡´å•ç‚¹æ•…éšœä»¥åŠæ€§èƒ½ç“¶é¢ˆã€‚ 6.3 HDFSHDFSæ˜¯ä¸€ä¸ªç”¨Javaå†™çš„å¹¶ä¸”ä¸ºHadoopæ¡†æ¶è€Œç”Ÿçš„åˆ†å¸ƒå¼å¯æ‰©å±•æ–‡ä»¶ç³»ç»Ÿã€‚HDFSä¸æ˜¯ä¸€ä¸ªå®Œå…¨å…¼å®¹POSIXçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”ä¸æ”¯æŒå—å­˜å‚¨ï¼Œè¿™ä½¿å¾—å®ƒçš„é€‚ç”¨èŒƒå›´ä¸å¦‚Cephã€‚HDFSçš„å¯é æ€§ä¸éœ€è¦è®¨è®ºï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¸€ä¸ªé«˜åº¦å¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚HDFSä¸­çš„å•ç‚¹æ•…éšœä»¥åŠæ€§èƒ½ç“¶é¢ˆä¸»è¦æºäºå®ƒå•ä¸€çš„NameNodeèŠ‚ç‚¹ã€‚å®ƒæ›´é€‚åˆäºå­˜å‚¨å°‘é‡å¤§æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åŒæ—¶å­˜å‚¨å°æ–‡ä»¶å’Œå¤§æ–‡ä»¶ã€‚ 6.4 LustreLustreæ˜¯ä¸€ä¸ªç”±å¼€æºç¤¾åŒºæ¨åŠ¨çš„å¹¶è¡Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œä¾æ®GNU(General Public Licenseï¼Œé€šç”¨å…¬å…±è®¸å¯è¯)å‘å¸ƒã€‚åœ¨Lustreä¸­ï¼Œç”±å•ç‹¬ä¸€ä¸ªæœåŠ¡å™¨è´Ÿè´£å­˜å‚¨å’Œç®¡ç†å…ƒæ•°æ®ã€‚å› æ­¤ï¼Œä»å®¢æˆ·ç«¯æ¥çš„æ‰€æœ‰I/Oè¯·æ±‚éƒ½å®Œå…¨ä¾èµ–äºè¿™ä¸ªæœåŠ¡å™¨çš„è®¡ç®—èƒ½åŠ›ï¼Œä½†å¯¹ä¼ä¸šçº§è®¡ç®—æ¥è¯´é€šå¸¸è¿™ä¸ªæœåŠ¡å™¨çš„è®¡ç®—èƒ½åŠ›éƒ½æ¯”è¾ƒä½ã€‚ä¸iRDOSå’ŒHDFSç±»ä¼¼ï¼ŒLustreé€‚åˆäºå­˜å‚¨å°‘é‡å¤§æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åŒæ—¶å­˜å‚¨å°æ–‡ä»¶å’Œå¤§æ–‡ä»¶ã€‚ä¸iRDOSç±»ä¼¼ï¼ŒLustreç®¡ç†ä¸€ä¸ªç”¨äºæ˜ å°„ç‰©ç†ä½ç½®å’Œæ–‡ä»¶åçš„ç´¢å¼•æ–‡ä»¶ï¼Œè¿™å°±å†³å®šäº†å®ƒæ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„æ¶æ„ï¼Œè€Œä¸”å®¹æ˜“å‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚Lustreä¸å…·å¤‡ä»»ä½•èŠ‚ç‚¹æ•…éšœæ£€æµ‹å’Œçº æ­£æœºåˆ¶ã€‚åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œå®¢æˆ·ç«¯åªèƒ½è‡ªè¡Œè¿æ¥å…¶ä»–èŠ‚ç‚¹ã€‚ 6.5 GlusterGlusterFSæœ€åˆç”±Glusterå…¬å¸å¼€å‘ï¼Œè¯¥å…¬å¸2011å¹´è¢«Red Hatæ”¶è´­ã€‚GlusterFSæ˜¯ä¸€ä¸ªæ¨ªå‘æ‰©å±•çš„ç½‘ç»œé™„åŠ (network-attached)æ–‡ä»¶ç³»ç»Ÿã€‚åœ¨Glusterä¸­ï¼Œç®¡ç†å‘˜å¿…é¡»æ˜ç¡®ä½¿ç”¨å“ªç§å®‰ç½®ç­–ç•¥æ¥å°†æ•°æ®å‰¯æœ¬å­˜å‚¨åˆ°ä¸åŒåœ°åŸŸçš„æœºæ¶ä¸Šã€‚Glusteræœ¬èº«ä¸å†…ç½®å—è®¿é—®ã€æ–‡ä»¶ç³»ç»Ÿå’Œè¿œç¨‹å‰¯æœ¬ï¼Œè€Œæ˜¯ä»¥æ‰©å±•(add-ons)çš„æ–¹å¼æ”¯æŒã€‚","categories":[{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"openstack","slug":"openstack","permalink":"https://tinychen.com/tags/openstack/"},{"name":"ceph","slug":"ceph","permalink":"https://tinychen.com/tags/ceph/"}]},{"title":"Windowsæ›´æ”¹MSTSCçš„è¿œç¨‹ç«¯å£å·","slug":"20200125-windows-change-mstsc-port","date":"2020-01-25T03:00:00.000Z","updated":"2020-01-25T03:00:00.000Z","comments":true,"path":"20200125-windows-change-mstsc-port/","link":"","permalink":"https://tinychen.com/20200125-windows-change-mstsc-port/","excerpt":"é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥ä¿®æ”¹windowsè¿œç¨‹çš„3389ç«¯å£å·ä»è€Œæå‡ä¸€å®šçš„å®‰å…¨æ€§ã€‚","text":"é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥ä¿®æ”¹windowsè¿œç¨‹çš„3389ç«¯å£å·ä»è€Œæå‡ä¸€å®šçš„å®‰å…¨æ€§ã€‚ é¦–å…ˆæŒ‰win+Ræ‰“å¼€è¿è¡Œçª—å£ï¼Œç„¶åè¾“å…¥regeditæ‰“å¼€æ³¨å†Œè¡¨ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å®šä½åˆ°æ³¨å†Œè¡¨çš„è¿™ä¸ªä½ç½® 1è®¡ç®—æœº\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp æ‰¾åˆ°PortNumberï¼Œæ³¨æ„éœ€è¦å‹¾é€‰åè¿›åˆ¶å†è¿›è¡Œä¿®æ”¹ï¼ŒæŠŠé»˜è®¤çš„3389ç«¯å£å·æ”¹ä¸ºå…¶ä»–çš„ç«¯å£å·å³å¯ï¼Œå»ºè®®ä¿®æ”¹ä¸ºä¸€ä¸ªè¾ƒå¤§çš„ç«¯å£å·ï¼Œè¿™æ ·ä¸å®¹æ˜“ä¸å…¶ä»–ç¨‹åºçš„ç«¯å£å·äº§ç”Ÿå†²çªã€‚ æœ€åé‡å¯ç”µè„‘å³å¯ç”Ÿæ•ˆï¼Œä¹‹åå†ä½¿ç”¨è¿œç¨‹çš„æ—¶å€™è®°å¾—è¦åœ¨IPåœ°å€åé¢åŠ ä¸Šè‹±æ–‡å†’å·å’Œç«¯å£å·ï¼Œå¦‚ï¼š192.168.66.66:23333ï¼Œå¦‚æœä¸æ‰‹åŠ¨æŒ‡å®šå°±æ˜¯é»˜è®¤çš„3389ç«¯å£å·äº†ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"}]},{"title":"ä½¿ç”¨ntfsfixè§£å†³Linuxä¸‹æ— æ³•æŒ‚è½½NTFSç¡¬ç›˜çš„é—®é¢˜","slug":"20200120-linux-ntfsfix-ntfs","date":"2020-01-20T09:00:00.000Z","updated":"2020-01-20T09:00:00.000Z","comments":true,"path":"20200120-linux-ntfsfix-ntfs/","link":"","permalink":"https://tinychen.com/20200120-linux-ntfsfix-ntfs/","excerpt":"ä½¿ç”¨ntfsfixè§£å†³Linuxä¸‹æ— æ³•æŒ‚è½½NTFSç¡¬ç›˜çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯ç”±ç¡¬ç›˜åˆ†åŒºçš„$MFTæ–‡ä»¶å‡ºç°äº†é—®é¢˜ï¼Œå¯ä»¥åœ¨windowsä¸‹ä½¿ç”¨chkdskå‘½ä»¤æˆ–è€…åœ¨Linuxä¸‹ä½¿ç”¨ntfsfixæ¥è¿›è¡Œä¿®å¤ã€‚","text":"ä½¿ç”¨ntfsfixè§£å†³Linuxä¸‹æ— æ³•æŒ‚è½½NTFSç¡¬ç›˜çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯ç”±ç¡¬ç›˜åˆ†åŒºçš„$MFTæ–‡ä»¶å‡ºç°äº†é—®é¢˜ï¼Œå¯ä»¥åœ¨windowsä¸‹ä½¿ç”¨chkdskå‘½ä»¤æˆ–è€…åœ¨Linuxä¸‹ä½¿ç”¨ntfsfixæ¥è¿›è¡Œä¿®å¤ã€‚ é¦–å…ˆæ˜¯æ•…éšœè¯¦æƒ… 12345678910[tinychen@tiny-openstack Movies]$ sudo mount /dev/sda1 $MFTMirr does not match $MFT (record 3).Failed to mount &#x27;/dev/sda1&#x27;: Input/output errorNTFS is either inconsistent, or there is a hardware fault, or it&#x27;s aSoftRAID/FakeRAID hardware. In the first case run chkdsk /f on Windowsthen reboot into Windows twice. The usage of the /f parameter is veryimportant! If the device is a SoftRAID/FakeRAID then first activateit and mount a different device under the /dev/mapper/ directory, (e.g./dev/mapper/nvidia_eahaabcc1). Please see the &#x27;dmraid&#x27; documentationfor more details. æ¥ç€æˆ‘åœ¨askubuntuä¸Šé¢çœ‹åˆ°äº†ä¸€ä¸ªåŒæ ·çš„æƒ…å†µï¼Œé«˜èµå›ç­”é‡Œé¢è¯´æ˜¯$MFTæ–‡ä»¶å‡ºç°äº†é—®é¢˜ï¼Œwindowsä¸‹å¯ä»¥ä½¿ç”¨chkdskè¿›è¡Œä¿®å¤ï¼Œä¹‹å‰å†™è¿‡ç›¸å…³çš„æ“ä½œæ•™ç¨‹ï¼Œè¿™æ¬¡å°è¯•ä¸€ä¸‹ä½¿ç”¨Linuxä¸‹çš„ntfsfixæ¥ä¿®å¤ã€‚ è¿™é‡Œéœ€è¦äº‹å…ˆå®‰è£…å¥½ntfsprogsè¿™ä¸ªå·¥å…·ï¼Œubuntuä¸‹ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨aptå®‰è£…ï¼Œä¸‹é¢ä½¿ç”¨çš„æ˜¯CentOS7ä½œä¸ºç¤ºèŒƒã€‚ 1234567891011121314151617[tinychen@tiny-openstack ~]$ sudo yum install ntfsprogs[tinychen@tiny-openstack ~]$ sudo ntfsfix /dev/sda1Mounting volume... $MFTMirr does not match $MFT (record 3).FAILEDAttempting to correct errors... Processing $MFT and $MFTMirr...Reading $MFT... OKReading $MFTMirr... OKComparing $MFTMirr to $MFT... FAILEDCorrecting differences in $MFTMirr record 3...OKProcessing of $MFT and $MFTMirr completed successfully.Setting required flags on partition... OKGoing to empty the journal ($LogFile)... OKChecking the alternate boot sector... OKNTFS volume version is 3.1.NTFS partition /dev/sda1 was processed successfully. ä¿®å¤å®Œæˆä¹‹åæˆ‘ä»¬ç›´æ¥è¿›è¡ŒæŒ‚è½½ï¼Œè¿™æ¬¡æ²¡æœ‰æŠ¥é”™ï¼Œå¯ä»¥æ­£å¸¸è¯»å†™é‡Œé¢çš„æ–‡ä»¶äº†ã€‚ 1[tinychen@tiny-openstack ~]$ sudo mount /dev/sda1 ç”±äºè¿™é‡Œå·²ç»åœ¨/etc/fstabæ–‡ä»¶ä¸­åˆ¶å®šäº†æŒ‚è½½çš„ç›®å½•å’Œæ–¹å¼ï¼Œæ‰€ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œé¢æŒ‡å®šè¦æŒ‚è½½çš„è®¾å¤‡å·å°±èƒ½æ ¹æ®/etc/fstabå†…çš„ä¿¡æ¯è¿›è¡ŒæŒ‚è½½ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"å¸¸ç”¨çš„é«˜æ•ˆgnomeæ’ä»¶ä»¥åŠä¸»é¢˜çš„ä¸‹è½½åœ°å€","slug":"20200110-gnome-extension-recommand","date":"2020-01-10T02:00:00.000Z","updated":"2020-01-10T02:00:00.000Z","comments":true,"path":"20200110-gnome-extension-recommand/","link":"","permalink":"https://tinychen.com/20200110-gnome-extension-recommand/","excerpt":"åœ¨CentOS7ä¸Šä½¿ç”¨Gnome3.26ç‰ˆæœ¬è¿›è¡Œå®‰è£…æµ‹è¯•ï¼Œå¤§å¤šæ•°çš„æ’ä»¶éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸»é¢˜çš„å·¥ä½œæƒ…å†µè‰¯å¥½ï¼Œä¸‹é¢çš„æ¨èæ’ä»¶å…¨éƒ¨åŒæ—¶å¯ç”¨ä¼šå‘ç”Ÿå†²çªï¼Œå®é™…éœ€è¦å¯ç”¨é‚£äº›æ’ä»¶å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚è¿›è¡Œé€‰æ‹©ã€‚ æ³¨ï¼šgrubç•Œé¢çš„å¼•å¯¼ç¾åŒ–åœ¨CentOS7ä¸Šé¢æš‚æœªæˆåŠŸã€‚","text":"åœ¨CentOS7ä¸Šä½¿ç”¨Gnome3.26ç‰ˆæœ¬è¿›è¡Œå®‰è£…æµ‹è¯•ï¼Œå¤§å¤šæ•°çš„æ’ä»¶éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸»é¢˜çš„å·¥ä½œæƒ…å†µè‰¯å¥½ï¼Œä¸‹é¢çš„æ¨èæ’ä»¶å…¨éƒ¨åŒæ—¶å¯ç”¨ä¼šå‘ç”Ÿå†²çªï¼Œå®é™…éœ€è¦å¯ç”¨é‚£äº›æ’ä»¶å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚è¿›è¡Œé€‰æ‹©ã€‚ æ³¨ï¼šgrubç•Œé¢çš„å¼•å¯¼ç¾åŒ–åœ¨CentOS7ä¸Šé¢æš‚æœªæˆåŠŸã€‚ 1ã€å‡†å¤‡å·¥ä½œå®‰è£…gnome-tweak-toolä½¿ç”¨yumå®‰è£…tweakæ¥ç®¡ç†gnomeçš„ç•Œé¢è®¾ç½®å’Œæ’ä»¶ 1sudo yum install gnome-tweak-tool chrome-gnome-shell å®‰è£…gnome-shell-integrationå®‰è£…æµè§ˆå™¨æ’ä»¶ï¼Œä¸€èˆ¬æ¥è¯´åœ¨gnomeå®˜ç½‘ç•Œé¢ä¸Šä¼šæé†’å®‰è£…ï¼Œç«ç‹å’Œè°·æ­Œéƒ½æ”¯æŒè¯¥æ’ä»¶ï¼Œå¦‚æœæ²¡æœ‰æé†’ï¼Œå¯ä»¥ç›´æ¥å»æµè§ˆå™¨çš„æ’ä»¶ä¸­å¿ƒæœç´¢ã€‚ 2ã€Gnome shell Extensionä¸€èˆ¬æ¥è¯´éœ€è¦çš„æ’ä»¶éƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼šgnomeçš„æ’ä»¶çš„å®˜ç½‘https://extensions.gnome.org/ User Themeshttps://extensions.gnome.org/extension/19/user-themes/ä½¿shellç•Œé¢å¯ä»¥ä½¿ç”¨ä¸»é¢˜ Dash to Dockhttps://extensions.gnome.org/extension/307/dash-to-dock/æŠŠdashæ å˜æˆmacé‚£æ ·å­çš„dockæ  Dash to Panelhttps://extensions.gnome.org/extension/1160/dash-to-panel/æŠŠdashæ å’Œæœ€ä¸Šé¢çš„ä»»åŠ¡æ åˆå¹¶å˜æˆç±»ä¼¼windowsçš„ä»»åŠ¡æ  Unblank screen saverhttps://extensions.gnome.org/extension/1414/unblank/é”å±çš„æ—¶å€™ä½¿æ˜¾ç¤ºå™¨ä¸è‡ªåŠ¨é»‘å± Coverflow Alt-Tabhttps://extensions.gnome.org/extension/97/coverflow-alt-tab/å¤šä»»åŠ¡åˆ‡æ¢çš„æ—¶å€™æä¾›åŠ¨æ€ç‰¹æ•ˆ CPU Power Managerhttps://extensions.gnome.org/extension/945/cpu-power-manager/åœ¨ä»»åŠ¡æ åŠ¨æ€æ˜¾ç¤ºCPUçš„å·¥ä½œé¢‘ç‡ï¼ŒåŒæ—¶å¯ä»¥è°ƒèŠ‚CPUçš„å·¥ä½œæ¨¡å¼ NetSpeedhttps://extensions.gnome.org/extension/104/netspeed/åœ¨ä»»åŠ¡æ å®æ—¶åŠ¨æ€æ˜¾ç¤ºç½‘é€Ÿ Resource Monitorhttps://extensions.gnome.org/extension/1634/resource-monitor/åœ¨ä»»åŠ¡æ æ˜¾ç¤ºCPUã€å†…å­˜ã€ç¡¬ç›˜ã€ç½‘é€Ÿç­‰çŠ¶æ€ä¿¡æ¯ Pixel Saverhttps://extensions.gnome.org/extension/723/pixel-saver/æŠŠç¨‹åºçš„èœå•æ å’Œæœ€é¡¶ç«¯çš„ä»»åŠ¡æ åˆå¹¶ç”¨äºèŠ‚çœå±å¹•ç©ºé—´ Hide Top Barhttps://extensions.gnome.org/extension/545/hide-top-bar/éšè—æœ€é¡¶ç«¯çš„ä»»åŠ¡æ  3ã€æ¡Œé¢ä¸»é¢˜ç¾åŒ–è¿™é‡Œåªæ¨èå‡ ä¸ªçƒ­é—¨çš„ä¸»é¢˜ï¼Œå…¶ä»–çš„å¯ä»¥åœ¨ä¸‹é¢çš„ç½‘å€ä¸Šé¢æ…¢æ…¢æ‰¾ï¼Œä¸€èˆ¬githubåœ°å€éƒ½æœ‰è‡ªåŠ¨å®‰è£…è„šæœ¬ã€‚gnomeä¸»é¢˜ä¸‹è½½å®˜ç½‘https://www.gnome-look.org/ vimxç³»åˆ—ä¸»é¢˜githubåœ°å€https://github.com/vinceliuice/vimix-gtk-themes å›¾æ ‡githubåœ°å€https://github.com/vinceliuice/vimix-icon-theme grubå¼•å¯¼ç•Œé¢ä¸‹è½½åœ°å€https://www.gnome-look.org/p/1009236/ è‹¹æœmacç³»é£æ ¼Mojavaä¸»é¢˜githubåœ°å€https://github.com/vinceliuice/Mojave-gtk-theme Sierraä¸»é¢˜githubåœ°å€https://github.com/vinceliuice/Sierra-gtk-theme 4ã€æ‰‹åŠ¨ç¦»çº¿å®‰è£…åœ¨æ— æ³•ä½¿ç”¨æµè§ˆå™¨æ’ä»¶ä¸€é”®å®‰è£…çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œæ‰‹åŠ¨ä¸‹è½½å®‰è£…åŒ…è¿›è¡Œç¦»çº¿å®‰è£…ï¼Œéœ€è¦æ³¨æ„è¿˜æ˜¯è¦æå‰å®‰è£…å¥½gnome-tweaksã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344# æŸ¥çœ‹è‡ªå·±çš„gnome-shellç‰ˆæœ¬[tinychen@tiny-station unblank]$ gnome-shell --versionGNOME Shell 3.34.4# è¿™é‡Œå»ºè®®ä½¿ç”¨éœ€è¦ç™»å½•gnomeæ¡Œé¢çš„ç”¨æˆ·æ“ä½œ# åœ¨ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹.local/share/gnome-shell/æ–°å»ºä¸€ä¸ªextensionsçš„æ–‡ä»¶å¤¹[tinychen@tiny-station Downloads]$ cd ~/.local/share/gnome-shell/[tinychen@tiny-station gnome-shell]$ mkdir extensions# å°†ä¸‹è½½è§£å‹å¥½çš„æ’ä»¶å¤åˆ¶åˆ°extensionsç›®å½•ä¸‹[tinychen@tiny-station gnome-shell]$ cd extensions/[tinychen@tiny-station extensions]$ cp -r ~/Downloads/dash-to-paneljderose9.github.com.v29.shell-extension/ ./# è¿›å…¥æ’ä»¶ç›®å½•ä¸­ä¿®æ”¹metadata.jsonæ–‡ä»¶# éœ€è¦ä¿è¯æ’ä»¶ç›®å½•ä¸­çš„metadata.jsonæ–‡ä»¶çš„uuidå±æ€§å€¼å’Œæ’ä»¶å­˜æ”¾çš„æ–‡ä»¶å¤¹ä¸€è‡´[tinychen@tiny-station extensions]$ mv dash-to-paneljderose9.github.com.v29.shell-extension/ dash-to-panel[tinychen@tiny-station extensions]$ cd dash-to-panel/[tinychen@tiny-station dash-to-panel]$ cat metadata.json &#123; &quot;_generated&quot;: &quot;Generated by SweetTooth, do not edit&quot;, &quot;description&quot;: &quot;An icon taskbar for the Gnome Shell. This extension moves the dash into the gnome main panel so that the application launchers and system tray are combined into a single panel, similar to that found in KDE Plasma and Windows 7+. A separate dock is no longer needed for easy access to running and favorited applications.\\n\\nFor a more traditional experience, you may also want to use Tweak Tool to enable Windows &amp;amp;amp;amp;amp;gt; Titlebar Buttons &amp;amp;amp;amp;amp;gt; Minimize &amp;amp;amp;amp;amp;amp; Maximize.\\n\\nFor the best support, please report any issues on Github. Dash-to-panel is developed and maintained by @jderose9 and @charlesg99.&quot;, &quot;extension-id&quot;: &quot;dash-to-panel&quot;, &quot;gettext-domain&quot;: &quot;dash-to-panel&quot;, &quot;name&quot;: &quot;Dash to Panel&quot;, &quot;shell-version&quot;: [ &quot;3.18&quot;, &quot;3.20&quot;, &quot;3.22&quot;, &quot;3.24&quot;, &quot;3.26&quot;, &quot;3.28&quot;, &quot;3.30&quot;, &quot;3.34&quot;, &quot;3.32&quot;, &quot;3.36&quot; ], &quot;url&quot;: &quot;https://github.com/jderose9/dash-to-panel&quot;, &quot;uuid&quot;: &quot;dash-to-panel&quot;, &quot;version&quot;: 29&#125;# ç„¶åæˆ‘ä»¬éœ€è¦é‡å¯gnome-shellæ¡Œé¢ï¼ŒåŒæ—¶æŒ‰ä¸‹ALT+F2ï¼Œç„¶ååœ¨å¼¹å‡ºçš„è¾“å…¥æ¡†ä¸­è¾“å…¥rå†å›è½¦å³å¯é‡å¯# æ­¤å¤–è¿˜æœ‰gnome-tweaksä¹Ÿéœ€è¦é‡å¯","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"gnome","slug":"gnome","permalink":"https://tinychen.com/tags/gnome/"}]},{"title":"åœ¨CentOSä¸­ä½¿ç”¨yumå®‰è£…chromeæµè§ˆå™¨","slug":"20200105-centos-install-chrome","date":"2020-01-05T00:00:00.000Z","updated":"2020-01-05T00:00:00.000Z","comments":true,"path":"20200105-centos-install-chrome/","link":"","permalink":"https://tinychen.com/20200105-centos-install-chrome/","excerpt":"åœ¨CentOSä¸Šä½¿ç”¨yumå®‰è£…chromeæµè§ˆå™¨ï¼Œå®æµ‹åœ¨CentOS7å’ŒCentOS8ä¸­éƒ½å¯ä»¥æ­£å¸¸æ“ä½œï¼Œéœ€è¦ä¿è¯èƒ½å¤Ÿç›´æ¥è®¿é—®è°·æ­Œã€‚","text":"åœ¨CentOSä¸Šä½¿ç”¨yumå®‰è£…chromeæµè§ˆå™¨ï¼Œå®æµ‹åœ¨CentOS7å’ŒCentOS8ä¸­éƒ½å¯ä»¥æ­£å¸¸æ“ä½œï¼Œéœ€è¦ä¿è¯èƒ½å¤Ÿç›´æ¥è®¿é—®è°·æ­Œã€‚ å»ºç«‹ä¸€ä¸ªyumä»“åº“ 12345678cat &gt;&gt; /etc/yum.repos.d/google-chrome.repo &lt;&lt;EOF[google-chrome]name=google-chromebaseurl=https://dl.google.com/linux/chrome/rpm/stable/\\$basearchenabled=1gpgcheck=1gpgkey=https://dl-ssl.google.com/linux/linux_signing_key.pubEOF ä½¿ç”¨yumå‘½ä»¤è¿›è¡Œå®‰è£… 1234yum repolistyum install google-chrome-stable# å¦‚æœå‡ºç°gpgkeyè®¤è¯æˆ–æ£€éªŒå¤±è´¥ï¼Œå¯ä»¥æ·»åŠ  --nogpgcheckå‚æ•°ï¼Œæ•ˆæœå’Œä¸Šé¢çš„æŠŠyumä»“åº“çš„`gpgcheck`é€‰é¡¹æ”¹ä¸º`0`ä¸€æ ·ï¼Œåªä¸è¿‡å‰é¢æ˜¯ä»…è¿™æ¬¡ç”Ÿæ•ˆï¼Œåè€…æ˜¯æ°¸ä¹…ç”Ÿæ•ˆã€‚yum install google-chrome-stable --nogpgcheck","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"yum","slug":"yum","permalink":"https://tinychen.com/tags/yum/"}]},{"title":"åœ¨CentOSä¸­ä½¿ç”¨nuxæºå®‰è£…shutter","slug":"20200103-centos7-nux-install-shutter","date":"2020-01-03T07:00:00.000Z","updated":"2020-01-03T07:00:00.000Z","comments":true,"path":"20200103-centos7-nux-install-shutter/","link":"","permalink":"https://tinychen.com/20200103-centos7-nux-install-shutter/","excerpt":"shutterå’Œflameshotéƒ½æ˜¯Linuxä¸‹å¾ˆå¼ºå¤§çš„æˆªå›¾è½¯ä»¶ï¼Œä¹‹å‰åœ¨Ubuntuä¸Šé¢ä¸€ç›´ä½¿ç”¨flameshotæ„Ÿè§‰ä¸é”™ï¼Œç°åœ¨æ¢åˆ°äº†CentOS7ï¼Œæ”¹ç”¨NUX_Desktopæºæ¥å®‰è£…shutterã€‚","text":"shutterå’Œflameshotéƒ½æ˜¯Linuxä¸‹å¾ˆå¼ºå¤§çš„æˆªå›¾è½¯ä»¶ï¼Œä¹‹å‰åœ¨Ubuntuä¸Šé¢ä¸€ç›´ä½¿ç”¨flameshotæ„Ÿè§‰ä¸é”™ï¼Œç°åœ¨æ¢åˆ°äº†CentOS7ï¼Œæ”¹ç”¨NUX_Desktopæºæ¥å®‰è£…shutterã€‚ nux desktopä»“åº“å®˜ç½‘ï¼šhttp://li.nux.ro/repos.html éœ€è¦æ³¨æ„çš„æ˜¯nuxæºç›®å‰åªæ”¯æŒçº¢å¸½ç³»Linuxçš„6å’Œ7ç³»åˆ—ï¼Œæš‚æœªæ”¯æŒ8ç³»çš„çº¢å¸½Linux å®‰è£…æ­¥éª¤ååˆ†ç®€å•ï¼Œéœ€è¦å…ˆå¯ç”¨epelæºï¼Œå†å¯¼å…¥nuxæºï¼Œæ¥ç€æ›´æ–°yumæºï¼Œæœ€åå®‰è£…shutterå³å¯ã€‚ 1234sudo yum -y install epel-releasesudo rpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpmsudo yum repolist sudo yum install shutter","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"yum","slug":"yum","permalink":"https://tinychen.com/tags/yum/"}]},{"title":"åœ¨CentOS7ä¸­ä½¿ç”¨RDOå®‰è£…OpenStack-Stein-AIO","slug":"20200102-centos7-rdo-install-openstack","date":"2020-01-02T07:00:00.000Z","updated":"2020-01-02T07:00:00.000Z","comments":true,"path":"20200102-centos7-rdo-install-openstack/","link":"","permalink":"https://tinychen.com/20200102-centos7-rdo-install-openstack/","excerpt":"æœ¬æ–‡ä¸»è¦è®°å½•äº†åœ¨CentOS7.7ç³»ç»Ÿï¼ˆç‰©ç†æœºï¼‰ä¸‹ä½¿ç”¨çº¢å¸½å®˜æ–¹çš„RDOå·¥å…·è¿›è¡ŒOpenStackçš„all-in-oneæ¨¡å¼éƒ¨ç½²ã€‚å…³äºå®¿ä¸»æœºçš„ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»åšè¿‡äº†è¯¦ç»†çš„ä»‹ç»å’Œæµ‹è¯•ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚","text":"æœ¬æ–‡ä¸»è¦è®°å½•äº†åœ¨CentOS7.7ç³»ç»Ÿï¼ˆç‰©ç†æœºï¼‰ä¸‹ä½¿ç”¨çº¢å¸½å®˜æ–¹çš„RDOå·¥å…·è¿›è¡ŒOpenStackçš„all-in-oneæ¨¡å¼éƒ¨ç½²ã€‚å…³äºå®¿ä¸»æœºçš„ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»åšè¿‡äº†è¯¦ç»†çš„ä»‹ç»å’Œæµ‹è¯•ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚ 1ã€RDOç®€ä»‹æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å®˜ç½‘çš„ä»‹ç»ï¼š RDO is a community of people using and deploying OpenStack on CentOS, Fedora, and Red Hat Enterprise Linux. We have documentation to help get started, mailing lists where you can connect with other users, and community-supported packages of the most up-to-date OpenStack releases available for download. ç®€å•æ¥è¯´RDOå°±æ˜¯çº¢å¸½æ¨å‡ºçš„ä¸€ä¸ªé’ˆå¯¹çº¢å¸½ç³»çš„æ“ä½œç³»ç»Ÿï¼ˆRHELã€CentOSã€Fedoraï¼‰çš„ç®€åŒ–OpenStackå®‰è£…çš„å·¥å…·ï¼Œå®šä½ç±»ä¼¼äºRHELå’ŒFedoraçš„å…³ç³»ï¼Œæ˜¯å±äºç¤¾åŒºç»´æŠ¤çš„å…è´¹ç‰ˆï¼ˆä¹Ÿæœ‰ç±»ä¼¼RHELçš„ä»˜è´¹æ”¯æŒç‰ˆï¼‰ï¼Œç›®å‰æ”¯æŒåˆ°æœ€æ–°çš„Steinç‰ˆæœ¬çš„OpenStackçš„è‡ªåŠ¨å®‰è£…ï¼Œè€ŒOpenStackçš„å¼€å‘è¿›åº¦ç›®å‰æ˜¯å¤„äºTrainç‰ˆæœ¬ã€‚ RDOå’Œdevstackçš„åŒºåˆ« devstackæ˜¯ç”±openstackå®˜æ–¹è¿›è¡Œç»´æŠ¤çš„ï¼Œè€ŒRDOæ˜¯ç”±çº¢å¸½å‘èµ·çš„ï¼Œé€šè¿‡å¼€æºç¤¾åŒºè¿›è¡Œç»´æŠ¤ devstackæ”¯æŒubuntuã€çº¢å¸½ç³»å’Œopensuseä¸‰å¤§ä¸»æµçš„Linuxæ“ä½œç³»ç»Ÿï¼Œè€ŒRDOåªæ”¯æŒçº¢å¸½ç³» çº¢å¸½ç³»Linuxéƒ¨ç½²OpenStackä¸ªäººæ¨èä½¿ç”¨RDO 2ã€éƒ¨ç½²å®‰è£…å®˜ç½‘çš„å®‰è£…è¯´æ˜é“¾æ¥ï¼š https://www.rdoproject.org/install/packstack/ 2.1 ç¡¬ä»¶è¦æ±‚éƒ¨ç½²ä»…æ”¯æŒ64ä½æ“ä½œç³»ç»Ÿï¼Œè¦æ±‚ç³»ç»Ÿå†…å­˜æœ€å°‘ä¸º16Gï¼Œæœ€å°‘æœ‰ä¸€ä¸ªç½‘å¡ï¼Œæœ€å¥½ä¸ºé™æ€IPï¼Œä¸”éœ€è¦å¼€å¯CPUè™šæ‹ŸåŒ–æ”¯æŒã€‚ 2.2 ç¯å¢ƒè¯­è¨€è®¾ç½®å¦‚æœCentOSçš„é»˜è®¤è¯­è¨€é€‰æ‹©çš„æ˜¯éè‹±è¯­ï¼Œéœ€è¦åœ¨ /etc/environment æ–‡ä»¶ä¸­ä¿®æ”¹ï¼š 12LANG=en_US.utf-8LC_ALL=en_US.utf-8 2.3 RDOåº“è¦æ±‚ Enabling the Optional, Extras, and RH Common channels on RHEL If using RHEL it is assumed that you have registered your system using Red Hat Subscription Management and that you have the rhel-7-server-rpms repository enabled by default. RDO also needs the Optional, Extras, and RH Common channels to be enabled: 12$ sudo subscription-manager repos --enable=rhel-7-server-optional-rpms \\--enable=rhel-7-server-extras-rpms --enable=rhel-7-server-rh-common-rpms The Optional channel does not exist in CentOS or Scientific Linux. The required packages are included in the main repositories for those distributions. Extras is enabled by default on CentOS 7. å¯¹äºCentOS7è€Œè¨€ï¼Œåªéœ€è¦ç”¨åˆ°è‡ªå¸¦çš„ä¸»è¦çš„mainå’Œextrasä¸¤ä¸ªåº“ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤çš„/etc/yum.repos.d/CentOS-Base.repoçš„[base]å’Œ[extras]ä¸¤ä¸ªåº“ï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥è‡ªè¡Œæ¢æˆå›½å†…çš„é•œåƒæºå¦‚é˜¿é‡Œã€ç½‘æ˜“ã€æ¸…åã€ä¸­ç§‘å¤§ç­‰é•œåƒæºæ¥æé«˜é€Ÿåº¦ã€‚ 2.4 ç½‘ç»œè®¾ç½®è¿™é‡Œéœ€è¦é…ç½®ç½‘å¡ä¸ºé™æ€IPï¼Œç¦ç”¨é˜²ç«å¢™ï¼Œç„¶åæŠŠé»˜è®¤çš„ç½‘ç»œç®¡ç†å·¥å…·ä»NetworkManageræ¢æˆnetworkã€‚ 123456sudo systemctl disable firewalldsudo systemctl stop firewalldsudo systemctl disable NetworkManagersudo systemctl stop NetworkManagersudo systemctl enable networksudo systemctl start network 2.5 éƒ¨ç½²å®‰è£…12345678910# å®‰è£…OpenStackéœ€è¦ä½¿ç”¨çš„yumä»“åº“å¹¶ç¡®ä¿ä»“åº“å·²ç»è¢«æ­£å¸¸å¯ç”¨# è¿™é‡Œä½¿ç”¨çš„æ˜¯RDOæ”¯æŒçš„æœ€æ–°çš„steinç‰ˆæœ¬ï¼Œéœ€è¦æ—§ç‰ˆæœ¬çš„å¯ä»¥åœ¨è¿™é‡ŒæŸ¥æ‰¾ï¼š http://rdoproject.org/repos/ sudo yum install -y centos-release-openstack-steinsudo yum-config-manager --enable openstack-stein# æ›´æ–°yumæºsudo yum update -y# å®‰è£…packstacksudo yum install -y openstack-packstack# ä½¿ç”¨packstackå®‰è£…OpenStacksudo packstack --allinone æ¥ä¸‹æ¥çš„éƒ¨ç½²å®‰è£…å°±ååˆ†ç®€å•äº†ï¼Œåªéœ€è¦ä¿è¯ç³»ç»Ÿå’Œç½‘ç»œæ­£å¸¸ï¼Œç„¶åè€å¿ƒç­‰å¾…ï¼Œæ ¹æ®ç”µè„‘çš„æ€§èƒ½ä¸åŒï¼Œå®‰è£…çš„æ—¶é—´ä¹Ÿä¸å°½ç›¸åŒï¼Œæˆ‘å¤§æ¦‚æ˜¯èŠ±äº†15åˆ†é’Ÿå·¦å³å°±ä¸€æ¬¡éƒ¨ç½²æˆåŠŸã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071 [root@tiny-openstack ~]# sudo packstack --allinone Welcome to the Packstack setup utility The installation log file is available at: /var/tmp/packstack/20200102-115042-h_xYXR/openstack-setup.log Packstack changed given value to required value /root/.ssh/id_rsa.pub Installing: Clean Up [ DONE ] Discovering ip protocol version [ DONE ] Setting up ssh keys [ DONE ] Preparing servers [ DONE ] Pre installing Puppet and discovering hosts&#x27; details [ DONE ] Preparing pre-install entries [ DONE ] Setting up CACERT [ DONE ] Preparing AMQP entries [ DONE ] Preparing MariaDB entries [ DONE ] Fixing Keystone LDAP config parameters to be undef if empty[ DONE ] Preparing Keystone entries [ DONE ] Preparing Glance entries [ DONE ] Checking if the Cinder server has a cinder-volumes vg[ DONE ] Preparing Cinder entries [ DONE ] Preparing Nova API entries [ DONE ] Creating ssh keys for Nova migration [ DONE ] Gathering ssh host keys for Nova migration [ DONE ] Preparing Nova Compute entries [ DONE ] Preparing Nova Scheduler entries [ DONE ] Preparing Nova VNC Proxy entries [ DONE ] Preparing OpenStack Network-related Nova entries [ DONE ] Preparing Nova Common entries [ DONE ] Preparing Neutron LBaaS Agent entries [ DONE ] Preparing Neutron API entries [ DONE ] Preparing Neutron L3 entries [ DONE ] Preparing Neutron L2 Agent entries [ DONE ] Preparing Neutron DHCP Agent entries [ DONE ] Preparing Neutron Metering Agent entries [ DONE ] Checking if NetworkManager is enabled and running [ DONE ] Preparing OpenStack Client entries [ DONE ] Preparing Horizon entries [ DONE ] Preparing Swift builder entries [ DONE ] Preparing Swift proxy entries [ DONE ] Preparing Swift storage entries [ DONE ] Preparing Gnocchi entries [ DONE ] Preparing Redis entries [ DONE ] Preparing Ceilometer entries [ DONE ] Preparing Aodh entries [ DONE ] Preparing Puppet manifests [ DONE ] Copying Puppet modules and manifests [ DONE ] Applying 192.168.100.90_controller.pp Testing if puppet apply is finished: 192.168.100.90_controller.pp [ - ] 192.168.100.90_controller.pp: [ DONE ] Applying 192.168.100.90_network.pp 192.168.100.90_network.pp: [ DONE ] Applying 192.168.100.90_compute.pp 192.168.100.90_compute.pp: [ DONE ] Applying Puppet manifests [ DONE ] Finalizing [ DONE ]â€‹ Installation completed successfully ** Additional information: * Parameter CONFIG_NEUTRON_L2_AGENT: You have choosen OVN neutron backend. Note that this backend does not support LBaaS, VPNaaS or FWaaS services. Geneve will be used as encapsulation method for tenant networks * A new answerfile was created in: /root/packstack-answers-20200102-115042.txt * Time synchronization installation was skipped. Please note that unsynchronized time on server instances might be problem for some OpenStack components. * File /root/keystonerc_admin has been created on OpenStack client host 192.168.100.90. To use the command line tools you need to source the file. * To access the OpenStack Dashboard browse to http://192.168.100.90/dashboard . Please, find your login credentials stored in the keystonerc_admin in your home directory. * The installation log file is available at: /var/tmp/packstack/20200102-115042-h_xYXR/openstack-setup.log * The generated manifests are available at: /var/tmp/packstack/20200102-115042-h_xYXR/manifests 2.6 ç™»å½•è¿è¡Œç•™æ„ä¸Šé¢çš„å®‰è£…å®Œæˆæç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å‡ ä¸ªé‡è¦ä¿¡æ¯ï¼š dashboardçš„ç™»å½•é“¾æ¥ä¸€èˆ¬å°±æ˜¯http://ä½ ç”¨æ¥éƒ¨ç½²OpenStackçš„ç½‘å¡IP/dashboard ç™»å½•çš„è´¦å·å¯†ç æ–‡ä»¶åœ¨homeç›®å½•ä¸‹çš„keystonerc_adminæ–‡ä»¶ï¼Œä¸€èˆ¬ä½¿ç”¨rootè´¦æˆ·éƒ¨ç½²ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯åœ¨/root/ä¸‹ éƒ¨ç½²çš„é…ç½®æ–‡ä»¶æ˜¯/root/packstack-answers-20200102-115042.txtï¼Œæ ¹æ®éƒ¨ç½²çš„æ—¶é—´ä¸åŒï¼Œåé¢çš„æ•°å­—ä¼šä¸ä¸€æ ·ï¼Œè¿™ä¸ªanswer-fileå¯ä»¥ç”¨äºä¸‹æ¬¡ç»§ç»­éƒ¨ç½²ï¼Œåªè¦åœ¨éƒ¨ç½²çš„æ—¶å€™ä½¿ç”¨ --answer-file é€‰é¡¹å³å¯","categories":[{"name":"sre","slug":"sre","permalink":"https://tinychen.com/categories/sre/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"openstack","slug":"openstack","permalink":"https://tinychen.com/tags/openstack/"}]},{"title":"åœ¨CentOS7ä¸­ä½¿ç”¨elrepoæºå®‰è£…Nvidiaæ˜¾å¡é©±åŠ¨","slug":"20200102-centos7-elrepo-install-nvidia-driver","date":"2020-01-02T01:00:00.000Z","updated":"2020-01-02T01:00:00.000Z","comments":true,"path":"20200102-centos7-elrepo-install-nvidia-driver/","link":"","permalink":"https://tinychen.com/20200102-centos7-elrepo-install-nvidia-driver/","excerpt":"åœ¨CentOS7ä¸­ä½¿ç”¨elrepoæºæ¥è¿›è¡Œè‹±ä¼Ÿè¾¾æ˜¾å¡é©±åŠ¨çš„å®‰è£…ã€‚","text":"åœ¨CentOS7ä¸­ä½¿ç”¨elrepoæºæ¥è¿›è¡Œè‹±ä¼Ÿè¾¾æ˜¾å¡é©±åŠ¨çš„å®‰è£…ã€‚ é¦–å…ˆæ˜¯elrepoæºçš„å®˜ç½‘åœ°å€ï¼š http://elrepo.org/tiki/tiki-index.php ELRepo ä»“åº“æ˜¯åŸºäºç¤¾åŒºçš„ç”¨äºä¼ä¸šçº§ Linux ä»“åº“ï¼Œæä¾›å¯¹ RedHat Enterprise (RHEL) å’Œ å…¶ä»–åŸºäº RHELçš„ Linux å‘è¡Œç‰ˆï¼ˆCentOSã€Scientificã€Fedora ç­‰ï¼‰çš„æ”¯æŒã€‚ ELRepo èšç„¦äºå’Œç¡¬ä»¶ç›¸å…³çš„è½¯ä»¶åŒ…ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ã€æ˜¾å¡é©±åŠ¨ã€ç½‘ç»œé©±åŠ¨ã€å£°å¡é©±åŠ¨å’Œæ‘„åƒå¤´é©±åŠ¨ç­‰ã€‚ å¦‚æœè§‰å¾—ç½‘ç»œä¸ç¨³å®šä½¿ç”¨å®˜æ–¹çš„elrepoæºæ…¢çš„è¯å¯ä»¥å°è¯•ä¸€ä¸‹æŒ‡å®šé•œåƒæºä¸ºä¸­ç§‘å¤§çš„é•œåƒæºã€‚ 12sudo yum install https://www.elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpmsudo yum install kmod-nvidia åˆ°è¿™é‡Œå°±ç®—æ˜¯å®‰è£…å®Œæˆäº†ï¼Œä¹‹åä¹Ÿå¯ä»¥é€šè¿‡yumæ¥å¯¹é©±åŠ¨è¿›è¡Œå‡çº§ï¼ŒåŒæ—¶è‹±ä¼Ÿè¾¾å®˜ç½‘ä¹Ÿæœ‰æä¾›å®‰è£…é©±åŠ¨ï¼Œå…·ä½“ä½¿ç”¨å“ªä¸ªçœ‹åŒå­¦ä»¬è‡ªå·±çš„å®é™…éœ€æ±‚äº†ã€‚ æŸ¥çœ‹å®‰è£…å¥½é©±åŠ¨ä¹‹åçš„æ˜¾å¡ä¿¡æ¯ï¼š 1nvidia-smi","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"yum","slug":"yum","permalink":"https://tinychen.com/tags/yum/"}]},{"title":"Linuxä¸­å‡çº§pipå’Œæ›´æ¢pipé•œåƒæº","slug":"20191227-pip-source-upgrade","date":"2019-12-27T07:00:00.000Z","updated":"2019-12-27T07:00:00.000Z","comments":true,"path":"20191227-pip-source-upgrade/","link":"","permalink":"https://tinychen.com/20191227-pip-source-upgrade/","excerpt":"åœ¨Linuxä¸­å¯¹Pythonçš„pipè¿›è¡Œæ›´æ–°å’Œé•œåƒæºæ›¿æ¢ä¸ºå›½å†…çš„é•œåƒæºã€‚ç†è®ºä¸Šæ“ä½œå¯¹äºLinuxç³»ç»Ÿå‡é€‚ç”¨ï¼ŒPython2å’ŒPython3ä¹ŸåŒæ ·é€‚ç”¨ï¼Œä¸è¿‡Python2å°†åœ¨2020å¹´1æœˆ1æ—¥åœæ­¢æ”¯æŒï¼Œè¿™é‡Œéœ€è¦æé†’ä¸€ä¸‹å¤§å®¶è®°å¾—å°½å¿«å‡çº§è¿ç§»è‡ªå·±é¡¹ç›®å’Œç³»ç»Ÿä¸­ä½¿ç”¨çš„Pythonç‰ˆæœ¬ã€‚ æœ¬æ–‡çš„æ“ä½œä¼šä½¿ç”¨CentOS7+Python2å’ŒUbuntu18.04.3+Python3æ¥è¿›è¡Œæ¼”ç¤ºã€‚","text":"åœ¨Linuxä¸­å¯¹Pythonçš„pipè¿›è¡Œæ›´æ–°å’Œé•œåƒæºæ›¿æ¢ä¸ºå›½å†…çš„é•œåƒæºã€‚ç†è®ºä¸Šæ“ä½œå¯¹äºLinuxç³»ç»Ÿå‡é€‚ç”¨ï¼ŒPython2å’ŒPython3ä¹ŸåŒæ ·é€‚ç”¨ï¼Œä¸è¿‡Python2å°†åœ¨2020å¹´1æœˆ1æ—¥åœæ­¢æ”¯æŒï¼Œè¿™é‡Œéœ€è¦æé†’ä¸€ä¸‹å¤§å®¶è®°å¾—å°½å¿«å‡çº§è¿ç§»è‡ªå·±é¡¹ç›®å’Œç³»ç»Ÿä¸­ä½¿ç”¨çš„Pythonç‰ˆæœ¬ã€‚ æœ¬æ–‡çš„æ“ä½œä¼šä½¿ç”¨CentOS7+Python2å’ŒUbuntu18.04.3+Python3æ¥è¿›è¡Œæ¼”ç¤ºã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªä¸åŒç‰ˆæœ¬çš„pipï¼Œéœ€è¦ç¡®å®špipå‘½ä»¤æ‰€æŒ‡å‘çš„æ˜¯å¦æ˜¯éœ€è¦æ›´æ–°çš„pipç‰ˆæœ¬ã€‚ 1ã€å‡çº§pip1.1 ç›´æ¥ä½¿ç”¨pipå‡çº§pip123sudo python -m pip install --upgrade pip# æˆ–è€…é€‚ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¸¤ä¸ªçš„æ•ˆæœæ˜¯ä¸€æ ·çš„sudo pip install -U pip 1.2 é‡æ–°å®‰è£…pipå¦‚æœpipå‡ºç°äº†å¼‚å¸¸çŠ¶å†µæŸåäº†å¯¼è‡´ä¸èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°è¯•ä¸€ä¸‹é‡æ–°å®‰è£…pipï¼Œéœ€è¦æ³¨æ„çš„æ˜¯python-pipé»˜è®¤æŒ‡å‘çš„æ˜¯python2çš„pipï¼Œpython3-pipæ‰æ˜¯python3çš„pipï¼Œè¿˜æ˜¯éœ€è¦æ³¨æ„ä¸€ä¸‹ç‰ˆæœ¬çš„é—®é¢˜ã€‚ 1234# Ubuntu18.04.3sudo apt list | egrep &#x27;python.*pip&#x27;sudo apt remove python3-pipsudo apt install python3-pip 1234# CentOS7.7sudo yum list | egrep &#x27;python.*pip&#x27;sudo yum remove python3-pipsudo yum install python3-pip é‡æ–°å®‰è£…å®Œæˆä¹‹åï¼Œå†æ¬¡ä½¿ç”¨ä¸Šé¢1.1çš„å‘½ä»¤å¯¹pipè¿›è¡Œå‡çº§å³å¯ã€‚ 1.3 ä½¿ç”¨Pypaå®˜ç½‘å®‰è£…æ–‡ä»¶é‡è£…pipå¦‚æœä¸Šé¢ä¸¤ç§æ–¹æ³•éƒ½ä¸è¡Œï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ä½¿ç”¨Pypaå®˜ç½‘çš„æ–‡ä»¶æ¥è¿›è¡Œpipçš„é‡æ–°å®‰è£…ã€‚ æˆ‘ä»¬ä½¿ç”¨curlæˆ–è€…wgetå‘½ä»¤æ¥ä¸‹è½½å®‰è£…æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å¯¹åº”ç‰ˆæœ¬çš„pythonè¿›è¡Œå®‰è£…ã€‚ 123456# ä½¿ç”¨curlå°†æ–‡ä»¶å¦å­˜ä¸ºget-pip.pyåˆ°æœ¬åœ°curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py# æˆ–è€…ç›´æ¥ä½¿ç”¨wgetä¸‹è½½wget https://bootstrap.pypa.io/get-pip.py# ä½¿ç”¨pythonå¼ºåˆ¶é‡æ–°å®‰è£…pippython get-pip.py --force-reinstall ä½¿ç”¨è¿™ç§æ–¹æ³•å®‰è£…çš„pipç›´æ¥å°±æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œä¸éœ€è¦è‡ªå·±å†é¢å¤–æ‰‹åŠ¨å‡çº§ã€‚ 2ã€æ›´æ¢pipæº2.1 å›½å†…pipé•œåƒæº è±†ç“£ https://pypi.douban.com/simple/ æ¸…åå¤§å­¦ https://pypi.tuna.tsinghua.edu.cn/simple/ ä¸­ç§‘å¤§ https://pypi.mirrors.ustc.edu.cn/simple/ é˜¿é‡Œäº‘ https://mirrors.aliyun.com/pypi/simple/ è¿™å››ä¸ªæ˜¯å›½å†…æ¯”è¾ƒå¸¸ç”¨ä¸”ç¨³å®šçš„é•œåƒæºï¼Œå…·ä½“ä½¿ç”¨å“ªä¸ªå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…ç½‘ç»œç¯å¢ƒè¿›è¡Œé€‰æ‹©ã€‚ 2.2 æ°¸ä¹…åˆ‡æ¢é•œåƒæºæ°¸ä¹…åˆ‡æ¢é•œåƒæºéœ€è¦æˆ‘ä»¬åœ¨ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª.pipçš„éšè—æ–‡ä»¶å¤¹å¹¶åœ¨é‡Œé¢æ–°å»ºä¸€ä¸ªpip.confæ–‡ä»¶ç”¨äºæŒ‡å®šé•œåƒæºã€‚è¿™é‡Œæˆ‘ä»¬ä»¥ä¸­ç§‘å¤§çš„é•œåƒæºä¸ºä¾‹ã€‚ 12345678mkdir ~/.pip/cat &gt; ~/.pip/pip.conf &lt;&lt;EOF[global]index-url = https://pypi.tuna.tsinghua.edu.cn/simple/[install]trusted-host = https://pypi.tuna.tsinghua.edu.cn/EOF æˆ‘ä»¬å®‰è£…ä¸€ä¸ªåº“æ¥çœ‹ä¸€ä¸‹é€Ÿåº¦å¦‚ä½•ï¼š 2.3 ä¸´æ—¶æŒ‡å®šé•œåƒæºå¦‚æœéœ€è¦åœ¨æŸä¸ªå®‰è£…ä¸­æŒ‡å®šé•œåƒæºï¼Œåªéœ€è¦æ·»åŠ -iå‚æ•°å¹¶åŠ ä¸Šé•œåƒæºçš„åœ°å€å³å¯ã€‚ 12# ä½¿ç”¨pipæŒ‡å®šä»æ¸…åé•œåƒæºä¸­å®‰è£…pandasåº“sudo pip install pandas -i https://pypi.tuna.tsinghua.edu.cn/simple/ å¯ä»¥çœ‹åˆ°å›¾ä¸­çš„ä¸‹è½½é€Ÿåº¦å‡ ä¹æ˜¯å¯ä»¥è¾¾åˆ°æ»¡é€Ÿçš„ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"python","slug":"python","permalink":"https://tinychen.com/tags/python/"}]},{"title":"Ubuntu18.04æ›´æ”¹grubèœå•å¼•å¯¼é€‰é¡¹å’Œç­‰å¾…æ—¶é—´","slug":"20191224-ubuntu-change-grub","date":"2019-12-24T07:00:00.000Z","updated":"2019-12-24T07:00:00.000Z","comments":true,"path":"20191224-ubuntu-change-grub/","link":"","permalink":"https://tinychen.com/20191224-ubuntu-change-grub/","excerpt":"åŒç³»ç»Ÿæƒ…å†µä¸‹çš„Ubuntu18.04æ›´æ”¹grubèœå•å¼•å¯¼é€‰é¡¹å’Œç­‰å¾…æ—¶é—´ã€‚æ­¤å¤„ä½¿ç”¨çš„æ˜¯UEFIå¼•å¯¼çš„ç‰©ç†æœºä½œä¸ºç¤ºèŒƒï¼Œè€Œéæ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„BIOSè¿›è¡Œå¼•å¯¼çš„è™šæ‹Ÿæœºã€‚å®é™…çš„å„ç§å¼•å¯¼æƒ…å†µå¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è‡ªå·±æ ¹æ®å®é™…æƒ…å†µæ¥è¿›è¡Œåˆ¤æ–­ã€‚","text":"åŒç³»ç»Ÿæƒ…å†µä¸‹çš„Ubuntu18.04æ›´æ”¹grubèœå•å¼•å¯¼é€‰é¡¹å’Œç­‰å¾…æ—¶é—´ã€‚æ­¤å¤„ä½¿ç”¨çš„æ˜¯UEFIå¼•å¯¼çš„ç‰©ç†æœºä½œä¸ºç¤ºèŒƒï¼Œè€Œéæ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„BIOSè¿›è¡Œå¼•å¯¼çš„è™šæ‹Ÿæœºã€‚å®é™…çš„å„ç§å¼•å¯¼æƒ…å†µå¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è‡ªå·±æ ¹æ®å®é™…æƒ…å†µæ¥è¿›è¡Œåˆ¤æ–­ã€‚ å¯¹äºä¿®æ”¹grubå‚æ•°ï¼Œä¸å»ºè®®ç›´æ¥å¯¹/boot/grub/grub.cfgæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯å¯¹/etc/default/grubè¿›è¡Œä¿®æ”¹ï¼Œç„¶åæ‰§è¡Œupdate-grubå‘½ä»¤é‡æ–°ç”Ÿæˆgrubå¼•å¯¼æ–‡ä»¶å³å¯ã€‚ 1sudo vim /etc/default/grub ç„¶åè¿™é‡Œæœ‰å››ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„ä¿®æ”¹çš„ï¼š 123456789# è¿™ä¸ªæ˜¯é»˜è®¤çš„å¯åŠ¨é¡¹ï¼Œä¸€èˆ¬æ¥è¯´é»˜è®¤ä¸º0ï¼Œå³Ubuntuçš„é»˜è®¤å¯åŠ¨é¡¹,1åˆ™æ˜¯Ubuntuçš„é«˜çº§å¯åŠ¨é€‰é¡¹ï¼ŒåŒ…æ‹¬äº†é™¤äº†é»˜è®¤å†…æ ¸ä¹‹å¤–çš„å…¶ä»–å†…æ ¸ï¼Œä»¥åŠå¯¹åº”çš„ç´§æ€¥æ¢å¤æ•‘æ´æ¨¡å¼ï¼Œ2å°±æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹åŒç³»ç»Ÿçš„ç¬¬äºŒä¸ªç³»ç»Ÿï¼Œè¿™é‡Œå°±æ˜¯windowsï¼Œå› ä¸ºgrubå®é™…ä¸Šæ˜¯å¯ä»¥å¼•å¯¼windowså¯åŠ¨çš„ï¼Œæ‰€ä»¥åœ¨æ›´æ–°grubæ–‡ä»¶çš„æ—¶å€™ä¼šæ£€ç´¢åˆ°ç£ç›˜ä¸Šé¢çš„å¼•å¯¼æ–‡ä»¶å¹¶ä¸”æŠŠwindowsåŠ å…¥åˆ°å¼•å¯¼åˆ—è¡¨ä¸­æ¥ã€‚GRUB_DEFAULT=2# è¿™ä¸ªå‚æ•°éœ€è¦æ³¨é‡Šæ‰ä¿è¯ä¸‹é¢çš„ä¸¤ä¸ªå‚æ•°ç”Ÿæ•ˆ#GRUB_TIMEOUT_STYLE=hidden# è¿™ä¸¤ä¸ªå‚æ•°å°±æ˜¯grubå¼•å¯¼ç•Œé¢åœ¨ç™»å½•çš„æ—¶å€™ç­‰å¾…æ—¶é—´GRUB_TIMEOUT=5GRUB_RECORDFAIL_TIMEOUT=5 æˆ‘ä»¬æŸ¥çœ‹/boot/grub/grub.cfgæ–‡ä»¶ä¸‹é¢çš„å†…å®¹ï¼Œå¯ä»¥ä»ä»£ç ä¸­çœ‹å‡ºï¼Œè¿™é‡Œå¼•å¯¼æ—¶é—´çš„å‚æ•°ä¸»è¦æ˜¯GRUB_RECORDFAIL_TIMEOUTã€‚ ä¸åŒçš„é…ç½®æ–‡ä»¶å¯ä»¥å‚æ•°ä¸å¤ªä¸€æ ·ï¼Œå¤§å®¶å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹è‡ªå·±çš„grubæ–‡ä»¶ï¼Œå†å°è¯•ä¸€ä¸‹è¿™ä¸¤ä¸ªå‚æ•°ã€‚ æ¥ä¸‹æ¥åªè¦æ‰§è¡Œsudo update-grubå°±å¯ä»¥æ›´æ–°grubå¼•å¯¼å‚æ•°äº†ã€‚ 1234567891011tinychen@Tiny-Studio:~$ sudo vim /etc/default/grubtinychen@Tiny-Studio:~$ sudo update-grubSourcing file `/etc/default/grub&#x27;Generating grub configuration file ...Found linux image: /boot/vmlinuz-5.3.0-26-genericFound initrd image: /boot/initrd.img-5.3.0-26-genericFound linux image: /boot/vmlinuz-5.3.0-25-genericFound initrd image: /boot/initrd.img-5.3.0-25-genericFound Windows Boot Manager on /dev/nvme2n1p2@/efi/Microsoft/Boot/bootmgfw.efiAdding boot menu entry for EFI firmware configurationdone å¯¹äºç³»ç»Ÿä¸­å­˜åœ¨çš„update-grubå’Œupdate-grub2ä¸¤ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®é™…ä¸Šéƒ½æ˜¯æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ï¼Œç°åœ¨çš„grubå¼•å¯¼åº”è¯¥éƒ½æ˜¯ä½¿ç”¨äº†grub2ï¼Œæ—©å¹´çš„grub1åº”è¯¥å·²ç»è¢«å½»åº•æ¢ä¸‹æ¥äº†ã€‚ 12# æŸ¥çœ‹grubç‰ˆæœ¬ï¼Œå¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯åœ¨ä½¿ç”¨grub2äº†sudo grub-install -V","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"grub","slug":"grub","permalink":"https://tinychen.com/tags/grub/"}]},{"title":"ä¸ºæœ¬ç§‘æ¯•ä¸šè®¾è®¡æ­å»ºHEDTå¹³å°çš„ç¡¬ä»¶é€‰å‹æ€è·¯åŠæµ‹è¯•","slug":"20191212-my-hedt-introduction","date":"2019-12-12T07:00:00.000Z","updated":"2019-12-12T07:00:00.000Z","comments":true,"path":"20191212-my-hedt-introduction/","link":"","permalink":"https://tinychen.com/20191212-my-hedt-introduction/","excerpt":"ä»9æœˆä»½å¼€å§‹è®¡åˆ’æ­å»ºä¸€å°é«˜æ€§èƒ½çš„HEDTä¸»æœºæ¥è¿›è¡Œæ¯•è®¾ç›¸å…³å·¥ä½œï¼Œå‰åæŠ˜è…¾äº†ä¸¤ä¸ªå¤šæœˆæ€»ç®—æ˜¯åŸºæœ¬æå®šï¼Œè¿™é‡Œå†™ä¸€ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹æ•´ä¸ªç¡¬ä»¶é€‰å‹çš„æ€è·¯ã€è¿‡ç¨‹ä»¥åŠæµ‹è¯•ï¼ŒåŒæ—¶æ­¤æ–‡ä¹Ÿä½œä¸ºæ¯•ä¸šè®¾è®¡çš„ç¡¬ä»¶å¹³å°é€‰å‹æ­å»ºéƒ¨åˆ†ã€‚","text":"ä»9æœˆä»½å¼€å§‹è®¡åˆ’æ­å»ºä¸€å°é«˜æ€§èƒ½çš„HEDTä¸»æœºæ¥è¿›è¡Œæ¯•è®¾ç›¸å…³å·¥ä½œï¼Œå‰åæŠ˜è…¾äº†ä¸¤ä¸ªå¤šæœˆæ€»ç®—æ˜¯åŸºæœ¬æå®šï¼Œè¿™é‡Œå†™ä¸€ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹æ•´ä¸ªç¡¬ä»¶é€‰å‹çš„æ€è·¯ã€è¿‡ç¨‹ä»¥åŠæµ‹è¯•ï¼ŒåŒæ—¶æ­¤æ–‡ä¹Ÿä½œä¸ºæ¯•ä¸šè®¾è®¡çš„ç¡¬ä»¶å¹³å°é€‰å‹æ­å»ºéƒ¨åˆ†ã€‚ 1ã€ç”¨é€”ä»‹ç»å’Œå¤§å¤šæ•°ç”¨æˆ·æ­å»ºHEDTå¹³å°çš„ç”¨é€”ä¸åŒï¼ˆå½±è§†å‰ªè¾‘åæœŸåˆ¶ä½œã€æ¸¸æˆç›´æ’­ï¼‰ï¼Œè¿™æ¬¡çš„HEDTå¹³å°å¹¶ä¸å•çº¯æ˜¯ç”¨ä½œæœåŠ¡å™¨ç”¨é€”ï¼Œè€Œæ˜¯ä¸»è¦ç”¨æ¥åœ¨Linuxä¸‹å¼€è™šæ‹Ÿæœºï¼ˆKVMè™šæ‹ŸåŒ–ï¼‰ï¼ŒåŒæ—¶å…¼é¡¾ä¸ªäººé«˜æ€§èƒ½å°å¼æœºå¨±ä¹ç”¨é€”ï¼Œå› æ­¤ä¸»è¦çš„é¢„ç®—æ˜¯èŠ±åœ¨CPUã€å†…å­˜ã€ç¡¬ç›˜ä¸Šé¢ï¼Œå¯¹äºæ˜¾å¡çš„è¦æ±‚å¾ˆä½ï¼Œåªè¦èƒ½ç¡¬è§£4Kè“å…‰åŸç›˜ç”µå½±å³å¯ã€‚æ¥ä¸‹æ¥æ˜¯å¯¹ä¸»è¦çš„æ¿Uã€å†…å­˜ã€å›ºæ€ã€æ˜¾å¡è¿›è¡Œåˆ†æã€‚ 1.1 ä¸»æ¿&amp;CPUé¦–å…ˆæ˜¯æ¿Uéƒ¨åˆ†ï¼Œç¡¬æ€§æŒ‡æ ‡éå¸¸ç®€å•ï¼Œéœ€è¦CPUæ”¯æŒVT-dã€VT-xè¿™ä¸¤é¡¹ï¼ˆAMDå¤„ç†å™¨ä¹Ÿæœ‰å¯¹åº”çš„é€‰é¡¹ï¼‰ï¼Œç®€å•æ¥è¯´å°±æ˜¯CPUå¿…é¡»è¦æ”¯æŒç¡¬ä»¶è™šæ‹ŸåŒ–ï¼ŒåŒæ—¶å•æ ¸æ€§èƒ½å¹¶ä¸éœ€è¦å¤ªå¼ºï¼Œä½†æ˜¯æ ¸å¿ƒæ•°è¦å°½å¯èƒ½å¤šï¼Œä¸”PCIEé€šé“æ•°é‡è¦å°½å¯èƒ½å¤šï¼Œé…å¥—çš„ä¸»æ¿æ‰©å±•æ€§è¦å°½å¯èƒ½å¥½ï¼ˆPCIEæ’æ§½å°½å¯èƒ½å¤šï¼‰ï¼Œé™¤äº†æ˜¾å¡ä¹‹å¤–è¿˜éœ€è¦æ’å…¥PCIEè½¬NVMEçš„è½¬æ¥å¡ã€æ— çº¿ç½‘å¡å’Œä¸‡å…†æœ‰çº¿ç½‘å¡ç­‰è®¾å¤‡ã€‚ è¿™é‡Œé¦–å…ˆæ’é™¤äº†ç»å¤§å¤šæ•°çš„ä¸»æµæ¡Œé¢CPUï¼Œå› ä¸ºä»–ä»¬çš„æ ¸å¿ƒæ•°éƒ½æ¯”è¾ƒå°‘ï¼Œå³ä½¿æ˜¯9900Kå’Œ3900Xä¹Ÿæ‰åˆ†åˆ«8C16Tå’Œ12C24Tï¼ŒAMDè¿™è¾¹çš„è¯3950Xä»¥ä¸Šå‹‰å¼ºå¤Ÿç”¨ï¼Œå†å¾€ä¸Šçš„3960å’Œ3970å½“æ—¶è¿˜æ²¡æœ‰æ¨å‡ºï¼Œå½“ç„¶å°±ç®—æ˜¯å‡ºäº†æˆ‘ä¹Ÿä¹°ä¸èµ·ï¼ŒäºŒä»£çš„çº¿ç¨‹æ’•è£‚è€…æœ‰è®¾è®¡ç¼ºé™·ï¼Œå†…å­˜è¡¨ç°å®åœ¨ä»¤äººæ‹…å¿§ï¼Œå› æ­¤ä¸ä½œè€ƒè™‘ï¼ŒINTELè¿™è¾¹çš„è¯å°±æ˜¯æŒ¤äº†å¥½å‡ ä»£ç‰™è†çš„HEDTçš„é…·ç¿Xå¹³å°ï¼Œ9960Xæˆ–è€…9980XEç®—æ˜¯å¤Ÿç”¨ã€‚ å†ç„¶åçœ‹å‘æœåŠ¡å™¨å¹³å°ï¼Œç”±äºä¸»è¦è€ƒè™‘çš„æ˜¯äºŒæ‰‹ç¡¬ä»¶ï¼ˆå…¨æ–°çš„ä¹°ä¸åˆ°ä¹Ÿä¹°ä¸èµ·ï¼‰ï¼Œè¿™é‡Œå°±æ˜¯è‹±ç‰¹å°”çš„ä¸»åœºäº†ï¼Œå› ä¸ºAMDæ—©å¹´çš„ä¸ç»™åŠ›ï¼Œx86æœåŠ¡å™¨é¢†åŸŸåŸºæœ¬å°±æ˜¯è‹±ç‰¹å°”ä¸€ç›´ç‹¬ç§€ï¼ŒæŸå®ä¸Šèƒ½ä¹°åˆ°çš„äºŒæ‰‹ç¡¬ä»¶ä¹ŸåŸºæœ¬æ˜¯è‹±ç‰¹å°”çš„ï¼Œä¸»è¦è¿˜æ˜¯å¤§é‡çš„åŒè·¯E5æ´‹åƒåœ¾å’Œéƒ¨åˆ†çš„3647å¹³å°çš„QSã€ESå¤„ç†å™¨ï¼ˆæ­£å¼ç‰ˆéå¸¸è´µï¼‰ï¼ŒAMDè¿™è¾¹è™½ç„¶æœ‰å°‘é‡çš„éœ„é¾™EPYCå¤„ç†å™¨ï¼Œä½†æ˜¯æ€»çš„æ¥è¯´é€‰æ‹©æ¯”è¾ƒå°‘ï¼Œè€Œä¸”è¿™æ–¹é¢çš„è¯„æµ‹å’Œæ•™ç¨‹éƒ½å¾ˆå°‘ï¼Œä¸ªäººå¹¶ä¸æ˜¯å¾ˆæƒ³åœ¨è¿™æ–¹é¢å†’é™©ï¼Œä¸‡ä¸€ç¿»è½¦äº†è¦è€½è¯¯å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œè€Œä¸”è¿˜ä¸å¥½å‡ºäºŒæ‰‹ã€‚ å†åŠ ä¸Šä»·æ ¼å’Œç¨³å®šæ€§çš„å› ç´ ï¼ŒAMDçš„é€‰æ‹©å°±å¯ä»¥è¯´è¢«æ·˜æ±°æ‰äº†ï¼Œå› ä¸ºæ¯•è®¾éœ€è¦ç”¨åˆ°çš„Linuxç³»ç»Ÿä¸»è¦è¿˜æ˜¯CentOS7ï¼Œå†…æ ¸ç‰ˆæœ¬æ˜¯3.xç³»åˆ—ï¼Œæ—§ç‰ˆæœ¬çš„Linuxå†…æ ¸å¯¹AMDçš„æ”¯æŒå¹¶ä¸ç®—å¾ˆå¥½ï¼Œç»¼åˆå„æ–¹é¢çš„å› ç´ è€ƒè™‘ï¼ŒAMDåœ¨è¿™æ¬¡çš„è£…æœºä¸­å¹¶ä¸ç®—æ˜¯ç‰¹åˆ«ä¼˜ç§€çš„é€‰æ‹©ï¼Œå› æ­¤åªèƒ½æ·˜æ±°æ‰ã€‚ è€Œåœ¨INTELè¿™è¾¹ï¼Œé«˜ç«¯çš„intelçš„HEDTå¹³å°ä¸ä»…æœ¬èº«çš„CPUå¾ˆè´µï¼Œç”±äºä¸èƒ½ä½¿ç”¨æœåŠ¡å™¨å†…å­˜ï¼Œæ•´æœºçš„ä»·æ ¼é¢„ç®—è¿˜ä¼šä¸Šå‡å¾ˆå¤šï¼Œåˆ°è¿™é‡Œå°±å¯ä»¥å¾—å‡ºç»“è®ºï¼Œä¸»è¦è¿›å…¥å¤‡é€‰åˆ—è¡¨çš„æ¿Uå¥—é¤å°±æ˜¯äºŒæ‰‹çš„åŒè·¯E5æœåŠ¡å™¨å¥—é¤ã€é“‚é‡‘3647æœåŠ¡å™¨å¹³å°è¿™ä¸¤ç§é€‰æ‹©ï¼Œè¿™ä¸¤ä¸ªå¹³å°çš„CPUéƒ½æœ‰å¾ˆå¤šçš„PCIEé€šé“æ•°ï¼Œèƒ½ä½¿ç”¨æ¯”å®¶ç”¨å†…å­˜æ¡ä¾¿å®œå¾ˆå¤šçš„äºŒæ‰‹æœåŠ¡å™¨å†…å­˜ï¼ˆREG ECCå†…å­˜ï¼‰ã€‚ 1.2 å†…å­˜å¯¹äºå†…å­˜çš„è¦æ±‚ä¸ç®—å¾ˆé«˜ï¼Œå®¹é‡è‡³å°‘éœ€è¦128Gï¼Œä»·æ ¼å°½å¯èƒ½ä½ä¸€äº›ï¼Œé¢‘ç‡ä¸éœ€è¦å¤ªé«˜ï¼ˆå¤§å¤šæ•°æœåŠ¡å™¨çš„CPUæ”¯æŒçš„æœ€é«˜å†…å­˜é¢‘ç‡ä¸º2933ï¼‰ï¼Œæ—¶åºä¸éœ€è¦å¤ªä½ï¼Œæ²¡æœ‰å¤§å‹æ¸¸æˆçš„éœ€æ±‚ï¼Œè€Œä¸”å¤§å¤šæ•°æœåŠ¡å™¨çš„CPUæ”¯æŒå››é€šé“å†…å­˜ï¼ˆçº¿ç¨‹æ’•è£‚è€…æ”¯æŒå››é€šé“ï¼‰ï¼Œé“‚é‡‘å¤„ç†å™¨è¿˜æ”¯æŒå…­é€šé“å†…å­˜ï¼ˆå¾—ç›ŠäºCCXæ¨¡å—åŒ–è®¾è®¡ï¼ŒEPYCéœ„é¾™å¤„ç†å™¨è¿˜æœ‰å…«é€šé“å†…å­˜ï¼‰ï¼Œå¦‚æœæ˜¯åŒè·¯CPUçš„è¯ï¼Œæ”¯æŒçš„å†…å­˜é€šé“åˆ™ç¿»å€ï¼Œå¤šé€šé“å†…å­˜å¯ä»¥æœ‰æ•ˆæå‡å†…å­˜çš„è¯»å†™æ€§èƒ½ã€‚æ­¤å¤–ï¼ŒECCå†…å­˜æ”¯æŒå†…å­˜çº é”™ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½è¿è¡Œæ—¶å€™çš„è“å±æ­»æœºç­‰æƒ…å†µï¼Œæ¯”è¾ƒé€‚åˆæˆ‘è¿™ç§24å°æ—¶ä¸å…³æœºçš„æƒ…å†µã€‚ï¼ˆæœ€é‡è¦çš„è¿˜æ˜¯ä¾¿å®œï¼Œæ·˜å®ä¸Šé¢çš„32G 2666MHzçš„ä¸‰æ˜ŸREGå†…å­˜æ¡å•æ¡æ‰äº”ç™¾å¤šï¼Œ2400MHzçš„é•å…‰/æµ·åŠ›å£«åªè¦å››ç™¾å¤šï¼‰ 1.3 ç¡¬ç›˜è¿™æ¬¡çš„è™šæ‹Ÿæœºç¡¬ç›˜ä¸»è¦è¿˜æ˜¯ä»¥è™šæ‹Ÿç¡¬ç›˜ä¸ºä¸»ï¼Œä½¿ç”¨ä¸€èˆ¬çš„PCIe3.0x4çš„NVMEå›ºæ€å°±èƒ½æ»¡è¶³éœ€æ±‚ï¼Œç”±äºåŸºæœ¬éƒ½æ˜¯æµ‹è¯•ç”¨é€”ï¼Œå¹¶æ²¡æœ‰ä¸Šçº¿ä½¿ç”¨æ‰€äº§ç”Ÿçš„å¤§é‡æ–‡ä»¶è¯»å†™å­˜å‚¨éœ€æ±‚ï¼Œé¢„è®¡ä½¿ç”¨NVMEå›ºæ€è¿›è¡Œè™šæ‹ŸåŒ–ï¼Œæ™®é€šçš„æœºæ¢°ç¡¬ç›˜è¿›è¡Œå¤‡ä»½å³å¯ï¼Œå¹¶æ²¡æœ‰æ‰“ç®—ç›´é€šå›ºæ€æˆ–è€…æ˜¯ä½¿ç”¨HBAå¡æˆ–é˜µåˆ—å¡ç­‰ç»„åˆã€‚ 1.4 æ˜¾å¡è€ƒè™‘åˆ°ä»¥åå¯èƒ½ä¼šè¿›è¡Œé»‘è‹¹æœå®‰è£…ï¼Œè¿™é‡Œè¿˜æ˜¯å°½å¯èƒ½åœ°é€‰æ‹©äº†Aå¡ï¼Œè€Œä¸”åœ¨äºŒæ‰‹çš„æƒ…å†µæ¥çœ‹ï¼Œåƒå…ƒä»¥ä¸‹çš„ä»·ä½åŸºæœ¬å°±æ˜¯580çš„å¤©ä¸‹ï¼Œå…¶ä»–çš„é€‰æ‹©éƒ½æ²¡å•¥æ€§ä»·æ¯”ã€‚è€Œä¸”580è¶³ä»¥æ»¡è¶³ç¡¬è§£4Kè“å…‰ï¼Œå¤–æ¥4KHDRæ˜¾ç¤ºå™¨ç­‰éœ€æ±‚ï¼Œç”±äºä¸ç©å¤§å‹æ¸¸æˆï¼Œä¸å‰ªè¾‘ï¼Œä¸ç”¨CUDAï¼Œæ‰€ä»¥å°±æ²¡æœ‰è€ƒè™‘Nå¡ã€‚å½“ç„¶æœ€ä¸»è¦çš„åŸå› è¿˜æ˜¯ä¸ºåæœŸçš„é»‘è‹¹æœåšå¥½å‡†å¤‡ã€‚ 1.5 å°ç»“æ€»çš„æ¥è¯´ï¼Œç”±äºé¢„ç®—çš„é™åˆ¶ï¼Œé€‰æ‹©äºŒæ‰‹çš„intelæœåŠ¡å™¨å¹³å°æ˜¯ç›®å‰å¯¹äºæˆ‘æ¥è¯´ç»¼åˆå„æ–¹é¢å› ç´ æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ï¼Œåœ¨128Gå†…å­˜è¿™ä¸ªé€‰æ‹©ä¸‹ï¼Œä½¿ç”¨æœåŠ¡å™¨å†…å­˜è™½ç„¶ç‰ºç‰²äº†ä¸€éƒ¨åˆ†çš„é«˜é¢‘å’Œä½å»¶è¿Ÿç‰¹æ€§ï¼Œä½†æ˜¯æ¢æ¥äº†æ•´ä½“é¢„ç®—çš„æå¤§ç¨‹åº¦é™ä½å’ŒECCçº é”™åŠŸèƒ½ã€‚ ä¸é€‰æ‹©AMDå’ŒINTELä¸¤å®¶çš„ä¸»æµHEDTå¹³å°ï¼ˆé…·ç¿Xå’Œçº¿ç¨‹æ’•è£‚è€…ï¼‰ä¸»è¦è¿˜æ˜¯å¤ªè´µäº†ï¼Œä¸é€‰æ‹©EPYCæ˜¯å› ä¸ºäºŒæ‰‹æµå‡ºé…ä»¶å¤ªå°‘ï¼Œé€‰æ‹©ä½™åœ°ä¸å¤§ï¼Œè€Œä¸”æ²¡æœ‰å¤ªå¥½çš„æŠ˜è…¾æ–¹æ¡ˆã€‚ æ˜¾å¡å’Œç½‘å¡éƒ½æ˜¯é€‰æ‹©é»‘è‹¹æœå…¼å®¹å…é©±çš„ç¡¬ä»¶æ–¹ä¾¿åæœŸæŠ˜è…¾é»‘è‹¹æœï¼Œè€Œç½‘å¡åˆ™ç”±äºåªæ˜¯ä¸€å°ä¸»æœºï¼Œæš‚æ—¶æ²¡æœ‰å’Œå¤–éƒ¨æœºå™¨å¤§é‡é«˜é€Ÿäº¤æ¢æ•°æ®çš„éœ€æ±‚ï¼Œåªéœ€è¦é¢„ç•™ä¸€ä¸ªPCIEx8çš„æ’æ§½ç”¨æ¥åæœŸå‡çº§ä¸‡å…†ç½‘ç»œæˆ–è€…æ˜¯IBã€RDMAç½‘ç»œç­‰ã€‚ 2ã€é“‚é‡‘8167M+C621åœ¨å› ä¸ºä½“ç§¯å’Œæ€§èƒ½çš„åŸå› æ·˜æ±°äº†è€åŒè·¯E5å¹³å°ä¹‹åï¼Œç¡®å®šäº†è´­å…¥é“‚é‡‘3647å¹³å°å¤–åŠ åæ“çš„æ°¸æ“C621D8Aä¸»æ¿ï¼ˆæ°¸æ“æ˜¯åæ“çš„æœåŠ¡å™¨ä¸»æ¿äº§å“çº¿ï¼‰ï¼Œå¤„ç†å™¨ä¹°çš„æ˜¯ä¸€å—æ®è¯´æ˜¯åä¸ºäº‘å®šåˆ¶çš„å¤„ç†å™¨ï¼Œé“‚é‡‘8167Mï¼Œ26æ ¸å¿ƒ52çº¿ç¨‹ï¼Œå¾…æœº2.0ç¿é¢‘2.4å…¨æ ¸2.4ï¼Œæ”¯æŒå…­é€šé“å†…å­˜ï¼Œæœ‰ä¸€å¤§å †çš„PCIEé€šé“ï¼Œæ•´ä½“æ¥è¯´è¿˜æ˜¯éå¸¸ä¸é”™çš„ï¼Œä½†æ˜¯è´¥ç¬”å°±åœ¨è¿™å—æ°¸æ“çš„ä¸»æ¿ã€‚ â–¼å®æ‹çœ‹ä¸€ä¸‹å·´æŒå¤§çš„CPU æ•´æœºå¹³å°æ­å»ºå¥½ä¹‹ååœ¨è‡ªå·±åšçš„æµ‹è¯•å¹³å°ä¸Šæ˜¯è¿™æ ·çš„ï¼š ä¸Šåˆ°æœºç®±é‡Œé¢æ˜¯è¿™æ ·çš„ è¿™å¥—å¹³å°ç”¨èµ·æ¥è¿˜æ˜¯æœ‰ç€æŒºå¤šä¸é”™çš„åœ°æ–¹çš„ï¼š ä¸»æ¿æ˜¯æœ‰redhatè®¤è¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰RHELçš„é©±åŠ¨æä¾›ï¼Œä¸éœ€è¦æ‹…å¿ƒé©±åŠ¨çš„æ”¯æŒé—®é¢˜ï¼ˆè¿™åœ¨LinuxæœåŠ¡å™¨ä¸Šå°¤ä¸ºé‡è¦ï¼‰ ä¸»æ¿è‡ªå¸¦4ä¸ªX722åƒå…†å…‰å£ç½‘å¡ã€1ä¸ªIPMIç®¡ç†ç½‘å£ï¼Œåœ¨å¯¹ç½‘ç»œè¦æ±‚æ¯”è¾ƒé«˜çš„å¤šå¼€è™šæ‹Ÿæœºä¸­æœ‰ä¸€å®šçš„ä¼˜åŠ¿ ä¸»æ¿æœ‰æ¿è½½é›†æ˜¾ä¸”å¸¦VGAæ¥å£ï¼Œä¸éœ€è¦å¤–æ¥ç‹¬æ˜¾å°±èƒ½è¿æ¥æ˜¾ç¤ºå™¨DEBUG ä¸»æ¿è‡ªå¸¦è¶…å¤šSATAæ¥å£ï¼Œåœ¨ä¸ä½¿ç”¨æ‰©å±•å¡çš„æƒ…å†µä¸‹å°±å¯ä»¥æ¥å…¥10å¤šä¸ªSATAç¡¬ç›˜ CPUæ”¯æŒ6é€šé“å†…å­˜ï¼ŒPCIEé€šé“æ•°å’Œæ’æ§½è¶³å¤Ÿå¤š CPUæ ¸å¿ƒæ•°éå¸¸å¤šï¼Œååˆ†é€‚åˆå¤šå¼€è™šæ‹Ÿæœºè¿›è¡Œæ ¸å¿ƒåˆ†é… ä¸Šé¢çš„è¿™äº›ä¼˜ç‚¹åŸºæœ¬ä¸Šéƒ½æ˜¯æœåŠ¡å™¨å¹³å°æœ‰çš„ä¸€äº›ç‰¹æ€§ï¼Œé‚£ä¹ˆä¸‹é¢æ¥è¯´ä¸€ä¸‹æˆ‘æœ€ç»ˆæŠŠå®ƒæ¢æ‰çš„åŸå› ï¼š éå¸¸å­±å¼±çš„å•æ ¸æ€§èƒ½ï¼Œç”±äºè¿™é¢—CPUçš„ä¸»é¢‘åªæœ‰2.0ï¼Œå³ä¾¿æ˜¯ç¿é¢‘ä¹Ÿåªæœ‰2.4ï¼Œç¨å¾®åƒä¸€ç‚¹å•æ ¸çš„åº”ç”¨åœ¨ä¸Šé¢è¿è¡Œèµ·æ¥éƒ½ä¼šéå¸¸åƒåŠ›ï¼Œå¯¹äºä¸ªäººæ—¥å¸¸ä½¿ç”¨æ¥è¯´è¿˜æ˜¯æœ‰ä¸€å®šçš„å½±å“ï¼› æ•´å¥—å¹³å°çš„Windows10æ”¯æŒæ¯”è¾ƒä¸€èˆ¬ï¼Œç”±äºæ˜¯æœåŠ¡å™¨å¹³å°ï¼Œä¸»è¦è¿˜æ˜¯æ”¯æŒçš„redhatå’Œwindows serverç³»ç»Ÿè¾ƒå¥½ï¼Œwin10çš„é©±åŠ¨éƒ½èƒ½æ‰¾åˆ°ï¼Œä½†æ˜¯æ€»æ„Ÿè§‰å·®ç‚¹æ„æ€ï¼› ä¸»æ¿çš„24pinä¾›ç”µå’ŒCPUçš„8pinä¾›ç”µä½ç½®è°ƒè½¬äº†è¿‡æ¥ï¼Œå’Œä¸€èˆ¬çš„å®¶ç”¨ATXä¸»æ¿åˆšå¥½ç›¸åï¼Œå¯¼è‡´åœ¨ä½¿ç”¨æ™®é€šæœºç®±çš„æ—¶å€™ä¸€èˆ¬ç”µæºçš„24pinçº¿æä¸å¤Ÿé•¿ä¸”ç†çº¿å¾ˆéº»çƒ¦ï¼› ä¸»æ¿è™½ç„¶æœ‰ä¸¤ä¸ªnvmeçš„ç¡¬ç›˜æ¥å£ï¼Œä½†æ˜¯å±…ç„¶åªæ˜¯PCIEx1çš„å¸¦å®½ï¼Œå®åœ¨é¸¡è‚‹ï¼› 3647å¹³å°çš„CPUå®‰è£…æ–¹å¼éå¸¸å¥‡è‘©ï¼Œç”±äºCPUå¤ªå¤§ï¼Œéœ€è¦å…ˆæŠŠCPUè£…åˆ°æ•£çƒ­å™¨ä¸Šï¼Œå†æŠŠæ•£çƒ­å™¨è£…åˆ°ä¸»æ¿ä¸Šï¼Œä¸”3647å¹³å°çš„æ•£çƒ­å™¨éå¸¸å°‘ï¼Œè¦ä¹ˆå¾ˆè´µï¼Œè¦ä¹ˆå¾ˆä¸‘ã€‚ æ‰€ä»¥æœ€ååŸºäºå„ç§è€ƒè™‘ï¼Œè¿˜æ˜¯æŠŠè¿™å¥—å¹³å°æ¢æ‰äº†ã€‚ 3ã€W2295+X2993.1 é…ç½®ç®€ä»‹æœ€ç»ˆåœ¨é—²é±¼ä¸Šçœ‹åˆ°äº†ä¸€å¥—æ•´ä½“ä»·æ ¼å’Œä¸Šé¢è¯´çš„ç›¸å½“ï¼Œè€Œæ›´é€‚åˆæˆ‘ä½¿ç”¨çš„å¿—å¼ºW-2295 ESå¤„ç†å™¨åŠ x299èŠ¯ç‰‡ç»„çš„ä¸»æ¿ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­£å¸¸çš„X299ä¸»æ¿æ˜¯å¹¶ä¸æ”¯æŒREG ECCå†…å­˜çš„ï¼Œè€Œæ­£å¸¸çš„W2295å¤„ç†å™¨ä¹Ÿæ˜¯ä¸èƒ½ç”¨è¿™ä¸ªx299èŠ¯ç‰‡ç»„çš„ï¼Œä½†æ˜¯ç”±äºè¿™å—Uæ˜¯ESä¸æ˜¾ç‰ˆæœ¬ï¼ŒåŠ ä¸Š10ä»£é…·ç¿Xçš„HEDTå¹³å°æ›´æ–°äº†ä¹‹åå¸¦æ¥çš„ä¸»æ¿å¾®ç æ›´æ–°ï¼Œä½¿å¾—å¯ä»¥åœ¨x299å¹³å°ä¸Šä½¿ç”¨è¿™é¢—ä¸æ˜¾çš„ESç‰ˆW-2295å’ŒREG ECCå†…å­˜ã€‚ ä¸‹é¢æ˜¯æ•´å¥—å¹³å°çš„æ±‡æ€»é…ç½®ï¼š é…ä»¶ å‹å· è´­ä¹°å¹³å° ä»·æ ¼ CPU Xeon W-2295 ESä¸æ˜¾ 18æ ¸36çº¿ç¨‹ é—²é±¼ 4750ä¸åŒ…é‚® æ•£çƒ­å™¨ é‡‡èARTIST EVO 3 äº¬ä¸œ 289åŒ…é‚® ä¸»æ¿ åç¡• TUF x299 mark2 é—²é±¼ 899ä¸åŒ…é‚® å†…å­˜ (SKæµ·åŠ›å£« 32G DDR4 2R*4 2400MHz)x4 æ·˜å® 1728åŒ…é‚® æ˜¾å¡ è“å®çŸ³RX580 8Gè¶…ç™½é‡‘ é—²é±¼ 750åŒ…é‚® ç¡¬ç›˜1 ä¸‰æ˜ŸPM981 512Gï¼ˆ5æœˆä»½è´­ä¹°ï¼‰ æ·˜å® 465.9åŒ…é‚® ç¡¬ç›˜2 é›·å…‹æ²™NM610 1T å¤©çŒ« 569åŒ…é‚® ç¡¬ç›˜3 é›·å…‹æ²™NM610 1T äº¬ä¸œ 565åŒ…é‚® ç¡¬ç›˜4 è¥¿éƒ¨æ•°æ® Elements 12TB ç§»åŠ¨3.5å¯¸æœºæ¢°ç¡¬ç›˜æ‹†ç›˜ äºšé©¬é€Š 1436.5åŒ…é‚® ç¡¬ç›˜5 è¥¿éƒ¨æ•°æ® Elements 12TB ç§»åŠ¨3.5å¯¸æœºæ¢°ç¡¬ç›˜æ‹†ç›˜ äºšé©¬é€Š 1321.38åŒ…é‚® å›ºæ€æ•£çƒ­ åˆ©æ°‘TR-M2å›ºæ€æ•£çƒ­å™¨ äº¬ä¸œ 39.9åŒ…é‚® è½¬æ¥å¡ ä½³ç¿¼iHyper M2 PCIEx16æ‹†åˆ†4NVMEè½¬æ¥å¡ å¤©çŒ« 149åŒ…é‚® æ— çº¿æ¨¡å— åšé€šBCM943602CS é—²é±¼ 200åŒ…é‚® ç”µæº å®‰é’›å…‹HCG850W é‡‘ç‰Œplus åå¹´ä¿ä¿®åŒ…æ¢ é—²é±¼ 488ä¸åŒ…é‚® æœºç®± æ©æ°H510 é—²é±¼ 300åŒ…é‚® é£æ‰‡1 (Arctic F12 PWM PST)x2 äº¬ä¸œ 79.8åŒ…é‚® é£æ‰‡2 (Arctic F14 PWM)x2 æ·˜å® 79.5åŒ…é‚® RGB (ä¹”æ€ä¼¯NC-3å†…å­˜é©¬ç”²)x4+VC-3æ˜¾å¡æ”¯æ¶+RGBé¥æ§å™¨ é—²é±¼ 268åŒ…é‚® é‚®è´¹ CPU+ä¸»æ¿+ç”µæº é¡ºä¸° å¤§çº¦100 æ€»è®¡ 14477.98 ä¸ºäº†æ§åˆ¶é¢„ç®—ï¼Œå¤§å¤šæ•°éƒ½æ˜¯é€šè¿‡é—²é±¼è´­ä¹°çš„æˆè‰²9æˆæ–°ä»¥ä¸Šæˆ–è€…æ˜¯å…¨æ–°çš„é…ä»¶ï¼Œè€Œåœ¨å…³é”®çš„å­˜å‚¨æ–¹é¢åˆ™æ˜¯åœ¨å¤©çŒ«å’Œäº¬ä¸œå·²ç»äºšé©¬é€Šè´­ä¹°å¸¦ä¿ä¿®çš„ç¡¬ç›˜ï¼Œä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨ã€‚ ç”±äºè´­ä¹°çš„æ—¶é—´ä»åæœˆä»½åˆ°åŒåäºŒï¼Œä¸­é—´è·¨åº¦å¾ˆå¤§ï¼Œä¸€äº›ä»·æ ¼çš„æ³¢åŠ¨ä¹Ÿååˆ†å¤§ï¼Œæ¯”å¦‚å†…å­˜ç°åœ¨åˆå¼€å§‹å°å¹…åº¦æ¶¨ä»·ï¼Œè€Œæ˜¾å¡åˆ™æ˜¯åœ¨ä¸€è·¯é™ä»·ï¼Œå…¶ä»–çš„åŸºæœ¬éƒ½æ²¡æœ‰å¤ªå¤§çš„æ³¢åŠ¨ã€‚ æ•´æœºçš„å…¨éƒ¨ä»·æ ¼ä¸‹æ¥åœ¨14500å·¦å³ï¼Œå…¶ä¸­ç¡¬ç›˜å äº†å¤§æ¦‚æœ‰4000å·¦å³ï¼Œä½†æ˜¯ä¹Ÿæ˜¯å¾—åˆ°äº†2.5Tçš„NVMEå›ºæ€å­˜å‚¨å’Œ24Tçš„æœºæ¢°ç¡¬ç›˜å­˜å‚¨ç©ºé—´ï¼Œç›¸å¯¹æ¥è¯´è¿˜æ˜¯ä¸é”™çš„ã€‚ æ¥ä¸‹æ¥å¯¹ä¸€äº›ä¸»è¦çš„éƒ¨ä»¶è¿›è¡Œä»‹ç»ï¼š 3.2 CPUCPUæ˜¯åœ¨CHHä¸Šé¢çœ‹åˆ°çš„ä¸€ä½å¤§ä½¬è¯„æµ‹çš„ä¸€æ¬¾æ¯”è¾ƒç‰¹åˆ«çš„å¤„ç†å™¨ï¼Œå…ˆä¸ŠCHHçš„é“¾æ¥ï¼š https://www.chiphell.com/thread-2102461-1-1.html ç„¶åé€šè¿‡INTELå®˜ç½‘ä¹Ÿå¯ä»¥æŸ¥è¯¢åˆ°è¿™å—å¤„ç†å™¨çš„ç›¸å…³ä¿¡æ¯ï¼š https://ark.intel.com/content/www/cn/zh/ark/products/198011/intel-xeon-w-2295-processor-24-75m-cache-3-00-ghz.html è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€å—19å¹´ç¬¬å››å­£åº¦æ‰ä¸Šå¸‚çš„å·¥ä½œç«™å¤„ç†å™¨ï¼Œçœ‹èµ·æ¥åº”è¯¥æ˜¯W-2195çš„å‡çº§ç‰ˆï¼Œä¾æ—§æ˜¯14nmåˆ¶ç¨‹ï¼Œ18æ ¸36çº¿ç¨‹ï¼Œ165Wçš„TDPï¼Œä¸»é¢‘3.0Gï¼Œç¿é¢‘4.6Gï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„è‹±ç‰¹å°”Â® ç¿é¢‘åŠ é€Ÿ Max æŠ€æœ¯ 3.0æŠ€æœ¯å¯ä»¥è®©å‡ ä¸ªæ ¸å¿ƒèƒ½åˆ°4.8Gã€‚ è‹±ç‰¹å°”Â® ç¿é¢‘åŠ é€Ÿ Max æŠ€æœ¯ 3.0 è¯†åˆ«å¤„ç†å™¨ä¸Šæ€§èƒ½æœ€ä½³çš„å†…æ ¸ï¼ŒåŒæ—¶é€šè¿‡æé«˜åˆ©ç”¨ç”µæºå’Œæ•£çƒ­å™¨ç©ºé—´æ—¶æ‰€å¿…éœ€çš„é¢‘ç‡ï¼Œæé«˜è¿™äº›å†…æ ¸çš„æ€§èƒ½ã€‚è‹±ç‰¹å°”Â® ç¿é¢‘åŠ é€Ÿ Max æŠ€æœ¯ 3.0 çš„é¢‘ç‡å°±æ˜¯åœ¨è¿™ç§æ¨¡å¼ä¸‹è¿è¡Œçš„CPUçš„æ—¶é’Ÿé¢‘ç‡ã€‚ æ”¯æŒECCå†…å­˜ï¼Œé¢‘ç‡æœ€é«˜æ˜¯2933ï¼Œæœ‰48æ¡PCIEé€šé“ï¼Œåˆšå¥½å¤Ÿç”¨ã€‚ 3.3 ä¸»æ¿è™½ç„¶æ˜¯X299çš„ä¸»æ¿åŸºæœ¬éƒ½èƒ½ç‚¹äº®ï¼Œä½†æ˜¯æ®å–å®¶æè¿°ï¼Œå¯¹ECCå†…å­˜æ”¯æŒæœ€å¥½çš„å°±æ˜¯åç¡•çš„æ¿å­ï¼Œæ‰€ä»¥åœ¨é—²é±¼ä¸Šé¢æ‰¾åˆ°äº†ä¸€å—899çš„åç¡•TUF X299 mark2çš„ä¸»æ¿ï¼Œè™½ç„¶åªæœ‰ä¸»æ¿å’ŒæŒ¡æ¿ï¼Œä½†æ˜¯æˆè‰²è¿˜ç®—ä¸é”™ï¼ŒæŸ¥è¯¢äº†ä¸€ä¸‹ä¿ä¿®åˆ°æœŸæ—¶é—´æ˜¯2024å¹´çš„11æœˆï¼Œç›¸å¯¹è€Œè¨€è¿˜ç®—æ˜¯OKã€‚ ä»å®˜ç½‘çš„ä»‹ç»å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»æ¿çš„è®¾è®¡å¸ƒå±€è¿˜æ˜¯ç›¸å¯¹æ¯”è¾ƒåˆç†çš„ï¼Œå°¤å…¶æ˜¯è¾ƒå¤šçš„USBæ¥å£å’Œåœ¨PCIEé€šé“æ’æ§½çš„åˆ†é…è®¾ç½®ä¸Šæ¯”ä¹‹å‰çš„æ°¸æ“C621D8Aæ¥è¯´è¦å¯¹ä¸ªäººç”¨æˆ·å¥½å¾ˆå¤šã€‚ æŸ¥è¯¢å®˜ç½‘æˆ‘ä»¬å¯ä»¥çœ‹åˆ°PCIEé€šé“çš„åˆ†é…æƒ…å†µå¦‚ä¸‹ ç”±äºæ’ä¸Šäº†æ˜¾å¡ä¹‹åï¼Œç¬¬ä¸€æ¡X16æ’æ§½ä¸‹é¢çš„X1æ’æ§½å’ŒX4æ’æ§½éƒ½ç”¨ä¸äº†ï¼Œç¬¬äºŒæ¡X16æ’æ§½ç”¨æ¥æ‰©å±•å›ºæ€ï¼Œä¸‹é¢çš„X1æ’æ§½ç”¨æ¥æ‰©å±•æ— çº¿æ¨¡å—ï¼Œæœ€ä¸‹é¢çš„çœ‹èµ·æ¥æ˜¯X16å®é™…ä¸Šåªæœ‰X8å¸¦å®½çš„æ’æ§½ç”¨æ¥æ‰©å±•ä¸‡å…†ç½‘å¡ï¼Œæ­£å¥½å…¨éƒ¨æ’æ»¡ï¼Œåˆšåˆšå¥½å¤Ÿç”¨ã€‚ 3.4 å†…å­˜å†…å­˜è¿™é‡Œåœ¨æ·˜å®ä¸Šæ‰¾äº†ä¸€å®¶ä¸“é—¨å–æœåŠ¡å™¨æ‹†æœºä»¶å’ŒäºŒæ‰‹æœåŠ¡å™¨çš„è€åº—ï¼Œä¹°çš„æ˜¯æµ·åŠ›å£«çš„2400MHzçš„2R*4çš„32Gå•æ¡ï¼Œä¸€å…±å››æ¡ï¼Œç”±äºX299å¯ä»¥è¶…é¢‘ï¼Œåé¢è½»æ¾è¶…åˆ°2933MHzä½¿ç”¨ã€‚ 3.5 ç¡¬ç›˜ç¡¬ç›˜è¿™é‡Œæ¯”è¾ƒç‰¹æ®Šï¼Œä¹‹å‰5æœˆä»½è£…æœºçš„æ—¶å€™ä¹°äº†ä¸€å—ä¸‰æ˜Ÿçš„PM981ï¼Œæ€§èƒ½æ”¾åˆ°ç°åœ¨æ¥è¯´ä¹Ÿè¿˜æ˜¯éå¸¸å¼ºæ‚çš„ï¼Œç„¶ååœ¨åŒåä¸€æœŸé—´åˆä¹°äº†ä¸¤å—é›·å…‹æ²™çš„NM610 1Tç‰ˆæœ¬ï¼Œå…¶ä¸­ä¸‰æ˜Ÿçš„PM981ç”¨æ¥è£…å®¿ä¸»æœºçš„Linuxç³»ç»Ÿï¼Œä¸€å—NM610ç”¨æ¥è£…Windowsï¼Œå¦ä¸€å—NM610ç”¨æ¥è£…è™šæ‹Ÿæœºçš„é•œåƒã€‚ ç”±äºä¸»æ¿åªæœ‰ä¸¤ä¸ªNVMEçš„å›ºæ€ä½ï¼Œä¸”å…¶ä¸­ä¸€ä¸ªæ˜¯éå¸¸å¥‡è‘©çš„ç«–è£…æ–¹å¼ï¼Œç„¶åå–å®¶ä¹Ÿæ²¡æœ‰è¿™ä¸ªç«–è£…æ”¯æ¶ï¼Œæ‰€ä»¥ç›¸å½“äºåªèƒ½è£…ä¸€å—å›ºæ€ï¼Œå› æ­¤ä¸Šæ·˜å®ä¹°äº†ä¸€å—ä½³ç¿¼çš„PCIEè½¬æ¥å¡ï¼Œå®ƒå¯ä»¥æŠŠä¸€æ¡X16çš„æ’æ§½æ‹†åˆ†æˆ4ä¸ªX4çš„æ’æ§½ï¼ˆéœ€è¦ä¸»æ¿æ”¯æŒPCIEæ‹†åˆ†åŠŸèƒ½ï¼‰ï¼Œç„¶åå°±å¯ä»¥æ’4å—NVMEçš„å›ºæ€äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è½¬æ¥å¡æœ¬èº«å¹¶ä¸æ”¯æŒRAIDï¼Œæ”¯æŒRAIDçš„è½¬æ¥å¡å¤ªè´µäº†ã€‚ ç„¶ååœ¨é»‘äº”æœŸé—´è´­å…¥äº†ä¸¤å—è¥¿éƒ¨æ•°æ®çš„Elementsçš„12Tçš„ç§»åŠ¨ç¡¬ç›˜ï¼Œä¸€å—æ‹†ç›˜ç”¨ï¼Œå¦ä¸€å—æš‚æ—¶ä¸æ‹†æ”¾ç€å¤‡ç”¨ï¼Œæœºæ¢°ç¡¬ç›˜çš„ä¸»è¦ç”¨é€”æ˜¯å­˜å‚¨è“å…‰ç”µå½±ä»¥åŠå¤‡ä»½å„ç§æ–‡ä»¶ã€‚ æ‹†å¼€ä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡Œé¢çš„æ˜¯12TBçš„æ°¦æ°”é™é€Ÿç›˜ï¼ˆç¯å…‰é—®é¢˜æ‹å‡ºæ¥çš„ç…§ç‰‡æœ‰ç‚¹åç´«ï¼Œå®é™…ç¡¬ç›˜æ˜¯ç™½è‰²çš„ï¼‰ï¼Œå¯ä»¥ç›´æ¥æ¥å…¥ç”µè„‘ä½¿ç”¨ï¼Œå¹¶ä¸éœ€è¦å±è”½3.3Vé˜µè„šã€‚ 4ã€ä¸Šæœºæµ‹è¯•æ¥ä¸‹æ¥ä¸Šæœºæµ‹è¯•ä¸€ä¸‹ï¼š ç”±äºæ˜¯ESç‰ˆçš„å¤„ç†å™¨ï¼ŒCPUè¡¨é¢å¹¶æ²¡æœ‰æ ‡æ˜å‹å·ï¼Œä¸è¿‡ç”±äºåŒæ ·éƒ½æ˜¯2066é˜µè„šï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨x299å¹³å°ç‚¹äº®ï¼Œå‰ææ˜¯éœ€è¦æŠŠä¸»æ¿å‡çº§åˆ°æœ€æ–°çš„BIOSã€‚ 4.1 CPU-Z&amp;GPU-Zç„¶åæˆ‘ä»¬ä½¿ç”¨CPU-Zè¿›è¡ŒæŸ¥çœ‹ï¼Œæ— æ³•è¯†åˆ«å‡ºå…·ä½“çš„å‹å·ï¼š é¡ºä¾¿è¿›è¡Œè·‘åˆ†æµ‹è¯•ï¼š GPU-Zè¿™è¾¹å€’æ˜¯æ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ï¼Œæ»¡è¡€ç‰ˆçš„580è¶…ç™½é‡‘ï¼ŒåæœŸæŠ˜è…¾é»‘è‹¹æœçš„æ—¶å€™å¯ä»¥ç›´æ¥å…é©±ä½¿ç”¨ã€‚ 4.2 HWinfoæ¥ç€æˆ‘ä»¬æ‰“å¼€HWinfoï¼Œè¿™ä¸ªè½¯ä»¶å€’æ˜¯å¯ä»¥è¯†åˆ«å‡ºCPUçš„å‡†ç¡®ä¿¡æ¯ï¼š åŒæ—¶è¿˜å¯ä»¥çœ‹åˆ°ä¸‰å—å›ºæ€éƒ½å·¥ä½œæ­£å¸¸ï¼š è¿™é‡Œå¯ä»¥æ­£ç¡®è¯†åˆ«å‡ºCPUçš„ç¿é¢‘ä¿¡æ¯ï¼Œä»¥åŠAVXæŒ‡ä»¤é›†ä¸‹çš„æœ€å¤§ç¿é¢‘é¢‘ç‡ã€‚ 4.3 AIDA64æ¥ç€æˆ‘ä»¬ä½¿ç”¨AIDA64å¯¹å†…å­˜æ€§èƒ½å’Œæ•£çƒ­è¿›è¡Œæµ‹è¯•ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å››é€šé“å†…å­˜çš„çŠ¶æ€ä¸‹ï¼Œå†…å­˜çš„è¯»å†™æ€§èƒ½ç›¸æ¯”æ™®é€šçš„åŒé€šé“å†…å­˜æœ‰äº†å¾ˆå¤§çš„æå‡ï¼ŒåŒæ—¶è¿™æ—¶çš„å†…å­˜åœ¨BIOSä¸­ç®€å•çš„è®¾ç½®åä¾¿æ˜¯å·¥ä½œåœ¨2933MHz C16çš„é¢‘ç‡ä¸‹ï¼Œç›¸å¯¹æ¥è¯´ç®—æ˜¯ä¸­è§„ä¸­çŸ©ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨å°é—­æœºç®±å†…è¿›è¡Œçƒ¤æœºæµ‹è¯•ï¼Œçœ‹ä¸€ä¸‹æ•´æœºçš„è´Ÿè½½æƒ…å†µå’Œæ•£çƒ­æ•ˆæœï¼š è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨AIDA64çš„ç¨³å®šæ€§æµ‹è¯•ï¼Œçƒ¤æœº10åˆ†é’Ÿåæ•´æœºåŠŸè€—ç¨³å®šåœ¨420Wå·¦å³ï¼Œæ­£å¥½åœ¨ç”µæº850Wçš„ä¸€åŠå·¦å³ï¼Œä¹Ÿå°±æ˜¯ç†è®ºè½¬æ¢ç‡æœ€é«˜çš„å ç”¨ç‡ã€‚ å†æ¥çœ‹è¿™æ—¶å€™æ•´å¥—å¹³å°çš„æ¸©åº¦æƒ…å†µï¼Œåœ¨å®¤æ¸©20åº¦å·¦å³çš„æƒ…å†µä¸‹ï¼ŒCPUç¨³å®šåœ¨70åº¦é™„è¿‘ï¼Œæ˜¾å¡åˆ™æ˜¯ç¨³å®šåœ¨75åº¦é™„è¿‘ï¼Œæ•´ä½“æ•£çƒ­æƒ…å†µè¿˜ç®—æ˜¯ä¸é”™ã€‚ 4.4 R20åœ¨å–å®¶æä¾›çš„R20æˆªå›¾ä¸­ï¼Œè·‘åˆ°äº†8600+çš„é«˜åˆ†ï¼Œè€Œåœ¨æˆ‘çš„å®é™…è·‘åˆ†æµ‹è¯•ä¸­ï¼Œåªæœ‰7800å·¦å³ï¼Œå…·ä½“çš„åŸå› è¿˜ä¸å¤ªæƒ…å†µï¼Œå¯èƒ½æ˜¯ä¸»æ¿çš„åŸå› æˆ–è€…æ˜¯å¾®ç ç‰ˆæœ¬ä¹Ÿæˆ–è€…æ˜¯å…¶ä»–çš„å› ç´ ï¼Œä¸ç®¡æ€ä¹ˆè¯´ï¼Œå°†è¿‘10%çš„å·®è·è¿˜æ˜¯æœ‰äº›ä»¤äººå›°æƒ‘çš„ï¼ŒåŒæ ·çš„æƒ…å†µä¹Ÿå‡ºç°åœ¨äº†CPU-Zçš„è·‘åˆ†ä¸Šï¼Œè™½ç„¶å¤šæ ¸è·‘åˆ†ç›¸è¿‘ï¼Œä½†æ˜¯å•æ ¸è·‘åˆ†æˆç»©çš„440å’Œå–å®¶çš„520ç›¸æ¯”ä¹Ÿæ˜¯ä½äº†10%è¿˜ä¸æ­¢ã€‚ 4.5 æ— çº¿åšé€šBCM943602CSè¿™å—ç½‘å¡å¥½å¤„æ˜¯åœ¨é»‘è‹¹æœä¸‹å¯ä»¥å®ç°å…é©±ï¼Œè€ƒè™‘åˆ°é»‘è‹¹æœå¯¹æ— çº¿æ¨¡å—çš„ç¡¬ä»¶å…¼å®¹æ€§ä¹‹å·®ï¼Œè¿™å°±æ˜¾å¾—æ ¼å¤–é‡è¦ï¼ŒåŒæ ·åšé€šçš„æ— çº¿ç½‘å¡åœ¨RedHatå’ŒDebianç³»çš„Linuxç³»ç»Ÿä¸Šéƒ½æœ‰è¾ƒä¸ºå‹å¥½æˆç†Ÿçš„é—­æºé©±åŠ¨æ”¯æŒï¼Œå¯¹Linuxå†…æ ¸çš„ç‰ˆæœ¬è¦æ±‚ä¸é«˜ã€‚ä¸è¿‡è¿™å—ç½‘å¡åœ¨windowsä¸‹çš„é©±åŠ¨å¹¶ä¸å®Œå–„ï¼Œ2.4Gæ— çº¿çš„é€Ÿç‡åªæœ‰216Mï¼Œæ— æ³•å‘æŒ¥æ ‡ç§°çš„450Mé€Ÿç‡ï¼Œä¸è¿‡å¥½åœ¨5Gé¢‘æ®µèƒ½å¤Ÿå®ç°1.3Gçš„æ— çº¿é€Ÿç‡ï¼Œè¿™æ¯”å‡ ä¹ä¸æ€ä¹ˆç”¨åˆ°çš„2.4Gæ¥çš„æ›´åŠ å®é™…ä¸€äº›ã€‚è€Œé©±åŠ¨æ›´ä¸ºå®Œå–„çš„94360CDåˆ™æ˜¯è¦è´µä¸Šä¸€äº›ï¼Œå…·ä½“é€‰æ‹©å“ªä¸ªå°±è§ä»è§æ™ºäº†ã€‚ æ¥ç€æˆ‘ä»¬ä½¿ç”¨Windowsåœ¨å±€åŸŸç½‘å†…é€šè¿‡åç¡•AC68U(1900P)è¿›è¡Œé€Ÿåº¦æµ‹è¯•ï¼Œ2.4Gçš„è¡¨ç°æƒ…å†µååˆ†å·®åŠ²ï¼Œä¸ä»…é€Ÿåº¦å¾ˆæ…¢ï¼Œåªèƒ½åœ¨10MB/så·¦å³å¾˜å¾Šï¼Œè€Œä¸”è¿™æ—¶å€™çš„è“ç‰™å’Œ2.4Gé¼ æ ‡éƒ½å—åˆ°äº†ä¸¥é‡çš„å¹²æ‰°ï¼Œè€Œåœ¨5Gé¢‘æ®µä¸‹åˆ™å¥½å¾ˆå¤šï¼ŒåŸºæœ¬åœ¨90MB/så·¦å³å¾˜å¾Šï¼Œå¶å°”èƒ½åˆ°100MB/så·¦å³ï¼Œç›¸æ¯”2T2Rçš„Intel AX200è¦å¥½ä¸Šå¾ˆå¤šï¼ˆä½¿ç”¨WiFi5çš„åç¡•AC68Uè·¯ç”±å™¨åªæœ‰50~60MB/sçš„é€Ÿåº¦ï¼‰ï¼Œå½“ç„¶943602CSçš„ä»·æ ¼ä¹Ÿæ˜¯æ¯”AX200è¦è´µä¸Šå¾ˆå¤šã€‚ ä¸è¿‡è¿™é‡Œçš„æ— çº¿ä¸»è¦è¿˜æ˜¯åœ¨æ²¡æœ‰æœ‰çº¿ç½‘ç»œçš„åœºæ™¯ä¸‹çš„è¡¥å……ï¼Œä»¥åŠä¸ºå°å¼æœºæ‰©å±•è“ç‰™åŠŸèƒ½ç”¨æ¥è¿æ¥å„ç§è“ç‰™é”®é¼ è€³æœºç­‰è®¾å¤‡ï¼ŒçœŸæ­£éœ€è¦å¤§é‡çš„æ–‡ä»¶æ•°æ®ä¼ è¾“å·¥ä½œè¿˜æ˜¯éœ€è¦ä½¿ç”¨ç¨³å®šçš„æœ‰çº¿åƒå…†ç½‘ç»œæˆ–è€…æ˜¯ä¸‡å…†ç½‘ç»œã€‚ 4.6 é²å¤§å¸ˆæœ€åå½“ç„¶å°‘ä¸äº†é²å¤§å¸ˆäº†ï¼Œè¿™é‡Œé¡ºä¾¿åæ§½ä¸€ä¸‹å‡çº§äº†æ–°ç‰ˆçš„windows1909å’ŒAMDçš„2020å¹´æ–°æ¬¾é¸¡è¡€é©±åŠ¨ä¹‹åï¼Œæ˜¾å¡çš„è·‘åˆ†åè€Œæ›´ä½äº†ä¸€äº›ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ç³»ç»Ÿçš„é—®é¢˜è¿˜æ˜¯é©±åŠ¨çš„é—®é¢˜ï¼Œå¸Œæœ›èƒ½å°½å¿«åœ°ä¼˜åŒ–å¥½å§ã€‚ 5ã€æ€»ç»“ æ€»çš„æ¥è¯´ï¼Œè¿™æ¬¡çš„è¿™å¥—ä¸»æœºè¿˜æ˜¯ç›¸å½“è®©æˆ‘æ»¡æ„çš„ï¼Œé™¤äº†æ»¡è¶³äº†æˆ‘çš„æ¯•ä¸šæ€§èƒ½éœ€æ±‚ï¼ˆå¤§æ¦‚åŒæ—¶ä¸­åº¦è¿è¡Œ9~12å°è™šæ‹Ÿæœºï¼‰ä»¥åŠæ—¥å¸¸çš„æ•°æ®å­˜å‚¨éœ€æ±‚ï¼Œè¿˜å¯ä»¥å…¼ä»»ä¸€å®šçš„ä¸­åº¦æ¸¸æˆéœ€æ±‚å’Œè§†é¢‘å‰ªè¾‘éœ€æ±‚ï¼ˆå¦‚æœåæœŸæœ‰çš„è¯ï¼‰ï¼ŒåæœŸå¦‚æœè¿˜æœ‰å‡çº§çš„è¯åº”è¯¥å°±æ˜¯åŠ é’±ä¹°æ›´å¤šçš„NVMEå›ºæ€ï¼Œæ¯•ç«Ÿè¿˜æœ‰ä¸¤ä¸ªæ§½ä½ç©ºç€ï¼Œä»¥åŠæœºæ¢°ç¡¬ç›˜å¢åŠ åˆ°ä¸€å®šæ•°é‡ä¹‹åå†å¢åŠ ä¸‡å…†NASå’Œä¸‡å…†ç½‘å¡äº†ã€‚ å½“ç„¶æœ€åè¿˜æ˜¯å¸Œæœ›AMDå’ŒINTELçš„ç«äº‰èƒ½æ›´åŠ æ¿€çƒˆä¸€äº›ï¼Œè¿™æ ·æ¶ˆè´¹è€…ä»¬æ‰èƒ½å—ç›Šæ›´å¤šï¼Œæˆ‘ä¹Ÿæ‰èƒ½æ¡åˆ°æ›´å¤šæ›´å¥½çš„äºŒæ‰‹æ´‹åƒåœ¾ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"}]},{"title":"win10å¼€å¯å“è¶Šç”µæºæ€§èƒ½è®¡åˆ’","slug":"20191203-win10-extreperf-mode","date":"2019-12-03T07:00:00.000Z","updated":"2019-12-03T07:00:00.000Z","comments":true,"path":"20191203-win10-extreperf-mode/","link":"","permalink":"https://tinychen.com/20191203-win10-extreperf-mode/","excerpt":"åœ¨Win10ä¸­é€šè¿‡å‘½ä»¤è¡Œå¼€å¯å“è¶Šç”µæºæ€§èƒ½è®¡åˆ’ã€‚","text":"åœ¨Win10ä¸­é€šè¿‡å‘½ä»¤è¡Œå¼€å¯å“è¶Šç”µæºæ€§èƒ½è®¡åˆ’ã€‚ å³é”®ä»»åŠ¡æ çš„å¼€å§‹èœå•å¾½æ ‡ï¼Œç‚¹å‡»Windows Powershell(ç®¡ç†å‘˜)ï¼Œåœ¨é‡Œé¢è¾“å…¥ 1powercfg -duplicatescheme e9a42b02-d5df-448d-aa00-03f14749eb61 ç„¶åå›è½¦ã€‚ æ¥ç€åœ¨ç”µæºè®¡åˆ’ä¸­é€‰ä¸­å“è¶Šæ€§èƒ½ã€‚ ç”µæºè®¡åˆ’å¯ä»¥åœ¨è®¾ç½®ä¸­ç›´æ¥æœç´¢ç”µæºæˆ–è€…ä½¿ç”¨å°å¨œæœç´¢ç”µæºï¼Œç¬”è®°æœ¬ä¹Ÿå¯ä»¥ç›´æ¥å³é”®ä»»åŠ¡æ çš„ç”µæºå›¾æ ‡æ¥ç‚¹å‡»ç”µæºé€‰é¡¹è¿›å…¥åˆ°å¯¹åº”è®¾ç½®ç•Œé¢ã€‚ å®é™…ä½“éªŒä¸Šï¼Œå“è¶Šæ€§èƒ½å’Œé«˜æ€§èƒ½å¯¹äºæˆ‘çš„å°å¼æœºæ¥è¯´åŸºæœ¬æ„Ÿè§‰ä¸åˆ°å·®å¼‚ï¼Œå¯èƒ½æ˜¯å¯¹äºç¬”è®°æœ¬ç­‰è®¾å¤‡æ¥è¯´ç”¨é€”ä¼šæ›´å¤§ä¸€äº›å§ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"}]},{"title":"æ­å»ºLNMPç¯å¢ƒå¹¶é…ç½®wordpressç½‘ç«™","slug":"20191123-lnmp-install-wordpress","date":"2019-11-23T07:00:00.000Z","updated":"2019-11-23T07:00:00.000Z","comments":true,"path":"20191123-lnmp-install-wordpress/","link":"","permalink":"https://tinychen.com/20191123-lnmp-install-wordpress/","excerpt":"CentOS7ä¸­æ­å»ºnginx+MySQL8+PHP7çš„LNMPç¯å¢ƒï¼Œå¹¶ä¸”å®‰è£…wordpressæ¥ä½œä¸ºç½‘ç«™æœåŠ¡å™¨ã€‚","text":"CentOS7ä¸­æ­å»ºnginx+MySQL8+PHP7çš„LNMPç¯å¢ƒï¼Œå¹¶ä¸”å®‰è£…wordpressæ¥ä½œä¸ºç½‘ç«™æœåŠ¡å™¨ã€‚ linuxçš„å®‰è£…éå¸¸çš„ç®€å•ï¼Œä¸€èˆ¬çš„äº‘ä¸»æœºå‚å•†éƒ½å¯ä»¥ç›´æ¥éƒ¨ç½²å®‰è£…ï¼Œå®‰è£…æ–¹æ³•æˆ‘ä»¬è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯CentOS7.7ç‰ˆæœ¬ã€‚ è¿™é‡Œæ˜¯wordpressçš„å®˜ç½‘å¯¹äºå®‰è£…ç¯å¢ƒçš„è¦æ±‚ï¼š We recommend servers running version 7.3 or greater of PHP and MySQL version 5.6 OR MariaDB version 10.0 or greater.We also recommend either Apache or Nginx as the most robust options for running WordPress, but neither is required. 1ã€å®‰è£…nginxnginxè¿™é‡Œä¸ºäº†ä½¿ç”¨è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨nginxå®˜ç½‘æä¾›çš„yumæºæ¥è¿›è¡Œå®‰è£…ã€‚ 123456789101112131415161718# æ–°å»ºä¸€ä¸ªyum repoæ–‡ä»¶cat &gt;&gt; /etc/yum.repo.d/nginx.repo &lt;&lt; EOF[nginx] name=nginx repo baseurl=http://nginx.org/packages/mainline/centos/7/x86_64/gpgcheck=0 enabled=1 EOF# ä½¿ç”¨yumå®‰è£…nginxyum clean allyum repolistyum install nginx -y# å¯åŠ¨nginxå¹¶è®¾ç½®å¼€æœºå¯åŠ¨systemctl enable nginx.servicesystemctl start nginx.service 2ã€å®‰è£…PHP7.3centosç³»ç»Ÿæºä¸­è‡ªå¸¦çš„phpç‰ˆæœ¬è¾ƒæ—§ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨epelæºå’Œremiæºæ¥å®‰è£…æ–°ç‰ˆæœ¬çš„phpã€‚æˆªæ­¢å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™phpå®˜ç½‘çš„ç¨³å®šç‰ˆæœ¬æ˜¯7.3,7.4ç‰ˆæœ¬è™½ç„¶å·²ç»å‘å¸ƒä½†æ˜¯å¥½åƒè¿˜æ²¡æœ‰åˆ°ç¨³å®šç‰ˆã€‚ 12345678# ä½¿ç”¨yumæ¥å®‰è£…epelæºyum install epel-release# è¿™é‡Œä½¿ç”¨æ¸…åé•œåƒæºçš„remiæºrpm -ivh https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm# å¯ç”¨remiæºä¸­çš„php73yum install yum-utilsyum-config-manager --enable remi-php73yum install php73 php-fpm php-opcache php-cli php-gd php-curl php-mysql php-intl php-mbstring php-soap php-xml php-xmlrpc php-zip å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹phpçš„ç‰ˆæœ¬ï¼Œç„¶åå»ºç«‹è½¯é“¾æ¥æŠŠphpæŒ‡å‘php73ã€‚ 1234567891011121314151617# æŸ¥çœ‹php73çš„ç‰ˆæœ¬ä¿¡æ¯[root@aliyun ~]# php73 -vPHP 7.3.12 (cli) (built: Nov 19 2019 10:24:51) ( NTS )Copyright (c) 1997-2018 The PHP GroupZend Engine v3.3.12, Copyright (c) 1998-2018 Zend Technologies# ç¡®å®šphp73çš„æ‰§è¡Œæ–‡ä»¶ä½ç½®[root@aliyun ~]# which php73/usr/bin/php73# å»ºç«‹è½¯é“¾æ¥å°†phpæŒ‡å‘php73[root@aliyun ~]# ln -s /usr/bin/php73 /usr/bin/php# æŸ¥çœ‹phpæŒ‡ä»¤å¯¹åº”çš„ç‰ˆæœ¬ä¿¡æ¯[root@aliyun ~]# php -vPHP 7.3.12 (cli) (built: Nov 19 2019 10:24:51) ( NTS )Copyright (c) 1997-2018 The PHP GroupZend Engine v3.3.12, Copyright (c) 1998-2018 Zend Technologies 3ã€å®‰è£…MYSQL8wordpresså®˜ç½‘è¦æ±‚çš„æ•°æ®åº“å¯ä»¥æ˜¯MySQLæˆ–è€…æ˜¯MariaDBï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨MySQL8ã€‚ è¯¦ç»†çš„å®‰è£…æ•™ç¨‹ä¹‹å‰å·²ç»å†™è¿‡åšå®¢äº†ï¼Œéœ€è¦çš„åŒå­¦å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š CentOS7å®‰è£…MySQL MySQL8é‡ç½®rootå¯†ç  æ¥ä¸‹æ¥å°±æ˜¯åœ¨mysqlä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å’Œç”¨æˆ·ç”¨æ¥ç»™wordpressä½¿ç”¨ã€‚ é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨rootç”¨æˆ·ç™»å½•mysqlï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªåä¸ºwordpressçš„æ•°æ®åº“å’Œä¸€ä¸ªwordpressçš„ç”¨æˆ·ï¼š 123CREATE DATABASE wordpress;CREATE USER &#x27;wordpress&#x27; IDENTIFIED BY &#x27;ä¸€ä¸ªå¤æ‚çš„å¯†ç &#x27;;GRANT ALL PRIVILEGES ON wordpress.* TO wordpress; è¿™é‡Œçš„grantè¯­å¥çš„æˆæƒæ–¹å¼å’Œä¹‹å‰çš„mysqlç‰ˆæœ¬æœ‰äº›ä¸å¤ªä¸€æ ·ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚ 12345678910111213141516171819202122232425262728293031mysql&gt; create database wordpress;Query OK, 1 row affected (0.01 sec)mysql&gt; CREATE USER &#x27;wordpress&#x27; IDENTIFIED BY &#x27;ä¸€ä¸ªå¤æ‚çš„å¯†ç &#x27;;Query OK, 0 rows affected (0.01 sec)mysql&gt; GRANT ALL PRIVILEGES ON wordpress.* TO wordpress;Query OK, 0 rows affected (0.00 sec)[root@aliyun ~]# mysql -u wordpress -pEnter password: Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 10Server version: 8.0.18 MySQL Community Server - GPLCopyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#x27;help;&#x27; or &#x27;\\h&#x27; for help. Type &#x27;\\c&#x27; to clear the current input statement.mysql&gt; show databases;+--------------------+| Database |+--------------------+| information_schema || wordpress |+--------------------+2 rows in set (0.00 sec)mysql&gt; 4ã€å®‰è£…wordpressæ¥ä¸‹æ¥çš„wordpressçš„é…ç½®å°±æ¯”è¾ƒç®€å•äº†ï¼Œæˆ‘ä»¬å…ˆå»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„wordpressï¼Œè§£å‹ä¹‹åé…ç½®ä¸€ä¸‹é…ç½®æ–‡ä»¶ã€‚ 123# ä½¿ç”¨wgetæŒ‡ä»¤ä¸‹è½½å¹¶ä½¿ç”¨tar -zxvfå‚æ•°è¿›è¡Œè§£å‹wget https://wordpress.org/latest.tar.gztar -zxvf wordpress-5.3-zh_CN.tar.gz æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼ŒæŒ‰ç…§å®˜ç½‘æ‰€è¿°ï¼Œæˆ‘ä»¬æœ€å¥½å°†wp-config-sample.phpå¤åˆ¶æˆwp-config.phpç„¶åå†è¿›è¡Œç¼–è¾‘ï¼Œä¸å¤åˆ¶ç›´æ¥ç¼–è¾‘wp-config-sample.phpä¹Ÿæ˜¯å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ–°çš„wp-config.phpï¼Œä½†æ˜¯å‡ºäºå¤‡ä»½ä¸€ä»½æºé…ç½®æ–‡ä»¶æ¨¡æ¿çš„è€ƒè™‘ï¼Œæœ€å¥½è¿˜æ˜¯å¤åˆ¶ä¸€ä¸‹ã€‚ 12cp wp-config-sample.php wp-config.php vim wp-config.php è¿™é‡Œæˆ‘ä»¬å¡«å…¥å‰é¢åˆ›å»ºçš„æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç ä»¥åŠå¯¹åº”çš„æ•°æ®åº“ã€‚ æ¥ä¸‹æ¥è¿™ä¸€æ­¥å°±æ˜¯æ ¹æ®ä¸»æœºç”Ÿæˆç‹¬ä¸€æ— äºŒçš„å¯†é’¥ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨curlå‘½ä»¤æ¥è®¿é—®è¿™ä¸ªé“¾æ¥ç”Ÿæˆå¯†é’¥å¹¶ä¿æŒåˆ°key.txtæ–‡ä»¶ä¸­ï¼Œç„¶åæŠŠkey.txtçš„æ–‡ä»¶é‡Œé¢çš„å†…å®¹å¤åˆ¶æ›¿æ¢æ‰é‡Œé¢çš„defineéƒ¨åˆ†ã€‚ 1curl -s https://api.wordpress.org/secret-key/1.1/salt/ &gt; key.txt ç„¶åæˆ‘ä»¬å°†æ•´ä¸ªè§£å‹å‡ºæ¥çš„wordpressæ–‡ä»¶å¤¹ç§»åŠ¨åˆ°æˆ‘ä»¬çš„webæœåŠ¡å™¨çš„ç›®å½•ä¸‹é¢ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„ç›®å½•æ˜¯/etc/nginx/wordpressï¼Œè¿™é‡Œåœ¨åé¢çš„nginxé…ç½®æ–‡ä»¶ä¸­ä¼šç”¨åˆ°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹nginxè¿›è¡Œé…ç½®ã€‚ ä¸‹é¢çš„æ˜¯æˆ‘çš„nginxé…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶ä½äº/etc/nginx/nginx.confï¼Œæ³¨æ„é‡Œé¢çš„ç›®å½•å’ŒåŸŸåè¦æ¢æˆè‡ªå·±å¯¹åº”çš„ç›®å½•å’ŒåŸŸåï¼Œä»¥åŠè¿™é‡Œè¿˜é¢å¤–é…ç½®äº†httpsè¯ä¹¦åŠ å¯†è®¤è¯å’Œhttpå¼ºåˆ¶è·³è½¬httpsï¼Œå…·ä½“çš„æ“ä½œå’Œè§£é‡Šå·²ç»åœ¨è¿™ç¯‡åšå®¢ï¼ˆä¸ªäººåšå®¢webæœåŠ¡å™¨æ¢ç”¨nginxï¼‰é‡Œé¢æœ‰è§£é‡Šï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹çœ‹ã€‚ æˆ‘ä»¬ä½¿ç”¨rootç”¨æˆ·ç™»å½•mysqlï¼Œç„¶åæ›´æ–°wordpressç”¨æˆ·çš„åŠ å¯†æ–¹å¼ä¸ºmysql_native_passwordï¼Œç„¶ååˆ·æ–°é…ç½®å³å¯ã€‚ 1234// æ›´æ”¹ç”¨æˆ·å¯†ç çš„åŠ å¯†å½¢å¼ALTER USER &#x27;wordpress&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;ä½ çš„ç”¨æˆ·å¯†ç &#x27;;// åˆ·æ–°MySQLçš„ç³»ç»Ÿæƒé™ç›¸å…³è¡¨FLUSH PRIVILEGES; å†æ¬¡ç™»å½•å°±ä¼šå‘ç°å·²ç»å¯ä»¥è¿æ¥æ•°æ®åº“å¹¶æ­£å¸¸è®¾ç½®äº†ï¼Œç®€å•é…ç½®è¿‡åå°±å¯ä»¥å¼€å§‹æ­£å¸¸è¿è¡Œäº†ã€‚ è®¾ç½®è¿‡åå°±å¯ä»¥ç™»å½•åå°è¿›è¡Œç®¡ç†ï¼Œç™»å½•çš„é“¾æ¥å°±æ˜¯åŸŸååé¢åŠ ä¸Š/wp-admin/ ä½¿ç”¨é»˜è®¤ä¸»é¢˜çš„é¦–é¡µã€‚ è¿™å°±æ˜¯wordpressçš„LNMPç‰ˆæœ¬å®‰è£…é…ç½®è¿‡ç¨‹ï¼Œæ•´ä½“è¿˜æ˜¯ç›¸å¯¹ç®€å•ï¼Œæ²¡æœ‰å¤ªå¤§çš„éš¾åº¦ï¼Œç›¸å¯¹äºhexoè€Œè¨€ï¼Œwordpressçš„å®‰è£…æ˜¾å¾—å¤æ‚å¾ˆå¤šï¼Œæ•´ä½“ä¹Ÿå¯èƒ½è¢«äººè¯Ÿç—…ååˆ†è‡ƒè‚¿ï¼Œä½†æ˜¯ä¸¤è€…å„æœ‰å„çš„å¥½ï¼Œwordpressçš„æ’ä»¶å’Œä¸»é¢˜ä¸°å¯Œç¨‹åº¦ç¡®å®è¦æ¯”hexoå¼ºå¾ˆå¤šï¼Œä½†æ˜¯ä¸ç®¡æ˜¯ç”¨å“ªä¸ªï¼ŒåšæŒå†™ä½œæ‰æ˜¯æœ€é‡è¦çš„ï¼","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"mysql","slug":"mysql","permalink":"https://tinychen.com/tags/mysql/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"MySQL8é‡ç½®rootå¯†ç ","slug":"20191122-mysql8-reset-passwd","date":"2019-11-22T07:00:00.000Z","updated":"2019-11-22T07:00:00.000Z","comments":true,"path":"20191122-mysql8-reset-passwd/","link":"","permalink":"https://tinychen.com/20191122-mysql8-reset-passwd/","excerpt":"CentOS7ä¸­MySQL8.0åˆå§‹rootå¯†ç çš„è®¾ç½®å’Œå¿˜è®°rootå¯†ç çš„é‡ç½®æ–¹æ³•ã€‚","text":"CentOS7ä¸­MySQL8.0åˆå§‹rootå¯†ç çš„è®¾ç½®å’Œå¿˜è®°rootå¯†ç çš„é‡ç½®æ–¹æ³•ã€‚ 1ã€åˆæ¬¡ç™»å½•å¦‚æœæ˜¯åˆšè£…å¥½MySQLçš„è¯ï¼Œå®ƒä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªéšæœºå¯†ç åœ¨logæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¥å¯†ç ç™»å½•ç„¶åé‡ç½®å¯†ç å³å¯ã€‚ 1234[root@aliyun ~]# sudo grep &#x27;temporary password&#x27; /var/log/mysqld.log2019-11-22T16:40:10.133730Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: &gt;KG6Ybt3%lgo[root@aliyun ~]# mysql -u root -pEnter password: é‡ç½®å¯†ç å¯ä»¥ä½¿ç”¨è¿™æ¡å‘½ä»¤ï¼š 1ALTER user &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;ä½ çš„æ–°å¯†ç &#x27;; æ³¨æ„è¿™é‡Œçš„&#39;localhost&#39;ä¹Ÿæœ‰å¯èƒ½æ˜¯åˆ«çš„å‚æ•°ï¼Œå…·ä½“å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ¡å‘½ä»¤æ¥è¿›è¡ŒæŸ¥è¯¢ï¼š 1select user, host, authentication_string, plugin from mysql.user; 2ã€é—å¿˜rootå¯†ç å¦‚æœæ˜¯å¿˜è®°äº†rootå¯†ç ï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚é¦–å…ˆæˆ‘ä»¬åœæ­¢mysqldæœåŠ¡ã€‚ 12systemctl stop mysqld.service systemctl status mysqld.service æ¥ç€æˆ‘ä»¬ç¼–è¾‘/etc/my.confè®©å…¶è·³è¿‡ç™»å½•å¯†ç æ£€æŸ¥ã€‚ 1echo skip-grant-tables &gt;&gt; /etc/my.conf æ¥ç€æˆ‘ä»¬é‡å¯mysqldæœåŠ¡å¹¶ç™»å½•ï¼Œæ­¤æ—¶ä¸éœ€è¦ä½¿ç”¨å¯†ç ã€‚ 123systemctl restart mysqld.service systemctl status mysqld.service mysql -u root è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”¨æˆ·çš„è´¦æˆ·ä¿¡æ¯éƒ½æ˜¯å­˜å‚¨åœ¨mysqlè¿™ä¸ªæ•°æ®åº“ä¸­çš„userè¡¨é‡Œé¢çš„ã€‚ 123show databases;use mysql;show tables; 12select * from user\\G;-- \\Gå‚æ•°è¡¨ç¤ºçºµå‘è¾“å‡ºæ ¼å¼ 1234567select host, user, authentication_string, plugin from user;-- host: å…è®¸ç”¨æˆ·ç™»å½•çš„ipâ€˜ä½ç½®â€™%è¡¨ç¤ºå¯ä»¥è¿œç¨‹ï¼›-- user:å½“å‰æ•°æ®åº“çš„ç”¨æˆ·åï¼›-- authentication_string: ç”¨æˆ·å¯†ç ï¼›åœ¨mysql 5.7.9ä»¥ååºŸå¼ƒäº†passwordå­—æ®µå’Œpassword()å‡½æ•°ï¼›-- pluginï¼š å¯†ç åŠ å¯†æ–¹å¼ï¼›update user set authentication_string=&#x27;&#x27; where user=&#x27;root&#x27;;select host, user, authentication_string, plugin from user; ç„¶åæˆ‘ä»¬ç»§ç»­ç¼–è¾‘/etc/my.confåˆ é™¤æ‰åˆšåˆšæ·»åŠ çš„é‚£ä¸€è¡Œskip-grant-tablesï¼Œç„¶åé‡å¯mysqlã€‚ ç„¶åæˆ‘ä»¬ç™»å½•è¿›å»ï¼Œè¿™æ—¶å€™è¿˜æ˜¯ä¸éœ€è¦è¾“å…¥å¯†ç çš„ã€‚æˆ‘ä»¬é€šè¿‡è¿™æ¡å‘½ä»¤æ¥è¿›è¡Œè®¾ç½®æ–°å¯†ç çš„æ“ä½œã€‚ 1ALTER user &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;ä½ çš„æ–°å¯†ç &#x27;; è¿™é‡Œè¦æ³¨æ„æ–°å¯†ç è¦å°½å¯èƒ½å¤æ‚ã€‚åŒ…å«å¤§å°å†™å­—æ¯æ•°å­—å’Œç¬¦å·æœ€å¥½ï¼Œå¦åˆ™å¯èƒ½ä¼šæç¤ºä¸ç¬¦åˆè¦æ±‚ã€‚ 1234567891011121314151617181920212223242526[root@aliyun ~]# systemctl restart mysqld.service [root@aliyun ~]# mysql -u root -pEnter password: Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 8Server version: 8.0.18Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#x27;help;&#x27; or &#x27;\\h&#x27; for help. Type &#x27;\\c&#x27; to clear the current input statement.mysql&gt; use mysqlERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.mysql&gt; show tables;ERROR 1046 (3D000): No database selectedmysql&gt; ALTER user &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;centos7&#x27;;ERROR 1819 (HY000): Your password does not satisfy the current policy requirementsmysql&gt; ALTER user &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;MySQLNB8@2333&#x27;;Query OK, 0 rows affected (0.01 sec)mysql&gt; åˆ°è¿™é‡Œå†é€€å‡ºé‡æ–°ç™»å½•å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è®¾ç½®çš„æ–°å¯†ç å·²ç»ç”Ÿæ•ˆäº†ã€‚","categories":[{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"mysql","slug":"mysql","permalink":"https://tinychen.com/tags/mysql/"}]},{"title":"åœ¨Ubuntu18.04ä¸­å®‰è£…å‡çº§pip3å¹¶ä½¿ç”¨socksä»£ç†","slug":"20191121-ubuntu-install-pip3","date":"2019-11-21T07:00:00.000Z","updated":"2019-11-21T07:00:00.000Z","comments":true,"path":"20191121-ubuntu-install-pip3/","link":"","permalink":"https://tinychen.com/20191121-ubuntu-install-pip3/","excerpt":"ubuntu18.04ä¸­è‡ªå¸¦äº†python3ä½†æ˜¯ç¼ºå°‘äº†pip3ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨aptæ¥è¿›è¡Œå®‰è£…ï¼Œç„¶åä½¿ç”¨pip3è‡ªå·±å¯¹è‡ªå·±å‡çº§ï¼Œå†å®‰è£…å¯¹åº”çš„socksä¾èµ–åŒ…ï¼Œè¿™æ ·åœ¨ç³»ç»Ÿä½¿ç”¨äº†socksä»£ç†çš„æ—¶å€™èƒ½å¤Ÿä½¿ç”¨ä»£ç†ä¸‹è½½å„ç§åŒ…ï¼Œæœ‰æ•ˆæé«˜é€Ÿåº¦ã€‚","text":"ubuntu18.04ä¸­è‡ªå¸¦äº†python3ä½†æ˜¯ç¼ºå°‘äº†pip3ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨aptæ¥è¿›è¡Œå®‰è£…ï¼Œç„¶åä½¿ç”¨pip3è‡ªå·±å¯¹è‡ªå·±å‡çº§ï¼Œå†å®‰è£…å¯¹åº”çš„socksä¾èµ–åŒ…ï¼Œè¿™æ ·åœ¨ç³»ç»Ÿä½¿ç”¨äº†socksä»£ç†çš„æ—¶å€™èƒ½å¤Ÿä½¿ç”¨ä»£ç†ä¸‹è½½å„ç§åŒ…ï¼Œæœ‰æ•ˆæé«˜é€Ÿåº¦ã€‚ 12345678910111213# ä½¿ç”¨aptå®‰è£…pip3# éœ€è¦æ³¨æ„çš„æ˜¯python3-pipå’Œpython-pipæ˜¯ä¸ä¸€æ ·çš„ï¼Œå‰è€…æ˜¯python3è€Œåè€…æ˜¯python2sudo apt-get install python3-pip# ä½¿ç”¨aptå®‰è£…çš„ç‰ˆæœ¬å¾ˆæ—§ï¼Œå¤§æ¦‚æ˜¯9.0+ï¼Œæˆ‘ä»¬å°†å®ƒå‡çº§åˆ°æœ€æ–°sudo pip3 install --upgrade pip# è¿™é‡Œé¡ºä¾¿é™„ä¸Šå¸è½½pip3çš„å‘½ä»¤sudo apt-get remove python3-pip# å®‰è£…socksæ‰€éœ€è¦çš„ä¾èµ–sudo apt install qt5-qmake qtbase5-dev libqrencode-dev libappindicator-dev libzbar-dev libbotan1.10-devsudo pip3 install pysocks æœ€åæˆ‘ä»¬éšä¾¿å®‰è£…ä¸€ä¸ªåŒ…æ¥ç¡®å®šä¸€ä¸‹ä¸‹è½½å®‰è£…çš„é€Ÿåº¦ 12345678tinychen@Tiny-Studio:~$ sudo pip3 install numpyWARNING: The directory &#x27;/home/tinychen/.cache/pip/http&#x27; or its parent directory is not owned by the current user and the cache has been disabled. Please check the permissions and owner of that directory. If executing pip with sudo, you may want sudo&#x27;s -H flag.WARNING: The directory &#x27;/home/tinychen/.cache/pip&#x27; or its parent directory is not owned by the current user and caching wheels has been disabled. check the permissions and owner of that directory. If executing pip with sudo, you may want sudo&#x27;s -H flag.Collecting numpy Downloading https://files.pythonhosted.org/packages/d2/ab/43e678759326f728de861edbef34b8e2ad1b1490505f20e0d1f0716c3bf4/numpy-1.17.4-cp36-cp36m-manylinux1_x86_64.whl (20.0MB) |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 20.0MB 4.1MB/s Installing collected packages: numpySuccessfully installed numpy-1.17.4","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"python","slug":"python","permalink":"https://tinychen.com/tags/python/"},{"name":"socks","slug":"socks","permalink":"https://tinychen.com/tags/socks/"}]},{"title":"åœ¨Linuxä¸­ä½¿ç”¨xrandrè°ƒæ•´åˆ†è¾¨ç‡","slug":"20191105-linux-use-xrandr","date":"2019-11-05T07:00:00.000Z","updated":"2019-11-05T07:00:00.000Z","comments":true,"path":"20191105-linux-use-xrandr/","link":"","permalink":"https://tinychen.com/20191105-linux-use-xrandr/","excerpt":"åœ¨CentOS8å’ŒUbuntu18ä¸Šä½¿ç”¨xrandrè°ƒæ•´æ˜¾ç¤ºå™¨åˆ†è¾¨ç‡å¹¶è®¾ç½®é‡å¯åä¸å¤±æ•ˆã€‚","text":"åœ¨CentOS8å’ŒUbuntu18ä¸Šä½¿ç”¨xrandrè°ƒæ•´æ˜¾ç¤ºå™¨åˆ†è¾¨ç‡å¹¶è®¾ç½®é‡å¯åä¸å¤±æ•ˆã€‚ æœ€è¿‘åœ¨ç”¨ä¸»æ¿è‡ªå¸¦çš„æ¿è½½é›†æ˜¾å¤–æ¥æ˜¾ç¤ºå™¨çš„æ—¶å€™ï¼Œæœ€å¤§åº”è¯¥æ˜¯å¯ä»¥è¾“å‡º1080Pçš„åˆ†è¾¨ç‡ï¼Œä½†æ˜¯ç”±äºå„ç§åŸå› å¥½åƒä¸èƒ½è‡ªåŠ¨è¯†åˆ«å‡ºæ¥ï¼Œåªèƒ½è‡ªå·±ä½¿ç”¨xrandræ‰‹åŠ¨æ–°å»ºåˆ†è¾¨ç‡ã€‚ åœ¨CentOS8å’ŒUbuntu18.04.3ä¸Šé¢éƒ½å®æ“è¿‡æ²¡æœ‰é—®é¢˜ï¼Œæ­¥éª¤ä¹Ÿéƒ½åŸºæœ¬ç›¸åŒï¼Œåªæœ‰æœ€åä¸€æ­¥çš„æ–‡ä»¶è·¯å¾„ä¸å¤ªä¸€æ ·ã€‚ï¼ˆä¸ªäººçŒœæµ‹CentOS7ä¸Šé¢åº”è¯¥å’ŒCentOS8é€šç”¨ï¼‰ 1ã€CentOS8æ“ä½œè®°å½•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566# ä»¥ä¸‹æ˜¯CentOS8ä¸­çš„å®é™…æ“ä½œè®°å½•# ä½¿ç”¨xrandræŸ¥çœ‹ç›®å‰æ”¯æŒçš„åˆ†è¾¨ç‡ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åªæœ‰ä¸‰ä¸ªï¼Œä¸”å’Œæ˜¾ç¤ºå™¨çš„æœ€ä½³åˆ†è¾¨ç‡éƒ½å¯¹ä¸ä¸Š[tinychen@tiny-studio ~]$ xrandrScreen 0: minimum 320 x 200, current 1024 x 768, maximum 1920 x 2048VGA-1 connected primary 1024x768+0+0 (normal left inverted right x axis y axis) 0mm x 0mm 1024x768 60.00* 800x600 60.32 56.25 640x480 59.94 # ä½¿ç”¨cvtå‘½ä»¤ç”Ÿæˆå¯¹åº”åˆ†è¾¨ç‡çš„æ•°æ®ï¼Œåé¢çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯æ¨ªå‘åˆ†è¾¨ç‡å’Œçºµå‘åˆ†è¾¨ç‡ä»¥åŠåˆ·æ–°ç‡# è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€å¸¸è§çš„1080p 60å¸§# æ³¨æ„è¿™é‡Œç”Ÿæˆçš„Modelineè¿™ä¸€è¡Œå‚æ•°æˆ‘ä»¬åé¢è¦ç”¨åˆ°ï¼Œéœ€è¦æå‰ä¿å­˜ä¸€ä¸‹[tinychen@tiny-studio ~]$ cvt 1920 1080 60# 1920x1080 59.96 Hz (CVT 2.07M9) hsync: 67.16 kHz; pclk: 173.00 MHzModeline &quot;1920x1080_60.00&quot; 173.00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync# åœ¨xrandrä¸­æ·»åŠ æ–°çš„åˆ†è¾¨ç‡é€‰é¡¹ï¼Œå‚æ•°ç›´æ¥ç…§æ¬ä¸Šé¢çš„å³å¯[tinychen@tiny-studio ~]$ xrandr --newmode &quot;1920x1080_60.00&quot; 173.00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync# å†æ¬¡æŸ¥çœ‹åˆ†è¾¨ç‡ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢åŠ çš„å·²ç»åœ¨åˆ—è¡¨ä¸­äº†# é¢å¤–éœ€è¦æ³¨æ„çš„æ˜¯ä¸‹é¢çš„VGA-1é€‰é¡¹ï¼Œåé¢è¦ç”¨åˆ°ï¼Œè¿™é‡Œæ˜¯ç”¨æ¥å®šä½æ˜¾ç¤ºå™¨çš„ï¼ˆå¦‚æœæœ‰å¤šä¸ªæ˜¾ç¤ºå™¨çš„è¯ï¼‰[tinychen@tiny-studio ~]$ xrandr Screen 0: minimum 320 x 200, current 1024 x 768, maximum 1920 x 2048VGA-1 connected primary 1024x768+0+0 (normal left inverted right x axis y axis) 0mm x 0mm 1024x768 60.00* 800x600 60.32 56.25 640x480 59.94 1920x1080_60.00 (0x3ad) 173.000MHz -HSync +VSync h: width 1920 start 2048 end 2248 total 2576 skew 0 clock 67.16KHz v: height 1080 start 1083 end 1088 total 1120 clock 59.96Hz# å°†åˆšåˆšç”Ÿæˆçš„åˆ†è¾¨ç‡é€‰é¡¹æ·»åŠ åˆ°VGA-1è¿™ä¸ªæ˜¾ç¤ºå™¨ä¸­[tinychen@tiny-studio ~]$ xrandr --addmode VGA-1 &quot;1920x1080_60.00&quot;# å†æ¬¡æŸ¥çœ‹å¯ä»¥å‘ç°å·²ç»æ˜¯æ­£å¸¸çš„äº†[tinychen@tiny-studio ~]$ xrandrScreen 0: minimum 320 x 200, current 1024 x 768, maximum 1920 x 2048VGA-1 connected primary 1024x768+0+0 (normal left inverted right x axis y axis) 0mm x 0mm 1024x768 60.00* 800x600 60.32 56.25 640x480 59.94 1920x1080_60.00 59.96 # æ‰‹åŠ¨è°ƒæ•´åˆ†è¾¨ç‡ä¸º1080Pï¼Œè¿™æ—¶å€™åº”è¯¥å°±å¯ä»¥æ„Ÿè§‰åˆ°åˆ†è¾¨ç‡çš„å˜åŒ–äº†[tinychen@tiny-studio ~]$ xrandr -s 1920x1080_60.00[tinychen@tiny-studio ~]$ # ä¸ºäº†ä¿è¯é‡å¯ååˆ†è¾¨ç‡ä¾æ—§ç”Ÿæ•ˆï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶# éœ€è¦æ³¨æ„çš„æ˜¯æ–‡ä»¶ä¸­çš„Modelineè¿™ä¸€è¡Œå°±æ˜¯å‰é¢æˆ‘ä»¬ç”Ÿæˆçš„å‚æ•°ï¼Œå¦‚æœæ²¡ä¿å­˜çš„è¯å†é‡æ–°è¾“ä¸€éå‰é¢çš„cvtå‘½ä»¤å³å¯[root@tiny-studio xorg.conf.d]# vim /etc/X11/xorg.conf.d/monitor.conf[root@tiny-studio xorg.conf.d]# cat /etc/X11/xorg.conf.d/monitor.confSection &quot;Monitor&quot;Identifier &quot;Configured Monitor&quot;Modeline &quot;1920x1080_60.00&quot; 173.00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsyncOption &quot;PreferredMode&quot; &quot;1920x1080_60.00&quot;EndSectionSection &quot;Screen&quot;Identifier &quot;Default Screen&quot;Monitor &quot;Configured Monitor&quot;Device &quot;Configured Video Device&quot;EndSectionSection &quot;Device&quot;Identifier &quot;Configured Video Device&quot;EndSection 2ã€Ubuntu18.04.3æ“ä½œè®°å½•Ubuntuä¸Šé¢æ“ä½œå’ŒCentOS8åŸºæœ¬ä¸€æ ·ï¼Œé™¤äº†æœ€åçš„é…ç½®æ–‡ä»¶ä»/etc/X11/xorg.conf.d/monitor.confå˜æˆäº†/etc/X11/xorg.conf.d/monitor.confï¼Œå…¶ä»–çš„åŸºæœ¬ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# ä»¥ä¸‹ä¸ºubuntu18.04.3ä¸Šçš„æ“ä½œè®°å½•root@Tiny-Studio:~# root@Tiny-Studio:~# xrandrScreen 0: minimum 320 x 200, current 1024 x 768, maximum 1920 x 2048VGA-1 connected primary 1024x768+0+0 (normal left inverted right x axis y axis) 0mm x 0mm 1024x768 60.00* 800x600 60.32 56.25 640x480 59.94 root@Tiny-Studio:~# cvt 1920 1080 60# 1920x1080 59.96 Hz (CVT 2.07M9) hsync: 67.16 kHz; pclk: 173.00 MHzModeline &quot;1920x1080_60.00&quot; 173.00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsyncroot@Tiny-Studio:~# xrandr --newmode &quot;1920x1080_60.00&quot; 173.00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsyncroot@Tiny-Studio:~# xrandrScreen 0: minimum 320 x 200, current 1024 x 768, maximum 1920 x 2048VGA-1 connected primary 1024x768+0+0 (normal left inverted right x axis y axis) 0mm x 0mm 1024x768 60.00* 800x600 60.32 56.25 640x480 59.94 1920x1080_60.00 (0x306) 173.000MHz -HSync +VSync h: width 1920 start 2048 end 2248 total 2576 skew 0 clock 67.16KHz v: height 1080 start 1083 end 1088 total 1120 clock 59.96Hzroot@Tiny-Studio:~# xrandr --addmode VGA-1 &quot;1920x1080_60.00&quot;root@Tiny-Studio:~# xrandrScreen 0: minimum 320 x 200, current 1024 x 768, maximum 1920 x 2048VGA-1 connected primary 1024x768+0+0 (normal left inverted right x axis y axis) 0mm x 0mm 1024x768 60.00* 800x600 60.32 56.25 640x480 59.94 1920x1080_60.00 59.96 root@Tiny-Studio:~# xrandr -s 1920x1080_60.00root@Tiny-Studio:~# vim /etc/X11/xorg.confroot@Tiny-Studio:~# cat /etc/X11/xorg.conf Section &quot;Monitor&quot;Identifier &quot;Configured Monitor&quot;Modeline &quot;1920x1080_60.00&quot; 173.00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsyncOption &quot;PreferredMode&quot; &quot;1920x1080_60.00&quot;EndSectionSection &quot;Screen&quot;Identifier &quot;Default Screen&quot;Monitor &quot;Configured Monitor&quot;Device &quot;Configured Video Device&quot;EndSectionSection &quot;Device&quot;Identifier &quot;Configured Video Device&quot;EndSectionroot@Tiny-Studio:~#","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"åœ¨CentOS8ä¸­å®‰è£…xrdpè¿œç¨‹æ¡Œé¢","slug":"20191029-centos8-install-xrdp","date":"2019-10-29T07:00:00.000Z","updated":"2019-10-29T07:00:00.000Z","comments":true,"path":"20191029-centos8-install-xrdp/","link":"","permalink":"https://tinychen.com/20191029-centos8-install-xrdp/","excerpt":"åœ¨CentOS8ä¸Šå®‰è£…xrdpå’Œvncå¹¶åœ¨windowsä¸­ä½¿ç”¨mstscè¿›è¡Œè¿œç¨‹æ§åˆ¶ã€‚","text":"åœ¨CentOS8ä¸Šå®‰è£…xrdpå’Œvncå¹¶åœ¨windowsä¸­ä½¿ç”¨mstscè¿›è¡Œè¿œç¨‹æ§åˆ¶ã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯epelæºæ¥è¿›è¡Œå®‰è£…ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¦åœ¨é˜²ç«å¢™ä¸­æ”¾è¡Œç«¯å£ï¼Œxrdpä½¿ç”¨çš„æ˜¯å’Œwindowsè‡ªå¸¦çš„mstscè¿œç¨‹ä¸€æ ·çš„é»˜è®¤3389ç«¯å£ï¼Œå¦‚æœä½¿ç”¨vncè¿›è¡Œè¿œç¨‹ï¼Œåˆ™è¿˜éœ€è¦é¢å¤–æ·»åŠ 5900åˆ°5905ç«¯å£ã€‚ 123456789101112131415# å®‰è£…epelæºå¹¶å®‰è£…xrdpå’Œvncyum install epel-release -yyum install xrdp -yyum install tigervnc-server -y# å¯åŠ¨xrdpå¹¶è®¾ç½®å¼€æœºå¯åŠ¨systemctl start xrdp.servicesystemctl enable xrdp.service# åœ¨é˜²ç«å¢™ä¸­æ”¾è¡Œvncå’Œxrdpfirewall-cmd --permanent --add-service=vnc-server firewall-cmd --permanent --add-port=3389/tcpfirewall-cmd --permanent --add-port=3389/udpfirewall-cmd --reloadfirewall-cmd --list-all ä»¥ä¸‹æ˜¯å®‰è£…å®å½•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889[root@tiny-studio ~]# yum install xrdpä¸Šæ¬¡å…ƒæ•°æ®è¿‡æœŸæ£€æŸ¥ï¼š0:00:04 å‰ï¼Œæ‰§è¡Œäº Thu 31 Oct 2019 04:15:46 AM CSTã€‚ä¾èµ–å…³ç³»è§£å†³ã€‚================================================================================================================ è½¯ä»¶åŒ… æ¶æ„ ç‰ˆæœ¬ ä»“åº“ å¤§å°================================================================================================================Installing: xrdp x86_64 1:0.9.11-5.el8 epel 441 kå®‰è£…å¼±çš„ä¾èµ–: xrdp-selinux x86_64 1:0.9.11-5.el8 epel 21 käº‹åŠ¡æ¦‚è¦================================================================================================================å®‰è£… 2 è½¯ä»¶åŒ…æ€»ä¸‹è½½ï¼š461 kå®‰è£…å¤§å°ï¼š2.2 Mç¡®å®šå—ï¼Ÿ[y/N]ï¼š yä¸‹è½½è½¯ä»¶åŒ…ï¼š(1/2): xrdp-selinux-0.9.11-5.el8.x86_64.rpm 13 kB/s | 21 kB 00:01 (2/2): xrdp-0.9.11-5.el8.x86_64.rpm 205 kB/s | 441 kB 00:02 ----------------------------------------------------------------------------------------------------------------æ€»è®¡ 62 kB/s | 461 kB 00:07 è¿è¡Œäº‹åŠ¡æ£€æŸ¥äº‹åŠ¡æ£€æŸ¥æˆåŠŸã€‚è¿è¡Œäº‹åŠ¡æµ‹è¯•äº‹åŠ¡æµ‹è¯•æˆåŠŸã€‚è¿è¡Œäº‹åŠ¡ å‡†å¤‡ä¸­ : 1/1 Installing : xrdp-selinux-1:0.9.11-5.el8.x86_64 1/2 è¿è¡Œè„šæœ¬ : xrdp-selinux-1:0.9.11-5.el8.x86_64 1/2 Installing : xrdp-1:0.9.11-5.el8.x86_64 2/2 è¿è¡Œè„šæœ¬ : xrdp-1:0.9.11-5.el8.x86_64 2/2 éªŒè¯ : xrdp-1:0.9.11-5.el8.x86_64 1/2 éªŒè¯ : xrdp-selinux-1:0.9.11-5.el8.x86_64 2/2 å·²å®‰è£…: xrdp-1:0.9.11-5.el8.x86_64 xrdp-selinux-1:0.9.11-5.el8.x86_64 å®Œæ¯•ï¼[root@tiny-studio ~]# yum install tigervnc-serverä¸Šæ¬¡å…ƒæ•°æ®è¿‡æœŸæ£€æŸ¥ï¼š0:01:41 å‰ï¼Œæ‰§è¡Œäº Thu 31 Oct 2019 04:15:46 AM CSTã€‚ä¾èµ–å…³ç³»è§£å†³ã€‚================================================================================================================ è½¯ä»¶åŒ… æ¶æ„ ç‰ˆæœ¬ ä»“åº“ å¤§å°================================================================================================================Installing: tigervnc-server x86_64 1.9.0-9.el8 AppStream 252 käº‹åŠ¡æ¦‚è¦================================================================================================================å®‰è£… 1 è½¯ä»¶åŒ…æ€»ä¸‹è½½ï¼š252 kå®‰è£…å¤§å°ï¼š688 kç¡®å®šå—ï¼Ÿ[y/N]ï¼š yä¸‹è½½è½¯ä»¶åŒ…ï¼štigervnc-server-1.9.0-9.el8.x86_64.rpm 186 kB/s | 252 kB 00:01 ----------------------------------------------------------------------------------------------------------------æ€»è®¡ 186 kB/s | 252 kB 00:01 è¿è¡Œäº‹åŠ¡æ£€æŸ¥äº‹åŠ¡æ£€æŸ¥æˆåŠŸã€‚è¿è¡Œäº‹åŠ¡æµ‹è¯•äº‹åŠ¡æµ‹è¯•æˆåŠŸã€‚è¿è¡Œäº‹åŠ¡ å‡†å¤‡ä¸­ : 1/1 Installing : tigervnc-server-1.9.0-9.el8.x86_64 1/1 è¿è¡Œè„šæœ¬ : tigervnc-server-1.9.0-9.el8.x86_64 1/1 éªŒè¯ : tigervnc-server-1.9.0-9.el8.x86_64 1/1 å·²å®‰è£…: tigervnc-server-1.9.0-9.el8.x86_64 å®Œæ¯•ï¼ 1234567891011121314151617181920212223[root@tiny-studio ~]# systemctl start xrdp.service [root@tiny-studio ~]# systemctl enable xrdp.service Created symlink /etc/systemd/system/multi-user.target.wants/xrdp.service â†’ /usr/lib/systemd/system/xrdp.service.[root@tiny-studio ~]# systemctl status xrdp.service â— xrdp.service - xrdp daemon Loaded: loaded (/usr/lib/systemd/system/xrdp.service; enabled; vendor preset: disabled) Active: active (running) since Thu 2019-10-31 04:18:31 CST; 22s ago Docs: man:xrdp(8) man:xrdp.ini(5) Main PID: 23889 (xrdp) Tasks: 1 (limit: 42597) Memory: 1016.0K CGroup: /system.slice/xrdp.service â””â”€23889 /usr/sbin/xrdp --nodaemonOct 31 04:18:31 tiny-studio systemd[1]: Started xrdp daemon.Oct 31 04:18:31 tiny-studio xrdp[23889]: (23889)(139917736187328)[INFO ] starting xrdp with pid 23889Oct 31 04:18:31 tiny-studio xrdp[23889]: (23889)(139917736187328)[INFO ] address [0.0.0.0] port [3389] mode 1Oct 31 04:18:31 tiny-studio xrdp[23889]: (23889)(139917736187328)[INFO ] listening to port 3389 on 0.0.0.0Oct 31 04:18:31 tiny-studio xrdp[23889]: (23889)(139917736187328)[INFO ] xrdp_listen_pp done 12345678910111213141516171819202122[root@tiny-studio ~]# firewall-cmd --permanent --add-service=vnc-server success[root@tiny-studio ~]# firewall-cmd --permanent --add-port=3389/tcpsuccess[root@tiny-studio ~]# firewall-cmd --permanent --add-port=3389/udpsuccess[root@tiny-studio ~]# firewall-cmd --reload success[root@tiny-studio ~]# firewall-cmd --list-allpublic (active) target: default icmp-block-inversion: no interfaces: ens82f0 sources: services: cockpit dhcpv6-client ssh vnc-server ports: 3389/tcp 3389/udp protocols: masquerade: no forward-ports: source-ports: icmp-blocks: rich rules: éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ç™»å½•ä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥ä½¿ç”¨windowsè‡ªå¸¦çš„mstscè¾“å…¥ipåœ°å€è¿›è¡Œè¿œç¨‹ï¼Œç„¶åå°±ä¼šè¿›å…¥åˆ°xrdpçš„ç•Œé¢ï¼Œæ¥ç€å†è¾“å…¥è´¦å·å¯†ç ç™»å½•ï¼Œé€€å‡ºçš„æ—¶å€™è¦å…ˆåœ¨linuxä¸­æ³¨é”€ç”¨æˆ·ï¼Œç›´æ¥é€€å‡ºçš„è¯ç”¨æˆ·è¿˜æ˜¯æ²¡æœ‰æ³¨é”€ï¼Œæ²¡æ³¨é”€çš„æ¡Œé¢ç”¨æˆ·å†ç”¨åˆ«çš„ç”µè„‘æ˜¯ä¸èƒ½ç™»å½•çš„ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"}]},{"title":"åœ¨CentOS8ä¸­å®‰è£…VLCæ’­æ”¾å™¨","slug":"20191028-centos8-install-vlc","date":"2019-10-28T07:00:00.000Z","updated":"2019-10-28T07:00:00.000Z","comments":true,"path":"20191028-centos8-install-vlc/","link":"","permalink":"https://tinychen.com/20191028-centos8-install-vlc/","excerpt":"åœ¨CentOS8ä¸Šä½¿ç”¨epelæºå’Œrpmfusionæºå®‰è£…VLCæ’­æ”¾å™¨ã€‚","text":"åœ¨CentOS8ä¸Šä½¿ç”¨epelæºå’Œrpmfusionæºå®‰è£…VLCæ’­æ”¾å™¨ã€‚ æˆ‘ä»¬æŸ¥çœ‹å®˜ç½‘å¯ä»¥çœ‹åˆ°å¯¹åº”çš„å®‰è£…é¡µé¢å·²ç»æœ‰æ¯”è¾ƒè¯¦ç»†çš„å®‰è£…æŒ‡å¯¼è¯´æ˜äº†ã€‚ RHEL/CentOS 8Use RPM Fusion for EL8. Available for x86_64, aarch64 and ppc64leThis repository uses EPEL The vlc-3.0x branch will be provided for EL8Install rpmfusion-free-release-8.noarch.rpm for EL8. 123456$&gt; su -#&gt; yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm#&gt; yum install https://download1.rpmfusion.org/free/el/rpmfusion-free-release-8.noarch.rpm#&gt; yum install vlc#&gt; yum install vlc-core (for minimal headless/server install)#&gt; yum install python-vlc (optionals) å¤§è‡´çš„å®‰è£…æ­¥éª¤å’Œä¸Šé¢ç±»ä¼¼ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼€å§‹å¯¼å…¥çš„epelæºå’Œrpmfusionæºä½¿ç”¨é»˜è®¤æºå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œéœ€è¦æ›¿æ¢ä¸ºå›½å†…é•œåƒæºçš„åŒå­¦å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®‰è£…vlcçš„æ—¶å€™ï¼Œvlc-coreä¼šä½œä¸ºä¾èµ–åŒæ—¶è¢«å®‰è£…ï¼ŒåŒæ—¶ï¼Œpython-vlcè¿™ä¸ªåº“éœ€è¦ä½¿ç”¨pip3æ¥è¿›è¡Œå®‰è£…ã€‚æ‰€ä»¥æ•´ç†ä¹‹åçš„å®‰è£…æ­¥éª¤å˜æˆäº†ä¸‹é¢è¿™æ ·ã€‚ 12345678910# aå®‰è£…epelåº“yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm# å®‰è£…rpmfusionåº“yum install https://download1.rpmfusion.org/free/el/rpmfusion-free-release-8.noarch.rpm# å®‰è£…vlcyum install vlc vlc-core# å®‰è£…python3ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨pip3yum install python3# ä½¿ç”¨pip3å®‰è£…python-vlcpip3 install python-vlc 1sudo pip3 install packagename ä»£è¡¨è¿›è¡Œå…¨å±€å®‰è£…ï¼Œå®‰è£…åå…¨å±€å¯ç”¨ã€‚å¦‚æœæ˜¯ä¿¡ä»»çš„å®‰è£…åŒ…å¯ç”¨ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚ 1pip3 install --user packagename ä»£è¡¨ä»…è¯¥ç”¨æˆ·çš„å®‰è£…ï¼Œå®‰è£…åä»…è¯¥ç”¨æˆ·å¯ç”¨ã€‚å¤„äºå®‰å…¨è€ƒè™‘ï¼Œå°½é‡ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚ ä»¥ä¸‹ä¸ºå®‰è£…å®å½•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œlinuxç‰ˆæœ¬çš„vlcå¥½åƒå¯¹4K HDRè§†é¢‘çš„æ”¯æŒä¸å¤ªå¥½ï¼Œç”»é¢ä¼šæœ‰æ³›ç™½çš„æƒ…å†µï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°è®¾ç½®é‡Œé¢çš„ç›¸å…³é€‰é¡¹ï¼Œä½¿ç”¨smplayer+mpvplayerå°±å¯ä»¥æ­£å¸¸æ’­æ”¾ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333[root@tiny-studio tinychen]# yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpmLast metadata expiration check: 0:49:35 ago on Fri 01 Nov 2019 10:00:32 PM CST.epel-release-latest-8.noarch.rpm 6.7 kB/s | 21 kB 00:03 Package epel-release-8-7.el8.noarch is already installed.Dependencies resolved.Nothing to do.Complete![root@tiny-studio tinychen]# yum install https://download1.rpmfusion.org/free/el/rpmfusion-free-release-8.noarch.rpmLast metadata expiration check: 0:49:57 ago on Fri 01 Nov 2019 10:00:32 PM CST.rpmfusion-free-release-8.noarch.rpm 3.4 kB/s | 11 kB 00:03 Dependencies resolved.==================================================================================================== Package Arch Version Repository Size====================================================================================================Installing: rpmfusion-free-release noarch 8-0.1 @commandline 11 kTransaction Summary====================================================================================================Install 1 PackageTotal size: 11 kInstalled size: 3.7 kIs this ok [y/N]: yDownloading Packages:Running transaction checkTransaction check succeeded.Running transaction testTransaction test succeeded.Running transaction Preparing : 1/1 Installing : rpmfusion-free-release-8-0.1.noarch 1/1 Verifying : rpmfusion-free-release-8-0.1.noarch 1/1 Installed: rpmfusion-free-release-8-0.1.noarch Complete![root@tiny-studio tinychen]# yum install vlcRPM Fusion for EL 8 - Free - Updates 14 kB/s | 151 kB 00:11 Dependencies resolved.==================================================================================================== Package Arch Version Repository Size====================================================================================================Installing: vlc x86_64 1:3.0.9-22.el8 rpmfusion-free-updates 1.9 MInstalling dependencies: fftw-libs-double x86_64 3.3.5-11.el8 AppStream 992 k freeglut x86_64 3.0.0-8.el8 AppStream 191 k libdc1394 x86_64 2.2.2-10.el8 AppStream 126 k libmad x86_64 0.15.1b-24.el8 AppStream 83 k libva x86_64 2.1.0-1.el8 AppStream 92 k libvdpau x86_64 1.1.1-7.el8 AppStream 40 k ocl-icd x86_64 2.2.12-1.el8 AppStream 51 k protobuf-lite x86_64 3.5.0-7.el8 AppStream 150 k qt5-qtsvg x86_64 5.11.1-2.el8 AppStream 182 k qt5-qtx11extras x86_64 5.11.1-2.el8 AppStream 34 k libusb x86_64 1:0.1.5-12.el8 BaseOS 42 k aalib-libs x86_64 1.4.0-0.37.rc5.el8 epel 72 k fluidsynth-libs x86_64 1.1.11-6.el8 epel 214 k game-music-emu x86_64 0.6.2-3.el8 epel 155 k jack-audio-connection-kit x86_64 1.9.12-8.el8 epel 519 k libaom x86_64 1.0.0-8.20190810git9666276.el8 epel 1.6 M libass x86_64 0.14.0-4.el8 epel 110 k libcaca x86_64 0.99-0.43.beta19.el8 epel 227 k libcddb x86_64 1.3.2-30.el8 epel 79 k libchromaprint x86_64 1.4.2-6.el8 epel 54 k libdav1d x86_64 0.5.0-1.el8 epel 344 k libdvbpsi x86_64 1.3.3-1.el8 epel 105 k libebml x86_64 1.3.7-2.el8 epel 87 k libkate x86_64 0.4.1-18.el8 epel 59 k libmatroska x86_64 1.5.0-1.el8 epel 170 k libmfx x86_64 1.25-4.el8 epel 36 k libmicrodns x86_64 0.0.10-4.el8 epel 29 k libmodplug x86_64 1:0.8.9.0-9.el8 epel 171 k libtiger x86_64 0.3.4-18.el8 epel 43 k libupnp x86_64 1.8.4-3.el8 epel 115 k libvmaf x86_64 1.3.15-1.el8 epel 347 k lirc-libs x86_64 0.10.0-19.el8 epel 139 k pugixml x86_64 1.9-1.el8 epel 97 k schroedinger x86_64 1.0.11-21.el8 epel 321 k soxr x86_64 0.1.3-4.el8 epel 97 k vid.stab x86_64 1.1.0-12.20190213gitaeabc8d.el8 epel 47 k zvbi x86_64 0.2.35-9.el8 epel 424 k faad2-libs x86_64 1:2.8.8-6.el8 rpmfusion-free-updates 177 k ffmpeg-libs x86_64 4.2.1-3.el8 rpmfusion-free-updates 7.2 M libdca x86_64 0.0.6-4.el8 rpmfusion-free-updates 113 k libmpeg2 x86_64 0.5.1-17.el8 rpmfusion-free-updates 76 k live555 x86_64 2019.06.28-1.el8 rpmfusion-free-updates 404 k opencore-amr x86_64 0.1.5-7.el8 rpmfusion-free-updates 180 k vlc-core x86_64 1:3.0.9-22.el8 rpmfusion-free-updates 10 M vo-amrwbenc x86_64 0.1.3-8.el8 rpmfusion-free-updates 77 k x264-libs x86_64 0.157-12.20190717git34c06d1.el8 rpmfusion-free-updates 651 k x265-libs x86_64 3.1.2-1.el8 rpmfusion-free-updates 1.9 M xvidcore x86_64 1.3.5-5.el8 rpmfusion-free-updates 268 kTransaction Summary====================================================================================================Install 49 PackagesTotal download size: 31 MInstalled size: 121 MIs this ok [y/N]: yDownloading Packages:(1/49): libdc1394-2.2.2-10.el8.x86_64.rpm 86 kB/s | 126 kB 00:01 (2/49): libmad-0.15.1b-24.el8.x86_64.rpm 401 kB/s | 83 kB 00:00 (3/49): freeglut-3.0.0-8.el8.x86_64.rpm 96 kB/s | 191 kB 00:01 (4/49): libva-2.1.0-1.el8.x86_64.rpm 212 kB/s | 92 kB 00:00 (5/49): libvdpau-1.1.1-7.el8.x86_64.rpm 83 kB/s | 40 kB 00:00 (6/49): protobuf-lite-3.5.0-7.el8.x86_64.rpm 235 kB/s | 150 kB 00:00 (7/49): fftw-libs-double-3.3.5-11.el8.x86_64.rpm 303 kB/s | 992 kB 00:03 (8/49): qt5-qtx11extras-5.11.1-2.el8.x86_64.rpm 177 kB/s | 34 kB 00:00 (9/49): ocl-icd-2.2.12-1.el8.x86_64.rpm 35 kB/s | 51 kB 00:01 (10/49): qt5-qtsvg-5.11.1-2.el8.x86_64.rpm 351 kB/s | 182 kB 00:00 (11/49): aalib-libs-1.4.0-0.37.rc5.el8.x86_64.rpm 130 kB/s | 72 kB 00:00 (12/49): fluidsynth-libs-1.1.11-6.el8.x86_64.rpm 256 kB/s | 214 kB 00:00 (13/49): game-music-emu-0.6.2-3.el8.x86_64.rpm 259 kB/s | 155 kB 00:00 (14/49): jack-audio-connection-kit-1.9.12-8.el8.x86_64.rpm 308 kB/s | 519 kB 00:01 (15/49): libusb-0.1.5-12.el8.x86_64.rpm 16 kB/s | 42 kB 00:02 (16/49): libass-0.14.0-4.el8.x86_64.rpm 113 kB/s | 110 kB 00:00 (17/49): libaom-1.0.0-8.20190810git9666276.el8.x86_64.rpm 451 kB/s | 1.6 MB 00:03 (18/49): libcddb-1.3.2-30.el8.x86_64.rpm 56 kB/s | 79 kB 00:01 (19/49): libchromaprint-1.4.2-6.el8.x86_64.rpm 202 kB/s | 54 kB 00:00 (20/49): libdav1d-0.5.0-1.el8.x86_64.rpm 574 kB/s | 344 kB 00:00 (21/49): libdvbpsi-1.3.3-1.el8.x86_64.rpm 150 kB/s | 105 kB 00:00 (22/49): libebml-1.3.7-2.el8.x86_64.rpm 225 kB/s | 87 kB 00:00 (23/49): libcaca-0.99-0.43.beta19.el8.x86_64.rpm 66 kB/s | 227 kB 00:03 (24/49): libkate-0.4.1-18.el8.x86_64.rpm 182 kB/s | 59 kB 00:00 (25/49): libmatroska-1.5.0-1.el8.x86_64.rpm 454 kB/s | 170 kB 00:00 (26/49): libmfx-1.25-4.el8.x86_64.rpm 106 kB/s | 36 kB 00:00 (27/49): libmicrodns-0.0.10-4.el8.x86_64.rpm 76 kB/s | 29 kB 00:00 (28/49): libmodplug-0.8.9.0-9.el8.x86_64.rpm 507 kB/s | 171 kB 00:00 (29/49): libtiger-0.3.4-18.el8.x86_64.rpm 116 kB/s | 43 kB 00:00 (30/49): libupnp-1.8.4-3.el8.x86_64.rpm 234 kB/s | 115 kB 00:00 (31/49): libvmaf-1.3.15-1.el8.x86_64.rpm 420 kB/s | 347 kB 00:00 (32/49): lirc-libs-0.10.0-19.el8.x86_64.rpm 136 kB/s | 139 kB 00:01 (33/49): pugixml-1.9-1.el8.x86_64.rpm 102 kB/s | 97 kB 00:00 (34/49): schroedinger-1.0.11-21.el8.x86_64.rpm 366 kB/s | 321 kB 00:00 (35/49): soxr-0.1.3-4.el8.x86_64.rpm 134 kB/s | 97 kB 00:00 (36/49): vid.stab-1.1.0-12.20190213gitaeabc8d.el8.x86_64.rpm 76 kB/s | 47 kB 00:00 (37/49): zvbi-0.2.35-9.el8.x86_64.rpm 530 kB/s | 424 kB 00:00 (38/49): libdca-0.0.6-4.el8.x86_64.rpm 66 kB/s | 113 kB 00:01 (39/49): libmpeg2-0.5.1-17.el8.x86_64.rpm 177 kB/s | 76 kB 00:00 (40/49): live555-2019.06.28-1.el8.x86_64.rpm 330 kB/s | 404 kB 00:01 (41/49): faad2-libs-2.8.8-6.el8.x86_64.rpm 39 kB/s | 177 kB 00:04 (42/49): opencore-amr-0.1.5-7.el8.x86_64.rpm 213 kB/s | 180 kB 00:00 (43/49): ffmpeg-libs-4.2.1-3.el8.x86_64.rpm 329 kB/s | 7.2 MB 00:22 (44/49): vlc-3.0.9-22.el8.x86_64.rpm 86 kB/s | 1.9 MB 00:22 (45/49): vo-amrwbenc-0.1.3-8.el8.x86_64.rpm 15 kB/s | 77 kB 00:05 (46/49): x264-libs-0.157-12.20190717git34c06d1.el8.x86_64.rpm 296 kB/s | 651 kB 00:02 (47/49): xvidcore-1.3.5-5.el8.x86_64.rpm 29 kB/s | 268 kB 00:09 (48/49): x265-libs-3.1.2-1.el8.x86_64.rpm 167 kB/s | 1.9 MB 00:11 (49/49): vlc-core-3.0.9-22.el8.x86_64.rpm 293 kB/s | 10 MB 00:35 ---------------------------------------------------------------------------------------------------------------Total 533 kB/s | 31 MB 00:58 warning: /var/cache/dnf/rpmfusion-free-updates-4f04908c20c55925/packages/faad2-libs-2.8.8-6.el8.x86_64.rpm: Header V3 RSA/SHA1 Signature, key ID 158b3811: NOKEYRPM Fusion for EL 8 - Free - Updates 1.6 MB/s | 1.7 kB 00:00 Importing GPG key 0x158B3811: Userid : &quot;RPM Fusion free repository for EL (8) &lt;rpmfusion-buildsys@lists.rpmfusion.org&gt;&quot; Fingerprint: 8379 35CD 19E1 23AA 7F8A 8E69 979F 0C69 158B 3811 From : /etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-free-el-8Is this ok [y/N]: yKey imported successfullyRunning transaction checkTransaction check succeeded.Running transaction testTransaction test succeeded.Running transaction Preparing : 1/1 Installing : libva-2.1.0-1.el8.x86_64 1/49 Installing : libmfx-1.25-4.el8.x86_64 2/49 Installing : x265-libs-3.1.2-1.el8.x86_64 3/49 Installing : zvbi-0.2.35-9.el8.x86_64 4/49 Running scriptlet: zvbi-0.2.35-9.el8.x86_64 4/49 Installing : soxr-0.1.3-4.el8.x86_64 5/49 Installing : libkate-0.4.1-18.el8.x86_64 6/49 Installing : libebml-1.3.7-2.el8.x86_64 7/49 Installing : libdav1d-0.5.0-1.el8.x86_64 8/49 Installing : libass-0.14.0-4.el8.x86_64 9/49 Installing : libaom-1.0.0-8.20190810git9666276.el8.x86_64 10/49 Running scriptlet: jack-audio-connection-kit-1.9.12-8.el8.x86_64 11/49 Installing : jack-audio-connection-kit-1.9.12-8.el8.x86_64 11/49 Installing : ocl-icd-2.2.12-1.el8.x86_64 12/49 Running scriptlet: ocl-icd-2.2.12-1.el8.x86_64 12/49 Installing : x264-libs-0.157-12.20190717git34c06d1.el8.x86_64 13/49 Running scriptlet: x264-libs-0.157-12.20190717git34c06d1.el8.x86_64 13/49 Installing : fluidsynth-libs-1.1.11-6.el8.x86_64 14/49 Installing : libmatroska-1.5.0-1.el8.x86_64 15/49 Installing : libtiger-0.3.4-18.el8.x86_64 16/49 Installing : xvidcore-1.3.5-5.el8.x86_64 17/49 Installing : vo-amrwbenc-0.1.3-8.el8.x86_64 18/49 Installing : opencore-amr-0.1.5-7.el8.x86_64 19/49 Installing : live555-2019.06.28-1.el8.x86_64 20/49 Installing : libmpeg2-0.5.1-17.el8.x86_64 21/49 Installing : libdca-0.0.6-4.el8.x86_64 22/49 Installing : faad2-libs-1:2.8.8-6.el8.x86_64 23/49 Installing : vid.stab-1.1.0-12.20190213gitaeabc8d.el8.x86_64 24/49 Installing : schroedinger-1.0.11-21.el8.x86_64 25/49 Installing : pugixml-1.9-1.el8.x86_64 26/49 Running scriptlet: pugixml-1.9-1.el8.x86_64 26/49 Installing : libvmaf-1.3.15-1.el8.x86_64 27/49 Installing : libupnp-1.8.4-3.el8.x86_64 28/49 Installing : libmodplug-1:0.8.9.0-9.el8.x86_64 29/49 Installing : libmicrodns-0.0.10-4.el8.x86_64 30/49 Installing : libdvbpsi-1.3.3-1.el8.x86_64 31/49 Installing : libcddb-1.3.2-30.el8.x86_64 32/49 Installing : game-music-emu-0.6.2-3.el8.x86_64 33/49 Installing : aalib-libs-1.4.0-0.37.rc5.el8.x86_64 34/49 Installing : libusb-1:0.1.5-12.el8.x86_64 35/49 Installing : lirc-libs-0.10.0-19.el8.x86_64 36/49 Installing : qt5-qtx11extras-5.11.1-2.el8.x86_64 37/49 Installing : qt5-qtsvg-5.11.1-2.el8.x86_64 38/49 Installing : protobuf-lite-3.5.0-7.el8.x86_64 39/49 Installing : libvdpau-1.1.1-7.el8.x86_64 40/49 Running scriptlet: libvdpau-1.1.1-7.el8.x86_64 40/49 Installing : ffmpeg-libs-4.2.1-3.el8.x86_64 41/49 Installing : libmad-0.15.1b-24.el8.x86_64 42/49 Running scriptlet: libmad-0.15.1b-24.el8.x86_64 42/49 Installing : libdc1394-2.2.2-10.el8.x86_64 43/49 Running scriptlet: libdc1394-2.2.2-10.el8.x86_64 43/49 Installing : freeglut-3.0.0-8.el8.x86_64 44/49 Running scriptlet: freeglut-3.0.0-8.el8.x86_64 44/49 Installing : libcaca-0.99-0.43.beta19.el8.x86_64 45/49 Installing : fftw-libs-double-3.3.5-11.el8.x86_64 46/49 Installing : libchromaprint-1.4.2-6.el8.x86_64 47/49 Installing : vlc-core-1:3.0.9-22.el8.x86_64 48/49 Installing : vlc-1:3.0.9-22.el8.x86_64 49/49 Running scriptlet: vlc-1:3.0.9-22.el8.x86_64 49/49 Running scriptlet: vlc-core-1:3.0.9-22.el8.x86_64 49/49 Running scriptlet: vlc-1:3.0.9-22.el8.x86_64 49/49 Verifying : fftw-libs-double-3.3.5-11.el8.x86_64 1/49 Verifying : freeglut-3.0.0-8.el8.x86_64 2/49 Verifying : libdc1394-2.2.2-10.el8.x86_64 3/49 Verifying : libmad-0.15.1b-24.el8.x86_64 4/49 Verifying : libva-2.1.0-1.el8.x86_64 5/49 Verifying : libvdpau-1.1.1-7.el8.x86_64 6/49 Verifying : ocl-icd-2.2.12-1.el8.x86_64 7/49 Verifying : protobuf-lite-3.5.0-7.el8.x86_64 8/49 Verifying : qt5-qtsvg-5.11.1-2.el8.x86_64 9/49 Verifying : qt5-qtx11extras-5.11.1-2.el8.x86_64 10/49 Verifying : libusb-1:0.1.5-12.el8.x86_64 11/49 Verifying : aalib-libs-1.4.0-0.37.rc5.el8.x86_64 12/49 Verifying : fluidsynth-libs-1.1.11-6.el8.x86_64 13/49 Verifying : game-music-emu-0.6.2-3.el8.x86_64 14/49 Verifying : jack-audio-connection-kit-1.9.12-8.el8.x86_64 15/49 Verifying : libaom-1.0.0-8.20190810git9666276.el8.x86_64 16/49 Verifying : libass-0.14.0-4.el8.x86_64 17/49 Verifying : libcaca-0.99-0.43.beta19.el8.x86_64 18/49 Verifying : libcddb-1.3.2-30.el8.x86_64 19/49 Verifying : libchromaprint-1.4.2-6.el8.x86_64 20/49 Verifying : libdav1d-0.5.0-1.el8.x86_64 21/49 Verifying : libdvbpsi-1.3.3-1.el8.x86_64 22/49 Verifying : libebml-1.3.7-2.el8.x86_64 23/49 Verifying : libkate-0.4.1-18.el8.x86_64 24/49 Verifying : libmatroska-1.5.0-1.el8.x86_64 25/49 Verifying : libmfx-1.25-4.el8.x86_64 26/49 Verifying : libmicrodns-0.0.10-4.el8.x86_64 27/49 Verifying : libmodplug-1:0.8.9.0-9.el8.x86_64 28/49 Verifying : libtiger-0.3.4-18.el8.x86_64 29/49 Verifying : libupnp-1.8.4-3.el8.x86_64 30/49 Verifying : libvmaf-1.3.15-1.el8.x86_64 31/49 Verifying : lirc-libs-0.10.0-19.el8.x86_64 32/49 Verifying : pugixml-1.9-1.el8.x86_64 33/49 Verifying : schroedinger-1.0.11-21.el8.x86_64 34/49 Verifying : soxr-0.1.3-4.el8.x86_64 35/49 Verifying : vid.stab-1.1.0-12.20190213gitaeabc8d.el8.x86_64 36/49 Verifying : zvbi-0.2.35-9.el8.x86_64 37/49 Verifying : faad2-libs-1:2.8.8-6.el8.x86_64 38/49 Verifying : ffmpeg-libs-4.2.1-3.el8.x86_64 39/49 Verifying : libdca-0.0.6-4.el8.x86_64 40/49 Verifying : libmpeg2-0.5.1-17.el8.x86_64 41/49 Verifying : live555-2019.06.28-1.el8.x86_64 42/49 Verifying : opencore-amr-0.1.5-7.el8.x86_64 43/49 Verifying : vlc-1:3.0.9-22.el8.x86_64 44/49 Verifying : vlc-core-1:3.0.9-22.el8.x86_64 45/49 Verifying : vo-amrwbenc-0.1.3-8.el8.x86_64 46/49 Verifying : x264-libs-0.157-12.20190717git34c06d1.el8.x86_64 47/49 Verifying : x265-libs-3.1.2-1.el8.x86_64 48/49 Verifying : xvidcore-1.3.5-5.el8.x86_64 49/49 Installed: vlc-1:3.0.9-22.el8.x86_64 fftw-libs-double-3.3.5-11.el8.x86_64 freeglut-3.0.0-8.el8.x86_64 libdc1394-2.2.2-10.el8.x86_64 libmad-0.15.1b-24.el8.x86_64 libva-2.1.0-1.el8.x86_64 libvdpau-1.1.1-7.el8.x86_64 ocl-icd-2.2.12-1.el8.x86_64 protobuf-lite-3.5.0-7.el8.x86_64 qt5-qtsvg-5.11.1-2.el8.x86_64 qt5-qtx11extras-5.11.1-2.el8.x86_64 libusb-1:0.1.5-12.el8.x86_64 aalib-libs-1.4.0-0.37.rc5.el8.x86_64 fluidsynth-libs-1.1.11-6.el8.x86_64 game-music-emu-0.6.2-3.el8.x86_64 jack-audio-connection-kit-1.9.12-8.el8.x86_64 libaom-1.0.0-8.20190810git9666276.el8.x86_64 libass-0.14.0-4.el8.x86_64 libcaca-0.99-0.43.beta19.el8.x86_64 libcddb-1.3.2-30.el8.x86_64 libchromaprint-1.4.2-6.el8.x86_64 libdav1d-0.5.0-1.el8.x86_64 libdvbpsi-1.3.3-1.el8.x86_64 libebml-1.3.7-2.el8.x86_64 libkate-0.4.1-18.el8.x86_64 libmatroska-1.5.0-1.el8.x86_64 libmfx-1.25-4.el8.x86_64 libmicrodns-0.0.10-4.el8.x86_64 libmodplug-1:0.8.9.0-9.el8.x86_64 libtiger-0.3.4-18.el8.x86_64 libupnp-1.8.4-3.el8.x86_64 libvmaf-1.3.15-1.el8.x86_64 lirc-libs-0.10.0-19.el8.x86_64 pugixml-1.9-1.el8.x86_64 schroedinger-1.0.11-21.el8.x86_64 soxr-0.1.3-4.el8.x86_64 vid.stab-1.1.0-12.20190213gitaeabc8d.el8.x86_64 zvbi-0.2.35-9.el8.x86_64 faad2-libs-1:2.8.8-6.el8.x86_64 ffmpeg-libs-4.2.1-3.el8.x86_64 libdca-0.0.6-4.el8.x86_64 libmpeg2-0.5.1-17.el8.x86_64 live555-2019.06.28-1.el8.x86_64 opencore-amr-0.1.5-7.el8.x86_64 vlc-core-1:3.0.9-22.el8.x86_64 vo-amrwbenc-0.1.3-8.el8.x86_64 x264-libs-0.157-12.20190717git34c06d1.el8.x86_64 x265-libs-3.1.2-1.el8.x86_64 xvidcore-1.3.5-5.el8.x86_64 Complete![root@tiny-studio tinychen]# yum install vlc-coreLast metadata expiration check: 0:01:24 ago on Fri 01 Nov 2019 10:50:54 PM CST.Package vlc-core-1:3.0.9-22.el8.x86_64 is already installed.Dependencies resolved.Nothing to do.Complete![root@tiny-studio ~]# pip3 install python-vlcWARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.Collecting python-vlc Downloading https://files.pythonhosted.org/packages/23/12/fd44ed5d105891a061b1aad7d554905e4586a3b43766250616a565d8c5c9/python_vlc-3.0.7110-py3-none-any.whl (80kB) 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 81kB 9.8kB/s Installing collected packages: python-vlcSuccessfully installed python-vlc-3.0.7110","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"å¸¸ç”¨ç½‘ç»œæœåŠ¡åŠé»˜è®¤ç«¯å£","slug":"20191027-common-server-port","date":"2019-10-27T07:00:00.000Z","updated":"2019-10-27T07:00:00.000Z","comments":true,"path":"20191027-common-server-port/","link":"","permalink":"https://tinychen.com/20191027-common-server-port/","excerpt":"Windowsä¸­å¸¸ç”¨çš„ä¸€äº›æœåŠ¡å’Œé»˜è®¤çš„ç«¯å£ã€‚","text":"Windowsä¸­å¸¸ç”¨çš„ä¸€äº›æœåŠ¡å’Œé»˜è®¤çš„ç«¯å£ã€‚ åœ¨windowsç³»ç»Ÿä¸­çš„è¿™ä¸ªç›®å½•ä¸‹C:\\Windows\\System32\\drivers\\etc\\servicesæœ‰å®Œæ•´çš„æ–‡ä»¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278echo 7/tcpecho 7/udpdiscard 9/tcp sink nulldiscard 9/udp sink nullsystat 11/tcp users #Active userssystat 11/udp users #Active usersdaytime 13/tcpdaytime 13/udpqotd 17/tcp quote #Quote of the dayqotd 17/udp quote #Quote of the daychargen 19/tcp ttytst source #Character generatorchargen 19/udp ttytst source #Character generatorftp-data 20/tcp #FTP, dataftp 21/tcp #FTP. controlssh 22/tcp #SSH Remote Login Protocoltelnet 23/tcpsmtp 25/tcp mail #Simple Mail Transfer Protocoltime 37/tcp timservertime 37/udp timserverrlp 39/udp resource #Resource Location Protocolnameserver 42/tcp name #Host Name Servernameserver 42/udp name #Host Name Servernicname 43/tcp whoisdomain 53/tcp #Domain Name Serverdomain 53/udp #Domain Name Serverbootps 67/udp dhcps #Bootstrap Protocol Serverbootpc 68/udp dhcpc #Bootstrap Protocol Clienttftp 69/udp #Trivial File Transfergopher 70/tcpfinger 79/tcphttp 80/tcp www www-http #World Wide Webhosts2-ns 81/tcp #HOSTS2 Name Serverhosts2-ns 81/udp #HOSTS2 Name Serverkerberos 88/tcp krb5 kerberos-sec #Kerberoskerberos 88/udp krb5 kerberos-sec #Kerberoshostname 101/tcp hostnames #NIC Host Name Serveriso-tsap 102/tcp #ISO-TSAP Class 0rtelnet 107/tcp #Remote Telnet Servicepop2 109/tcp postoffice #Post Office Protocol - Version 2pop3 110/tcp #Post Office Protocol - Version 3sunrpc 111/tcp rpcbind portmap #SUN Remote Procedure Callsunrpc 111/udp rpcbind portmap #SUN Remote Procedure Callauth 113/tcp ident tap #Identification Protocoluucp-path 117/tcpsqlserv 118/tcp #SQL Servicesnntp 119/tcp usenet #Network News Transfer Protocolntp 123/udp #Network Time Protocolepmap 135/tcp loc-srv #DCE endpoint resolutionepmap 135/udp loc-srv #DCE endpoint resolutionnetbios-ns 137/tcp nbname #NETBIOS Name Servicenetbios-ns 137/udp nbname #NETBIOS Name Servicenetbios-dgm 138/udp nbdatagram #NETBIOS Datagram Servicenetbios-ssn 139/tcp nbsession #NETBIOS Session Serviceimap 143/tcp imap4 #Internet Message Access Protocolsql-net 150/tcpsqlsrv 156/tcppcmail-srv 158/tcp #PCMail Serversnmp 161/udp #SNMPsnmptrap 162/udp snmp-trap #SNMP trapprint-srv 170/tcp #Network PostScriptbgp 179/tcp #Border Gateway Protocolirc 194/tcp #Internet Relay Chat Protocol ipx 213/udp #IPX over IPrtsps 322/tcprtsps 322/udpmftp 349/tcpmftp 349/udpldap 389/tcp #Lightweight Directory Access Protocolhttps 443/tcp MCom #HTTP over TLS/SSLhttps 443/udp MCom #HTTP over TLS/SSLmicrosoft-ds 445/tcpmicrosoft-ds 445/udpkpasswd 464/tcp # Kerberos (v5)kpasswd 464/udp # Kerberos (v5)isakmp 500/udp ike #Internet Key Exchangecrs 507/tcp #Content Replication Systemcrs 507/udp #Content Replication Systemexec 512/tcp #Remote Process Executionbiff 512/udp comsatlogin 513/tcp #Remote Loginwho 513/udp whodcmd 514/tcp shellsyslog 514/udpprinter 515/tcp spoolertalk 517/udpntalk 518/udpefs 520/tcp #Extended File Name Serverrouter 520/udp route routedulp 522/tcp ulp 522/udp timed 525/udp timeservertempo 526/tcp newdateirc-serv 529/tcpirc-serv 529/udpcourier 530/tcp rpcconference 531/tcp chatnetnews 532/tcp readnewsnetwall 533/udp #For emergency broadcastsuucp 540/tcp uucpdklogin 543/tcp #Kerberos loginkshell 544/tcp krcmd #Kerberos remote shelldhcpv6-client 546/tcp #DHCPv6 Clientdhcpv6-client 546/udp #DHCPv6 Clientdhcpv6-server 547/tcp #DHCPv6 Serverdhcpv6-server 547/udp #DHCPv6 Serverafpovertcp 548/tcp #AFP over TCPafpovertcp 548/udp #AFP over TCPnew-rwho 550/udp new-whortsp 554/tcp #Real Time Stream Control Protocolrtsp 554/udp #Real Time Stream Control Protocolremotefs 556/tcp rfs rfs_serverrmonitor 560/udp rmonitordmonitor 561/udpnntps 563/tcp snntp #NNTP over TLS/SSLnntps 563/udp snntp #NNTP over TLS/SSLwhoami 565/tcpwhoami 565/udpms-shuttle 568/tcp #Microsoft shuttlems-shuttle 568/udp #Microsoft shuttlems-rome 569/tcp #Microsoft romems-rome 569/udp #Microsoft romehttp-rpc-epmap 593/tcp #HTTP RPC Ep Maphttp-rpc-epmap 593/udp #HTTP RPC Ep Maphmmp-ind 612/tcp #HMMP Indicationhmmp-ind 612/udp #HMMP Indicationhmmp-op 613/tcp #HMMP Operationhmmp-op 613/udp #HMMP Operationldaps 636/tcp sldap #LDAP over TLS/SSLdoom 666/tcp #Doom Id Softwaredoom 666/udp #Doom Id Softwaremsexch-routing 691/tcp #MS Exchange Routingmsexch-routing 691/udp #MS Exchange Routingkerberos-adm 749/tcp #Kerberos administrationkerberos-adm 749/udp #Kerberos administrationkerberos-iv 750/udp #Kerberos version IVmdbs_daemon 800/tcpmdbs_daemon 800/udpftps-data 989/tcp #FTP data, over TLS/SSLftps 990/tcp #FTP control, over TLS/SSLtelnets 992/tcp #Telnet protocol over TLS/SSLimaps 993/tcp #IMAP4 protocol over TLS/SSLircs 994/tcp #IRC protocol over TLS/SSLpop3s 995/tcp spop3 #pop3 protocol over TLS/SSL (was spop3)pop3s 995/udp spop3 #pop3 protocol over TLS/SSL (was spop3)kpop 1109/tcp #Kerberos POPnfsd-status 1110/tcp #Cluster status infonfsd-keepalive 1110/udp #Client status infonfa 1155/tcp #Network File Accessnfa 1155/udp #Network File Accessactivesync 1034/tcp #ActiveSync Notificationsphone 1167/udp #Conference callingopsmgr 1270/tcp #Microsoft Operations Manageropsmgr 1270/udp #Microsoft Operations Managerms-sql-s 1433/tcp #Microsoft-SQL-Server ms-sql-s 1433/udp #Microsoft-SQL-Server ms-sql-m 1434/tcp #Microsoft-SQL-Monitorms-sql-m 1434/udp #Microsoft-SQL-Monitor ms-sna-server 1477/tcpms-sna-server 1477/udpms-sna-base 1478/tcpms-sna-base 1478/udpwins 1512/tcp #Microsoft Windows Internet Name Servicewins 1512/udp #Microsoft Windows Internet Name Serviceingreslock 1524/tcp ingresstt 1607/tcpstt 1607/udpl2tp 1701/udp #Layer Two Tunneling Protocolpptconference 1711/tcppptconference 1711/udppptp 1723/tcp #Point-to-point tunnelling protocolmsiccp 1731/tcpmsiccp 1731/udpremote-winsock 1745/tcpremote-winsock 1745/udpms-streaming 1755/tcpms-streaming 1755/udpmsmq 1801/tcp #Microsoft Message Queuemsmq 1801/udp #Microsoft Message Queueradius 1812/udp #RADIUS authentication protocolradacct 1813/udp #RADIUS accounting protocolmsnp 1863/tcpmsnp 1863/udpssdp 1900/tcpssdp 1900/udpclose-combat 1944/tcpclose-combat 1944/udpnfsd 2049/udp nfs #NFS serverknetd 2053/tcp #Kerberos de-multiplexormzap 2106/tcp #Multicast-Scope Zone Announcement Protocolmzap 2106/udp #Multicast-Scope Zone Announcement Protocolqwave 2177/tcp #QWAVEqwave 2177/udp #QWAVE Experiment Portdirectplay 2234/tcp #DirectPlaydirectplay 2234/udp #DirectPlayms-olap3 2382/tcp #Microsoft OLAP 3ms-olap3 2382/udp #Microsoft OLAP 3ms-olap4 2383/tcp #Microsoft OLAP 4ms-olap4 2383/udp #Microsoft OLAP 4ms-olap1 2393/tcp #Microsoft OLAP 1ms-olap1 2393/udp #Microsoft OLAP 1ms-olap2 2394/tcp #Microsoft OLAP 2ms-olap2 2394/udp #Microsoft OLAP 2ms-theater 2460/tcpms-theater 2460/udpwlbs 2504/tcp #Microsoft Windows Load Balancing Serverwlbs 2504/udp #Microsoft Windows Load Balancing Serverms-v-worlds 2525/tcp #Microsoft V-Worlds ms-v-worlds 2525/udp #Microsoft V-Worlds sms-rcinfo 2701/tcp #SMS RCINFOsms-rcinfo 2701/udp #SMS RCINFOsms-xfer 2702/tcp #SMS XFERsms-xfer 2702/udp #SMS XFERsms-chat 2703/tcp #SMS CHATsms-chat 2703/udp #SMS CHATsms-remctrl 2704/tcp #SMS REMCTRLsms-remctrl 2704/udp #SMS REMCTRLmsolap-ptp2 2725/tcp #MSOLAP PTP2msolap-ptp2 2725/udp #MSOLAP PTP2icslap 2869/tcpicslap 2869/udpcifs 3020/tcpcifs 3020/udpxbox 3074/tcp #Microsoft Xbox game portxbox 3074/udp #Microsoft Xbox game portms-dotnetster 3126/tcp #Microsoft .NET ster portms-dotnetster 3126/udp #Microsoft .NET ster portms-rule-engine 3132/tcp #Microsoft Business Rule Engine Update Servicems-rule-engine 3132/udp #Microsoft Business Rule Engine Update Servicemsft-gc 3268/tcp #Microsoft Global Catalogmsft-gc 3268/udp #Microsoft Global Catalogmsft-gc-ssl 3269/tcp #Microsoft Global Catalog with LDAP/SSLmsft-gc-ssl 3269/udp #Microsoft Global Catalog with LDAP/SSLms-cluster-net 3343/tcp #Microsoft Cluster Netms-cluster-net 3343/udp #Microsoft Cluster Netms-wbt-server 3389/tcp #MS WBT Serverms-wbt-server 3389/udp #MS WBT Serverms-la 3535/tcp #Microsoft Class Serverms-la 3535/udp #Microsoft Class Serverpnrp-port 3540/tcp #PNRP User Portpnrp-port 3540/udp #PNRP User Portteredo 3544/tcp #Teredo Portteredo 3544/udp #Teredo Portp2pgroup 3587/tcp #Peer to Peer Groupingp2pgroup 3587/udp #Peer to Peer Groupingws-discovery 3702/udp #WS-Discoveryws-discovery 3702/tcp #WS-Discoverydvcprov-port 3776/tcp #Device Provisioning Portdvcprov-port 3776/udp #Device Provisioning Portmsfw-control 3847/tcp #Microsoft Firewall Controlmsdts1 3882/tcp #DTS Service Portsdp-portmapper 3935/tcp #SDP Port Mapper Protocolsdp-portmapper 3935/udp #SDP Port Mapper Protocolnet-device 4350/tcp #Net Devicenet-device 4350/udp #Net Deviceipsec-msft 4500/tcp #Microsoft IPsec NAT-Tipsec-msft 4500/udp #Microsoft IPsec NAT-Tllmnr 5355/tcp #LLMNR llmnr 5355/udp #LLMNR wsd 5357/tcp #Web Services on devices wsd 5358/tcp #Web Services on devicesrrac 5678/tcp #Remote Replication Agent Connectionrrac 5678/udp #Remote Replication Agent Connectiondccm 5679/tcp #Direct Cable Connect Managerdccm 5679/udp #Direct Cable Connect Managerms-licensing 5720/tcp #Microsoft Licensingms-licensing 5720/udp #Microsoft Licensing directplay8 6073/tcp #DirectPlay8directplay8 6073/udp #DirectPlay8ms-do 7680/tcp #Microsoft Delivery Optimizationms-do 7680/udp #Microsoft Delivery Optimizationman 9535/tcp #Remote Man Serverrasadv 9753/tcprasadv 9753/udpimip-channels 11320/tcp #IMIP Channels Portimip-channels 11320/udp #IMIP Channels Portdirectplaysrvr 47624/tcp #Direct Play Serverdirectplaysrvr 47624/udp #Direct Play Server","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[]},{"title":"NTPå’ŒChronyä»¥åŠå¸¸ç”¨NTPæ—¶é—´åŒæ­¥æœåŠ¡å™¨","slug":"20191026-ntp-servers","date":"2019-10-26T07:00:00.000Z","updated":"2019-10-26T07:00:00.000Z","comments":true,"path":"20191026-ntp-servers/","link":"","permalink":"https://tinychen.com/20191026-ntp-servers/","excerpt":"å›½å†…å¸¸ç”¨çš„NTPæ—¶é—´æœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨äºLinuxä¸­çš„NTPæ—¶é—´åŒæ­¥æˆ–è€…æ˜¯chronyæ—¶é—´åŒæ­¥ã€‚","text":"å›½å†…å¸¸ç”¨çš„NTPæ—¶é—´æœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨äºLinuxä¸­çš„NTPæ—¶é—´åŒæ­¥æˆ–è€…æ˜¯chronyæ—¶é—´åŒæ­¥ã€‚ 1ã€NTPæ—¶é—´æœåŠ¡å™¨åŸŸå1234567891011121314151617181920212223# å›½å®¶æˆæ—¶ä¸­å¿ƒntp.ntsc.ac.cn# é˜¿é‡Œäº‘ntp.aliyun.com# åŒ—äº¬é‚®ç”µå¤§å­¦s1a.time.edu.cn # æ¸…åå¤§å­¦s2b.time.edu.cn # åŒ—äº¬é‚®ç”µå¤§å­¦s2c.time.edu.cn # è¥¿å—åœ°åŒºç½‘ç»œä¸­å¿ƒs2d.time.edu.cn # è¥¿åŒ—åœ°åŒºç½‘ç»œä¸­å¿ƒs2e.time.edu.cn # ä¸œåŒ—åœ°åŒºç½‘ç»œä¸­å¿ƒs2f.time.edu.cn 2ã€ä½¿ç”¨crontab+ntpdateåŒæ­¥123# ä½¿ç”¨rootç”¨æˆ·æ¯å°æ—¶åŒæ­¥ä¸€æ¬¡crontab -e -u root* */1 * * * (/usr/sbin/ntpdate ntp.ntsc.ac.cn) 3ã€ä½¿ç”¨chronyåŒæ­¥æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨CentOS8ä½œä¸ºå±•ç¤ºã€‚ 1234567# ä½¿ç”¨yumå®‰è£…chronyyum install chrony -y# è®¾ç½®å¼€æœºå¯åŠ¨å¹¶å¼€å¯chonyå¹¶æŸ¥çœ‹è¿è¡ŒçŠ¶æ€systemctl enable chronyd.servicesystemctl start chronyd.servicesystemctl status chronyd.service chronyçš„é…ç½®æ–‡ä»¶ç›®å½•ä½äº/etc/chrony.confï¼Œæˆ‘ä»¬å°†é‡Œé¢é»˜è®¤çš„æœåŠ¡å™¨æ³¨é‡Šæ‰ï¼Œæ¢æˆé˜¿é‡Œäº‘å’Œå›½å®¶æ—¶é—´ä¸­å¿ƒçš„æœåŠ¡å™¨ã€‚ ç„¶åæˆ‘ä»¬é‡å¯æœåŠ¡æŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€ 1234567# é‡å¯æœåŠ¡ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆsystemctl restart chronyd.service# æŸ¥çœ‹chronyçš„ntpæœåŠ¡å™¨çŠ¶æ€chronyc sourcestats -vchronyc sources -v 123# æŸ¥çœ‹æœ¬åœ°æ—¶é—´timedatectlhwclock å¦‚ä¸Šå›¾æ‰€ç¤ºæ˜¾ç¤ºSystem clock synchronizedçŠ¶æ€ä¸ºyeså¹¶ä¸”NTP serviceæ˜¾ç¤ºä¸ºactiveåˆ™è¯´æ˜å·²ç»é…ç½®æˆåŠŸäº†ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"ntp","slug":"ntp","permalink":"https://tinychen.com/tags/ntp/"},{"name":"chrony","slug":"chrony","permalink":"https://tinychen.com/tags/chrony/"}]},{"title":"CentOS8ä¸Šå¯åŠ¨ç³»ç»Ÿwebç®¡ç†å·¥å…·cockpit","slug":"20191025-centos8-use-cockpit","date":"2019-10-25T07:00:00.000Z","updated":"2019-10-25T07:00:00.000Z","comments":true,"path":"20191025-centos8-use-cockpit/","link":"","permalink":"https://tinychen.com/20191025-centos8-use-cockpit/","excerpt":"CentOS8å’ŒRHEL8ä¸­æ–°åŠ å…¥äº†ä¸€é¡¹åŠŸèƒ½cockpitï¼Œå¯ä»¥ä½¿ç”¨webæµè§ˆå™¨æ¥ç®¡ç†ç³»ç»Ÿçš„ä¸€äº›å¸¸ç”¨çŠ¶æ€ï¼Œæ¯”å¦‚ç”¨æˆ·ç®¡ç†ã€è½¯ä»¶æ›´æ–°ã€SELinuxä»¥åŠsshç­‰æ“ä½œã€‚","text":"CentOS8å’ŒRHEL8ä¸­æ–°åŠ å…¥äº†ä¸€é¡¹åŠŸèƒ½cockpitï¼Œå¯ä»¥ä½¿ç”¨webæµè§ˆå™¨æ¥ç®¡ç†ç³»ç»Ÿçš„ä¸€äº›å¸¸ç”¨çŠ¶æ€ï¼Œæ¯”å¦‚ç”¨æˆ·ç®¡ç†ã€è½¯ä»¶æ›´æ–°ã€SELinuxä»¥åŠsshç­‰æ“ä½œã€‚ é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨yumæ¥å®‰è£…cockpit 1yum install cockpit -y å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬è®¾ç½®å¼€æœºå¯åŠ¨ï¼ŒåŒæ—¶æ³¨æ„éœ€è¦åœ¨é˜²ç«å¢™é‡Œé¢è®¾ç½®æ”¾è¡Œç«¯å£ï¼Œcockpité»˜è®¤ä½¿ç”¨çš„æ˜¯9090ç«¯å£ï¼Œåœ¨CentOS8ä¸­çš„firewallé‡Œé¢æœ‰cockpitè¿™ä¸ªserviceï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨æŒ‡å®šç«¯å£æ”¾è¡Œã€‚ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è¿™é‡Œçš„æœåŠ¡æ˜¯cockpit.socketè€Œä¸æ˜¯cockpit.service 12345678910# è®¾ç½®å¼€æœºå¯åŠ¨systemctl enable cockpit.socket# å¼€å¯æœåŠ¡systemctl start cockpit.socket# åœ¨é˜²ç«å¢™ä¸­æ°¸ä¹…æ”¾è¡ŒæœåŠ¡firewall-cmd --permanent --add-service=cockpit# é‡å¯é˜²ç«å¢™firewall-cmd --reload# æŸ¥çœ‹æ˜¯å¦æ”¾è¡ŒæˆåŠŸfirewall-cmd --list-all æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ å†æ¬¡ä½¿ç”¨sshç™»å½•çš„æ—¶å€™æˆ‘ä»¬å°±ä¼šçœ‹åˆ°ç»ˆç«¯ä¸Šä¹Ÿä¼šæç¤ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨webæ§åˆ¶å°è¿›è¡Œç®¡ç†ã€‚ æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€æ¥çœ‹çœ‹ã€‚å¯ä»¥ä½¿ç”¨IPæˆ–è€…åŸŸåæ¥è¿›è¡Œç™»å½•ï¼Œæ³¨æ„éœ€è¦ä½¿ç”¨httpsåè®®å¹¶ä¸”æŒ‡å®šç«¯å£ä¸º9090ã€‚ è¿™é‡Œæµè§ˆå™¨ä¼šæç¤ºæˆ‘ä»¬ä¸å®‰å…¨ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯httpsåè®®ï¼Œè€Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¯¼å…¥æƒå¨CAé¢å‘çš„è¯ä¹¦ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ä¹Ÿå¯ä»¥åœ¨/etc/cockpit/ws-certs.dè¿™ä¸ªç›®å½•ä¸‹é¢å¯¼å…¥certè¯ä¹¦æ¥è¿›è¡Œè®¤è¯ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨sudo remotectl certificateå‘½ä»¤æ¥æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆè¯ä¹¦ æ¥ç€æˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿä¸­çš„ç”¨æˆ·è´¦å·å¯†ç ç™»å½•ã€‚ ç™»å½•è¿›å»ä¹‹åå¯ä»¥æŸ¥çœ‹ç³»ç»Ÿçš„å„ç§çŠ¶æ€å’ŒæœåŠ¡ï¼Œä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ç»ˆç«¯è¿›è¡Œæ›´å¤šæ“ä½œã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"cockpit","slug":"cockpit","permalink":"https://tinychen.com/tags/cockpit/"}]},{"title":"CentOS8yumæºæ›¿æ¢ä¸ºå›½å†…é•œåƒæº","slug":"20191024-centos8-replace-yum-source","date":"2019-10-24T07:00:00.000Z","updated":"2019-10-24T07:00:00.000Z","comments":true,"path":"20191024-centos8-replace-yum-source/","link":"","permalink":"https://tinychen.com/20191024-centos8-replace-yum-source/","excerpt":"CentOS8ä¸­ä¸»è¦çš„å†…ç½®yumæºã€elrepoæºã€epelæºå’Œrpmfusionæºçš„å›½å†…é•œåƒç‰ˆæœ¬ï¼Œç›´æ¥å¤åˆ¶æ›¿æ¢å³å¯ä½¿ç”¨ã€‚","text":"CentOS8ä¸­ä¸»è¦çš„å†…ç½®yumæºã€elrepoæºã€epelæºå’Œrpmfusionæºçš„å›½å†…é•œåƒç‰ˆæœ¬ï¼Œç›´æ¥å¤åˆ¶æ›¿æ¢å³å¯ä½¿ç”¨ã€‚ 1ã€CentOS8å†…ç½®yumæºè¿™é‡Œä½¿ç”¨çš„æ˜¯ç½‘æ˜“163çš„é•œåƒæºå’Œæ¸…åçš„é•œåƒæºã€‚ å…¶ä¸­CentOS-Debug.repoã€CentOS-Media.repoã€CentOS-Sources.repoã€CentOS-Vault.repoè¿™å››ä¸ªrepoæ— éœ€æ›¿æ¢ã€‚ CentOS-AppStream.repo1234567891011121314151617181920# CentOS-AppStream.repo## The mirror system uses the connecting IP address of the client and the# update status of each mirror to pick mirrors that are updated to and# geographically close to the client. You should use this for CentOS updates# unless you are manually picking other mirrors.## If the mirrorlist= does not work for you, as a fall back you can try the# remarked out baseurl= line instead.##[AppStream]name=CentOS-$releasever - AppStream#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=AppStream&amp;infra=$infra#baseurl=http://mirror.centos.org/$contentdir/$releasever/AppStream/$basearch/os/baseurl=http://mirrors.163.com/centos/$releasever/AppStream/$basearch/os/gpgcheck=1enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial CentOS-Base.repo1234567891011121314151617181920# CentOS-Base.repo## The mirror system uses the connecting IP address of the client and the# update status of each mirror to pick mirrors that are updated to and# geographically close to the client. You should use this for CentOS updates# unless you are manually picking other mirrors.## If the mirrorlist= does not work for you, as a fall back you can try the# remarked out baseurl= line instead.##[BaseOS]name=CentOS-$releasever - Base#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=BaseOS&amp;infra=$infra#baseurl=http://mirror.centos.org/$contentdir/$releasever/BaseOS/$basearch/os/baseurl=http://mirrors.163.com/centos/$releasever/BaseOS/$basearch/os/gpgcheck=1enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial CentOS-centosplus.repo1234567891011121314151617181920212223# CentOS-centosplus.repo## The mirror system uses the connecting IP address of the client and the# update status of each mirror to pick mirrors that are updated to and# geographically close to the client. You should use this for CentOS updates# unless you are manually picking other mirrors.## If the mirrorlist= does not work for you, as a fall back you can try the# remarked out baseurl= line instead.###additional packages that extend functionality of existing packages[centosplus]name=CentOS-$releasever - Plus#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra#baseurl=http://mirror.centos.org/$contentdir/$releasever/centosplus/$basearch/os/baseurl=http://mirrors.163.com/centos/$releasever/centosplus/$basearch/os/gpgcheck=1enabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial CentOS-CR.repo123456789101112131415161718192021222324# CentOS-CR.repo## The Continuous Release ( CR ) repository contains rpms that are due in the next# release for a specific CentOS Version ( eg. next release in CentOS-8 ); these rpms# are far less tested, with no integration checking or update path testing having# taken place. They are still built from the upstream sources, but might not map# to an exact upstream distro release.## These packages are made available soon after they are built, for people willing# to test their environments, provide feedback on content for the next release, and# for people looking for early-access to next release content.## The CR repo is shipped in a disabled state by default; its important that users# understand the implications of turning this on.#[cr]name=CentOS-$releasever - cr#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=cr&amp;infra=$infra#baseurl=http://mirror.centos.org/$contentdir/$releasever/cr/$basearch/os/baseurl=http://mirrors.163.com/centos/$releasever/cr/$basearch/os/gpgcheck=1enabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial CentOS-Extras.repo123456789101112131415161718192021# CentOS-Extras.repo## The mirror system uses the connecting IP address of the client and the# update status of each mirror to pick mirrors that are updated to and# geographically close to the client. You should use this for CentOS updates# unless you are manually picking other mirrors.## If the mirrorlist= does not work for you, as a fall back you can try the# remarked out baseurl= line instead.###additional packages that may be useful[extras]name=CentOS-$releasever - Extras#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra#baseurl=http://mirror.centos.org/$contentdir/$releasever/extras/$basearch/os/baseurl=http://mirrors.163.com/centos/$releasever/extras/$basearch/os/gpgcheck=1enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial CentOS-fasttrack.repo12345678910#CentOS-fasttrack.repo[fasttrack]name=CentOS-$releasever - fasttrack#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=fasttrack&amp;infra=$infra#baseurl=http://mirror.centos.org/$contentdir/$releasever/fasttrack/$basearch/os/baseurl=http://mirrors.163.com/centos/$releasever/fasttrack/$basearch/os/gpgcheck=1enabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial CentOS-HA.repo12345678910111213141516171819202122# CentOS-HA.repo## The mirror system uses the connecting IP address of the client and the# update status of each mirror to pick mirrors that are updated to and# geographically close to the client. You should use this for CentOS updates# unless you are manually picking other mirrors.## If the mirrorlist= does not work for you, as a fall back you can try the# remarked out baseurl= line instead.##[HighAvailability]name=CentOS-$releasever - HA#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=HighAvailability&amp;infra=$infra#baseurl=http://mirror.centos.org/$contentdir/$releasever/HighAvailability/$basearch/os/baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/HighAvailability/$basearch/os/gpgcheck=1enabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial CentOS-PowerTools.repo12345678910111213141516171819# CentOS-PowerTools.repo## The mirror system uses the connecting IP address of the client and the# update status of each mirror to pick mirrors that are updated to and# geographically close to the client. You should use this for CentOS updates# unless you are manually picking other mirrors.## If the mirrorlist= does not work for you, as a fall back you can try the# remarked out baseurl= line instead.##[PowerTools]name=CentOS-$releasever - PowerTools#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=PowerTools&amp;infra=$infra#baseurl=http://mirror.centos.org/$contentdir/$releasever/PowerTools/$basearch/os/baseurl=http://mirrors.163.com/centos/$releasever/PowerTools/$basearch/os/gpgcheck=1enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial 2ã€elrepoæºè¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸­ç§‘å¤§çš„é•œåƒæº elrepo.repo123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354### Name: ELRepo.org Community Enterprise Linux Repository for el8### URL: http://elrepo.org/[elrepo]name=ELRepo.org Community Enterprise Linux Repository - el8baseurl=https://mirrors.ustc.edu.cn/elrepo/elrepo/el8/$basearch/#baseurl=http://elrepo.org/linux/elrepo/el8/$basearch/# http://mirrors.coreix.net/elrepo/elrepo/el8/$basearch/# http://jur-linux.org/download/elrepo/elrepo/el8/$basearch/# http://repos.lax-noc.com/elrepo/elrepo/el8/$basearch/#mirrorlist=http://mirrors.elrepo.org/mirrors-elrepo.el8enabled=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-elrepo.orgprotect=0[elrepo-testing]name=ELRepo.org Community Enterprise Linux Testing Repository - el8baseurl=https://mirrors.ustc.edu.cn/elrepo/testing/el8/$basearch/#baseurl=http://elrepo.org/linux/testing/el8/$basearch/# http://mirrors.coreix.net/elrepo/testing/el8/$basearch/# http://jur-linux.org/download/elrepo/testing/el8/$basearch/# http://repos.lax-noc.com/elrepo/testing/el8/$basearch/#mirrorlist=http://mirrors.elrepo.org/mirrors-elrepo-testing.el8enabled=0gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-elrepo.orgprotect=0[elrepo-kernel]name=ELRepo.org Community Enterprise Linux Kernel Repository - el8baseurl=https://mirrors.ustc.edu.cn/elrepo/kernel/el8/$basearch/#baseurl=http://elrepo.org/linux/kernel/el8/$basearch/# http://mirrors.coreix.net/elrepo/kernel/el8/$basearch/# http://jur-linux.org/download/elrepo/kernel/el8/$basearch/# http://repos.lax-noc.com/elrepo/kernel/el8/$basearch/#mirrorlist=http://mirrors.elrepo.org/mirrors-elrepo-kernel.el8enabled=0gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-elrepo.orgprotect=0[elrepo-extras]name=ELRepo.org Community Enterprise Linux Extras Repository - el8baseurl=https://mirrors.ustc.edu.cn/elrepo/extras/el8/$basearch/#baseurl=http://elrepo.org/linux/extras/el8/$basearch/# http://mirrors.coreix.net/elrepo/extras/el8/$basearch/# http://jur-linux.org/download/elrepo/extras/el8/$basearch/# http://repos.lax-noc.com/elrepo/extras/el8/$basearch/#mirrorlist=http://mirrors.elrepo.org/mirrors-elrepo-extras.el8enabled=0gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-elrepo.orgprotect=0 3ã€epelæºè¿™é‡Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„epelæº epel-modular.repo123456789101112131415161718192021222324252627[epel-modular]name=Extra Packages for Enterprise Linux Modular $releasever - $basearch#baseurl=https://download.fedoraproject.org/pub/epel/$releasever/Modular/$basearch#metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-modular-$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/8/Modular/$basearchenabled=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8[epel-modular-debuginfo]name=Extra Packages for Enterprise Linux Modular $releasever - $basearch - Debug#baseurl=https://download.fedoraproject.org/pub/epel/$releasever/Modular/$basearch/debug#metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-modular-debug-$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/8/Modular/$basearch/debugenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1[epel-modular-source]name=Extra Packages for Enterprise Linux Modular $releasever - $basearch - Source#baseurl=https://download.fedoraproject.org/pub/epel/$releasever/Modular/SRPMS#metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-modular-source-$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/8/Modular/SRPMSenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1 epel-playground.repo1234567891011121314151617181920212223242526[epel-playground]name=Extra Packages for Enterprise Linux $releasever - Playground - $basearch#baseurl=https://download.fedoraproject.org/pub/epel/playground/$releasever/Everything/$basearch/os#metalink=https://mirrors.fedoraproject.org/metalink?repo=playground-epel$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/playground/8/Everything/$basearch/osenabled=0gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8[epel-playground-debuginfo]name=Extra Packages for Enterprise Linux $releasever - Playground - $basearch - Debug#baseurl=https://download.fedoraproject.org/pub/epel/playground/$releasever/Everything/$basearch/debug#metalink=https://mirrors.fedoraproject.org/metalink?repo=playground-debug-epel$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/playground/8/Everything/$basearch/debugenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1[epel-playground-source]name=Extra Packages for Enterprise Linux $releasever - Playground - $basearch - Source#baseurl=https://download.fedoraproject.org/pub/epel/playground/$releasever/Everything/source/tree/#metalink=https://mirrors.fedoraproject.org/metalink?repo=playground-source-epel$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/playground/8/Everything/source/tree/enabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1 epel-testing-modular.repo12345678910111213141516171819202122232425[epel-testing-modular]name=Extra Packages for Enterprise Linux Modular $releasever - Testing - $basearch#baseurl=https://download.fedoraproject.org/pub/epel/testing/$releasever/Modular/$basearch#metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-modular-epel$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/testing/8/Modular/$basearchenabled=0gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8[epel-testing-modular-debuginfo]name=Extra Packages for Enterprise Linux Modular $releasever - Testing - $basearch - Debug#baseurl=https://download.fedoraproject.org/pub/epel/testing/$releasever/Modular/$basearch/debug#metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-modular-debug-epel$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/testing/8/Modular/$basearch/debuggpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1[epel-testing-modular-source]name=Extra Packages for Enterprise Linux Modular $releasever - Testing - $basearch - Source#baseurl=https://download.fedoraproject.org/pub/epel/testing/$releasever/Modular/SRPMS#metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-modular-source-epel$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/testing/8/Modular/SRPMSenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1 epel-testing.repo1234567891011121314151617181920212223242526[epel-testing]name=Extra Packages for Enterprise Linux $releasever - Testing - $basearch#baseurl=https://download.fedoraproject.org/pub/epel/testing/$releasever/Everything/$basearch#metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-epel$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/testing/8/Everything/$basearchenabled=0gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8[epel-testing-debuginfo]name=Extra Packages for Enterprise Linux $releasever - Testing - $basearch - Debug#baseurl=https://download.fedoraproject.org/pub/epel/testing/$releasever/Everything/$basearch/debug#metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-debug-epel$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/testing/8/Everything/$basearch/debugenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1[epel-testing-source]name=Extra Packages for Enterprise Linux $releasever - Testing - $basearch - Source#baseurl=https://download.fedoraproject.org/pub/epel/testing/$releasever/Everything/SRPMS#metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-source-epel$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirbaseurl=https://mirrors.aliyun.com/epel/testing/8/Everything/SRPMSenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1 epel.repo1234567891011121314151617181920212223242526[epel]name=Extra Packages for Enterprise Linux $releasever - $basearch#baseurl=https://download.fedoraproject.org/pub/epel/$releasever/Everything/$basearchbaseurl=https://mirrors.aliyun.com/epel/8/Everything/$basearch/#metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirenabled=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8[epel-debuginfo]name=Extra Packages for Enterprise Linux $releasever - $basearch - Debug#baseurl=https://download.fedoraproject.org/pub/epel/$releasever/Everything/$basearch/debugbaseurl=https://mirrors.aliyun.com/epel/8/Everything/$basearch/debug/#metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1[epel-source]name=Extra Packages for Enterprise Linux $releasever - $basearch - Source#baseurl=https://download.fedoraproject.org/pub/epel/$releasever/Everything/SRPMSbaseurl=https://mirrors.aliyun.com/epel/8/Everything/SRPMS/#metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-source-$releasever&amp;arch=$basearch&amp;infra=$infra&amp;content=$contentdirenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8gpgcheck=1 4ã€rpmfusionæºè¿™é‡Œä½¿ç”¨çš„æ˜¯æ¸…åçš„rpmfusioné•œåƒæº rpmfusion-free-updates-testing.repo123456789101112131415161718192021222324252627282930[rpmfusion-free-updates-testing]name=RPM Fusion for EL 8 - Free - Test Updates#baseurl=http://download1.rpmfusion.org/free/el/updates/testing/8/$basearch/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-el-updates-testing-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/free/el/updates/testing/8/$basearch/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-free-el-8[rpmfusion-free-updates-testing-debuginfo]name=RPM Fusion for EL 8 - Free - Test Updates Debug#baseurl=http://download1.rpmfusion.org/free/el/updates/testing/8/$basearch/debug/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-el-updates-testing-debug-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/free/el/updates/testing/8/$basearch/debug/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-free-el-8[rpmfusion-free-updates-testing-source]name=RPM Fusion for EL 8 - Free - Test Updates Source#baseurl=http://download1.rpmfusion.org/free/el/updates/testing/8/SRPMS/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-el-updates-testing-source-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/free/el/updates/testing/8/SRPMS/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-free-el-8 rpmfusion-free-updates.repo1234567891011121314151617181920212223242526272829[rpmfusion-free-updates]name=RPM Fusion for EL 8 - Free - Updates#baseurl=http://download1.rpmfusion.org/free/el/updates/8/$basearch/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-el-updates-released-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/free/el/updates/8/$basearch/enabled=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-free-el-8[rpmfusion-free-updates-debuginfo]name=RPM Fusion for EL 8 - Free - Updates Debug#baseurl=http://download1.rpmfusion.org/free/el/updates/8/$basearch/debug/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-el-updates-released-debug-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/free/el/updates/8/$basearch/debug/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-free-el-8[rpmfusion-free-updates-source]name=RPM Fusion for EL 8 - Free - Updates Source#baseurl=http://download1.rpmfusion.org/free/el/updates/8/SRPMS/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-el-updates-released-source-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/free/el/updates/8/SRPMS/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-free-el-8 rpmfusion-nonfree-updates-testing.repo1234567891011121314151617181920212223242526272829[rpmfusion-nonfree-updates-testing]name=RPM Fusion for EL 8 - Nonfree - Test Updates#baseurl=http://download1.rpmfusion.org/nonfree/el/updates/testing/8/$basearch/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-el-updates-testing-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/nonfree/el/updates/testing/8/$basearch/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-nonfree-el-8[rpmfusion-nonfree-updates-testing-debuginfo]name=RPM Fusion for EL 8 - Nonfree - Test Updates Debug#baseurl=http://download1.rpmfusion.org/nonfree/el/updates/testing/8/$basearch/debug/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-el-updates-testing-debug-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/nonfree/el/updates/testing/8/$basearch/debug/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-nonfree-el-8[rpmfusion-nonfree-updates-testing-source]name=RPM Fusion for EL 8 - Nonfree - Test Updates Source#baseurl=http://download1.rpmfusion.org/nonfree/el/updates/testing/8/SRPMS/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-el-updates-testing-source-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/nonfree/el/updates/testing/8/SRPMS/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-nonfree-el-8 rpmfusion-nonfree-updates.repo12345678910111213141516171819202122232425262728[rpmfusion-nonfree-updates]name=RPM Fusion for EL 8 - Nonfree - Updates#baseurl=http://download1.rpmfusion.org/nonfree/el/updates/8/$basearch/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-el-updates-released-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/nonfree/el/updates/8/$basearch/enabled=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-nonfree-el-8[rpmfusion-nonfree-updates-debuginfo]name=RPM Fusion for EL 8 - Nonfree - Updates Debug#baseurl=http://download1.rpmfusion.org/nonfree/el/updates/8/$basearch/debug/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-el-updates-released-debug-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/nonfree/el/updates/8/$basearch/debug/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-nonfree-el-8[rpmfusion-nonfree-updates-source]name=RPM Fusion for EL 8 - Nonfree - Updates Source#baseurl=http://download1.rpmfusion.org/nonfree/el/updates/8/SRPMS/#mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-el-updates-released-source-8&amp;arch=$basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/rpmfusion/nonfree/el/updates/8/SRPMS/enabled=0type=rpm-mdgpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-nonfree-el-8","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"yum","slug":"yum","permalink":"https://tinychen.com/tags/yum/"}]},{"title":"é…ç½®bashè¡¥å…¨å¿½ç•¥å¤§å°å†™","slug":"20191023-bash-completion-ignore-case","date":"2019-10-23T07:00:00.000Z","updated":"2019-10-23T07:00:00.000Z","comments":true,"path":"20191023-bash-completion-ignore-case/","link":"","permalink":"https://tinychen.com/20191023-bash-completion-ignore-case/","excerpt":"åœ¨Linuxä¸Šä½¿ç”¨bashè¡¥å…¨çš„æ—¶å€™å¿½ç•¥å¤§å°å†™ã€‚","text":"åœ¨Linuxä¸Šä½¿ç”¨bashè¡¥å…¨çš„æ—¶å€™å¿½ç•¥å¤§å°å†™ã€‚ ä¸€èˆ¬åœ¨centoså’Œubuntuä¸­ä½¿ç”¨bashçš„æ—¶å€™ï¼Œéƒ½ä¼šä½¿ç”¨bash-completionæ¥è¿›è¡Œè‡ªåŠ¨è¡¥å…¨å‘½ä»¤ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¡¥å…¨æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œå…³é—­åŒºåˆ†å¤§å°å†™åŠŸèƒ½åªéœ€è¦åœ¨inputrcæ–‡ä»¶ä¸­ä¿®æ”¹ä¸€ä¸‹å³å¯ã€‚ å¦‚æœæ˜¯æœ€å°åŒ–å®‰è£…ï¼Œå¯èƒ½æ²¡æœ‰å®‰è£…è¿™ä¸ªè¡¥å…¨å·¥å…·ã€‚ 12# åœ¨centosä¸­ä½¿ç”¨yumå®‰è£…yum install bash-completion -y 12345# åœ¨/etc/inputrcä¸­æ·»åŠ ä½¿å…¨å±€æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆecho &#x27;set completion-ignore-case on&#x27; &gt;&gt; /etc/inputrc# å¯¹äºä¸ªåˆ«ç”¨æˆ·ï¼Œåˆ™å¯ä»¥åœ¨ç”¨æˆ·homeç›®å½•ä¸‹æ·»åŠ echo &#x27;set completion-ignore-case on&#x27; &gt;&gt; ~/.inputrc æ·»åŠ å®Œæˆä¹‹åæˆ‘ä»¬é‡æ–°å¯åŠ¨bashå‘½ä»¤è¡Œæˆ–è€…æ˜¯é‡æ–°ç™»å½•ä¸€ä¸‹å°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"bash","slug":"bash","permalink":"https://tinychen.com/tags/bash/"}]},{"title":"åœ¨CentOSä¸­å®‰è£…VisualStudioCode","slug":"20191022-centos-install-vsc","date":"2019-10-22T07:00:00.000Z","updated":"2019-10-22T07:00:00.000Z","comments":true,"path":"20191022-centos-install-vsc/","link":"","permalink":"https://tinychen.com/20191022-centos-install-vsc/","excerpt":"åœ¨CentOSä¸Šä½¿ç”¨yum repoå®‰è£…VSCï¼Œå®æµ‹CentOS7å’ŒCentOS8å‡å¯æ­£å¸¸å®‰è£…ã€‚","text":"åœ¨CentOSä¸Šä½¿ç”¨yum repoå®‰è£…VSCï¼Œå®æµ‹CentOS7å’ŒCentOS8å‡å¯æ­£å¸¸å®‰è£…ã€‚ VSCçš„å®‰è£…éå¸¸ç®€å•ï¼Œå› ä¸ºå¾®è½¯å®˜æ–¹æœ‰æä¾›yum repoï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥æ·»åŠ repoç„¶åä½¿ç”¨yumå®‰è£…å³å¯ï¼Œæ³¨æ„åœ¨CentOS8ä¸­çš„yumå®é™…ä¸Šå·²ç»è¢«æ›¿æ¢æˆäº†dnfï¼Œæ‰€ä»¥ä½¿ç”¨yumæˆ–è€…æ˜¯dnféƒ½æ˜¯ä¸€æ ·çš„ã€‚ 12345678# å¯¼å…¥gpgkeysudo rpm --import https://packages.microsoft.com/keys/microsoft.asc# æ–°å»ºrepoæ–‡ä»¶sudo sh -c &#x27;echo -e &quot;[code]\\nname=Visual Studio Code\\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\\nenabled=1\\ngpgcheck=1\\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc&quot; &gt; /etc/yum.repos.d/vscode.repo&#x27;# æ›´æ–°repo listsudo yum check-update# å®‰è£…vscsudo yum install code VSCå®˜ç½‘æä¾›äº†éå¸¸è¯¦ç»†çš„å®‰è£…æ•™ç¨‹ï¼Œéœ€è¦çš„åŒå­¦å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚ä¸‹é¢åªè´´å‡ºå®‰è£…è®°å½•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354[root@tiny-studio ~]# sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc[root@tiny-studio ~]# sudo sh -c &#x27;echo -e &quot;[code]\\nname=Visual Studio Code\\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\\nenabled=1\\ngpgcheck=1\\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc&quot; &gt; /etc/yum.repos.d/vscode.repo&#x27;[root@tiny-studio ~]# cat /etc/yum.repos.d/vscode.repo [code]name=Visual Studio Codebaseurl=https://packages.microsoft.com/yumrepos/vscodeenabled=1gpgcheck=1gpgkey=https://packages.microsoft.com/keys/microsoft.asc[root@tiny-studio ~]# sudo dnf check-updateVisual Studio Code 122 kB/s | 2.2 MB 00:18 [root@tiny-studio ~]# dnf install codeä¾èµ–å…³ç³»è§£å†³ã€‚================================================================================================================ è½¯ä»¶åŒ… æ¶æ„ ç‰ˆæœ¬ ä»“åº“ å¤§å°================================================================================================================Installing: code x86_64 1.39.2-1571154220.el7 code 77 Mäº‹åŠ¡æ¦‚è¦================================================================================================================å®‰è£… 1 è½¯ä»¶åŒ…æ€»ä¸‹è½½ï¼š77 Må®‰è£…å¤§å°ï¼š230 Mç¡®å®šå—ï¼Ÿ[y/N]ï¼š yä¸‹è½½è½¯ä»¶åŒ…ï¼šcode-1.39.2-1571154220.el7.x86_64.rpm 4.5 MB/s | 77 MB 00:17 ----------------------------------------------------------------------------------------------------------------æ€»è®¡ 4.5 MB/s | 77 MB 00:17 è¿è¡Œäº‹åŠ¡æ£€æŸ¥äº‹åŠ¡æ£€æŸ¥æˆåŠŸã€‚è¿è¡Œäº‹åŠ¡æµ‹è¯•äº‹åŠ¡æµ‹è¯•æˆåŠŸã€‚è¿è¡Œäº‹åŠ¡ å‡†å¤‡ä¸­ : 1/1 Installing : code-1.39.2-1571154220.el7.x86_64 1/1 è¿è¡Œè„šæœ¬ : code-1.39.2-1571154220.el7.x86_64 1/1 éªŒè¯ : code-1.39.2-1571154220.el7.x86_64 1/1 å·²å®‰è£…: code-1.39.2-1571154220.el7.x86_64 å®Œæ¯•ï¼","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"åœ¨CentOSä¸­å®‰è£…wps","slug":"20191020-centos-install-wps","date":"2019-10-20T07:00:00.000Z","updated":"2019-10-20T07:00:00.000Z","comments":true,"path":"20191020-centos-install-wps/","link":"","permalink":"https://tinychen.com/20191020-centos-install-wps/","excerpt":"åœ¨CentOSä¸Šä½¿ç”¨rpmå®‰è£…wpså¹¶å¯¼å…¥ç›¸å…³çš„ç¼ºå¤±å­—ä½“,å®æµ‹CentOS7å’Œ8å‡å¯æ­£å¸¸å®‰è£…ã€‚","text":"åœ¨CentOSä¸Šä½¿ç”¨rpmå®‰è£…wpså¹¶å¯¼å…¥ç›¸å…³çš„ç¼ºå¤±å­—ä½“,å®æµ‹CentOS7å’Œ8å‡å¯æ­£å¸¸å®‰è£…ã€‚ 1ã€ä¸‹è½½å®‰è£…wpså®˜ç½‘çš„ä¸‹è½½åœ°å€ï¼š https://www.wps.cn/product/wpslinux å¯¹äºCentOSï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½rpmæ ¼å¼çš„å®‰è£…åŒ…ã€‚ 1234567891011# å®šä½åˆ°ä¸‹è½½ç›®å½•cd /home/tinychen/Downloads/# å¯¹å®‰è£…åŒ…æƒé™è¿›è¡Œä¿®æ”¹ï¼Œä½¿æ‰€æœ‰ç”¨æˆ·è·å–xæƒé™ï¼ˆæ‰§è¡Œæƒé™ï¼‰sudo chmod a+x wps-office-11.1.0.8865-1.x86_64.rpm # å…ˆä½¿ç”¨yumå®‰è£…æ‰€éœ€è¦çš„åº“sudo yum install libGLU# ä½¿ç”¨rpmå‘½ä»¤è¿›è¡Œå®‰è£…sudo rpm -ivh wps-office-11.1.0.8865-1.x86_64.rpm 2 ã€å¯¼å…¥å­—ä½“å­—ä½“çš„ä¸‹è½½è¿æ¥ï¼š é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Dth_WFtphSuKnIpDcTWT_Qæå–ç ï¼šoc#zs 12345678# ä¸‹è½½å®Œæˆåä½¿ç”¨unzipå‘½ä»¤è§£å‹unzip -d ./wps_symbol_fonts wps_symbol_fonts.zip# å®šä½åˆ°wpså­—ä½“å­˜æ”¾ç›®å½•cd /usr/share/fonts/wps-office/# å°†ä¸‹è½½è§£å‹çš„å­—ä½“å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸­cp /home/tinychen/Downloads/wps_symbol_fonts/* .","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"åœ¨CentOSä¸­å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„docker","slug":"20190912-centos-install-docker","date":"2019-09-12T07:00:00.000Z","updated":"2019-09-12T07:00:00.000Z","comments":true,"path":"20190912-centos-install-docker/","link":"","permalink":"https://tinychen.com/20190912-centos-install-docker/","excerpt":"åœ¨CentOS7å’ŒCentOS8ä¸Šå¸è½½å·²å®‰è£…çš„dockerå¹¶å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerã€‚","text":"åœ¨CentOS7å’ŒCentOS8ä¸Šå¸è½½å·²å®‰è£…çš„dockerå¹¶å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„dockerã€‚ 1ã€å¸è½½å·²å­˜åœ¨ç‰ˆæœ¬é¦–å…ˆæˆ‘ä»¬å¸è½½å·²ç»å®‰è£…çš„ç‰ˆæœ¬ 12345678910yum remove docker-ce docker-ce-cli containerd.ioyum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine 2ã€å¯¼å…¥yumæºå¯¼å…¥dockerå®˜æ–¹æä¾›çš„yumæºï¼Œå¦‚æœç½‘ç»œä¸å¥½ä½¿ç”¨å®˜ç½‘yumæºæ¯”è¾ƒæ…¢çš„åŒå­¦ä¹Ÿå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„é•œåƒyumæºã€‚ 123sudo yum install -y yum-utils device-mapper-persistent-data lvm2sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo å¤§å®¶å¯ä»¥ç›´æ¥å¤åˆ¶ä¸‹é¢çš„yumæºç›´æ¥ä¿å­˜åˆ°/etc/yum.repo.d/ç›®å½•ä¸‹ã€‚ ä¸‹é¢çš„è¿™ä¸ªæ˜¯é˜¿é‡Œäº‘çš„é•œåƒæºç‰ˆæœ¬ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384[docker-ce-stable]name=Docker CE Stable - $basearchbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/$basearch/stableenabled=1gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-stable-debuginfo]name=Docker CE Stable - Debuginfo $basearchbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/debug-$basearch/stableenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-stable-source]name=Docker CE Stable - Sourcesbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/source/stableenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-edge]name=Docker CE Edge - $basearchbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/$basearch/edgeenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-edge-debuginfo]name=Docker CE Edge - Debuginfo $basearchbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/debug-$basearch/edgeenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-edge-source]name=Docker CE Edge - Sourcesbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/source/edgeenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-test]name=Docker CE Test - $basearchbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/$basearch/testenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-test-debuginfo]name=Docker CE Test - Debuginfo $basearchbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/debug-$basearch/testenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-test-source]name=Docker CE Test - Sourcesbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/source/testenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-nightly]name=Docker CE Nightly - $basearchbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/$basearch/nightlyenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-nightly-debuginfo]name=Docker CE Nightly - Debuginfo $basearchbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/debug-$basearch/nightlyenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg[docker-ce-nightly-source]name=Docker CE Nightly - Sourcesbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/source/nightlyenabled=0gpgcheck=1gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg ä¸‹é¢çš„è¿™ä¸ªæ˜¯æ¸…åçš„é•œåƒæºç‰ˆæœ¬ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283[docker-ce-stable]name=Docker CE Stable - $basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/$basearch/stableenabled=1gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-stable-debuginfo]name=Docker CE Stable - Debuginfo $basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/debug-$basearch/stableenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-stable-source]name=Docker CE Stable - Sourcesbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/source/stableenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-edge]name=Docker CE Edge - $basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/$basearch/edgeenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-edge-debuginfo]name=Docker CE Edge - Debuginfo $basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/debug-$basearch/edgeenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-edge-source]name=Docker CE Edge - Sourcesbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/source/edgeenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-test]name=Docker CE Test - $basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/$basearch/testenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-test-debuginfo]name=Docker CE Test - Debuginfo $basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/debug-$basearch/testenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-test-source]name=Docker CE Test - Sourcesbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/source/testenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-nightly]name=Docker CE Nightly - $basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/$basearch/nightlyenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-nightly-debuginfo]name=Docker CE Nightly - Debuginfo $basearchbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/debug-$basearch/nightlyenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg[docker-ce-nightly-source]name=Docker CE Nightly - Sourcesbaseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/$releasever/source/nightlyenabled=0gpgcheck=1gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg 3ã€å®‰è£…dockeræ¥ç€æˆ‘ä»¬ä»é«˜åˆ°ä½åˆ—å‡ºyumæºä¸­å„ä¸ªç‰ˆæœ¬çš„docker 1yum list docker-ce --showduplicates | sort -r å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„å‘½ä»¤å¦‚ä¸‹ 1yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io å¦‚æœéœ€è¦å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥è¿™æ ·ï¼š 1yum install docker-ce docker-ce-cli containerd.io è¿™é‡Œæˆ‘ä»¬å®‰è£…18.9.0çš„ç‰ˆæœ¬ 1yum install docker-ce-18.09.0-3.el7 docker-ce-cli-18.09.0-3.el7 containerd.io Install a specific version by its fully qualified package name, which is the package name (docker-ce) plus the version string (2nd column) starting at the first colon (:), up to the first hyphen, separated by a hyphen (-). For example, docker-ce-18.09.1. è¿™é‡Œå’Œå®˜ç½‘çš„è¯´æ˜æœ‰ä¸€ç‚¹ä¸ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦åŠ ä¸Šåé¢çš„-3.el7ï¼Œå¦åˆ™æ£€æµ‹ä¸åˆ°å®‰è£…åŒ…ã€‚ 4ã€æ›´æ¢cgroupé©±åŠ¨k8sæ¨èdockerçš„cgroupé©±åŠ¨ä½¿ç”¨systemdï¼Œè¯´æ˜¯ä¼šæ›´ç¨³å®šï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŒæ—¶è¿™é‡Œæ›´æ¢dockerçš„é•œåƒæºä¸ºä¸­ç§‘å¤§çš„é•œåƒæºã€‚ 123456789101112131415161718192021222324## Create /etc/docker directory.mkdir /etc/docker# Setup daemon.cat &gt; /etc/docker/daemon.json &lt;&lt;EOF&#123; &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;], &quot;log-driver&quot;: &quot;json-file&quot;, &quot;log-opts&quot;: &#123; &quot;max-size&quot;: &quot;100m&quot; &#125;, &quot;storage-driver&quot;: &quot;overlay2&quot;, &quot;storage-opts&quot;: [ &quot;overlay2.override_kernel_check=true&quot; ], &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;]&#125;EOFmkdir -p /etc/systemd/system/docker.service.d# Restart Dockersystemctl daemon-reloadsystemctl restart docker 5ã€é…ç½®æ™®é€šç”¨æˆ·é»˜è®¤æƒ…å†µä¸‹ï¼Œæ™®é€šç”¨æˆ·éœ€è¦ä½¿ç”¨sudoæ‰èƒ½æ“ä½œdockerï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦è¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚ 123456789101112# åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·su æ™®é€šç”¨æˆ·å# åˆ›å»ºdockerç»„sudo groupadd docker# å°†å½“å‰ç”¨æˆ·åŠ å…¥dockerç”¨æˆ·ç»„sudo gpasswd -a $&#123;USER&#125; docker# é‡å¯dockeræœåŠ¡sudo systemctl daemon-reloadsudo systemctl restart docker 6ã€é…ç½®å†…æ ¸å‚æ•°ä¿é™©èµ·è§ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®å†…æ ¸å‚æ•°ç¡®ä¿dockerçš„ç½‘ç»œæ­£å¸¸ 12345678cat &gt;&gt; /etc/sysctl.conf &lt;&lt;EOFnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1EOFsysctl -preboot 7ã€æµ‹è¯•12345678# å¯åŠ¨dockersudo systemctl start docker# æœ€åæˆ‘ä»¬è¿˜è¦è®¾ç½®ä¸€ä¸‹å¼€æœºå¯åŠ¨sudo systemctl enable docker# è·‘ä¸ªhelloworldçœ‹çœ‹sudo docker run hello-world å¦‚æœæˆåŠŸè¿è¡Œåˆ™è¯´æ˜dockerå®‰è£…æˆåŠŸã€‚","categories":[{"name":"â€Œvirtualization","slug":"â€Œvirtualization","permalink":"https://tinychen.com/categories/%E2%80%8Cvirtualization/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"docker","slug":"docker","permalink":"https://tinychen.com/tags/docker/"}]},{"title":"ä¸ªäººåšå®¢webæœåŠ¡å™¨æ¢ç”¨nginx","slug":"20190829-http-to-nginx","date":"2019-08-29T07:00:00.000Z","updated":"2019-08-29T07:00:00.000Z","comments":true,"path":"20190829-http-to-nginx/","link":"","permalink":"https://tinychen.com/20190829-http-to-nginx/","excerpt":"è®°å½•ä¸€ä¸‹ä¸ªäººåšå®¢çš„webæœåŠ¡å™¨ä»apacheæ¢æˆnginxçš„è¿‡ç¨‹ã€‚","text":"è®°å½•ä¸€ä¸‹ä¸ªäººåšå®¢çš„webæœåŠ¡å™¨ä»apacheæ¢æˆnginxçš„è¿‡ç¨‹ã€‚ 0ã€å‰è¨€å…³äºapacheå’Œnginxçš„å¯¹æ¯”æœ‰å¾ˆå¤šï¼Œå°ä¸ƒå°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†ï¼Œä¹‹å‰å¤§ä¸€æ­å»ºåšå®¢çš„æ—¶å€™è¿˜æ²¡æœ‰æ¥è§¦è¿‡nginxå°±ç”¨äº†apacheï¼Œåæ¥è€ƒRHCEçš„æ—¶å€™ä¹Ÿå­¦ä¹ é…ç½®çš„æ˜¯apacheï¼Œæœ€è¿‘å¼€å§‹å­¦ä¹ nginxï¼Œè€ƒè™‘åˆ°å¯¹äºå°ä¸ƒè‡ªå·±çš„é™æ€åšå®¢å’Œæ¸£æ¸£æœåŠ¡å™¨æ€§èƒ½æ¥è¯´ï¼Œnginxåº”è¯¥æ›´åˆé€‚ä¸€äº›ï¼Œå› æ­¤è¿™é‡Œå°±æŠŠwebæœåŠ¡å™¨æ¢æˆäº†nginxã€‚ 1ã€å¤‡ä»½å¿«ç…§åœ¨é˜¿é‡Œäº‘çš„å®˜ç½‘æ§åˆ¶å°é‡Œé¢åˆ›å»ºå¿«ç…§å¤‡ä»½ã€‚å¦‚æœä¸å°å¿ƒç¿»è½¦äº†ï¼Œè¿˜èƒ½ç”¨å¿«ç…§æ¢å¤ã€‚ 2ã€åœç”¨apacheæœåŠ¡123[root@aliyun ~]# systemctl stop httpd.service [root@aliyun ~]# systemctl disable httpd.service Removed symlink /etc/systemd/system/multi-user.target.wants/httpd.service. 3ã€å®‰è£…nginx3.1 å¯¼å…¥yumæº1234567891011cat &gt;&gt; /etc/yum.repo.d/nginx.repo &lt;&lt; EOF[nginx] name=nginx repo baseurl=http://nginx.org/packages/mainline/centos/7/x86_64/gpgcheck=0 enabled=1 EOFyum clean allyum repolistyum install nginx -y è¿™é‡Œå°ä¸ƒä½¿ç”¨çš„æ˜¯nginxæä¾›çš„yumæºï¼Œå› æ­¤ç‰ˆæœ¬å¯èƒ½ä¼šç¨å¾®æ–°ä¸€ç‚¹ã€‚ æƒ³è¦å®‰è£…æœ€æ–°ç‰ˆçš„åŒå­¦å¯ä»¥å‰å¾€å®˜ç½‘ä¸‹è½½æºç è¿›è¡Œç¼–è¯‘å®‰è£…ã€‚ å®˜ç½‘åœ°å€ï¼šhttp://nginx.org/en/download.html 3.2 å¯ç”¨nginxæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨123[root@aliyun ~]# systemctl enable nginx.service Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.[root@aliyun ~]# systemctl start nginx.service è®¿é—®æœåŠ¡å™¨IPã€‚å¯ä»¥çœ‹åˆ°nginxå·²ç»å¼€å§‹å·¥ä½œã€‚ è¿™é‡Œæœ‰å¯èƒ½ä¼šå‡ºç°Failed to read PID from file /run/nginx.pidçš„é”™è¯¯ åŸå› æ˜¯nginxè¿˜æ²¡æœ‰å®Œå…¨å¯åŠ¨ï¼Œsystemdå°±å»è¯»å–è¯¥è¿›ç¨‹çš„PIDå¯¼è‡´æ— æ³•è¯»å–æŠ¥é”™ï¼Œè§£å†³æ–¹æ³•æ˜¯è®©systemdæ™šä¸€ç‚¹è¯»å–ã€‚ 1234567891011mkdir /etc/systemd/system/nginx.service.dcat &gt;&gt; /etc/systemd/system/nginx.service.d/override.conf &lt;&lt; EOF[Service]ExecStartPost=/bin/sleep 0.1EOF# é‡å¯æœåŠ¡å†æ¬¡æŸ¥çœ‹systemctl daemon-reloadsystemctl restart nginx.servicesystemctl status nginx.service 4ã€é…ç½®nginxç”±äºå°ä¸ƒå®‰è£…çš„ç‰ˆæœ¬é‡Œé¢çš„é…ç½®æ–‡ä»¶é»˜è®¤å¹¶æ²¡æœ‰nginxçš„webçš„ç›¸å…³é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€æ¬¡æŠŠhttpã€httpså’Œhttpè‡ªåŠ¨è·³è½¬httpsé…å¥½ã€‚ 4.1 æŸ¥çœ‹ç‰ˆæœ¬ 4.2 é…ç½®httpsä»ç”³è¯·sslè®¤è¯çš„ä¾›åº”å•†é‚£é‡Œä¸‹è½½nginxæœåŠ¡å™¨å¯¹åº”çš„httpsè®¤è¯è¯ä¹¦ï¼Œå¹¶å­˜æ”¾åœ¨/etc/pki/CA/certsç›®å½•ä¸‹ã€‚ï¼ˆå¦‚æœæ²¡æœ‰å°±æ–°å»ºè¯¥ç›®å½•ï¼‰ å¦‚æœä¸çŸ¥é“æ€ä¹ˆç”³è¯·çš„å¯ä»¥æŸ¥çœ‹è¿™ç¯‡åšå®¢ï¼š é˜¿é‡Œäº‘è½»é‡çº§åº”ç”¨æœåŠ¡å™¨CentOSç³»ç»ŸApacheé…ç½®Https 4.3 ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼šè¿™é‡Œå°ä¸ƒç›´æ¥æ”¾å‡ºæ•´ä¸ªé…ç½®æ–‡ä»¶ç»™å¤§å®¶å‚è€ƒï¼š é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½äº/etc/nginx/nginx.conf 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879# æ‰§è¡Œè¿›ç¨‹æ“ä½œçš„ç”¨æˆ·ï¼Œé»˜è®¤nginxuser nginx;# è¿™é‡Œçš„æ•°å­—æœ€å¥½è®¾ç½®æˆå’Œè‡ªå·±æœåŠ¡çš„æ ¸å¿ƒæ•°ä¸€æ ·worker_processes 1;error_log /var/log/nginx/error.log warn;pid /var/run/nginx.pid;events &#123; worker_connections 1024;&#125;http &#123; include /etc/nginx/mime.types; default_type application/octet-stream; log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27; &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27; &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf;# Settings for a TLS enabled server.# è¿™é‡Œæˆ‘ä»¬æŠŠ80å’Œ443ç«¯å£ä¸€èµ·é…ç½® server &#123; listen 80 default_server; listen 443 ssl; listen [::]:443 ssl; # è¿™é‡Œå¡«å†™è‡ªå·±çš„åŸŸå server_name tiny777.com www.tiny777.com; # åˆ¤æ–­ç«¯å£ï¼Œå¦‚æœæ˜¯httpçš„80ç«¯å£å°±è·³è½¬åˆ°httpsçš„443ç«¯å£ if ($server_port = 80) &#123; #return 301 https://$server_name$request_uri; return 301 https://$host$request_uri; &#125; # è¿™é‡Œæ˜¯å¯¹åº”çš„htmlæ–‡ä»¶çš„ç›®å½• root /etc/nginx/html; index index.html index.htm; # è¿™é‡Œæ˜¯httpsè¯ä¹¦çš„å¯†é’¥å’Œè¯ä¹¦å­˜æ”¾ä½ç½® ssl_certificate &quot;/etc/pki/CA/certs/tiny777.com.pem&quot;; ssl_certificate_key &quot;/etc/pki/CA/certs/tiny777.com.key&quot;; ssl_session_cache shared:SSL:1m; ssl_session_timeout 10m; # è¿™é‡Œæ˜¯æ”¯æŒçš„åŠ å¯†æ–¹å¼ ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_prefer_server_ciphers on; # Load configuration files for the default server block. include /etc/nginx/default.d/*.conf; location / &#123; root /etc/nginx/html; index index.html index.htm; &#125; error_page 404 /404.html; location = /40x.html &#123; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; &#125; &#125;&#125; æœ€åæˆ‘ä»¬é‡å¯nginxæœåŠ¡ï¼Œå°±èƒ½æŸ¥çœ‹åˆ°åšå®¢å·²ç»å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"}]},{"title":"Ansibleå…¥é—¨åˆè¯•","slug":"20190823-ansible-intro","date":"2019-08-23T07:00:00.000Z","updated":"2019-08-23T07:00:00.000Z","comments":true,"path":"20190823-ansible-intro/","link":"","permalink":"https://tinychen.com/20190823-ansible-intro/","excerpt":"Ansibleçš„åŸºæœ¬æ¦‚å¿µå’Œå…¥é—¨å®‰è£…é…ç½®ã€‚","text":"Ansibleçš„åŸºæœ¬æ¦‚å¿µå’Œå…¥é—¨å®‰è£…é…ç½®ã€‚ 1ã€IntroAnsibleæ˜¯ä¸€æ¬¾ä½¿ç”¨pythonå¼€å‘çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œå®ç°äº†æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ã€‚Ansibleæ˜¯åŸºäºæ¨¡å—å·¥ä½œçš„ï¼Œæœ¬èº«æ²¡æœ‰æ‰¹é‡éƒ¨ç½²çš„èƒ½åŠ›ã€‚çœŸæ­£å…·æœ‰æ‰¹é‡éƒ¨ç½²çš„æ˜¯Ansibleæ‰€è¿è¡Œçš„æ¨¡å—ï¼ŒAnsibleåªæ˜¯æä¾›ä¸€ç§æ¡†æ¶ã€‚ Ansibleé»˜è®¤æ˜¯é€šè¿‡SSHåè®®æ¥è¿œç¨‹è¿æ¥é›†ç¾¤ä¸­çš„å„å°è®¾å¤‡å¹¶è¿›è¡Œç›¸å…³æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦åœ¨ä¸€å°è®¾å¤‡ä¸Šå®‰è£…Ansibleå³å¯ï¼Œå®‰è£…ã€å‡çº§å’Œå¸è½½éƒ½åªéœ€è¦å¯¹ä¸€å°è®¾å¤‡è¿›è¡Œæ“ä½œï¼Œå…¶ä½™çš„è®¾å¤‡ä¸Šé¢å¹¶ä¸ä¼šæœ‰è½¯ä»¶çš„å®‰è£…æ®‹ç•™ä¹‹ç±»çš„é—®é¢˜ã€‚åŒæ—¶ï¼Œç”±äºæ˜¯ä½¿ç”¨çš„SSHè¿æ¥ï¼ŒAnsibleä¹Ÿä¸éœ€è¦åœ¨ç³»ç»Ÿåå°ç»´æŒç›¸å…³è¿›ç¨‹ä¸€ç›´è¿è¡Œã€‚ 2ã€Versionå› ä¸ºAnsibleçš„åªéœ€è¦åœ¨ä¸€å°æœºå™¨ä¸Šå®‰è£…ï¼Œæ‰€ä»¥å®ƒçš„å‡çº§å’Œå¸è½½éƒ½ååˆ†ç®€å•ï¼Œå› æ­¤å¾ˆå¤šäººä¼šé€‰æ‹©å®‰è£…æœ€æ–°ç‰ˆçš„Ansibleç”šè‡³æ˜¯githubä¸Šçš„å¼€å‘ç‰ˆã€‚Ansibleçš„æ›´æ–°å‘¨æœŸéå¸¸çŸ­ï¼Œåªæœ‰å››ä¸ªæœˆï¼Œå› æ­¤å³ä½¿æ˜¯å‡ºç°äº†BUGï¼Œä¹Ÿèƒ½å¾ˆå¿«çš„åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­è§£å†³ã€‚ 3ã€Installåœ¨centos7ä¸Šå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ansible Currently Ansible can be run from any machine with Python 2 (version 2.7) or Python 3 (versions 3.5 and higher) installed. Windows isnâ€™t supported for the control node. This includes Red Hat, Debian, CentOS, macOS, any of the BSDs, and so on. ä»å®˜ç½‘ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆªæ­¢ç›®å‰ï¼ˆ2019.8.23ï¼‰ï¼Œå®‰è£…ansibleéœ€è¦python2.7ä»¥ä¸Šæˆ–è€…æ˜¯python3.5ä»¥ä¸Šç‰ˆæœ¬ã€‚ è¿™é‡Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘é€‰æ‹©äº†epelæºé‡Œé¢çš„python3.6ç‰ˆæœ¬è¿›è¡Œå®‰è£…ï¼Œéœ€è¦å®‰è£…æœ€æ–°çš„python3å¯ä»¥å‚è€ƒè¿™é‡Œã€‚ 12345# é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…epelåº“yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm# å®‰è£…python3.6yum install python36 -y 12# æ¥ç€æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ansibleçš„æœ€æ–°ç‰ˆæœ¬yum list | grep ansible è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€æ–°ç‰ˆæ˜¯2.8.4ï¼Œå®˜ç½‘ä¸Šæ˜¾ç¤ºçš„æœ€æ–°ç‰ˆä¹Ÿæ˜¯2.8ï¼Œè¿™å°±æ²¡é—®é¢˜äº†ã€‚ ç„¶åæˆ‘ä»¬ç›´æ¥å®‰è£… 1yum install ansible -y 4ã€Confå­˜æ”¾ç›®å½•ansibleçš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨/etc/ansibleç›®å½•ä¸‹ï¼š å›¾ä¸­çš„ansible.cfgæ–‡ä»¶å°±æ˜¯å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œé‡Œé¢çš„æ‰€æœ‰é…ç½®éƒ½æ˜¯æ³¨é‡Šæ‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é‡Œé¢æ˜¯æ²¡æœ‰ä»»ä½•é»˜è®¤é…ç½®çš„ã€‚ è¯»å–é¡ºåºansibleè¯»å–é…ç½®æ–‡ä»¶çš„å…ˆåé¡ºåºå¦‚ä¸‹ï¼š ANSIBLE_CONFIG (environment variable if set) ansible.cfg (in the current directory) ~/.ansible.cfg (in the home directory) /etc/ansible/ansible.cfg ansibleä¼šæ ¹æ®ä¸Šè¿°é¡ºåºè¯»å–é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„é…ç½®æ–‡ä»¶å¹¶å¿½ç•¥å‰©ä½™çš„é…ç½®æ–‡ä»¶ã€‚ ansible.cfgé…ç½®æ–‡ä»¶æ˜¯inié…ç½®æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨#å’Œ;ä½œä¸ºæ³¨é‡Šï¼Œä½†æ˜¯å¦‚æœéœ€è¦åœ¨å·²ç»å†™äº†é…ç½®çš„åŒä¸€è¡Œåæ·»åŠ æ³¨é‡Šï¼Œåˆ™åªèƒ½ä½¿ç”¨; 12# some basic default values...inventory = /etc/ansible/hosts ; This points to the file that lists your hosts ansible.cfgè¿™é‡Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬é…åˆgitæ¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œæˆ‘ä»¬åœ¨githubä¸Šé¢åˆ›å»ºä¸€ä¸ªrepoï¼Œç„¶åcloneåˆ°æœ¬åœ°ï¼Œæ¥ç€æŠŠé…ç½®æ–‡ä»¶å’Œä¹‹åä¼šä½¿ç”¨åˆ°çš„playbookéƒ½æ”¾å…¥åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹å†…ã€‚ å…·ä½“çš„gitä½¿ç”¨æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¸åœ¨è¿™é‡Œèµ˜è¿°ã€‚ ansible.cfgæ–‡ä»¶çš„é…ç½®æ¯”è¾ƒç®€å•ï¼š 123456789101112131415161718192021[defaults]# hostsæ–‡ä»¶çš„å­˜æ”¾ä½ç½®inventory = ./hosts# æ‰§è¡Œè¶…çº§å‘½ä»¤çš„ç”¨æˆ·sudo_user = root# ä¼ è¾“æ–¹å¼transport = smart# sshçš„ç«¯å£remote_port = 22# æ‰§è¡Œsudoå‘½ä»¤çš„æ—¶å€™ä½¿ç”¨çš„å‘½ä»¤sudo_exe = sudo# è¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„é»˜è®¤ç”¨æˆ·remote_user = tinychen# logæ—¥å¿—å­˜æ”¾çš„åœ°æ–¹log_path = /var/log/ansible.log# é»˜è®¤ä½¿ç”¨çš„æ¨¡å—module_name = command# é»˜è®¤ä½¿ç”¨çš„shellexecutable = /bin/sh# ä½¿ç”¨rsaå¯†é’¥è¿›è¡ŒéªŒè¯ç™»å½•è€Œä¸æ˜¯å¯†ç private_key_file = /home/tinychen/.ssh/id_rsa hostsæ–‡ä»¶ä¸­æˆ‘ä»¬å¯ä»¥æ·»åŠ éœ€è¦æ§åˆ¶çš„ä¸»æœºçš„IPæˆ–è€…æ˜¯hostname 12[k8s]192.168.100.22[0:6] è¿™é‡Œå› ä¸ºæˆ‘çš„è¢«æ§åˆ¶ä¸»æœºçš„IPåœ°å€æ˜¯è¿ç»­çš„ï¼Œå› æ­¤æˆ‘ç›´æ¥ä½¿ç”¨[]æ¥è¡¨ç¤ºï¼Œè¿™é‡Œçš„k8sæ˜¯è¿™ä¸€å †è¢«æ§åˆ¶ä¸»æœºçš„ç»„åï¼Œä¸€ä¸ªIPå¯ä»¥åŠ å…¥å¤šä¸ªç»„ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªç»„éƒ½ä¸åŠ å…¥ã€‚ 5ã€Testæ¥ä¸‹æ¥æˆ‘ä»¬æ‰§è¡Œå‡ æ¡å‘½ä»¤æ¥æµ‹è¯•ä¸€ä¸‹ å…ˆæ‰§è¡Œä¸€ä¸‹pingæ¨¡å—çœ‹çœ‹èƒ½å¦è¿é€š 1ansible k8s -m ping è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ˆç»“æœå¤ªé•¿æ²¡æœ‰å…¨éƒ¨æˆªå›¾å‡ºæ¥ï¼‰ 1ansible k8s -m command -a &quot;id&quot; å¯ä»¥çœ‹åˆ°è¿™é‡Œå·²ç»æ˜¯é¡ºåˆ©æ‰§è¡Œäº†ã€‚","categories":[{"name":"sre","slug":"sre","permalink":"https://tinychen.com/categories/sre/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"ansible","slug":"ansible","permalink":"https://tinychen.com/tags/ansible/"}]},{"title":"çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«","slug":"20190821-thread-n-process","date":"2019-08-21T07:00:00.000Z","updated":"2019-08-21T07:00:00.000Z","comments":true,"path":"20190821-thread-n-process/","link":"","permalink":"https://tinychen.com/20190821-thread-n-process/","excerpt":"è®°å½•ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ã€‚","text":"è®°å½•ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ã€‚ 1ã€ä½•ä¸ºçº¿ç¨‹çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­èƒ½å¹¶å‘æ‰§è¡Œçš„å®ä½“ï¼Œæ˜¯è¿›ç¨‹çš„ç»„æˆéƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ç³»ç»Ÿè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œè¿è¡Œåœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­,å¹¶ä½¿ç”¨è¿›ç¨‹çš„èµ„æºå’Œç¯å¢ƒã€‚ 2ã€å¼•å…¥çº¿ç¨‹çš„ç†ç”±ä¸ºäº†å‡å°‘ç¨‹åºå¹¶å‘æ‰§è¡Œæ—¶æ‰€ä»˜å‡ºçš„æ—¶ç©ºå¼€é”€ï¼Œä½¿å¾—å¹¶å‘ç²’åº¦æ›´ç»†ã€å¹¶å‘æ€§æ›´å¥½ã€‚ 3ã€ä¸è¿›ç¨‹çš„åŒºåˆ« çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ç»„æˆéƒ¨åˆ† çº¿ç¨‹åˆ‡æ¢è¾ƒå¿« çº¿ç¨‹é€šä¿¡æ˜“äºå®ç° çº¿ç¨‹å¹¶å‘ç¨‹åº¦æ¯”è¿›ç¨‹é«˜ ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹,ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ çº¿ç¨‹çš„åˆ’åˆ†å°ºåº¦å°äºè¿›ç¨‹ï¼Œä½¿å¾—å¤šçº¿ç¨‹ç¨‹åºçš„å¹¶å‘æ€§é«˜ã€‚ è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜å•å…ƒï¼Œè€Œå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ï¼Œä»è€Œæå¤§åœ°æé«˜äº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚ çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸è¿›ç¨‹è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚æ¯ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å…¥å£ã€é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºçš„å‡ºå£ã€‚ä½†æ˜¯çº¿ç¨‹ä¸èƒ½å¤Ÿç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä¾å­˜åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶ã€‚ ä»é€»è¾‘è§’åº¦æ¥çœ‹ï¼Œå¤šçº¿ç¨‹çš„æ„ä¹‰åœ¨äºä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œæœ‰å¤šä¸ªæ‰§è¡Œéƒ¨åˆ†å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚ä½†æ“ä½œç³»ç»Ÿå¹¶æ²¡æœ‰å°†å¤šä¸ªçº¿ç¨‹çœ‹åšå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œæ¥å®ç°è¿›ç¨‹çš„è°ƒåº¦å’Œç®¡ç†ä»¥åŠèµ„æºåˆ†é…ã€‚è¿™å°±æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹çš„é‡è¦åŒºåˆ«ã€‚ è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ã€‚ çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“,æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½,å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ã€‚ çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æº,åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨,ä¸€ç»„å¯„å­˜å™¨å’Œæ ˆ),ä½†æ˜¯çº¿ç¨‹å¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–çš„çº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºã€‚ ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå’Œæ’¤é”€å¦ä¸€ä¸ªçº¿ç¨‹;åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚ è¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸»è¦å·®åˆ«åœ¨äºå®ƒä»¬æ˜¯ä¸åŒçš„æ“ä½œç³»ç»Ÿèµ„æºç®¡ç†æ–¹å¼ã€‚ è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“ï¼Œè€Œçº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„ã€‚ çº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ï¼Œä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰ï¼Œæ‰€ä»¥å¤šè¿›ç¨‹çš„ç¨‹åºè¦æ¯”å¤šçº¿ç¨‹çš„ç¨‹åºå¥å£®ï¼Œä½†åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œè€—è´¹èµ„æºè¾ƒå¤§ï¼Œæ•ˆç‡è¦å·®ä¸€äº›ã€‚ä½†å¯¹äºä¸€äº›è¦æ±‚åŒæ—¶è¿›è¡Œå¹¶ä¸”åˆè¦å…±äº«æŸäº›å˜é‡çš„å¹¶å‘æ“ä½œï¼Œåªèƒ½ç”¨çº¿ç¨‹ï¼Œä¸èƒ½ç”¨è¿›ç¨‹ã€‚ https://www.zhihu.com/question/25532384 é¦–å…ˆæ¥ä¸€å¥æ¦‚æ‹¬çš„æ€»è®ºï¼šè¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªæ—¶é—´æ®µçš„æè¿°ï¼Œæ˜¯CPUå·¥ä½œæ—¶é—´æ®µçš„æè¿°ã€‚ ä¸‹é¢ç»†è¯´èƒŒæ™¯ï¼šCPU+RAM+å„ç§èµ„æºï¼ˆæ¯”å¦‚æ˜¾å¡ï¼Œå…‰é©±ï¼Œé”®ç›˜ï¼ŒGPS, ç­‰ç­‰å¤–è®¾ï¼‰æ„æˆæˆ‘ä»¬çš„ç”µè„‘ï¼Œä½†æ˜¯ç”µè„‘çš„è¿è¡Œï¼Œå®é™…å°±æ˜¯CPUå’Œç›¸å…³å¯„å­˜å™¨ä»¥åŠRAMä¹‹é—´çš„äº‹æƒ…ã€‚ ä¸€ä¸ªæœ€æœ€åŸºç¡€çš„äº‹å®ï¼šCPUå¤ªå¿«ï¼Œå¤ªå¿«ï¼Œå¤ªå¿«äº†ï¼Œå¯„å­˜å™¨ä»…ä»…èƒ½å¤Ÿè¿½çš„ä¸Šä»–çš„è„šæ­¥ï¼ŒRAMå’Œåˆ«çš„æŒ‚åœ¨å„æ€»çº¿ä¸Šçš„è®¾å¤‡å®Œå…¨æ˜¯æœ›å…¶é¡¹èƒŒã€‚é‚£å½“å¤šä¸ªä»»åŠ¡è¦æ‰§è¡Œçš„æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿè½®æµç€æ¥?æˆ–è€…è°ä¼˜å…ˆçº§é«˜è°æ¥ï¼Ÿä¸ç®¡æ€ä¹ˆæ ·çš„ç­–ç•¥ï¼Œä¸€å¥è¯å°±æ˜¯åœ¨CPUçœ‹æ¥å°±æ˜¯è½®æµç€æ¥ã€‚ ä¸€ä¸ªå¿…é¡»çŸ¥é“çš„äº‹å®ï¼šæ‰§è¡Œä¸€æ®µç¨‹åºä»£ç ï¼Œå®ç°ä¸€ä¸ªåŠŸèƒ½çš„è¿‡ç¨‹ä»‹ç» ï¼Œå½“å¾—åˆ°CPUçš„æ—¶å€™ï¼Œç›¸å…³çš„èµ„æºå¿…é¡»ä¹Ÿå·²ç»å°±ä½ï¼Œå°±æ˜¯æ˜¾å¡å•Šï¼ŒGPSå•Šä»€ä¹ˆçš„å¿…é¡»å°±ä½ï¼Œç„¶åCPUå¼€å§‹æ‰§è¡Œã€‚è¿™é‡Œé™¤äº†CPUä»¥å¤–æ‰€æœ‰çš„å°±æ„æˆäº†è¿™ä¸ªç¨‹åºçš„æ‰§è¡Œç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€å®šä¹‰çš„ç¨‹åºä¸Šä¸‹æ–‡ã€‚å½“è¿™ä¸ªç¨‹åºæ‰§è¡Œå®Œäº†ï¼Œæˆ–è€…åˆ†é…ç»™ä»–çš„CPUæ‰§è¡Œæ—¶é—´ç”¨å®Œäº†ï¼Œé‚£å®ƒå°±è¦è¢«åˆ‡æ¢å‡ºå»ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡CPUçš„ä¸´å¹¸ã€‚åœ¨è¢«åˆ‡æ¢å‡ºå»çš„æœ€åä¸€æ­¥å·¥ä½œå°±æ˜¯ä¿å­˜ç¨‹åºä¸Šä¸‹æ–‡ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯ä¸‹æ¬¡ä»–è¢«CPUä¸´å¹¸çš„è¿è¡Œç¯å¢ƒï¼Œå¿…é¡»ä¿å­˜ã€‚ ä¸²è”èµ·æ¥çš„äº‹å®ï¼šå‰é¢è®²è¿‡åœ¨CPUçœ‹æ¥æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„è½®æµæ‰§è¡Œçš„ï¼Œå…·ä½“çš„è½®æµæ–¹æ³•å°±æ˜¯ï¼šè¿›ç¨‹å’Œçº¿ç¨‹ï¼Œä¸¤ä¸ªåè¯ä¸è¿‡æ˜¯å¯¹åº”çš„CPUæ—¶é—´æ®µçš„æè¿°ï¼Œåè¯å°±æ˜¯è¿™æ ·çš„åŠŸèƒ½ã€‚ çº¿ç¨‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿›ç¨‹çš„é¢—ç²’åº¦å¤ªå¤§ï¼Œæ¯æ¬¡éƒ½è¦æœ‰ä¸Šä¸‹çš„è°ƒå…¥ï¼Œä¿å­˜ï¼Œè°ƒå‡ºã€‚å¦‚æœæˆ‘ä»¬æŠŠè¿›ç¨‹æ¯”å–»ä¸ºä¸€ä¸ªè¿è¡Œåœ¨ç”µè„‘ä¸Šçš„è½¯ä»¶ï¼Œé‚£ä¹ˆä¸€ä¸ªè½¯ä»¶çš„æ‰§è¡Œä¸å¯èƒ½æ˜¯ä¸€æ¡é€»è¾‘æ‰§è¡Œçš„ï¼Œå¿…å®šæœ‰å¤šä¸ªåˆ†æ”¯å’Œå¤šä¸ªç¨‹åºæ®µï¼Œå°±å¥½æ¯”è¦å®ç°ç¨‹åºAï¼Œå®é™…åˆ†æˆ aï¼Œbï¼Œcç­‰å¤šä¸ªå—ç»„åˆè€Œæˆã€‚é‚£ä¹ˆè¿™é‡Œå…·ä½“çš„æ‰§è¡Œå°±å¯èƒ½å˜æˆï¼š ç¨‹åºAå¾—åˆ°CPU =ã€‹CPUåŠ è½½ä¸Šä¸‹æ–‡ï¼Œå¼€å§‹æ‰§è¡Œç¨‹åºAçš„aå°æ®µï¼Œç„¶åæ‰§è¡ŒAçš„bå°æ®µï¼Œç„¶åå†æ‰§è¡ŒAçš„cå°æ®µï¼Œæœ€åCPUä¿å­˜Açš„ä¸Šä¸‹æ–‡ã€‚ è¿™é‡Œaï¼Œbï¼Œcçš„æ‰§è¡Œæ˜¯å…±äº«äº†Açš„ä¸Šä¸‹æ–‡ï¼ŒCPUåœ¨æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„ã€‚è¿™é‡Œçš„aï¼Œbï¼Œcå°±æ˜¯çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ˜¯å…±äº«äº†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ç¯å¢ƒçš„æ›´ä¸ºç»†å°çš„CPUæ—¶é—´æ®µã€‚åˆ°æ­¤å…¨æ–‡ç»“æŸï¼Œå†ä¸€ä¸ªæ€»ç»“ï¼šè¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªæ—¶é—´æ®µçš„æè¿°ï¼Œæ˜¯CPUå·¥ä½œæ—¶é—´æ®µçš„æè¿°ï¼Œä¸è¿‡æ˜¯é¢—ç²’å¤§å°ä¸åŒã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"os","slug":"os","permalink":"https://tinychen.com/tags/os/"}]},{"title":"ä½¿ç”¨pythonå¯¼å‡ºåä¸ºç½‘ç»œè®¾å¤‡ä¸­çš„é…ç½®ä¸ºexcelæ–‡ä»¶","slug":"20190816-hw-auto-get-profile","date":"2019-08-16T09:00:00.000Z","updated":"2019-08-16T09:00:00.000Z","comments":true,"path":"20190816-hw-auto-get-profile/","link":"","permalink":"https://tinychen.com/20190816-hw-auto-get-profile/","excerpt":"é¡¹ç›®githubåœ°å€ï¼šhttps://github.com/tiny777/ServersManagementTools","text":"é¡¹ç›®githubåœ°å€ï¼šhttps://github.com/tiny777/ServersManagementTools 0ã€æ¦‚è¿°è¿™ä¸ªè„šæœ¬éœ€è¦å®ç°çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯è‡ªåŠ¨sshç™»å½•åˆ°ç½‘ç»œè®¾å¤‡ä¸Šï¼ŒæŸ¥è¯¢ç›¸åº”çš„ç™½åå•ï¼Œç„¶åå°†ç»“æœå¯¼å‡ºæˆexcelè¡¨æ ¼ï¼Œå…·ä½“çš„æ“ä½œå‘½ä»¤å¦‚ä¸‹ï¼Œå¯¹åº”çš„è®¾å¤‡æ˜¯åä¸ºçš„AC6605ã€‚ 1234567891011æ“ä½œæ­¥éª¤# æ‰§è¡Œå‘½ä»¤system-viewï¼Œè¿›å…¥ç³»ç»Ÿè§†å›¾ã€‚system-view# æ‰§è¡Œå‘½ä»¤wlanï¼Œè¿›å…¥WLANè§†å›¾ã€‚wlan# æŸ¥çœ‹ç‰¹å®šç™½åå•å†…çš„ä¿¡æ¯display sta-whitelist-profile name profilename ç”±äºè¿™é‡Œä½¿ç”¨çš„æ˜¯netmikoåº“ï¼Œæ‰€ä»¥é™¤äº†åä¸ºçš„ç½‘ç»œè®¾å¤‡ï¼Œæ€ç§‘çš„è®¾å¤‡ä¹Ÿèƒ½æ”¯æŒï¼Œåªéœ€è¦åœ¨ä»£ç æ–‡ä»¶ä¸­ç¨ä½œä¿®æ”¹å³å¯ã€‚ ç›¸åº”çš„å‘½ä»¤ä¹Ÿå¯ä»¥è¿›è¡Œä¿®æ”¹æˆå…¶ä»–çš„ç³»åˆ—å‘½ä»¤ 1ã€è½¯ä»¶ç‰ˆæœ¬eNSPçš„BUGéå¸¸å¤šï¼Œè¿™é‡Œæ­å»ºæ‹“æ‰‘æ¥è¿›è¡Œæµ‹è¯•ä½¿ç”¨çš„è½¯ä»¶ç‰ˆæœ¬æ˜¯ eNSP 1.2.00.500 V100R002C00 VirtualBox Graphical User Interface Version 5.1.26r117224(Qt5.6.2) WinPcap_4_1_3 Wiresharkæ²¡æœ‰ç”¨åˆ°ï¼Œç‰ˆæœ¬åº”è¯¥æ— æ‰€è°“ æ“ä½œç³»ç»Ÿæ˜¯win10 proï¼ŒMicrosoft Windows Version 1903(OS Build 18362.239) 2ã€é…ç½®eNSPæ¡¥æ¥çœŸæœºè¿™é‡Œä½¿ç”¨çš„æ˜¯AC6605ï¼Œå¯¹çœŸæœºè¿›è¡Œæ¡¥æ¥ï¼Œä½¿ç”¨çš„æ¡¥æ¥ç½‘å¡æ˜¯VMware WorkStation 15.1 çš„VMnet8ç½‘å¡ï¼Œå³NATæ¨¡å¼çš„ç½‘å¡ï¼Œä¸æ˜¯eNSPä¸Šé¢çš„192.168.56.1çš„é‚£ä¸ªç½‘å¡ï¼ˆè¿™ä¸ªè€æ˜¯æœ‰é—®é¢˜ï¼Œå„ç§pingä¸åŒï¼‰ã€‚ æ¥ä¸‹æ¥çš„eNSPå†…çš„æ¡¥æ¥é…ç½®å°±ååˆ†ç®€å•äº†ï¼Œæ·»åŠ ä¸€ä¸ªUDPç«¯å£ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªç½‘å¡ï¼Œå†æ·»åŠ ç«¯å£æ˜ å°„ï¼Œå°±å¯ä»¥äº†ã€‚å¯ä»¥å‚è€ƒä¸‹é¢çš„è¿™å¼ å›¾ã€‚ æ¥ç€æˆ‘ä»¬æ‹–å…¥ä¸€ä¸ªè®¾å¤‡ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯åä¸ºçš„AC6605ã€‚ ç»™å®ƒé…ç½®ä¸€ä¸ªIPåœ°å€ç„¶åæµ‹è¯•ä¸€ä¸‹ã€‚ 12345678[AC6605]vlan batch 10Info: This operation may take a few seconds. Please wait for a moment...done.[AC6605]int Vlanif 10[AC6605-Vlanif10]ip address 192.168.59.2 24[AC6605-Vlanif10]q[AC6605]int GigabitEthernet 0/0/1[AC6605-GigabitEthernet0/0/1]port link-type access [AC6605-GigabitEthernet0/0/1]port default vlan 10 ç„¶åæˆ‘ä»¬pingä¸€ä¸‹çœŸæœºçš„ç½‘å¡ï¼Œèƒ½é€šå°±è¯´æ˜æ¡¥æ¥æˆåŠŸäº†ã€‚ 3ã€é…ç½®SSHæœåŠ¡é¦–å…ˆè¿›è¡Œç³»ç»Ÿè§†å›¾ï¼Œç„¶ååˆ›å»ºrsa keyï¼Œå…¨éƒ¨é€‰æ‹©é»˜è®¤ï¼Œæ¥ç€å¯åŠ¨stelnetæœåŠ¡ã€‚ 123system-view rsa local-key-pair createstelnet server enable æ¥ç€é…ç½®ç”¨æ¥è¿œç¨‹çš„ç»ˆç«¯ 1234system-viewuser-interface vty 0 4authentication-mode aaaprotocol inbound ssh ç„¶ååˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®å¯†ç ã€‚ç„¶åå¯åŠ¨sshæœåŠ¡ã€‚ 123456system-view aaalocal-user tinychen password irreversible-cipher easy1234local-user tinychen privilege level 3local-user tinychen service-type sshquit æœ€åå›åˆ°ç³»ç»Ÿè§†å›¾ä¸‹ï¼Œè®¾ç½®sshç”¨æˆ·çš„ç™»å½•æ–¹å¼ä¸ºå¯†ç ç™»å½•ã€‚ 1ssh user tinychen authentication-type password 4ã€ä¿å­˜é…ç½®ä¸Šé¢çš„æ‰€æœ‰é…ç½®å¦‚æœä¸ä¿å­˜ï¼Œå½“å‰çš„ç»ˆç«¯é€€å‡ºå°±ä¼šå¤±æ•ˆï¼Œæ‰€ä»¥è¦è®°å¾—ä¿å­˜é…ç½®ï¼Œæ–¹æ³•æ˜¯é€€åˆ°æœ€å¼€å§‹çš„ç™»å½•è§†å›¾è¾“å…¥saveå°±èƒ½ä¿å­˜äº†ã€‚ 5ã€def sshLoginè¿™é‡Œä½¿ç”¨netmikoæ¥å¯¹ç½‘ç»œè®¾å¤‡è¿›è¡Œsshç™»å½•ï¼Œè€ƒè™‘åˆ°è·å–åˆ°çš„ç»“æœæ˜¯åŒ…å«äº†å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰å¥—æ¥å­—ï¼Œå› æ­¤å¾—åˆ°ç»“æœä¹‹åï¼Œå…ˆå°†å…¶å…¨éƒ¨å†™å…¥ä¸€ä¸ªdebug.logæ–‡ä»¶ä¸­ä¿å­˜è®°å½•ï¼Œå†å°†è¯¥æ¬¡çš„æ“ä½œç»“æœå†™å…¥cacheæ–‡ä»¶ç”¨äºä¸‹ä¸€æ­¥å¤„ç†ã€‚ 6ã€def sort_to_csvå¯¹äºè¾“å‡ºçš„ç»“æœè¿›è¡Œç­›é€‰å¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°reåº“çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥åŠsplit()ï¼Œå› ä¸ºå¤§å¤šæ•°çš„è¾“å‡ºç»“æœæ˜¯ä»¥ç©ºæ ¼æ¥åˆ†åˆ—çš„ï¼Œå› æ­¤ä½¿ç”¨split()æ¥å¤„ç†è¿™äº›å­—ç¬¦æ˜¯æœ€å¥½ä¸è¿‡çš„äº†ã€‚ æœ€åå¯¼å‡ºæˆcsvæ–‡ä»¶è€Œä¸æ˜¯ç›´æ¥å¯¼å‡ºexcelçš„xlsxæ–‡ä»¶åˆ™æ˜¯å› ä¸ºcsvç›¸æ¯”xlsxæ›´å®¹æ˜“è¯»å–å¤„ç†ï¼Œè½¬æˆå…¶ä»–æ ¼å¼ä¹Ÿæ›´åŠ æ–¹ä¾¿ã€‚ 7ã€def csv_to_xlsx_pdè¿™é‡Œå°±æ˜¯ä½¿ç”¨pandasåº“æ¥å°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„csvè½¬ä¸ºxlsxæ–‡ä»¶äº†ï¼Œéå¸¸çš„ç®€å•ï¼Œéœ€è¦çš„æ³¨æ„çš„å°±æ˜¯æ·»åŠ çš„è¡Œåå’Œåˆ—åå‚æ•°ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"},{"name":"python","slug":"python","permalink":"https://tinychen.com/tags/python/"}]},{"title":"åœ¨k8sä¸­åˆ é™¤å’Œæ·»åŠ èŠ‚ç‚¹çš„æ–¹æ³•","slug":"20190801-k8s-del-n-add-node","date":"2019-08-01T02:00:00.000Z","updated":"2019-08-01T02:00:00.000Z","comments":true,"path":"20190801-k8s-del-n-add-node/","link":"","permalink":"https://tinychen.com/20190801-k8s-del-n-add-node/","excerpt":"ç®€å•ä»‹ç»ä¸€ä¸‹åœ¨k8sé›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹å’Œæ·»åŠ èŠ‚ç‚¹çš„æ–¹æ³•ã€‚","text":"ç®€å•ä»‹ç»ä¸€ä¸‹åœ¨k8sé›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹å’Œæ·»åŠ èŠ‚ç‚¹çš„æ–¹æ³•ã€‚ 1ã€åˆ é™¤èŠ‚ç‚¹å¦‚æœéœ€è¦åœ¨k8sé›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹ï¼Œé¦–å…ˆéœ€è¦åœ¨masterèŠ‚ç‚¹ä¸Šåˆ é™¤è¯¥èŠ‚ç‚¹çš„ç›¸å…³æ•°æ®ï¼Œå†åˆ é™¤è¯¥èŠ‚ç‚¹ï¼Œæ¥ç€åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿›è¡Œresetæ“ä½œï¼Œæ¥ç€åˆ é™¤ç›¸å…³æ–‡ä»¶ã€‚ åœ¨masterèŠ‚ç‚¹ä¸Š123# å…¶ä¸­&lt; node name &gt;æ˜¯åœ¨k8sé›†ç¾¤ä¸­ä½¿ç”¨&lt; kubectl get nodes &gt;æŸ¥è¯¢åˆ°çš„èŠ‚ç‚¹åç§°kubectl drain &lt;node name&gt; --delete-local-data --force --ignore-daemonsetskubectl delete node &lt;node name&gt; åœ¨éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸Š12# é‡ç½®k8ssudo kubeadm reset 123456# åˆ é™¤æ®‹ç•™çš„æ–‡ä»¶sudo rm -rf /etc/kubernetes/# æ¸…é™¤iptablesæˆ–è€…ipvsçš„é…ç½®sudo iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -Xsudo ipvsadm --clear å¦‚æœåˆ é™¤çš„æ˜¯masterèŠ‚ç‚¹ï¼Œè¿˜éœ€è¦åˆ é™¤ç”¨æˆ·ç›®å½•ä¸‹çš„.kubeæ–‡ä»¶ 1rm -rf ~/.kube æœ€åé‡å¯è®¾å¤‡å®Œæˆæ“ä½œã€‚ 2ã€æ·»åŠ èŠ‚ç‚¹ç”Ÿæˆtokenä¸€èˆ¬æ¥è¯´åœ¨k8sé›†ç¾¤åˆå§‹åŒ–å®Œæˆçš„æ—¶å€™ï¼Œä¼šè¾“å‡ºä¸€æ¡tokenæ¥è®©æˆ‘ä»¬æ·»åŠ å…¶ä»–çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯è¿™ä¸ªtokençš„æœ‰æ•ˆæ—¶é—´åªæœ‰24å°æ—¶ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·æŸ¥è¯¢tokenã€‚ 1234# æŸ¥è¯¢tokenkubeadm token list# åˆ›å»ºä¸€ä¸ªtokenkubeadm token create è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ttlå€¼å°±æ˜¯è¿™ä¸ªtokenå¯¹åº”çš„æœ‰æ•ˆæ—¶é—´äº† ç”Ÿæˆsha256åŠ å¯†å­—ç¬¦ä¸²é™¤äº†tokenä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªsha256çš„åŠ å¯†å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥è¿™æ ·è·å¾— 1openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#x27;s/^.* //&#x27; æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æŠŠnodeèŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤ä¸­äº† å‘½ä»¤çš„æ ¼å¼å¦‚ä¸‹ï¼š 1kubeadm join &lt;é›†ç¾¤masterèŠ‚ç‚¹IPï¼šç«¯å£&gt; --token &lt;token&gt; --discovery-token-ca-cert-hash sha256:&lt;sha256&gt; å¯¹åº”åˆ°å°ä¸ƒè¿™é‡Œçš„æ“ä½œå‘½ä»¤å¦‚ä¸‹ï¼š 12kubeadm join kubernetes.haproxy.com:8443 --token d98xt5.6xvz7nldv2niknnv \\ --discovery-token-ca-cert-hash sha256:ae8d99e389a6a3109c188b5c27792c490e6a18e438bb4fc81a0a44b9542f3835 æ¥ç€æˆ‘ä»¬åœ¨masterèŠ‚ç‚¹ä¸­å°±å¯ä»¥æŸ¥çœ‹åˆ°æ–°æ·»åŠ çš„è¿™ä¸ªèŠ‚ç‚¹äº†ã€‚","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"}]},{"title":"shellç®€ä»‹","slug":"20190724-shell-intro","date":"2019-07-24T02:00:00.000Z","updated":"2019-07-24T02:00:00.000Z","comments":true,"path":"20190724-shell-intro/","link":"","permalink":"https://tinychen.com/20190724-shell-intro/","excerpt":"ç®€å•ä»‹ç»ä¸€ä¸‹shellçš„æ¦‚å¿µã€åˆ†ç±»ä»¥åŠè„šæœ¬çš„å‡ ç§æ‰§è¡Œæ–¹å¼ã€‚","text":"ç®€å•ä»‹ç»ä¸€ä¸‹shellçš„æ¦‚å¿µã€åˆ†ç±»ä»¥åŠè„šæœ¬çš„å‡ ç§æ‰§è¡Œæ–¹å¼ã€‚ 1ã€ä»€ä¹ˆæ˜¯shellShellçš„ä¸­æ–‡ç¿»è¯‘åæ˜¯è´å£³çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯è§£é‡Šæ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤åŠç¨‹åºç­‰ï¼Œç”¨æˆ·æ¯è¾“å…¥ä¸€æ¡å‘½ä»¤ï¼ŒShellå°±è§£é‡Šæ‰§è¡Œä¸€æ¡ã€‚è¿™ç§ä»é”®ç›˜ä¸€è¾“å…¥å‘½ä»¤ï¼Œå°±å¯ä»¥ç«‹å³å¾—åˆ°å›åº”çš„å¯¹è¯æ–¹å¼ï¼Œç§°ä¸ºäº¤äº’çš„æ–¹å¼ã€‚ Shellå­˜åœ¨äºæ“ä½œç³»ç»Ÿçš„æœ€å¤–å±‚ï¼Œè´Ÿè´£ä¸ç”¨æˆ·ç›´æ¥å¯¹è¯ï¼ŒæŠŠç”¨æˆ·çš„è¾“å…¥è§£é‡Šç»™æ“ä½œç³»ç»Ÿï¼Œå¹¶å¤„ç†å„ç§å„æ ·çš„æ“ä½œç³»ç»Ÿçš„è¾“å‡ºç»“æœï¼Œç„¶åè¾“å‡ºåˆ°å±å¹•è¿”å›ç»™ç”¨æˆ·ã€‚è¾“å…¥ç³»ç»Ÿç”¨æˆ·åå’Œå¯†ç å¹¶ç™»å½•åˆ°Linuxåçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯ç”±Shellè§£é‡Šä¸æ‰§è¡Œçš„ã€‚ 2ã€ä»€ä¹ˆæ˜¯shellè„šæœ¬å½“å‘½ä»¤æˆ–ç¨‹åºè¯­å¥ä¸åœ¨å‘½ä»¤è¡Œä¸‹æ‰§è¡Œï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªç¨‹åºæ–‡ä»¶æ¥æ‰§è¡Œæ—¶ï¼Œè¯¥ç¨‹åºå°±è¢«ç§°ä¸ºShellè„šæœ¬ã€‚ å¦‚æœåœ¨Shellè„šæœ¬é‡Œå†…ç½®äº†å¾ˆå¤šæ¡å‘½ä»¤ã€è¯­å¥åŠå¾ªç¯æ§åˆ¶ï¼Œç„¶åå°†è¿™äº›å‘½ä»¤ä¸€æ¬¡æ€§æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ç§é€šè¿‡æ–‡ä»¶æ‰§è¡Œè„šæœ¬çš„æ–¹å¼ç§°ä¸ºéäº¤äº’çš„æ–¹å¼ã€‚Shelè„šæœ¬ç±»ä¼¼äºDOSæˆ–windowsç³»ç»Ÿä¸‹çš„æ‰¹å¤„ç†ç¨‹åºï¼ˆæ‰©å±•åä¸€èˆ¬ä¸ºâ€œ*.batâ€ï¼‰ã€‚ç”¨æˆ·å¯ä»¥åœ¨Shellè„šæœ¬ä¸­æ•²å…¥ä¸€ç³»åˆ—çš„å‘½ä»¤åŠå‘½ä»¤è¯­å¥ç»„åˆã€‚è¿™äº›å‘½ä»¤ã€å˜é‡å’Œæµç¨‹æ§åˆ¶è¯­å¥ç­‰æœ‰æœºåœ°ç»“åˆèµ·æ¥ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„Shellè„šæœ¬ã€‚ æ¯”å¦‚ä¸‹é¢çš„è¿™ä¸ªè„šæœ¬ï¼Œå°±æ˜¯ç”¨æ¥æ¸…ç©ºlogæ—¥å¿—ä¸­çš„messagesæ–‡ä»¶ 1234567#! /bin/bashcd /var/logcat /dev/null &gt; messagesecho &quot;Logs clean up done&quot; ä¸Šé¢çš„è¿™ä¸ªè„šæœ¬å°±æ˜¯æœ€ç®€å•çš„ç”±å‘½ä»¤ç›´æ¥å †ç Œè€Œæˆçš„è„šæœ¬æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè„šæœ¬åœ¨æ‰§è¡Œçš„æ—¶å€™å¯èƒ½ä¼šæœ‰æƒé™é™åˆ¶ï¼Œä¸€èˆ¬éœ€è¦ä½¿ç”¨chmod +xç»™è„šæœ¬åŠ æ‰§è¡Œæƒé™ï¼Œè¿˜å¯èƒ½éœ€è¦åˆ‡æ¢åˆ°rootç”¨æˆ·æˆ–è€…ä½¿ç”¨sudoã€‚ å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„è„šæœ¬å…¶å®ä¸€æ¡å‘½ä»¤å°±èƒ½è§£å†³ 1cat /dev/null &gt; /var/log/messages &amp;&amp; echo &quot;Logs clean up done&quot; æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ä¸Šé¢çš„è„šæœ¬è¿›è¡Œæ”¹è¿›ï¼ŒåŠ å…¥æ‰§è¡Œç”¨æˆ·å’Œåˆ‡æ¢ç›®å½•çš„åˆ¤æ–­ä»¥åŠæ ¹æ®æ‰§è¡Œç»“æœè¿”å›ä¸åŒçš„ä¿¡æ¯ã€‚ 12345678910111213141516171819202122232425262728293031#! /bin/bash# A shell script that use to clean the system&#x27;s logs.CLEAN_DIR=/var/log# $UID=0 means the user must be rootROOT_UID=0# This script need the root to execute# We have to judge whether the user is root or not# If not, echo warning and then exitif [&quot;$UID&quot; -ne &quot;$ROOT_UID&quot;] then echo &quot; Must be root to execute this script &quot; exit 1if# If change directory fail, give the tip and then exitcd $CLEAN_DIR || &#123; echo &quot;Cannot change to necessary directory&quot; exit 1&#125;# Begin to clean the log # Echo the tips whether it success or notcat /dev/null &gt; messages &amp;&amp; &#123; echo &quot;Logs cleaned up&quot; exit 0# eixt 0 means success and exit 1 means fail&#125;echo &quot;Logs cleaned up fail&quot;exit 1 3ã€shellè„šæœ¬è¯­è¨€çš„ç§ç±»Shellè„šæœ¬è¯­è¨€æ˜¯å¼±ç±»å‹è¯­è¨€ï¼ˆæ— é¡»å®šä¹‰å˜é‡çš„ç±»å‹å³å¯ä½¿ç”¨ï¼‰ï¼Œåœ¨Unix/Linuxä¸­ä¸»è¦æœ‰ä¸¤å¤§ç±»Shellï¼šä¸€ç±»æ˜¯Bourne shellï¼Œå¦ä¸€ç±»æ˜¯Cshellã€‚ 3.1 Bourne shellBourne shellåˆåŒ…æ‹¬Bourne shellï¼ˆshï¼‰ã€Korn shellï¼ˆkshï¼‰ã€Bourne Again Shellï¼ˆbashï¼‰ä¸‰ç§ç±»å‹ã€‚ Bourne shellï¼ˆshï¼‰ç”±AT&amp;Tçš„Steve Bourneå¼€å‘ï¼Œæ˜¯æ ‡å‡†çš„UNIX Shellï¼Œå¾ˆå¤šUNIXç³»ç»Ÿéƒ½é…æœ‰shã€‚ Korn shellï¼ˆkshï¼‰ç”±David Kornå¼€å‘ï¼Œæ˜¯Bourne shellï¼ˆshï¼‰çš„è¶…é›†åˆï¼Œå¹¶ä¸”æ·»åŠ äº†cshå¼•å…¥çš„æ–°åŠŸèƒ½ï¼Œæ˜¯ç›®å‰å¾ˆå¤šUNIXç³»ç»Ÿæ ‡å‡†é…ç½®çš„Shellï¼Œè¿™äº›ç³»ç»Ÿä¸Šçš„/bin/shå¾€å¾€æ˜¯æŒ‡å‘/bin/kshçš„ç¬¦å·é“¾æ¥ã€‚ Bourne Again Shellï¼ˆbashï¼‰ç”±GNUé¡¹ç›®ç»„å¼€å‘ï¼Œä¸»è¦ç›®æ ‡æ˜¯ä¸POSIXæ ‡å‡†ä¿æŒä¸€è‡´ï¼ŒåŒæ—¶å…¼é¡¾å¯¹shçš„å…¼å®¹ï¼Œbashä»cshå’Œkshå€Ÿé‰´äº†å¾ˆå¤šåŠŸèƒ½ï¼Œæ˜¯å„ç§Linuxå‘è¡Œç‰ˆé»˜è®¤é…ç½®çš„Shellï¼ŒLinuxç³»ç»Ÿä¸Šçš„/bin/shå¾€å¾€æ˜¯æŒ‡å‘/bin/bashçš„ç¬¦å·é“¾æ¥ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œbashå’Œshè¿˜æ˜¯æœ‰å¾ˆå¤šçš„ä¸åŒä¹‹å¤„ï¼šä¸€æ–¹é¢ï¼Œbashæ‰©å±•äº†ä¸€äº›å‘½ä»¤å’Œå‚æ•°ï¼›å¦ä¸€æ–¹é¢ï¼Œbashå¹¶ä¸å®Œå…¨å’Œshå…¼å®¹ï¼Œå®ƒä»¬æœ‰äº›è¡Œä¸ºå¹¶ä¸ä¸€è‡´ï¼Œä½†åœ¨å¤§å¤šæ•°ä¼ä¸šè¿ç»´çš„æƒ…å†µä¸‹åŒºåˆ«ä¸å¤§ï¼Œç‰¹æ®Šåœºæ™¯å¯ä»¥ä½¿ç”¨bashæ›¿ä»£shã€‚ åœ¨Linuxä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨çš„shellæ˜¯bashï¼Œæ‰€ä»¥è¯´bashå…¶å®æ˜¯shellçš„ä¸€ä¸ªå­é›†ï¼Œå½“ç„¶ä¹Ÿè¿˜æœ‰å…¶ä»–çš„ä¸€äº›æµè¡Œçš„shellå·¥å…·ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦Linuxä¸­çš„ä¸€ä¸ªç”¨æˆ·æ— æ³•ç™»å½•ä½¿ç”¨shelläº¤äº’ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯åœ¨/etc/passwdæ–‡ä»¶ä¸­è®¾ç½®è¯¥ç”¨æˆ·çš„é»˜è®¤shellä¸º/sbin/nologinå³å¯ã€‚ 3.2 CshellCshelåˆåŒ…æ‹¬cshã€tcshä¸¤ç§ç±»å‹ã€‚ cshç”±Berkeleyå¤§å­¦å¼€å‘ï¼ŒéšBSDUNIXå‘å¸ƒï¼Œå®ƒçš„æµç¨‹æ§åˆ¶è¯­å¥å¾ˆåƒCè¯­è¨€ï¼Œæ”¯æŒå¾ˆå¤šBourne shellæ‰€ä¸æ”¯æŒçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šä½œä¸šæ§åˆ¶ã€åˆ«åã€ç³»ç»Ÿç®—æœ¯ã€å‘½ä»¤å†å²ã€å‘½ä»¤è¡Œç¼–è¾‘ç­‰ã€‚ tcshæ˜¯cshçš„å¢å¼ºç‰ˆï¼ŒåŠ å…¥äº†å‘½ä»¤è¡¥å…¨ç­‰åŠŸèƒ½ï¼Œåœ¨FreeBSDã€Mac OSXç­‰ç³»ç»Ÿä¸Šæ›¿ä»£äº†cshã€‚ 3.3 shellç›®å‰å½¢åŠ¿ä»¥ä¸Šä»‹ç»çš„è¿™äº›Shellä¸­ï¼Œè¾ƒä¸ºé€šç”¨çš„æ˜¯æ ‡å‡†çš„Bourne shellï¼ˆshï¼‰å’ŒCshellï¼ˆcshï¼‰ã€‚å…¶ä¸­Bourne shellï¼ˆshï¼‰å·²ç»è¢«Bourne Again shellï¼ˆbashï¼‰æ‰€å–ä»£ã€‚ Linuxç³»ç»Ÿä¸­çš„ä¸»æµShellæ˜¯bashï¼Œbashæ˜¯ç”±Bourne Shellï¼ˆshï¼‰å‘å±•è€Œæ¥çš„ï¼ŒåŒæ—¶bashè¿˜åŒ…å«äº†cshå’Œkshçš„ç‰¹è‰²ï¼Œä½†å¤§å¤šæ•°è„šæœ¬éƒ½å¯ä»¥ä¸åŠ ä¿®æ”¹åœ°åœ¨shä¸Šè¿è¡Œï¼Œå¦‚æœä½¿ç”¨äº†shåå‘ç°ç»“æœå’Œé¢„æœŸæœ‰å·®å¼‚ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•ç”¨bashæ›¿ä»£shã€‚ Shelè„šæœ¬è¯­è¨€çš„ä¼˜åŠ¿åœ¨äºå¤„ç†åæ“ä½œç³»ç»Ÿåº•å±‚çš„ä¸šåŠ¡ï¼Œä¾‹å¦‚ï¼šLinuxç³»ç»Ÿå†…éƒ¨çš„å¾ˆå¤šåº”ç”¨ï¼ˆæœ‰çš„æ˜¯åº”ç”¨çš„ä¸€éƒ¨åˆ†ï¼‰éƒ½æ˜¯ä½¿ç”¨Shellè„šæœ¬è¯­è¨€å¼€å‘çš„ï¼Œå› ä¸ºæœ‰1000å¤šä¸ªLinuxç³»ç»Ÿå‘½ä»¤ä¸ºå®ƒåšæ”¯æ’‘ï¼Œç‰¹åˆ«æ˜¯Linuxæ­£åˆ™è¡¨è¾¾å¼åŠä¸‰å‰‘å®¢grepã€awkã€sedç­‰å‘½ä»¤ã€‚ å¯¹äºä¸€äº›å¸¸è§çš„ç³»ç»Ÿè„šæœ¬ï¼Œä½¿ç”¨Shellå¼€å‘ä¼šæ›´ç®€å•ã€æ›´å¿«é€Ÿï¼Œä¾‹å¦‚ï¼šè®©è½¯ä»¶ä¸€é”®è‡ªåŠ¨åŒ–å®‰è£…ã€ä¼˜åŒ–ï¼Œç›‘æ§æŠ¥è­¦è„šæœ¬ï¼Œè½¯ä»¶å¯åŠ¨è„šæœ¬ï¼Œæ—¥å¿—åˆ†æè„šæœ¬ç­‰ï¼Œè™½ç„¶PHP/Pythonè¯­è¨€ä¹Ÿèƒ½å¤Ÿåšåˆ°è¿™äº›ï¼Œä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æŒæ¡éš¾åº¦ã€å¼€å‘æ•ˆç‡ã€å¼€å‘ä¹ æƒ¯ç­‰å› ç´ ï¼Œå®ƒä»¬å¯èƒ½å°±ä¸å¦‚Shellè„šæœ¬è¯­è¨€æµè¡ŒåŠæœ‰ä¼˜åŠ¿äº†ã€‚å¯¹äºä¸€äº›å¸¸è§„çš„ä¸šåŠ¡åº”ç”¨ï¼Œä½¿ç”¨Shellæ›´ç¬¦åˆLinuxè¿ç»´ç®€å•ã€æ˜“ç”¨ã€é«˜æ•ˆçš„ä¸‰å¤§åŸºæœ¬åŸåˆ™ã€‚ åœ¨å¸¸ç”¨çš„æ“ä½œç³»ç»Ÿä¸­ï¼ŒLinuxä¸‹é»˜è®¤çš„Shellæ˜¯Bourne Again shellï¼ˆbashï¼‰ï¼›Solariså’ŒFreeBSDä¸‹é»˜è®¤çš„æ˜¯Bourne shellï¼ˆshï¼‰ï¼›AIXä¸‹é»˜è®¤çš„æ˜¯Korn Shellï¼ˆkshï¼‰ã€‚ 4ã€è„šæœ¬çš„æ‰§è¡ŒShellè„šæœ¬çš„æ‰§è¡Œé€šå¸¸å¯ä»¥é‡‡ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼ã€‚ 4.1 bash script-nameæˆ–sh script-nameï¼šè¿™æ˜¯å½“è„šæœ¬æ–‡ä»¶æœ¬èº«æ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼ˆå³æ–‡ä»¶æƒé™å±æ€§xä½ä¸º-å·ï¼‰æ—¶å¸¸ä½¿ç”¨çš„æ–¹æ³•ï¼Œæˆ–è€…è„šæœ¬æ–‡ä»¶å¼€å¤´æ²¡æœ‰æŒ‡å®šè§£é‡Šå™¨æ—¶éœ€è¦ä½¿ç”¨çš„æ–¹æ³•ã€‚ 4.2 path/script-nameæˆ–./script-nameï¼šæŒ‡åœ¨å½“å‰è·¯å¾„ä¸‹æ‰§è¡Œè„šæœ¬ï¼ˆè„šæœ¬éœ€è¦æœ‰æ‰§è¡Œæƒé™ï¼‰ï¼Œéœ€è¦å°†è„šæœ¬æ–‡ä»¶çš„æƒé™å…ˆæ”¹ä¸ºå¯æ‰§è¡Œï¼ˆå³æ–‡ä»¶æƒé™å±æ€§åŠ xä½ï¼‰ï¼Œå…·ä½“æ–¹æ³•ä¸ºchmod +x script-nameã€‚ç„¶åé€šè¿‡è„šæœ¬ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„å°±å¯ä»¥ç›´æ¥æ‰§è¡Œè„šæœ¬äº†ã€‚ 4.3 source script-nameæˆ–.script-nameï¼šè¿™ç§æ–¹æ³•é€šå¸¸æ˜¯ä½¿ç”¨sourceæˆ–.ï¼ˆç‚¹å·ï¼‰è¯»å…¥æˆ–åŠ è½½æŒ‡å®šçš„Shelè„šæœ¬æ–‡ä»¶ï¼ˆå¦‚san.shï¼‰ï¼Œç„¶åï¼Œä¾æ¬¡æ‰§è¡ŒæŒ‡å®šçš„Shellè„šæœ¬æ–‡ä»¶san.shä¸­çš„æ‰€æœ‰è¯­å¥ã€‚è¿™äº›è¯­å¥å°†åœ¨å½“å‰çˆ¶Shellè„šæœ¬father.shè¿›ç¨‹ä¸­è¿è¡Œï¼ˆå…¶ä»–å‡ ç§æ¨¡å¼éƒ½ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹æ‰§è¡Œå­è„šæœ¬ï¼‰ã€‚ å› æ­¤ï¼Œä½¿ç”¨sourceæˆ–.å¯ä»¥å°†san.shè‡ªèº«è„šæœ¬ä¸­çš„å˜é‡å€¼æˆ–å‡½æ•°ç­‰çš„è¿”å›å€¼ä¼ é€’åˆ°å½“å‰çˆ¶Shelè„šæœ¬father.shä¸­ä½¿ç”¨ã€‚è¿™æ˜¯å®ƒå’Œå…¶ä»–å‡ ç§æ–¹æ³•æœ€å¤§çš„åŒºåˆ«ï¼Œä¹Ÿæ˜¯å€¼å¾—è¯»è€…ç‰¹åˆ«æ³¨æ„çš„åœ°æ–¹ã€‚ è¿™é‡Œè¯´èµ·æ¥å¯èƒ½ä¸å¥½ç†è§£ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•è„šæœ¬æ¥æ“ä½œä¸€ä¸‹ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè„šæœ¬çš„ä¸»è¦æ“ä½œæ˜¯ä½¿ç”¨pwdå‘½ä»¤æ‰“å°å‡ºå½“å‰çš„ç›®å½• ç„¶åæˆ‘ä»¬åˆ†åˆ«ç”¨ä¸Šé¢çš„æ–¹æ³•1å’Œè¿™é‡Œçš„æ–¹æ³•3æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨æ–¹æ³•1çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æ‰“å°å‡ºå½“å‰ç›®å½•userdirï¼Œæˆ–è€…è¯´ï¼Œå½“å‰ç›®å½•userdirè¿™ä¸ªå˜é‡ä¸ºç©ºã€‚å†ä½¿ç”¨æ–¹æ³•3æ¥æ‰§è¡Œè¯¥è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ—¶å€™çš„å˜é‡userdirå°±ä¸ä¸ºç©ºäº†ã€‚ ç»“è®ºï¼šé€šè¿‡sourceæˆ–.åŠ è½½æ‰§è¡Œè¿‡çš„è„šæœ¬ï¼Œç”±äºæ˜¯åœ¨å½“å‰Shellä¸­æ‰§è¡Œè„šæœ¬ï¼Œå› æ­¤åœ¨è„šæœ¬ç»“æŸä¹‹åï¼Œè„šæœ¬ä¸­çš„å˜é‡ï¼ˆåŒ…æ‹¬å‡½æ•°ï¼‰å€¼åœ¨å½“å‰Shellä¸­ä¾ç„¶å­˜åœ¨ï¼›è€Œshå’Œbashæ‰§è¡Œè„šæœ¬éƒ½ä¼šå¯åŠ¨æ–°çš„å­Shellæ‰§è¡Œï¼Œæ‰§è¡Œå®Œåé€€å›åˆ°çˆ¶Shellï¼Œå› æ­¤ï¼Œå˜é‡ï¼ˆåŒ…æ‹¬å‡½æ•°ï¼‰å€¼ç­‰æ— æ³•ä¿ç•™ã€‚ å®åœ¨ä¸æ‡‚å°±çœ‹ä¸‹å°ä¸ƒç”»çš„è¿™ä¸ªçµé­‚æµç¨‹å›¾ã€‚ åœ¨è¿›è¡ŒShellè„šæœ¬å¼€å‘æ—¶ï¼Œå¦‚æœè„šæœ¬ä¸­æœ‰å¼•ç”¨æˆ–æ‰§è¡Œå…¶ä»–è„šæœ¬çš„å†…å®¹æˆ–é…ç½®æ–‡ä»¶çš„éœ€æ±‚æ—¶ï¼Œæœ€å¥½ç”¨.â€æˆ–sourceå…ˆåŠ è½½è¯¥è„šæœ¬æˆ–é…ç½®æ–‡ä»¶ï¼Œå¤„ç†å®Œä¹‹åï¼Œå†å°†å®ƒä»¬åŠ è½½åˆ°è„šæœ¬çš„ä¸‹é¢ï¼Œå°±å¯ä»¥è°ƒç”¨sourceåŠ è½½çš„è„šæœ¬åŠé…ç½®æ–‡ä»¶ä¸­çš„å˜é‡åŠå‡½æ•°ç­‰å†…å®¹äº†ã€‚ sourceæˆ–.å‘½ä»¤çš„åŠŸèƒ½æ˜¯ï¼šåœ¨å½“å‰Shellä¸­æ‰§è¡Œsourceæˆ–.åŠ è½½å¹¶æ‰§è¡Œçš„ç›¸å…³è„šæœ¬æ–‡ä»¶ä¸­çš„å‘½ä»¤åŠè¯­å¥ï¼Œè€Œä¸æ˜¯äº§ç”Ÿä¸€ä¸ªå­Shellæ¥æ‰§è¡Œæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚ sourceæˆ–.çš„å®é™…åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯è¯»å…¥è„šæœ¬å¹¶æ‰§è¡Œã€‚ æ³¨æ„.å’Œåé¢çš„è„šæœ¬åä¹‹é—´è¦æœ‰ç©ºæ ¼ã€‚ å¦‚æœå¤§å®¶å­¦è¿‡PHPå¼€å‘å°±çŸ¥é“ï¼Œsourceæˆ–.ç›¸å½“äºincludeçš„åŠŸèƒ½ã€‚HTTPæœåŠ¡è½¯ä»¶Apacheã€Nginxç­‰é…ç½®æ–‡ä»¶é‡Œéƒ½æ”¯æŒè¿™æ ·çš„ç”¨æ³•ã€‚ 4.4 sh&lt;script-nameæˆ–cat scripts-namelshï¼šåŒæ ·é€‚ç”¨äºbashï¼Œä¸è¿‡è¿™ç§ç”¨æ³•ä¸æ˜¯å¾ˆå¸¸è§ã€‚ä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥å®ç°æ‹¼æ¥å­—ç¬¦ä¸²ç­‰éªšæ“ä½œçš„ï¼Œç•™ä¸ªå‘ï¼Œä»¥åæœ‰æœºä¼šå†æ¥è¯•ä¸€ä¸‹ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"}]},{"title":"åœ¨k8sä¸­çš„Serviceç®€ä»‹","slug":"20190723-k8s-service","date":"2019-07-23T07:00:00.000Z","updated":"2019-07-23T07:00:00.000Z","comments":true,"path":"20190723-k8s-service/","link":"","permalink":"https://tinychen.com/20190723-k8s-service/","excerpt":"ç®€å•ä»‹ç»ä¸€ä¸‹k8sä¸­çš„Serviceç»„ä»¶ã€‚","text":"ç®€å•ä»‹ç»ä¸€ä¸‹k8sä¸­çš„Serviceç»„ä»¶ã€‚ 1ã€Serviceç®€ä»‹è€è§„çŸ©ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å®˜ç½‘å¯¹serviceçš„æè¿°ï¼š Kubernetes Pod æ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå®ƒä»¬å¯ä»¥è¢«åˆ›å»ºï¼Œä¹Ÿå¯ä»¥è¢«é”€æ¯ï¼Œç„¶è€Œä¸€æ—¦è¢«é”€æ¯ç”Ÿå‘½å°±æ°¸è¿œç»“æŸã€‚ é€šè¿‡ ReplicaSets èƒ½å¤ŸåŠ¨æ€åœ°åˆ›å»ºå’Œé”€æ¯ Podï¼ˆä¾‹å¦‚ï¼Œéœ€è¦è¿›è¡Œæ‰©ç¼©å®¹ï¼Œæˆ–è€…æ‰§è¡Œ æ»šåŠ¨å‡çº§ï¼‰ã€‚ æ¯ä¸ª Pod éƒ½ä¼šè·å–å®ƒè‡ªå·±çš„ IP åœ°å€ï¼Œå³ä½¿è¿™äº› IP åœ°å€ä¸æ€»æ˜¯ç¨³å®šå¯ä¾èµ–çš„ã€‚ è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šåœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œå¦‚æœä¸€ç»„ Podï¼ˆç§°ä¸º backendï¼‰ä¸ºå…¶å®ƒ Pod ï¼ˆç§°ä¸º frontendï¼‰æä¾›æœåŠ¡ï¼Œé‚£ä¹ˆé‚£äº› frontend è¯¥å¦‚ä½•å‘ç°ï¼Œå¹¶è¿æ¥åˆ°è¿™ç»„ Pod ä¸­çš„å“ªäº› backend å‘¢ï¼Ÿ å…³äº Service Kubernetes Service å®šä¹‰äº†è¿™æ ·ä¸€ç§æŠ½è±¡ï¼šé€»è¾‘ä¸Šçš„ä¸€ç»„ Podï¼Œä¸€ç§å¯ä»¥è®¿é—®å®ƒä»¬çš„ç­–ç•¥ â€”â€” é€šå¸¸ç§°ä¸ºå¾®æœåŠ¡ã€‚ è¿™ä¸€ç»„ Pod èƒ½å¤Ÿè¢« Service è®¿é—®åˆ°ï¼Œé€šå¸¸æ˜¯é€šè¿‡ Label Selectorï¼ˆæŸ¥çœ‹ä¸‹é¢äº†è§£ï¼Œä¸ºä»€ä¹ˆå¯èƒ½éœ€è¦æ²¡æœ‰ selector çš„ Serviceï¼‰å®ç°çš„ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œè€ƒè™‘ä¸€ä¸ªå›¾ç‰‡å¤„ç† backendï¼Œå®ƒè¿è¡Œäº†3ä¸ªå‰¯æœ¬ã€‚è¿™äº›å‰¯æœ¬æ˜¯å¯äº’æ¢çš„ â€”â€” frontend ä¸éœ€è¦å…³å¿ƒå®ƒä»¬è°ƒç”¨äº†å“ªä¸ª backend å‰¯æœ¬ã€‚ ç„¶è€Œç»„æˆè¿™ä¸€ç»„ backend ç¨‹åºçš„ Pod å®é™…ä¸Šå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œfrontend å®¢æˆ·ç«¯ä¸åº”è¯¥ä¹Ÿæ²¡å¿…è¦çŸ¥é“ï¼Œè€Œä¸”ä¹Ÿä¸éœ€è¦è·Ÿè¸ªè¿™ä¸€ç»„ backend çš„çŠ¶æ€ã€‚ Service å®šä¹‰çš„æŠ½è±¡èƒ½å¤Ÿè§£è€¦è¿™ç§å…³è”ã€‚ å¯¹ Kubernetes é›†ç¾¤ä¸­çš„åº”ç”¨ï¼ŒKubernetes æä¾›äº†ç®€å•çš„ Endpoints APIï¼Œåªè¦ Service ä¸­çš„ä¸€ç»„ Pod å‘ç”Ÿå˜æ›´ï¼Œåº”ç”¨ç¨‹åºå°±ä¼šè¢«æ›´æ–°ã€‚ å¯¹é Kubernetes é›†ç¾¤ä¸­çš„åº”ç”¨ï¼ŒKubernetes æä¾›äº†åŸºäº VIP çš„ç½‘æ¡¥çš„æ–¹å¼è®¿é—® Serviceï¼Œå†ç”± Service é‡å®šå‘åˆ° backend Podã€‚ å®˜ç½‘çš„è¿™æ®µè¯å¯èƒ½æœ‰äº›ä¸å¥½ç†è§£ï¼Œæˆ‘ä»¬ç”¨æœ€ç®€å•çš„webæœåŠ¡å™¨è½¯ä»¶apacheä¸¾ä¸ªä¾‹å­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ä¸€å°ç”µè„‘ä¸Šå®‰è£…äº†apacheæœåŠ¡ä¹‹åï¼Œå®ƒé»˜è®¤ç›‘å¬çš„æ˜¯80ç«¯å£ï¼ˆhttpï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¦‚æœéœ€è¦è®¿é—®è¿™ä¸ªapacheæœåŠ¡ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨æµè§ˆå™¨è®¿é—®è¿™å°ç”µè„‘çš„IPåœ°å€åŠ ä¸Š80ç«¯å£å·å³å¯ï¼Œå¯¹äºå…¶ä»–çš„åº”ç”¨ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸€èˆ¬éƒ½æ˜¯ä»¥ä¸»æœºIPåŠ ä¸Šåº”ç”¨çš„ç›‘å¬ç«¯å£æ¥è¿›è¡Œè®¿é—®ã€‚ é‚£ä¹ˆåœ¨k8sçš„é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“åº”ç”¨æœåŠ¡è¢«æ‰“åŒ…æˆå®¹å™¨ï¼Œè€Œå®¹å™¨æ”¾åœ¨podä¸­è¿è¡Œï¼Œæ¯ä¸ªpodéƒ½ä¼šè¢«åˆ†é…åˆ°ä¸€ä¸ªIPåœ°å€ï¼Œå½“ç„¶æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥æŒ‰ç…§ä¸Šè¿°çš„æ–¹å¼æ¥è®¿é—®è¿™äº›podé‡Œé¢çš„æœåŠ¡ï¼Œä½†æ˜¯ï¼Œä¸€ä¸ªåº”ç”¨å¾€å¾€ä¼šéƒ¨ç½²å¤šä¸ªpodï¼ˆä¿è¯å¯é æ€§å’Œå¥å£®æ€§ï¼‰ï¼Œè€Œä¸åŒçš„podä¹Ÿä¼šå› ä¸ºéœ€æ±‚çš„ä¸åŒæˆ–è€…èŠ‚ç‚¹å®•æœºç­‰åŸå› è¢«é”€æ¯æˆ–è€…æ–°å»ºï¼ˆå¯¹åº”åˆæ˜¯æ–°çš„IPï¼‰ï¼Œæ‰€ä»¥k8så®šä¹‰äº†serviceè¿™ä¸€å±‚æŠ½è±¡å±‚ï¼Œç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†åŒä¸€åº”ç”¨ä¸‹çš„ä¸€ç»„podè¿›è¡Œæ‰“åŒ…ï¼Œç„¶åé€šè¿‡serviceæ¥è¿›è¡Œç»Ÿä¸€è®¿é—®ï¼ˆä¸»è¦é€šè¿‡labelæ¥å®ç°ï¼‰ï¼Œç”¨æˆ·åªéœ€è¦è®¿é—®serviceè¿™ä¸€å±‚ï¼Œè€Œä¸éœ€è¦åœ¨æ„serviceä¹‹åçš„podæ˜¯æ€ä¹ˆè°ƒåº¦è¿è¡Œçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œserviceä¼šè´Ÿè´£æŠŠç”¨æˆ·çš„è®¿é—®è¯·æ±‚è½¬å‘åˆ°podå¯¹åº”çš„ç«¯å£ä¸Šï¼Œæˆ–è€…æ˜¯è¯´serviceä¼šå°†podå¯¹åº”çš„ç«¯å£å’Œserviceä¸Šæš´éœ²ç»™ç”¨æˆ·è®¿é—®çš„ç«¯å£å»ºç«‹æ˜ å°„å…³ç³»ã€‚ 2ã€ä½¿ç”¨serviceæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å°è¯•ç€ä½¿ç”¨ä¸€ä¸‹serviceã€‚ é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªpodï¼Œå¯¹åº”çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 1234567891011121314151617apiVersion: apps/v1beta1kind: Deploymentmetadata: name: http-deploymentspec: replicas: 3 template: metadata: labels: app: httpd spec: containers: - image: httpd name: http ports: - containerPort: 80 protocol: TCP éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªlabelsï¼Œä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶åˆ›å»ºçš„podéƒ½ä¼šå¸¦ä¸Šä¸€ä¸ªapp=httpdçš„labelsï¼Œè¿™ä¸ªæ˜¯åé¢åˆ›å»ºçš„serviceç”¨æ¥åŒºåˆ†podçš„ã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨curlç›´æ¥å¯¹éƒ¨ç½²çš„ä¸‰ä¸ªpodè¿›è¡Œè®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°éƒ½æ˜¯èƒ½å¤Ÿè®¿é—®æˆåŠŸçš„ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªserviceï¼Œé…ç½®æ–‡ä»¶å¦‚ä¸‹ 1234567891011kind: ServiceapiVersion: v1metadata: name: http-servicespec: selector: app: httpd ports: - protocol: TCP port: 7777 targetPort: 80 ä¸Šè¿°é…ç½®å°†åˆ›å»ºä¸€ä¸ªåç§°ä¸º â€œhttp-serviceâ€ çš„ Service å¯¹è±¡ï¼Œå®ƒä¼šå°†è¯·æ±‚ä»£ç†åˆ°ä½¿ç”¨ TCP ç«¯å£ 80ï¼Œå¹¶ä¸”å…·æœ‰æ ‡ç­¾(labels) &quot;app=httpd&quot; çš„ Pod ä¸Šã€‚ è¿™ä¸ª Service å°†è¢«æŒ‡æ´¾ä¸€ä¸ª IP åœ°å€ï¼ˆé€šå¸¸ç§°ä¸º â€œCluster IPâ€ï¼‰ï¼Œå®ƒä¼šè¢«æœåŠ¡çš„ä»£ç†ä½¿ç”¨ï¼ˆè§ä¸‹é¢ï¼‰ã€‚ è¯¥ Service çš„ selector å°†ä¼šæŒç»­è¯„ä¼°ï¼Œå¤„ç†ç»“æœå°†è¢« POST åˆ°ä¸€ä¸ªåç§°ä¸º â€œhttp-serviceâ€ çš„ Endpoints å¯¹è±¡ä¸Šã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ Service èƒ½å¤Ÿå°†ä¸€ä¸ªæ¥æ”¶ç«¯å£æ˜ å°„åˆ°ä»»æ„çš„ targetPortã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒtargetPort å°†è¢«è®¾ç½®ä¸ºä¸ port å­—æ®µç›¸åŒçš„å€¼ã€‚ åˆ›å»ºæˆåŠŸä¹‹åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹service 1kubectl get service -o wide è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªserviceè¢«åˆ†é…äº†ä¸€ä¸ª10.96.16.218çš„IPåœ°å€ï¼ˆè¿™ä¸ªIPåœ°å€ç§°ä¸ºClusterIPï¼‰ï¼ŒæœåŠ¡å¯¹åº”çš„ç«¯å£å·æ˜¯7777ã€‚æˆ‘ä»¬è¯•ç€ä½¿ç”¨curlæ¥å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚ è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯å¯ä»¥æˆåŠŸè®¿é—®çš„ã€‚ æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹è¯¦ç»†çš„æƒ…å†µï¼š è¿™é‡Œå¯ä»¥çœ‹åˆ°å·²ç»å’Œä¸Šé¢çš„ä¸‰ä¸ªpodsçš„80ç«¯å£å»ºç«‹äº†æ˜ å°„å…³ç³»ã€‚ 3ã€ipvså’Œiptablesæˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“ï¼Œserviceè¿™ä¸ªæŠ½è±¡å±‚æ˜¯å°†è¿™ä¸ªserviceçš„IPï¼ˆ10.96.16.218ï¼‰çš„7777ç«¯å£å’ŒEndpointsçš„podçš„80ç«¯å£å»ºç«‹æ˜ å°„å…³ç³»æ¥å®ç°è¿™ä¸ªæŠ½è±¡çš„ã€‚é‚£ä¹ˆè¿™ä¸ªæ˜ å°„å…³ç³»çš„å»ºç«‹ï¼Œå°±æ˜¯ç”±iptablesæ¥å®ç°çš„ï¼Œè€Œipvsåœ¨è¿™é‡Œä¹Ÿèƒ½å®ç°ä¸€æ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ›´åŠ å¼ºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒç®€å•çœ‹ä½œæ˜¯iptablesçš„å¢å¼ºç‰ˆã€‚ 3.1 ipvså’Œiptablesçš„åŒºåˆ«k8sä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯iptablesï¼Œä½†æ˜¯ipvsè¦æ›´åŠ å¼ºå¤§ï¼Œ ipvs ä¸ºå¤§å‹é›†ç¾¤æä¾›äº†æ›´å¥½çš„å¯æ‰©å±•æ€§å’Œæ€§èƒ½ ipvs æ”¯æŒæ¯” iptables æ›´å¤æ‚çš„å¤åˆ¶å‡è¡¡ç®—æ³•ï¼ˆæœ€å°è´Ÿè½½ã€æœ€å°‘è¿æ¥ã€åŠ æƒç­‰ç­‰ï¼‰ ipvs æ”¯æŒæœåŠ¡å™¨å¥åº·æ£€æŸ¥å’Œè¿æ¥é‡è¯•ç­‰åŠŸèƒ½ ipvs (IP Virtual Server) å®ç°äº†ä¼ è¾“å±‚è´Ÿè½½å‡è¡¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„4å±‚LANäº¤æ¢ï¼ˆåŸºäºTCPå››å±‚(IP+ç«¯å£)çš„è´Ÿè½½å‡è¡¡è½¯ä»¶ï¼‰ï¼Œä½œä¸º Linux å†…æ ¸çš„ä¸€éƒ¨åˆ†ã€‚ipvsè¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œåœ¨çœŸå®æœåŠ¡å™¨é›†ç¾¤å‰å……å½“è´Ÿè½½å‡è¡¡å™¨ã€‚ipvså¯ä»¥å°†åŸºäºTCPå’ŒUDPçš„æœåŠ¡è¯·æ±‚è½¬å‘åˆ°çœŸå®æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä½¿çœŸå®æœåŠ¡å™¨çš„æœåŠ¡åœ¨å•ä¸ª IP åœ°å€ä¸Šæ˜¾ç¤ºä¸ºè™šæ‹ŸæœåŠ¡ã€‚ ipvsæ˜¯åœ¨kubernetes v1.8ç‰ˆæœ¬ä¸­å¼•è¿›çš„ï¼Œå°ä¸ƒè¿™é‡Œä½¿ç”¨çš„æ˜¯v1.15ç‰ˆæœ¬ï¼Œä¹‹å‰é…ç½®çš„æ—¶å€™å°±æ˜¯ä½¿ç”¨äº†ipvsæ¥æ›¿æ¢iptablesã€‚ 3.2 æŸ¥çœ‹ipvsä¸ç®¡æ˜¯ipvsè¿˜æ˜¯iptablesï¼Œéƒ½æ˜¯éœ€è¦rootæƒé™æ‰èƒ½æŸ¥çœ‹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤å‰åŠ ä¸Šsudoæˆ–è€…æ˜¯åˆ‡æ¢åˆ°rootç”¨æˆ·ã€‚ 1sudo ipvsadm -ln ä»è¿™é‡Œçš„è§„åˆ™ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ã€‚ipvså°†å¯¹10.96.16.218:7777çš„è®¿é—®è½¬å‘åˆ°ä¸‹é¢å¯¹åº”çš„ä¸‰ä¸ªIPåœ°å€çš„80ç«¯å£ä¸Šã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹è¿™ä¸ªdeploymentè¿›è¡Œä¿®æ”¹ï¼Œå°†å‰¯æœ¬æ•°é‡ä»3æ”¹åˆ°6ï¼Œå†çœ‹è¿™ä¸ªipvsè§„åˆ™çš„å˜åŒ– å‰¯æœ¬æ•°é‡å¢åŠ åˆ°äº†6ä¸ªï¼Œå¯¹åº”çš„ipvsè§„åˆ™ä¹Ÿå®Œæˆäº†æ›´æ–°ï¼š æ¥ä¸‹æ¥æˆ‘ä»¬åˆ é™¤æ‰è¿™ä¸ªserviceï¼Œå¯ä»¥çœ‹åˆ°ipvsä¸­çš„è§„åˆ™å¹¶æ²¡æœ‰è¿›è¡Œåˆ é™¤ è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œk8så¯¹ipvsçš„è§„åˆ™å¯ä»¥è¯´æ˜¯åªå¢ä¸å‡ã€‚ è¿™é‡Œç•™ä¸€ä¸ªå‘ï¼Œåé¢å†å¼€ä¸€ç¯‡æ¥è¯¦ç»†ç ”ç©¶ä¸€ä¸‹ipvs 3.3 ä½¿ç”¨DNSè®¿é—®å®é™…ä¸Šï¼Œk8sé›†ç¾¤ä¸­å†…ç½®æœ‰dnsè§£ææœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡&lt;SERVICE_NAME&gt;.&lt;NAMESPACE_NAME&gt;æ¥å¯¹serviceè¿›è¡Œè®¿é—®ã€‚ v1.11ç‰ˆæœ¬ä¹‹åï¼Œcorednså– ä»£kube-dnsæˆä¸ºk8sä¸­é»˜è®¤çš„dnsè§£ææœåŠ¡å™¨ã€‚ æˆ‘ä»¬åœ¨podä¸­è¿è¡Œä¸€ä¸ªshellæ¥å®éªŒä¸€ä¸‹ï¼š 1kubectl run busybox --rm -ti --image=busybox /bin/sh busyboxå¯¹nslookupçš„æ”¯æŒä¼¼ä¹æœ‰äº›é—®é¢˜ï¼Œä¸ä¸€å®šèƒ½æˆåŠŸæŸ¥è¯¢åˆ°dnsï¼Œè€Œä¸”å¹¶æ²¡æœ‰å†…ç½®curlå‘½ä»¤ï¼Œæˆ‘ä»¬åªèƒ½ç”¨wgetæ¥è¿›è¡Œè®¿é—®ã€‚äº‹å®ä¸Šwgetèƒ½æˆåŠŸå°±è¯´æ˜dnsæœåŠ¡æ˜¯æ­£å¸¸çš„ã€‚ ç„¶åæˆ‘ä»¬ä½¿ç”¨å®ƒçš„æµ‹è¯•ç‰ˆæœ¬ï¼Œè¿™æ—¶å€™nslookupå‘½ä»¤æ­£å¸¸äº†ï¼Œwgetå‘½ä»¤åˆä¸æ­£å¸¸äº†ã€‚ 1kubectl run dig --rm -it --image=docker.io/azukiapp/dig /bin/sh è¿™é‡Œé¢çš„10.96.0.10åœ°å€æ­£æ˜¯æˆ‘ä»¬çš„corednsçš„åœ°å€ï¼š 4ã€å¤–ç½‘è®¿é—®service4.1 NodePortç®€ä»‹å‰é¢æˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡clusterIPæ¥è®¿é—®serviceäº†ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™åªèƒ½å±€é™äºåœ¨k8sé›†ç¾¤å†…çš„ä¸»æœºè¿›è¡Œï¼Œé›†ç¾¤å¤–çš„æœºå™¨æ— æ³•å¯¹å…¶è¿›è¡Œè®¿é—®ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å®˜ç½‘ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆï¼š å¯¹ä¸€äº›åº”ç”¨ï¼ˆå¦‚ Frontendï¼‰çš„æŸäº›éƒ¨åˆ†ï¼Œå¯èƒ½å¸Œæœ›é€šè¿‡å¤–éƒ¨ï¼ˆKubernetes é›†ç¾¤å¤–éƒ¨ï¼‰IP åœ°å€æš´éœ² Serviceã€‚ Kubernetes ServiceTypes å…è®¸æŒ‡å®šä¸€ä¸ªéœ€è¦çš„ç±»å‹çš„ Serviceï¼Œé»˜è®¤æ˜¯ ClusterIP ç±»å‹ã€‚ Type çš„å–å€¼ä»¥åŠè¡Œä¸ºå¦‚ä¸‹ï¼š ClusterIPï¼šé€šè¿‡é›†ç¾¤çš„å†…éƒ¨ IP æš´éœ²æœåŠ¡ï¼Œé€‰æ‹©è¯¥å€¼ï¼ŒæœåŠ¡åªèƒ½å¤Ÿåœ¨é›†ç¾¤å†…éƒ¨å¯ä»¥è®¿é—®ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤çš„ ServiceTypeã€‚ NodePortï¼šé€šè¿‡æ¯ä¸ª Node ä¸Šçš„ IP å’Œé™æ€ç«¯å£ï¼ˆNodePortï¼‰æš´éœ²æœåŠ¡ã€‚NodePort æœåŠ¡ä¼šè·¯ç”±åˆ° ClusterIP æœåŠ¡ï¼Œè¿™ä¸ª ClusterIP æœåŠ¡ä¼šè‡ªåŠ¨åˆ›å»ºã€‚é€šè¿‡è¯·æ±‚ &lt;NodeIP&gt;:&lt;NodePort&gt;ï¼Œå¯ä»¥ä»é›†ç¾¤çš„å¤–éƒ¨è®¿é—®ä¸€ä¸ª NodePort æœåŠ¡ã€‚ LoadBalancerï¼šä½¿ç”¨äº‘æä¾›å•†çš„è´Ÿè½½å±€è¡¡å™¨ï¼Œå¯ä»¥å‘å¤–éƒ¨æš´éœ²æœåŠ¡ã€‚å¤–éƒ¨çš„è´Ÿè½½å‡è¡¡å™¨å¯ä»¥è·¯ç”±åˆ° NodePort æœåŠ¡å’Œ ClusterIP æœåŠ¡ã€‚ ExternalNameï¼šé€šè¿‡è¿”å› CNAME å’Œå®ƒçš„å€¼ï¼Œå¯ä»¥å°†æœåŠ¡æ˜ å°„åˆ° externalName å­—æ®µçš„å†…å®¹ï¼ˆä¾‹å¦‚ï¼Œ foo.bar.example.comï¼‰ã€‚ æ²¡æœ‰ä»»ä½•ç±»å‹ä»£ç†è¢«åˆ›å»ºï¼Œè¿™åªæœ‰ Kubernetes 1.7 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ kube-dns æ‰æ”¯æŒã€‚ å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦å°†ç”¨åˆ°çš„å°±æ˜¯NodePortäº†ã€‚ å¦‚æœè®¾ç½® type çš„å€¼ä¸º &quot;NodePort&quot;ï¼ŒKubernetes master å°†ä»ç»™å®šçš„é…ç½®èŒƒå›´å†…ï¼ˆé»˜è®¤ï¼š30000-32767ï¼‰åˆ†é…ç«¯å£ï¼Œæ¯ä¸ª Node å°†ä»è¯¥ç«¯å£ï¼ˆæ¯ä¸ª Node ä¸Šçš„åŒä¸€ç«¯å£ï¼‰ä»£ç†åˆ° Serviceã€‚è¯¥ç«¯å£å°†é€šè¿‡ Service çš„ spec.ports[*].nodePortå­—æ®µè¢«æŒ‡å®šã€‚ å¦‚æœéœ€è¦æŒ‡å®šçš„ç«¯å£å·ï¼Œå¯ä»¥é…ç½® nodePort çš„å€¼ï¼Œç³»ç»Ÿå°†åˆ†é…è¿™ä¸ªç«¯å£ï¼Œå¦åˆ™è°ƒç”¨ API å°†ä¼šå¤±è´¥ï¼ˆæ¯”å¦‚ï¼Œéœ€è¦å…³å¿ƒç«¯å£å†²çªçš„å¯èƒ½æ€§ï¼‰ã€‚ è¿™å¯ä»¥è®©å¼€å‘äººå‘˜è‡ªç”±åœ°å®‰è£…ä»–ä»¬è‡ªå·±çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶é…ç½® Kubernetes ä¸èƒ½å®Œå…¨æ”¯æŒçš„ç¯å¢ƒå‚æ•°ï¼Œæˆ–è€…ç›´æ¥æš´éœ²ä¸€ä¸ªæˆ–å¤šä¸ª Node çš„ IP åœ°å€ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒService å°†èƒ½å¤Ÿé€šè¿‡ &lt;NodeIP&gt;:spec.ports[*].nodePort å’Œspec.clusterIp:spec.ports[*].port è€Œå¯¹å¤–å¯è§ã€‚ 4.2 è‡ªåŠ¨åˆ†é…ç«¯å£æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹åˆšåˆšçš„serviceé…ç½®æ–‡ä»¶ï¼Œå…ˆå°è¯•ä¸€ä¸‹è®©masterè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£ã€‚ ç„¶åæˆ‘ä»¬é‡æ–°åº”ç”¨ä¸€ä¸‹è¯¥é…ç½®æ–‡ä»¶ï¼Œå°±èƒ½çœ‹åˆ°åˆ†é…çš„ç«¯å£ï¼š æˆ‘ä»¬æŸ¥çœ‹ipvsè§„åˆ™ï¼Œå¯ä»¥çœ‹åˆ°æœ¬æœºå¯¹åº”çš„IPéƒ½å·²ç»å»ºç«‹äº†ç›¸åº”çš„æ˜ å°„è½¬å‘è§„åˆ™ æ­£å¥½å°ä¸ƒç”¨çš„æ˜¯è™šæ‹Ÿæœºï¼Œä½¿ç”¨é›†ç¾¤å¤–çš„ç”µè„‘ç”¨æµè§ˆå™¨è®¿é—®ä»»æ„ä¸€ä¸ªmasterèŠ‚ç‚¹å‡å¯ï¼š 4.3 æ‰‹åŠ¨æŒ‡å®šç«¯å£æˆ‘ä»¬åœ¨ä¸‹é¢çš„porté€‰é¡¹ä¸­æ·»åŠ nodePort: 32333ï¼Œç„¶åé‡æ–°åº”ç”¨é…ç½®æ–‡ä»¶ã€‚ ä½¿ç”¨æµè§ˆå™¨å°è¯•è®¿é—®ï¼š","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"}]},{"title":"åœ¨k8sä¸­çš„controllerç®€ä»‹","slug":"20190722-k8s-controller","date":"2019-07-22T09:00:00.000Z","updated":"2019-07-22T09:00:00.000Z","comments":true,"path":"20190722-k8s-controller/","link":"","permalink":"https://tinychen.com/20190722-k8s-controller/","excerpt":"è¿è¡Œå®¹å™¨åŒ–åº”ç”¨æ˜¯Kubernetesæœ€é‡è¦çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ä¸ºæ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€è¦ï¼ŒKubernetesæä¾›äº†å¤šç§Controllerï¼Œä¸»è¦åŒ…æ‹¬Deploymentã€DaemonSetã€Jobã€CronJobç­‰ã€‚","text":"è¿è¡Œå®¹å™¨åŒ–åº”ç”¨æ˜¯Kubernetesæœ€é‡è¦çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ä¸ºæ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€è¦ï¼ŒKubernetesæä¾›äº†å¤šç§Controllerï¼Œä¸»è¦åŒ…æ‹¬Deploymentã€DaemonSetã€Jobã€CronJobç­‰ã€‚ 1ã€åˆ›å»ºèµ„æºçš„ä¸¤ç§æ–¹å¼åˆ›å»ºèµ„æºä¸»è¦æœ‰é€šè¿‡å‘½ä»¤è¡Œé…ç½®å‚æ•°å’Œé€šè¿‡é…ç½®æ–‡ä»¶è¿™ä¸¤ç§æ–¹å¼ã€‚ é€šè¿‡å‘½ä»¤è¡Œä¸»è¦æ˜¯ä½¿ç”¨kubectlå‘½ä»¤æ¥è¿›è¡Œåˆ›å»ºï¼Œä¸»è¦å¯èƒ½ç”¨åˆ°çš„æ˜¯kubectl runå’Œkubectl createï¼Œå…·ä½“çš„ç”¨æ³•æˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤åé¢åŠ ä¸Šâ€“-helpå‚æ•°æ¥æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ã€‚ è¿™ç§æ–¹å¼çš„å¥½å¤„å°±æ˜¯ç®€å•å¿«æ·ï¼Œéƒ¨ç½²çš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯é‡åˆ°è¦æ±‚æ¯”è¾ƒå¤æ‚å¤šæ ·çš„èµ„æºéƒ¨ç½²ï¼Œåé¢å°±è¦é™„å¸¦ä¸€å¤§ä¸²å‚æ•°ï¼Œå®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä¸€èˆ¬æ¥è¯´æ¯”è¾ƒé€‚ç”¨äºå°è§„æ¨¡çš„ç®€å•èµ„æºéƒ¨ç½²æˆ–è€…æ˜¯ä¸Šçº¿å‰çš„ç®€å•æµ‹è¯• é€šè¿‡é…ç½®æ–‡ä»¶åˆ™ä¸»è¦æ˜¯jsonæ ¼å¼æˆ–yamlæ ¼å¼çš„æ–‡ä»¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥è¯¦ç»†é…ç½®å„ç§å‚æ•°ï¼Œä¿ç•™çš„é…ç½®æ–‡ä»¶è¿˜å¯ä»¥ç”¨åˆ°å…¶ä»–çš„é›†ç¾¤ä¸Šè¿›è¡Œå¤§è§„æ¨¡çš„éƒ¨ç½²æ“ä½œï¼Œç¼ºç‚¹å°±æ˜¯éƒ¨ç½²æ¯”è¾ƒéº»çƒ¦ï¼Œå¹¶ä¸”éœ€è¦ä¸€å®šçš„é—¨æ§›ï¼ˆè¦æ±‚å¯¹jsonæˆ–yamlæœ‰ä¸€å®šçš„äº†è§£ï¼‰ é…ç½®æ–‡ä»¶ä¸»è¦æ˜¯é€šè¿‡kubectl apply -få’Œkubectl create -fæ¥è¿›è¡Œé…ç½®ã€‚ 2ã€Deployment2.1 cliéƒ¨ç½²æˆ‘ä»¬å…ˆä½¿ç”¨å‘½ä»¤è¡Œï¼ˆcliï¼‰åˆ›å»ºä¸€ä¸ªdeploymentï¼Œåå­—ï¼ˆNAMEï¼‰æ˜¯nginx-clideploymentï¼Œä½¿ç”¨çš„é•œåƒï¼ˆimageï¼‰ç‰ˆæœ¬ä¸º1.17ï¼Œåˆ›å»ºçš„å‰¯æœ¬ï¼ˆreplicasï¼‰æ•°é‡ä¸º3ã€‚ 1kubectl run nginx-clideployment --image=nginx:1.17 --replicas=3 æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹éƒ¨ç½²æ˜¯å¦æˆåŠŸï¼š è¿™é‡Œçš„kubectl get rsä¸­çš„rså…¶å®å°±æ˜¯ReplicaSetï¼ˆRSï¼‰ æˆ‘ä»¬è¿˜å¯ä»¥å‘ç°ReplicaSetçš„å‘½åå°±æ˜¯åœ¨æˆ‘ä»¬æŒ‡å®šçš„NAMEåé¢åŠ ä¸Šäº†ä¸€ä¸²å“ˆå¸Œæ•°å€¼ã€‚ &lt;the name of the Deployment&gt;-&lt;hash value of the pod template&gt;. æƒ³è¦æŸ¥çœ‹æ›´è¯¦ç»†çš„podæƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š 1kubectl get pod -o wide è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸‰ä¸ªpodè¢«k8sè‡ªåŠ¨çš„åˆ†é…åˆ°äº†ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šè€Œå®ç°é›†ç¾¤ä¸­çš„è´Ÿè½½å‡è¡¡ï¼ˆLBï¼‰ï¼Œè€Œè¿™é‡Œçš„IPæ˜¯åˆ›å»ºpodçš„æ—¶å€™è¿›è¡Œéšæœºåˆ†é…çš„ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½é¢„çŸ¥ã€‚ å¦‚æœæƒ³è¦æŸ¥çœ‹æŸä¸€ä¸ªpodéƒ¨ç½²ä¹‹åçš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š 1kubectl describe pods nginx-clideployment-5696d55d9d-gdtrt å¦‚æœæˆ‘ä»¬åªæ˜¯è¾“å…¥nginx-clideploymentçš„è¯å°±ä¼šæŠŠæ‰€æœ‰ç›¸å…³çš„nginx-clideploymentéƒ½åˆ—å‡ºæ¥ã€‚ è¿™é‡Œçš„ä¿¡æ¯å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°namespaceæ˜¯ä½¿ç”¨çš„é»˜è®¤defaultï¼ˆä¸€èˆ¬éƒ½æ˜¯defaultï¼Œé™¤éæ˜¯æ•°åäººä»¥ä¸Šåœ¨åŒæ—¶ä½¿ç”¨è¿™ä¸ªé›†ç¾¤ï¼Œå¦åˆ™ä¸€èˆ¬ä¸å»ºè®®æ–°å»ºnamespaceæ¥åŒºåˆ†podï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨labelå³å¯åŒºåˆ†å„ç±»podã€‚ï¼‰ Controlled By: åˆ™è¯´æ˜äº†è¿™ä¸ªdeploymentæ˜¯ç”±ReplicaSetæ§åˆ¶çš„ã€‚ Conditions:åˆ™è¡¨æ˜äº†å½“å‰çš„podçŠ¶å†µ Volumesç§°ä¹‹ä¸ºå·ï¼Œè¿™ä¸ªæ¦‚å¿µæˆ‘ä»¬æš‚æ—¶è¿˜æ²¡æœ‰æ¥è§¦åˆ°ï¼Œç­‰åˆ°æˆ‘ä»¬çš„å®¿ä¸»æœºéœ€è¦ä¸å®¹å™¨å†…çš„æœåŠ¡è¿›è¡Œæ•°æ®äº¤äº’çš„æ—¶å€™å†è¿›è¡Œäº†è§£ã€‚ Eventsåˆ™ç›¸å½“äºlogï¼Œè®°å½•äº†podè¿è¡Œçš„æ‰€æœ‰æƒ…å†µï¼Œå¦‚æœé‡åˆ°äº†è¿è¡Œä¸æ­£å¸¸çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥çœ‹è¿™é‡Œæ¥äº†è§£è¯¦æƒ…ã€‚ 2.2 yamlé…ç½®æ–‡ä»¶éƒ¨ç½²æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä½¿ç”¨yamlæ–‡ä»¶æ¥è¿›è¡Œéƒ¨ç½²ã€‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸ºnginx-yamldeployment.yml 1234567891011121314apiVersion: extensions/v1beta1kind: Deploymentmetadata: name: nginx-yamldeploymentspec: replicas: 5 template: metadata: labels: app: web_server spec: containers: - name: nginx image: nginx:1.17.1 apiVersionæ˜¯å½“å‰é…ç½®æ ¼å¼çš„ç‰ˆæœ¬ã€‚ kindæ˜¯è¦åˆ›å»ºçš„èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯Deploymentã€‚ metadataæ˜¯è¯¥èµ„æºçš„å…ƒæ•°æ®ï¼Œnameæ˜¯å¿…éœ€çš„å…ƒæ•°æ®é¡¹ã€‚ specéƒ¨åˆ†æ˜¯è¯¥Deploymentçš„è§„æ ¼è¯´æ˜ã€‚ replicas æŒ‡æ˜å‰¯æœ¬æ•°é‡ï¼Œé»˜è®¤ä¸º1ã€‚ template å®šä¹‰Podçš„æ¨¡æ¿ï¼Œè¿™æ˜¯é…ç½®æ–‡ä»¶çš„é‡è¦éƒ¨åˆ†ã€‚ metadataå®šä¹‰Podçš„å…ƒæ•°æ®ï¼Œè‡³å°‘è¦å®šä¹‰ä¸€ä¸ªlabelã€‚labelçš„keyå’Œvalueå¯ä»¥ä»»æ„æŒ‡å®šã€‚ spec æè¿°Podçš„è§„æ ¼ï¼Œæ­¤éƒ¨åˆ†å®šä¹‰Podä¸­æ¯ä¸€ä¸ªå®¹å™¨çš„å±æ€§ï¼Œnameå’Œimageæ˜¯å¿…éœ€çš„ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨kubectl applyæŒ‡ä»¤è¿›è¡Œéƒ¨ç½²ã€‚ 1kubectl apply -f nginx-yamldeployment.yml æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯å·²ç»è¿è¡Œæ­£å¸¸äº†ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³è¦ä¿®æ”¹è¿™ä¸ªdeploymentçš„å±æ€§ï¼Œæ¯”å¦‚è¯´å‰¯æœ¬æ•°é‡ä»5æ”¹ä¸º6ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ç¼–è¾‘åˆšåˆšçš„nginx-yamldeployment.ymlæ–‡ä»¶ï¼Œç„¶åå†æ‰§è¡Œkubectl apply -f nginx-yamldeployment.ymlï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶æ‰¾ä¸åˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦å¤–çš„æ–¹æ³•ï¼š 1kubectl edit deployments.apps nginx-yamldeployment è¿™æ ·å­æˆ‘ä»¬å°±èƒ½ç›´æ¥ç¼–è¾‘è¿™ä¸ªdeploymentçš„yamlé…ç½®æ–‡ä»¶ï¼Œç¼–è¾‘çš„æ“ä½œæ–¹å¼å’Œvimç›¸åŒï¼Œä¿®æ”¹å®Œæˆåä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚ æˆ‘ä»¬ä¿®æ”¹ä¿å­˜é€€å‡ºåï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå·²ç»ç”Ÿæ•ˆäº†ã€‚ å¯¹äºä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºçš„deploymentï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ¥è¿›è¡Œä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥kubectl editæ¥ç¼–è¾‘å¯¹åº”çš„yamlé…ç½®æ–‡ä»¶ã€‚ 3ã€DaemonSetæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å®˜ç½‘å¯¹DaemonSetçš„è§£é‡Šï¼š DaemonSet ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…æŸäº›ï¼‰èŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚å½“æœ‰èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶ï¼Œä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Pod ã€‚ å½“æœ‰èŠ‚ç‚¹ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤ DaemonSet å°†ä¼šåˆ é™¤å®ƒåˆ›å»ºçš„æ‰€æœ‰ Podã€‚ ä½¿ç”¨ DaemonSet çš„ä¸€äº›å…¸å‹ç”¨æ³•ï¼š è¿è¡Œé›†ç¾¤å­˜å‚¨ daemonï¼Œä¾‹å¦‚åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ glusterdã€cephã€‚ åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›† daemonï¼Œä¾‹å¦‚fluentdã€logstashã€‚ åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç›‘æ§ daemonï¼Œä¾‹å¦‚ Prometheus Node Exporterã€collectdã€Datadog ä»£ç†ã€New Relic ä»£ç†ï¼Œæˆ– Ganglia gmondã€‚ ä¸€ä¸ªç®€å•çš„ç”¨æ³•æ˜¯åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šéƒ½å¯åŠ¨ä¸€ä¸ª DaemonSetï¼Œå°†è¢«ä½œä¸ºæ¯ç§ç±»å‹çš„ daemon ä½¿ç”¨ã€‚ ä¸€ä¸ªç¨å¾®å¤æ‚çš„ç”¨æ³•æ˜¯å•ç‹¬å¯¹æ¯ç§ daemon ç±»å‹ä½¿ç”¨å¤šä¸ª DaemonSetï¼Œä½†å…·æœ‰ä¸åŒçš„æ ‡å¿—ï¼Œå’Œ/æˆ–å¯¹ä¸åŒç¡¬ä»¶ç±»å‹å…·æœ‰ä¸åŒçš„å†…å­˜ã€CPUè¦æ±‚ã€‚ å®é™…ä¸Šï¼Œk8sæœ¬èº«çš„ä¸€äº›ç³»ç»Ÿç»„ä»¶æœåŠ¡å°±æ˜¯ä»¥DaemonSetçš„å½¢å¼è¿è¡Œåœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ã€‚ 4ã€Job4.1 éƒ¨ç½²job Jobåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªPodå¹¶ç¡®ä¿æŒ‡å®šæ•°é‡çš„PodæˆåŠŸç»ˆæ­¢ã€‚å½“podæˆåŠŸå®Œæˆåï¼ŒJobä¼šè·Ÿè¸ªæˆåŠŸçš„å®Œæˆæƒ…å†µã€‚è¾¾åˆ°æŒ‡å®šæ•°é‡çš„æˆåŠŸå®Œæˆæ—¶ï¼ŒJobå®Œæˆã€‚ åˆ é™¤Jobå°†æ¸…ç†å®ƒåˆ›å»ºçš„Podã€‚ ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯åˆ›å»ºä¸€ä¸ªJobå¯¹è±¡ï¼Œä»¥ä¾¿å¯é åœ°è¿è¡Œä¸€ä¸ªPodå¹¶æˆåŠŸå®ŒæˆæŒ‡å®šä»»åŠ¡ã€‚å¦‚æœç¬¬ä¸€ä¸ªPodå¤±è´¥æˆ–è¢«åˆ é™¤ï¼ˆä¾‹å¦‚ç”±äºèŠ‚ç‚¹ç¡¬ä»¶æ•…éšœæˆ–èŠ‚ç‚¹é‡å¯ï¼‰ï¼ŒJobå¯¹è±¡å°†å¯åŠ¨ä¸€ä¸ªæ–°çš„Podã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨Jobå¹¶è¡Œè¿è¡Œå¤šä¸ªPodã€‚ ç›´æ¥ç…§æ¬å®˜ç½‘çš„è§£é‡Šå¯èƒ½ä¼šæœ‰äº›éš¾ä»¥ç†è§£ï¼Œæˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸ªä¾‹å­å°±èƒ½å¾ˆå¥½çš„è¯´æ˜æƒ…å†µäº†ã€‚ æˆ‘ä»¬å…ˆæ–°å»ºä¸€ä¸ªjobçš„é…ç½®æ–‡ä»¶ï¼Œå‘½åä¸ºpijob.yml,è¿™ä¸ªä»»åŠ¡æ˜¯å°†piè®¡ç®—åˆ°å°æ•°ç‚¹åä¸¤åƒä½ï¼Œç„¶åå†æ‰“å°å‡ºæ¥ã€‚æˆ‘ä»¬è¿è¡Œä¸€ä¸‹çœ‹çœ‹ã€‚ 12345678910111213apiVersion: batch/v1kind: Jobmetadata: name: pispec: template: spec: containers: - name: pi image: perl command: [&quot;perl&quot;, &quot;-Mbignum=bpi&quot;, &quot;-wle&quot;, &quot;print bpi(2000)&quot;] restartPolicy: Never backoffLimit: 4 æˆ‘ä»¬æŸ¥çœ‹å®ƒçš„è¯¦ç»†æƒ…å†µ 1kubectl describe jobs/pi è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿è¡Œäº†37såæˆåŠŸè®¡ç®—å‡ºç»“æœã€‚ æŸ¥çœ‹podä¹Ÿå¯ä»¥çœ‹åˆ°å®ƒçš„çŠ¶æ€æ˜¯Completedï¼Œè¯´æ˜å·²ç»å®Œæˆäº†ã€‚ 123456# æŸ¥çœ‹åˆ›å»ºçš„podçš„åç§°pods=$(kubectl get pods --selector=job-name=pi --output=jsonpath=&#x27;&#123;.items[*].metadata.name&#125;&#x27;)echo $pods# æŸ¥çœ‹podçš„è¿è¡Œç»“æœkubectl logs $pods 4.2 jobè¿è¡Œé”™è¯¯æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸€ä¸‹è¿è¡Œå¤±è´¥çš„æƒ…å†µï¼Œæˆ‘ä»¬æŠŠcommandé‡Œé¢çš„è·¯å¾„æ”¹é”™ï¼Œä½¿å¾—å®ƒæ— æ³•æ­£å¸¸è¿è¡Œã€‚ æ³¨æ„è¿™é‡Œçš„restartPolicy: Neveræ„å‘³ç€podè¿è¡Œå¤±è´¥äº†ä¹Ÿä¸ä¼šé‡å¯ã€‚ä½†æ˜¯è¿™ä¸ªæ—¶å€™jobä¼šæ£€æµ‹åˆ°è¿è¡Œå¤±è´¥ï¼Œç„¶åå†æ–°å»ºä¸€ä¸ªpodæ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚ backoffLimit: 4æ„å‘³ç€æœ€å¤šåªä¼šæ–°å»º4ä¸ªpodï¼Œé¿å…ä¸€ç›´å¤±è´¥ä¸€ç›´æ–°å»ºä»è€Œè€—å°½ç³»ç»Ÿèµ„æºã€‚ æˆ‘ä»¬æŸ¥çœ‹eventå¯ä»¥çœ‹åˆ°ï¼Œç¡®å®æ˜¯ç”±äºè·¯å¾„ä¿®æ”¹é”™è¯¯è€Œå¯¼è‡´æ— æ³•æ­£å¸¸è¿è¡Œã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠrestartPolicy: æ”¹ä¸º OnFailure è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰å¯åŠ¨å¤šä¸ªpodï¼ŒäºŒæ˜¯å¯¹å‘ç”Ÿé”™è¯¯çš„podè¿›è¡Œé‡å¯æ“ä½œã€‚ 4.3 jobå¹¶è¡ŒåŒ–åœ¨å¤šçº¿ç¨‹æ—©å·²æ™®åŠçš„ä»Šå¤©ï¼Œå¾ˆå¤šä»»åŠ¡æˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨å¹¶è¡ŒåŒ–æ¥è¿›è¡ŒåŠ é€Ÿè¿è¡Œï¼Œè¿™é‡Œä¹Ÿä¸ä¾‹å¤–ã€‚ æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­çš„specä¸­åŠ å…¥ completions: å’Œparallelism: ã€‚ å›¾ä¸­è¡¨ç¤ºéœ€è¦è¿è¡Œ12ä¸ªï¼Œæ¯æ¬¡å¹¶è¡Œè¿è¡Œ6ä¸ªã€‚ ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯æ¯æ¬¡è¿è¡Œ6ä¸ªï¼ˆè¿è¡Œæ—¶é—´ç›¸åŒè¯´æ˜åŒæ—¶å¼€å§‹è¿è¡Œï¼‰ã€‚ ç­‰å¾…ä¸€æ®µæ—¶å€™ä¹‹åï¼Œæˆ‘ä»¬å†æ¬¡æŸ¥çœ‹è€Œå·²çœ‹åˆ°ä»»åŠ¡å·²ç»é¡ºåˆ©å®Œæˆäº†ã€‚ 5ã€CronJobç†Ÿæ‚‰linuxçš„åŒå­¦ä¸€å®šä¸ä¼šå¯¹cronæ„Ÿåˆ°é™Œç”Ÿï¼Œå› ä¸ºcronå°±æ˜¯ç”¨æ¥ç®¡ç†linuxä¸­çš„å®šæ—¶ä»»åŠ¡çš„å·¥å…·ï¼Œæ‰€ä»¥CronJobæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå®šæ—¶ç‰ˆçš„Jobï¼Œå…¶å®šæ—¶ä»»åŠ¡çš„ç¼–å†™æ ¼å¼ä¹Ÿå’ŒCronç›¸ä¼¼ã€‚å…³äºCronå¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹å°ä¸ƒä¹‹å‰çš„åšå®¢ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCronJobçš„æ—¶é—´ä»¥å¯åŠ¨è¯¥CronJobä»»åŠ¡çš„MasterèŠ‚ç‚¹çš„æ—¶é—´ä¸ºå‡†ã€‚ Cronjobåªè´Ÿè´£åˆ›å»ºä¸å…¶è®¡åˆ’ç›¸åŒ¹é…çš„Jobï¼Œè€ŒJobåˆ™è´Ÿè´£ç®¡ç†å®ƒæ‰€ä»£è¡¨çš„Podã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒCronJobåªè´Ÿè´£åˆ›å»ºJobï¼Œå…·ä½“çš„ç®¡ç†æ“ä½œè¿˜æ˜¯ç”±Jobæ¥è´Ÿè´£ã€‚ è¿™é‡Œæ˜¯CronJobçš„å®˜æ–¹æ–‡æ¡£ã€‚ æˆ‘ä»¬æ–°å»ºä¸€ä¸ªhellocronjob.ymlæ¥æŸ¥çœ‹ä¸€ä¸‹å®ƒçš„å·¥ä½œæƒ…å†µã€‚ 123456789101112131415161718apiVersion: batch/v1beta1kind: CronJobmetadata: name: hellospec: schedule: &quot;*/1 * * * *&quot; jobTemplate: spec: template: spec: containers: - name: hello image: busybox args: - /bin/sh - -c - date; echo Hello from the Kubernetes cluster restartPolicy: OnFailure è¿™ä¸ªå®šæ—¶ä»»åŠ¡çš„æ“ä½œå°±æ˜¯æ¯åˆ†é’Ÿè¾“å‡ºä¸€æ¬¡æ—¶é—´å’ŒHello from the Kubernetes clusterã€‚ 1234# æŸ¥çœ‹cronjobçš„è¿è¡ŒçŠ¶æ€kubectl get cronjobs.batchkubectl get jobs.batch --watch æˆ‘ä»¬éšä¾¿æŸ¥çœ‹å…¶ä¸­çš„ä¸€ä¸ªlogå¯ä»¥çœ‹åˆ°è¾“å‡ºçš„ç»“æœï¼š","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"}]},{"title":"åœ¨CentOS7ä¸Šéƒ¨ç½²é«˜å¯ç”¨çš„k8sé›†ç¾¤(v1.15)","slug":"20190718-centos7-install-k8s-ha","date":"2019-07-18T03:00:00.000Z","updated":"2019-07-18T03:00:00.000Z","comments":true,"path":"20190718-centos7-install-k8s-ha/","link":"","permalink":"https://tinychen.com/20190718-centos7-install-k8s-ha/","excerpt":"åœ¨VMwareè™šæ‹Ÿæœºä¸­çš„CentOS7é›†ç¾¤éƒ¨ç½²é«˜å¯ç”¨çš„k8sé›†ç¾¤ç¯å¢ƒ(v1.15)ã€‚ è¿™é‡Œæœ‰ä¸¤ç¯‡åŸºç¡€çŸ¥è¯†çš„è¡¥å……å’Œå•masterèŠ‚ç‚¹é›†ç¾¤çš„æ­å»ºè¿‡ç¨‹ï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ã€‚ k8sé‡è¦æ¦‚å¿µåŠå„ç»„ä»¶ç®€ä»‹ åœ¨CentOS7ä¸Šéƒ¨ç½²k8sé›†ç¾¤(v1.15)","text":"åœ¨VMwareè™šæ‹Ÿæœºä¸­çš„CentOS7é›†ç¾¤éƒ¨ç½²é«˜å¯ç”¨çš„k8sé›†ç¾¤ç¯å¢ƒ(v1.15)ã€‚ è¿™é‡Œæœ‰ä¸¤ç¯‡åŸºç¡€çŸ¥è¯†çš„è¡¥å……å’Œå•masterèŠ‚ç‚¹é›†ç¾¤çš„æ­å»ºè¿‡ç¨‹ï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ã€‚ k8sé‡è¦æ¦‚å¿µåŠå„ç»„ä»¶ç®€ä»‹ åœ¨CentOS7ä¸Šéƒ¨ç½²k8sé›†ç¾¤(v1.15) 1ã€å‰æœŸå·¥ä½œ1.1 ä»€ä¹ˆæ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Ÿç®€å•æ¥è¯´å°±æ˜¯masterèŠ‚ç‚¹ä¸æ­¢ä¸€ä¸ªçš„é›†ç¾¤ï¼Œæˆ‘ä»¬çŸ¥é“k8sçš„nodeèŠ‚ç‚¹ä¸­ï¼ŒémasterèŠ‚ç‚¹éƒ½éœ€è¦å¬ä»masterèŠ‚ç‚¹æ¥è¿›è¡Œä»»åŠ¡çš„è°ƒåº¦åˆ†é…å’Œè´Ÿè½½å‡è¡¡ç­‰æ“ä½œï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯æˆ‘ä»¬åªéœ€è¦æ“ä½œmasterèŠ‚ç‚¹å°±å¯ä»¥è°ƒåº¦æ‰€æœ‰çš„nodeèŠ‚ç‚¹ï¼Œåå¤„å°±æ˜¯å¦‚æœmasterèŠ‚ç‚¹å´©äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤ä¹Ÿå°±å´©æ‰äº†ã€‚æ‰€ä»¥è¿™é‡Œçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯é…ç½®å¤šä¸ªmasterèŠ‚ç‚¹ï¼Œå¦‚æœä¸€ä¸ªå´©æ‰äº†è¿˜æœ‰åˆ«çš„å¤‡ç”¨å¤‡ç”¨èŠ‚ç‚¹é¡¶ä¸Šï¼Œä¸è‡³äºå‡ºç°å´©æºƒçš„æƒ…å†µã€‚ 1.2 é›†ç¾¤æœºå™¨è¿™é‡Œå¿…é¡»è¦è¯´ä¸€ä¸‹ï¼Œk8så¯¹æ¯ä¸ªèŠ‚ç‚¹çš„æœºå™¨é…ç½®çš„æœ€ä½è¦æ±‚æ˜¯2C2Gï¼Œå³ä¸¤æ ¸å¿ƒçš„CPUï¼Œ2Gçš„å†…å­˜ï¼Œä½äºè¿™ä¸ªé…ç½®ä¹Ÿä¸æ˜¯ä¸èƒ½ç”¨ï¼Œåªæ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šè­¦å‘Šè€Œå·²ã€‚è¿™é‡Œå°ä¸ƒé‡‡ç”¨çš„æ˜¯è™šæ‹Ÿæœºçš„æ–¹æ³•ï¼ˆç©·å­¦ç”Ÿæ²¡æœ‰çœŸæœºé›†ç¾¤ï¼‰ï¼Œå…·ä½“çš„é…ç½®å¦‚ä¸‹è¡¨ã€‚ åç§° é…ç½® IP VIP ä¸éœ€è¦è™šæ‹Ÿæœºï¼Œç•™ä¸€ä¸ªIPå³å¯ 192.168.100.10 master20 8C4Gï¼ŒCentOS7.6 192.168.100.20 master21 8C4Gï¼ŒCentOS7.6 192.168.100.21 master22 8C4Gï¼ŒCentOS7.6 192.168.100.22 node30 8C8Gï¼ŒCentOS7.6 192.168.100.30 node31 8C8Gï¼ŒCentOS7.6 192.168.100.31 node32 8C8Gï¼ŒCentOS7.6 192.168.100.32 çœŸæœºç”¨çš„æ˜¯ä¸€å—æ¸£æ¸£i7-8700å’Œ64Gçš„å†…å­˜ï¼Œå‹‰å¼ºèƒ½æ’‘ä¸€ä¸‹ã€‚ 1.3 é›†ç¾¤é—´å…å¯†ç™»å½•ä¹‹å‰ä¸“é—¨å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚å¤šä¸»æœºé—´å®ç°SSHå…å¯†ç™»å½• éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨hostsæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸º192.168.100.10æ·»åŠ ä¸€ä¸‹è§£æã€‚ 1echo &quot;192.168.100.10 kubernetes.haproxy.com&quot; &gt;&gt; /etc/hosts è¿™é‡Œçš„kubernetes.haproxy.comå¯ä»¥æ”¹æˆåˆ«çš„åå­—ï¼Œä½†æ˜¯æ³¨æ„åé¢è¦ç”¨åˆ°ï¼Œå»ºè®®æ”¹æˆæœ‰æ„ä¹‰çš„åå­—ã€‚ 1.4 æ—¶é—´åŒæ­¥(æ‰€æœ‰æœºå™¨)è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ntpdateæ¥è¿›è¡Œæ—¶é—´åŒæ­¥ 12345678# ä½¿ç”¨yumå®‰è£…ntpdateå·¥å…·yum install ntpdate -y# ä½¿ç”¨é˜¿é‡Œäº‘çš„æºåŒæ­¥æ—¶é—´ntpdate ntp1.aliyun.com# æœ€åæŸ¥çœ‹ä¸€ä¸‹æ—¶é—´hwclock æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨/etc/cron.hourly/ä¸‹é¢ç›´æ¥æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†ntpdate ntp1.aliyun.comè¿™æ¡å‘½ä»¤å†™è¿›å»ï¼Œè¿™æ ·cronå°±ä¼šæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡è¿™ä¸ªåŒæ­¥æ—¶é—´æ“ä½œã€‚å…³äºcronå¯ä»¥ç‚¹å‡»è¿™é‡Œäº†è§£ã€‚ 123cat &gt;&gt;/etc/cron.hourly/synctime &lt;&lt;EOFntpdate ntp1.aliyun.comEOF 1.5 å‡çº§å†…æ ¸(æ‰€æœ‰æœºå™¨)å»ºè®®ç›´æ¥å‡çº§centoså®˜æ–¹çš„å†…æ ¸ï¼Œè¿™æ ·å…¼å®¹æ€§æœ€å¥½ã€‚ 12345678# æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬uname -r# æ›´æ–°yumæºyum update -y# å‡çº§yumæºä¸­çš„æœ€æ–°ç‰ˆå†…æ ¸yum install -y kernel æ­¤å¤–æˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®ä¸€ä¸‹å†…æ ¸çš„namespace 1234grubby --args=&quot;user_namespace.enable=1&quot; --update-kernel=&quot;$(grubby --default-kernel)&quot;# é‡æ–°åŠ è½½å†…æ ¸reboot 1.6 å…³é—­é˜²ç«å¢™(æ‰€æœ‰æœºå™¨)å› ä¸ºk8sæ¶‰åŠçš„ç«¯å£éå¸¸å¤šï¼Œæˆ‘ä»¬å…ˆæŠŠé˜²ç«å¢™å…³äº†ï¼Œå¦‚æœå®‰è£…äº†iptableä¹Ÿå…ˆå…³æ‰ã€‚ 123# å…³é—­centos7è‡ªå¸¦çš„firewallé˜²ç«å¢™systemctl disable firewalld.service systemctl stop firewalld.service 1.7 è®¾ç½®selinux(æ‰€æœ‰æœºå™¨)æ¥è‡ªå®˜ç½‘çš„è¯´æ˜ï¼Œå¿…é¡»æŠŠselinuxæ”¹ä¸ºpermissiveï¼ˆç›´æ¥ç”Ÿæ•ˆæ— éœ€é‡å¯ï¼‰æˆ–è€…disabledï¼ˆéœ€è¦é‡å¯ç”Ÿæ•ˆï¼‰ é€šè¿‡å‘½ä»¤ setenforce 0 å’Œ sed ... å¯ä»¥å°† SELinux è®¾ç½®ä¸º permissive æ¨¡å¼(å°†å…¶ç¦ç”¨)ã€‚ åªæœ‰æ‰§è¡Œè¿™ä¸€æ“ä½œä¹‹åï¼Œå®¹å™¨æ‰èƒ½è®¿é—®å®¿ä¸»çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿›è€Œèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ Pod ç½‘ç»œã€‚æ‚¨å¿…é¡»è¿™ä¹ˆåšï¼Œç›´åˆ° kubelet åšå‡ºå‡çº§æ”¯æŒ SELinux ä¸ºæ­¢ã€‚ 1234setenforce 0sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27; /etc/selinux/config# ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹/etc/selinux/configæ–‡ä»¶ å…³äºSELinuxçš„ç®€å•ä»‹ç»ï¼Œå¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ä¹‹å‰çš„åšå®¢ã€‚ 1.8 å…³é—­swapï¼ˆæ‰€æœ‰æœºå™¨ï¼‰k8så®˜æ–¹ä¸æ¨èæˆ‘ä»¬ä½¿ç”¨swapåˆ†åŒºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¹Ÿå…³é—­æ‰ã€‚ 1234567swapoff -avim /etc/fstab# æ³¨é‡Šæ‰swapåˆ†åŒºå¯åŠ¨æŒ‚è½½çš„é‚£ä¸€è¡Œ# é‡å¯æœºå™¨reboot 2ã€é…ç½®ipvs(æ‰€æœ‰æœºå™¨)12# ä½¿ç”¨yumæºå®‰è£…ipvsyum install ipvsadm ipset -y 12# ä½¿é…ç½®ç”Ÿæ•ˆsysctl --system 1234567891011121314151617181920# åŠ è½½æ¨¡å—modprobe -- ip_vsmodprobe -- ip_vs_rrmodprobe -- ip_vs_wrrmodprobe -- ip_vs_shmodprobe -- nf_conntrack_ipv4# æŸ¥çœ‹æ˜¯å¦åŠ è½½lsmod | grep ip_vs# é…ç½®å¼€æœºè‡ªåŠ è½½cat &lt;&lt;EOF &gt;&gt; /etc/rc.localmodprobe -- ip_vsmodprobe -- ip_vs_rrmodprobe -- ip_vs_wrrmodprobe -- ip_vs_shmodprobe -- nf_conntrack_ipv4EOFchmod +x /etc/rc.d/rc.local 3ã€é…ç½®k8sç›¸å…³ç½‘ç»œå‚æ•°(æ‰€æœ‰æœºå™¨)æ¥ç€æˆ‘ä»¬éœ€è¦ç¼–è¾‘ä¸€ä¸ªk8sçš„é…ç½®æ–‡ä»¶ 12345678910111213141516171819202122232425262728# éœ€è¦è®¾å®š/etc/sysctl.d/k8s.confçš„ç³»ç»Ÿå‚æ•°ã€‚cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.confnet.ipv4.tcp_keepalive_time = 600net.ipv4.tcp_keepalive_intvl = 30net.ipv4.tcp_keepalive_probes = 10net.ipv4.neigh.default.gc_stale_time = 120net.ipv4.conf.all.rp_filter = 0net.ipv4.conf.default.rp_filter = 0net.ipv4.conf.default.arp_announce = 2net.ipv4.conf.lo.arp_announce = 2net.ipv4.conf.all.arp_announce = 2net.ipv4.ip_forward = 1net.ipv4.tcp_max_tw_buckets = 5000net.ipv4.tcp_syncookies = 1net.ipv4.tcp_max_syn_backlog = 1024net.ipv4.tcp_synack_retries = 2net.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1net.netfilter.nf_conntrack_max = 2310720fs.inotify.max_user_watches=89100fs.may_detach_mounts = 1fs.file-max = 52706963fs.nr_open = 52706963net.bridge.bridge-nf-call-arptables = 1vm.swappiness = 0vm.overcommit_memory=1vm.panic_on_oom=0EOF 4ã€é…ç½®iptables(æ‰€æœ‰æœºå™¨)ä¿é™©èµ·è§ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®iptables 123456789101112cat &gt;&gt; /etc/sysctl.conf &lt;&lt;EOFnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1EOFyum install -y bridge-utils.x86_64modprobe bridgemodprobe br_netfiltersysctl -preboot 5ã€æ£€æŸ¥é…ç½®(æ‰€æœ‰æœºå™¨)1234# æ£€æŸ¥ç³»ç»Ÿå†…æ ¸å’Œæ¨¡å—æ˜¯å¦é€‚åˆè¿è¡Œ docker (ä»…é€‚ç”¨äº linux ç³»ç»Ÿ)curl https://raw.githubusercontent.com/docker/docker/master/contrib/check-config.sh &gt; check-config.shbash ./check-config.sh è¿™é‡Œåªéœ€è¦ä¿è¯å¿…è¦é¡¹é€šè¿‡å°±å¯ä»¥äº†ã€‚ 6ã€å®‰è£…docker(æ‰€æœ‰æœºå™¨)6.1 å®‰è£…dockercentosç‰ˆæœ¬çš„decker-ceå®˜æ–¹å®‰è£…æŒ‡å¯¼ï¼š https://docs.docker.com/install/linux/docker-ce/centos/ è¿™é‡Œæˆ‘ä»¬ä¸»è¦æ˜¯é€šè¿‡yumçš„æ–¹å¼æ¥å®‰è£…ï¼Œå¦‚æœå‡ºç°æ— æ³•è¿æ¥dockerå®˜ç½‘çš„æƒ…å†µï¼Œå»ºè®®æ£€æŸ¥ä¸€ä¸‹ç½‘ç»œï¼Œæˆ–è€…ä½¿ç”¨rpmçš„æ–¹å¼è¿›è¡Œå®‰è£…ã€‚ 123456789101112131415# å¯¼å…¥å®˜ç½‘æä¾›çš„reposudo yum install -y yum-utils device-mapper-persistent-data lvm2sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo# å®‰è£…dockeråŠå…¶ç›¸å…³ç»„ä»¶sudo yum install -y docker-ce docker-ce-cli containerd.io# å¯åŠ¨dockersudo systemctl start docker# è·‘ä¸ªhelloworldçœ‹çœ‹sudo docker run hello-world# æœ€åæˆ‘ä»¬è¿˜è¦è®¾ç½®ä¸€ä¸‹å¼€æœºå¯åŠ¨sudo systemctl enable docker 6.2 é…ç½®cgroupk8sæ¨èdockerçš„cgroupé©±åŠ¨ä½¿ç”¨systemdï¼Œè¯´æ˜¯ä¼šæ›´ç¨³å®šï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ã€‚ 1234567891011121314151617181920212223## Create /etc/docker directory.mkdir /etc/docker# Setup daemon.cat &gt; /etc/docker/daemon.json &lt;&lt;EOF&#123; &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;], &quot;log-driver&quot;: &quot;json-file&quot;, &quot;log-opts&quot;: &#123; &quot;max-size&quot;: &quot;100m&quot; &#125;, &quot;storage-driver&quot;: &quot;overlay2&quot;, &quot;storage-opts&quot;: [ &quot;overlay2.override_kernel_check=true&quot; ]&#125;EOFmkdir -p /etc/systemd/system/docker.service.d# Restart Dockersystemctl daemon-reloadsystemctl restart docker 6.3 é…ç½®æ™®é€šç”¨æˆ·é»˜è®¤æƒ…å†µä¸‹ï¼Œæ™®é€šç”¨æˆ·éœ€è¦ä½¿ç”¨sudoæ‰èƒ½æ“ä½œdockerï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦è¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚ 123456789101112# åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·su æ™®é€šç”¨æˆ·å# åˆ›å»ºdockerç»„sudo groupadd docker# å°†å½“å‰ç”¨æˆ·åŠ å…¥dockerç”¨æˆ·ç»„sudo gpasswd -a $&#123;USER&#125; docker# é‡å¯dockeræœåŠ¡sudo systemctl daemon-reloadsudo systemctl restart docker 7ã€å®‰è£…é…ç½®keepalivedã€haproxy(æ‰€æœ‰masterèŠ‚ç‚¹)7.1 å®‰è£…12345678910# ä½¿ç”¨yumæºç›´æ¥å®‰è£…yum install socat keepalived haproxy -y# è®¾ç½®å¼€æœºå¯åŠ¨systemctl enable haproxysystemctl enable keepalived# å¤‡ä»½ä¸€ä¸‹åŸæ¥çš„é…ç½®æ–‡ä»¶ä»¥é˜²ä¸‡ä¸€mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bakmv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak 7.2 ç¼–è¾‘haproxyé…ç½®æ–‡ä»¶é¦–å…ˆæˆ‘ä»¬å¼€å¯ç³»ç»Ÿçš„æ—¥å¿—åŠŸèƒ½ 123456789vim /etc/rsyslog.conf #ä¸ºå…¶æ·»åŠ æ—¥å¿—åŠŸèƒ½# Provides UDP syslog reception$ModLoad imudp$UDPServerRun 514 ------&gt;å¯åŠ¨udpï¼Œå¯åŠ¨ç«¯å£åå°†ä½œä¸ºæœåŠ¡å™¨å·¥ä½œ # Provides TCP syslog reception$ModLoad imtcp$InputTCPServerRun 514 ------&gt;å¯åŠ¨tcpç›‘å¬ç«¯å£local2.* /var/log/haproxy.log æ³¨æ„é…ç½®æ–‡ä»¶é‡Œé¢çš„IPè¦æ ¹æ®è‡ªå·±çš„masterèŠ‚ç‚¹å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849cat &gt;&gt; /etc/haproxy/haproxy.cfg &lt;&lt;EOFglobal log 127.0.0.1 local2 chroot /var/lib/haproxy pidfile /var/run/haproxy.pid maxconn 1024 user haproxy group haproxy daemon nbproc 1 stats socket /var/lib/haproxy/statsdefaults mode tcp log global option tcplog option dontlognull option redispatch retries 3 timeout queue 1m timeout connect 10s timeout client 1m timeout server 1m timeout check 10slisten stats mode http bind 0.0.0.0:12345 stats enable log 127.0.0.1 local2 stats realm Haproxy\\ Statistics stats uri /stats stats auth admin:admin stats admin if TRUEfrontend k8s bind 0.0.0.0:8443 mode tcp maxconn 200 default_backend k8s-httpsbackend k8s-https balance roundrobin mode tcp server master220 192.168.100.20:6443 check inter 10000 fall 2 rise 2 weight 1 server master221 192.168.100.21:6443 check inter 10000 fall 2 rise 2 weight 1 server master222 192.168.100.22:6443 check inter 10000 fall 2 rise 2 weight 1EOF 7.3 ç¼–è¾‘keepalivedé…ç½®æ–‡ä»¶æ³¨æ„ï¼Œä¸‰ä¸ªèŠ‚ç‚¹keepalivedé…ç½®æ–‡ä»¶å­˜åœ¨åŒºåˆ«ï¼š router_idåˆ†åˆ«ä¸ºmaster20ã€master21ã€master22 stateåˆ†åˆ«ä¸ºMASTERã€BACKUPã€BACKUP priorityåˆ†åˆ«ä¸º100ã€90ã€80 123456789101112131415161718192021222324252627282930cat &gt;&gt; /etc/keepalived/keepalived.conf &lt;&lt;EOFglobal_defs &#123; router_id master20 script_user root enable_script_security&#125;vrrp_script check_haproxy &#123; script /etc/keepalived/check_haproxy.sh interval 3&#125;vrrp_instance VI_1 &#123; state MASTER interface ens32 virtual_router_id 80 priority 100 advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; virtual_ipaddress &#123; 192.168.100.10/24 &#125; track_script &#123; check_haproxy &#125;&#125;EOF æ­¤å¤–æˆ‘ä»¬è¿˜éœ€è¦ç¼–è¾‘ä¸€ä¸ªæ£€æŸ¥çš„è„šæœ¬æ¥ç¡®ä¿æ­£å¸¸ 1234567cat &gt;&gt; /etc/keepalived/check_haproxy.sh &lt;&lt;EOF#!/bin/bashNUM=`ps -C haproxy --no-header |wc -l`if [ $NUM -eq 0 ];then systemctl stop keepalivedfiEOF 8ã€å®‰è£…k8s(æ‰€æœ‰æœºå™¨)k8så®˜ç½‘æä¾›çš„yumæºå¹¶ä¸å¤ªå¥½ç”¨ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨é˜¿é‡Œäº‘çš„yumé•œåƒæºã€‚ 12345678910111213141516171819# æ–°å»ºä¸€ä¸ªyumæºcat &gt;&gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt;EOF[kubernetes]name=Kubernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/enabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpgexclude=kube*EOFyum clean allyum repolistyum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes# å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºå¯åŠ¨systemctl enable kubelet &amp;&amp; systemctl start kubelet å…³äºSELinuxçš„ç®€å•ä»‹ç»ï¼Œå¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ä¹‹å‰çš„åšå®¢ã€‚ 9.1 è·å–é»˜è®¤é…ç½®æ–‡ä»¶12345# è·å¾—é»˜è®¤é…ç½®æ–‡ä»¶ã€‚kubeadm config print init-defaults &gt; kubeadm.conf# æŸ¥çœ‹éœ€è¦çš„é•œåƒkubeadm config images list --config kubeadm.conf ä¸çŸ¥é“ä¸ºå•¥è¿™é‡Œæ˜¾ç¤ºçš„å±…ç„¶æ˜¯1.14ç‰ˆæœ¬çš„ï¼Œå°ä¸ƒå®‰è£…çš„æ˜æ˜æ˜¯1.15ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æŠŠkubeadm.confé‡Œé¢çš„ç‰ˆæœ¬å·æ”¹æˆ1.15å†æŸ¥çœ‹ 9.2 ç¼–è¾‘è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ³¨æ„ä¸‹é¢çš„ipåœ°å€å’Œç‰ˆæœ¬å·éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥è¿›è¡Œæ”¹åŠ¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# é…ç½®æ–‡ä»¶kubuadm_master20.confapiVersion: kubeadm.k8s.io/v1beta2kind: InitConfigurationlocalAPIEndpoint: advertiseAddress: 192.168.100.20 bindPort: 6443---apiVersion: kubeadm.k8s.io/v1beta2kind: ClusterConfigurationkubernetesVersion: v1.15.0controlPlaneEndpoint: &quot;kubernetes.haproxy.com:8443&quot;imageRepository: registry.aliyuncs.com/google_containersapiServer: certSANs: - &quot;master20&quot; - &quot;master21&quot; - &quot;master22&quot; - 192.168.100.10 - 192.168.100.20 - 192.168.100.21 - 192.168.100.22networking: podSubnet: &quot;10.244.0.0/16&quot;certificatesDir: /etc/kubernetes/pkiclusterName: kubernetesetcd: local: extraArgs: listen-client-urls: &quot;https://127.0.0.1:2379,https://192.168.100.20:2379&quot; advertise-client-urls: &quot;https://192.168.100.20:2379&quot; listen-peer-urls: &quot;https://192.168.100.20:2380&quot; initial-advertise-peer-urls: &quot;https://192.168.100.20:2380&quot; initial-cluster: &quot;master20=https://192.168.100.20:2380&quot; initial-cluster-state: new serverCertSANs: - master20 - 192.168.100.20 peerCertSANs: - master20 - 192.168.100.20---apiVersion: kubeproxy.config.k8s.io/v1alpha1kind: KubeProxyConfigurationmode: ipvs 9.3 åˆå§‹åŒ–12345# æ‹‰å–éœ€è¦çš„é•œåƒkubeadm config images pull --config kubuadm_master20.conf# åˆå§‹åŒ–kubeadm init --config kubuadm_master20.conf è¿™é‡Œçš„tokenéœ€è¦è®°ä¸‹æ¥ã€‚ç„¶åæˆ‘ä»¬éœ€è¦åˆ‡æ¢åˆ°érootç”¨æˆ·æ¥è¿›è¡Œé…ç½®ã€‚ 123456mkdir -p $HOME/.kubesudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configsudo chown $(id -u):$(id -g) $HOME/.kube/config# æ·»åŠ kubectlçš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc 10ã€å®‰è£…flannelç½‘ç»œï¼ˆmaster20ï¼‰1wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml æˆ‘ä»¬å…ˆä¸‹è½½ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œä¸ºäº†ä¿é™©èµ·è§ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šç½‘å¡ ç„¶åæˆ‘ä»¬æ‰§è¡Œåˆå§‹åŒ–å®‰è£…æ“ä½œã€‚ 1kubectl apply -f kube-flannel.yml è¿™æ—¶å€™æˆ‘ä»¬å†æŸ¥çœ‹èŠ‚ç‚¹å°±ä¼šå‘ç°ï¼Œcorednså·²ç»æ­£å¸¸å·¥ä½œäº†ã€‚ 1kubectl get pods -A 11ã€åˆ†å‘è¯ä¹¦ï¼ˆmaster20ï¼‰æˆ‘ä»¬åœ¨master20èŠ‚ç‚¹ä¸Šç¼–å†™ä¸€ä¸ªè„šæœ¬è¿›è¡Œè¯ä¹¦çš„åˆ†å‘ï¼Œåªéœ€è¦åˆ†å‘åˆ°å…¶ä»–çš„masterèŠ‚ç‚¹å³å¯ã€‚æ³¨æ„é‡Œé¢çš„ipåœ°å€å’Œç”¨æˆ·åéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚ 1234567891011121314151617cat &gt;&gt; districert &lt;&lt;EOF#!/bin/bashfor index in 21 22; do ip=192.168.100.$&#123;index&#125; ssh $ip &quot;mkdir -p /etc/kubernetes/pki/etcd/; mkdir -p /home/tinychen/.kube/&quot; scp /etc/kubernetes/pki/ca.crt $ip:/etc/kubernetes/pki/ca.crt scp /etc/kubernetes/pki/ca.key $ip:/etc/kubernetes/pki/ca.key scp /etc/kubernetes/pki/sa.key $ip:/etc/kubernetes/pki/sa.key scp /etc/kubernetes/pki/sa.pub $ip:/etc/kubernetes/pki/sa.pub scp /etc/kubernetes/pki/front-proxy-ca.crt $ip:/etc/kubernetes/pki/front-proxy-ca.crt scp /etc/kubernetes/pki/front-proxy-ca.key $ip:/etc/kubernetes/pki/front-proxy-ca.key scp /etc/kubernetes/pki/etcd/ca.crt $ip:/etc/kubernetes/pki/etcd/ca.crt scp /etc/kubernetes/pki/etcd/ca.key $ip:/etc/kubernetes/pki/etcd/ca.key scp /etc/kubernetes/admin.conf $ip:/etc/kubernetes/admin.conf scp /etc/kubernetes/admin.conf $ip:/home/tinychen/.kube/configdoneEOF 12ã€é…ç½®master2112.1 ç¼–è¾‘è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ³¨æ„ä¸‹é¢çš„ipåœ°å€å’Œç‰ˆæœ¬å·éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥è¿›è¡Œæ”¹åŠ¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546# é…ç½®æ–‡ä»¶kubeadm_master21.confapiVersion: kubeadm.k8s.io/v1beta2kind: InitConfigurationlocalAPIEndpoint: advertiseAddress: 192.168.100.21 bindPort: 6443---apiVersion: kubeadm.k8s.io/v1beta2kind: ClusterConfigurationkubernetesVersion: v1.15.0controlPlaneEndpoint: &quot;kubernetes.haproxy.com:8443&quot;imageRepository: registry.aliyuncs.com/google_containersapiServer: certSANs: - &quot;master20&quot; - &quot;master21&quot; - &quot;master22&quot; - 192.168.100.10 - 192.168.100.20 - 192.168.100.21 - 192.168.100.22networking: podSubnet: &quot;10.244.0.0/16&quot;certificatesDir: /etc/kubernetes/pkiclusterName: kubernetesetcd: local: extraArgs: listen-client-urls: &quot;https://127.0.0.1:2379,https://192.168.100.21:2379&quot; advertise-client-urls: &quot;https://192.168.100.21:2379&quot; listen-peer-urls: &quot;https://192.168.100.21:2380&quot; initial-advertise-peer-urls: &quot;https://192.168.100.21:2380&quot; initial-cluster: &quot;master20=https://192.168.100.20:2380,master21=https://192.168.100.21:2380&quot; initial-cluster-state: existing serverCertSANs: - master21 - 192.168.100.21 peerCertSANs: - master21 - 192.168.100.21---apiVersion: kubeproxy.config.k8s.io/v1alpha1kind: KubeProxyConfigurationmode: ipvs 12.2 é…ç½®érootç”¨æˆ·å‰é¢æˆ‘ä»¬åœ¨è„šæœ¬é‚£é‡Œå·²ç»åˆ›å»ºå¥½äº†æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬è¿™é‡Œåªéœ€è¦ä¿®æ”¹æƒé™å’Œæ·»åŠ è‡ªåŠ¨è¡¥å…¨å°±å¥½äº†ã€‚ 1234sudo chown $(id -u):$(id -g) $HOME/.kube/config# æ·»åŠ kubectlçš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc 12.3 åˆå§‹åŒ–æ³¨æ„è¿™é‡Œçš„æ–‡ä»¶åå’ŒIPåœ°å€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚ 12345678# é…ç½®è¯ä¹¦kubeadm init phase certs all --config kubeadm_master21.conf# é…ç½®etcdkubeadm init phase etcd local --config kubeadm_master21.conf# ç”Ÿæˆkubeleté…ç½®æ–‡ä»¶kubeadm init phase kubeconfig kubelet --config kubeadm_master21.conf# å¯åŠ¨kubeletkubeadm init phase kubelet-start --config kubeadm_master21.conf ç„¶åè¿™ä¸€æ­¥è¦åˆ‡æ¢åˆ°érootç”¨æˆ· 123# å°†master21çš„etcdåŠ å…¥é›†ç¾¤kubectl exec -n kube-system etcd-master20 -- etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt --cert-file /etc/kubernetes/pki/etcd/peer.crt --key-file /etc/kubernetes/pki/etcd/peer.key --endpoints=https://192.168.100.20:2379 member add master21 https://192.168.100.21:2380 123456# å¯åŠ¨ kube-apiserverã€kube-controller-managerã€kube-schedulerkubeadm init phase kubeconfig all --config kubeadm_master21.confkubeadm init phase control-plane all --config kubeadm_master21.conf# å°†èŠ‚ç‚¹æ ‡è®°ä¸ºmasterkubeadm init phase mark-control-plane --config kubeadm_master21.conf 13ã€é…ç½®master2213.1 ç¼–è¾‘è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ³¨æ„ä¸‹é¢çš„ipåœ°å€å’Œç‰ˆæœ¬å·éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥è¿›è¡Œæ”¹åŠ¨ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# é…ç½®æ–‡ä»¶kubeadm_master22.confapiVersion: kubeadm.k8s.io/v1beta2kind: InitConfigurationlocalAPIEndpoint: advertiseAddress: 192.168.100.22 bindPort: 6443---apiVersion: kubeadm.k8s.io/v1beta2kind: ClusterConfigurationkubernetesVersion: v1.15.0controlPlaneEndpoint: &quot;kubernetes.haproxy.com:8443&quot;imageRepository: registry.aliyuncs.com/google_containersapiServer: certSANs: - &quot;master20&quot; - &quot;master21&quot; - &quot;master22&quot; - 192.168.100.10 - 192.168.100.20 - 192.168.100.21 - 192.168.100.22networking: podSubnet: &quot;10.244.0.0/16&quot;certificatesDir: /etc/kubernetes/pkiclusterName: kubernetesetcd: local: extraArgs: listen-client-urls: &quot;https://127.0.0.1:2379,https://192.168.100.22:2379&quot; advertise-client-urls: &quot;https://192.168.100.22:2379&quot; listen-peer-urls: &quot;https://192.168.100.22:2380&quot; initial-advertise-peer-urls: &quot;https://192.168.100.22:2380&quot; initial-cluster: &quot;master20=https://192.168.100.20:2380,master21=https://192.168.100.21:2380,master22=https://192.168.100.22:2380&quot; initial-cluster-state: existing serverCertSANs: - master22 - 192.168.100.22 peerCertSANs: - master22 - 192.168.100.22---apiVersion: kubeproxy.config.k8s.io/v1alpha1kind: KubeProxyConfigurationmode: ipvs 13.2 é…ç½®érootç”¨æˆ·å‰é¢æˆ‘ä»¬åœ¨è„šæœ¬é‚£é‡Œå·²ç»åˆ›å»ºå¥½äº†æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬è¿™é‡Œåªéœ€è¦ä¿®æ”¹æƒé™å’Œæ·»åŠ è‡ªåŠ¨è¡¥å…¨å°±å¥½äº†ã€‚ 1234sudo chown $(id -u):$(id -g) $HOME/.kube/config# æ·»åŠ kubectlçš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc 13.3 åˆå§‹åŒ–æ³¨æ„è¿™é‡Œçš„æ–‡ä»¶åå’ŒIPåœ°å€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚ 12345678# é…ç½®è¯ä¹¦kubeadm init phase certs all --config kubeadm_master22.conf# é…ç½®etcdkubeadm init phase etcd local --config kubeadm_master22.conf# ç”Ÿæˆkubeleté…ç½®æ–‡ä»¶kubeadm init phase kubeconfig kubelet --config kubeadm_master22.conf# å¯åŠ¨kubeletkubeadm init phase kubelet-start --config kubeadm_master22.conf ç„¶åè¿™ä¸€æ­¥è¦åˆ‡æ¢åˆ°érootç”¨æˆ· 123# å°†master22çš„etcdåŠ å…¥é›†ç¾¤kubectl exec -n kube-system etcd-master20 -- etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt --cert-file /etc/kubernetes/pki/etcd/peer.crt --key-file /etc/kubernetes/pki/etcd/peer.key --endpoints=https://192.168.100.20:2379 member add master22 https://192.168.100.22:2380 123456# å¯åŠ¨ kube-apiserverã€kube-controller-managerã€kube-schedulerkubeadm init phase kubeconfig all --config kubeadm_master22.confkubeadm init phase control-plane all --config kubeadm_master22.conf# å°†èŠ‚ç‚¹æ ‡è®°ä¸ºmasterkubeadm init phase mark-control-plane --config kubeadm_master22.conf 14ã€æ·»åŠ nodeèŠ‚ç‚¹nodeèŠ‚ç‚¹çš„æ·»åŠ æˆ‘ä»¬åªéœ€è¦åˆ‡æ¢åˆ°rootç”¨æˆ·æ‰§è¡Œä¹‹å‰master20åˆå§‹åŒ–æˆåŠŸæç¤ºçš„æŒ‡ä»¤å³å¯ã€‚ 12kubeadm join kubernetes.haproxy.com:8443 --token m42q2v.y8sffomwkgjlhx8h \\ --discovery-token-ca-cert-hash sha256:1829cbaf37e968b43f91e6f0b65e2f2b7985a2d3d17ec66f3af70e0d15db01de 15ã€æŸ¥çœ‹æœ€ç»ˆæ•ˆæœæŸ¥çœ‹èŠ‚ç‚¹ æŸ¥çœ‹pods æŸ¥çœ‹é›†ç¾¤12345kubectl exec -n kube-system etcd-master20 \\ -- etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt \\ --cert-file /etc/kubernetes/pki/etcd/peer.crt \\ --key-file /etc/kubernetes/pki/etcd/peer.key \\ --endpoints=https://192.168.100.20:2379 member list æŸ¥çœ‹ipvsæƒ…å†µ","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"},{"name":"docker","slug":"docker","permalink":"https://tinychen.com/tags/docker/"},{"name":"haproxy","slug":"haproxy","permalink":"https://tinychen.com/tags/haproxy/"},{"name":"keepalived","slug":"keepalived","permalink":"https://tinychen.com/tags/keepalived/"}]},{"title":"åœ¨CentOS7ä¸Šéƒ¨ç½²å•MasterèŠ‚ç‚¹k8sé›†ç¾¤(v1.15)","slug":"20190716-centos7-install-k8s","date":"2019-07-16T09:00:00.000Z","updated":"2019-07-16T09:00:00.000Z","comments":true,"path":"20190716-centos7-install-k8s/","link":"","permalink":"https://tinychen.com/20190716-centos7-install-k8s/","excerpt":"åœ¨è™šæ‹Ÿæœºä¸­çš„CentOS7é›†ç¾¤ä¸­éƒ¨ç½²å•masterèŠ‚ç‚¹çš„k8sç¯å¢ƒ(v1.15)ã€‚","text":"åœ¨è™šæ‹Ÿæœºä¸­çš„CentOS7é›†ç¾¤ä¸­éƒ¨ç½²å•masterèŠ‚ç‚¹çš„k8sç¯å¢ƒ(v1.15)ã€‚ 1ã€å®‰è£…docker-ce1.1 dockerç®€ä»‹æœ€æ—©çš„æ—¶å€™dockerå…¶å®ä¸æ˜¯å¼€æºçš„ï¼Œåæ¥dockeræ··å¾—ä¸å¤ªå¥½ï¼Œæ— å¥ˆä¹‹ä¸‹åˆ›å§‹äººå†³å®šå°†dockerå¼€æºï¼ˆç„¶ådockerå°±ç«äº†ï¼‰ï¼Œç„¶åå°±æœ‰äº†dockerè¿™ä¸ªå¼€æºé¡¹ç›®ï¼Œç°åœ¨ä¸»è¦æ˜¯ç”±dockerå…¬å¸ç»´æŠ¤ã€‚ 2017å¹´å¹´åˆï¼Œdockerå…¬å¸å°†åŸå…ˆçš„dockeré¡¹ç›®æ”¹åä¸ºmobyï¼Œå¹¶åˆ›å»ºäº†docker-ceå’Œdocker-eeã€‚ è¿™ä¸‰è€…çš„å…³ç³»æ˜¯ï¼š mobyæ˜¯ç»§æ‰¿äº†åŸå…ˆçš„dockerçš„é¡¹ç›®ï¼Œæ˜¯ç¤¾åŒºç»´æŠ¤çš„çš„å¼€æºé¡¹ç›®ï¼Œè°éƒ½å¯ä»¥åœ¨mobyçš„åŸºç¡€æ‰“é€ è‡ªå·±çš„å®¹å™¨äº§å“ docker-ceï¼ˆ Community Editionï¼‰æ˜¯dockerå…¬å¸ç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªåŸºäºmobyé¡¹ç›®çš„å…è´¹çš„å®¹å™¨äº§å“ docker-eeï¼ˆ Enterprise Editionï¼‰æ˜¯dockerå…¬å¸ç»´æŠ¤çš„é—­æºäº§å“ï¼Œæ˜¯dockerå…¬å¸çš„å•†ä¸šäº§å“ã€‚ æˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨docker-ceçš„ç¨³å®šç‰ˆæœ¬ï¼Œå…³äºceç‰ˆæœ¬å…¶å®ä¹Ÿæœ‰ä¸‰ä¸ªåˆ†æ”¯ï¼š æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®˜ç½‘çš„è§£é‡Šï¼š Stable gives you latest releases for general availability. Test gives pre-releases that are ready for testing before general availability. Nightly gives you latest builds of work in progress for the next major release. ç®€å•çš„æ‰“ä¸ªæ¯”æ–¹æ¥è¯´å°±æ˜¯ï¼šStableå°±æ˜¯ç¨³å®šç‰ˆï¼ŒTestå°±æ˜¯å¼€å‘ç‰ˆï¼ŒNightlyå°±æ˜¯å†…æµ‹ç‰ˆ 1.2 å®‰è£…docker-cecentosç‰ˆæœ¬çš„decker-ceå®˜æ–¹å®‰è£…æŒ‡å¯¼ï¼š https://docs.docker.com/install/linux/docker-ce/centos/ è¿™é‡Œæˆ‘ä»¬ä¸»è¦æ˜¯é€šè¿‡yumçš„æ–¹å¼æ¥å®‰è£…ï¼Œå¦‚æœå‡ºç°æ— æ³•è¿æ¥dockerå®˜ç½‘çš„æƒ…å†µï¼Œå»ºè®®æ£€æŸ¥ä¸€ä¸‹ç½‘ç»œï¼Œæˆ–è€…ä½¿ç”¨rpmçš„æ–¹å¼è¿›è¡Œå®‰è£…ã€‚ 1234567# å¯¼å…¥å®˜ç½‘æä¾›çš„reposudo yum install -y yum-utils device-mapper-persistent-data lvm2sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo# å®‰è£…dockeråŠå…¶ç›¸å…³ç»„ä»¶sudo yum install docker-ce docker-ce-cli containerd.io æ³¨æ„è¿™é‡Œæˆ‘ä»¬éœ€è¦æ ¡å¯¹ä¸€ä¸‹å¯†é’¥ï¼Œç¡®ä¿å’Œå®˜ç½‘æä¾›çš„æ— è¯¯ã€‚ 12345678# å¯åŠ¨dockersudo systemctl start docker# è·‘ä¸ªhelloworldçœ‹çœ‹sudo docker run hello-world# æœ€åæˆ‘ä»¬è¿˜è¦è®¾ç½®ä¸€ä¸‹å¼€æœºå¯åŠ¨sudo systemctl enable docker 2ã€å‡†å¤‡å·¥ä½œ2.1 ä¿®æ”¹hostæ–‡ä»¶(æ‰€æœ‰æœºå™¨)ä¸ºäº†ä¿è¯é€šä¿¡æ–¹ä¾¿ï¼Œæ¯å°ä¸»æœºä¸Šçš„/etc/hostsæ–‡ä»¶éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œæ·»åŠ èŠ‚ç‚¹çš„IPåœ°å€å’Œhostname åŒæ—¶æœ€å¥½æŠŠæ¯å°ä¸»æœºçš„hostnameä¹Ÿä¿®æ”¹æˆå’Œä¸Šé¢çš„hostæ–‡ä»¶ä¸€æ ·ã€‚ 12345# å¯ä»¥ç›´æ¥ç¼–è¾‘æ–‡ä»¶vim /etc/hostname# æˆ–è€…ä½¿ç”¨å‘½ä»¤hostnamectl set-hostname 2.2 å…³é—­é˜²ç«å¢™(æ‰€æœ‰æœºå™¨)å› ä¸ºk8sæ¶‰åŠçš„ç«¯å£éå¸¸å¤šï¼Œæˆ‘ä»¬å…ˆæŠŠé˜²ç«å¢™å…³äº†ï¼Œå¦‚æœå®‰è£…äº†iptableä¹Ÿå…ˆå…³æ‰ã€‚ 123# å…³é—­centos7è‡ªå¸¦çš„firewallé˜²ç«å¢™systemctl disable firewalld.service systemctl stop firewalld.service æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®˜ç½‘å¯¹è¿™äº›ç«¯å£çš„æè¿°ã€‚ Master èŠ‚ç‚¹ è§„åˆ™ æ–¹å‘ ç«¯å£èŒƒå›´ ä½œç”¨ ä½¿ç”¨è€… TCP Inbound 6443* Kubernetes API server All TCP Inbound 2379-2380 etcd server client API kube-apiserver, etcd TCP Inbound 10250 Kubelet API Self, Control plane TCP Inbound 10251 kube-scheduler Self TCP Inbound 10252 kube-controller-manager Self Worker èŠ‚ç‚¹ è§„åˆ™ æ–¹å‘ ç«¯å£èŒƒå›´ ä½œç”¨ ä½¿ç”¨è€… TCP Inbound 10250 Kubelet API Self, Control plane TCP Inbound 30000-32767 NodePort Services** All ** NodePort æœåŠ¡ çš„é»˜è®¤ç«¯å£èŒƒå›´ã€‚ ä»»ä½•ä½¿ç”¨ * æ ‡è®°çš„ç«¯å£å·éƒ½æœ‰å¯èƒ½è¢«è¦†ç›–ï¼Œæ‰€ä»¥æ‚¨éœ€è¦ä¿è¯æ‚¨çš„è‡ªå®šä¹‰ç«¯å£çš„çŠ¶æ€æ˜¯å¼€æ”¾çš„ã€‚ è™½ç„¶ä¸»èŠ‚ç‚¹å·²ç»åŒ…å«äº† etcd çš„ç«¯å£ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„å¤–éƒ¨ etcd é›†ç¾¤ï¼Œæˆ–æ˜¯æŒ‡å®šè‡ªå®šä¹‰ç«¯å£ã€‚ æ‚¨ä½¿ç”¨çš„ pod ç½‘ç»œæ’ä»¶ (è§ä¸‹) ä¹Ÿå¯èƒ½éœ€è¦æŸäº›ç‰¹å®šç«¯å£å¼€å¯ã€‚ç”±äºå„ä¸ª pod ç½‘ç»œæ’ä»¶éƒ½æœ‰æ‰€ä¸åŒï¼Œè¯·å‚é˜…ä»–ä»¬å„è‡ªæ–‡æ¡£ä¸­å¯¹ç«¯å£çš„è¦æ±‚ã€‚ å¦‚æœå¯¹å®‰å…¨æ€§æœ‰è¦æ±‚ï¼Œä¸æ”¾å¿ƒå…³é—­é˜²ç«å¢™çš„è¯ï¼Œæœ€å¥½è¿˜æ˜¯ä¿®æ”¹ä¸€ä¸‹é˜²ç«å¢™çš„é…ç½®ï¼Œæ”¾è¡Œè¿™äº›ç«¯å£ã€‚ 2.3 åŒæ­¥æ—¶é—´(æ‰€æœ‰æœºå™¨)è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ntpdateæ¥è¿›è¡Œæ—¶é—´åŒæ­¥ 12345678# ä½¿ç”¨yumå®‰è£…ntpdateå·¥å…·yum install ntpdate -y# ä½¿ç”¨é˜¿é‡Œäº‘çš„æºåŒæ­¥æ—¶é—´ntpdate ntp1.aliyun.com# æœ€åæŸ¥çœ‹ä¸€ä¸‹æ—¶é—´hwclock æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨/etc/cron.hourly/ä¸‹é¢ç›´æ¥æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†ntpdate ntp1.aliyun.comè¿™æ¡å‘½ä»¤å†™è¿›å»ï¼Œè¿™æ ·cronå°±ä¼šæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡è¿™ä¸ªåŒæ­¥æ—¶é—´æ“ä½œã€‚å…³äºcronå¯ä»¥ç‚¹å‡»è¿™é‡Œäº†è§£ã€‚ 123cat &gt;&gt;/etc/cron.hourly/synctime &lt;&lt;EOFntpdate ntp1.aliyun.comEOF 2.4 è®¾ç½®selinux(æ‰€æœ‰æœºå™¨)æ¥è‡ªå®˜ç½‘çš„è¯´æ˜ï¼Œå¿…é¡»æŠŠselinuxæ”¹ä¸ºpermissiveï¼ˆç›´æ¥ç”Ÿæ•ˆæ— éœ€é‡å¯ï¼‰æˆ–è€…disabledï¼ˆéœ€è¦é‡å¯ç”Ÿæ•ˆï¼‰ é€šè¿‡å‘½ä»¤ setenforce 0 å’Œ sed ... å¯ä»¥å°† SELinux è®¾ç½®ä¸º permissive æ¨¡å¼(å°†å…¶ç¦ç”¨)ã€‚ åªæœ‰æ‰§è¡Œè¿™ä¸€æ“ä½œä¹‹åï¼Œå®¹å™¨æ‰èƒ½è®¿é—®å®¿ä¸»çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿›è€Œèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ Pod ç½‘ç»œã€‚æ‚¨å¿…é¡»è¿™ä¹ˆåšï¼Œç›´åˆ° kubelet åšå‡ºå‡çº§æ”¯æŒ SELinux ä¸ºæ­¢ã€‚ 1234setenforce 0sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27; /etc/selinux/config# ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹/etc/selinux/configæ–‡ä»¶ å…³äºSELinuxçš„ç®€å•ä»‹ç»ï¼Œå¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ä¹‹å‰çš„åšå®¢ã€‚ 3ã€å®‰è£…kubeadm, kubelet å’Œ kubectl3.1 ç®€ä»‹æˆ‘ä»¬éœ€è¦åœ¨æ¯å°æœºå™¨ä¸Šéƒ½å®‰è£…ä»¥ä¸‹çš„è½¯ä»¶åŒ…ï¼š kubeadm: ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤ã€‚ kubelet: åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ pod å’Œ container ç­‰ã€‚ kubectl: ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ kubeadm ä¸èƒ½ å¸®æˆ‘ä»¬å®‰è£…æˆ–ç®¡ç† kubelet æˆ– kubectl ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿è¯ä»–ä»¬æ»¡è¶³é€šè¿‡ kubeadm å®‰è£…çš„ Kubernetes æ§åˆ¶å±‚å¯¹ç‰ˆæœ¬çš„è¦æ±‚ã€‚ç„¶è€Œæ§åˆ¶å±‚ä¸ kubelet é—´çš„ å°ç‰ˆæœ¬å· ä¸ä¸€è‡´æ— ä¼¤å¤§é›…ï¼Œä¸è¿‡è¯·è®°ä½ kubelet çš„ç‰ˆæœ¬ä¸å¯ä»¥è¶…è¿‡ API server çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ 1.8.0 çš„ API server å¯ä»¥é€‚é… 1.7.0 çš„ kubeletï¼Œåä¹‹å°±ä¸è¡Œäº†ã€‚ 3.2 æ·»åŠ yumä»“åº“(æ‰€æœ‰æœºå™¨)ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œk8så®˜ç½‘æä¾›çš„yumæºå¹¶ä¸èƒ½åœ¨å›½å†…æ­£å¸¸ä½¿ç”¨ï¼Œå¥½åœ¨æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„é•œåƒæºã€‚ 123456789101112# æ–°å»ºä¸€ä¸ªyumæºvim /etc/yum.repos.d/kubernetes.repo# æ·»åŠ ä¸‹åˆ—å†…å®¹åˆ°repoä¸­[kubernetes]name=Kubernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/enabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpgexclude=kube* ä½¿ç”¨yumå®‰è£…kubeadm, kubelet å’Œ kubectl 123456yum clean allyum repolistyum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes# å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºå¯åŠ¨systemctl enable kubelet &amp;&amp; systemctl start kubelet 3.3 ä¿®æ”¹cgroupç›¸å…³é…ç½®(æ‰€æœ‰æœºå™¨)1234567891011121314151617181920212223## Create /etc/docker directory.mkdir /etc/docker# Setup daemon.cat &gt; /etc/docker/daemon.json &lt;&lt;EOF&#123; &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;], &quot;log-driver&quot;: &quot;json-file&quot;, &quot;log-opts&quot;: &#123; &quot;max-size&quot;: &quot;100m&quot; &#125;, &quot;storage-driver&quot;: &quot;overlay2&quot;, &quot;storage-opts&quot;: [ &quot;overlay2.override_kernel_check=true&quot; ]&#125;EOFmkdir -p /etc/systemd/system/docker.service.d# Restart Dockersystemctl daemon-reloadsystemctl restart docker 3.4 ç¼–è¾‘ç¯å¢ƒå˜é‡(æ‰€æœ‰æœºå™¨)12345678vim /etc/sysctl.conf# æ·»åŠ ä¸¤è¡Œnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1sysctl -psystemctl daemon-reload 3.5 å…³é—­swapåˆ†åŒº(æ‰€æœ‰æœºå™¨)1234567swapoff -avim /etc/fstab# æ³¨é‡Šæ‰swapåˆ†åŒºå¯åŠ¨æŒ‚è½½çš„é‚£ä¸€è¡Œ# é‡å¯æœºå™¨reboot 3.6 æ‹‰å–é•œåƒæˆ‘ä»¬å¯ä»¥ä½¿ç”¨kubeadm config images pullçœ‹çœ‹éœ€è¦æ‹‰å–å“ªäº›é•œåƒç‰ˆæœ¬ï¼Œç„¶åæ ¹æ®é”™è¯¯æç¤ºæ¥å¯¹ä¸‹é¢çš„ç‰ˆæœ¬è¿›è¡Œä¿®æ”¹ã€‚ 123456789101112131415161718192021222324# https://hub.docker.com/r/mirrorgooglecontainers/kube-apiserver/tagsdocker pull mirrorgooglecontainers/kube-apiserver:v1.15.0# https://hub.docker.com/r/mirrorgooglecontainers/kube-proxy/tagsdocker pull mirrorgooglecontainers/kube-proxy:v1.15.0# https://hub.docker.com/r/mirrorgooglecontainers/kube-controller-manager/tagsdocker pull mirrorgooglecontainers/kube-controller-manager:v1.15.0# https://hub.docker.com/r/mirrorgooglecontainers/kube-scheduler/tagsdocker pull mirrorgooglecontainers/kube-scheduler:v1.15.0# https://hub.docker.com/r/mirrorgooglecontainers/etcd/tagsdocker pull mirrorgooglecontainers/etcd:3.3.10# https://hub.docker.com/r/mirrorgooglecontainers/pause/tagsdocker pull mirrorgooglecontainers/pause:3.1# https://hub.docker.com/r/mirrorgooglecontainers/kubernetes-dashboard-amd64/tagsdocker pull mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.1# https://hub.docker.com/r/coredns/coredns/tagsdocker pull coredns/coredns:1.3.1 ç”±äºå›½å†…ä¸èƒ½è®¿é—®k8så®˜ç½‘ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆä½¿ç”¨dockeræ‹‰å–é•œåƒï¼Œç„¶åä½¿ç”¨tagå¯¹å…¶æ›´æ”¹åç§°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940# æ‹‰å–dockerä¸Šçš„é•œåƒåˆ°æœ¬åœ°# https://hub.docker.com/r/mirrorgooglecontainers/kube-apiserver/tagsdocker pull mirrorgooglecontainers/kube-apiserver:v1.15.0# https://hub.docker.com/r/mirrorgooglecontainers/kube-proxy/tagsdocker pull mirrorgooglecontainers/kube-proxy:v1.15.0# https://hub.docker.com/r/mirrorgooglecontainers/kube-controller-manager/tagsdocker pull mirrorgooglecontainers/kube-controller-manager:v1.15.0# https://hub.docker.com/r/mirrorgooglecontainers/kube-scheduler/tagsdocker pull mirrorgooglecontainers/kube-scheduler:v1.15.0# https://hub.docker.com/r/mirrorgooglecontainers/etcd/tagsdocker pull mirrorgooglecontainers/etcd:3.3.10# https://hub.docker.com/r/mirrorgooglecontainers/pause/tagsdocker pull mirrorgooglecontainers/pause:3.1# https://hub.docker.com/r/mirrorgooglecontainers/kubernetes-dashboard-amd64/tagsdocker pull mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.1# https://hub.docker.com/r/coredns/coredns/tagsdocker pull coredns/coredns:1.3.1# ä½¿ç”¨tagå¯¹å…¶æ”¹åï¼Œæ–¹ä¾¿kubeadmç›´æ¥æ‹‰å–ä½¿ç”¨docker tag mirrorgooglecontainers/kube-apiserver:v1.15.0 k8s.gcr.io/kube-apiserver:v1.15.0docker tag mirrorgooglecontainers/kube-proxy:v1.15.0 k8s.gcr.io/kube-proxy:v1.15.0docker tag mirrorgooglecontainers/kube-controller-manager:v1.15.0 k8s.gcr.io/kube-controller-manager:v1.15.0docker tag mirrorgooglecontainers/kube-scheduler:v1.15.0 k8s.gcr.io/kube-scheduler:v1.15.0docker tag mirrorgooglecontainers/etcd:3.3.10 k8s.gcr.io/etcd:3.3.10docker tag mirrorgooglecontainers/pause:3.1 k8s.gcr.io/pause:3.1docker tag mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.1 k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1docker tag coredns/coredns:1.3.1 k8s.gcr.io/coredns:1.3.1# åˆ é™¤æ‰å¤šä½™çš„imagesdocker rmi mirrorgooglecontainers/kube-apiserver:v1.15.0docker rmi mirrorgooglecontainers/kube-proxy:v1.15.0docker rmi mirrorgooglecontainers/kube-controller-manager:v1.15.0docker rmi mirrorgooglecontainers/kube-scheduler:v1.15.0docker rmi mirrorgooglecontainers/etcd:3.3.10docker rmi mirrorgooglecontainers/pause:3.1docker rmi mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.1docker rmi coredns/coredns:1.3.1 æœ€åæ•ˆæœå¦‚ä¸‹ 3.7 åˆå§‹åŒ–masterèŠ‚ç‚¹ --kubernetes-versionå°±æ˜¯æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„k8sç‰ˆæœ¬ --apiserver-advertise-address æŒ‡æ˜ç”¨Masterçš„å“ªä¸ªinterfaceä¸Clusterçš„å…¶ä»–èŠ‚ç‚¹é€šä¿¡ã€‚å¦‚æœMasteræœ‰å¤šä¸ªinterfaceï¼Œå»ºè®®æ˜ç¡®æŒ‡å®šï¼Œå¦‚æœä¸æŒ‡å®šï¼Œkubeadmä¼šè‡ªåŠ¨é€‰æ‹©æœ‰é»˜è®¤ç½‘å…³çš„interface --pod-network-cidr æŒ‡å®šPodç½‘ç»œçš„èŒƒå›´ã€‚Kubernetesæ”¯æŒå¤šç§ç½‘ç»œæ–¹æ¡ˆï¼Œè€Œä¸”ä¸åŒç½‘ç»œæ–¹æ¡ˆå¯¹â€“pod-network-cidræœ‰è‡ªå·±çš„è¦æ±‚ï¼Œè¿™é‡Œè®¾ç½®ä¸º10.244.0.0/16æ˜¯å› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨flannelç½‘ç»œæ–¹æ¡ˆï¼Œå¿…é¡»è®¾ç½®æˆè¿™ä¸ªCIDR 1kubeadm init --kubernetes-version=v1.15.0 --apiserver-advertise-address 192.168.100.50 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12 æ³¨æ„çº¢æ¡†ä¸­çš„é‚£ä¸€ä¸²å¯†é’¥è¦ä¿å­˜å¥½ï¼Œåé¢æˆ‘ä»¬æ·»åŠ èŠ‚ç‚¹çš„æ—¶å€™éœ€è¦ç”¨åˆ°ã€‚ 3.8åœ¨masterä¸Šé…ç½®kubectlæ³¨æ„è¿™é‡Œè¦åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·è€Œä¸èƒ½ä½¿ç”¨rootç”¨æˆ·ï¼ æ³¨æ„è¿™é‡Œè¦åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·è€Œä¸èƒ½ä½¿ç”¨rootç”¨æˆ·ï¼ æ³¨æ„è¿™é‡Œè¦åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·è€Œä¸èƒ½ä½¿ç”¨rootç”¨æˆ·ï¼ 123456mkdir -p $HOME/.kubesudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configsudo chown $(id -u):$(id -g) $HOME/.kube/config# å¤šåŠ ä¸€ä¸ªkubectlçš„è‡ªåŠ¨è¡¥å…¨åŠ¨èƒ½æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc åˆ°è¿™é‡Œæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å®‰è£…é¡ºåˆ© 1234# è·å–é›†ç¾¤çŠ¶æ€kubectl get cs# è·å–é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯kubectl get nodes 4ã€å®‰è£…flannelç½‘ç»œ(Master)å®‰è£…flannel 12wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml -O kube-flannel.ymlkubectl apply -f kube-flannel.yml åˆ°è¿™é‡ŒmasterèŠ‚ç‚¹ä¸Šé¢çš„æ“ä½œå°±ç®—æ˜¯å®Œæˆäº† 1234# æŸ¥çœ‹podè¿è¡Œæƒ…å†µkubectl get pods -n kube-system# æŸ¥çœ‹å¹¶éªŒè¯èŠ‚ç‚¹ä¿¡æ¯æ˜¯å¦æˆåŠŸkubectl get nodes 5ã€æ·»åŠ nodeåœ¨nodeèŠ‚ç‚¹ä¸Šä½¿ç”¨rootç”¨æˆ·è¿è¡Œä¸‹åˆ—å‘½ä»¤å°†nodeèŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œä¸‹é¢çš„å¯†é’¥å°±æ˜¯åˆšåˆšå‰é¢ç”Ÿæˆçš„å¯†é’¥ï¼Œè€Œè¿™ä¸ª192.168.100.50:6443å°±æ˜¯masterèŠ‚ç‚¹çš„IPåœ°å€å’Œå¯¹åº”ç«¯å£ã€‚ 1kubeadm join --token 3pyvba.siol4xy1rvf2om8k --discovery-token-ca-cert-hash sha256:c61cdd8b8ad5d34faece61867e76d539dbc243c1f206eacbab163895777c099e 192.168.100.50:6443 æœ€åé¡ºåˆ©å¯åŠ¨ä¹‹ååº”è¯¥æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤º æç¤ºï¼š å¦‚æœnodeèŠ‚ç‚¹ä¸Šæ²¡æœ‰é¡ºåˆ©å‡ºç°runningçš„è¯ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯å› ä¸ºé•œåƒè¢«å¢™äº†æ— æ³•é¡ºåˆ©æ‹‰å–é•œåƒï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦æŒ‰ç…§æ­¥éª¤3.6ä¸­çš„æ“ä½œæ¥æ‰‹åŠ¨æ‹‰å–é•œåƒã€‚ æŸ¥çœ‹podè¿è¡Œæƒ…å†µçš„å‘½ä»¤ 1kubectl describe pod &lt;PodName&gt; --namespace=&lt;namespace&gt; è¾“å‡ºå†…å®¹å¤ªé•¿äº†ï¼Œè¿™é‡Œåªæˆªå–ä¸€éƒ¨åˆ†ã€‚","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"},{"name":"docker","slug":"docker","permalink":"https://tinychen.com/tags/docker/"}]},{"title":"k8sé‡è¦æ¦‚å¿µåŠå„ç»„ä»¶ç®€ä»‹","slug":"20190715-k8s-concepts-intro","date":"2019-07-15T02:00:00.000Z","updated":"2019-07-15T02:00:00.000Z","comments":true,"path":"20190715-k8s-concepts-intro/","link":"","permalink":"https://tinychen.com/20190715-k8s-concepts-intro/","excerpt":"è§£æk8sçš„é‡è¦æ¦‚å¿µå’Œä»‹ç»å…¶å·¥ä½œåŸç†ã€‚ ç®€å•ä»‹ç»ä¸€ä¸‹k8sä¸­çš„é‡è¦æ¦‚å¿µå’Œå„ä¸ªä¸»è¦çš„å·¥ä½œç»„ä»¶ï¼Œä¸»è¦å‚è€ƒäº†å®˜æ–¹çš„æŠ€æœ¯æ–‡æ¡£å’Œã€Šæ¯å¤©5åˆ†é’Ÿç©è½¬kubernetesã€‹ã€‚","text":"è§£æk8sçš„é‡è¦æ¦‚å¿µå’Œä»‹ç»å…¶å·¥ä½œåŸç†ã€‚ ç®€å•ä»‹ç»ä¸€ä¸‹k8sä¸­çš„é‡è¦æ¦‚å¿µå’Œå„ä¸ªä¸»è¦çš„å·¥ä½œç»„ä»¶ï¼Œä¸»è¦å‚è€ƒäº†å®˜æ–¹çš„æŠ€æœ¯æ–‡æ¡£å’Œã€Šæ¯å¤©5åˆ†é’Ÿç©è½¬kubernetesã€‹ã€‚ 1ã€é‡è¦æ¦‚å¿µ1. k8s/kubernetesKubernetes æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸º â€œèˆµæ‰‹â€ æˆ– â€œé£è¡Œå‘˜â€ï¼Œ ä¸”æ˜¯è‹±æ–‡governorå’Œ cyberneticçš„è¯æ ¹ã€‚ K8s æ˜¯é€šè¿‡å°† 8 ä¸ªå­—æ¯uberneteæ›¿æ¢ä¸º 8 è€Œå¯¼å‡ºçš„ç¼©å†™ã€‚ k8sæ˜¯è°·æ­Œåœ¨2014å¹´å‘å¸ƒçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå…¶ä¸»è¦ç”¨é€”å°±æ˜¯ç”¨æ¥ç®¡ç†å¤§é‡çš„å®¹å™¨ã€‚Kubernetes å»ºç«‹åœ¨ Google å…¬å¸è¶…è¿‡åä½™å¹´çš„è¿ç»´ç»éªŒåŸºç¡€ä¹‹ä¸Šï¼ŒGoogle æ‰€æœ‰çš„åº”ç”¨éƒ½è¿è¡Œåœ¨å®¹å™¨ä¸Šã€‚åœ¨è°·æ­Œå†…éƒ¨ï¼Œä½¿ç”¨çš„å®¹å™¨ç®¡ç†ç³»ç»Ÿå«Borgï¼Œç°åœ¨å·²ç»æ”¹åå«Omegaã€‚ï¼ˆå°±æ˜¯æ•°å­¦é‡Œé¢ç»å¸¸ç”¨åˆ°çš„é‚£ä¸ªæ¬§ç±³èŒ„ç¬¦åˆçš„è¯»éŸ³ï¼‰æ‰€ä»¥k8så…¶å®ç›¸å½“äºæ˜¯Borgçš„å¼€æºç‰ˆæœ¬ã€‚ æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹k8så®˜ç½‘çš„è¯´æ³•ï¼š Kubernetes æ˜¯ä¸€ä¸ªè·¨ä¸»æœºé›†ç¾¤çš„ å¼€æºçš„å®¹å™¨è°ƒåº¦å¹³å°ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨åŒ–åº”ç”¨å®¹å™¨çš„éƒ¨ç½²ã€æ‰©å±•å’Œæ“ä½œ , æä¾›ä»¥å®¹å™¨ä¸ºä¸­å¿ƒçš„åŸºç¡€æ¶æ„ã€‚ Kubernetes å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹: ä¾¿æºæ€§: æ— è®ºå…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘è¿˜æ˜¯å¤šäº‘æ¶æ„éƒ½å…¨é¢æ”¯æŒ å¯æ‰©å±•: å®ƒæ˜¯æ¨¡å—åŒ–ã€å¯æ’æ‹”ã€å¯æŒ‚è½½ã€å¯ç»„åˆçš„ï¼Œæ”¯æŒå„ç§å½¢å¼çš„æ‰©å±• è‡ªä¿®å¤: å®ƒå¯ä»¥è‡ªä¿æŒåº”ç”¨çŠ¶æ€ã€å¯è‡ªé‡å¯ã€è‡ªå¤åˆ¶ã€è‡ªç¼©æ”¾çš„ï¼Œé€šè¿‡å£°æ˜å¼è¯­æ³•æä¾›äº†å¼ºå¤§çš„è‡ªä¿®å¤èƒ½åŠ› 2. ClusterClusterå°±æ˜¯é›†ç¾¤çš„æ„æ€ï¼Œå³æ•´ä¸ªk8sç®¡ç†çš„æ‰€æœ‰æœºå™¨å’Œå®¹å™¨ç­‰ç­‰çš„æ€»ç§°ã€‚å®ƒæ˜¯è®¡ç®—ã€å­˜å‚¨å’Œç½‘ç»œèµ„æºçš„é›†åˆï¼Œk8såˆ©ç”¨è¿™äº›èµ„æºè¿è¡Œå„ç§åŸºäºå®¹å™¨çš„åº”ç”¨ã€‚ 3. MasterMasteræ˜¯Clusterä¸­çš„ç®¡ç†è€…ï¼Œå³è¯¥é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„è€å¤§æˆ–è€å¤§ä»¬ï¼Œå› ä¸ºMasterå¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œå¦‚æœæ˜¯æœ‰å¤šä¸ªMasterèŠ‚ç‚¹çš„é›†ç¾¤æˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºé«˜å¯ç”¨é›†ç¾¤ã€‚å®ƒçš„ä¸»è¦èŒè´£æ˜¯è°ƒåº¦ï¼Œå³å†³å®šå°†åº”ç”¨æ”¾åœ¨å“ªé‡Œè¿è¡Œã€‚ 4. NodeNodeçš„èŒè´£æ˜¯è¿è¡Œå®¹å™¨åº”ç”¨ã€‚Nodeç”±Masterç®¡ç†ï¼ŒNodeè´Ÿè´£ç›‘æ§å¹¶æ±‡æŠ¥å®¹å™¨çš„çŠ¶æ€ï¼ŒåŒæ—¶æ ¹æ®Masterçš„è¦æ±‚ç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚ 5. PodPodæ˜¯Kubernetesçš„æœ€å°å·¥ä½œå•å…ƒã€‚æ¯ä¸ªPodåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚Podä¸­çš„å®¹å™¨ä¼šä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«Masterè°ƒåº¦åˆ°ä¸€ä¸ªNodeä¸Šè¿è¡Œã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿æ˜¯åªæœ‰ä¸€ä¸ªå®¹å™¨ï¼ŒMasterä¹Ÿæ˜¯è¦æŠŠå®ƒä½œä¸ºä¸€ä¸ªPodè°ƒåº¦è¿è¡Œçš„ã€‚ Kubernetes å¼•å…¥Podä¸»è¦åŸºäºä¸‹é¢ä¸¤ä¸ªç›®çš„ï¼šï¼ˆ1ï¼‰å¯ç®¡ç†æ€§ã€‚æœ‰äº›å®¹å™¨å¤©ç”Ÿå°±æ˜¯éœ€è¦ç´§å¯†è”ç³»ï¼Œä¸€èµ·å·¥ä½œã€‚Podæä¾›äº†æ¯”å®¹å™¨æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œå°†å®ƒä»¬å°è£…åˆ°ä¸€ä¸ªéƒ¨ç½²å•å…ƒä¸­ã€‚Kubernetesä»¥Podä¸ºæœ€å°å•ä½è¿›è¡Œè°ƒåº¦ã€æ‰©å±•ã€å…±äº«èµ„æºã€ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚ï¼ˆ2ï¼‰é€šä¿¡å’Œèµ„æºå…±äº«ã€‚Pod ä¸­çš„æ‰€æœ‰å®¹å™¨ä½¿ç”¨åŒä¸€ä¸ªç½‘ç»œnamespaceï¼Œå³ç›¸åŒçš„IPåœ°å€å’ŒPortç©ºé—´ã€‚å®ƒä»¬å¯ä»¥ç›´æ¥ç”¨localhosté€šä¿¡ã€‚åŒæ ·çš„ï¼Œè¿™äº›å®¹å™¨å¯ä»¥å…±äº«å­˜å‚¨ï¼Œå½“KubernetesæŒ‚è½½ volumeåˆ°Podï¼Œæœ¬è´¨ä¸Šæ˜¯å°†volumeæŒ‚è½½åˆ°Podä¸­çš„æ¯ä¸€ä¸ªå®¹å™¨ã€‚ 6. namespaceKubernetesæ”¯æŒç”±åŒä¸€ç‰©ç†é›†ç¾¤æ”¯æŒçš„å¤šä¸ªè™šæ‹Ÿé›†ç¾¤ã€‚è¿™äº›è™šæ‹Ÿé›†ç¾¤ç§°ä¸ºnamespaceã€‚ namespaceæ—¨åœ¨ç”¨äºå¤šä¸ªç”¨æˆ·åˆ†å¸ƒåœ¨å¤šä¸ªå›¢é˜Ÿæˆ–é¡¹ç›®ä¸­çš„ç¯å¢ƒä¸­ã€‚å¯¹äºå…·æœ‰å‡ ä¸ªåˆ°å‡ åä¸ªç”¨æˆ·çš„é›†ç¾¤ï¼Œæ‚¨æ ¹æœ¬ä¸éœ€è¦åˆ›å»ºæˆ–è€ƒè™‘åç§°ç©ºé—´ã€‚å½“æ‚¨éœ€è¦å®ƒä»¬æä¾›çš„åŠŸèƒ½æ—¶ï¼Œè¯·å¼€å§‹ä½¿ç”¨å‘½åç©ºé—´ã€‚ namespaceæä¾›åç§°èŒƒå›´ã€‚ èµ„æºåç§°åœ¨namespaceä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯åœ¨ä¸åŒçš„namespaceä¸­ä¸å¿…å”¯ä¸€ã€‚ namespaceä¸èƒ½å½¼æ­¤åµŒå¥—ï¼Œå¹¶ä¸”æ¯ä¸ªKubernetesèµ„æºåªèƒ½ä½äºä¸€ä¸ªnamespaceä¸­ã€‚ namespaceæ˜¯ä¸€ç§åœ¨å¤šä¸ªç”¨æˆ·ä¹‹é—´åˆ’åˆ†ç¾¤é›†èµ„æºçš„æ–¹æ³•ï¼ˆé€šè¿‡èµ„æºé…é¢ï¼‰ã€‚ åœ¨Kubernetesçš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒä¸€namespaceä¸­çš„å¯¹è±¡å°†å…·æœ‰ç›¸åŒçš„è®¿é—®æ§åˆ¶ç­–ç•¥ã€‚ æ²¡æœ‰å¿…è¦ä½¿ç”¨å¤šä¸ªnamespaceæ¥åˆ†éš”ç•¥æœ‰ä¸åŒçš„èµ„æºï¼Œä¾‹å¦‚åŒä¸€è½¯ä»¶çš„ä¸åŒç‰ˆæœ¬ï¼šå¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¥åŒºåˆ†åŒä¸€namespaceä¸­çš„èµ„æºã€‚ 2ã€MasterèŠ‚ç‚¹Master ç»„ä»¶æä¾›çš„é›†ç¾¤æ§åˆ¶ã€‚Master ç»„ä»¶å¯¹é›†ç¾¤åšå‡ºå…¨å±€æ€§å†³ç­–(ä¾‹å¦‚ï¼šè°ƒåº¦)ï¼Œä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶(å‰¯æœ¬æ§åˆ¶å™¨çš„replicaså­—æ®µä¸æ»¡è¶³æ—¶,å¯åŠ¨æ–°çš„å‰¯æœ¬)ã€‚ Master ç»„ä»¶å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ç„¶è€Œï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œè®¾ç½®è„šæœ¬é€šå¸¸ä¼šå¯åŠ¨åŒä¸€ä¸ªè™šæ‹Ÿæœºä¸Šæ‰€æœ‰ Master ç»„ä»¶ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨æ­¤è™šæ‹Ÿæœºä¸Šè¿è¡Œç”¨æˆ·å®¹å™¨ã€‚ 2.1 kube-apiserverkube-apiserverå¯¹å¤–æš´éœ²äº†Kubernetes APIã€‚å®ƒæ˜¯çš„ Kubernetes å‰ç«¯æ§åˆ¶å±‚ã€‚å®ƒè¢«è®¾è®¡ä¸ºæ°´å¹³æ‰©å±•ï¼Œå³é€šè¿‡éƒ¨ç½²æ›´å¤šå®ä¾‹æ¥ç¼©æ”¾ã€‚ API Server æä¾›HTTP/HTTPS RESTful APIï¼Œå³Kubernetes APIã€‚API Serveræ˜¯Kubernetes Clusterçš„å‰ç«¯æ¥å£ï¼Œå„ç§å®¢æˆ·ç«¯å·¥å…·ï¼ˆCLIæˆ–UIï¼‰ä»¥åŠKuberneteså…¶ä»–ç»„ä»¶å¯ä»¥é€šè¿‡å®ƒç®¡ç†Clusterçš„å„ç§èµ„æºã€‚ 2.2 etcdetcdç”¨äº Kubernetes çš„åç«¯å­˜å‚¨ã€‚etcd è´Ÿè´£ä¿å­˜Kubernetes Clusterçš„é…ç½®ä¿¡æ¯å’Œå„ç§èµ„æºçš„çŠ¶æ€ä¿¡æ¯ï¼Œå§‹ç»ˆä¸º Kubernetes é›†ç¾¤çš„ etcd æ•°æ®æä¾›å¤‡ä»½è®¡åˆ’ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œetcd ä¼šå¿«é€Ÿåœ°é€šçŸ¥Kubernetesç›¸å…³ç»„ä»¶ã€‚ 2.3 kube-controller-managerkube-controller-managerè¿è¡Œæ§åˆ¶å™¨ï¼Œå®ƒä»¬æ˜¯å¤„ç†é›†ç¾¤ä¸­å¸¸è§„ä»»åŠ¡çš„åå°çº¿ç¨‹ã€‚é€»è¾‘ä¸Šï¼Œæ¯ä¸ªæ§åˆ¶å™¨æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œä½†ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘æˆç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨å•ä¸ªè¿›ç¨‹ä¸­è¿è¡Œã€‚ è¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬: èŠ‚ç‚¹æ§åˆ¶å™¨(Node Controller): å½“èŠ‚ç‚¹ç§»é™¤æ—¶ï¼Œè´Ÿè´£æ³¨æ„å’Œå“åº”ã€‚ å‰¯æœ¬æ§åˆ¶å™¨(Replication Controller): è´Ÿè´£ç»´æŠ¤ç³»ç»Ÿä¸­æ¯ä¸ªå‰¯æœ¬æ§åˆ¶å™¨å¯¹è±¡æ­£ç¡®æ•°é‡çš„ Podã€‚ ç«¯ç‚¹æ§åˆ¶å™¨(Endpoints Controller): å¡«å…… ç«¯ç‚¹(Endpoints) å¯¹è±¡(å³è¿æ¥ Services &amp; Pods)ã€‚ æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨(Service Account &amp; Token Controllers): ä¸ºæ–°çš„namespaceåˆ›å»ºé»˜è®¤å¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ. 2.4 kube-schedulerkube-schedulerä¸»è¦çš„å·¥ä½œå°±æ˜¯è°ƒåº¦æ–°åˆ›å»ºçš„Podï¼Œå½“é›†ç¾¤ä¸­å‡ºç°äº†æ–°çš„Podè¿˜æ²¡æœ‰ç¡®å®šåˆ†é…åˆ°å“ªä¸€ä¸ªNodeèŠ‚ç‚¹çš„æ—¶å€™ï¼Œkube-schedulerä¼šæ ¹æ®å„ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½ï¼Œä»¥åŠåº”ç”¨å¯¹é«˜å¯ç”¨ã€æ€§èƒ½ã€æ•°æ®äº²å’Œæ€§çš„éœ€æ±‚ç­‰å„ä¸ªæ–¹é¢è¿›è¡Œåˆ†æå¹¶å°†å…¶åˆ†é…åˆ°æœ€åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚ 2.5 Pod ç½‘ç»œPod è¦èƒ½å¤Ÿç›¸äº’é€šä¿¡ï¼ŒKubernetes Clusterå¿…é¡»éƒ¨ç½²Podç½‘ç»œï¼ŒPodç½‘ç»œä¹Ÿèƒ½ç®—æ˜¯å±äºè™šæ‹ŸåŒ–ç½‘ç»œ/SDNçš„ä¸€ç§ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰Calicoã€Flannelç­‰ï¼Œä¹Ÿæœ‰å…¶ä»–æ›´å¤æ‚é«˜çº§çš„æä¾›åŒæ—¶å¤šç§ç»„åˆç½‘ç»œå¦‚Canalã€Knitterã€Multusç­‰ã€‚ 3ã€NodeèŠ‚ç‚¹èŠ‚ç‚¹ç»„ä»¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œæ—¶ç¯å¢ƒã€‚ 3.1 kubeletkubeletæ˜¯k8sé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼ˆåŒ…æ‹¬masterèŠ‚ç‚¹ï¼‰éƒ½ä¼šè¿è¡Œçš„ä»£ç†ã€‚ å®ƒèƒ½å¤Ÿä¿è¯å®¹å™¨éƒ½è¿è¡Œåœ¨ Pod ä¸­ã€‚kubelet ä¸ä¼šç®¡ç†ä¸æ˜¯ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨ã€‚ kubelet æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚ å½“Schedulerç¡®å®šåœ¨æŸä¸ªNodeä¸Šè¿è¡ŒPodåï¼Œä¼šå°†Podçš„å…·ä½“é…ç½®ä¿¡æ¯ï¼ˆimageã€volumeç­‰ï¼‰å‘é€ç»™è¯¥èŠ‚ç‚¹çš„kubeletï¼Œkubeletæ ¹æ®è¿™äº›ä¿¡æ¯åˆ›å»ºå’Œè¿è¡Œå®¹å™¨ï¼Œå¹¶å‘MasteræŠ¥å‘Šè¿è¡ŒçŠ¶æ€ã€‚ 3.2 kube-proxykube-proxy æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œ kube-proxyé€šè¿‡ç»´æŠ¤ä¸»æœºä¸Šçš„ç½‘ç»œè§„åˆ™å¹¶æ‰§è¡Œè¿æ¥è½¬å‘ï¼Œå®ç°äº†KubernetesæœåŠ¡æŠ½è±¡ã€‚ serviceåœ¨é€»è¾‘ä¸Šä»£è¡¨äº†åç«¯çš„å¤šä¸ªPodï¼Œå¤–ç•Œé€šè¿‡serviceè®¿é—®Podã€‚serviceæ¥æ”¶åˆ°çš„è¯·æ±‚å°±æ˜¯é€šè¿‡kube-proxyè½¬å‘åˆ°Podä¸Šçš„ï¼Œkube-proxyæœåŠ¡è´Ÿè´£å°†è®¿é—®serviceçš„TCP/UDPæ•°æ®æµè½¬å‘åˆ°åç«¯çš„å®¹å™¨ã€‚å¦‚æœæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œkube-proxyä¼šå®ç°è´Ÿè½½å‡è¡¡ã€‚","categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"}],"tags":[{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"}]},{"title":"åœ¨CentOS7ä¸Šå®‰è£…Zabbix4.2ç›‘æ§ç³»ç»Ÿ","slug":"20190712-centos7-install-zabbix42","date":"2019-07-12T02:00:00.000Z","updated":"2019-07-12T02:00:00.000Z","comments":true,"path":"20190712-centos7-install-zabbix42/","link":"","permalink":"https://tinychen.com/20190712-centos7-install-zabbix42/","excerpt":"åœ¨äº”å°CentOS7çš„è™šæ‹Ÿæœºä¸Šå°è¯•å®‰è£…Zabbix4.2ç”¨æ¥ç›‘æ§å„ä¸ªä¸»æœºçš„è¿è¡ŒçŠ¶å†µã€‚","text":"åœ¨äº”å°CentOS7çš„è™šæ‹Ÿæœºä¸Šå°è¯•å®‰è£…Zabbix4.2ç”¨æ¥ç›‘æ§å„ä¸ªä¸»æœºçš„è¿è¡ŒçŠ¶å†µã€‚ 1ã€masterå‰æœŸå‡†å¤‡å·¥ä½œ1.1 å…³é—­é˜²ç«å¢™å’ŒSELinux1234567891011sed -i &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/configsed -i &#x27;s/SELINUXTYPE=targeted/#&amp;/&#x27; /etc/selinux/config# å¯ä»¥è®¾ç½®é…ç½®æ–‡ä»¶æ°¸ä¹…å…³é—­setenforce 0# æ›´æ”¹selinuxéœ€è¦é‡å¯ç³»ç»Ÿæ‰ä¼šç”Ÿæ•ˆreboot# å…³é—­é˜²ç«å¢™# ä¸€èˆ¬æ¥è¯´centos7é‡Œé¢é»˜è®¤æ²¡æœ‰iptablessystemctl stop iptables.servicesystemctl stop firewalld.service 1.2 ä¿®æ”¹å­—ç¬¦é›†ä¿®æ”¹å­—ç¬¦é›†ï¼Œç¡®ä¿è¾“å‡ºä¸­æ–‡çš„æ—¶å€™ä¸ä¼šæŠ¥é”™ 123localedef -c -f UTF-8 -i zh_CN zh_CN.UTF-8export LC_ALL=zh_CN.UTF-8echo &#x27;LANG=zh_CN.UTF-8&#x27; &gt; /etc/locale.conf 2ã€masterå®‰è£…Mariadb2.1 å®‰è£…Mariadbéœ€è¦å®‰è£…ä¸€ä¸ªæ•°æ®åº“æ¥å­˜å‚¨zabbixç›‘æ§æ—¶äº§ç”Ÿçš„æ•°æ®ï¼Œåœ¨centos7ä¸­ï¼Œmysqlè¢«æ¢æˆäº†mariadb 123yum install mariadb mariadb-devel mariadb-server systemctl enable mariadbsystemctl start mariadb 2.2 å¯¼å…¥zabbixåˆå§‹æ•°æ®è¿™é‡Œæ˜¯å®˜æ–¹çš„æŒ‡å¯¼æ–‡æ¡£ https://www.zabbix.com/documentation/4.2/manual/appendix/install/db_scripts 1234567891011-- è®¾ç½®æ•°æ®åº“rootå¯†ç mysqladmin -u root -h localhost password &#x27;xxxxxxxx&#x27;-- è¿›å…¥mysqlåˆ›å»ºzabbixæ•°æ®åº“mysql -u root -p-- åˆ›å»ºzabbixæ•°æ®åº“å¹¶è®¾å®šå­—ç¬¦é›†å’Œæ ¡å¯¹é›†ä¸ºUTF8create database zabbix character set utf8 collate utf8_bin;-- åˆ›å»ºzabbixç”¨æˆ·å¹¶æˆæƒzabbixç”¨æˆ·å¯¹zabbixæ•°æ®åº“æœ‰å®Œå…¨æ“ä½œæƒé™grant all privileges on zabbix.* to zabbix@localhost identified by &#x27;xxxxxxxx&#x27;; 3ã€masterä¸Šå®‰è£…zabbix-server3.1 å®‰è£…zabbix-server12345# å¯¼å…¥å®˜ç½‘å¯¹åº”çš„centos7çš„rpmåŒ…# ä»é“¾æ¥ä¸­å¯ä»¥çœ‹åˆ°centos7å’Œrhel7ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ä¸€æ ·çš„rpm -Uvh https://repo.zabbix.com/zabbix/4.2/rhel/7/x86_64/zabbix-release-4.2-1.el7.noarch.rpmyum clean all å®˜ç½‘çš„yumæºæœ‰äº›æ—¶å€™å¯èƒ½ä¼šè¿ä¸ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒæºã€‚ 1234567891011121314[zabbix]name=Zabbix Official Repository - $basearchbaseurl=https://mirrors.aliyun.com/zabbix/zabbix/4.2/rhel/7/$basearch/enabled=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591[zabbix-non-supported]name=Zabbix Official Repository non-supported - $basearch baseurl=https://mirrors.aliyun.com/zabbix/non-supported/rhel/7/$basearch/enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIXgpgcheck=1 1yum install zabbix-server-mysql zabbix-web-mysql zabbix-agent 3.2 ä¿®æ”¹é…ç½®æ–‡ä»¶1234567# ä¿®æ”¹serverçš„é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥åˆšåˆšçš„æ•°æ®åº“è´¦æˆ·å¯†ç å’Œæ•°æ®åº“åvim /etc/zabbix/zabbix_server.confDBHost=localhostDBName=zabbixDBUser=zabbixDBPassword=xxxxxxxx 1234# ä¿®æ”¹PHPæ—¶åŒºvim /etc/httpd/conf.d/zabbix.conf# å°†ä¸‹é¢è¿™è¡Œä¿®æ”¹ä¸ºäºšæ´²ä¸Šæµ·php_value date.timezone Asia/Shanghai 3.3 ä¿®æ”¹é˜²ç«å¢™è®¾ç½®123456# æ·»åŠ httpdçš„80ã€zabbix-serverçš„10051å’Œzabbix-agentçš„10050ç›‘å¬ç«¯å£firewall-cmd --permanent --add-port=80/tcpfirewall-cmd --permanent --add-port=10050/tcpfirewall-cmd --permanent --add-port=10051/tcp# æŸ¥çœ‹æ˜¯å¦æˆåŠŸfirewall-cmd --permanent --list-all æœ€åæˆ‘ä»¬éœ€è¦é‡å¯zabbixæœåŠ¡ã€httpdæœåŠ¡å’ŒfirewallæœåŠ¡ä½¿å¾—ä¿®æ”¹çš„é…ç½®ç”Ÿæ•ˆã€‚ 12systemctl restart zabbix-server zabbix-agent httpd firewalldsystemctl enable zabbix-server zabbix-agent httpd firewalld 3.4 å¯¼å…¥æ•°æ®åº“12# å°†zabbixåˆå§‹æ•°æ®å¯¼å…¥åˆ°åˆšåˆšåˆ›å»ºçš„zabbixæ•°æ®åº“ä¸­zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p&#x27;xxxxxxxx&#x27; zabbix 4ã€è®¾ç½®zabbix-serverçš„webç«¯åœ¨å’ŒmasteråŒä¸€å±€åŸŸç½‘å†…çš„ä»»æ„ç”µè„‘çš„æµè§ˆå™¨ä¸Šè¾“å…¥zabbix-serverçš„IPåœ°å€åŠ ä¸Š/zabbix ç‚¹å‡»next stepï¼Œæˆ‘ä»¬å›å‘ç°æœ‰ä¸€å †çš„å‰ç½®è¦æ±‚ï¼Œå¦‚æ— æ„å¤–ï¼Œåº”è¯¥å…¨éƒ¨éƒ½æ˜¯ok æ¥ä¸‹æ¥æˆ‘ä»¬è¾“å…¥ä¹‹å‰åœ¨æ•°æ®åº“ä¸­åˆ›å»ºçš„zabbixç”¨æˆ·çš„è´¦å·å¯†ç  nameè¿™é‡Œæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„åå­—æ–¹ä¾¿ç¡®è®¤ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸è¾“å…¥ç•™ç©º æœ€åæˆ‘ä»¬ç¡®è®¤ä¸€ä¸‹å³å¯ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„æ‰€æœ‰é…ç½®éƒ½ä¿å­˜åœ¨äº†/etc/zabbix/web/zabbix.conf.phpè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œéœ€è¦çš„è¯æˆ‘ä»¬å¯ä»¥éšæ—¶ä¿®æ”¹ã€‚ é»˜è®¤çš„è´¦å·æ˜¯Adminå¯†ç æ˜¯zabbix,æ³¨æ„Aè¦å¤§å†™ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä¿®æ”¹å¯†ç å¹¶å¼€å¯ä¸­æ–‡æ”¯æŒ ç„¶åé‡æ–°ç™»å½•å°±èƒ½å¤Ÿç”Ÿæ•ˆäº†ã€‚ å¦‚æœåœ¨è¯­è¨€åˆ—è¡¨é‡Œé¢æ²¡æœ‰æ‰¾åˆ°ä¸­æ–‡çš„ï¼Œæ£€æŸ¥ä¸€ä¸‹/usr/share/zabbix/include/locales.inc.phpè¿™ä¸ªæ–‡ä»¶çš„chineseè¿™ä¸€æ æ˜¯å¦ä¸ºtrueï¼Œå¦‚æœä¸æ˜¯ï¼Œä¿®æ”¹ä¹‹åé‡å¯zabbixå³å¯ã€‚ è¿™é‡Œè¡¥å……è¯´æ˜ä¸€ä¸‹ï¼Œå¦‚æœéœ€è¦åœ¨å¤–ç½‘èƒ½å¤Ÿè®¿é—®zabbixçš„webç›‘æ§ç«¯ï¼Œéœ€è¦ç»™è¯¥masteråˆ†é…å…¬ç½‘IPæˆ–è€…æ˜¯ç«¯å£è½¬å‘æˆ–è€…æ˜¯è®¾ç½®frpåå‘ä»£ç†ã€‚ 5ã€agentä¸Šå®‰è£…zabbix-agent5.1 å®‰è£…zabbix-agentè¿™é‡Œæˆ‘ä»¬åŸºæœ¬æ˜¯é‡å¤ä¸Šé¢3.1çš„æ­¥éª¤ï¼Œä½†æ˜¯æœ€åå®‰è£…çš„æ¨¡å—æœ‰ç‚¹ä¸åŒã€‚ 12345rpm -Uvh https://repo.zabbix.com/zabbix/4.2/rhel/7/x86_64/zabbix-release-4.2-1.el7.noarch.rpmyum clean allyum install -y zabbix-agent zabbix-get 5.2 ä¿®æ”¹zabbix-agenté…ç½®æ–‡ä»¶1234567891011121314151617181920vim /etc/zabbix/zabbix_agentd.conf# ç„¶åæˆ‘ä»¬ä¿®æ”¹ä¸‹åˆ—å†…å®¹# zabbix-serverå†…ç½‘IPServer=zabbix-serverå†…ç½‘IP # zabbix-serverå†…ç½‘IPï¼ŒActiveè¡¨ç¤ºagentä¸»åŠ¨æ¨é€ServerActive=zabbix-serverå†…ç½‘IP# zabbix-agentèŠ‚ç‚¹åç§°ï¼Œéœ€è¦å’Œwebç«¯æ·»åŠ çš„åç§°ä¸€è‡´Hostname=è¯¥agentèŠ‚ç‚¹çš„å‘½å# å¯åŠ¨zabbix-agentå¹¶è®¾ç½®å¼€æœºå¯åŠ¨systemctl start zabbix-agentsystemctl enable zabbix-agent# æŸ¥çœ‹zabbix-agentè¿è¡ŒçŠ¶æ€systemctl status zabbix-agent 5.3 ä¿®æ”¹é˜²ç«å¢™è®¾ç½®123456# æ·»åŠ zabbix-agentçš„10050ç›‘å¬ç«¯å£ä¾‹å¤–firewall-cmd --permanent --add-port=10050/tcp# æŸ¥çœ‹æ˜¯å¦æˆåŠŸfirewall-cmd --permanent --list-all# é‡å¯firewallå’Œzabbixsystemctl restart firewalld.service zabbix-agent.service 5.4 åœ¨webç«¯æ·»åŠ ç›‘æ§ä¸»æœºç™»å½•webç«¯ï¼Œç‚¹å‡»é…ç½®â†’ä¸»æœºâ†’åˆ›å»ºä¸»æœº æ³¨æ„è¿™é‡Œçš„ä¸»æœºåç§°è¦å’Œé…ç½®æ–‡ä»¶ä¸­çš„hostnameä¸€è‡´ æ¨¡æ¿è¿™é‡Œæœ‰æä¾›å¾ˆå¤šé¢„è®¾çš„ç›‘æ§æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€‰æ‹© æœ€åæˆ‘ä»¬ç‚¹å‡»ä¸»æœºä¸‹é¢çš„æ·»åŠ ï¼Œå°±å¯ä»¥æˆåŠŸæ·»åŠ ä¸»æœºäº†ã€‚ æœ€åçš„æ•´ä½“æ•ˆæœå¦‚ä¸‹","categories":[{"name":"sre","slug":"sre","permalink":"https://tinychen.com/categories/sre/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"zabbix","slug":"zabbix","permalink":"https://tinychen.com/tags/zabbix/"},{"name":"monitor","slug":"monitor","permalink":"https://tinychen.com/tags/monitor/"}]},{"title":"RHEL7çš„ACLç®€ä»‹","slug":"20190711-rhel7-acl","date":"2019-07-11T03:00:00.000Z","updated":"2019-07-11T03:00:00.000Z","comments":true,"path":"20190711-rhel7-acl/","link":"","permalink":"https://tinychen.com/20190711-rhel7-acl/","excerpt":"RHEL7ä¸­çš„ACLçš„ç®€å•ä»‹ç»ã€‚ 1ã€ACLç®€ä»‹ACLæ˜¯Access Control Listçš„ç¼©å†™ï¼Œä¸»è¦çš„ç›®çš„æ˜¯åœ¨æä¾›ä¼ ç»Ÿçš„ownerï¼Œgroupï¼Œothersçš„read(r)ï¼Œwrite(w)ï¼Œexecute(x) æƒé™ä¹‹å¤–çš„ç»†éƒ¨æƒé™è®¾å®šã€‚ ACLå¯ä»¥é’ˆå¯¹å•ä¸€ä½¿ç”¨è€…ï¼Œå•ä¸€æ–‡ä»¶æˆ–ç›®å½•æ¥è¿›è¡Œrï¼Œwï¼Œxçš„æƒé™è§„èŒƒï¼Œå¯¹äºéœ€è¦ç‰¹æ®Šæƒé™çš„ä½¿ç”¨çŠ¶å†µéå¸¸æœ‰å¸®åŠ©ã€‚ACLä¸»è¦å¯ä»¥é’ˆå¯¹ä»¥ä¸‹ä¸‰è€…ï¼š ä½¿ç”¨è€…ï¼ˆuserï¼‰ï¼šå¯ä»¥é’ˆå¯¹ä½¿ç”¨è€…æ¥è®¾å®šæƒé™ ç¾¤ç»„ï¼ˆgroupï¼‰ï¼šé’ˆå¯¹ç¾¤ç»„ä¸ºå¯¹è±¡æ¥è®¾å®šå…¶æƒé™ é»˜è®¤å±æ€§ï¼ˆmaskï¼‰ï¼šè¿˜å¯ä»¥é’ˆå¯¹åœ¨è¯¥ç›®å½•ä¸‹åœ¨å»ºç«‹æ–°æ–‡ä»¶/ç›®å½•æ—¶ï¼Œè§„èŒƒæ–°æ•°æ®çš„é»˜è®¤æƒé™","text":"RHEL7ä¸­çš„ACLçš„ç®€å•ä»‹ç»ã€‚ 1ã€ACLç®€ä»‹ACLæ˜¯Access Control Listçš„ç¼©å†™ï¼Œä¸»è¦çš„ç›®çš„æ˜¯åœ¨æä¾›ä¼ ç»Ÿçš„ownerï¼Œgroupï¼Œothersçš„read(r)ï¼Œwrite(w)ï¼Œexecute(x) æƒé™ä¹‹å¤–çš„ç»†éƒ¨æƒé™è®¾å®šã€‚ ACLå¯ä»¥é’ˆå¯¹å•ä¸€ä½¿ç”¨è€…ï¼Œå•ä¸€æ–‡ä»¶æˆ–ç›®å½•æ¥è¿›è¡Œrï¼Œwï¼Œxçš„æƒé™è§„èŒƒï¼Œå¯¹äºéœ€è¦ç‰¹æ®Šæƒé™çš„ä½¿ç”¨çŠ¶å†µéå¸¸æœ‰å¸®åŠ©ã€‚ACLä¸»è¦å¯ä»¥é’ˆå¯¹ä»¥ä¸‹ä¸‰è€…ï¼š ä½¿ç”¨è€…ï¼ˆuserï¼‰ï¼šå¯ä»¥é’ˆå¯¹ä½¿ç”¨è€…æ¥è®¾å®šæƒé™ ç¾¤ç»„ï¼ˆgroupï¼‰ï¼šé’ˆå¯¹ç¾¤ç»„ä¸ºå¯¹è±¡æ¥è®¾å®šå…¶æƒé™ é»˜è®¤å±æ€§ï¼ˆmaskï¼‰ï¼šè¿˜å¯ä»¥é’ˆå¯¹åœ¨è¯¥ç›®å½•ä¸‹åœ¨å»ºç«‹æ–°æ–‡ä»¶/ç›®å½•æ—¶ï¼Œè§„èŒƒæ–°æ•°æ®çš„é»˜è®¤æƒé™ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªç›®å½•ï¼Œéœ€è¦ç»™ä¸€å †äººä½¿ç”¨ï¼Œæ¯ä¸ªäººæˆ–æ¯ä¸ªç¾¤ç»„æ‰€éœ€è¦çš„æƒé™å¹¶ä¸ç›¸åŒæ—¶ï¼Œåœ¨è¿‡å»ï¼Œä¼ ç»Ÿçš„Linuxä¸‰ç§èº«ä»½çš„ä¸‰ç§æƒé™æ˜¯æ— æ³•è¾¾åˆ°çš„ï¼Œå› ä¸ºåŸºæœ¬ä¸Šï¼Œä¼ ç»Ÿçš„Linuxæƒé™åªèƒ½é’ˆå¯¹ä¸€ä¸ªç”¨æˆ·ã€ä¸€ä¸ªç¾¤ç»„åŠéæ­¤ç¾¤ç»„çš„å…¶ä»–äººè®¾å®šæƒé™è€Œå·±ï¼Œæ— æ³•é’ˆå¯¹å•ä¸€ç”¨æˆ·æˆ–ä¸ªäººæ¥è®¾è®¡æƒé™ã€‚è€ŒACLçš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ç°æ›´åŠ ç»†åŒ–çš„è´¦æˆ·æ–‡ä»¶æƒé™æ§åˆ¶ã€‚ 2ã€setfaclACLçš„å®ç°ä¸»è¦æ˜¯é€šè¿‡setfaclå’Œgetfaclå‘½ä»¤æ¥æ“ä½œã€‚ getfaclï¼šå–å¾—æŸä¸ªæ–‡ä»¶/ç›®å½•çš„ACLè®¾å®šé¡¹ç›® setfaclï¼šè®¾å®šæŸä¸ªæ–‡ä»¶/ç›®å½•çš„ACLè§„èŒƒ getfaclçš„ä½¿ç”¨å’Œsetfaclä¸€æ ·ï¼Œä¸»è¦æ˜¯ç”¨æ¥æŸ¥çœ‹aclæƒé™ï¼Œå› æ­¤æˆ‘ä»¬ä¸»è¦æ¥çœ‹ä¸€ä¸‹setfaclçš„ç”¨æ³•ã€‚ setfaclçš„è‹±æ–‡å…¨ç§°æ˜¯set file access control list ,å³â€œè®¾ç½®æ–‡ä»¶è®¿é—®æ§åˆ¶åˆ—è¡¨â€ã€‚æ”¹å‘½ä»¤å¯ä»¥æ›´ç²¾ç¡®çš„æ§åˆ¶æƒé™çš„åˆ†é…ï¼Œæ¯”å¦‚è®©æŸä¸€ä¸ªç”¨æˆ·å¯¹æŸä¸€ä¸ªæ–‡ä»¶å…·æœ‰æŸç§æƒé™ã€‚ ACLæŒ‡æ–‡ä»¶çš„æ‰€æœ‰è€…ã€æ‰€å±ç»„ã€å…¶ä»–äººçš„è¯»/å†™/æ‰§è¡Œä¹‹å¤–çš„ç‰¹æ®Šçš„æƒé™ï¼Œ å¯¹äºéœ€è¦ç‰¹æ®Šæƒé™çš„ä½¿ç”¨çŠ¶å†µæœ‰ä¸€å®šå¸®åŠ©ã€‚ å¦‚ï¼ŒæŸä¸€ä¸ªæ–‡ä»¶ï¼Œä¸è®©å•ä¸€çš„æŸä¸ªç”¨æˆ·è®¿é—®ã€‚ è¯­æ³•æ ¼å¼ï¼š 1setfacl [-bkndRLP] &#123; -m|-M|-x|-X ... &#125; file ... æˆ‘ä»¬è¾“å…¥setfacl -hæŸ¥çœ‹ä¸€ä¸‹å¸®åŠ©æ–‡æ¡£ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢çš„å‚æ•°æ¯”è¾ƒå¤š 1234567891011121314151617181920setfacl 2.2.51 -- set file access control listsUsage: setfacl [-bkndRLP] &#123; -m|-M|-x|-X ... &#125; file ... -m, --modify=acl modify the current ACL(s) of file(s) -M, --modify-file=file read ACL entries to modify from file -x, --remove=acl remove entries from the ACL(s) of file(s) -X, --remove-file=file read ACL entries to remove from file -b, --remove-all remove all extended ACL entries -k, --remove-default remove the default ACL --set=acl set the ACL of file(s), replacing the current ACL --set-file=file read ACL entries to set from file --mask do recalculate the effective rights mask -n, --no-mask don&#x27;t recalculate the effective rights mask -d, --default operations apply to the default ACL -R, --recursive recurse into subdirectories -L, --logical logical walk, follow symbolic links -P, --physical physical walk, do not follow symbolic links --restore=file restore ACLs (inverse of `getfacl -R&#x27;) --test test mode (ACLs are not modified) -v, --version print version and exit -h, --help this help text è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œ-må’Œ-Mä»¥åŠ-xå’Œ-Xçš„åŒºåˆ«å°±åœ¨äºï¼Œå°å†™å­—æ¯æ˜¯åé¢ç›´æ¥è·Ÿéœ€è¦è®¾ç½®çš„aclè§„åˆ™ï¼Œè€Œå¤§å†™å­—æ¯åˆ™æ˜¯åœ¨åé¢è·Ÿç€ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œé¢å†™ç€aclè§„åˆ™ï¼Œåè€…é€‚ç”¨äºæ¯”è¾ƒå¤æ‚çš„aclè§„åˆ™è®¾å®šæƒ…å†µã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„é€‰é¡¹å‚æ•°ï¼š 1234567setfacl [-bkRd] [&#123;-ml-xï¼‰ac1å‚æ•°]ç›®æ ‡æ–‡ä»¶åé€‰é¡¹ä¸å‚æ•°ï¼š-mï¼šè®¾å®šåç»­çš„ac1å‚æ•°ç»™æ–‡ä»¶ä½¿ç”¨ï¼Œä¸å¯ä¸-xåˆç”¨ï¼›-xï¼šåˆ é™¤åç»­çš„ac1å‚æ•°ï¼Œä¸å¯ä¸-måˆç”¨ï¼›-bï¼šç§»é™¤[æ‰€æœ‰çš„]ACLè®¾å®šå‚æ•°ï¼›-kï¼šç§»é™¤[é¢„è®¾çš„]ACLå‚æ•°ï¼Œå…³äºæ‰€è°“çš„é¢„è®¾]å‚æ•°äºåç»­èŒƒä¾‹ä¸­ä»‹ç»ï¼›-Rï¼šé€’å½’è®¾å®šaclï¼Œäº¦å³åŒ…æ‹¬æ¬¡ç›®å½•éƒ½ä¼šè¢«è®¾å®šèµ·æ¥ï¼›-dï¼šè®¾å®šé¢„è®¾ac1å‚æ•°]çš„æ„æ€ï¼åªå¯¹ç›®å½•æœ‰æ•ˆï¼Œåœ¨è¯¥ç›®å½•æ–°å»ºçš„æ•°æ®ä¼šå¼•ç”¨æ­¤é»˜è®¤å€¼ 3ã€å®ä¾‹ç¤ºèŒƒ123456# è®¾ç½®ç”¨æˆ·tinychenå¯¹acltest1æœ‰è¯»å†™æ‰§è¡Œæƒé™setfacl -m u:tinychen:rwx acltest1# è®¾ç½®ç”¨æˆ·tinychenå¯¹acltest2æ— ä»»ä½•æƒé™setfacl -m u:tinychen:- acltest2# è®¾ç½®ç”¨æˆ·ç»„tinychenå¯¹acltest3æ— ä»»ä½•æƒé™setfacl -m g:tinychen:- acltest3 è®¾å®šäº†ACLæƒé™ä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹è¯¥æ–‡ä»¶æƒé™çš„æ—¶å€™ä¼šå‘ç°å¤šäº†ä¸€ä¸ª+å·ã€‚ ç„¶åæˆ‘ä»¬ä½¿ç”¨getfaclå‘½ä»¤æŸ¥çœ‹æ–‡ä»¶çš„æƒé™: 123# åˆ é™¤acltest1çš„æ‰€æœ‰aclæƒé™è®¾ç½®setfacl -b acltest1getfacl acltest1","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"acl","slug":"acl","permalink":"https://tinychen.com/tags/acl/"}]},{"title":"RHEL7ä¸­çš„CRONç®€ä»‹","slug":"20190710-rhel7-cron","date":"2019-07-10T02:50:00.000Z","updated":"2019-07-10T02:50:00.000Z","comments":true,"path":"20190710-rhel7-cron/","link":"","permalink":"https://tinychen.com/20190710-rhel7-cron/","excerpt":"RHEL7ä¸­çš„CRONåŠŸèƒ½ä»¥åŠä½¿ç”¨æ–¹å¼ç®€ä»‹ã€‚ 1ã€cronç®€ä»‹crond æ˜¯linuxä¸‹ç”¨æ¥å‘¨æœŸæ€§çš„æ‰§è¡ŒæŸç§ä»»åŠ¡æˆ–ç­‰å¾…å¤„ç†æŸäº›äº‹ä»¶çš„ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œä¸windowsä¸‹çš„è®¡åˆ’ä»»åŠ¡ç±»ä¼¼ï¼Œå½“å®‰è£…å®Œæˆæ“ä½œç³»ç»Ÿåï¼Œé»˜è®¤ä¼šå®‰è£…æ­¤æœåŠ¡ å·¥å…·ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å¯åŠ¨crondè¿›ç¨‹ï¼Œcrondè¿›ç¨‹æ¯åˆ†é’Ÿä¼šå®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåˆ™è‡ªåŠ¨æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚","text":"RHEL7ä¸­çš„CRONåŠŸèƒ½ä»¥åŠä½¿ç”¨æ–¹å¼ç®€ä»‹ã€‚ 1ã€cronç®€ä»‹crond æ˜¯linuxä¸‹ç”¨æ¥å‘¨æœŸæ€§çš„æ‰§è¡ŒæŸç§ä»»åŠ¡æˆ–ç­‰å¾…å¤„ç†æŸäº›äº‹ä»¶çš„ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œä¸windowsä¸‹çš„è®¡åˆ’ä»»åŠ¡ç±»ä¼¼ï¼Œå½“å®‰è£…å®Œæˆæ“ä½œç³»ç»Ÿåï¼Œé»˜è®¤ä¼šå®‰è£…æ­¤æœåŠ¡ å·¥å…·ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å¯åŠ¨crondè¿›ç¨‹ï¼Œcrondè¿›ç¨‹æ¯åˆ†é’Ÿä¼šå®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåˆ™è‡ªåŠ¨æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚ æ³¨æ„Cronåœ¨è®¾ç½®å®šæ—¶ä»»åŠ¡çš„æ—¶å€™ï¼Œæœ€å¤šåªèƒ½ç²¾ç¡®åˆ°åˆ†é’Ÿè€Œæ— æ³•ç²¾ç¡®åˆ°ç§’ã€‚ Linuxä¸‹çš„ä»»åŠ¡è°ƒåº¦åˆ†ä¸ºä¸¤ç±»ï¼Œç³»ç»Ÿä»»åŠ¡è°ƒåº¦å’Œç”¨æˆ·ä»»åŠ¡è°ƒåº¦ã€‚ ç³»ç»Ÿä»»åŠ¡è°ƒåº¦ï¼šç³»ç»Ÿå‘¨æœŸæ€§æ‰€è¦æ‰§è¡Œçš„å·¥ä½œï¼Œæ¯”å¦‚å†™ç¼“å­˜æ•°æ®åˆ°ç¡¬ç›˜ã€æ—¥å¿—æ¸…ç†ç­‰ã€‚**/etc/crontabæ–‡ä»¶æ˜¯ç³»ç»Ÿä»»åŠ¡è°ƒåº¦çš„é…ç½®æ–‡ä»¶ã€‚** ç”¨æˆ·ä»»åŠ¡è°ƒåº¦ï¼šç”¨æˆ·å®šæœŸè¦æ‰§è¡Œçš„å·¥ä½œï¼Œæ¯”å¦‚ç”¨æˆ·æ•°æ®å¤‡ä»½ã€å®šæ—¶é‚®ä»¶æé†’ç­‰ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ crontab å·¥å…·æ¥å®šåˆ¶è‡ªå·±çš„è®¡åˆ’ä»»åŠ¡ã€‚æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„crontab æ–‡ä»¶éƒ½è¢«ä¿å­˜åœ¨ /var/spool/cronç›®å½•ä¸­ã€‚å…¶æ–‡ä»¶åä¸ç”¨æˆ·åä¸€è‡´ã€‚ 2ã€cronå®‰è£…12# cronçš„å®‰è£…è¿›ç¨‹æ˜¯cronieyum install -y cronie 1234567891011121314151617# è®¾ç½®cronå¼€æœºå¯åŠ¨systemctl enable crond.service# å…³é—­cronå¼€æœºå¯åŠ¨systemctl disable crond.service# å¯åŠ¨cronsystemctl start crond.service# æŸ¥çœ‹cronè¿è¡ŒçŠ¶æ€systemctl status crond.service# é‡å¯cronsystemctl restart crond.service# å…³é—­cronsystemctl stop crond.service 3ã€cronç›¸å…³æ–‡ä»¶æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹åœ¨/etcç›®å½•ä¸‹å’Œcronç›¸å…³çš„æ–‡ä»¶ä¸»è¦æœ‰å“ªäº›ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€ä¸ªå¯¹å…¶è¿›è¡Œåˆ†æã€‚ 3.1 /etc/crontabæˆ‘ä»¬catä¸€ä¸‹/etc/crontabè¿™ä¸ªæ–‡ä»¶çœ‹çœ‹é‡Œé¢çš„å†…å®¹ 1234567891011121314151617# ä½¿ç”¨å“ªç§she11æ¥å£SHELL=/bin/bash# æ‰§è¡Œæ–‡ä»¶æœå¯»è·¯å¾„PATH=/sbin:/bin:/usr/sbin:/usr/bin# è‹¥æœ‰é¢å¤–STDOUTï¼Œä»¥emailå°†æ•°æ®é€ç»™è°MAILTO=root# For details see man 4 crontabs# Example of job definition:# .---------------- minute (0 - 59)# | .------------- hour (0 - 23)# | | .---------- day of month (1 - 31)# | | | .------- month (1 - 12) OR jan,feb,mar,apr ...# | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat# | | | | |# * * * * * user-name command to be executed MAILTO=rootï¼šè¿™ä¸ªé¡¹ç›®æ˜¯è¯´ï¼Œå½“/etc/crontabè¿™ä¸ªæ–‡ä»¶ä¸­çš„ä¾‹è¡Œæ€§å·¥ä½œçš„æŒ‡ä»¤å‘ç”Ÿé”™è¯¯æ—¶ï¼Œæˆ–è€…æ˜¯è¯¥å·¥ä½œçš„æ‰§è¡Œç»“æœæœ‰STDOUT/STDERRæ—¶ï¼Œé»˜è®¤æ˜¯ç”±ç³»ç»Ÿç›´æ¥å¯„å‘ä¸€å°mailç»™rootã€‚ç”±äºroot å¹¶æ— æ³•åœ¨å®¢æˆ·ç«¯ä¸­ä»¥POP3ä¹‹ç±»çš„åè®®æ¥æ”¶é‚®ä»¶ï¼Œå› æ­¤ä½ ä¹Ÿå¯ä»¥æ”¹æˆè‡ªå·±çš„é‚®ç®±ã€‚ PATHï¼šè¿™é‡Œå°±æ˜¯è¾“å…¥æ‰§è¡Œæ–‡ä»¶çš„æœå¯»è·¯å¾„ï¼Œä¸€èˆ¬ä½¿ç”¨é»˜è®¤çš„è·¯å¾„å³å¯ åˆ†-æ—¶-æ—¥-æœˆ-å‘¨-æ‰§è¡Œç”¨æˆ·-æ‰§è¡ŒæŒ‡ä»¤ï¼šä¸ƒä¸ªå­—æ®µçš„è®¾å®šï¼Œè¿™ä¸ª/etc/crontabé‡Œé¢å¯ä»¥è®¾å®šçš„åŸºæœ¬è¯­æ³•å°±åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œå½“æˆ‘ä»¬å¿˜äº†æ ¼å¼çš„æ—¶å€™å¯ä»¥catè¿™ä¸ªæ–‡ä»¶çœ‹ä¸€ä¸‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸å¡«å†™çš„å­—æ®µéœ€è¦ä½¿ç”¨æ˜Ÿå·*æ¥å ä½ï¼ŒåŒä¸€ä¸ªå­—æ®µè¦å†™å¤šä¸ªæ•°å­—çš„æ—¶å€™ç”¨è‹±æ–‡é€—å·éš”å¼€ï¼›æ‰§è¡Œç”¨æˆ·æ–¹é¢ï¼Œç³»ç»Ÿé»˜è®¤æ˜¯ä»¥rootçš„èº«ä»½æ¥è¿›è¡Œçš„ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è®¾å®šæ—¶é—´çš„æ—¶å€™ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨å‘¨å’Œæ—¥æœˆï¼Œå³æˆ‘ä»¬åªèƒ½è®¾å®šè¯¥ä»»åŠ¡åœ¨å‘¨å‡ æ‰§è¡Œæˆ–è€…æ˜¯å‡ æœˆå‡ æ—¥æ‰§è¡Œï¼Œä¸èƒ½åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œå¦åˆ™ç³»ç»Ÿå¯èƒ½ä¼šæ— æ³•æ­£ç¡®è¯†åˆ«ã€‚ 3.2 /etc/cron.allowå’Œ/etc/cron.deny/etc/cron.allowå’Œ/etc/cron.denyè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯å¯¹ä½¿ç”¨cronçš„ç”¨æˆ·è¿›è¡Œç®¡ç†ã€‚ è¿™é‡Œå¯ä»¥åˆ†ä¸ºå››ç§æƒ…å†µã€‚ å¦‚æœè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±åªæœ‰rootç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨crontabå‘½ä»¤ å¦‚æœåªå­˜åœ¨cron.allowï¼Œé‚£ä¹ˆå°±åªæœ‰cron.allowä¸Šé¢çš„ç”¨æˆ·èƒ½ä½¿ç”¨crontabå‘½ä»¤ï¼Œå¦‚æœrootç”¨æˆ·ä¹Ÿä¸åœ¨é‡Œé¢ï¼Œåˆ™rootç”¨æˆ·ä¹Ÿä¸èƒ½ä½¿ç”¨crontab å¦‚æœåªå­˜åœ¨cron.denyï¼Œé‚£ä¹ˆå°±åªæœ‰cron.denyä¸Šé¢çš„ç”¨æˆ·ä¸èƒ½ä½¿ç”¨crontabå‘½ä»¤ å¦‚æœä¸¤ä¸ªæ–‡ä»¶éƒ½å­˜åœ¨ï¼Œåˆ™åˆ—åœ¨cron.allowæ–‡ä»¶ä¸­è€Œä¸”æ²¡æœ‰åˆ—åœ¨cron.denyä¸­çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨crontabï¼Œå¦‚æœä¸¤ä¸ªæ–‡ä»¶ä¸­éƒ½æœ‰åŒä¸€ä¸ªç”¨æˆ·ï¼Œä»¥cron.allowæ–‡ä»¶é‡Œé¢æ˜¯å¦æœ‰è¯¥ç”¨æˆ·ä¸ºå‡†ï¼Œå¦‚æœcron.allowä¸­æœ‰è¯¥ç”¨æˆ·ï¼Œåˆ™å¯ä»¥ä½¿ç”¨crontabå‘½ä»¤ crontabå‘½ä»¤æˆ‘ä»¬å°†åœ¨æœ¬æ–‡åé¢è®²è§£ 3.3 /etc/cron.d/etc/cron.d/ è¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾ä»»ä½•è¦æ‰§è¡Œçš„crontabæ–‡ä»¶æˆ–è„šæœ¬ 3.4./etc/cron.*ly/cron.monthly/ï¼Œ cron.weekly/ ï¼Œ cron.daily/ ï¼Œ cron.hourly/è¿™å››ä¸ªç›®å½•ä¸‹é¢å­˜æ”¾çš„æ–‡ä»¶ä¼šåœ¨å¯¹åº”çš„æ—¶é—´å†…è¢«æ‰§è¡Œï¼Œå¦‚ cron.hourly/é‡Œé¢çš„æ–‡ä»¶ä¼šåœ¨æ¯ä¸ªå°æ—¶è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ”¾ç½®çš„æ˜¯ç›´æ¥æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸Šè¿°çš„crontabæ ¼å¼çš„å®šæ—¶ä»»åŠ¡æè¿°æ–‡ä»¶ã€‚ 3.5 /var/spool/cron//var/spool/cron/ç›®å½•ä¸‹å­˜æ”¾ç€æ¯ä¸ªç”¨æˆ·è‡ªå·±çš„crontabæ–‡ä»¶ã€‚ 4ã€crontabå‘½ä»¤è¯­æ³•æ ¼å¼ï¼šcrontab [å‚æ•°] å¸¸ç”¨å‚æ•°ï¼š å‚æ•° å«ä¹‰ -e ç¼–è¾‘è¯¥ç”¨æˆ·çš„è®¡æ—¶å™¨è®¾ç½® -l åˆ—å‡ºè¯¥ç”¨æˆ·çš„è®¡æ—¶å™¨è®¾ç½® -r åˆ é™¤è¯¥ç”¨æˆ·çš„è®¡æ—¶å™¨è®¾ç½® -u æŒ‡å®šè¦è®¾å®šè®¡æ—¶å™¨çš„ç”¨æˆ·åç§° â€“help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ å‚è€ƒå®ä¾‹ 1234# ä½¿ç”¨tinychenç”¨æˆ·ï¼Œæ¯å¹´çš„1æœˆ1æ—¥è¾“å‡ºHappyNewYearï¼crontab -e -u tinychen# ç„¶åå’Œvimä¸€æ ·çš„ç¼–è¾‘æ¨¡å¼ï¼Œè¾“å…¥ä¸‹åˆ—å‚æ•°0 0 1 1 * /bin/echo HappyNewYear! &gt; /dev/pts/0 éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå’Œ/etc/crontabæ–‡ä»¶ä¸åŒï¼Œä½¿ç”¨crontabå‘½ä»¤è¿›å…¥åˆ°ç¼–è¾‘æ¨¡å¼çš„æ—¶å€™ä¸éœ€è¦å†åŠ æ‰§è¡Œç”¨æˆ·è¿™ä¸€å‚æ•°ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨å½“å‰çš„ç™»å½•è´¦æˆ·ï¼Œå¦‚æœéœ€è¦æŒ‡å®šï¼Œä½¿ç”¨-uå‚æ•°å³å¯ã€‚ æ­¤å¤–ï¼Œcrontabä¸­è¿˜æœ‰å‡ ç§ç®€åŒ–çš„å†™æ³•éœ€è¦æˆ‘ä»¬äº†è§£ä¸€ä¸‹ 1234567* ä»£è¡¨æ‰€æœ‰çš„å–å€¼èŒƒå›´å†…çš„æ•°å­—/ ä»£è¡¨æ¯çš„æ„æ€,å¦‚/5è¡¨ç¤ºæ¯5ä¸ªå•ä½- ä»£è¡¨ä»æŸä¸ªæ•°å­—åˆ°æŸä¸ªæ•°å­—, åˆ†å¼€å‡ ä¸ªç¦»æ•£çš„æ•°å­— éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcrontab -ræ˜¯åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰å®šæ—¶ä»»åŠ¡ã€‚ 5ã€å°ç»“ ä¸ªäººåŒ–çš„è¡Œä¸ºä½¿ç”¨crontab-eï¼š å¦‚æœä½ æ˜¯ä¾æ®ä¸ªäººéœ€æ±‚æ¥å»ºç«‹çš„ä¾‹è¡Œå·¥ä½œæ’ç¨‹ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨crontab-eã€‚è¿™æ ·ä¹Ÿèƒ½ä¿éšœä½ çš„æŒ‡ä»¤è¡Œä¸ºä¸ä¼šè¢«å¤§å®¶çœ‹åˆ°ï¼ˆ/etc/crontabæ˜¯å¤§å®¶éƒ½èƒ½è¯»å–çš„ï¼‰ï¼› ç³»ç»Ÿç»´æŠ¤ç®¡ç†ä½¿ç”¨vim/etc/crontabï¼š å¦‚æœè¿™ä¸ªä¾‹è¡Œå·¥ä½œæ’ç¨‹æ˜¯ç³»ç»Ÿçš„é‡è¦å·¥ä½œï¼Œä¸ºäº†è®©è‡ªå·±ç®¡ç†æ–¹ä¾¿ï¼ŒåŒæ—¶å®¹æ˜“è¿½è¸ªï¼Œå»ºè®®ç›´æ¥å†™å…¥/etc/crontabè¾ƒä½³ï¼ è‡ªå·±å¼€å‘è½¯ä»¶ä½¿ç”¨vim/etc/cron.d/newfileï¼š å¦‚æœæ˜¯æƒ³è¦è‡ªå·±å¼€å‘è½¯ä»¶ï¼Œé‚£å½“ç„¶æœ€å¥½å°±æ˜¯ä½¿ç”¨å…¨æ–°çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”æ”¾ç½®äº/etc/cron.d/ç›®å½•å†…å³å¯ã€‚ å›ºå®šæ¯å°æ—¶ã€æ¯æ—¥ã€æ¯å‘¨ã€æ¯å¤©æ‰§è¡Œçš„ç‰¹åˆ«å·¥ä½œï¼š å¦‚æœä¸ç³»ç»Ÿç»´æŠ¤æœ‰å…³ï¼Œè¿˜æ˜¯å»ºè®®æ”¾ç½®åˆ°/etc/crontabä¸­æ¥é›†ä¸­ç®¡ç†è¾ƒå¥½ã€‚å¦‚æœæƒ³è¦å·æ‡’ï¼Œæˆ–è€…æ˜¯ä¸€å®šè¦å†æŸä¸ªå‘¨æœŸå†…è¿›è¡Œçš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ”¾ç½®åˆ°ä¸Šé¢è°ˆåˆ°çš„å‡ ä¸ªç›®å½•ä¸­ï¼Œç›´æ¥å†™å…¥æŒ‡ä»¤å³å¯ï¼","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"cron","slug":"cron","permalink":"https://tinychen.com/tags/cron/"}]},{"title":"å¤šä¸»æœºé—´å®ç°SSHå…å¯†ç™»å½•","slug":"20190709-multi-ssh","date":"2019-07-09T07:30:00.000Z","updated":"2019-07-09T07:30:00.000Z","comments":true,"path":"20190709-multi-ssh/","link":"","permalink":"https://tinychen.com/20190709-multi-ssh/","excerpt":"K8Séƒ¨ç½²çš„å‰æœŸå‡†å¤‡å·¥ä½œï¼Œå¤šå°CentOSä¸»æœºä¹‹é—´ä½¿ç”¨SSHå…å¯†ç™»å½•ã€‚","text":"K8Séƒ¨ç½²çš„å‰æœŸå‡†å¤‡å·¥ä½œï¼Œå¤šå°CentOSä¸»æœºä¹‹é—´ä½¿ç”¨SSHå…å¯†ç™»å½•ã€‚ 1ã€å®ç°åŸç†è¿™é‡Œæˆ‘ä»¬éœ€è¦å®ç°çš„ä¸€å…±æœ‰ä¸¤ä¸ªæ•ˆæœï¼Œä¸€ä¸ªæ˜¯è¿™äº”å°CentOSä¸»æœºä¹‹é—´ä»»æ„ä¸¤å°ä¹‹é—´éƒ½èƒ½ä½¿ç”¨sshå…å¯†ç™»å½•ï¼Œå¦ä¸€ä¸ªå°±æ˜¯èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ ssh hostname çš„æ–¹å¼ç™»å½•è€Œä¸éœ€è¦ä½¿ç”¨ ssh account@ip_addrçš„æ–¹å¼ç™»å½•ã€‚ 1.1 rsaå¯†é’¥å¯¹ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬çš„SSHä½¿ç”¨çš„æ˜¯RSAç±»å‹çš„å¯†é’¥å¯¹ï¼Œä½¿ç”¨ssh-keygené»˜è®¤ç”Ÿæˆçš„ä¹Ÿæ˜¯RSAç±»å‹çš„å¯†é’¥å¯¹ã€‚ä¸€èˆ¬æ¥è¯´ä¼šäº§ç”Ÿä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯id_rsaå’Œid_rsa.pub,å…¶ä¸­å‰è€…æ˜¯ç§é’¥ï¼Œåè€…æ˜¯å…¬é’¥ã€‚ç§é’¥ä¸èƒ½æ³„éœ²ï¼Œè€Œå…¬é’¥æ˜¯æ”¾ç½®åœ¨ç›®æ ‡ä¸»æœºçš„authorized_keysæ–‡ä»¶ä¸­ï¼Œä»è€Œå®ç°å…å¯†ç™»å½•çš„æ•ˆæœã€‚ è¦å®ç°äº”å°CentOSä¸»æœºä¹‹é—´ä»»æ„ä¸¤å°ä¹‹é—´éƒ½èƒ½ä½¿ç”¨sshå…å¯†ç™»å½•ï¼Œåªéœ€è¦å°†è¿™äº”å°ä¸»æœºçš„id_rsa.pubéƒ½å­˜æ”¾åˆ°ä¸€ä¸ªauthorized_keysæ–‡ä»¶ä¸­ï¼Œç„¶åå†å°†è¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°æ¯ä¸€å°ä¸»æœºä¸Šå³å¯ã€‚ 1.2 hostsæ–‡ä»¶CentOSä¸­çš„/etc/hostsæ–‡ä»¶ä¸­å­˜æ”¾ç€ä¸»æœºåå’Œå¯¹åº”çš„ipåœ°å€ç­‰ä¿¡æ¯ï¼Œæƒ³è¦å®ç°ç›´æ¥ä½¿ç”¨ ssh hostname çš„æ–¹å¼ç™»å½•çš„æ•ˆæœï¼Œåªè¦åœ¨hostsæ–‡ä»¶ä¸­æ·»åŠ ipåœ°å€å’Œå¯¹åº”hostnameï¼ˆä¸»æœºåï¼‰å³å¯ã€‚ 2ã€æ“ä½œæ­¥éª¤2.1 å®‰è£…å¯ç”¨ssh123456# masterå’Œæ¯å°nodeèŠ‚ç‚¹ä¸Šå®‰è£…sshsudo yum install -y openssl openssh-server# masterå’Œæ¯å°nodeèŠ‚ç‚¹ä¸Šå¯åŠ¨sshå¹¶è®¾ç½®å¼€æœºè‡ªå¯systemctl start sshd.servicesystemctl enable sshd.service 2.2 ç”Ÿæˆå¯†é’¥å¯¹12# masterå’Œæ¯å°nodeèŠ‚ç‚¹ä¸Šéƒ½ç”Ÿæˆsshå¯†é’¥,æ¥ä¸‹æ¥ä¸€è·¯å›è½¦ssh-keygen éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæç¤ºè¾“å…¥çš„passphraseç›¸å½“äºsshå¯†é’¥å¯¹çš„å¯†ç ï¼Œä¸è¾“å…¥çš„è¯ç›´æ¥å›è½¦è·³è¿‡å³å¯ï¼Œè¾“å…¥äº†ä¹‹åï¼Œæ¯æ¬¡ä½¿ç”¨sshå…å¯†ç™»å½•çš„æ—¶å€™ä¼šå†è¦æ±‚è¾“å…¥passphraseä»¥ä¿è¯å®‰å…¨ã€‚ 123456789# å°†æ¯å°nodeèŠ‚ç‚¹çš„id_rsa.pubå¤åˆ¶åˆ°masterä¸Šé¢ï¼Œæ³¨æ„è¦é‡æ–°å‘½åé¿å…è¦†ç›–scp /home/tinychen/.ssh/id_rsa.pub tinychen@192.168.100.50:/home/tinychen/.ssh/node5*# åœ¨masterä¸Šä½¿ç”¨catå‘½ä»¤å°†masterå’Œæ‰€æœ‰nodeèŠ‚ç‚¹çš„id_rsa.pubè¿½åŠ åˆ°authorized_keysä¸­cat id_rsa.pub &gt;&gt; authorized_keyscat node51 &gt;&gt; authorized_keyscat node52 &gt;&gt; authorized_keyscat node53 &gt;&gt; authorized_keyscat node54 &gt;&gt; authorized_keys 2.3 é…ç½®sshd_config12# ç¼–è¾‘masterçš„sshé…ç½®æ–‡ä»¶ï¼Œå»æ‰çº¢åœˆä¸­ä¸‰é¡¹å‰é¢çš„#ä½¿å…¶ç”Ÿæ•ˆsudo vim /etc/ssh/sshd_config 2.4 ç¼–è¾‘hosts123456789# ç¼–è¾‘masterèŠ‚ç‚¹çš„/etc/hostsæ–‡ä»¶ï¼Œè¿½åŠ ipåœ°å€å’Œå¯¹åº”çš„ä¸»æœºåï¼Œä½¿å¾—èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ssh+ä¸»æœºåçš„æ–¹å¼ç™»å½•sudo vim /etc/hosts192.168.100.50 master50192.168.100.51 node51192.168.100.52 node52192.168.100.53 node53192.168.100.54 node54 2.5 å¤åˆ¶masterçš„é…ç½®æ–‡ä»¶123456# å°†masterèŠ‚ç‚¹çš„sshé…ç½®æ–‡ä»¶å¤åˆ¶åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Š# è¿™é‡Œå¿…é¡»ä½¿ç”¨rootè´¦æˆ·ï¼Œå¦åˆ™æƒé™ä¸è¶³sudo scp /etc/ssh/sshd_config root@192.168.100.51:/etc/ssh/sshd_configsudo scp /etc/ssh/sshd_config root@192.168.100.52:/etc/ssh/sshd_configsudo scp /etc/ssh/sshd_config root@192.168.100.53:/etc/ssh/sshd_configsudo scp /etc/ssh/sshd_config root@192.168.100.54:/etc/ssh/sshd_config 12345# å°†masterèŠ‚ç‚¹çš„authorized_keysæ–‡ä»¶å¤åˆ¶åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šscp /home/tinychen/.ssh/authorized_keys tinychen@192.168.100.51:/home/tinychen/.ssh/authorized_keysscp /home/tinychen/.ssh/authorized_keys tinychen@192.168.100.52:/home/tinychen/.ssh/authorized_keysscp /home/tinychen/.ssh/authorized_keys tinychen@192.168.100.53:/home/tinychen/.ssh/authorized_keysscp /home/tinychen/.ssh/authorized_keys tinychen@192.168.100.54:/home/tinychen/.ssh/authorized_keys 2.6 ä¿®æ”¹sshæ–‡ä»¶æƒé™123# å¯¹masterå’Œæ¯ä¸€ä¸ªnodeèŠ‚ç‚¹éƒ½è¿›è¡Œsshç›¸å…³æ–‡ä»¶æƒé™çš„ä¿®æ”¹sudo chmod 700 /home/tinychen/.ssh/sudo chmod 600 /home/tinychen/.ssh/* 3ã€éªŒè¯æ•ˆæœéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬ä¸€æ¬¡sshç™»å½•çš„æ—¶å€™ï¼Œå› ä¸ºknown_hostsæ–‡ä»¶é‡Œé¢æ²¡æœ‰ä¿å­˜è¿™å°ä¸»æœºçš„å¯¹åº”ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥yesæ‰èƒ½ç™»å½•ï¼Œä¹‹åä¾¿ä¸å†éœ€è¦ã€‚ æ­¤å¤–ï¼Œå¦‚æœä½¿ç”¨ssh+ä¸»æœºåçš„æ–¹å¼ç™»å½•ï¼Œä¸¤å°ä¸»æœºå¿…é¡»æ˜¯ä½¿ç”¨çš„åŒä¸€ä¸ªç”¨æˆ·ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯tinychenç”¨æˆ·ï¼Œç”±äºæˆ‘å·²ç»åœ¨sshçš„é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹äº†é…ç½®å…è®¸sshä½¿ç”¨rootè´¦æˆ·ç™»å½•ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·tinychenï¼Œå¦‚æœæœ‰éœ€è¦äº†å†åˆ‡æ¢åˆ°rootè´¦æˆ·ï¼Œä¿è¯å®‰å…¨æ€§ 4ã€è¡¥å……12345# å¦‚æœæƒ³è¦å®ç°rootè´¦æˆ·ä¹‹é—´çš„sshå…å¯†ç™»å½•ï¼Œå°†.sshæ–‡ä»¶å¤¹æ•´ä¸ªå¤åˆ¶è¿‡å»å³å¯rm -rf /root/.ssh/cp -r /home/tinychen/.ssh/ /root/chmod 700 /root/.ssh/chmod 600 /root/.ssh/*","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"ssh","slug":"ssh","permalink":"https://tinychen.com/tags/ssh/"}]},{"title":"CentOS7ä¿®æ”¹é»˜è®¤å¯åŠ¨çº§åˆ«","slug":"20190708-rhel7-change-init-level","date":"2019-07-08T11:00:00.000Z","updated":"2019-07-08T11:00:00.000Z","comments":true,"path":"20190708-rhel7-change-init-level/","link":"","permalink":"https://tinychen.com/20190708-rhel7-change-init-level/","excerpt":"Linuxä¸­çš„ä¸ƒç§å¯åŠ¨çº§åˆ«ä»‹ç»åŠCentOS7ä¿®æ”¹é»˜è®¤å¯åŠ¨çº§åˆ«çš„æ–¹æ³•ã€‚","text":"Linuxä¸­çš„ä¸ƒç§å¯åŠ¨çº§åˆ«ä»‹ç»åŠCentOS7ä¿®æ”¹é»˜è®¤å¯åŠ¨çº§åˆ«çš„æ–¹æ³•ã€‚ 1ã€Linuxçš„7ç§å¯åŠ¨çº§åˆ« ä»£å· å«ä¹‰ 0 å…³æœº 1 å•ç”¨æˆ· 2 å¤šç”¨æˆ·ï¼ˆæ— NFSï¼‰ 3 å¤šç”¨æˆ·ï¼ˆæœ‰NFSï¼‰ 4 æœªä½¿ç”¨ï¼Œä¿ç•™ç»™ç”¨æˆ· 5 GUIå›¾å½¢åŒ–æ¨¡å¼ 6 æ­£å¸¸å…³é—­ç³»ç»Ÿå¹¶é‡æ–°å¯åŠ¨ ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯3æˆ–è€…5ï¼Œç°åœ¨é»˜è®¤çš„ä¸€èˆ¬éƒ½æ˜¯5ï¼Œå¯ç”¨äº†GUIå›¾å½¢åŒ–ç•Œé¢ï¼Œæ–¹ä¾¿ç”¨æˆ·æ“ä½œï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™æˆ‘ä»¬è§‰å¾—GUIå¤ªå å†…å­˜ä¸”å¯åŠ¨å¤ªæ…¢ï¼Œåˆæˆ–è€…è§‰å¾—æ²¡æœ‰å¿…è¦å¯ç”¨GUIï¼Œå°±å¯ä»¥ä½¿ç”¨initå‘½ä»¤è¿›è¡Œåˆ‡æ¢ã€‚ 1234567891011# å…³æœºinit 0# åˆ‡æ¢åˆ°å‘½ä»¤è¡Œç•Œé¢init 3# åˆ‡æ¢åˆ°GUIç•Œé¢init 5# é‡å¯init 6 2ã€ä¿®æ”¹ç³»ç»Ÿé»˜è®¤å¯åŠ¨çº§åˆ«åœ¨CentOSä¸­ï¼Œä¸€èˆ¬æ˜¯/etc/inittabè¿™ä¸ªæ–‡ä»¶å¯¹ç³»ç»Ÿå¯åŠ¨çº§åˆ«è¿›è¡Œç®¡ç†ï¼Œä½†æ˜¯åˆ°äº†CentOS7ä¸­ï¼Œç”±äºå¼•å…¥äº†æ–°çš„ç®¡ç†å·¥å…·systemctlï¼Œè¿™ä¸ªæ–‡ä»¶å·²ç»è¢«å¼ƒç”¨ï¼Œæˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¯ä»¥çœ‹åˆ°ï¼š 1234567891011121314151617# inittab is no longer used when using systemd.## ADDING CONFIGURATION HERE WILL HAVE NO EFFECT ON YOUR SYSTEM.## Ctrl-Alt-Delete is handled by /usr/lib/systemd/system/ctrl-alt-del.target## systemd uses &#x27;targets&#x27; instead of runlevels. By default, there are two main targets:## multi-user.target: analogous to runlevel 3# graphical.target: analogous to runlevel 5## To view current default target, run:# systemctl get-default## To set a default target, run:# systemctl set-default TARGET.target# ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦ä½¿ç”¨systemctl set-defaultæ¥è®¾ç½®é»˜è®¤çš„å¯åŠ¨çº§åˆ«ã€‚ 12345678# æŸ¥çœ‹é»˜è®¤å¯åŠ¨çº§åˆ«systemctl get-default# è®¾ç½®é»˜è®¤å¯åŠ¨çº§åˆ«ä¸ºinit 3 å¤šç”¨æˆ·ï¼ˆNFSï¼‰çš„å‘½ä»¤è¡Œç•Œé¢systemctl set-default multi-user.target# è®¾ç½®é»˜è®¤å¯åŠ¨çº§åˆ«ä¸ºinit 5 GUIå›¾å½¢åŒ–ç•Œé¢systemctl set-default graphical.target é‡å¯ä¹‹åæˆ‘ä»¬å°±èƒ½çœ‹åˆ°ç³»ç»Ÿå·²ç»ä»¥æˆ‘ä»¬ä¿®æ”¹åçš„å¯åŠ¨çº§åˆ«æ¥è¿è¡Œäº†ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"RHEL7çš„yumç®€ä»‹","slug":"20190708-rhel7-yum-repo","date":"2019-07-08T07:00:00.000Z","updated":"2019-07-08T07:00:00.000Z","comments":true,"path":"20190708-rhel7-yum-repo/","link":"","permalink":"https://tinychen.com/20190708-rhel7-yum-repo/","excerpt":"RHEL7ä¸­çš„rpmå’Œyumçš„ç®€å•ä»‹ç»ã€‚","text":"RHEL7ä¸­çš„rpmå’Œyumçš„ç®€å•ä»‹ç»ã€‚ 1ã€RPMå’Œdpkgç®€ä»‹ç›®å‰åœ¨Linuxç•Œè½¯ä»¶å®‰è£…æ–¹å¼æœ€å¸¸è§çš„æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š dpkg è¿™ä¸ªæœºåˆ¶æœ€æ—©æ˜¯ç”±Debian Linuxç¤¾ç¾¤æ‰€å¼€å‘å‡ºæ¥çš„ï¼Œé€è¿‡dpkgçš„æœºåˆ¶ï¼ŒDebianæä¾›çš„è½¯ä»¶å°±èƒ½å¤Ÿç®€å•çš„å®‰è£…èµ·æ¥ï¼ŒåŒæ—¶è¿˜èƒ½æä¾›å®‰è£…åçš„è½¯ä»¶ä¿¡æ¯ï¼Œå®åœ¨éå¸¸ä¸é”™ã€‚åªè¦æ˜¯è¡ç”ŸäºDebiançš„å…¶ä»–Linux distributionså¤§å¤šä½¿ç”¨dpkgè¿™ä¸ªæœºåˆ¶æ¥ç®¡ç†è½¯ä»¶çš„ï¼ŒåŒ…æ‹¬B2Dï¼ŒUbuntuç­‰ç­‰ã€‚ RPM è¿™ä¸ªæœºåˆ¶æœ€æ—©æ˜¯ç”±Red Hat è¿™å®¶å…¬å¸å¼€å‘å‡ºæ¥çš„ï¼Œåæ¥å®åœ¨å¾ˆå¥½ç”¨ï¼Œå› æ­¤å¾ˆå¤šdistributionså°±ä½¿ç”¨è¿™ä¸ªæœºåˆ¶æ¥ä½œä¸ºè½¯ä»¶å®‰è£…çš„ç®¡ç†æ–¹å¼ã€‚åŒ…æ‹¬Fedoraï¼ŒCentOSï¼ŒSuSEç­‰ç­‰çŸ¥åçš„å¼€å‘å•†éƒ½æ˜¯ç”¨çš„RPMã€‚ å¦‚å‰æ‰€è¿°ï¼Œä¸è®ºdpkg/rpmè¿™äº›æœºåˆ¶æˆ–å¤šæˆ–å°‘éƒ½ä¼šæœ‰è½¯ä»¶ä¾èµ–çš„é—®é¢˜ï¼Œé‚£è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿå…¶å®å‰é¢ä¸æ˜¯è°ˆåˆ°è¿‡æ¯ä¸ªè½¯ä»¶æ–‡ä»¶éƒ½æœ‰æä¾›å¯¹åº”ä¾èµ–çš„çš„æ£€æŸ¥å—ï¼Ÿé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å°†æ¯ä¸ªè½¯ä»¶å¯¹åº”ä¾èµ–çš„æ•°æ®åšæˆåˆ—è¡¨ï¼Œç­‰åˆ°å®é™…è½¯ä»¶å®‰è£…æ—¶ï¼Œè‹¥å‘ç”Ÿéœ€è¦å®‰è£…ä¾èµ–çš„æƒ…å†µï¼Œä¾‹å¦‚å®‰è£…Aéœ€è¦å…ˆå®‰è£…Bä¸Cï¼Œè€Œå®‰è£…Båˆ™éœ€è¦å®‰è£…Dä¸Eæ—¶ï¼Œé‚£ä¹ˆå½“ä½ è¦å®‰è£…Aï¼Œé€šè¿‡æŸ¥è¯¢ä¾èµ–çš„æ•°æ®åˆ—è¡¨ï¼Œç®¡ç†æœºåˆ¶è‡ªåŠ¨å»å–å¾—Bï¼ŒCï¼ŒDï¼ŒEæ¥åŒæ—¶å®‰è£…ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„è§£å†³ä¾èµ–çš„äº†ã€‚ åœ¨dpkgç®¡ç†æœºåˆ¶ä¸Šå°±å¼€å‘å‡ºAPTçš„åœ¨çº¿å‡çº§æœºåˆ¶ï¼ŒRPMåˆ™ä¾å¼€å‘å•†çš„ä¸åŒï¼Œæœ‰Red Hatç³»ç»Ÿçš„yumï¼ŒSuSEç³»ç»Ÿçš„Yast Online Updateï¼ˆYOUï¼‰ç­‰ã€‚ distributionä»£è¡¨ è½¯ä»¶ç®¡ç†æœºåˆ¶ ä½¿ç”¨æŒ‡ä»¤ åœ¨çº¿å‡çº§æœºåˆ¶ï¼ˆæŒ‡ä»¤ï¼‰ Red Hat/Fedora RPM rpm yum(yum) Debian/Ubuntu dpkg dpkg apt(apt-get) 2ã€RPMå’ŒSRPM2.1 RPMRPMå…¨åæ˜¯RedHat Package Managerï¼Œç®€ç§°RPMã€‚é¡¾åæ€ä¹‰ï¼Œå½“åˆè¿™ä¸ªè½¯ä»¶ç®¡ç†çš„æœºåˆ¶æ˜¯ç”±Red Hat è¿™å®¶å…¬å¸å‘å±•å‡ºæ¥çš„ã€‚RPMæ˜¯ä»¥ä¸€ç§æ•°æ®åº“è®°å½•çš„æ–¹å¼æ¥å°†ä½ æ‰€éœ€è¦çš„è½¯ä»¶å®‰è£…åˆ°ä½ çš„Linuxç³»ç»Ÿçš„ä¸€å¥—ç®¡ç†æœºåˆ¶ã€‚ RPMæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å°†ä½ è¦å®‰è£…çš„è½¯ä»¶å…ˆç¼–è¯‘è¿‡ï¼Œå¹¶ä¸”æ‰“åŒ…æˆä¸ºRPMæœºåˆ¶çš„åŒ…è£…æ–‡ä»¶ï¼Œé€è¿‡åŒ…è£…å¥½çš„è½¯ä»¶é‡Œå¤´é»˜è®¤çš„æ•°æ®åº“è®°å½•ï¼Œè®°å½•è¿™ä¸ªè½¯ä»¶è¦å®‰è£…çš„æ—¶å€™å¿…é¡»å…·å¤‡çš„ä¾èµ–è½¯ä»¶ï¼Œå½“å®‰è£…åœ¨ä½ çš„Linuxä¸»æœºæ—¶ï¼ŒRPMä¼šå…ˆä¾ç…§è½¯ä»¶é‡Œå¤´çš„æ•°æ®æŸ¥è¯¢Linuxä¸»æœºçš„æ‰€éœ€ä¾èµ–è½¯ä»¶æ˜¯å¦æ»¡è¶³ï¼Œè‹¥æ»¡è¶³åˆ™äºˆä»¥å®‰è£…ï¼Œè‹¥ä¸æ»¡è¶³åˆ™ä¸äºˆå®‰è£…ã€‚é‚£ä¹ˆå®‰è£…çš„æ—¶å€™å°±å°†è¯¥è½¯ä»¶çš„ä¿¡æ¯æ•´ä¸ªå†™å…¥RPMçš„æ•°æ®åº“ä¸­ï¼Œä»¥ä¾¿æœªæ¥çš„æŸ¥è¯¢ã€éªŒè¯ä¸å¸è½½ï¼è¿™æ ·ä¸€æ¥çš„ä¼˜ç‚¹æ˜¯ï¼š ç”±äºå·²ç»ç¼–è¯‘å®Œæˆå¹¶ä¸”æ‰“åŒ…å®Œæ¯•ï¼Œæ‰€ä»¥è½¯ä»¶ä¼ è¾“ä¸å®‰è£…ä¸Šå¾ˆæ–¹ä¾¿ï¼ˆä¸éœ€è¦å†é‡æ–°ç¼–è¯‘ï¼‰ï¼› ç”±äºè½¯ä»¶çš„ä¿¡æ¯éƒ½å·²ç»è®°å½•åœ¨Linuxä¸»æœºçš„æ•°æ®åº“ä¸Šï¼Œå¾ˆæ–¹ä¾¿æŸ¥è¯¢ã€å‡çº§ä¸å¸è½½ã€‚ ç”±äºRPMæ–‡ä»¶æ˜¯å·²ç»ç¼–è¯‘å®Œæˆäº†çš„ï¼Œæ‰€ä»¥ï¼Œè¯¥è½¯ä»¶æ–‡ä»¶å‡ ä¹åªèƒ½å®‰è£…åœ¨åŸæœ¬é»˜è®¤çš„ç¡¬ä»¶ä¸æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ çš„ä¸»æœºç³»ç»Ÿç¯å¢ƒå¿…é¡»è¦ä¸å½“åˆå»ºç«‹è¿™ä¸ªè½¯ä»¶æ–‡ä»¶çš„ä¸»æœºç¯å¢ƒç›¸åŒæ‰è¡Œï¼ ä¸¾ä¾‹æ¥è¯´ï¼Œrp-pppoeè¿™ä¸ªADSLæ‹¨æ¥è½¯ä»¶ï¼Œä»–å¿…é¡»è¦åœ¨pppè¿™ä¸ªè½¯ä»¶å­˜åœ¨çš„ç¯å¢ƒä¸‹æ‰èƒ½è¿›è¡Œå®‰è£…ï¼å¦‚æœä½ çš„ä¸»æœºå¹¶æ²¡æœ‰pppè¿™ä¸ªè½¯ä»¶ï¼Œé‚£ä¹ˆå¾ˆæŠ±æ­‰ï¼Œé™¤éä½ å…ˆå®‰è£…pppå¦åˆ™rp-pppoeå°±æ˜¯ä¸è®©ä½ å®‰è£…çš„ï¼ˆå½“ç„¶ä½ å¯ä»¥å¼ºåˆ¶å®‰è£…ï¼Œä½†æ˜¯é€šå¸¸éƒ½ä¼šæœ‰ç‚¹é—®é¢˜å‘ç”Ÿå°±æ˜¯äº†ï¼ï¼‰ã€‚ 2.2 SRPMSRPMå°±æ˜¯Source RPMçš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªRPMæ–‡ä»¶é‡Œé¢å«æœ‰æºç ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªSRPMæ‰€æä¾›çš„è½¯ä»¶å†…å®¹å¹¶æ²¡æœ‰ç»è¿‡ç¼–è¯‘ï¼Œå®ƒæä¾›çš„æ˜¯åŸå§‹ç ã€‚ é€šå¸¸SRPMçš„æ‰©å±•åæ˜¯ä»¥***src.rpmè¿™ç§æ ¼å¼æ¥å‘½åçš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶RPMæä¾›çš„æ˜¯åŸå§‹ç ï¼Œä½†æ˜¯ä»–ä»ç„¶å«æœ‰è¯¥è½¯ä»¶æ‰€éœ€è¦çš„ä¾èµ–è½¯ä»¶è¯´æ˜ã€ä»¥åŠæ‰€æœ‰RPMæ–‡ä»¶æ‰€æä¾›çš„æ•°æ®ã€‚åŒæ—¶ï¼Œä»–ä¸RPMä¸åŒçš„æ˜¯ï¼Œä»–ä¹Ÿæä¾›äº†å‚æ•°é…ç½®æ–‡ä»¶ï¼ˆå°±æ˜¯configureä¸makefileï¼‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ä¸‹è½½çš„æ˜¯SRPMï¼Œé‚£ä¹ˆè¦å®‰è£…è¯¥è½¯ä»¶æ—¶ï¼Œä½ å°±å¿…é¡»è¦ï¼š å…ˆå°†è¯¥è½¯ä»¶ä»¥RPMç®¡ç†çš„æ–¹å¼ç¼–è¯‘ï¼Œæ­¤æ—¶SRPMä¼šè¢«ç¼–è¯‘æˆä¸ºRPMæ–‡ä»¶ï¼› ç„¶åå°†ç¼–è¯‘å®Œæˆçš„RPMæ–‡ä»¶å®‰è£…åˆ°Linuxç³»ç»Ÿå½“ä¸­ é€šå¸¸ä¸€ä¸ªè½¯ä»¶åœ¨é‡Šå‡ºçš„æ—¶å€™ï¼Œéƒ½ä¼šåŒæ—¶é‡Šå‡ºè¯¥è½¯ä»¶çš„RPMä¸SRPMã€‚æˆ‘ä»¬ç°åœ¨çŸ¥é“RPMæ–‡ä»¶å¿…é¡»è¦åœ¨ç›¸åŒçš„Linuxç¯å¢ƒä¸‹æ‰èƒ½å¤Ÿå®‰è£…ï¼Œè€ŒSRPMæ—¢ç„¶æ˜¯åŸå§‹ç çš„æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹SRPMå†…çš„å‚æ•°é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç¼–è¯‘äº§ç”Ÿèƒ½é€‚åˆæˆ‘ä»¬Linuxç¯å¢ƒçš„RPMæ–‡ä»¶ã€‚ 2.3 x86å’Œnoarchä¸€èˆ¬å¯¹åº”çš„rpmåŒ…ä¼šæœ‰ä¸åŒçš„å‡ ç§å¹³å°å¯¹åº”ï¼Œä¸‹è¡¨åˆ—å‡ºäº†æ¯”è¾ƒå¸¸è§çš„ä¸€äº›å¹³å°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç°åœ¨åŸºæœ¬å·²ç»å…¨éƒ¨æ­¥å…¥äº†64ä½æ—¶ä»£(ä¸»è¦æ˜¯æœåŠ¡å™¨ã€æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯)ï¼Œ==ä¸»æ‰“æœåŠ¡å™¨ç«¯çš„CentOS7å·²ç»ä¸å†å‘å¸ƒ32ä½ç‰ˆæœ¬ï¼Œå› æ­¤åœ¨CentOS7ä¸Šé¢è§åˆ°çš„ä¸»è¦æ˜¯x86_64å’Œnoarchã€‚== å¹³å° è¯´æ˜ i386 å‡ ä¹é€‚ç”¨äºæ‰€æœ‰çš„x86å¹³å°ï¼Œä¸è®ºæ˜¯æ—§çš„pentumæˆ–è€…æ˜¯æ–°çš„Intel Core2ä¸K8ç³»åˆ—çš„CPUç­‰ç­‰ï¼Œéƒ½å¯ä»¥æ­£å¸¸çš„å·¥ä½œã€‚é‚£ä¸ªiæŒ‡çš„æ˜¯Intelå…¼å®¹çš„CPUçš„æ„æ€ã€‚386å°±æ˜¯CPUçš„ç­‰çº§ã€‚ i586 å°±æ˜¯é’ˆå¯¹586ç­‰çº§çš„è®¡ç®—æœºè¿›è¡Œä¼˜åŒ–ç¼–è¯‘ã€‚é‚£æ˜¯å“ªäº›CPUå‘¢ï¼ŸåŒ…æ‹¬pentumç¬¬ä¸€ä»£MMXCPUï¼ŒAMDçš„K5ï¼ŒK6ç³»åˆ—CPUï¼ˆsocket7æ’è„šï¼‰ç­‰ç­‰çš„CPUéƒ½ç®—æ˜¯è¿™ä¸ªç­‰çº§ï¼› i686 åœ¨pentunllä»¥åçš„Intelç³»åˆ—CPUï¼ŒåŠK7ä»¥åç­‰çº§çš„CPUéƒ½å±äºè¿™ä¸ª686ç­‰çº§ï¼ç”±äºç›®å‰å¸‚é¢ä¸Šå‡ ä¹ä»…å‰©P-llä»¥åç­‰çº§çš„ç¡¬ä»¶å¹³å°ï¼Œå› æ­¤å¾ˆå¤šdistributionséƒ½ç›´æ¥é‡Šå‡ºè¿™ç§ç­‰çº§çš„RPMæ–‡ä»¶ã€‚ x86_64 é’ˆå¯¹64ä½çš„CPUè¿›è¡Œä¼˜åŒ–ç¼–è¯‘è®¾å®šï¼ŒåŒ…æ‹¬Intelçš„Core 2ä»¥ä¸Šç­‰çº§CPUï¼Œä»¥åŠAMDçš„Athlon64ä»¥åç­‰çº§çš„CPUï¼Œéƒ½å±äºè¿™ä¸€ç±»å‹çš„ç¡¬ä»¶å¹³å°ã€‚ noarch noarchæ˜¯no architectureçš„ç¼©å†™ï¼Œè¯´æ˜è¿™ä¸ªåŒ…å¯ä»¥åœ¨å„ä¸ªä¸åŒçš„cpuä¸Šä½¿ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§ç±»å‹çš„RPMæ–‡ä»¶ï¼Œé‡Œé¢åº”è¯¥æ²¡æœ‰binary programå­˜åœ¨ï¼Œè¾ƒå¸¸å‡ºç°çš„å°±æ˜¯å±äºshell scriptæ–¹é¢çš„è½¯ä»¶ã€‚ 3ã€Yum3.1 yumç®€ä»‹å½“å®¢æˆ·ç«¯æœ‰å‡çº§ã€å®‰è£…çš„éœ€æ±‚æ—¶ï¼Œyumä¼šå‘è½¯ä»¶åº“è¦æ±‚æ¸…å•çš„æ›´æ–°ï¼Œç­‰åˆ°æ¸…å•æ›´æ–°åˆ°æœ¬æœºçš„/var/cache/yumé‡Œé¢åï¼Œç­‰ä¸€ä¸‹æ›´æ–°æ—¶å°±ä¼šç”¨è¿™ä¸ªæœ¬æœºæ¸…å•ä¸æœ¬æœºçš„RPMæ•°æ®åº“è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ ·å°±çŸ¥é“è¯¥ä¸‹è½½ä»€ä¹ˆè½¯ä»¶ã€‚æ¥ä¸‹æ¥yumä¼šè·‘åˆ°è½¯ä»¶åº“æœåŠ¡å™¨ï¼ˆyum serverï¼‰ä¸‹è½½æ‰€éœ€è¦çš„è½¯ä»¶ï¼ˆå› ä¸ºæœ‰è®°å½•è½¯ä»¶æ‰€åœ¨çš„ç½‘å€ï¼‰ï¼Œç„¶åå†é€è¿‡RPMçš„æœºåˆ¶å¼€å§‹å®‰è£…è½¯ä»¶ã€‚è¿™å°±æ˜¯yumå®‰è£…è½¯ä»¶çš„æ•´ä¸ªæµç¨‹ã€‚ yumçš„repoæ–‡ä»¶ä¸€èˆ¬åœ¨/etc/yum.repo.d/ç›®å½•ä¸‹ï¼Œå¦‚å›¾æ‰€ç¤ºå°±æ˜¯å°ä¸ƒçš„CentOS7ä¸­çš„yum repo list 3.2 yum updateå’Œupgrade12345# å‡çº§æ‰€æœ‰åŒ…åŒæ—¶ä¹Ÿå‡çº§è½¯ä»¶å’Œç³»ç»Ÿå†…æ ¸yum update# åªå‡çº§æ‰€æœ‰åŒ…ï¼Œä¸å‡çº§è½¯ä»¶å’Œç³»ç»Ÿå†…æ ¸yum upgrade 3.3 yum repoæ–‡ä»¶æ„æˆä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªyum repoæ–‡ä»¶ç”±ä¸‹é¢çš„å‡ éƒ¨åˆ†æ„æˆ 123456789101112131415161718# å¿…é¡»æ˜¯ç‹¬ä¸€æ— äºŒçš„IDæ¥æ ‡è®°è¿™ä¸ªyum repoï¼Œå¦‚æœé‡å¤äº†ï¼Œåé¢çš„ä¼šè¦†ç›–æ‰å‰é¢çš„[serverid]# æ·»åŠ ä¸€æ®µæ–‡å­—æ¥æè¿°è¿™ä¸ªyum reponame=Description# è®¾ç½®èµ„æºåº“çš„åœ°å€ï¼Œå¯ä»¥æ˜¯httpæˆ–è€…ftpç­‰å¤šç§å½¢å¼baseurl=&#123;ftp://|http://|file://&#125;# enabled=1å¼€å¯æœ¬åœ°æ›´æ–°æ¨¡å¼enabled=&#123;1|0&#125;# gpgcheck=1è¡¨ç¤ºæ£€æŸ¥ï¼›å¯ä»¥ä¸æ£€æŸ¥gpgcheck=0gpgcheck=&#123;1|0&#125;# æ£€æŸ¥çš„keyï¼›å¦‚æœä¸Šé¢ä¸æ£€æŸ¥è¿™ä¸€è¡Œå¯ä»¥ä¸å†™# gpgkeyçš„åœ°å€ä¹Ÿå¯ä»¥æ˜¯httpæˆ–è€…ftpç­‰å¤šç§å½¢å¼gpgkey=","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"yum","slug":"yum","permalink":"https://tinychen.com/tags/yum/"}]},{"title":"RHEL7çš„SELinuxç®€ä»‹","slug":"20190707-rhel7-selinux","date":"2019-07-07T04:00:00.000Z","updated":"2019-07-07T04:00:00.000Z","comments":true,"path":"20190707-rhel7-selinux/","link":"","permalink":"https://tinychen.com/20190707-rhel7-selinux/","excerpt":"RHEL7ä¸­çš„SELinuxç®€å•ä»‹ç»ã€‚","text":"RHEL7ä¸­çš„SELinuxç®€å•ä»‹ç»ã€‚ 1ã€SELinuxç®€ä»‹SELinuxï¼ŒSecurity Enhanced Linux çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯å®‰å…¨å¼ºåŒ–çš„ Linuxï¼Œæ˜¯ç”±ç¾å›½å›½å®¶å®‰å…¨å±€ï¼ˆNSAï¼‰è”åˆå…¶ä»–å®‰å…¨æœºæ„ï¼ˆæ¯”å¦‚ SCC å…¬å¸ï¼‰å…±åŒå¼€å‘çš„ï¼Œæ—¨åœ¨å¢å¼ºä¼ ç»Ÿ Linux æ“ä½œç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œè§£å†³ä¼ ç»Ÿ Linux ç³»ç»Ÿä¸­è‡ªä¸»è®¿é—®æ§åˆ¶ï¼ˆDACï¼‰ç³»ç»Ÿä¸­çš„å„ç§æƒé™é—®é¢˜ï¼ˆå¦‚ root æƒé™è¿‡é«˜ç­‰ï¼‰ã€‚ SELinux é¡¹ç›®åœ¨ 2000 å¹´ä»¥ GPL åè®®çš„å½¢å¼å¼€æºï¼Œå½“ Red Hat åœ¨å…¶ Linux å‘è¡Œç‰ˆæœ¬ä¸­åŒ…æ‹¬äº† SELinux ä¹‹åï¼ŒSELinux æ‰é€æ­¥å˜å¾—æµè¡Œèµ·æ¥ã€‚ç°åœ¨ï¼ŒSELinux å·²ç»è¢«è®¸å¤šç»„ç»‡å¹¿æ³›ä½¿ç”¨ï¼Œå‡ ä¹æ‰€æœ‰çš„ Linux å†…æ ¸ 2.6 ä»¥ä¸Šç‰ˆæœ¬ï¼Œéƒ½é›†æˆäº† SELinux åŠŸèƒ½ã€‚ å¯¹äº SELinuxï¼Œåˆå­¦è€…å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå®ƒæ˜¯éƒ¨ç½²åœ¨ Linux ä¸Šç”¨äºå¢å¼ºç³»ç»Ÿå®‰å…¨çš„åŠŸèƒ½æ¨¡å—ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¼ ç»Ÿçš„ Linux ç³»ç»Ÿä¸­ï¼Œé»˜è®¤æƒé™æ˜¯å¯¹æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ã€æ‰€å±ç»„å’Œå…¶ä»–äººçš„è¯»ã€å†™å’Œæ‰§è¡Œæƒé™è¿›è¡Œæ§åˆ¶ï¼Œè¿™ç§æ§åˆ¶æ–¹å¼ç§°ä¸ºè‡ªä¸»è®¿é—®æ§åˆ¶ï¼ˆDACï¼‰æ–¹å¼ï¼›è€Œåœ¨ SELinux ä¸­ï¼Œé‡‡ç”¨çš„æ˜¯å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æ§åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯¹å…·ä½“æ–‡ä»¶ç³»ç»Ÿä¸Šé¢çš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦æ‹¥æœ‰è®¿é—®æƒé™ï¼Œè€Œåˆ¤æ–­è¿›ç¨‹æ˜¯å¦å¯ä»¥è®¿é—®æ–‡ä»¶æˆ–ç›®å½•çš„ä¾æ®ï¼Œå–å†³äº SELinux ä¸­è®¾å®šçš„å¾ˆå¤šç­–ç•¥è§„åˆ™ã€‚ è¯´åˆ°è¿™é‡Œï¼Œè¯»è€…æœ‰å¿…è¦è¯¦ç»†åœ°äº†è§£ä¸€ä¸‹è¿™ä¸¤ä¸ªè®¿é—®æ§åˆ¶ç³»ç»Ÿçš„ç‰¹ç‚¹ï¼š ä¸è¿‡ï¼Œç³»ç»Ÿä¸­æœ‰è¿™ä¹ˆå¤šçš„è¿›ç¨‹ï¼Œä¹Ÿæœ‰è¿™ä¹ˆå¤šçš„æ–‡ä»¶ï¼Œå¦‚æœæ‰‹å·¥æ¥è¿›è¡Œåˆ†é…å’ŒæŒ‡å®šï¼Œé‚£ä¹ˆå·¥ä½œé‡è¿‡å¤§ã€‚æ‰€ä»¥ SELinux æä¾›äº†å¾ˆå¤šçš„é»˜è®¤ç­–ç•¥è§„åˆ™ï¼Œè¿™äº›ç­–ç•¥è§„åˆ™å·²ç»è®¾å®šå¾—æ¯”è¾ƒå®Œå–„ï¼Œæˆ‘ä»¬ç¨åå†æ¥å­¦ä¹ å¦‚ä½•æŸ¥çœ‹å’Œç®¡ç†è¿™äº›ç­–ç•¥è§„åˆ™ã€‚ è‡ªä¸»è®¿é—®æ§åˆ¶ç³»ç»Ÿï¼ˆDiscretionary Access Controlï¼ŒDACï¼‰æ˜¯ Linux çš„é»˜è®¤è®¿é—®æ§åˆ¶æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¾æ®ç”¨æˆ·çš„èº«ä»½å’Œè¯¥èº«ä»½å¯¹æ–‡ä»¶åŠç›®å½•çš„ rwx æƒé™æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è®¿é—®ã€‚ä¸è¿‡ï¼Œåœ¨ DAC è®¿é—®æ§åˆ¶çš„å®é™…ä½¿ç”¨ä¸­æˆ‘ä»¬ä¹Ÿå‘ç°äº†ä¸€äº›é—®é¢˜ï¼š root æƒé™è¿‡é«˜ï¼Œrwx æƒé™å¯¹ root ç”¨æˆ·å¹¶ä¸ç”Ÿæ•ˆï¼Œä¸€æ—¦ root ç”¨æˆ·è¢«çªƒå–æˆ–è€… root ç”¨æˆ·æœ¬èº«çš„è¯¯æ“ä½œï¼Œéƒ½æ˜¯å¯¹ Linux ç³»ç»Ÿçš„è‡´å‘½å¨èƒã€‚ Linux é»˜è®¤æƒé™è¿‡äºç®€å•ï¼Œåªæœ‰æ‰€æœ‰è€…ã€æ‰€å±ç»„å’Œå…¶ä»–äººçš„èº«ä»½ï¼Œæƒé™ä¹Ÿåªæœ‰è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ï¼Œå¹¶ä¸åˆ©äºæƒé™ç»†åˆ†ä¸è®¾å®šã€‚ ä¸åˆç†æƒé™çš„åˆ†é…ä¼šå¯¼è‡´ä¸¥é‡åæœï¼Œæ¯”å¦‚ç»™ç³»ç»Ÿæ•æ„Ÿæ–‡ä»¶æˆ–ç›®å½•è®¾å®š 777 æƒé™ï¼Œæˆ–ç»™æ•æ„Ÿæ–‡ä»¶è®¾å®šç‰¹æ®Šæƒé™â€”â€”SetUID æƒé™ç­‰ã€‚ å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMandatory Access Controlï¼ŒMACï¼‰æ˜¯é€šè¿‡ SELinux çš„é»˜è®¤ç­–ç•¥è§„åˆ™æ¥æ§åˆ¶ç‰¹å®šçš„è¿›ç¨‹å¯¹ç³»ç»Ÿçš„æ–‡ä»¶èµ„æºçš„è®¿é—®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ æ˜¯ root ç”¨æˆ·ï¼Œä½†æ˜¯å½“ä½ è®¿é—®æ–‡ä»¶èµ„æºæ—¶ï¼Œå¦‚æœä½¿ç”¨äº†ä¸æ­£ç¡®çš„è¿›ç¨‹ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯ä¸èƒ½è®¿é—®è¿™ä¸ªæ–‡ä»¶èµ„æºçš„ã€‚ è¿™æ ·ä¸€æ¥ï¼ŒSELinux æ§åˆ¶çš„å°±ä¸å•å•åªæ˜¯ç”¨æˆ·åŠæƒé™ï¼Œè¿˜æœ‰è¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹èƒ½å¤Ÿè®¿é—®å“ªä¸ªæ–‡ä»¶èµ„æºï¼Œä»¥åŠæ¯ä¸ªæ–‡ä»¶èµ„æºå¯ä»¥è¢«å“ªäº›è¿›ç¨‹è®¿é—®ï¼Œéƒ½é  SELinux çš„è§„åˆ™ç­–ç•¥æ¥ç¡®å®šã€‚ 2ã€SELinuxä½œç”¨ æ³¨æ„ï¼Œåœ¨ SELinux ä¸­ï¼ŒLinux çš„é»˜è®¤æƒé™è¿˜æ˜¯æœ‰ä½œç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªç”¨æˆ·è¦èƒ½è®¿é—®ä¸€ä¸ªæ–‡ä»¶ï¼Œæ—¢è¦æ±‚è¿™ä¸ªç”¨æˆ·çš„æƒé™ç¬¦åˆ rwx æƒé™ï¼Œä¹Ÿè¦æ±‚è¿™ä¸ªç”¨æˆ·çš„è¿›ç¨‹ç¬¦åˆ SELinux çš„è§„å®šã€‚ ä¸è¿‡ï¼Œç³»ç»Ÿä¸­æœ‰è¿™ä¹ˆå¤šçš„è¿›ç¨‹ï¼Œä¹Ÿæœ‰è¿™ä¹ˆå¤šçš„æ–‡ä»¶ï¼Œå¦‚æœæ‰‹å·¥æ¥è¿›è¡Œåˆ†é…å’ŒæŒ‡å®šï¼Œé‚£ä¹ˆå·¥ä½œé‡è¿‡å¤§ã€‚æ‰€ä»¥ SELinux æä¾›äº†å¾ˆå¤šçš„é»˜è®¤ç­–ç•¥è§„åˆ™ï¼Œè¿™äº›ç­–ç•¥è§„åˆ™å·²ç»è®¾å®šå¾—æ¯”è¾ƒå®Œå–„ï¼Œæˆ‘ä»¬ç¨åå†æ¥å­¦ä¹ å¦‚ä½•æŸ¥çœ‹å’Œç®¡ç†è¿™äº›ç­–ç•¥è§„åˆ™ã€‚ ä¸ºäº†ä½¿è¯»è€…æ¸…æ¥šåœ°äº†è§£ SELinux æ‰€æ‰®æ¼”çš„è§’è‰²ï¼Œè¿™é‡Œä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾ apache ä¸Šå‘ç°äº†ä¸€ä¸ªæ¼æ´ï¼Œä½¿å¾—æŸä¸ªè¿œç¨‹ç”¨æˆ·å¯ä»¥è®¿é—®ç³»ç»Ÿçš„æ•æ„Ÿæ–‡ä»¶ï¼ˆå¦‚ /etc/shadowï¼‰ã€‚å¦‚æœæˆ‘ä»¬çš„ Linux ä¸­å¯ç”¨äº† SELinuxï¼Œé‚£ä¹ˆï¼Œå› ä¸º apache æœåŠ¡çš„è¿›ç¨‹å¹¶ä¸å…·å¤‡è®¿é—® /etc/shadow çš„æƒé™ï¼Œæ‰€ä»¥è¿™ä¸ªè¿œç¨‹ç”¨æˆ·é€šè¿‡ apache è®¿é—® /etc/shadowæ–‡ä»¶å°±ä¼šè¢« SELinux æ‰€é˜»æŒ¡ï¼Œèµ·åˆ°ä¿æŠ¤ Linux ç³»ç»Ÿçš„ä½œç”¨ ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSELinux çš„ MAC å¹¶ä¸ä¼šå®Œå…¨å–ä»£ DACï¼Œæ°æ°ç›¸åï¼Œå¯¹äº Linux ç³»ç»Ÿå®‰å…¨æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ï¼Œæ¢å¥è¯è¯´ï¼Œå½“ä½¿ç”¨ SELinux æ—¶ï¼ŒDAC ä»ç„¶è¢«ä½¿ç”¨ï¼Œä¸”ä¼šé¦–å…ˆè¢«ä½¿ç”¨ï¼Œå¦‚æœå…è®¸è®¿é—®ï¼Œå†ä½¿ç”¨ SELinux ç­–ç•¥ï¼›åä¹‹ï¼Œå¦‚æœ DAC è§„åˆ™æ‹’ç»è®¿é—®ï¼Œåˆ™æ ¹æœ¬æ— éœ€ä½¿ç”¨ SELinux ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œè‹¥ç”¨æˆ·å°è¯•å¯¹æ²¡æœ‰æ‰§è¡Œæƒé™ï¼ˆrw-ï¼‰çš„æ–‡ä»¶è¿›è¡Œæ‰§è¡Œæ“ä½œï¼Œé‚£ä¹ˆä¼ ç»Ÿçš„ DAC è§„åˆ™å°±ä¼šæ‹’ç»ç”¨æˆ·è®¿é—®ï¼Œå› æ­¤ï¼Œä¹Ÿå°±æ— éœ€å†ä½¿ç”¨ SELinux ç­–ç•¥ã€‚ ç›¸æ¯”ä¼ ç»Ÿçš„ Linux DAC å®‰å…¨æ§åˆ¶æ–¹å¼ï¼ŒSELinux å…·æœ‰è¯¸å¤šå¥½å¤„ï¼Œæ¯”å¦‚è¯´ï¼š å®ƒä½¿ç”¨çš„æ˜¯ MAC æ§åˆ¶æ–¹å¼ï¼Œè¿™è¢«è®¤ä¸ºæ˜¯æœ€å¼ºçš„è®¿é—®æ§åˆ¶æ–¹å¼ï¼› å®ƒèµ‹äºˆäº†ä¸»ä½“ï¼ˆç”¨æˆ·æˆ–è¿›ç¨‹ï¼‰æœ€å°çš„è®¿é—®ç‰¹æƒï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæ¯ä¸ªä¸»ä½“ä»…è¢«èµ‹äºˆäº†å®Œæˆç›¸å…³ä»»åŠ¡æ‰€å¿…é¡»çš„ä¸€ç»„æœ‰é™çš„æƒé™ã€‚é€šè¿‡èµ‹äºˆæœ€å°è®¿é—®ç‰¹æƒï¼Œå¯ä»¥é˜²æ­¢ä¸»ä½“å¯¹å…¶ä»–ç”¨æˆ·æˆ–è¿›ç¨‹äº§ç”Ÿä¸åˆ©çš„å½±å“ï¼› SELinux ç®¡ç†è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è¿è¡ŒåŒºåŸŸï¼ˆç§°ä¸ºåŸŸï¼‰ï¼Œå„è¿›ç¨‹ä»…è¿è¡Œåœ¨è‡ªå·±çš„åŸŸå†…ï¼Œæ— æ³•è®¿é—®å…¶ä»–è¿›ç¨‹å’Œæ–‡ä»¶ï¼Œé™¤éè¢«æˆäºˆäº†ç‰¹æ®Šæƒé™ã€‚ SELinux å¯ä»¥è°ƒæ•´åˆ° Permissive æ¨¡å¼ï¼Œæ­¤æ¨¡å¼å…è®¸æŸ¥çœ‹åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œ SELinux åæ‰€äº§ç”Ÿçš„å°è±¡ã€‚åœ¨ Permissive æ¨¡å¼ä¸­ï¼ŒSELinux ä»ç„¶ä¼šè®°å½•å®ƒæ‰€è®¤ä¸ºçš„å®‰å…¨æ¼æ´ï¼Œä½†å¹¶ä¸ä¼šé˜»æ­¢å®ƒä»¬ã€‚ å…¶å®ï¼Œæƒ³è¦äº†è§£ SELinux çš„ä¼˜ç‚¹ï¼Œæœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯æŸ¥çœ‹å½“ Linux ç³»ç»Ÿä¸Šæ²¡æœ‰è¿è¡Œ SELinux æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ã€‚ æ ¹æ®ç›¸å…³çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„çš„rwxæƒé™ï¼Œå¯ä»¥è®¿é—®ä»»ä½•æ–‡ä»¶æˆ–ç›®å½•ï¼› å®Œæˆå­˜åœ¨å®‰å…¨éšæ‚£çš„æ´»åŠ¨ï¼Œæ¯”å¦‚å…è®¸ä¸Šä¼ æ–‡ä»¶æˆ–æ›´æ”¹ç³»ç»Ÿæ˜¾ç¤ºï¼› å¯ä»¥ç›‘å¬ä»»ä½•ç«¯å£çš„ä¼ å…¥è¯·æ±‚ã€‚ ä½†åœ¨ä¸€ä¸ªå— SELinux çº¦æŸçš„ç³»ç»Ÿä¸Šï¼Œhttpd å®ˆæŠ¤è¿›ç¨‹å—åˆ°äº†æ›´åŠ ä¸¥æ ¼çš„æ§åˆ¶ã€‚ä»ç„¶ä½¿ç”¨ä¸Šé¢çš„ç¤ºä¾‹ï¼Œhttpedä»…èƒ½ç›‘å¬ SELinux å…è®¸å…¶ç›‘å¬çš„ç«¯å£ã€‚SELinux è¿˜å¯ä»¥é˜²æ­¢ httpd è®¿é—®ä»»ä½•æ²¡æœ‰æ­£ç¡®è®¾ç½®å®‰å…¨ä¸Šä¸‹æ–‡çš„æ–‡ä»¶ï¼Œå¹¶æ‹’ç»æ²¡æœ‰å† SELinux ä¸­æ˜¾å¼å¯ç”¨çš„ä¸å®‰å…¨æ´»åŠ¨ã€‚ å› æ­¤ï¼Œä»æœ¬è´¨ä¸Šè®²ï¼ŒSELinux æœ€å¤§ç¨‹åºä¸Šé™åˆ¶äº† Linux ç³»ç»Ÿä¸­çš„æ¶æ„ä»£ç æ´»åŠ¨ã€‚ 3ã€SELinuxå·¥ä½œæ¨¡å¼3.1 åŸºæœ¬æ¦‚å¿µè§£é‡Šåœ¨è§£é‡Š SELinux çš„å·¥ä½œæ¨¡å¼ä¹‹å‰ï¼Œå…ˆè§£é‡Šå‡ ä¸ªæ¦‚å¿µã€‚ ä¸»ä½“ï¼ˆSubjectï¼‰ï¼šå°±æ˜¯æƒ³è¦è®¿é—®æ–‡ä»¶æˆ–ç›®å½•èµ„æºçš„è¿›ç¨‹ã€‚æƒ³è¦å¾—åˆ°èµ„æºï¼ŒåŸºæœ¬æµç¨‹æ˜¯è¿™æ ·çš„ï¼šç”±ç”¨æˆ·è°ƒç”¨å‘½ä»¤ï¼Œç”±å‘½ä»¤äº§ç”Ÿè¿›ç¨‹ï¼Œç”±è¿›ç¨‹å»è®¿é—®æ–‡ä»¶æˆ–ç›®å½•èµ„æºã€‚åœ¨è‡ªä¸»è®¿é—®æ§åˆ¶ç³»ç»Ÿä¸­ï¼ˆLinux é»˜è®¤æƒé™ä¸­ï¼‰ï¼Œé æƒé™æ§åˆ¶çš„ä¸»ä½“æ˜¯ç”¨æˆ·ï¼›è€Œåœ¨å¼ºåˆ¶è®¿é—®æ§åˆ¶ç³»ç»Ÿä¸­ï¼ˆSELinux ä¸­ï¼‰ï¼Œé ç­–ç•¥è§„åˆ™æ§åˆ¶çš„ä¸»ä½“åˆ™æ˜¯è¿›ç¨‹ã€‚ ç›®æ ‡ï¼ˆObjectï¼‰ï¼šè¿™ä¸ªæ¦‚å¿µæ¯”è¾ƒæ˜ç¡®ï¼Œå°±æ˜¯éœ€è¦è®¿é—®çš„æ–‡ä»¶æˆ–ç›®å½•èµ„æºã€‚ ç­–ç•¥ï¼ˆPolicyï¼‰ï¼šLinux ç³»ç»Ÿä¸­è¿›ç¨‹ä¸æ–‡ä»¶çš„æ•°é‡åºå¤§ï¼Œé‚£ä¹ˆé™åˆ¶è¿›ç¨‹æ˜¯å¦å¯ä»¥è®¿é—®æ–‡ä»¶çš„ SELinux è§„åˆ™æ•°é‡å°±æ›´åŠ çƒ¦çï¼Œå¦‚æœæ¯ä¸ªè§„åˆ™éƒ½éœ€è¦ç®¡ç†å‘˜æ‰‹å·¥è®¾å®šï¼Œé‚£ä¹ˆ SELinux çš„å¯ç”¨æ€§å°±ä¼šæä½ã€‚è¿˜å¥½æˆ‘ä»¬ä¸ç”¨æ‰‹å·¥å®šä¹‰è§„åˆ™ï¼ŒSELinux é»˜è®¤å®šä¹‰äº†ä¸¤ä¸ªç­–ç•¥ï¼Œè§„åˆ™éƒ½å·²ç»åœ¨è¿™ä¸¤ä¸ªç­–ç•¥ä¸­å†™å¥½äº†ï¼Œé»˜è®¤åªè¦è°ƒç”¨ç­–ç•¥å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚è¿™ä¸¤ä¸ªé»˜è®¤ç­–ç•¥å¦‚ä¸‹ targetedï¼šè¿™æ˜¯ SELinux çš„é»˜è®¤ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥ä¸»è¦æ˜¯é™åˆ¶ç½‘ç»œæœåŠ¡çš„ï¼Œå¯¹æœ¬æœºç³»ç»Ÿçš„é™åˆ¶æå°‘ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç­–ç•¥å·²ç»è¶³å¤Ÿäº†ã€‚ mlsï¼šå¤šçº§å®‰å…¨ä¿æŠ¤ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥é™åˆ¶å¾—æ›´ä¸ºä¸¥æ ¼ã€‚ å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆSecurity Contextï¼‰ï¼šæ¯ä¸ªè¿›ç¨‹ã€æ–‡ä»¶å’Œç›®å½•éƒ½æœ‰è‡ªå·±çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œè¿›ç¨‹å…·ä½“æ˜¯å¦èƒ½å¤Ÿè®¿é—®æ–‡ä»¶æˆ–ç›®å½•ï¼Œå°±è¦çœ‹è¿™ä¸ªå®‰å…¨ä¸Šä¸‹æ–‡æ˜¯å¦åŒ¹é…ã€‚å¦‚æœè¿›ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡å’Œæ–‡ä»¶æˆ–ç›®å½•çš„å®‰å…¨ä¸Šä¸‹æ–‡èƒ½å¤ŸåŒ¹é…ï¼Œåˆ™è¯¥è¿›ç¨‹å¯ä»¥è®¿é—®è¿™ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚å½“ç„¶ï¼Œåˆ¤æ–­è¿›ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡å’Œæ–‡ä»¶æˆ–ç›®å½•çš„å®‰å…¨ä¸Šä¸‹æ–‡æ˜¯å¦åŒ¹é…ï¼Œåˆ™éœ€è¦ä¾é ç­–ç•¥ä¸­çš„è§„åˆ™ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å¯¹è±¡ï¼Œç”·äººå¯ä»¥çœ‹ä½œä¸»ä½“ï¼Œå¥³äººå°±æ˜¯ç›®æ ‡äº†ã€‚è€Œç”·äººæ˜¯å¦å¯ä»¥è¿½åˆ°å¥³äººï¼ˆä¸»ä½“æ˜¯å¦å¯ä»¥è®¿é—®ç›®æ ‡ï¼‰ï¼Œä¸»è¦çœ‹ä¸¤ä¸ªäººçš„æ€§æ ¼æ˜¯å¦åˆé€‚ï¼ˆä¸»ä½“å’Œç›®æ ‡çš„å®‰å…¨ä¸Šä¸‹æ–‡æ˜¯å¦åŒ¹é…ï¼‰ã€‚ä¸è¿‡ï¼Œä¸¤ä¸ªäººçš„æ€§æ ¼æ˜¯å¦åˆé€‚ï¼Œæ˜¯éœ€è¦é ç”Ÿæ´»ä¹ æƒ¯ã€ä¸ºäººå¤„ä¸–ã€å®¶åº­ç¯å¢ƒç­‰å…·ä½“çš„æ¡ä»¶æ¥è¿›è¡Œåˆ¤æ–­çš„ï¼ˆå®‰å…¨ä¸Šä¸‹æ–‡æ˜¯å¦åŒ¹é…æ˜¯éœ€è¦é€šè¿‡ç­–ç•¥ä¸­çš„è§„åˆ™æ¥ç¡®å®šçš„ï¼‰ã€‚ è§£é‡Šä¸€ä¸‹è¿™å¼ ç¤ºæ„å›¾ï¼šå½“ä¸»ä½“æƒ³è¦è®¿é—®ç›®æ ‡æ—¶ï¼Œå¦‚æœç³»ç»Ÿä¸­å¯åŠ¨äº† SELinuxï¼Œåˆ™ä¸»ä½“çš„è®¿é—®è¯·æ±‚é¦–å…ˆéœ€è¦å’Œ SELinux ä¸­å®šä¹‰å¥½çš„ç­–ç•¥è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœè¿›ç¨‹ç¬¦åˆç­–ç•¥ä¸­å®šä¹‰å¥½çš„è§„åˆ™ï¼Œåˆ™å…è®¸è®¿é—®ï¼Œè¿™æ—¶è¿›ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡å°±å¯ä»¥å’Œç›®æ ‡çš„å®‰å…¨ä¸Šä¸‹æ–‡è¿›è¡ŒåŒ¹é…ï¼›å¦‚æœæ¯”è¾ƒå¤±è´¥ï¼Œåˆ™æ‹’ç»è®¿é—®ï¼Œå¹¶é€šè¿‡ AVCï¼ˆAccess Vector Cacheï¼Œè®¿é—®å‘é‡ç¼“å­˜ï¼Œä¸»è¦ç”¨äºè®°å½•æ‰€æœ‰å’Œ SELinux ç›¸å…³çš„è®¿é—®ç»Ÿè®¡ä¿¡æ¯ï¼‰ç”Ÿæˆæ‹’ç»è®¿é—®ä¿¡æ¯ã€‚å¦‚æœå®‰å…¨ä¸Šä¸‹æ–‡åŒ¹é…ï¼Œåˆ™å¯ä»¥æ­£å¸¸è®¿é—®ç›®æ ‡æ–‡ä»¶ã€‚å½“ç„¶ï¼Œæœ€ç»ˆæ˜¯å¦å¯ä»¥çœŸæ­£åœ°è®¿é—®åˆ°ç›®æ ‡æ–‡ä»¶ï¼Œè¿˜è¦åŒ¹é…äº§ç”Ÿè¿›ç¨‹ï¼ˆä¸»ä½“ï¼‰çš„ç”¨æˆ·æ˜¯å¦å¯¹ç›®æ ‡æ–‡ä»¶æ‹¥æœ‰åˆç†çš„è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€‚ æˆ‘ä»¬åœ¨è¿›è¡Œ SELinux ç®¡ç†çš„æ—¶å€™ï¼Œä¸€èˆ¬åªä¼šä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œä½¿å…¶å’Œè®¿é—®è¿›ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡åŒ¹é…æˆ–ä¸åŒ¹é…ï¼Œç”¨æ¥æ§åˆ¶è¿›ç¨‹æ˜¯å¦å¯ä»¥è®¿é—®æ–‡ä»¶æˆ–ç›®å½•èµ„æºï¼›è€Œå¾ˆå°‘ä¼šå»ä¿®æ”¹ç­–ç•¥ä¸­çš„å…·ä½“è§„åˆ™ï¼Œå› ä¸ºè§„åˆ™å®åœ¨å¤ªå¤šäº†ï¼Œä¿®æ”¹èµ·æ¥è¿‡äºå¤æ‚ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥äººä¸ºå®šä¹‰è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆï¼Œç”¨ä»¥æ§åˆ¶è§„åˆ™çš„å¯ç”¨ä¸å…³é—­çš„ã€‚ 3.2 ä¸‰ç§å·¥ä½œæ¨¡å¼SELinux æä¾›äº† 3 ç§å·¥ä½œæ¨¡å¼ï¼šDisabledã€Permissive å’Œ Enforcingï¼Œè€Œæ¯ç§æ¨¡å¼éƒ½ä¸º Linux ç³»ç»Ÿå®‰å…¨æä¾›äº†ä¸åŒçš„å¥½å¤„ã€‚ Disableå·¥ä½œæ¨¡å¼ï¼ˆå…³é—­æ¨¡å¼ï¼‰åœ¨ Disable æ¨¡å¼ä¸­ï¼ŒSELinux è¢«å…³é—­ï¼Œé»˜è®¤çš„ DAC è®¿é—®æ§åˆ¶æ–¹å¼è¢«ä½¿ç”¨ã€‚å¯¹äºé‚£äº›ä¸éœ€è¦å¢å¼ºå®‰å…¨æ€§çš„ç¯å¢ƒæ¥è¯´ï¼Œè¯¥æ¨¡å¼æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ ä¾‹å¦‚ï¼Œè‹¥ä»ä½ çš„è§’åº¦çœ‹æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºå·¥ä½œæ­£å¸¸ï¼Œä½†æ˜¯å´äº§ç”Ÿäº†å¤§é‡çš„ SELinux AVC æ‹’ç»æ¶ˆæ¯ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå¡«æ»¡æ—¥å¿—æ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿæ— æ³•ä½¿ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€ç›´æ¥çš„è§£å†³æ–¹æ³•å°±æ˜¯ç¦ç”¨ SELinuxï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨åº”ç”¨ç¨‹åºæ‰€è®¿é—®çš„æ–‡ä»¶ä¸Šè®¾ç½®æ­£ç¡®çš„å®‰å…¨ä¸Šä¸‹æ–‡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç¦ç”¨ SELinux ä¹‹å‰ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸‹æ˜¯å¦å¯èƒ½ä¼šåœ¨ç³»ç»Ÿä¸Šå†æ¬¡ä½¿ç”¨ SELinuxï¼Œå¦‚æœå†³å®šä»¥åå°†å…¶è®¾ç½®ä¸º Enforcing æˆ– Permissiveï¼Œé‚£ä¹ˆå½“ä¸‹æ¬¡é‡å¯ç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿå°†ä¼šé€šè¿‡ä¸€ä¸ªè‡ªåŠ¨ SELinux æ–‡ä»¶é‡æ–°è¿›ç¨‹æ ‡è®°ã€‚ å…³é—­ SELinux çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/selinux/configï¼Œå¹¶å°†æ–‡æœ¬ä¸­ SELINUX= æ›´æ”¹ä¸º SELINUX=disabled å³å¯ï¼Œé‡å¯ç³»ç»Ÿåï¼ŒSELinux å°±è¢«ç¦ç”¨äº†ã€‚ Permissiveå·¥ä½œæ¨¡å¼ï¼ˆå®½å®¹æ¨¡å¼ï¼‰åœ¨ Permissive æ¨¡å¼ä¸­ï¼ŒSELinux è¢«å¯ç”¨ï¼Œä½†å®‰å…¨ç­–ç•¥è§„åˆ™å¹¶æ²¡æœ‰è¢«å¼ºåˆ¶æ‰§è¡Œã€‚å½“å®‰å…¨ç­–ç•¥è§„åˆ™åº”è¯¥æ‹’ç»è®¿é—®æ—¶ï¼Œè®¿é—®ä»ç„¶è¢«å…è®¸ã€‚ç„¶è€Œï¼Œæ­¤æ—¶ä¼šå‘æ—¥å¿—æ–‡ä»¶å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¡¨ç¤ºè¯¥è®¿é—®åº”è¯¥è¢«æ‹’ç»ã€‚ SELinux Permissive æ¨¡å¼ä¸»è¦ç”¨äºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š å®¡æ ¸å½“å‰çš„ SELinux ç­–ç•¥è§„åˆ™ï¼› æµ‹è¯•æ–°åº”ç”¨ç¨‹åºï¼Œçœ‹çœ‹å°† SELinux ç­–ç•¥è§„åˆ™åº”ç”¨åˆ°è¿™äº›ç¨‹åºæ—¶ä¼šæœ‰ä»€ä¹ˆæ•ˆæœï¼› è§£å†³æŸä¸€ç‰¹å®šæœåŠ¡æˆ–åº”ç”¨ç¨‹åºåœ¨ SELinux ä¸‹ä¸å†æ­£å¸¸å·¥ä½œçš„æ•…éšœã€‚ æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä½¿ç”¨ audit2allow å‘½ä»¤æ¥è¯»å– SELinux å®¡æ ¸æ—¥å¿—å¹¶ç”Ÿæˆæ–°çš„ SELinux è§„åˆ™ï¼Œä»è€Œæœ‰é€‰æ‹©æ€§åœ°å…è®¸è¢«æ‹’ç»çš„è¡Œä¸ºï¼Œè€Œè¿™ä¹Ÿæ˜¯ä¸€ç§åœ¨ä¸ç¦ç”¨ SELinux çš„æƒ…å†µä¸‹ï¼Œè®©åº”ç”¨ç¨‹åºåœ¨ Linux ç³»ç»Ÿä¸Šå·¥ä½œçš„å¿«é€Ÿæ–¹æ³•ã€‚ Enforcingå·¥ä½œæ¨¡å¼ï¼ˆå¼ºåˆ¶æ¨¡å¼ï¼‰ä»æ­¤æ¨¡å¼çš„åç§°å°±å¯ä»¥çœ‹å‡ºï¼Œåœ¨ Enforcing æ¨¡å¼ä¸­ï¼Œ SELinux è¢«å¯åŠ¨ï¼Œå¹¶å¼ºåˆ¶æ‰§è¡Œæ‰€æœ‰çš„å®‰å…¨ç­–ç•¥è§„åˆ™ã€‚ 4ã€SELinuxé…ç½®æ–‡ä»¶SELinux é…ç½®åªèƒ½ç”±root ç”¨æˆ·è¿›è¡Œè®¾ç½®å’Œä¿®æ”¹ã€‚é…ç½®å’Œç­–ç•¥æ–‡ä»¶ä½äº /etc/selinux ç›®å½•ä¸­ï¼Œä¸»é…ç½®æ–‡ä»¶ä½ /etc/selinux/config æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š 12345678910111213[root@localhost ~]# vim /etc/selinux/config# This file controls the state of SELinux on the system.# SELINUX= can take one of these three valuesï¼š# enforcing - SELinux security policy is enforced.# permissive - SELinux prints warnings instead of enforcing.# disabled - No SELinux policy is loaded.SELINUX=enforcing# æŒ‡å®šSELinuxçš„è¿è¡Œæ¨¡å¼ã€‚æœ‰enforcingï¼ˆå¼ºåˆ¶æ¨¡å¼ï¼‰ã€permissiveï¼ˆå®½å®¹æ¨¡å¼ï¼‰ã€disabledï¼ˆä¸ç”Ÿæ•ˆï¼‰ä¸‰ç§æ¨¡å¼# SELINUXTYPE= can take one of these two valuesï¼š# targeted - Targeted processes are protectedï¼Œ# mls - Multi Level Security protection.SELINUXTYPE=targeted# æŒ‡å®šSELinuxçš„é»˜è®¤ç­–ç•¥ã€‚æœ‰ targetedï¼ˆé’ˆå¯¹æ€§ä¿æŠ¤ç­–ç•¥ï¼Œæ˜¯é»˜è®¤ç­–ç•¥ï¼‰å’Œ mlsï¼ˆå¤šçº§å®‰å…¨ä¿æŠ¤ç­–ç•¥ï¼‰ä¸¤ç§ç­–ç•¥ ä¸»é…ç½®æ–‡ä»¶ä¸­ï¼Œé™¤å»ä»¥â€˜#â€™ç¬¦å·å¼€å¤´çš„æ³¨é‡Šè¡Œï¼Œæœ‰æ•ˆé…ç½®å‚æ•°ä»…æœ‰ 2 è¡Œã€‚å…¶ä¸­ï¼ŒSELinux=enforcing ä¸º SELinux é»˜è®¤çš„å·¥ä½œæ¨¡å¼ï¼Œæœ‰æ•ˆå€¼è¿˜å¯ä»¥æ˜¯ permissive å’Œ disabledï¼›SELINUXTYPE=targeted ç”¨äºæŒ‡å®š SELinux çš„é»˜è®¤ç­–ç•¥ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœä»å¼ºåˆ¶æ¨¡å¼ï¼ˆenforcingï¼‰ã€å®½å®¹æ¨¡å¼ï¼ˆpermissiveï¼‰åˆ‡æ¢åˆ°å…³é—­æ¨¡å¼ï¼ˆdisabledï¼‰ï¼Œæˆ–è€…ä»å…³é—­æ¨¡å¼åˆ‡æ¢åˆ°å…¶ä»–ä¸¤ç§æ¨¡å¼ï¼Œåˆ™å¿…é¡»é‡å¯ Linux ç³»ç»Ÿæ‰èƒ½ç”Ÿæ•ˆã€‚ä½†æ˜¯å¼ºåˆ¶æ¨¡å¼å’Œå®½å®¹æ¨¡å¼è¿™ä¸¤ç§æ¨¡å¼äº’ç›¸åˆ‡æ¢ä¸ç”¨é‡å¯ Linux ç³»ç»Ÿå°±å¯ä»¥ç”Ÿæ•ˆã€‚è¿™æ˜¯å› ä¸º SELinux æ˜¯æ•´åˆåˆ° Linux å†…æ ¸ä¸­çš„ï¼Œæ‰€ä»¥å¿…é¡»é‡å¯æ‰èƒ½æ­£ç¡®å…³é—­å’Œå¯åŠ¨ã€‚è€Œä¸”ï¼Œå¦‚æœä»å…³é—­æ¨¡å¼åˆ‡æ¢åˆ°å¯åŠ¨æ¨¡å¼ï¼Œé‚£ä¹ˆé‡å¯ Linux ç³»ç»Ÿçš„é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ï¼Œé‚£æ˜¯å› ä¸ºéœ€è¦é‡æ–°å†™å…¥å®‰å…¨ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"selinux","slug":"selinux","permalink":"https://tinychen.com/tags/selinux/"}]},{"title":"RHEL7ç ´è§£ROOTå¯†ç ","slug":"20190707-rhel7-break-passwd","date":"2019-07-06T17:00:00.000Z","updated":"2019-07-06T17:00:00.000Z","comments":true,"path":"20190707-rhel7-break-passwd/","link":"","permalink":"https://tinychen.com/20190707-rhel7-break-passwd/","excerpt":"RHELç³»åˆ—Linuxç ´è§£ROOTå¯†ç çš„æ“ä½œã€‚","text":"RHELç³»åˆ—Linuxç ´è§£ROOTå¯†ç çš„æ“ä½œã€‚ åœ¨å¼€æœºé€‰æ‹©å†…æ ¸çš„æ—¶å€™ï¼Œå¿«é€ŸæŒ‰ä¸‹eï¼Œæ³¨æ„è¿™ä¸ªæ—¶å€™è¦é€‰ä¸­éœ€è¦ä¿®æ”¹rootå¯†ç çš„å†…æ ¸ï¼Œè€Œä¸è¦é€‰é”™äº†å†…æ ¸ã€‚ æ¥ç€æˆ‘ä»¬æ‰¾åˆ°å€’æ•°ç¬¬äºŒè¡Œçš„LANG=en_US.UTF-8è¿™ä¸ªä½ç½®ï¼Œåœ¨åé¢åŠ å…¥rd.break console=tty0è¿™ä¸€è¡ŒæŒ‡ä»¤ï¼Œç„¶åæŒ‰ctrl+xæ‰§è¡Œ æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šè¿›å…¥åˆ°ä¸€ä¸ªæ“ä½œç»ˆç«¯ï¼Œè¿›è¡Œä¸‹åˆ—æ“ä½œ 1234567891011121314# é‡æ–°æŒ‚è½½/sysrootåˆ†åŒºä¸ºå¯è¯»å†™æ¨¡å¼mount -o rw,remount /sysroot# æ›´æ”¹rootåˆ°è¿™ä¸ªå¯è¯»å†™çš„/sysrootåˆ†åŒºchroot /sysroot# ä½¿ç”¨passwdæŒ‡ä»¤ä¿®æ”¹rootè´¦æˆ·çš„å¯†ç paawd# æˆ–è€…ä½¿ç”¨echoçš„æ–¹å¼ä¿®æ”¹å¯†ç echo ä½ çš„æ–°å¯†ç  | passwd --stdin root# å¦‚æœç³»ç»Ÿæ‰“å¼€äº†SELinuxï¼Œè¿˜éœ€è¦æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦åˆ™ä¿®æ”¹å¯†ç ä¸ç”Ÿæ•ˆtouch /.autorelabel æ¥ç€è¾“å…¥ä¸¤æ¬¡exité€€å‡ºé‡å¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœå¼€å¯äº†SELiunxçš„è¯è¿˜ä¼šæœ‰ä¸€ä¸ªè¯»æ¡çš„æ“ä½œ è¯»æ¡å®Œæˆé‡å¯ä¹‹åå°±å¯ä»¥ä½¿ç”¨ä¿®æ”¹å®Œå¯†ç çš„rootè´¦æˆ·ç™»å½•äº†ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"Frpå†…ç½‘ç©¿é€å®ç°MSè¿œç¨‹æ¡Œé¢å’ŒSSH","slug":"20190706-frp","date":"2019-07-06T07:00:00.000Z","updated":"2019-07-06T07:00:00.000Z","comments":true,"path":"20190706-frp/","link":"","permalink":"https://tinychen.com/20190706-frp/","excerpt":"ä½¿ç”¨githubä¸Šé¢çš„å¼€æºé¡¹ç›®Frpå’Œä¸€å°æœ‰å…¬ç½‘IPçš„ä¸»æœºæ¥å®ç°åå‘ä»£ç†ï¼ˆå†…ç½‘ç©¿é€ï¼‰ï¼Œä»è€Œè¾¾åˆ°ä½¿ç”¨å¾®è½¯è‡ªå¸¦çš„è¿œç¨‹æ¡Œé¢mstscæ¥è¿œç¨‹æ²¡æœ‰å…¬ç½‘IPçš„windowsç”µè„‘å’Œä½¿ç”¨sshè¿œç¨‹Linuxç³»ç»Ÿï¼ˆCentoså’ŒUbuntuï¼‰çš„æ•ˆæœã€‚ æœ¬æ–‡ä¸æ¶‰åŠåå‘ä»£ç†çš„å…·ä½“ç†è®ºçŸ¥è¯†ï¼Œä½¿ç”¨çš„å…¬ç½‘IPä¸»æœºä¸ºé˜¿é‡Œäº‘ä¸»æœºï¼ˆåå—é’±ä¸€ä¸ªæœˆçš„å­¦ç”Ÿç‰ˆï¼‰ï¼Œç”±äºä½¿ç”¨çš„é˜¿é‡Œäº‘ä¸»æœºå¸¦å®½æœ‰é™ï¼Œå› æ­¤ä½¿ç”¨è¿œç¨‹æ¡Œé¢çš„æ•ˆæœå¯èƒ½æ¯”è¾ƒä¸€èˆ¬ï¼Œä½†æ˜¯å¯¹äºSSHè¿œç¨‹æ¥è¯´è‚¯å®šæ˜¯è¶³å¤Ÿäº†çš„ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ çš„ç”µè„‘æœ¬èº«æ‰€å¤„çš„ç½‘ç»œæ˜¯æœ‰åŠ¨æ€å…¬ç½‘IPçš„ï¼Œå»ºè®®ç›´æ¥åœ¨è·¯ç”±å™¨ä¸­è®¾ç½®DDNSï¼Œæ•ˆæœè¦æ¯”è¿™ä¸ªå¥½å¾ˆå¤šï¼Œè¿™ä¸ªä»…é€‚ç”¨äºé‚£äº›æ²¡æœ‰å…¬ç½‘IPçš„ç”µè„‘ã€‚","text":"ä½¿ç”¨githubä¸Šé¢çš„å¼€æºé¡¹ç›®Frpå’Œä¸€å°æœ‰å…¬ç½‘IPçš„ä¸»æœºæ¥å®ç°åå‘ä»£ç†ï¼ˆå†…ç½‘ç©¿é€ï¼‰ï¼Œä»è€Œè¾¾åˆ°ä½¿ç”¨å¾®è½¯è‡ªå¸¦çš„è¿œç¨‹æ¡Œé¢mstscæ¥è¿œç¨‹æ²¡æœ‰å…¬ç½‘IPçš„windowsç”µè„‘å’Œä½¿ç”¨sshè¿œç¨‹Linuxç³»ç»Ÿï¼ˆCentoså’ŒUbuntuï¼‰çš„æ•ˆæœã€‚ æœ¬æ–‡ä¸æ¶‰åŠåå‘ä»£ç†çš„å…·ä½“ç†è®ºçŸ¥è¯†ï¼Œä½¿ç”¨çš„å…¬ç½‘IPä¸»æœºä¸ºé˜¿é‡Œäº‘ä¸»æœºï¼ˆåå—é’±ä¸€ä¸ªæœˆçš„å­¦ç”Ÿç‰ˆï¼‰ï¼Œç”±äºä½¿ç”¨çš„é˜¿é‡Œäº‘ä¸»æœºå¸¦å®½æœ‰é™ï¼Œå› æ­¤ä½¿ç”¨è¿œç¨‹æ¡Œé¢çš„æ•ˆæœå¯èƒ½æ¯”è¾ƒä¸€èˆ¬ï¼Œä½†æ˜¯å¯¹äºSSHè¿œç¨‹æ¥è¯´è‚¯å®šæ˜¯è¶³å¤Ÿäº†çš„ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ çš„ç”µè„‘æœ¬èº«æ‰€å¤„çš„ç½‘ç»œæ˜¯æœ‰åŠ¨æ€å…¬ç½‘IPçš„ï¼Œå»ºè®®ç›´æ¥åœ¨è·¯ç”±å™¨ä¸­è®¾ç½®DDNSï¼Œæ•ˆæœè¦æ¯”è¿™ä¸ªå¥½å¾ˆå¤šï¼Œè¿™ä¸ªä»…é€‚ç”¨äºé‚£äº›æ²¡æœ‰å…¬ç½‘IPçš„ç”µè„‘ã€‚ 1ã€æœåŠ¡ç«¯é…ç½®é¦–å…ˆæˆ‘ä»¬å¯¹æœåŠ¡ç«¯çš„é˜¿é‡Œäº‘ä¸»æœºè¿›è¡Œé…ç½®ï¼Œå½“ç„¶æœ‰å…¶ä»–çš„å…¬ç½‘IPä¸»æœºéƒ½æ˜¯å¯ä»¥çš„ã€‚è¿™é‡Œä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯CentOS7.3ã€‚ 1.1 ä¸‹è½½Frpgithubä¸Šå„ä¸ªé…ç½®ç‰ˆæœ¬ä¸‹è½½åœ°å€ 1234567891011# ä½¿ç”¨wgetæŒ‡ä»¤ä¸‹è½½linuxç‰ˆæœ¬wget https://github.com/fatedier/frp/releases/download/v0.27.0/frp_0.27.0_linux_amd64.tar.gz# ä½¿ç”¨tarå‘½ä»¤è§£å‹tar -zxvf frp_0.27.0_linux_amd64.tar.gz# ä½¿ç”¨cpå‘½ä»¤å¤åˆ¶åˆ°/etcç›®å½•ä¸­å¹¶é‡å‘½åä¸ºfrpscp -r frp_0.27.0_linux_amd64 /etc/frps# ä½¿ç”¨rmå‘½ä»¤åˆ é™¤æ‰å¤šä½™çš„frpcå®¢æˆ·ç«¯æ–‡ä»¶ï¼Œåªç•™ä¸‹æœåŠ¡ç«¯frpsç›¸å…³çš„æ–‡ä»¶rm -f frpc frpc_full.ini frpc.ini è¿™äº›å°±æ˜¯å‰©ä¸‹çš„æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªinié…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­frps_full,iniæ˜¯å®Œæ•´çš„å¸¦æœ‰æ³¨é‡Šè¯´æ˜å’Œæ‰€æœ‰åŠŸèƒ½çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬æŠŠéœ€è¦çš„ç®€å•é…ç½®æ‘˜åˆ°frps.iniè¿™ä¸ªæ–‡ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç®¡ç†é…ç½®ã€‚ 1.2 ç¼–è¾‘é…ç½®æ–‡ä»¶æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–è¾‘é…ç½®æ–‡ä»¶å¯ç”¨frpçš„ç›‘å¬ç«¯å£7000å’Œç›‘æ§é¢æ¿dashboardçš„ç›‘å¬ç«¯å£7500ã€‚ 123456789# å°†ä¸‹åˆ—å†…å®¹åŠ å…¥åˆ°frps.iniä¸­[common]bind_addr = 0.0.0.0bind_port = 7000auto_token = ä½ çš„è¿æ¥è®¤è¯å¯†ç dashboard_port = 7500dashboard_user = admindashboard_pwd = ä½ çš„ç®¡ç†ç™»å½•å¯†ç  éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸Šé¢è¯´çš„7000å’Œ7500ç«¯å£éƒ½éœ€è¦åœ¨é˜¿é‡Œäº‘çš„é˜²ç«å¢™é‡Œé¢é…ç½®æ”¾è¡Œï¼Œå¦åˆ™ä¼šæ— æ³•è®¿é—®ã€‚ 1.3 è®¾ç½®å¼€å¯è‡ªåŠ¨å’Œåå°è¿è¡Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†Frpsæ³¨å†ŒæˆLinuxä¸­çš„æœåŠ¡è¿›ç¨‹ã€‚ 1234567891011121314151617181920212223242526272829# æ–°å»ºä¸€ä¸ªæ–‡ä»¶è®¾ç½®frpsæœåŠ¡èƒ½å¤Ÿå®ç°åå°å¯åŠ¨å’Œå¼€æœºå¯åŠ¨vim /etc/systemd/system/frpsd.service# å°†ä¸‹åˆ—å†…å®¹åŠ å…¥åˆ°frpsd.serviceä¸­[Unit]Description=frps daemonAfter=syslog.target network.targetWants=network.target[Service]Type=simpleExecStart=/etc/frps/frps -c /etc/frps/frps.iniRestart= alwaysRestartSec=1min[Install]WantedBy=multi-user.target# å¯åŠ¨frpsæœåŠ¡systemctl start frpsd.service# è®¾ç½®frpsæœåŠ¡å¼€æœºå¯åŠ¨systemctl enable frpsd.service# æŸ¥çœ‹frpsçŠ¶æ€systemctl status frpsd.service# é‡å¯frpsæœåŠ¡systemctl restart frpsd.service 2ã€Windowså®¢æˆ·ç«¯é…ç½®2.1 ä¸‹è½½Frpæˆ‘ä»¬æŒ‰ç…§ä¹‹å‰çš„ä¸‹è½½å¥½å¯¹åº”çš„Windowsç‰ˆæœ¬ä¹‹åï¼Œåˆ é™¤æ‰å¤šä½™çš„frpsæœåŠ¡ç«¯æ–‡ä»¶ï¼Œåªç•™ä¸‹å¯¹åº”çš„frpcå®¢æˆ·ç«¯æ–‡ä»¶ã€‚ 2.2 ç¼–è¾‘é…ç½®æ–‡ä»¶123456789[common]server_addr = ä½ çš„å…¬ç½‘ä¸»æœºçš„å…¬ç½‘IPserver_port = 7000[MSRDP]type = tcplocal_ip = 127.0.0.1local_port = 3389remote_port = 7777 è¿™é‡Œçš„server_portå°±æ˜¯æˆ‘ä»¬å‰é¢çš„æœåŠ¡ç«¯é…ç½®çš„ç«¯å£7000ï¼Œlocal_portåˆ™æ˜¯å¾®è½¯è‡ªå¸¦çš„è¿œç¨‹æ¡Œé¢mstscçš„é»˜è®¤ç«¯å£3389ï¼Œremote_portå°±æ˜¯åˆ°æ—¶å€™ä½¿ç”¨mstscè¿œç¨‹çš„æ—¶å€™éœ€è¦åœ¨è¿™ä¸ªå…¬ç½‘IPåé¢åŠ ä¸Šçš„ç«¯å£å·ï¼Œæ³¨æ„è¿™ä¸ªç«¯å£å·ä¹Ÿæ˜¯éœ€è¦åœ¨é˜¿é‡Œäº‘ä¸»æœºçš„é˜²ç«å¢™ä¸­æ”¾è¡Œã€‚ ç„¶åæˆ‘ä»¬å°±å¯ä»¥å¯ç”¨frpcå®¢æˆ·ç«¯æ¥å»ºç«‹è¿æ¥ 12# åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥frpc.exe -c frpc.ini 2.3 æ³¨å†ŒFrpcä¸ºWindowsæœåŠ¡ä¸ºäº†ä½¿frpcèƒ½å¤Ÿå¼€å¯åå°è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒæ³¨å†Œä¸ºç³»ç»ŸæœåŠ¡ã€‚ è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°GitHubä¸Šé¢çš„å¦ä¸€ä¸ªé¡¹ç›®winsw è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯WinSW.NET4.exeè¿™ä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªéœ€è¦ç”µè„‘å®‰è£…äº†.net4æ‰å¯ä»¥ä½¿ç”¨ï¼Œä¸€èˆ¬win10åº”è¯¥éƒ½æ˜¯å®‰è£…äº†çš„ï¼Œæ­¤å¤–æˆ‘ä»¬è¿˜è¦ä¸‹è½½ä¸€ä¸ªxmlæ–‡ä»¶ä½œä¸ºå¯åŠ¨é…ç½®æ–‡ä»¶ã€‚ ç„¶åæˆ‘ä»¬åœ¨å¯¹åº”çš„xmlé…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä¸‹åˆ—å†…å®¹ 1234567891011121314&lt;configuration&gt; &lt;!-- ID of the service. It should be unique accross the Windows system--&gt; &lt;id&gt;frpc&lt;/id&gt; &lt;!-- Display name of the service --&gt; &lt;name&gt;Frpc Service (powered by WinSW)&lt;/name&gt; &lt;!-- Service description --&gt; &lt;description&gt;This frpc service can realize reverse Proxy&lt;/description&gt; &lt;!-- Path to the executable, which should be started --&gt; &lt;executable&gt;frpc&lt;/executable&gt; &lt;arguments&gt;-c frpc.ini&lt;/arguments&gt; &lt;logmode&gt;reset&lt;/logmode&gt;&lt;/configuration&gt; æ¥ç€æˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½å‘½åä¸ºWinSWï¼Œç„¶åæ”¾åœ¨åˆšåˆšfrpcçš„ç›®å½•ä¸‹ã€‚ ç„¶åæˆ‘ä»¬ä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨powershellæˆ–è€…cmdï¼Œè¾“å…¥ä¸‹åˆ—å‘½ä»¤ 1WinSW.exe install win+råé€šè¿‡services.mscè¿›å…¥åˆ°æœåŠ¡åˆ—è¡¨é¡µé¢æ‰¾åˆ°frpcæœåŠ¡ã€‚ æˆ‘ä»¬æ‰“å¼€è®¾ç½®ï¼Œå°†å®ƒè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼ŒæœåŠ¡å¤±è´¥åä¸€åˆ†é’Ÿè‡ªåŠ¨é‡å¯æœåŠ¡ã€‚ åˆ°è¿™é‡Œwindowså®¢æˆ·ç«¯çš„é…ç½®å°±å·²ç»å®Œæˆäº†ã€‚æˆ‘ä»¬åœ¨è¿œç¨‹çš„æ—¶å€™åªéœ€è¦è¾“å…¥åˆšåˆšä½¿ç”¨çš„å…¬ç½‘IPåœ°å€åŠ ä¸Šç«¯å£å·å³å¯è¿›è¡Œè¿œç¨‹è¿æ¥ï¼Œå¦‚æœæœ‰å¤šå°ç”µè„‘éœ€è¦è¿›è¡Œè¿œç¨‹ï¼Œåªéœ€è¦ç»™æ¯ä¸ªç”µè„‘è®¾ç½®ä¸€ä¸ªä¸åŒçš„ç«¯å£å·å³å¯ã€‚ 3ã€Linuxå®¢æˆ·ç«¯é…ç½®Linuxå®¢æˆ·ç«¯çš„é…ç½®å’Œä¸Šé¢çš„æœåŠ¡ç«¯å¤§åŒå°å¼‚ï¼Œåªéœ€è¦å°†frpsæ¢ä¸ºfrpcå¹¶ä¸”ä¿®æ”¹å¯¹åº”çš„é…ç½®æ–‡ä»¶å³å¯ã€‚æ³¨æ„ä¸‹é¢çš„æ“ä½œå°ä¸ƒåœ¨CentOS7.6å’ŒUbuntu18.04ä¸Šé¢éƒ½èƒ½æˆåŠŸå®ç°ã€‚ 3.1 ä¸‹è½½Frp1234567891011121314# ä½¿ç”¨wgetæŒ‡ä»¤ä¸‹è½½linuxç‰ˆæœ¬wget https://github.com/fatedier/frp/releases/download/v0.27.0/frp_0.27.0_linux_amd64.tar.gz# ä½¿ç”¨tarå‘½ä»¤è§£å‹tar -zxvf frp_0.27.0_linux_amd64.tar.gz# ä½¿ç”¨cpå‘½ä»¤å¤åˆ¶åˆ°/etcç›®å½•ä¸­å¹¶é‡å‘½åä¸ºfrpccp -r frp_0.27.0_linux_amd64 /etc/frpc# ä½¿ç”¨rmå‘½ä»¤åˆ é™¤æ‰å¤šä½™çš„frpsæœåŠ¡ç«¯æ–‡ä»¶ï¼Œåªç•™ä¸‹å®¢æˆ·ç«¯rm -f frps frps_full.ini frps.ini# ä½¿ç”¨vimç¼–è¾‘å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶vim /etc/frpc/frpc.ini 3.2 ç¼–è¾‘é…ç½®æ–‡ä»¶1234567891011# é…ç½®æœ¬åœ°çš„frpc.iniæ–‡ä»¶[common]server_addr = ä½ çš„å…¬ç½‘ä¸»æœºçš„å…¬ç½‘IPserver_port = 7000[ssh]type = tcplocal_ip = 127.0.0.1local_port = 22remote_port = 8000 3.3 è®¾ç½®å¼€æœºå¯åŠ¨å’Œåå°è¿è¡Œ1234567891011121314151617181920212223242526# æ–°å»ºä¸€ä¸ªæ–‡ä»¶è®¾ç½®frpsæœåŠ¡èƒ½å¤Ÿå®ç°åå°å¯åŠ¨å’Œå¼€æœºå¯åŠ¨vim /etc/systemd/system/frpcd.service# å°†ä¸‹åˆ—å†…å®¹åŠ å…¥åˆ°frpcd.serviceä¸­[Unit]Description=frpc daemonAfter=syslog.target network.targetWants=network.target[Service]Type=simpleExecStart=/etc/frpc/frpc -c /etc/frpc/frpc.iniRestart= alwaysRestartSec=1min[Install]WantedBy=multi-user.target# å¯åŠ¨frpcæœåŠ¡systemctl start frpcd.service# è®¾ç½®frpcæœåŠ¡å¼€æœºå¯åŠ¨systemctl enable frpcd.service# æŸ¥çœ‹frpcæœåŠ¡çŠ¶æ€systemctl status frpcd.service 3.4 é”™è¯¯è®°å½•åœ¨Ubuntuä¸Šé¢å‡ºç°äº†ä¸€ç‚¹å°æ„å¤–ï¼Œå‘ç°æœåŠ¡å¹¶æ²¡æœ‰æˆåŠŸå¯ç”¨ [control.go:142] [ssh] start error: proxy name [ssh] is already in use æç¤ºæ˜¯è¯´sshè¿™ä¸ªåå­—å·²ç»è¢«åˆ«çš„æœåŠ¡å ç”¨äº†ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¹‹å‰çš„é…ç½®æ–‡ä»¶é‡Œé¢çš„sshä¸ºåˆ«çš„åå­—ï¼Œç„¶åé‡å¯æœåŠ¡å³å¯ã€‚ æœ€åæ³¨æ„è¿™æ—¶å€™æˆ‘ä»¬å¦‚æœéœ€è¦ä½¿ç”¨sshè¿œç¨‹éœ€è¦åŠ ä¸Š-på‘½ä»¤æ¥æŒ‡å®šç«¯å£ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"frp","slug":"frp","permalink":"https://tinychen.com/tags/frp/"}]},{"title":"æ•°æ®åº“åŸç†éƒ¨åˆ†é‡ç‚¹å†…å®¹","slug":"20190618-database-review","date":"2019-06-18T07:00:00.000Z","updated":"2019-06-18T07:00:00.000Z","comments":true,"path":"20190618-database-review/","link":"","permalink":"https://tinychen.com/20190618-database-review/","excerpt":"ã€Šæ•°æ®åº“åŸç†ã€‹éƒ¨åˆ†é‡ç‚¹å†…å®¹ï¼Œå°ä¸ƒè‡ªå·±æ•´ç†çš„é¢å‘æœŸæœ«è€ƒè€ƒé¢˜çš„å¤ä¹ æçº²ã€‚","text":"ã€Šæ•°æ®åº“åŸç†ã€‹éƒ¨åˆ†é‡ç‚¹å†…å®¹ï¼Œå°ä¸ƒè‡ªå·±æ•´ç†çš„é¢å‘æœŸæœ«è€ƒè€ƒé¢˜çš„å¤ä¹ æçº²ã€‚ 1ã€é¢˜å‹ä¸€å…±10é¢˜ï¼Œæ¯é¢˜10åˆ†ã€‚ é—®ç­”é¢˜ï¼š3é¢˜ï¼ˆ1é¢˜æ˜¯ç¬¬ä¸€ç« æ•°æ®åº“æ¦‚å¿µç›¸å…³ã€1é¢˜ä¸‰çº§æ¨¡å¼+äºŒçº§æ˜ åƒâ€“æ•°æ®ç‹¬ç«‹æ€§ã€1é¢˜æ˜¯æ•°æ®åº“æ¢å¤æˆ–å¹¶å‘æ§åˆ¶åè®®å†…å®¹+åè®®è§£å†³çš„é—®é¢˜ï¼‰ ç¼–ç¨‹é¢˜ï¼š5é¢˜ï¼ˆ4é¢˜æŸ¥è¯¢ç›¸å…³çš„ï¼Œ1é¢˜æ˜¯å®‰å…¨æ€§æ§åˆ¶æˆ–å®Œæ•´æ€§æ§åˆ¶ï¼‰ åˆ†æé¢˜ï¼š2é¢˜ï¼ˆ1é¢˜æ˜¯æ¨¡å¼åˆ†è§£ã€èŒƒå¼ç›¸å…³çš„ï¼Œ1é¢˜æ˜¯è®¾è®¡å°å‹æ•°æ®åº“ï¼‰ 2ã€é—®ç­”é¢˜ï¼ˆ3*10ï¼‰2.1 DBMSæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDatabase Management Systemï¼‰ï¼Œç®€ç§°DBMSï¼Œæ˜¯ä½äºç”¨æˆ·ä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„ä¸€å±‚æ•°æ®ç®¡ç†è½¯ä»¶ã€‚ æ•°æ®åº“ç³»ç»Ÿçš„ç‰¹ç‚¹ æ•°æ®ç»“æ„åŒ– æ•°æ®çš„é«˜å…±äº«æ€§ æ•°æ®ç‹¬ç«‹æ€§ DBMSå¯¹æ•°æ®ç»Ÿä¸€ç®¡ç†å’Œæ§åˆ¶ 2.2 æ•°æ®ç®¡ç†æŠ€æœ¯çš„å‘å±•è¿‡ç¨‹ äººå·¥ç®¡ç†é˜¶æ®µ(40å¹´ä»£ä¸­â€“50å¹´ä»£ä¸­) æ–‡ä»¶ç³»ç»Ÿé˜¶æ®µ(50å¹´ä»£æœ«â€“60å¹´ä»£ä¸­) æ•°æ®åº“ç³»ç»Ÿé˜¶æ®µ(60å¹´ä»£æœ«â€“ç°åœ¨) äº§ç”Ÿçš„èƒŒæ™¯ äººå·¥ç®¡ç†(40å¹´ä»£ä¸­â€“50å¹´ä»£ä¸­) æ–‡ä»¶ç³»ç»Ÿ(50å¹´ä»£æœ«â€“60å¹´ä»£ä¸­) æ•°æ®åº“ç³»ç»Ÿ(60å¹´ä»£æœ«â€“ç°åœ¨) åº”ç”¨éœ€æ±‚ ç§‘å­¦è®¡ç®— ç§‘å­¦è®¡ç®—ã€ç®¡ç† å¤§è§„æ¨¡ç®¡ç† ç¡¬ä»¶æ°´å¹³ æ— ç›´æ¥å­˜å–å­˜å‚¨è®¾å¤‡ ç£ç›˜ã€ç£é¼“ å¤§å®¹é‡ç£ç›˜ è½¯ä»¶æ°´å¹³ æ²¡æœ‰æ“ä½œç³»ç»Ÿ æœ‰æ–‡ä»¶ç³»ç»Ÿ æœ‰æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ å¤„ç†æ–¹å¼ æ‰¹å¤„ç† è”æœºå®æ—¶å¤„ç†ã€æ‰¹å¤„ç† è”æœºå®æ—¶å¤„ç†,åˆ†å¸ƒå¤„ç†,æ‰¹å¤„ç† 2.3 æ•°æ®æ¨¡å‹é€šä¿—åœ°è®²æ•°æ®æ¨¡å‹å°±æ˜¯ç°å®ä¸–ç•Œçš„æ¨¡æ‹Ÿï¼Œåœ¨æ•°æ®åº“ä¸­ç”¨æ•°æ®æ¨¡å‹è¿™ä¸ªå·¥å…·æ¥æŠ½è±¡ã€è¡¨ç¤ºå’Œå¤„ç†ç°å®ä¸–ç•Œä¸­çš„æ•°æ®å’Œä¿¡æ¯ã€‚ æ•°æ®æ¨¡å‹åˆ†æˆä¸¤ä¸ªä¸åŒçš„å±‚æ¬¡ æ¦‚å¿µæ¨¡å‹ï¼ˆç”¨æˆ·ï¼‰ï¼Œä¹Ÿç§°ä¿¡æ¯æ¨¡å‹ï¼Œå®ƒæ˜¯æŒ‰ç”¨æˆ·çš„è§‚ç‚¹æ¥å¯¹æ•°æ®å’Œä¿¡æ¯å»ºæ¨¡ã€‚ æ•°æ®æ¨¡å‹ï¼ˆè®¡ç®—æœºï¼‰ï¼Œä¸»è¦åŒ…æ‹¬ç½‘çŠ¶æ¨¡å‹ã€å±‚æ¬¡æ¨¡å‹ã€å…³ç³»æ¨¡å‹ã€é¢å‘å¯¹è±¡æ¨¡å‹ç­‰ï¼Œå®ƒæ˜¯æŒ‰è®¡ç®—æœºç³»ç»Ÿçš„è§‚ç‚¹å¯¹æ•°æ®å»ºæ¨¡ã€‚ 2.4 æ•°æ®æ¨¡å‹çš„ç»„æˆè¦ç´  æ•°æ®ç»“æ„ ä»€ä¹ˆæ˜¯æ•°æ®ç»“æ„ï¼šå¯¹è±¡ç±»å‹çš„é›†åˆ ä¸¤ç±»å¯¹è±¡ï¼šï¼ˆ1ï¼‰ä¸æ•°æ®ç±»å‹ã€å†…å®¹ã€æ€§è´¨æœ‰å…³çš„å¯¹è±¡ï¼ˆ2ï¼‰ä¸æ•°æ®ä¹‹é—´è”ç³»æœ‰å…³çš„å¯¹è±¡ æ•°æ®ç»“æ„æ˜¯å¯¹ç³»ç»Ÿé™æ€ç‰¹æ€§çš„æè¿° æ•°æ®æ“ä½œ æ•°æ®æ“ä½œï¼šå¯¹æ•°æ®åº“ä¸­å„ç§å¯¹è±¡ï¼ˆå‹ï¼‰çš„å®ä¾‹ï¼ˆå€¼ï¼‰å…è®¸æ‰§è¡Œçš„æ“ä½œåŠæœ‰å…³çš„æ“ä½œè§„åˆ™ æ•°æ®æ“ä½œçš„ç±»å‹ï¼šï¼ˆ1ï¼‰æ£€ç´¢ï¼ˆ2ï¼‰æ›´æ–°ï¼ˆåŒ…æ‹¬æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰ æ•°æ®æ“ä½œæ˜¯å¯¹ç³»ç»ŸåŠ¨æ€ç‰¹æ€§çš„æè¿°ã€‚ æ•°æ®çš„çº¦æŸæ¡ä»¶ ä¸€ç»„å®Œæ•´æ€§è§„åˆ™çš„é›†åˆã€‚ å®Œæ•´æ€§è§„åˆ™æ˜¯ç»™å®šçš„æ•°æ®æ¨¡å‹ä¸­æ•°æ®åŠå…¶è”ç³»æ‰€å…·æœ‰çš„åˆ¶çº¦å’Œå‚¨å­˜è§„åˆ™ï¼Œç”¨ä»¥é™å®šç¬¦åˆæ•°æ®æ¨¡å‹çš„æ•°æ®åº“çŠ¶æ€ä»¥åŠçŠ¶æ€çš„å˜åŒ–ï¼Œä»¥ä¿è¯æ•°æ®çš„æ­£ç¡®ã€æœ‰æ•ˆã€ç›¸å®¹ã€‚ 2.5 æ•°æ®åº“ç³»ç»Ÿçš„ä¸‰çº§æ¨¡å¼ç»“æ„2.5.1 ä¸‰çº§æ¨¡å¼ ä¸‰çº§æ¨¡å¼ç»“æ„ï¼šå¤–æ¨¡å¼ã€æ¨¡å¼ã€å†…æ¨¡å¼ã€‚ å¤–æ¨¡å¼ï¼ˆä¹Ÿç§°å­æ¨¡å¼æˆ–ç”¨æˆ·æ¨¡å¼ï¼‰ï¼Œæ•°æ®åº“ç”¨æˆ·ï¼ˆåŒ…æ‹¬åº”ç”¨ç¨‹åºå‘˜å’Œæœ€ç»ˆç”¨æˆ·ï¼‰ä½¿ç”¨çš„å±€éƒ¨æ•°æ®çš„é€»è¾‘ç»“æ„ã€‚ æ¨¡å¼ï¼ˆä¹Ÿç§°é€»è¾‘æ¨¡å¼ï¼‰ï¼Œæ•°æ®åº“ä¸­å…¨ä½“æ•°æ®çš„é€»è¾‘ç»“æ„ å†…æ¨¡å¼ï¼ˆä¹Ÿç§°å­˜å‚¨æ¨¡å¼ï¼‰ï¼Œæ˜¯æ•°æ®ç‰©ç†ç»“æ„å’Œå­˜å‚¨æ–¹å¼çš„æè¿°ã€‚ ä¸€ä¸ªæ•°æ®åº“åªæœ‰ä¸€ä¸ªæ¨¡å¼å’Œä¸€ä¸ªå†…æ¨¡å¼ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªå¤–æ¨¡å¼ã€‚ æ¨¡å¼ä¸å¤–æ¨¡å¼çš„å…³ç³»ï¼šä¸€å¯¹å¤š å¤–æ¨¡å¼é€šå¸¸æ˜¯æ¨¡å¼çš„å­é›† ä¸€ä¸ªæ•°æ®åº“å¯ä»¥æœ‰å¤šä¸ªå¤–æ¨¡å¼ã€‚åæ˜ äº†ä¸åŒçš„ç”¨æˆ·çš„åº”ç”¨éœ€æ±‚ã€çœ‹å¾…æ•°æ®çš„æ–¹å¼ã€å¯¹æ•°æ®ä¿å¯†çš„è¦æ±‚ å¯¹æ¨¡å¼ä¸­åŒä¸€æ•°æ®ï¼Œåœ¨å¤–æ¨¡å¼ä¸­çš„ç»“æ„ã€ç±»å‹ã€é•¿åº¦ã€ä¿å¯†çº§åˆ«ç­‰éƒ½å¯ä»¥ä¸åŒ å¤–æ¨¡å¼ä¸åº”ç”¨çš„å…³ç³»ï¼šä¸€å¯¹å¤š åŒä¸€å¤–æ¨¡å¼ä¹Ÿå¯ä»¥ä¸ºæŸä¸€ç”¨æˆ·çš„å¤šä¸ªåº”ç”¨ç³»ç»Ÿæ‰€ä½¿ç”¨ ä½†ä¸€ä¸ªåº”ç”¨ç¨‹åºåªèƒ½ä½¿ç”¨ä¸€ä¸ªå¤–æ¨¡å¼ ä¸‰çº§æ¨¡å¼æ˜¯å¯¹æ•°æ®çš„ä¸‰ä¸ªæŠ½è±¡çº§åˆ«ï¼ŒäºŒçº§æ˜ è±¡åœ¨DBMSå†…éƒ¨å®ç°è¿™ä¸‰ä¸ªæŠ½è±¡å±‚æ¬¡çš„è”ç³»å’Œè½¬æ¢ã€‚ 2.5.2 å¤–æ¨¡å¼/æ¨¡å¼æ˜ è±¡ï¼ˆé€»è¾‘ç‹¬ç«‹æ€§ï¼‰ å®šä¹‰å¤–æ¨¡å¼ä¸æ¨¡å¼ä¹‹é—´çš„å¯¹åº”å…³ç³» æ¯ä¸€ä¸ªå¤–æ¨¡å¼éƒ½å¯¹åº”ä¸€ä¸ªå¤–æ¨¡å¼ï¼æ¨¡å¼æ˜ è±¡ å¤–æ¨¡å¼ï¼æ¨¡å¼æ˜ è±¡çš„ç”¨é€”ï¼šä¿è¯æ•°æ®çš„é€»è¾‘ç‹¬ç«‹æ€§ å½“æ¨¡å¼æ”¹å˜æ—¶ï¼Œæ•°æ®åº“ç®¡ç†å‘˜ä¿®æ”¹æœ‰å…³çš„å¤–æ¨¡å¼ï¼æ¨¡å¼æ˜ è±¡ï¼Œä½¿å¤–æ¨¡å¼ä¿æŒä¸å˜ åº”ç”¨ç¨‹åºæ˜¯ä¾æ®æ•°æ®çš„å¤–æ¨¡å¼ç¼–å†™çš„ï¼Œä»è€Œåº”ç”¨ç¨‹åºä¸å¿…ä¿®æ”¹ï¼Œä¿è¯äº†æ•°æ®ä¸ç¨‹åºçš„é€»è¾‘ç‹¬ç«‹æ€§ï¼Œç®€ç§°æ•°æ®çš„é€»è¾‘ç‹¬ç«‹æ€§ã€‚ 2.5.3 æ¨¡å¼/å†…æ¨¡å¼æ˜ è±¡ï¼ˆç‰©ç†ç‹¬ç«‹æ€§ï¼‰ æ¨¡å¼ï¼å†…æ¨¡å¼æ˜ è±¡å®šä¹‰äº†æ•°æ®å…¨å±€é€»è¾‘ç»“æ„ä¸å­˜å‚¨ç»“æ„ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ä¾‹å¦‚ï¼Œè¯´æ˜é€»è¾‘è®°å½•å’Œå­—æ®µåœ¨å†…éƒ¨æ˜¯å¦‚ä½•è¡¨ç¤ºçš„ æ•°æ®åº“ä¸­æ¨¡å¼ï¼å†…æ¨¡å¼æ˜ è±¡æ˜¯å”¯ä¸€çš„ æ¨¡å¼ï¼å†…æ¨¡å¼æ˜ è±¡çš„ç”¨é€”ï¼šä¿è¯æ•°æ®çš„ç‰©ç†ç‹¬ç«‹æ€§ å½“æ•°æ®åº“çš„å­˜å‚¨ç»“æ„æ”¹å˜äº†ï¼ˆä¾‹å¦‚é€‰ç”¨äº†å¦ä¸€ç§å­˜å‚¨ç»“æ„ï¼‰ï¼Œæ•°æ®åº“ç®¡ç†å‘˜ä¿®æ”¹æ¨¡å¼ï¼å†…æ¨¡å¼æ˜ è±¡ï¼Œä½¿æ¨¡å¼ä¿æŒä¸å˜ åº”ç”¨ç¨‹åºä¸å—å½±å“ã€‚ä¿è¯äº†æ•°æ®ä¸ç¨‹åºçš„ç‰©ç†ç‹¬ç«‹æ€§ï¼Œç®€ç§°æ•°æ®çš„ç‰©ç†ç‹¬ç«‹æ€§ã€‚ 2.6 äº‹åŠ¡2.6.1 äº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µäº‹åŠ¡(Transaction)æ˜¯ç”¨æˆ·å®šä¹‰çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œåºåˆ—ï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åšï¼Œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡æ˜¯æ¢å¤å’Œå¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½ã€‚ 2.6.2 äº‹åŠ¡çš„ç‰¹æ€§ï¼ˆACIDï¼‰åŸå­æ€§ï¼ˆAtomicityï¼‰äº‹åŠ¡æ˜¯æ•°æ®åº“çš„é€»è¾‘å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…æ‹¬çš„è¯¸æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰äº‹åŠ¡æ‰§è¡Œçš„ç»“æœå¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ ä¸€è‡´æ€§çŠ¶æ€ï¼šæ•°æ®åº“ä¸­åªåŒ…å«æˆåŠŸäº‹åŠ¡æäº¤çš„ç»“æœ ä¸ä¸€è‡´çŠ¶æ€ï¼šæ•°æ®åº“ä¸­åŒ…å«å¤±è´¥äº‹åŠ¡çš„ç»“æœ éš”ç¦»æ€§ï¼ˆIsolationï¼‰å¯¹å¹¶å‘æ‰§è¡Œè€Œè¨€ ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚ ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å…¶ä»–å¹¶å‘äº‹åŠ¡æ˜¯éš”ç¦»çš„ã€‚ å¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰° æŒç»­æ€§ï¼ˆDurability ï¼‰æŒç»­æ€§ä¹Ÿç§°æ°¸ä¹…æ€§ï¼ˆPermanenceï¼‰ ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚ æ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æ‰§è¡Œç»“æœæœ‰ä»»ä½•å½±å“ã€‚ ç ´åäº‹åŠ¡ACIDç‰¹æ€§çš„å› ç´  å¤šä¸ªäº‹åŠ¡å¹¶è¡Œè¿è¡Œæ—¶ï¼Œä¸åŒäº‹åŠ¡çš„æ“ä½œäº¤å‰æ‰§è¡Œ äº‹åŠ¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¢«å¼ºè¡Œåœæ­¢ 2.7 æ•…éšœçš„ç§ç±»2.7.1 äº‹åŠ¡æ•…éšœï¼ˆåº”è¯¥ä¸ä¼šè€ƒï¼‰2.7.1.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡æ•…éšœæŸä¸ªäº‹åŠ¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç”±äºç§ç§åŸå› æœªè¿è¡Œè‡³æ­£å¸¸ç»ˆæ­¢ç‚¹å°±å¤­æŠ˜äº† 2.7.1.2 äº‹åŠ¡æ•…éšœçš„æ¢å¤å…ˆUBDOå†ROLLBACK ï¼ˆ1ï¼‰æ’¤æ¶ˆäº‹åŠ¡ï¼ˆUNDOï¼‰ï¼ˆ2ï¼‰å¼ºè¡Œå›æ»š**(ROLLBACK)**è¯¥äº‹åŠ¡ æ¸…é™¤è¯¥äº‹åŠ¡å¯¹æ•°æ®åº“çš„æ‰€æœ‰ä¿®æ”¹ï¼Œä½¿å¾—è¿™ä¸ªäº‹åŠ¡åƒæ ¹æœ¬æ²¡æœ‰å¯åŠ¨è¿‡ä¸€æ ·ã€‚ 2.7.1.3 äº‹åŠ¡æ•…éšœçš„å¸¸è§åŸå› è¾“å…¥æ•°æ®æœ‰è¯¯ã€è¿ç®—æº¢å‡ºã€è¿åäº†æŸäº›å®Œæ•´æ€§é™åˆ¶ã€æŸäº›åº”ç”¨ç¨‹åºå‡ºé”™ã€å¹¶è¡Œäº‹åŠ¡å‘ç”Ÿæ­»é” 2.7.2 ç³»ç»Ÿæ•…éšœ2.7.2.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿæ•…éšœ æ•´ä¸ªç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œçªç„¶è¢«ç ´å æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„äº‹åŠ¡éƒ½éæ­£å¸¸ç»ˆæ­¢ å†…å­˜ä¸­æ•°æ®åº“ç¼“å†²åŒºçš„ä¿¡æ¯å…¨éƒ¨ä¸¢å¤± å¤–éƒ¨å­˜å‚¨è®¾å¤‡ä¸Šçš„æ•°æ®æœªå—å½±å“ 2.7.2.2 ç³»ç»Ÿæ•…éšœçš„æ¢å¤å…ˆUNDOå†REDO æ­£å‘æ‰«ææ—¥å¿—æ–‡ä»¶ï¼ˆå³ä»å¤´æ‰«ææ—¥å¿—æ–‡ä»¶ï¼‰ å¯¹Undoé˜Ÿåˆ—äº‹åŠ¡è¿›è¡ŒUNDOå¤„ç† å¯¹Redoé˜Ÿåˆ—äº‹åŠ¡è¿›è¡ŒREDOå¤„ç† 2.7.2.3 ç³»ç»Ÿæ•…éšœçš„å¸¸è§åŸå› æ“ä½œç³»ç»Ÿæˆ–DBMSä»£ç é”™è¯¯ã€æ“ä½œå‘˜æ“ä½œå¤±è¯¯ã€ç‰¹å®šç±»å‹çš„ç¡¬ä»¶é”™è¯¯(å¦‚CPUæ•…éšœ)ã€çªç„¶åœç”µ 2.7.3 ä»‹è´¨æ•…éšœ2.7.3.1 ä»€ä¹ˆæ˜¯ä»‹è´¨æ•…éšœç¡¬ä»¶æ•…éšœä½¿å­˜å‚¨åœ¨å¤–å­˜ä¸­çš„æ•°æ®éƒ¨åˆ†ä¸¢å¤±æˆ–å…¨éƒ¨ä¸¢å¤±ã€‚ ä»‹è´¨æ•…éšœæ¯”å‰ä¸¤ç±»æ•…éšœçš„å¯èƒ½æ€§å°å¾—å¤šï¼Œä½†ç ´åæ€§å¤§å¾—å¤š 2.7.3.2 ä»‹è´¨æ•…éšœçš„æ¢å¤å…ˆæ‰¾å¤‡ä»½ç‚¹å†é‡æ–°æ‰§è¡Œå¤‡ä»½ç‚¹ä¹‹åçš„æˆåŠŸäº‹åŠ¡ è£…å…¥æ•°æ®åº“å‘ç”Ÿä»‹è´¨æ•…éšœå‰æŸä¸ªæ—¶åˆ»çš„æ•°æ®å‰¯æœ¬ ï¼ˆREDOï¼‰é‡åšè‡ªæ­¤æ—¶å§‹çš„æ‰€æœ‰æˆåŠŸäº‹åŠ¡ï¼Œå°†è¿™äº›äº‹åŠ¡å·²æäº¤çš„ç»“æœé‡æ–°è®°å…¥æ•°æ®åº“ æ¢å¤æ“ä½œçš„åŸºæœ¬åŸç†ï¼šå†—ä½™åˆ©ç”¨å­˜å‚¨åœ¨ç³»ç»Ÿå…¶å®ƒåœ°æ–¹çš„å†—ä½™æ•°æ®æ¥é‡å»ºæ•°æ®åº“ä¸­å·²è¢«ç ´åæˆ–ä¸æ­£ç¡®çš„é‚£éƒ¨åˆ†æ•°æ® 2.7.3.3 ä»‹è´¨æ•…éšœçš„å¸¸è§åŸå› ç¡¬ä»¶æ•…éšœï¼šç£ç›˜æŸåã€ç£å¤´ç¢°æ’ã€æ“ä½œç³»ç»Ÿçš„æŸç§æ½œåœ¨é”™è¯¯ã€ç¬æ—¶å¼ºç£åœºå¹²æ‰° 2.8 æ•°æ®è½¬å‚¨è½¬å‚¨æ˜¯æŒ‡DBAå°†æ•´ä¸ªæ•°æ®åº“å¤åˆ¶åˆ°ç£å¸¦æˆ–å¦ä¸€ä¸ªç£ç›˜ä¸Šä¿å­˜èµ·æ¥çš„è¿‡ç¨‹ã€‚è¿™äº›å¤‡ç”¨çš„æ•°æ®æ–‡æœ¬ç§°ä¸ºåå¤‡å‰¯æœ¬æˆ–åæ´å‰¯æœ¬ã€‚ 2.8.1 é™æ€è½¬å‚¨ä¸åŠ¨æ€è½¬å‚¨é™æ€è½¬å‚¨åœ¨ç³»ç»Ÿä¸­æ— è¿è¡Œäº‹åŠ¡æ—¶è¿›è¡Œè½¬å‚¨ï¼Œè½¬å‚¨å¼€å§‹æ—¶æ•°æ®åº“å¤„äºä¸€è‡´æ€§çŠ¶æ€ï¼Œè½¬å‚¨æœŸé—´ä¸å…è®¸å¯¹æ•°æ®åº“çš„ä»»ä½•å­˜å–ã€ä¿®æ”¹æ´»åŠ¨ã€‚ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼› ç¼ºç‚¹ï¼šé™ä½äº†æ•°æ®åº“çš„å¯ç”¨æ€§ï¼ˆè½¬å‚¨å¿…é¡»ç­‰ç”¨æˆ·äº‹åŠ¡ç»“æŸã€æ–°çš„äº‹åŠ¡å¿…é¡»ç­‰è½¬å‚¨ç»“æŸï¼‰ åŠ¨æ€è½¬å‚¨è½¬å‚¨æ“ä½œä¸ç”¨æˆ·äº‹åŠ¡å¹¶å‘è¿›è¡Œï¼Œè½¬å‚¨æœŸé—´å…è®¸å¯¹æ•°æ®åº“è¿›è¡Œå­˜å–æˆ–ä¿®æ”¹ã€‚ ä¼˜ç‚¹ï¼šä¸ç”¨ç­‰å¾…æ­£åœ¨è¿è¡Œçš„ç”¨æˆ·äº‹åŠ¡ç»“æŸã€ä¸ä¼šå½±å“æ–°äº‹åŠ¡çš„è¿è¡Œ ç¼ºç‚¹ï¼šä¸èƒ½ä¿è¯å‰¯æœ¬ä¸­çš„æ•°æ®æ­£ç¡®æœ‰æ•ˆ åˆ©ç”¨åŠ¨æ€è½¬å‚¨å¾—åˆ°çš„å‰¯æœ¬è¿›è¡Œæ•…éšœæ¢å¤ï¼Œéœ€è¦æŠŠåŠ¨æ€è½¬å‚¨æœŸé—´å„äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹æ´»åŠ¨ç™»è®°ä¸‹æ¥ï¼Œå»ºç«‹æ—¥å¿—æ–‡ä»¶ï¼Œåå¤‡å‰¯æœ¬åŠ ä¸Šæ—¥å¿—æ–‡ä»¶æ‰èƒ½æŠŠæ•°æ®åº“æ¢å¤åˆ°æŸä¸€æ—¶åˆ»çš„æ­£ç¡®çŠ¶æ€ã€‚ 2.8.2 æµ·é‡è½¬å‚¨ä¸å¢é‡è½¬å‚¨æµ·é‡è½¬å‚¨: æ¯æ¬¡è½¬å‚¨å…¨éƒ¨æ•°æ®åº“ å¢é‡è½¬å‚¨: åªè½¬å‚¨ä¸Šæ¬¡è½¬å‚¨åæ›´æ–°è¿‡çš„æ•°æ® æµ·é‡è½¬å‚¨ä¸å¢é‡è½¬å‚¨æ¯”è¾ƒï¼š ä»æ¢å¤è§’åº¦çœ‹ï¼Œä½¿ç”¨æµ·é‡è½¬å‚¨å¾—åˆ°çš„åå¤‡å‰¯æœ¬è¿›è¡Œæ¢å¤å¾€å¾€æ›´æ–¹ä¾¿ ä½†å¦‚æœæ•°æ®åº“å¾ˆå¤§ï¼Œäº‹åŠ¡å¤„ç†åˆååˆ†é¢‘ç¹ï¼Œåˆ™å¢é‡è½¬å‚¨æ–¹å¼æ›´å®ç”¨æ›´æœ‰æ•ˆ 2.9 æ—¥å¿—æ–‡ä»¶ æ—¥å¿—æ–‡ä»¶(log)æ˜¯ç”¨æ¥è®°å½•äº‹åŠ¡å¯¹æ•°æ®åº“çš„æ›´æ–°æ“ä½œçš„æ–‡ä»¶ æ—¥å¿—æ–‡ä»¶çš„ç”¨é€”ï¼š è¿›è¡Œäº‹åŠ¡æ•…éšœæ¢å¤ è¿›è¡Œç³»ç»Ÿæ•…éšœæ¢å¤ ååŠ©åå¤‡å‰¯æœ¬è¿›è¡Œä»‹è´¨æ•…éšœæ¢å¤ 2.10 å¹¶å‘æ§åˆ¶2.10.1 ä¸‰ç§æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ ä¸¢å¤±ä¿®æ”¹(Lost Update) ä¸¢å¤±ä¿®æ”¹æ˜¯æŒ‡äº‹åŠ¡1ä¸äº‹åŠ¡2ä»æ•°æ®åº“ä¸­è¯»å…¥åŒä¸€æ•°æ®å¹¶ä¿®æ”¹ï¼Œäº‹åŠ¡2çš„æäº¤ç»“æœç ´åäº†äº‹åŠ¡1æäº¤çš„ç»“æœï¼Œå¯¼è‡´äº‹åŠ¡1çš„ä¿®æ”¹è¢«ä¸¢å¤±ã€‚ ä¸å¯é‡å¤è¯»(Non-Repeatable Read) ä¸å¯é‡å¤è¯»æ˜¯æŒ‡äº‹åŠ¡1è¯»å–æ•°æ®åï¼Œäº‹åŠ¡2æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œä½¿äº‹åŠ¡1æ— æ³•å†ç°å‰ä¸€æ¬¡è¯»å–ç»“æœã€‚ è¯»â€œè„â€æ•°æ®(Dirty Read) äº‹åŠ¡1ä¿®æ”¹æŸä¸€æ•°æ®ï¼Œå¹¶å°†å…¶å†™å›ç£ç›˜ äº‹åŠ¡2è¯»å–åŒä¸€æ•°æ®å äº‹åŠ¡1ç”±äºæŸç§åŸå› è¢«æ’¤æ¶ˆï¼Œè¿™æ—¶äº‹åŠ¡1å·²ä¿®æ”¹è¿‡çš„æ•°æ®æ¢å¤åŸå€¼ äº‹åŠ¡2è¯»åˆ°çš„æ•°æ®å°±ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæ˜¯ä¸æ­£ç¡®çš„æ•°æ®ï¼Œåˆç§°ä¸ºâ€œè„â€æ•°æ®ã€‚ äº§ç”Ÿä¸‰ç§æ•°æ®ä¸ä¸€è‡´çš„ä¸»è¦åŸå› å°±æ˜¯æ“ä½œæ—¶ç ´åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚ 2.10.2 å°é”(Locking) å°é”çš„åŸºæœ¬ç±»å‹ï¼š æ’å®ƒé”(Exclusive Locksï¼Œç®€ç§°Xé”)ï¼Œé€šå¸¸Xé”ç”¨äºäº‹åŠ¡ä¿®æ”¹æ•°æ®(å†™å…¥æ•°æ®)æ—¶ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºå†™é”ã€‚ å…±äº«é”(Share Locksï¼Œç®€ç§°Sé”)é€šå¸¸Sé”ç”¨äºäº‹åŠ¡è¯»å–æ•°æ®æ—¶ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºè¯»é”ã€‚ å°é”åè®® ä¸€çº§å°é”åè®®ï¼šäº‹åŠ¡Tåœ¨ä¿®æ”¹æ•°æ®Rä¹‹å‰é¡»å…ˆè¿›è¡ŒXé”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ‰é‡Šæ”¾ã€‚ äºŒçº§å°é”åè®®ï¼šåœ¨ä¸€çº§ä¸Šå¢åŠ äº‹åŠ¡Tåœ¨è¯»å–æ•°æ®Rä¹‹å‰å…ˆè¿›è¡ŒSé”ï¼Œè¯»å®Œä¹‹åç«‹å³é‡Šæ”¾è¿™ä¸ªSé”ã€‚ ä¸‰çº§å°é”åè®®ï¼šåœ¨ä¸€çº§ä¸Šå¢åŠ äº‹åŠ¡Tåœ¨è¯»å–æ•°æ®Rä¹‹å‰å…ˆè¿›è¡ŒSé”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸé‡Šæ”¾ã€‚ 2.10.3 äºŒæ®µé”äºŒæ®µåè®®æ˜¯æŒ‡æ‰€æœ‰äº‹åŠ¡å¿…é¡»åˆ†äºŒä¸ªé˜¶æ®µå¯¹æ•°æ®å¯¹è±¡è¿›è¡ŒåŠ é”å’Œè§£é”ï¼š åœ¨å¯¹ä»»ä½•æ•°æ®è¿›è¡Œè¯»ã€å†™æ“ä½œä¹‹å‰ï¼Œé¦–å…ˆç”³è¯·å¹¶è·å¾—å¯¹è¯¥æ•°æ®çš„å°é”ã€‚ åœ¨é‡Šæ”¾ä¸€ä¸ªå°é”åï¼Œäº‹åŠ¡ä¸å†ç”³è¯·å’Œè·å¾—ä»»ä½•å…¶ä»–çš„å°é”ã€‚ ä¸ä¸¢å¤±ä¿®æ”¹ ä¸è¯»è„æ•°æ® å¯é‡å¤è¯» äºŒæ®µé” âˆš Ã— âˆš 3ã€ç¼–ç¨‹é¢˜ï¼ˆ5*10ï¼‰3.1 è§†å›¾çš„ç”¨æ³•1234567891011121314151617181920-- [ä¾‹4.14]å»ºç«‹è®¡ç®—æœºç³»å­¦ç”Ÿçš„è§†å›¾-- æŠŠå¯¹è¯¥è§†å›¾çš„SELECTæƒé™æˆäºˆç‹å¹³-- æŠŠè¯¥è§†å›¾ä¸Šçš„æ‰€æœ‰æ“ä½œæƒé™æˆäºˆå¼ æ˜ã€‚-- å…ˆå»ºç«‹è§†å›¾CS_StudentCREATE VIEW CS_Student AS SELECT*FROM Student WHERE Sdept=&#x27;CS&#x27;;-- ç‹å¹³è€å¸ˆåªèƒ½æ£€ç´¢è®¡ç®—æœºç³»å­¦ç”Ÿçš„ä¿¡æ¯GRANT SELECT ON CS_Student TO ç‹å¹³;-- ç³»ä¸»ä»»å…·æœ‰æ£€ç´¢å’Œå¢åˆ æ”¹--è®¡ç®—æœºç³»å­¦ç”Ÿä¿¡æ¯çš„æ‰€æœ‰æƒé™GRANT ALLPRIVILEGES ON CS_Student TO å¼ æ˜; 3.2 9ä¸ªSQLåŠ¨è¯çš„ç”¨æ³•3.2.1 CREATEï¼ŒDROPï¼ŒALTER3.2.1.1 CREATE12345678910111213141516171819202122-- SQL CREATE DATABASE è¯­æ³•CREATE DATABASE dbname;-- SQL CREATE TABLE è¯­æ³•CREATE TABLE table_name(column_name1 data_type(size),column_name2 data_type(size),column_name3 data_type(size),....);-- Create table SCREATE TABLE S ( SNO VARCHAR(20), SNAME VARCHAR(50), STATUS INT, CITY VARCHAR(50)) CHARSET = UTF8; 3.2.1.2 DROP123456789-- ç”¨äº MySQL çš„ DROP INDEX è¯­æ³•ï¼šALTER TABLE table_name DROP INDEX index_name-- DROP TABLE è¯­å¥ç”¨äºåˆ é™¤è¡¨ã€‚DROP TABLE table_name-- DROP DATABASE è¯­å¥ç”¨äºåˆ é™¤æ•°æ®åº“ã€‚DROP DATABASE database_name 3.2.1.3 ALTER123456789101112131415161718192021222324-- åœ¨è¡¨ä¸­æ·»åŠ åˆ—:ALTER TABLE è¡¨åADD åˆ—å æ•°æ®ç±»å‹--åˆ é™¤è¡¨ä¸­çš„åˆ—:ALTER TABLE è¡¨åDROP COLUMN åˆ—å-- åˆ›å»ºä¸»é”®ALTER TABLE E ADD PRIMARY KEY (ENO);ALTER TABLE P ADD PRIMARY KEY (PNO);-- åˆ›å»ºå¤–é”®ALTER TABLE E ADD FOREIGN KEY (PNO) REFERENCES P(PNO);-- åˆ›å»ºçº¦æŸC1ï¼Œ-- å®šä¹‰èŒå·¥å¹´é¾„ä¸å¾—è¶…è¿‡60å²ALTER TABLE E ADD CONSTRAINT C1 CHECK (AGE &lt; 60); 3.2.2 SELECTï¼ŒINSERTï¼ŒDELETEï¼ŒUPDATE3.2.2.1 SELECT1234567891011121314151617181920212223242526272829303132333435363738394041424344-- 5.1 æ‰¾å‡ºæ‰€æœ‰ä¾›åº”å•†çš„å§“åå’Œæ‰€åœ¨åŸå¸‚SELECT SNAME,CITY FROM S;-- 5.2 æ‰¾å‡ºæ‰€æœ‰é›¶ä»¶çš„åç§°ã€é¢œè‰²ã€é‡é‡SELECT PNAME,COLOR,WEIGHT FROM P;-- 5.3 æ‰¾å‡ºä½¿ç”¨ä¾›åº”å•†S1æ‰€ä¾›åº”é›¶ä»¶çš„å·¥ç¨‹å·ç SELECT JNO FROM SPJ WHERE SNO = &#x27;S1&#x27; ORDER BY JNO;-- 5.4 æ‰¾å‡ºå·¥ç¨‹é¡¹ç›®J2ä½¿ç”¨çš„å„ç§é›¶ä»¶çš„åç§°åŠå…¶æ•°é‡SELECT PNAME,QTY FROM P,SPJ WHERE P.PNO = SPJ.PNO AND SPJ.JNO = &#x27;J2&#x27;;-- 5.5 æ‰¾å‡ºä¸Šæµ·å‚å•†ä¾›åº”çš„æ‰€æœ‰é›¶ä»¶å·ç SELECT DISTINCT PNO FROM S,SPJ WHERE S.SNO = SPJ.SNO AND CITY = &#x27;ä¸Šæµ·&#x27; ORDER BY PNO;-- 5.6 æ‰¾å‡ºä½¿ç”¨ä¸Šæµ·äº§çš„é›¶ä»¶çš„å·¥ç¨‹åç§°SELECT DISTINCT JNAME FROM S,J,SPJ WHERE S.SNO = SPJ.SNO AND J.JNO = SPJ.JNO AND S.CITY = &#x27;ä¸Šæµ·&#x27;;-- 5.7 æ‰¾å‡ºæ²¡æœ‰ä½¿ç”¨å¤©æ´¥äº§çš„é›¶ä»¶çš„å·¥ç¨‹å·ç SELECT DISTINCT JNO FROM JWHERE JNO NOT IN ( SELECT DISTINCT SPJ.JNO FROM S,J,SPJ WHERE S.SNO = SPJ.SNO AND J.JNO = SPJ.JNO AND S.CITY = &#x27;å¤©æ´¥&#x27; ORDER BY SPJ.JNO); 3.2.2.2 INSERT12345-- Insert data into table SINSERT INTO S (SNO,SNAME,STATUS,CITY) VALUES (&#x27;S1&#x27;,&#x27;ç²¾ç›Š&#x27;,20,&#x27;å¤©æ´¥&#x27;); 3.2.2.3 DELETE123456789101112-- DELETEå®Œæ•´è¯­æ³•DELETE FROM table_nameWHERE some_column=some_value;-- 5.10 ä»ä¾›åº”å•†å…³ç³»ä¸­åˆ é™¤S2çš„è®°å½•ï¼Œ-- å¹¶ä»ä¾›åº”æƒ…å†µå…³ç³»ä¸­åˆ é™¤ç›¸åº”çš„è®°å½•-- å…ˆåˆ é™¤å¤–é”®å†åˆ é™¤ä¸»é”®DELETE FROM SPJ WHERE SNO = &#x27;S2&#x27;; DELETE FROM S WHERE SNO = &#x27;S2&#x27;; 3.2.2.4 UPDATE1234567891011121314-- UPDATAå®Œæ•´è¯­æ³•UPDATE table_nameSET column1=value1,column2=value2,...WHERE some_column=some_value;-- 5.8 æŠŠå…¨éƒ¨çº¢è‰²é›¶ä»¶çš„é¢œè‰²æ”¹ä¸ºè“è‰²UPDATE P SET COLOR = &#x27;è“&#x27; WHERE COLOR = &#x27;çº¢&#x27;;-- 5.9 ç”±S5ä¾›ç»™J4çš„é›¶ä»¶P6æ”¹ä¸ºç”±S3ä¾›åº”UPDATE SPJ SET SNO = &#x27;S3&#x27; WHERE SNO = &#x27;S5&#x27; AND JNO = &#x27;J4&#x27; AND PNO = &#x27;P6&#x27;; 3.2.3 GRANTï¼ŒREVOKEï¼ˆå®‰å…¨æ€§æ§åˆ¶ï¼‰1234567891011121314151617181920212223-- ALL PRIVILIGES è¡¨ç¤ºæ‰€æœ‰æƒé™-- PUBLICæˆ–è€…ALL è¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·-- GRANTå®Œæ•´è¯­æ³•GRANT &lt;æƒé™&gt;[,&lt;æƒé™&gt;]â€¦ON &lt;å¯¹è±¡ç±»å‹ å¯¹è±¡å&gt;[,&lt;å¯¹è±¡ç±»å‹ å¯¹è±¡å&gt;â€¦]TO &lt;ç”¨æˆ·&gt;[,&lt;ç”¨æˆ·&gt;]â€¦[WITH GRANT OPTION];-- æŒ‡å®šäº†WITH GRANT OPTIONå­å¥ï¼š-- è·å¾—æŸç§æƒé™çš„ç”¨æˆ·è¿˜å¯ä»¥æŠŠè¿™ç§æƒé™å†æˆäºˆåˆ«çš„ç”¨æˆ·-- ä¾‹é¢˜ï¼šæŠŠæŸ¥è¯¢Studentè¡¨å’Œä¿®æ”¹å­¦ç”Ÿå­¦å·çš„æƒé™æˆç»™ç”¨æˆ·U4ã€‚GRANT SELECT, UPDATE(Sno)ON TABLE Student TO U4;-- REVOKEå®Œæ•´è¯­æ³•REVOKE &lt;æƒé™&gt;[,&lt;æƒé™&gt;]â€¦ON &lt;å¯¹è±¡ç±»å‹ å¯¹è±¡å&gt;[,&lt;å¯¹è±¡ç±»å‹ å¯¹è±¡å&gt;â€¦]FROM &lt;ç”¨æˆ·&gt;[,&lt;ç”¨æˆ·&gt;]â€¦[CASCADE|RESTRICT];-- CASCADEè¡¨ç¤ºçº§è”æ”¶å›æƒé™-- RESTRICTæ˜¯é»˜è®¤é€‰é¡¹ï¼Œä¸çº§è”æ”¶å› 3.3 ä¸»é”®å’Œå¤–é”®çš„ç”¨æ³•ï¼ˆå®Œæ•´æ€§æ§åˆ¶ï¼‰1234567891011121314151617-- æ’å…¥ä¸»é”®è¯­æ³•ALTER TABLE è¡¨å ADD PRIMARY KEY ä¸»é”®åˆ—;-- è®¾ç½®ä¸»é”®ALTER TABLE S ADD PRIMARY KEY (SNO);-- æ’å…¥å¤–é”®è¯­æ³•ALTER TABLE è¡¨å ADD FOREIGN KEY å¤–é”®åˆ— REFERENCES è¡¨åï¼ˆä¸»é”®åˆ—ï¼‰;-- è®¾ç½®å¤–é”®ALTER TABLE SPJ ADD FOREIGN KEY (SNO) REFERENCES S(SNO); 3.4 çº¦æŸCONSTRAINT1234567891011121314151617181920212223242526272829303132333435--[ä¾‹10] åˆ›å»ºStudentè¡¨ï¼Œè¦æ±‚ï¼š--ï¼ˆ1ï¼‰å­¦å·åœ¨90000ï½99999ä¹‹é—´--ï¼ˆ2ï¼‰å§“åä¸èƒ½ä¸ºç©º--ï¼ˆ3ï¼‰å¹´é¾„å°äº30--ï¼ˆ4ï¼‰æ€§åˆ«åªèƒ½æ˜¯ &#x27;ç”·&#x27; æˆ– &#x27;å¥³&#x27; CREATE TABLE Student( Sno NUMERIC(6) CONSTRAINT C1 CHECK(Sno BETWEEN 90000 AND 99999), Sname CHAR(20) CONSTRAINT C2 NOT NULL, Sage SMALLINT CONSTRAINT C3 CHECK(Sage &lt; 30), Ssex CHAR(2) CONSTRAINT C4 CHECK(Ssex IN(&#x27;ç”·&#x27;,&#x27;å¥³&#x27;)), Sdept CHAR(20), CONSTRAINT StudentPK PRIMARY KEY(Sno))-- åˆ›å»ºçº¦æŸC1ï¼Œå®šä¹‰èŒå·¥å¹´é¾„ä¸å¾—è¶…è¿‡60å²ALTER TABLE E ADD CONSTRAINT C1 CHECK (AGE &lt; 60);-- å½“è¡¨å·²è¢«åˆ›å»ºæ—¶ï¼Œ-- å¦‚éœ€åœ¨ &quot;P_Id&quot; åˆ—åˆ›å»º UNIQUE çº¦æŸï¼Œ-- è¯·ä½¿ç”¨ä¸‹é¢çš„ SQLï¼šALTER TABLE PersonsADD UNIQUE (P_Id)-- å¦‚éœ€å‘½å UNIQUE çº¦æŸï¼ˆæ­¤å¤„ä¸ºC1ï¼‰ï¼Œ-- å¹¶å®šä¹‰å¤šä¸ªåˆ—çš„ UNIQUE çº¦æŸï¼Œ-- è¯·ä½¿ç”¨ä¸‹é¢çš„ SQL è¯­æ³•ï¼šALTER TABLE PersonsADD CONSTRAINT C1 UNIQUE (P_Id,LastName) 4ã€åˆ†æé¢˜ï¼ˆ2*10ï¼‰4.1 èŒƒå¼çœ‹è¯¾æœ¬6.2ç« å¯¹åº”çš„ä¾‹é¢˜ 4.1.1 æ¦‚å¿µï¼ˆäº†è§£å³å¯ï¼‰èŒƒå¼ï¼šNormal Formatï¼Œæ˜¯ä¸€ç§ç¦»æ•£æ•°å­¦ä¸­çš„çŸ¥è¯†ï¼Œæ˜¯ä¸ºäº†è§£å†³ä¸€ç§æ•°æ®çš„å­˜å‚¨ä¸ä¼˜åŒ–çš„é—®é¢˜ï¼šä¿å­˜æ•°æ®çš„å­˜å‚¨ä¹‹åï¼Œå‡¡æ˜¯èƒ½å¤Ÿé€šè¿‡å…³ç³»å¯»æ‰¾å‡ºæ¥çš„æ•°æ®ï¼Œåšå†³ä¸å†é‡å¤å­˜å‚¨ï¼šç»ˆæç›®æ ‡æ˜¯ä¸ºäº†å‡å°‘æ•°æ®çš„å†—ä½™ã€‚ èŒƒå¼ï¼šæ˜¯ä¸€ç§åˆ†å±‚ç»“æ„çš„è§„èŒƒï¼Œåˆ†ä¸ºå…­å±‚ï¼šæ¯ä¸€æ¬¡å±‚éƒ½æ¯”ä¸Šä¸€å±‚æ›´åŠ ä¸¥æ ¼ï¼šè‹¥è¦æ»¡è¶³ä¸‹ä¸€å±‚èŒƒå¼ï¼Œå‰ææ˜¯æ»¡è¶³ä¸Šä¸€å±‚èŒƒå¼ã€‚ å…­å±‚èŒƒå¼ï¼š1NFï¼Œ2NFï¼Œ3NFï¼ŒBCNFï¼Œ4NFï¼Œ5NFï¼Œ1NFè¦æ±‚æœ€ä½ï¼›5NFè¦æ±‚æœ€ä¸¥æ ¼ã€‚ Mysqlå±äºå…³ç³»å‹æ•°æ®åº“ï¼šæœ‰ç©ºé—´æµªè´¹ï¼šä¹Ÿæ˜¯è‡´åŠ›äºèŠ‚çœå­˜å‚¨ç©ºé—´ï¼šä¸èŒƒå¼æ‰€æœ‰è§£å†³çš„é—®é¢˜ä¸è°‹è€Œåˆï¼šåœ¨è®¾è®¡æ•°æ®åº“çš„æ—¶å€™ï¼Œä¼šåˆ©ç”¨åˆ°èŒƒå¼æ¥æŒ‡å¯¼è®¾è®¡ã€‚ ä½†æ˜¯æ•°æ®åº“ä¸å•æ˜¯è¦è§£å†³ç©ºé—´é—®é¢˜ï¼Œè¦ä¿è¯æ•ˆç‡é—®é¢˜ï¼šèŒƒå¼åªä¸ºè§£å†³ç©ºé—´é—®é¢˜ï¼Œæ‰€ä»¥æ•°æ®åº“çš„è®¾è®¡åˆä¸å¯èƒ½å®Œå…¨æŒ‰ç…§èŒƒå¼çš„è¦æ±‚å®ç°ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªæœ‰å‰ä¸‰ç§èŒƒå¼éœ€è¦æ»¡è¶³ã€‚èŒƒå¼åœ¨æ•°æ®åº“çš„è®¾è®¡å½“ä¸­æ˜¯æœ‰æŒ‡å¯¼æ„ä¹‰ï¼šä½†æ˜¯ä¸æ˜¯å¼ºåˆ¶è§„èŒƒã€‚ ä¸€ä¸ªä½ä¸€çº§èŒƒå¼çš„å…³ç³»æ¨¡å¼é€šè¿‡æ¨¡å¼åˆ†è§£ï¼ˆschema decompositionï¼‰å¯ä»¥è½¬æ¢ä¸ºè‹¥å¹²ä¸ªé«˜ä¸€çº§èŒƒå¼çš„å…³ç³»æ¨¡å¼çš„é›†åˆï¼Œè¿™ç§è¿‡ç¨‹å°±å«è§„èŒƒåŒ–ï¼ˆnormalizationï¼‰ã€‚ 4.1.2 1NFç¬¬ä¸€èŒƒå¼ï¼šåœ¨è®¾è®¡è¡¨å­˜å‚¨æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœè¡¨ä¸­è®¾è®¡çš„å­—æ®µå­˜å‚¨çš„æ•°æ®ï¼Œåœ¨å–å‡ºæ¥ä½¿ç”¨ä¹‹å‰è¿˜éœ€è¦é¢å¤–çš„å¤„ç†ï¼ˆæ‹†åˆ†ï¼‰ï¼Œé‚£ä¹ˆè¯´è¡¨çš„è®¾è®¡ä¸æ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼šç¬¬ä¸€èŒƒå¼è¦æ±‚å­—æ®µçš„æ•°æ®å…·æœ‰åŸå­æ€§ï¼šä¸å¯å†åˆ†ã€‚ï¼ˆå…³é”®è¿˜è¦çœ‹å®é™…ä¸šåŠ¡éœ€æ±‚ï¼‰ 4.1.3 2NFç¬¬äºŒèŒƒå¼ï¼šåœ¨æ•°æ®è¡¨è®¾è®¡çš„è¿‡ç¨‹ä¸­å¦‚æœæœ‰å¤åˆä¸»é”®ï¼ˆå¤šå­—æ®µä¸»é”®ï¼‰ï¼Œä¸”è¡¨ä¸­æœ‰å­—æ®µå¹¶ä¸æ˜¯ç”±æ•´ä¸ªä¸»é”®æ¥ç¡®å®šï¼Œè€Œæ˜¯ä¾èµ–ä¸»é”®ä¸­çš„æŸä¸ªå­—æ®µï¼ˆä¸»é”®çš„éƒ¨åˆ†ï¼‰ï¼šå­˜åœ¨å­—æ®µä¾èµ–ä¸»é”®çš„éƒ¨åˆ†çš„é—®é¢˜ï¼Œç§°ä¹‹ä¸ºéƒ¨åˆ†ä¾èµ–ï¼šç¬¬äºŒèŒƒå¼å°±æ˜¯è¦è§£å†³è¡¨è®¾è®¡ä¸å…è®¸å‡ºç°éƒ¨åˆ†ä¾èµ–ã€‚ 4.1.4 3NFç¬¬ä¸‰èŒƒå¼ï¼šç†è®ºä¸Šè®²ï¼Œåº”è¯¥ä¸€å¼ è¡¨ä¸­çš„æ‰€æœ‰å­—æ®µéƒ½åº”è¯¥ç›´æ¥ä¾èµ–ä¸»é”®ï¼ˆé€»è¾‘ä¸»é”®ï¼šä»£è¡¨çš„æ˜¯ä¸šåŠ¡ä¸»é”®ï¼‰ï¼Œå¦‚æœè¡¨è®¾è®¡ä¸­å­˜åœ¨ä¸€ä¸ªå­—æ®µï¼Œå¹¶ä¸ç›´æ¥ä¾èµ–ä¸»é”®ï¼Œè€Œæ˜¯é€šè¿‡æŸä¸ªéä¸»é”®å­—æ®µä¾èµ–ï¼Œæœ€ç»ˆå®ç°ä¾èµ–ä¸»é”®ï¼šæŠŠè¿™ç§ä¸æ˜¯ç›´æ¥ä¾èµ–ä¸»é”®ï¼Œè€Œæ˜¯ä¾èµ–éä¸»é”®å­—æ®µçš„ä¾èµ–å…³ç³»ç§°ä¹‹ä¸ºä¼ é€’ä¾èµ–ã€‚ 4.2 æ•°æ®åº“è®¾è®¡4.2.1 éœ€æ±‚è¯´æ˜å…ˆé™ˆè¿°æ¸…æ¥šæ‰€æœ‰çš„éœ€æ±‚ã€‚éœ€æ±‚åˆ†æå°±æ˜¯åˆ†æç”¨æˆ·çš„éœ€è¦ä¸è¦æ±‚ã€‚ éœ€æ±‚åˆ†ææ˜¯è®¾è®¡æ•°æ®åº“çš„èµ·ç‚¹ éœ€æ±‚åˆ†æçš„ç»“æœæ˜¯å¦å‡†ç¡®åœ°åæ˜ äº†ç”¨æˆ·çš„å®é™…è¦æ±‚ï¼Œå°†ç›´æ¥å½±å“åˆ°åé¢å„ä¸ªé˜¶æ®µçš„è®¾è®¡ï¼Œå¹¶å½±å“åˆ°è®¾è®¡ç»“æœæ˜¯å¦åˆç†å’Œå®ç”¨ 4.2.2 E-Rå›¾å’Œå…³ç³»æ¨¡å¼E-Rå›¾ç”»ä¸€äº›ç®€å•çš„ERå›¾æ¥æè¿°æ•°æ®è¡¨ã€‚ å…³ç³»æ¨¡å¼å¯¹æ¯ä¸ªå®ä½“å®šä¹‰çš„å±æ€§å¦‚ä¸‹æ‰€ç¤ºã€‚åŠ ç²—çš„ä¸ºå®ä½“çš„ç ã€‚ é¡¾å®¢ï¼š{é¡¾å®¢å·ï¼Œé¡¾å®¢åï¼Œåœ°å€ï¼Œç”µè¯ï¼Œä¿¡è´·çŠ¶å†µï¼Œè´¦ç›®ä½™é¢} è®¢å•ï¼š{è®¢å•å·ï¼Œé¡¾å®¢å·ï¼Œè®¢è´§é¡¹æ•°ï¼Œè®¢è´§æ—¥æœŸï¼Œäº¤è´§æ—¥æœŸï¼Œå·¥ç§å·ï¼Œç”Ÿäº§åœ°ç‚¹} è®¢å•ç»†åˆ™ï¼š{è®¢å•å·ï¼Œç»†åˆ™å·ï¼Œé›¶ä»¶å·ï¼Œè®¢è´§æ•°ï¼Œé‡‘é¢} åº”æ”¶è´¦æ¬¾ï¼š{é¡¾å®¢å·ï¼Œè®¢å•å·ï¼Œå‘ç¥¨å·ï¼Œåº”æ”¶é‡‘é¢ï¼Œæ”¯ä»˜æ—¥æœŸï¼Œæ”¯ä»˜é‡‘é¢ï¼Œå½“å‰ä½™é¢ï¼Œè´§æ¬¾é™é¢} äº§å“ï¼š{äº§å“å·ï¼Œäº§å“åï¼Œå•ä»·ï¼Œé‡é‡} æŠ˜æ‰£è§„åˆ™ï¼š{äº§å“å·ï¼Œè®¢è´§é‡ï¼ŒæŠ˜æ‰£} 4.2.3 å»ºè¡¨å™è¿°","categories":[{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"},{"name":"database","slug":"database","permalink":"https://tinychen.com/tags/database/"}]},{"title":"Ubuntu18.04å‡çº§Linuxå†…æ ¸","slug":"20190614-ubuntu-update-kernel","date":"2019-06-14T07:00:00.000Z","updated":"2019-06-14T07:00:00.000Z","comments":true,"path":"20190614-ubuntu-update-kernel/","link":"","permalink":"https://tinychen.com/20190614-ubuntu-update-kernel/","excerpt":"Ubuntu18.04å‡çº§5.1.9çš„Linuxå†…æ ¸ï¼Œå¦‚æœæç¤ºæƒé™ä¸è¶³è®°å¾—åˆ‡æ¢rootç”¨æˆ·ã€‚ CentOS7ç‰ˆæœ¬è¯·ç§»æ­¥è¿™é‡Œã€‚","text":"Ubuntu18.04å‡çº§5.1.9çš„Linuxå†…æ ¸ï¼Œå¦‚æœæç¤ºæƒé™ä¸è¶³è®°å¾—åˆ‡æ¢rootç”¨æˆ·ã€‚ CentOS7ç‰ˆæœ¬è¯·ç§»æ­¥è¿™é‡Œã€‚ 1ã€ä¸‹è½½å†…æ ¸12# æŸ¥çœ‹å½“å‰å†…æ ¸uname -r ä¸‹è½½æ‰€éœ€å†…æ ¸ï¼Œå®˜ç½‘åœ°å€ï¼š https://kernel.ubuntu.com/~kernel-ppa/mainline ç›®å‰æ¥çœ‹æœ€æ–°çš„åº”è¯¥æ˜¯5.1.9 å–å†³äºæ‚¨çš„æ“ä½œç³»ç»Ÿç±»å‹ï¼Œè¯·ä¾æ¬¡ä¸‹è½½å’Œå®‰è£…è½¯ä»¶åŒ…ï¼š linux-headers-5.1.9-xxxxxx_all.deb linux-headers-5.1.9-xxx-generic(/lowlatency)_xxx_amd64(/i386).deb linux-modules-5.1.9-xxx-generic(/lowlatency)_xxx_amd64(/i386).deb linux-image-xxx-5.1.9-xxx-generic(/lowlatency)_xxx_amd64(/i386).deb é€‰æ‹©é€šç”¨ç³»ç»Ÿçš„genericï¼Œä½å»¶è¿Ÿç³»ç»Ÿï¼ˆä¾‹å¦‚ç”¨äºå½•åˆ¶éŸ³é¢‘ï¼‰çš„lowlatencyï¼Œ64ä½ç³»ç»Ÿçš„amd6432ä½ç³»ç»Ÿçš„i386ï¼Œå…¶ä»–OSç±»å‹çš„armhfï¼Œarm64ç­‰ã€‚ 1234wget -c https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.1.9/linux-headers-5.1.9-050109_5.1.9-050109.201906111132_all.debwget -c https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.1.9/linux-headers-5.1.9-050109-generic_5.1.9-050109.201906111132_amd64.debwget -c https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.1.9/linux-image-unsigned-5.1.9-050109-generic_5.1.9-050109.201906111132_amd64.debwget -c https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.1.9/linux-modules-5.1.9-050109-generic_5.1.9-050109.201906111132_amd64.deb 2ã€å®‰è£…å†…æ ¸1sudo dpkg -i *.deb é‡å¯åæŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬ 1uname -r 3ã€å¸è½½å†…æ ¸12# æŸ¥çœ‹æ‰€æœ‰å†…æ ¸sudo dpkg --get-selections | grep linux 12# å¸è½½å†…æ ¸sudo apt autoremove &lt;package&gt; 123# æ›´æ–°grubsudo update-grubsudo update-grub2 é‡å¯åå†æ¬¡æŸ¥çœ‹ï¼Œå¯¹ç±»å‹ä¸ºdeinstallçš„è¿›è¡Œä¸‹åˆ—æ“ä½œå½»åº•åˆ é™¤ 12sudo dpkg --get-selections | grep linuxsudo dpkg -P &lt;package&gt; 4ã€æ›´æ”¹å¯åŠ¨å†…æ ¸1cat /boot/grub/grub.cfg | grep &#x27;menuentry&#x27;| grep Ubuntu ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰å››ä¸ªå¯åŠ¨å†…æ ¸å…±è®¡ä¸¤ä¸ªç‰ˆæœ¬ã€‚ 1cat /boot/grub/grub.cfg | grep &#x27;set default&#x27; set default=&quot;0&quot;å°±æ˜¯ä¸Šé¢åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªï¼Œä¿®æ”¹ä¸ºéœ€è¦å¯åŠ¨çš„å†…æ ¸åºå·å³å¯","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"}]},{"title":"CentOSå‡çº§Linuxå†…æ ¸","slug":"20190612-centos-update-kernel","date":"2019-06-12T07:00:00.000Z","updated":"2019-06-12T07:00:00.000Z","comments":true,"path":"20190612-centos-update-kernel/","link":"","permalink":"https://tinychen.com/20190612-centos-update-kernel/","excerpt":"CentOS7.6å‡çº§5.1.9çš„Linuxå†…æ ¸ï¼Œå¦‚æœæç¤ºæƒé™ä¸è¶³è®°å¾—åˆ‡æ¢rootç”¨æˆ·ã€‚ Ubunut18.04ç‰ˆæœ¬è¯·ç§»æ­¥è¿™é‡Œ","text":"CentOS7.6å‡çº§5.1.9çš„Linuxå†…æ ¸ï¼Œå¦‚æœæç¤ºæƒé™ä¸è¶³è®°å¾—åˆ‡æ¢rootç”¨æˆ·ã€‚ Ubunut18.04ç‰ˆæœ¬è¯·ç§»æ­¥è¿™é‡Œ 1ã€yumå‡çº§å†…æ ¸12345678# æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬uname -r# æ›´æ–°yumæºyum update -y# å‡çº§yumæºä¸­çš„æœ€æ–°ç‰ˆå†…æ ¸yum install -y kernel 2ã€å‡çº§ELRepoåº“æä¾›çš„å†…æ ¸1234# å¯¼å…¥ ELRepo ä»“åº“çš„KEYrpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org# ä½¿ç”¨yumå®‰è£… elrepoçš„ä»“åº“åŒ…yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm ELRepo ä»“åº“æ˜¯åŸºäºç¤¾åŒºçš„ç”¨äºä¼ä¸šçº§ Linux ä»“åº“ï¼Œæä¾›å¯¹ RedHat Enterprise (RHEL) å’Œ å…¶ä»–åŸºäº RHELçš„ Linux å‘è¡Œç‰ˆï¼ˆCentOSã€Scientificã€Fedora ç­‰ï¼‰çš„æ”¯æŒã€‚ ELRepo èšç„¦äºå’Œç¡¬ä»¶ç›¸å…³çš„è½¯ä»¶åŒ…ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ã€æ˜¾å¡é©±åŠ¨ã€ç½‘ç»œé©±åŠ¨ã€å£°å¡é©±åŠ¨å’Œæ‘„åƒå¤´é©±åŠ¨ç­‰ã€‚ 12# æŸ¥çœ‹å¯ç”¨çš„ç³»ç»Ÿå†…æ ¸åŒ…yum --disablerepo=&quot;*&quot; --enablerepo=&quot;elrepo-kernel&quot; list available 12# å®‰è£…æœ€æ–°ç‰ˆå†…æ ¸yum --enablerepo=elrepo-kernel install kernel-ml 12# æŸ¥çœ‹å½“å‰ä¸€å…±å®‰è£…äº†å¤šå°‘ä¸ªå†…æ ¸cat /etc/grub2.cfg | grep menuentry | awk &#x27;&#123;print $2$4$5$6&#125;&#x27; 12# æˆ–è€…è¿™æ ·ï¼Œæ‰¾åˆ°ç½‘ä¸Šçš„ä¸€ä¸ªå¤§ä½¬çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”æˆ‘è¿™ç§èœé¸¡å¼ºå¤šäº†awk -F\\&#x27; &#x27;$1==&quot;menuentry &quot; &#123;print i++ &quot; : &quot; $2&#125;&#x27; /etc/grub2.cfg æ³¨æ„è¿™ä¸ªå‡çº§çš„å†…æ ¸å’Œé€šè¿‡yumå‡çº§çš„ä¸åŒï¼Œyumå‡çº§å†…æ ¸ä¹‹åä¼šæŠŠæ–°å†…æ ¸ä½œä¸ºå¯åŠ¨çš„é»˜è®¤å†…æ ¸ï¼Œè€Œè¿™æ ·å‡çº§å¹¶ä¸ä¼šï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ›´æ”¹é»˜è®¤çš„å¯åŠ¨å†…æ ¸ã€‚ 12# å°†GRUB_DEFAULTä»savedæ”¹ä¸º0vim /etc/default/grub 1234# ä½¿ç”¨grub2é‡æ–°ç”Ÿæˆgrubé…ç½®æ–‡ä»¶grub2-mkconfig -o /boot/grub2/grub.cfg# å¦‚æœæ˜¯ä½¿ç”¨uefiå¼•å¯¼å®‰è£…å¯åŠ¨çš„è¯ç›®å½•åº”è¯¥æ˜¯ä¸‹é¢è¿™ä¸ªgrub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg é‡å¯ä¹‹åå°±ä¼šçœ‹åˆ°é»˜è®¤å¯åŠ¨çš„æ˜¯æ–°å†…æ ¸ 3ã€åˆ é™¤æ—§å†…æ ¸12345# æŸ¥çœ‹ç³»ç»Ÿä¸­çš„æ‰€æœ‰å†…æ ¸ç›¸å…³åŒ…rpm -qa | grep kernel# ä½¿ç”¨yumå¸è½½yum remove &lt;package&gt; 12# åˆ é™¤æœ€æ—§çš„é‚£ä¸ªå†…æ ¸yum remove kernel-3.10.0-957.el7.x86_64 kernel-devel-3.10.0-957.el7.x86_64 ç•™ä¸€ä¸ªæœ€æ–°çš„yumæºçš„å†…æ ¸ä»¥é˜²ä¸‡ä¸€ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"}]},{"title":"WiresharkæŠ“åŒ…åˆ†æDHCPä»¥åŠè·¯ç”±å¹²æ‰°è¿‡ç¨‹","slug":"20190609-wireshark-dhcp","date":"2019-06-09T07:00:00.000Z","updated":"2019-06-09T07:00:00.000Z","comments":true,"path":"20190609-wireshark-dhcp/","link":"","permalink":"https://tinychen.com/20190609-wireshark-dhcp/","excerpt":"ä½¿ç”¨WiresharkæŠ“åŒ…åˆ†æDHCPè¿‡ç¨‹ï¼Œå¹¶åˆ†æåœ¨åŒä¸€å¹¿æ’­åŸŸä¸­å­˜åœ¨å¤šä¸ªDHCPæœåŠ¡å™¨çš„äº§ç”Ÿçš„è·¯ç”±å¹²æ‰°è¿‡ç¨‹ã€‚","text":"ä½¿ç”¨WiresharkæŠ“åŒ…åˆ†æDHCPè¿‡ç¨‹ï¼Œå¹¶åˆ†æåœ¨åŒä¸€å¹¿æ’­åŸŸä¸­å­˜åœ¨å¤šä¸ªDHCPæœåŠ¡å™¨çš„äº§ç”Ÿçš„è·¯ç”±å¹²æ‰°è¿‡ç¨‹ã€‚ 1ã€DHCPç®€ä»‹åŠ¨æ€ä¸»æœºè®¾ç½®åè®®ï¼ˆè‹±è¯­ï¼šDynamic Host Configuration Protocolï¼ŒDHCPï¼‰æ˜¯ä¸€ä¸ªå±€åŸŸç½‘çš„ç½‘ç»œåè®®ï¼Œä½¿ç”¨UDPåè®®å·¥ä½œï¼Œä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼šç”¨äºå†…éƒ¨ç½‘æˆ–ç½‘ç»œæœåŠ¡ä¾›åº”å•†è‡ªåŠ¨åˆ†é…IPåœ°å€ï¼›ç»™ç”¨æˆ·ç”¨äºå†…éƒ¨ç½‘ç®¡ç†å‘˜ä½œä¸ºå¯¹æ‰€æœ‰è®¡ç®—æœºä½œä¸­å¤®ç®¡ç†çš„æ‰‹æ®µã€‚ DHCPæœ‰ä¸‰ç§æœºåˆ¶åˆ†é…IPåœ°å€ï¼š è‡ªåŠ¨åˆ†é…æ–¹å¼ï¼ˆAutomatic Allocationï¼‰ï¼ŒDHCPæœåŠ¡å™¨ä¸ºä¸»æœºæŒ‡å®šä¸€ä¸ªæ°¸ä¹…æ€§çš„IPåœ°å€ï¼Œä¸€æ—¦DHCPå®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡æˆåŠŸä»DHCPæœåŠ¡å™¨ç«¯ç§Ÿç”¨åˆ°IPåœ°å€åï¼Œå°±å¯ä»¥æ°¸ä¹…æ€§çš„ä½¿ç”¨è¯¥åœ°å€ã€‚ åŠ¨æ€åˆ†é…æ–¹å¼ï¼ˆDynamic Allocationï¼‰ï¼ŒDHCPæœåŠ¡å™¨ç»™ä¸»æœºæŒ‡å®šä¸€ä¸ªå…·æœ‰æ—¶é—´é™åˆ¶çš„IPåœ°å€ï¼Œæ—¶é—´åˆ°æœŸæˆ–ä¸»æœºæ˜ç¡®è¡¨ç¤ºæ”¾å¼ƒè¯¥åœ°å€æ—¶ï¼Œè¯¥åœ°å€å¯ä»¥è¢«å…¶ä»–ä¸»æœºä½¿ç”¨ã€‚ æ‰‹å·¥åˆ†é…æ–¹å¼ï¼ˆManual Allocationï¼‰ï¼Œå®¢æˆ·ç«¯çš„IPåœ°å€æ˜¯ç”±ç½‘ç»œç®¡ç†å‘˜æŒ‡å®šçš„ï¼ŒDHCPæœåŠ¡å™¨åªæ˜¯å°†æŒ‡å®šçš„IPåœ°å€å‘Šè¯‰å®¢æˆ·ç«¯ä¸»æœºã€‚ ä¸‰ç§åœ°å€åˆ†é…æ–¹å¼ä¸­ï¼Œåªæœ‰åŠ¨æ€åˆ†é…å¯ä»¥é‡å¤ä½¿ç”¨å®¢æˆ·ç«¯ä¸å†éœ€è¦çš„åœ°å€ã€‚ 2ã€DHCPçŠ¶æ€æœº2.0 DHCPçŠ¶æ€æœºå¦‚ä¸‹å›¾æ‰€ç¤ºæ˜¯æ¯”è¾ƒå¸¸è§çš„DHCPçŠ¶æ€æœºï¼Œä¸‹é¢æˆ‘ä»¬ç»“åˆWiresharkæŠ“åˆ°çš„æ•°æ®åŒ…æ¥è¿›è¡Œåˆ†æã€‚ 2.0.1 å¦‚ä½•æŠ“å–æ•°æ®åŒ…åœ¨windowsä¸‹ï¼Œä½¿ç½‘å¡é‡æ–°å‘å‡ºDHCPè¯·æ±‚è·å–IPåœ°å€æ¯”è¾ƒç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ipconfigå‘½ä»¤ã€‚ 1234# é‡Šæ”¾IPåœ°å€ipconfig -realease# é‡æ–°è·å–IPåœ°å€ipconfig -renew éœ€è¦æ³¨æ„çš„æ˜¯è¦ç¡®å®šç½‘å¡é…ç½®ä¸­æ˜¯ä½¿ç”¨äº†DHCPè€Œä¸æ˜¯æ‰‹åŠ¨æŒ‡å®šIPåœ°å€ã€‚ 2.0.2 ä¸€æ¬¡DHCPè¿‡ç¨‹çš„å››ä¸ªæ•°æ®åŒ…æ­£å¸¸æ¥è¯´ï¼Œä¸€æ¬¡DHCPè¿‡ç¨‹åªéœ€è¦ä¸Šé¢çŠ¶æ€æœºçš„å‰å››æ­¥ï¼Œåé¢çš„ç»­çº¦æ˜¯åœ¨DHCPçš„ç§ŸæœŸåˆ°è¾¾1/2å’Œ7/8çš„æ—¶å€™è¿›è¡Œçš„ã€‚ æ‰“å¼€ä»»æ„ä¸€ä¸ªæ•°æ®åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°wiresharkå·²ç»æŠŠé‡Œé¢çš„æ•°æ®åˆ†å±‚æ˜¾ç¤ºã€‚ ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸ºç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹è¿™å››ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†æã€‚ 2.1 å‘ç°é˜¶æ®µâ€”â€”DHCP Discoverï¼ˆå¹¿æ’­ï¼‰2.1.1 DHCP Discover ç†è®ºåˆ†æDHCP Discoverï¼ˆå¹¿æ’­ï¼‰æ˜¯ç¬¬ä¸€ä¸ªé˜¶æ®µå³DHCPå®¢æˆ·ç«¯å¯»æ‰¾DHCPæœåŠ¡ç«¯çš„é˜¶æ®µã€‚ ç”±äºDHCPæœåŠ¡ç«¯çš„IPåœ°å€ç­‰ä¿¡æ¯å¯¹äºDHCPå®¢æˆ·ç«¯æ¥è¯´æ˜¯æœªçŸ¥ï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨å¹¿æ’­çš„æ–¹å¼è¿›è¡Œå‘é€æ¶ˆæ¯ï¼ŒåŸºäºUDPçš„æºç«¯å£å·68ï¼Œç›®çš„ç«¯å£å·67æ¥å‘é€DHCP Discoverå‘ç°ä¿¡æ¯æ¥å¯»æ‰¾DHCPæœåŠ¡å™¨ã€‚ ç”±äºæ˜¯å¹¿æ’­åŒ…ï¼Œåœ¨åŒä¸€ä¸ªå¹¿æ’­åŸŸä¸­çš„æ¯ä¸€å°å®‰è£…äº†TCP/IPåè®®çš„ä¸»æœºéƒ½ä¼šæ¥æ”¶åˆ°è¿™ç§å¹¿æ’­ä¿¡æ¯ï¼Œä½†åªæœ‰DHCPæœåŠ¡å™¨æ‰ä¼šåšå‡ºå“åº”ã€‚ åœ¨äºŒå±‚ä¸­ï¼Œå¹¿æ’­åœ°å€æ˜¯12ä¸ªfå³ff:ff:ff:ff:ff:ffã€‚ åœ¨ä¸‰å±‚ä¸­ï¼Œå¹¿æ’­åœ°å€æ˜¯4ä¸ª255ï¼ˆIPv4ï¼‰å³255.255.255.255ã€‚ æ¢ç®—æˆäºŒè¿›åˆ¶ï¼Œå³å…¨ä¸º1ã€‚ 2.1.2 DHCP Discover ç‰©ç†å±‚ ç‰©ç†å±‚ç»™å‡ºçš„æœ‰ç”¨ä¿¡æ¯å¹¶ä¸å¤šï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°ç½‘å¡ç›¸å…³ä¿¡æ¯å’Œè¿™ä¸ªæ˜¯DHCPçš„æ•°æ®åŒ…ä¸”ä½¿ç”¨äº†UDPåè®®ã€‚ 2.1.3 DHCP Discover æ•°æ®é“¾è·¯å±‚ æ•°æ®é“¾è·¯å±‚ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ¬æœºçš„MACåœ°å€å’Œç›®æ ‡MACåœ°å€ï¼ˆå¹¿æ’­ï¼‰ã€‚ 2.1.4 DHCP Discover ç½‘ç»œå±‚ ç½‘ç»œå±‚çš„å‚æ•°è¾ƒå¤šï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œä¸€ä¸€è§£æï¼š ç‰ˆæœ¬ï¼ˆVersionï¼‰ï¼š4ï¼Œè¡¨æ˜è¿™é‡Œä½¿ç”¨IPv4 å¤´éƒ¨é•¿åº¦ï¼ˆHeader Lengthï¼‰ï¼š20 bytesï¼Œå³20ä¸ªå­—èŠ‚ åŒºåˆ†æœåŠ¡å­—æ®µï¼ˆDifferentiated Services Fieldï¼‰ï¼š0x00ï¼Œåå…­è¿›åˆ¶ï¼Œæ¢ç®—æˆäºŒè¿›åˆ¶æ­£å¥½æ˜¯ä¸‹é¢çš„8ä¸ª0ï¼Œè¡¨æ˜å½“å‰çš„IPæ•°æ®æŠ¥ä¸­æ²¡æœ‰ä½¿ç”¨æœåŠ¡ç±»å‹å­—æ®µï¼Œé‡‡ç”¨é»˜è®¤çš„â€œå°½åŠ›ä¼ è¾“â€ä¼˜å…ˆçº§åˆ« æ€»é•¿åº¦ï¼ˆTotal Lenthï¼‰ï¼š328ï¼Œè¡¨æ˜è¯¥æ•°æ®æŠ¥çš„æ€»é•¿åº¦æ˜¯328ä¸ªå­—èŠ‚ æ ‡è¯†ï¼ˆIdentificationï¼‰ï¼š0xe752ï¼Œåå…­è¿›åˆ¶ï¼Œæ¢ç®—æˆåè¿›åˆ¶æ­£å¥½æ˜¯æ‹¬å·ä¸­çš„59218ï¼Œè¡¨æ˜è¯¥æ•°æ®æŠ¥çš„æ ‡è¯†ä¸º0xe752 åˆ†æ®µæ ‡è¯†ï¼ˆFlagsï¼‰ï¼š ä¿ç•™ä½ï¼ˆReserved bitï¼‰ä¸º0ï¼ŒDonâ€™t fragmentä¸º0è¡¨ç¤ºè¯¥æ•°æ®æŠ¥å¯ä»¥è¢«åˆ†æ®µï¼ŒMore fragmentsä¸º0è¡¨æ˜åé¢æ²¡æœ‰åˆ†æ®µ åˆ†æ®µåç§»ï¼ˆFragment offsetï¼‰ï¼š0ï¼Œè¡¨æ˜æ²¡æœ‰è¢«åˆ†æ®µ ç”Ÿå­˜æ—¶é—´ï¼ˆTime to liveï¼‰ï¼š128ï¼Œè¡¨æ˜è¯¥æ•°æ®æŠ¥æœ€å¤šå¯ä»¥ç»è¿‡128ä¸ªè·¯ç”± ä¸Šå±‚åè®®ï¼ˆProtocolï¼‰ï¼š UDPï¼Œå€¼ä¸º17 å¤´éƒ¨æ ¡éªŒï¼ˆHeader checksumï¼‰ï¼š validation disabledï¼Œè¡¨ç¤ºæ²¡æœ‰è¿›è¡Œæ ¡éªŒ æ ¡éªŒçŠ¶æ€ï¼ˆHeader checksum statusï¼‰ï¼šUnverifiedï¼ŒåŒä¸Šï¼Œæ²¡æœ‰è¿›è¡Œæ ¡éªŒ æºIPåœ°å€ï¼ˆSourceï¼‰ï¼š0.0.0.0ï¼Œè¡¨æ˜å½“å‰å°šæœªè·å¾—DHCPæœåŠ¡ç«¯åˆ†é…çš„IPåœ°å€ï¼Œåªèƒ½ä½¿ç”¨0.0.0.0 ç›®æ ‡IPåœ°å€ï¼ˆDestinationï¼‰ï¼š255.255.255.255ï¼Œå¹¿æ’­IPåœ°å€ï¼Œå¯¹åŒä¸€å¹¿æ’­åŸŸå†…çš„æ‰€æœ‰TCP/IPåè®®å®¢æˆ·ç«¯è¿›è¡Œå¹¿æ’­ 2.1.5 DHCP Discover ä¼ è¾“å±‚ ä¼ è¾“å±‚è¿™é‡Œå¯ä»¥çœ‹åˆ°æºç«¯å£ä¸º68ï¼Œç›®çš„ç«¯å£ä¸º67ï¼Œä¸”æ ¡éªŒçŠ¶æ€ä¸ºæœªæ ¡éªŒã€‚ 2.1.6 DHCP Discover åº”ç”¨å±‚ åº”ç”¨å±‚çš„æŠ¥æ–‡ä¹Ÿæœ‰å¾ˆå¤šé‡è¦æ•°æ®ï¼Œæˆ‘ä»¬æˆªå–é‡è¦çš„è¿›è¡Œåˆ†æã€‚ Bootp flagsï¼š0è¡¨ç¤ºå•æ’­ï¼Œ1è¡¨ç¤ºå¹¿æ’­ï¼Œè¿™é‡Œä¸º0ï¼Œå³DHCPæœåŠ¡ç«¯å›å¤çš„DHCP OfferæŠ¥æ–‡åº”ä¸ºå•æ’­å½¢å¼ éƒ¨åˆ†ä¹¦ä¸Šè®²è¿°çš„DHCPå››ä¸ªåŒ…éƒ½æ˜¯ä½¿ç”¨å¹¿æ’­çš„æ–¹å¼è¿›è¡Œï¼Œå®é™…ä¸ŠDHCP Offerå’ŒDHCP Ackè¿™ä¸¤ä¸ªæ•°æ®åŒ…æ˜¯å¹¿æ’­è¿˜æ˜¯å•æ’­æ˜¯ç”±DHCPçš„å®¢æˆ·ç«¯å‘é€çš„æ•°æ®åŒ…æ¥å†³å®šçš„ã€‚ Ciaddrå³å®¢æˆ·ç«¯IPåœ°å€ï¼ˆClient IP addressï¼‰ã€ Yiaddrå³è¢«åˆ†é…çš„DHCPå®¢æˆ·ç«¯IPåœ°å€ï¼ˆ Your(client) IP addressï¼‰ã€ Siaddrå³ä¸‹ä¸€ä¸ªä¸ºDHCPå®¢æˆ·ç«¯åˆ†é…IPåœ°å€çš„DHCPæœåŠ¡å™¨åœ°å€ï¼ˆNext server IP address ï¼‰ã€ Giaddrå³DHCPä¸­ç»§IPåœ°å€ï¼ˆRelay agent IP addressï¼‰ã€ è¿™å››ä¸ªIPåœ°å€å‡ä¸º0.0.0.0ï¼Œå› ä¸ºæ­¤æ—¶è¿˜å¤„äºDHCPçš„å‘ç°é˜¶æ®µï¼ŒDHCPå®¢æˆ·ç«¯å¯¹è¿™äº›ä¿¡æ¯è¿˜æ˜¯ä¸€æ— æ‰€çŸ¥ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°è¯·æ±‚ä¿¡æ¯é‡Œé¢éœ€è¦è¯·æ±‚è·å–åŒ…æ‹¬å­ç½‘æ©ç ï¼ˆSubnet Maskï¼‰ã€è·¯ç”±ç½‘å…³ï¼ˆRouterï¼‰ã€ DNSæœåŠ¡å™¨ï¼ˆDomain Name Serverï¼‰ ã€ä»¥åŠåŸŸåï¼ˆDomain Nameï¼‰ç­‰ä¿¡æ¯ 2.2 æä¾›é˜¶æ®µâ€”â€”DHCP Offerï¼ˆå•æ’­/å¹¿æ’­ï¼‰2.2.1 DHCP Offer ç†è®ºåˆ†ææä¾›é˜¶æ®µï¼Œå³DHCPæœåŠ¡å™¨å‘DHCPå®¢æˆ·ç«¯æä¾›é¢„åˆ†é…IPåœ°å€çš„é˜¶æ®µã€‚ç½‘ç»œä¸­çš„æ‰€æœ‰DHCPæœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„DHCP DiscoveræŠ¥æ–‡åéƒ½ä¼šæ ¹æ®è‡ªå·±çš„DHCPåœ°å€æ± ä¸­IPåœ°å€åˆ†é…çš„ä¼˜å…ˆæ¬¡åºé€‰å‡ºä¸€ä¸ªIPåœ°å€ï¼Œç„¶åä¸å…¶ä»–å‚æ•°ä¸€èµ·é€šè¿‡ä¼ è¾“å±‚çš„UDP67å·ç«¯å£åœ¨DHCP OfferæŠ¥æ–‡ä¸­ä»¥å•æ’­/å¹¿æ’­æ–¹å¼å‘é€ç»™å®¢æˆ·ç«¯çš„UDP68å·ç«¯å£ã€‚ DHCPæœåŠ¡å™¨åœ¨åˆ†é…è¿™ä¸ªåœ°å€ä¹‹é—´ä¼špingä¸€ä¸‹è¿™ä¸ªåˆ†é…çš„ipåœ°å€ï¼Œå¦‚æœæ²¡æœ‰Responseå°±æ‰ä¼šé¢„åˆ†é…è¿™ä¸ªåœ°å€ å®¢æˆ·ç«¯é€šè¿‡å°è£…åœ¨å¸§ä¸­çš„ç›®çš„MACåœ°å€ï¼ˆä¹Ÿå°±æ˜¯DHCP DiscoveræŠ¥æ–‡ä¸­çš„CHADDRå­—æ®µå€¼ï¼‰çš„æ¯”å¯¹æ¥ç¡®å®šæ˜¯å¦æ¥æ”¶è¯¥å¸§ã€‚ä½†è¿™æ ·ä»¥æ¥ï¼Œç†è®ºä¸ŠDHCPå®¢æˆ·ç«¯å¯èƒ½ä¼šæ”¶åˆ°å¤šä¸ªDHCP OfferæŠ¥æ–‡ï¼ˆå½“ç½‘ç»œä¸­å­˜åœ¨å¤šä¸ªDHCPæœåŠ¡å™¨æ—¶ï¼‰ï¼Œä½†DHCPå®¢æˆ·ç«¯åªæ¥æ”¶ç¬¬ä¸€ä¸ªåˆ°æ¥çš„DHCP OfferæŠ¥æ–‡ã€‚ 2.2.2 DHCP Offer æ•°æ®é“¾è·¯å±‚ è¿™æ—¶å¯ä»¥çœ‹åˆ°æ ¹æ®ä¹‹å‰çš„DHCPæŠ¥æ–‡ï¼Œè¿™é‡Œä½¿ç”¨äº†å•æ’­çš„å½¢å¼ã€‚è€ŒæºMACåœ°å€å°±æ˜¯DHCPæœåŠ¡å™¨çš„MACåœ°å€ä¸”ç›®çš„MACåœ°å€æ˜¯ä¹‹å‰å‘é€DHCP DiscoveræŠ¥æ–‡çš„å®¢æˆ·ç«¯MACåœ°å€ã€‚ 2.2.3 DHCP Offer ç½‘ç»œå±‚ ç½‘ç»œå±‚æŠ¥æ–‡ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ—¶å€™ç›®çš„IPåœ°å€å’ŒæºIPåœ°å€éƒ½å·²ç»æœ‰äº†æ•°æ®ï¼Œ10.22.25.118å°±æ˜¯å³å°†è¦åˆ†é…çš„IPåœ°å€ï¼Œè€Œ10.22.25.254å°±æ˜¯DHCPæœåŠ¡å™¨çš„åœ°å€åˆæˆ–è€…æ˜¯DHCPä¸­ç»§ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼Œå…·ä½“è¦çœ‹åº”ç”¨å±‚çš„æŠ¥æ–‡ã€‚ é€šè¿‡DHCPä¸­ç»§ä»£ç†æœåŠ¡ï¼Œä¸DHCPæœåŠ¡å™¨ä¸åœ¨åŒä¸€å­ç½‘çš„DHCPå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡DHCPä¸­ç»§ä»£ç†ï¼ˆé€šå¸¸æ˜¯è·¯ç”±å™¨æˆ–ä¸‰å±‚äº¤æ¢æœºè®¾å¤‡å¼€å¯DHCPä¸­ç»§åŠŸèƒ½ï¼‰ä¸ä½äºå…¶ä»–ç½‘æ®µçš„DHCPæœåŠ¡å™¨é€šä¿¡ï¼Œæœ€ç»ˆæ˜¯DHCPå®¢æˆ·ç«¯è·å–åˆ°ä»DHCPæœåŠ¡å™¨ä¸Šåˆ†é…è€Œæ¥çš„IPåœ°å€ã€‚ æ­¤æ—¶çš„DHCPä¸­ç»§ä»£ç†å°±ä½äºDHCPå®¢æˆ·ç«¯å’ŒDHCPæœåŠ¡å™¨ä¹‹é—´ï¼Œè´Ÿè´£å¹¿æ’­DHCPæŠ¥æ–‡çš„è½¬å‘ã€‚ 2.2.4 DHCP Offer åº”ç”¨å±‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†çœ‹åº”ç”¨å±‚çš„æŠ¥æ–‡ï¼š Ciaddrå³å®¢æˆ·ç«¯IPåœ°å€ï¼ˆClient IP addressï¼‰ï¼šæ­¤æ—¶è¿˜æ²¡æœ‰åˆ†é…ï¼Œæ‰€ä»¥è¿˜æ˜¯0.0.0.0 Yiaddrå³è¢«åˆ†é…çš„DHCPå®¢æˆ·ç«¯IPåœ°å€ï¼ˆ Your(client) IP addressï¼‰ï¼š10.22.25.118ï¼Œè¿™ä¸ªIPå³å°†åˆ†é…ç»™è¯¥å®¢æˆ·ç«¯ Siaddrå³ä¸‹ä¸€ä¸ªä¸ºDHCPå®¢æˆ·ç«¯åˆ†é…IPåœ°å€çš„DHCPæœåŠ¡å™¨åœ°å€ï¼ˆNext server IP address ï¼‰ï¼š192.168.112.240ï¼Œè¿™ä¸ªæ˜¯åˆ†é…IPåœ°å€çš„DHCPæœåŠ¡å™¨ Giaddrå³DHCPä¸­ç»§IPåœ°å€ï¼ˆRelay agent IP addressï¼‰ï¼š10.22.25.254ï¼Œè¿™ä¸ªæ˜¯DHCPçš„ä¸­ç»§ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼Œåœ¨è¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªå¼€å¯äº†DHCPä¸­ç»§çš„ä¸‰å±‚äº¤æ¢æœº å­ç½‘æ©ç ï¼ˆSubnet Maskï¼‰ã€è·¯ç”±ç½‘å…³ï¼ˆRouterï¼‰ã€ DNSæœåŠ¡å™¨ï¼ˆDomain Name Serverï¼‰ ã€ä»¥åŠåŸŸåï¼ˆDomain Nameï¼‰ç­‰ä¿¡æ¯å‡å·²ç»åŒ…å«åœ¨é‡Œé¢ ç§Ÿçº¦æ—¶é—´æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°DHCPç§Ÿçº¦æ—¶é—´ï¼ˆIP Address Lease Timeï¼‰å®é™…ä¸Šæ˜¯8å¤©ï¼Œå•ä½æ˜¯sï¼Œwiesharkæ¢ç®—æˆäº†å¤©æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹ è€ŒRenewal Time Valueå°±æ˜¯åˆæ¬¡ç»­çº¦çš„æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ç§Ÿçº¦æ—¶é—´çš„1/2ï¼Œè¿™é‡Œå°±æ˜¯4å¤©ï¼Œè¿™ä¸ªæ—¶å€™ä¸€èˆ¬å®¢æˆ·ç«¯ä¼šä»¥å•æ’­çš„æ–¹å¼å‘DHCPæœåŠ¡å™¨å‘é€æŠ¥æ–‡è¯·æ±‚ç»­çº¦ è€ŒRebinding Time Valueå°±æ˜¯ç¬¬äºŒæ¬¡ç»­çº¦æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ç§Ÿçº¦æ—¶é—´çš„7/8ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯7å¤©ï¼Œåªæœ‰åœ¨åˆæ¬¡ç»­çº¦å¤±è´¥ä¹‹åï¼Œæ‰ä¼šåœ¨è¿™ä¸ªæ—¶é—´ä»¥å¹¿æ’­çš„æ–¹å¼å‘ç½‘ç»œä¸­çš„DHCPæœåŠ¡å™¨å†æ¬¡ç”³è¯·IPåœ°å€ 2.3 é€‰æ‹©é˜¶æ®µâ€”â€”DHCP Requestï¼ˆå¹¿æ’­ï¼‰2.3.1 DHCP Request ç†è®ºåˆ†æé€‰æ‹©é˜¶æ®µï¼Œå³DHCPå®¢æˆ·ç«¯é€‰æ‹©IPåœ°å€çš„é˜¶æ®µã€‚ å¦‚æœæœ‰å¤šå°DHCPæœåŠ¡å™¨å‘è¯¥å®¢æˆ·ç«¯å‘æ¥DHCPOFFERæŠ¥æ–‡ï¼Œå®¢æˆ·ç«¯åªæ¥æ”¶ç¬¬ä¸€ä¸ªæ”¶åˆ°çš„DHCP OfferæŠ¥æ–‡ï¼Œç„¶åä»¥å¹¿æ’­æ–¹å¼å‘é€DHCP RequestæŠ¥æ–‡ã€‚åœ¨è¯¥æŠ¥æ–‡çš„Requested Addressé€‰é¡¹ä¸­åŒ…å«DHCPæœåŠ¡å™¨åœ¨DHCP OfferæŠ¥æ–‡ä¸­é¢„åˆ†é…çš„IPåœ°å€ã€å¯¹åº”çš„DHCPæœåŠ¡å™¨IPåœ°å€ç­‰ã€‚ è¿™æ ·ä¹Ÿå°±ç›¸å½“äºåŒæ—¶å‘Šè¯‰å…¶ä»–DHCPæœåŠ¡å™¨ï¼Œå®ƒä»¬å¯ä»¥é‡Šæ”¾å·²æä¾›çš„åœ°å€å¹¶å°†è¿™äº›åœ°å€è¿”å›åˆ°å¯ç”¨çš„åœ°å€æ± ä¸­ã€‚ åœ¨DHCP REQUESTæŠ¥æ–‡å°è£…çš„IPåè®®å¤´éƒ¨ä¸­ï¼Œå®¢æˆ·ç«¯çš„Source Addressä»ç„¶æ˜¯0.0.0.0ï¼Œæ•°æ®åŒ…çš„Destinationä»ç„¶æ˜¯255.255.255.255ã€‚ä½†åœ¨DHCP RequestæŠ¥æ–‡ä¸­Ciaddrã€Yiaddrã€Siaddrã€Giaddr å­—æ®µçš„åœ°å€å‡ä¸º0.0.0.0 2.3.2 DHCP Request æ•°æ®é“¾è·¯å±‚ è¿™æ—¶å€™åˆå˜å›äº†å¹¿æ’­ã€‚ 2.3.3 DHCP Request ç½‘ç»œå±‚ ç”±äºæ˜¯å¹¿æ’­ï¼Œæ‰€ä»¥ç›®æ ‡IPåœ°å€æ˜¯255.255.255.255ï¼Œè€ŒæºIPåœ°å€è¿˜æ˜¯0.0.0.0æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å®Œæˆæ•´ä¸ªDHCPè¿‡ç¨‹ï¼Œæœ¬æœºå°šæœªè·å–åˆ°IPåœ°å€ã€‚ 2.3.4 DHCP Request åº”ç”¨å±‚ Bootp flagsï¼š0è¡¨ç¤ºå•æ’­ï¼Œ1è¡¨ç¤ºå¹¿æ’­ï¼Œè¿™é‡Œä¸º0ï¼Œå³DHCPæœåŠ¡ç«¯å›å¤çš„æŠ¥æ–‡åº”ä¸ºå•æ’­å½¢å¼ Ciaddrã€Yiaddrã€Siaddrã€Giaddr å­—æ®µçš„åœ°å€å‡ä¸º0.0.0.0 2.4 ç¡®è®¤é˜¶æ®µâ€”â€”DHCP Ackï¼ˆå•æ’­/å¹¿æ’­ï¼‰2.4.1 DHCP Ack ç†è®ºåˆ†æç¡®è®¤é˜¶æ®µï¼Œå³DHCPæœåŠ¡å™¨ç¡®è®¤åˆ†é…çº§DHCPå®¢æˆ·ç«¯IPåœ°å€çš„é˜¶æ®µã€‚ æŸä¸ªDHCPæœåŠ¡å™¨åœ¨æ”¶åˆ°DHCPå®¢æˆ·ç«¯å‘æ¥çš„DHCP REOUESTæŠ¥æ–‡åï¼Œåªæœ‰DHCPå®¢æˆ·ç«¯é€‰æ‹©çš„æœåŠ¡å™¨ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼šå¦‚æœç¡®è®¤å°†åœ°å€åˆ†é…ç»™è¯¥å®¢æˆ·ç«¯ï¼Œåˆ™ä»¥å•æ’­/å¹¿æ’­æ–¹å¼è¿”å›DHCP ACKæŠ¥æ–‡ï¼›å¦åˆ™è¿”å›DHCP NAKæŠ¥æ–‡ï¼Œè¡¨æ˜åœ°å€ä¸èƒ½åˆ†é…ç»™è¯¥å®¢æˆ·ç«¯ã€‚ 2.4.2 DHCP Ack æ•°æ®é“¾è·¯å±‚ å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯å•æ’­ï¼ŒæºMACåœ°å€æ˜¯DHCPæœåŠ¡å™¨ï¼ˆæ­¤å¤„ä¸ºä¸­ç»§ä»£ç†ï¼‰çš„MACåœ°å€ï¼Œç›®æ ‡MACåœ°å€æ˜¯DHCPå®¢æˆ·ç«¯çš„MACåœ°å€ã€‚ 2.4.3 DHCP Ack ç½‘ç»œå±‚ 10.22.25.118å°±æ˜¯å³å°†è¦åˆ†é…çš„IPåœ°å€ï¼Œè€Œ10.22.25.254å°±æ˜¯DHCPæœåŠ¡å™¨çš„åœ°å€ï¼ˆæ­¤å¤„ä¸ºDHCPä¸­ç»§ä»£ç†æœåŠ¡å™¨ï¼‰ 2.4.4 DHCP Ack åº”ç”¨å±‚ åœ¨DHCPACKæŠ¥æ–‡ä¸­Yiaddrå­—æ®µåŒ…å«è¦åˆ†é…ç»™å®¢æˆ·ç«¯çš„IPåœ°å€ï¼Œè€ŒChaddrå’ŒDHCP:Client Identifierå­—æ®µæ˜¯å‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯ä¸­ç½‘å¡çš„MACåœ°å€ã€‚ åŒæ—¶ï¼Œåœ¨é€‰é¡¹éƒ¨åˆ†ä¹Ÿä¼šæŠŠåœ¨DHCPOFFERæŠ¥æ–‡ä¸­æ‰€åˆ†é…çš„IPåœ°å€çš„å­ç½‘æ©ç ã€é»˜è®¤ç½‘å…³ã€DNSæœåŠ¡å™¨ã€ç§Ÿçº¦æœŸã€ç»­çº¦æ—¶é—´ç­‰ä¿¡æ¯åŠ ä¸Šã€‚ 3ã€DHCPçš„IPåœ°å€ç§Ÿçº¦æ›´æ–°3.1 DHCPæœåŠ¡IPåœ°å€ç§Ÿçº¦æ›´æ–°åŸç†å¦‚æœé‡‡ç”¨åŠ¨æ€IPåœ°å€åˆ†é…ç­–ç•¥ï¼Œåˆ™DHCPæœåŠ¡å™¨åˆ†é…ç»™å®¢æˆ·ç«¯çš„IPåœ°å€éƒ½æ˜¯æœ‰ä¸€å®šç§Ÿçº¦æœŸé™çš„ï¼Œå½“ç§Ÿçº¦æœŸæ»¡åDHCPæœåŠ¡å™¨åˆä¼šæ”¶å›åŸæ¥åˆ†é…çš„è¿™ä¸ªIPåœ°å€ã€‚ å¦‚æœDHCPå®¢æˆ·ç«¯å¸Œæœ›ç»§ç»­ä½¿ç”¨è¯¥åœ°å€ï¼Œåˆ™éœ€è¦å‘DHCPæœåŠ¡å™¨æå‡ºæ›´æ–°IPåœ°å€ç§Ÿçº¦çš„ç”³è¯·ï¼Œä¹Ÿå°±æ˜¯å‰é¢æ‰€è¯´åˆ°çš„â€œç»­çº¦â€ã€‚ IPåœ°å€ç§Ÿçº¦æ›´æ–°æˆ–è€…IPåœ°å€ç»­çº¦ä¹Ÿå°±æ˜¯æ›´æ–°æœåŠ¡å™¨ç«¯å¯¹IPåœ°å€çš„ç§Ÿçº¦ä¿¡æ¯ï¼Œä½¿å…¶æ¢å¤ä¸ºåˆå§‹çŠ¶æ€ã€‚ 3.2 ç”³è¯·ç»­çº¦çš„æ–¹æ³• åœ¨DHCPå®¢æˆ·ç«¯çš„IPåœ°å€ç§Ÿçº¦æœŸé™è¾¾åˆ°1/2æ—¶ï¼Œç”±DHCPå®¢æˆ·ç«¯å‘ä¸ºå®ƒåˆ†é…IPåœ°å€çš„DHCPæœåŠ¡å™¨ä»¥å•æ’­æ–¹å¼å‘é€DHCP REOUESTè¯·æ±‚æŠ¥æ–‡ï¼Œä»¥æœŸè¿›è¡ŒIPç§Ÿçº¦çš„æ›´æ–°ã€‚ å¦‚æœDHCPæœåŠ¡å™¨åŒæ„ç»­çº¦ï¼Œåˆ™DHCPæœåŠ¡å™¨å‘å®¢æˆ·ç«¯ä»¥å•æ’­æ–¹å¼è¿”å›DHCP ACKæŠ¥æ–‡ï¼Œé€šçŸ¥DHCPå®¢æˆ·ç«¯å·²ç»è·å¾—æ–°IPç§Ÿçº¦ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨æ­¤IPåœ°å€ï¼›ç›¸åï¼Œå¦‚æœDHCPæœåŠ¡å™¨ä¸åŒæ„ç»­çº¦ï¼Œåˆ™DHCPæœåŠ¡å™¨ä»¥å•æ’­æ–¹å¼è¿”å›DHCP NAKæŠ¥æ–‡ï¼Œé€šçŸ¥DHCPå®¢æˆ·ç«¯ä¸èƒ½è·å¾—æ–°çš„ç§Ÿçº¦ï¼Œæ­¤IPåœ°å€ä¸å¯ä»¥å†åˆ†é…ç»™è¯¥å®¢æˆ·ç«¯ã€‚ å¦‚æœä¸Šé¢çš„ç»­çº¦ç”³è¯·å¤±è´¥ï¼Œåˆ™DHCPå®¢æˆ·ç«¯è¿˜ä¼šåœ¨ç§Ÿçº¦æœŸé™è¾¾åˆ°7/8æ—¶å†æ¬¡ä»¥å¹¿æ’­æ–¹å¼å‘é€DHCP REQUESTè¯·æ±‚æŠ¥æ–‡è¿›è¡Œç»­çº¦ã€‚DHCPæœåŠ¡å™¨çš„å¤„ç†æ–¹å¼åŒä¸Šï¼Œä¸å†èµ˜è¿°ã€‚ å¦‚æœç¬¬äºŒæ¬¡ç»­çº¦è¯·æ±‚è¿˜æ˜¯å¤±è´¥ï¼Œåˆ™åŸæ¥ç§Ÿçº¦çš„IPåœ°å€å°†è¢«é‡Šæ”¾ã€‚ 4ã€DHCPä¸­ç»§ä»£ç†æœåŠ¡åœ¨å‰é¢æˆ‘ä»¬å·²ç»è¯´è¿‡ï¼Œåœ¨DHCPå®¢æˆ·ç«¯åˆæ¬¡ä»DHCPæœåŠ¡å™¨è·å–IPåœ°å€çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ä»DHCPå®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚æŠ¥æ–‡å‡æ˜¯ä»¥å¹¿æ’­æ–¹å¼ï¼ˆç›®çš„åœ°å€ä¸º255.255.255.255ï¼‰è¿›è¡Œå‘é€çš„ï¼Œæ‰€ä»¥DHCPæœåŠ¡åªé€‚ç”¨äºDHCPå®¢æˆ·ç«¯å’ŒDHCPæœåŠ¡å™¨å¤„äºåŒä¸€ä¸ªå­ç½‘ï¼ˆä¹Ÿå°±æ˜¯DHCPæœåŠ¡å™¨è‡³å°‘æœ‰ä¸€ä¸ªç«¯å£ä¸DHCPå®¢æˆ·ç«¯æ‰€åœ¨çš„å­ç½‘æ˜¯ç›´æ¥è¿æ¥çš„ï¼‰çš„æƒ…å†µï¼Œå› ä¸ºå¹¿æ’­åŒ…æ˜¯ä¸èƒ½ç©¿è¶Šå­ç½‘çš„ã€‚ åŸºäºDHCPæœåŠ¡çš„ä»¥ä¸Šé™åˆ¶ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¦‚æœDHCPå®¢æˆ·ç«¯ä¸DHCPæœåŠ¡å™¨ä¹‹é—´éš”äº†è·¯ç”±å™¨è®¾å¤‡ï¼Œä¸åœ¨åŒä¸€å­ç½‘ï¼Œå°±ä¸èƒ½ç›´æ¥é€šè¿‡è¿™å°DHCPæœåŠ¡å™¨è·å–IPåœ°å€ï¼Œå³ä½¿DHCPæœåŠ¡å™¨ä¸Šå·²é…ç½®äº†å¯¹åº”çš„åœ°å€æ± ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå¦‚æœæƒ³è¦è®©å¤šä¸ªå­ç½‘ä¸­çš„ä¸»æœºè¿›è¡ŒåŠ¨æ€IPåœ°å€åˆ†é…ï¼Œå°±éœ€è¦åœ¨ç½‘ç»œä¸­çš„æ‰€æœ‰å­ç½‘ä¸­éƒ½è®¾ç½®ä¸€ä¸ªDHCPæœåŠ¡å™¨ã€‚è¿™æ˜¾ç„¶æ˜¯å¾ˆä¸ç»æµçš„ï¼Œä¹Ÿæ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚ DHCPä¸­ç»§åŠŸèƒ½å¯ä»¥å¾ˆå¥½åœ°è§£å†³DHCPæœåŠ¡çš„ä»¥ä¸Šéš¾é¢˜ã€‚é€šè¿‡DHCPä¸­ç»§ä»£ç†æœåŠ¡ï¼Œä¸DHCPæœåŠ¡å™¨ä¸åœ¨åŒä¸€å­ç½‘çš„DHCPå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡DHCPä¸­ç»§ä»£ç†ï¼ˆé€šå¸¸ä¹Ÿæ˜¯ç”±è·¯ç”±å™¨æˆ–ä¸‰å±‚äº¤æ¢æœºè®¾å¤‡æ‹…å½“ï¼Œä½†éœ€è¦å¼€å¯DHCPä¸­ç»§åŠŸèƒ½ï¼‰ä¸ä½äºå…¶ä»–ç½‘æ®µçš„DHCPæœåŠ¡å™¨é€šä¿¡ï¼Œæœ€ç»ˆä½¿DHCPå®¢æˆ·ç«¯è·å–åˆ°ä»DHCPæœåŠ¡å™¨ä¸Šåˆ†é…è€Œæ¥çš„IPåœ°å€ã€‚æ­¤æ—¶çš„DHCPä¸­ç»§ä»£ç†å°±ä½äºDHCPå®¢æˆ·ç«¯å’ŒDHCPæœåŠ¡å™¨ä¹‹é—´ï¼Œè´Ÿè´£å¹¿æ’­DHCPæŠ¥æ–‡çš„è½¬å‘ã€‚ ä»å‰é¢çš„æŠ¥æ–‡åˆ†ææˆ‘ä»¬å¯ä»¥è½»æ¾çš„çœ‹å‡º10.22.25.118å’Œ192.168.112.240æ˜¯æ˜æ˜¾ä¸å±äºåŒä¸€ä¸ªå­ç½‘çš„ï¼Œä»–ä»¬ä¹‹é—´é€šä¿¡è‚¯å®šéœ€è¦ä½¿ç”¨è·¯ç”±å™¨è¿›è¡Œè·¯ç”±ï¼Œè€Œ10.22.25.254å°±æ˜¯æ‹…ä»»ç€DHCPä¸­ç»§ä»£ç†çš„è§’è‰²ã€‚ è‡³äºå’ŒDHCPæœåŠ¡å™¨ä¹‹é—´ç»è¿‡äº†å¤šå°‘ä¸ªè·¯ç”±ï¼Œæˆ‘ä»¬å¯ä»¥tracertä¸€ä¸‹ã€‚ ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»10.22.25.254è¿™ä¸ªDHCPä¸­ç»§ä»£ç†åˆ°DHCPæœåŠ¡å™¨ä¹‹é—´éœ€è¦ç»è¿‡5ä¸ªè·¯ç”±èŠ‚ç‚¹ã€‚ è€Œå®é™…ä¸Šï¼Œåœ¨å¾ˆå¤šçš„å¤§å‹å›­åŒºç½‘ç»œä¸­ï¼Œéƒ½ä¼šä½¿ç”¨ä¸€ä¸ªDHCPæœåŠ¡å™¨é›†ç¾¤+å¤šä¸ªDHCPä¸­ç»§ä»£ç†è¿™æ ·çš„æ–¹å¼è¿›è¡ŒDHCPåˆ†é…ã€‚ 5ã€è·¯ç”±å¹²æ‰°5.1 è·¯ç”±å¹²æ‰°åŸç†è·¯ç”±å¹²æ‰°æ˜¯å›­åŒºç½‘ç»œä¸­ç»å¸¸å‡ºç°çš„é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨ç”¨æˆ·æ— æ³•è·å–åˆ°æ­£ç¡®çš„IPåœ°å€/ç½‘å…³åœ°å€/DNSæœåŠ¡å™¨åœ°å€ç­‰ä¿¡æ¯è€Œæ— æ³•ä¸Šç½‘ã€‚ ä¸»è¦åŸå› åˆ™æ˜¯å› ä¸ºå…¶ä»–ç”¨æˆ·ç§æ¥è·¯ç”±å™¨ä¸”é…ç½®ä¸å½“ï¼Œå¯¼è‡´ç§æ¥çš„è·¯ç”±å™¨æˆä¸ºæ‰€åœ¨çš„å±€åŸŸç½‘ä¸­çš„ç¬¬äºŒä¸ªDHCPæœåŠ¡å™¨ï¼Œè¿™æ—¶å…¶ä»–ç”¨æˆ·ä½¿ç”¨DHCPè·å–IPåœ°å€çš„æ—¶å€™å°±ä¼šæœ‰ä¸åªä¸€ä¸ªDHCPæœåŠ¡å™¨æä¾›IPåœ°å€ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç§æ¥çš„è·¯ç”±å™¨è™½ç„¶èƒ½æ­£ç¡®æä¾›DHCPæœåŠ¡å’ŒIPåœ°å€ç­‰ä¿¡æ¯ï¼Œå´å¾€å¾€æ— æ³•æä¾›ä¸Šç½‘åŠŸèƒ½ï¼Œè¿™å°±ä¼šé€ æˆæ‰€è°“çš„è·¯ç”±å¹²æ‰°ã€‚ ä»ä¸Šé¢çš„è§£é‡Šæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè·¯ç”±å¹²æ‰°åªå¯èƒ½å‘ç”Ÿåœ¨ä½¿ç”¨DHCPåè®®çš„å®¢æˆ·ç«¯ï¼Œå¦‚æœæ˜¯ä½¿ç”¨é™æ€IPåœ°å€ï¼Œæ˜¯å¯ä»¥é¿å…è·¯ç”±å¹²æ‰°çš„ã€‚ å› ä¸ºè¿™æ—¶å€™å½“å®¢æˆ·ç«¯æ¥å…¥ç½‘ç»œä¹‹åï¼Œä¼šç›´æ¥å‘é€ARPè¯·æ±‚æ¥æŸ¥è¯¢è®¾ç½®çš„ç½‘å…³IPåœ°å€çš„MACåœ°å€ä¿¡æ¯ï¼Œè€Œæ ¹æœ¬ä¸ä¼šå»å‘é€DHCP DiscoveræŠ¥æ–‡ã€‚ ä½†æ˜¯ï¼Œå¤§å‹ç½‘ç»œä¸­ä½¿ç”¨é™æ€ç½‘ç»œåœ°å€å¾€å¾€å®¹æ˜“äº§ç”Ÿç®¡ç†æ··ä¹±ï¼ŒIPåœ°å€å†²çªç­‰é—®é¢˜ã€‚ 5.2 è·¯ç”±å¹²æ‰°æ¨¡æ‹Ÿä¸‹é¢æˆ‘ä»¬åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…æ¥å…¥ä¸¤ä¸ªDHCPæœåŠ¡å™¨ï¼Œè¿›è¡Œè·¯ç”±å¹²æ‰°çš„æ¨¡æ‹Ÿã€‚ ä»æœ¬æ–‡å‰é¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œç”±äºDHCP Discoveræ˜¯ä»¥å¹¿æ’­çš„æ–¹å¼è¿›è¡Œå‘é€ï¼Œå› æ­¤å±€åŸŸç½‘å†…çš„æ‰€æœ‰DHCPæœåŠ¡å™¨éƒ½ä¼šè¿›è¡Œå›åº”ï¼Œè€Œå®¢æˆ·ç«¯åªä¼šé€‰æ‹©æœ€å¿«å›åº”çš„é‚£ä¸€ä¸ªDHCPæœåŠ¡å™¨ï¼Œå…¶ä»–çš„DHCPæœåŠ¡å™¨åˆ™ä¼šè¢«æ‹’ç»ï¼Œå¦‚æœæ­¤æ—¶æˆ‘ä»¬çš„å±€åŸŸç½‘ä¸­å‡ºç°äº†ä¸€ä¸ªèƒ½æä¾›DHCPæœåŠ¡è€Œä¸èƒ½æä¾›ä¸Šç½‘æœåŠ¡çš„è®¾å¤‡ï¼Œå°±ä¼šå¯¹å…¶äº§ç”Ÿè·¯ç”±å¹²æ‰°ã€‚ 5.2.1 æ¨¡æ‹Ÿ1 ç¬¬ä¸€æ¬¡æ¨¡æ‹Ÿä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®¢æˆ·ç«¯å‘é€äº†DHCP DiscoveræŠ¥æ–‡ä¹‹åï¼Œ10.22.25.254å’Œ192.168.100.1ä¸¤ä¸ªDHCPæœåŠ¡å™¨éƒ½è¿›è¡Œäº†å›åº”ï¼Œä¸åŒçš„æ˜¯è¿™æ—¶10.22.25.254çš„å›åº”æ˜¾ç„¶è¦å¿«å¾—å¤šï¼Œå› æ­¤å®¢æˆ·ç«¯é€‰æ‹©äº†10.22.25.254è¿™ä¸ªDHCPæœåŠ¡å™¨è€Œ192.168.100.1è¿™ä¸ªDHCPæœåŠ¡å™¨åˆ™æ˜¯å‘é€äº†DHCP NAKæŠ¥æ–‡æ¥è¡¨ç¤ºDHCPå¤±è´¥ã€‚ 5.2.2 æ¨¡æ‹Ÿ2è¿™æ¬¡æˆ‘ä»¬è°ƒæ•´192.168.100.1è¿™ä¸ªè·¯ç”±å™¨å¯¹äºDHCPæŠ¥æ–‡çš„æŸ¥è¯¢é¢‘ç‡ï¼ˆåŠ å¿«ï¼‰ï¼Œå†æ¬¡è¿›è¡Œæ¨¡æ‹Ÿã€‚ è¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯192.168.100.1è¿™ä¸ªDHCPæœåŠ¡å™¨å…ˆå»ºç«‹äº†è¿æ¥ã€‚ 5.2.3 å®ä¾‹åˆ†æ ä»ä¸Šå›¾çš„IPv4åœ°å€å’Œå¯¹åº”çš„å­ç½‘æ©ç ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºå¯¹åº”çš„é»˜è®¤ç½‘å…³åº”è¯¥æ˜¯10.27.26.254ï¼Œè€Œè¿™é‡Œåˆ™æ˜¯æ˜¾ç¤º10.27.26.59ï¼Œæ˜¾ç„¶æ˜¯é”™è¯¯çš„ï¼Œå¾ˆå¯èƒ½å°±æ˜¯å—åˆ°äº†è·¯ç”±å¹²æ‰°ã€‚ è¿™ç§IPåœ°å€åœ¨æ¥äº†è·¯ç”±å™¨çš„æƒ…å†µä¸‹æ˜¯å¾ˆå¸¸è§çš„ï¼Œä½†æ˜¯å¦‚æœæ˜¯æ¥å…¥çš„åˆ†é…10å¼€å¤´çš„IPåœ°å€çš„ç½‘ç»œä¸­å‡ºç°è¿™ç§IPåœ°å€ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å—åˆ°äº†è·¯ç”±å¹²æ‰°ã€‚ 5.2.4 å®šä½å¹²æ‰°æºå®šä½å¹²æ‰°æºæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æŸ¥è¯¢arpç¼“å­˜è¡¨ã€‚ 12# åœ¨cmdä¸­è¾“å…¥ä¸‹åˆ—å‘½ä»¤æŸ¥è¯¢arpç¼“å­˜arp -a å†æ ¹æ®IPä¿¡æ¯ä¸­çš„é»˜è®¤ç½‘å…³ï¼ˆæˆ–è€…æ˜¯DHCPæœåŠ¡å™¨ç­‰å…¶ä»–å¼‚å¸¸ä¿¡æ¯ï¼‰å¯¹åº”çš„IPåœ°å€æ‰¾åˆ°å¹²æ‰°æºçš„MACåœ°å€ï¼Œåœ¨äº¤æ¢æœºåå°æŸ¥è¯¢è¯¥MACåœ°å€å¯¹åº”çš„äº¤æ¢æœºç«¯å£ï¼ˆå¾€å¾€éœ€è¦ç½‘ç»œç®¡ç†å‘˜ååŠ©ï¼‰ï¼Œå³å¯å®šä½å¹²æ‰°æºã€‚ 5.3 è·¯ç”±å¹²æ‰°è§£å†³æ–¹æ¡ˆ5.3.1 ç”¨æˆ·åˆç†é…ç½®è·¯ç”±å™¨ å°†å¢™ä¸Šç«¯å£æ¥å‡ºæ¥çš„ç½‘çº¿æ’åˆ°ç”¨æˆ·è‡ªå·±çš„è·¯ç”±å™¨çš„wanå£ä¸Šï¼Œè¿™æ—¶å€™ç›¸å½“äºåœ¨è¯¥ç½‘ç»œä¸­ä¸‹æ¥äº†ä¸€å±‚ç½‘ç»œï¼Œå³åˆå»ºç«‹äº†ä¸€ä¸ªå°å‹çš„å±€åŸŸç½‘ï¼› å…³é—­è·¯ç”±å™¨çš„DHCPåŠŸèƒ½ï¼Œå°†ç½‘çº¿æ’åˆ°è·¯ç”±å™¨çš„lanå£ä¸Šï¼Œæ­¤æ—¶è·¯ç”±å™¨ç›¸å½“äºä¸€ä¸ªå‚»ç“œäº¤æ¢æœºï¼Œåªèƒ½èµ·åˆ°å¢åŠ ç½‘ç»œæ¥å£å’Œæä¾›æ— çº¿æ¥å…¥ï¼ˆå¦‚æœè·¯ç”±å™¨æœ‰æ— çº¿åŠŸèƒ½çš„è¯ï¼‰çš„ä½œç”¨ï¼› è¿™ç§æ–¹æ³•çš„å¼Šç«¯æ˜¯å¾ˆå¤šç”¨æˆ·å¹¶ä¸çŸ¥é“å¦‚ä½•åˆç†çš„é…ç½®è·¯ç”±å™¨ï¼Œå› æ­¤å¯è¡Œæ€§ä¸å¤§ã€‚ 5.3.2 DHCP SnoopingDHCP SnoopingæŠ€æœ¯æ˜¯DHCPå®‰å…¨ç‰¹æ€§ï¼Œé€šè¿‡å»ºç«‹å’Œç»´æŠ¤DHCP Snoopingç»‘å®šè¡¨è¿‡æ»¤ä¸å¯ä¿¡ä»»çš„DHCPä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯æŒ‡æ¥è‡ªä¸ä¿¡ä»»åŒºåŸŸçš„DHCPä¿¡æ¯ã€‚DHCP Snoopingç»‘å®šè¡¨åŒ…å«ä¸ä¿¡ä»»åŒºåŸŸçš„ç”¨æˆ·MACåœ°å€ã€IPåœ°å€ã€ç§Ÿç”¨æœŸã€VLAN-ID æ¥å£ç­‰ä¿¡æ¯ã€‚ å½“äº¤æ¢æœºå¼€å¯äº† DHCP-Snoopingåï¼Œä¼šå¯¹DHCPæŠ¥æ–‡è¿›è¡Œä¾¦å¬ï¼Œå¹¶å¯ä»¥ä»æ¥æ”¶åˆ°çš„DHCP Requestæˆ–DHCP AckæŠ¥æ–‡ä¸­æå–å¹¶è®°å½•IPåœ°å€å’ŒMACåœ°å€ä¿¡æ¯ã€‚å¦å¤–ï¼ŒDHCP-Snoopingå…è®¸å°†æŸä¸ªç‰©ç†ç«¯å£è®¾ç½®ä¸ºä¿¡ä»»ç«¯å£æˆ–ä¸ä¿¡ä»»ç«¯å£ã€‚ä¿¡ä»»ç«¯å£å¯ä»¥æ­£å¸¸æ¥æ”¶å¹¶è½¬å‘DHCP OfferæŠ¥æ–‡ï¼Œè€Œä¸ä¿¡ä»»ç«¯å£ä¼šå°†æ¥æ”¶åˆ°çš„DHCP OfferæŠ¥æ–‡ä¸¢å¼ƒã€‚è¿™æ ·ï¼Œå¯ä»¥å®Œæˆäº¤æ¢æœºå¯¹å‡å†’DHCP Serverçš„å±è”½ä½œç”¨ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä»åˆæ³•çš„DHCP Serverè·å–IPåœ°å€ã€‚ DHCP Snoopingå¯ä»¥éå¸¸æœ‰æ•ˆåœ°é˜²æ­¢å›­åŒºç½‘ä¸­çš„è·¯ç”±å¹²æ‰°ç°è±¡å‘ç”Ÿï¼Œä½†æ˜¯éœ€è¦ç½‘ç»œç®¡ç†å‘˜å¯¹æ¯å°è·¯ç”±ç½‘å…³è¿›è¡Œé…ç½®ï¼Œè€ƒè™‘åˆ°å¤§å‹ç½‘ç»œä¸­å¯èƒ½ä¼šä½¿ç”¨å¤šç§å“ç‰Œå’Œå‹å·çš„äº¤æ¢æœºï¼Œè¿™æ ·å­çš„å·¥ä½œé‡ä¼šæ¯”è¾ƒå¤§ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"},{"name":"wireshark","slug":"wireshark","permalink":"https://tinychen.com/tags/wireshark/"},{"name":"dhcp","slug":"dhcp","permalink":"https://tinychen.com/tags/dhcp/"},{"name":"router","slug":"router","permalink":"https://tinychen.com/tags/router/"}]},{"title":"WiresharkæŠ“åŒ…åˆ†ææ ¡å›­ç½‘ç™»å½•è¿‡ç¨‹","slug":"20190608-wireshark-stu","date":"2019-06-08T07:00:00.000Z","updated":"2019-06-08T07:00:00.000Z","comments":true,"path":"20190608-wireshark-stu/","link":"","permalink":"https://tinychen.com/20190608-wireshark-stu/","excerpt":"ä½¿ç”¨WiresharkæŠ“åŒ…åˆ†ææ ¡å›­ç½‘ç™»å½•è¿‡ç¨‹ï¼Œå¹¶ä½¿ç”¨curlå®ç°æ¨¡æ‹Ÿç™»å½•ã€‚","text":"ä½¿ç”¨WiresharkæŠ“åŒ…åˆ†ææ ¡å›­ç½‘ç™»å½•è¿‡ç¨‹ï¼Œå¹¶ä½¿ç”¨curlå®ç°æ¨¡æ‹Ÿç™»å½•ã€‚ 1ã€ç™»å½•è¿‡ç¨‹æŠ“åŒ…1.1 TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ä¸‹å›¾æ˜¯ç»å…¸çš„TCPä¸‰æ¬¡æ¡æ‰‹ç¤ºæ„å›¾ã€‚ ä¸‹é¢æ˜¯æŠ“åˆ°çš„å’Œæ ¡å›­ç½‘ç™»å½•ç•Œé¢1.1.1.2å»ºç«‹TCPé“¾æ¥çš„ä¸‰ä¸ªæ•°æ®æŠ¥æ–‡ã€‚ 1.1.1 ç¬¬ä¸€æ¬¡æ¡æ‰‹å®¢æˆ·ç«¯å‘é€synåŒ…(seq=x)åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENDçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ï¼› ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°æ­¤æ—¶ seq=x=0 å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªTCPï¼Œæ ‡å¿—ä½ä¸ºSYNï¼Œåºåˆ—å·ä¸º0ï¼Œä»£è¡¨å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œå¦‚ä¸‹å›¾ï¼š 1.1.2 ç¬¬äºŒæ¬¡æ¡æ‰‹æœåŠ¡å™¨æ”¶åˆ°synåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYN(ack=x+1)ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…(seq=y)ï¼Œå³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ï¼› ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°æ­¤æ—¶ ack=x+1=0+1=1 seq=y=0 1.1.3 ç¬¬ä¸‰æ¬¡æ¡æ‰‹å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACK(ack=y+1)ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚ ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°æ­¤æ—¶ ack=y+1=0+1=1 1.2 ç™»å½•è¿‡ç¨‹åˆ†ææˆ‘ä»¬æŸ¥çœ‹ç™»å½•çš„æŠ¥æ–‡ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªHTTP POSTè¯·æ±‚ï¼Œç›®æ ‡URLä¸ºhttp://a.stu.edu.cn/ac_portal/login.php åœ¨åé¢çš„æŠ¥æ–‡åˆ†æä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ä¸ä»…æ˜¯ç™»å½•ï¼ŒæŸ¥è¯¢å’Œæ³¨é”€çš„ç›®æ ‡URLä¹Ÿæ˜¯http://a.stu.edu.cn/ac_portal/login.phpï¼Œä¸åŒä¹‹å¤„æ˜¯opré€‰é¡¹çš„ä¸åŒã€‚ å†æ¥æŸ¥çœ‹æŠ¥æ–‡å†…å®¹ï¼Œæˆ‘ä»¬å‘ç°ç™»å½•çš„é€‰é¡¹è¾ƒå¤š oprä¸ºç™»å½•é€‰é¡¹ï¼Œæ­¤å¤„ä¸ºpwdLoginï¼Œå³è´¦å·å¯†ç ç™»å½• userNameä¸ºç”¨æˆ·å pwdä¸ºç”¨æˆ·å¯†ç  ipv4or6å®åˆ™ä¸ºä½ çš„Temporary IPv6 Addressï¼Œå¦‚æœæ— åˆ™ä¸ºç©º rememberPwdä¸ºæ˜¯å¦è®°ä½å¯†ç  1.3 æŸ¥è¯¢è¿‡ç¨‹åˆ†ææŸ¥è¯¢ç™»å½•çŠ¶æ€çš„æŠ¥æ–‡ä¹Ÿéå¸¸ç®€å•ï¼Œä½¿ç”¨HTTP POSTæäº¤ä¸€ä¸ªopr=online_checkçš„è¯·æ±‚ã€‚ ç„¶åæœåŠ¡ç«¯ä¼šè¿”å›ä¸€æ¡htmlçš„textæ¶ˆæ¯ï¼Œé‡Œé¢çš„ä¸»è¦å†…å®¹æ˜¯ä¸¤ä¸ªé€‰é¡¹onlineå’Œusernameã€‚ å…¶ä¸­onlineæœ‰0å’Œ1ä¸¤ä¸ªçŠ¶æ€ï¼Œå½“onlineä¸º1çš„æ—¶å€™ï¼Œè¡¨ç¤ºå·²ç»ç™»å½•æˆåŠŸï¼Œä¸”ä¼šè¿”å›ç”¨æˆ·åusernameï¼›å½“onlineä¸º0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ²¡æœ‰ç™»å½•ï¼Œä¸ä¼šè¿”å›ç”¨æˆ·åusernameã€‚ 1.4 æ³¨é”€è¿‡ç¨‹åˆ†æ1.4.1 IPv4æ³¨é”€è¿‡ç¨‹IPv4çš„æ³¨é”€è¿‡ç¨‹éå¸¸ç®€å•ï¼Œåªéœ€è¦æäº¤ä¸€ä¸ªå¸¦æœ‰opr=logotçš„HTTP POSTè¯·æ±‚å³å¯ã€‚ 1.4.2 IPv6æ³¨é”€è¿‡ç¨‹åœ¨æœ¬æœºè·å¾—IPv6åœ°å€ä¹‹åï¼Œæ³¨é”€çš„HTTP POSTè¯·æ±‚ä¸­è¿˜éœ€è¦å¤šåŠ ä¸€é¡¹ipv4or6=ä½ çš„Temporary IPv6 Addressï¼Œæ‰èƒ½æˆåŠŸæ³¨é”€ã€‚ 2ã€Curlæ¨¡æ‹Ÿç™»å½•2.1 Curlç®€ä»‹Curlæ˜¯ä¸€ä¸ªåˆ©ç”¨URLè¯­æ³•åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œ1997å¹´é¦–æ¬¡å‘è¡Œã€‚å®ƒæ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ï¼Œæ‰€ä»¥æ˜¯ç»¼åˆä¼ è¾“å·¥å…·ï¼Œä½†æŒ‰ä¼ ç»Ÿï¼Œä¹ æƒ¯ç§°Curlä¸ºä¸‹è½½å·¥å…·ã€‚Curlè¿˜åŒ…å«äº†ç”¨äºç¨‹åºå¼€å‘çš„libcurlã€‚ Curlæ”¯æŒçš„é€šä¿¡åè®®æœ‰FTPã€FTPSã€HTTPã€HTTPSã€TFTPã€SFTPã€Gopherã€SCPã€Telnetã€DICTã€FILEã€LDAPã€LDAPSã€IMAPã€POP3ã€SMTPå’ŒRTSPã€‚ Curlè¿˜æ”¯æŒSSLè®¤è¯ã€HTTP POSTã€HTTP PUTã€FTPä¸Šä¼ , HTTP form based uploadã€proxiesã€HTTP/2ã€cookiesã€ç”¨æˆ·å+å¯†ç è®¤è¯(Basic, Plain, Digest, CRAM-MD5, NTLM, Negotiate and Kerberos)ã€file transfer resumeã€proxy tunnelingã€‚ æˆ‘ä»¬å¯ä»¥è¾“å…¥curl --helpæ¥æŸ¥çœ‹ç›¸å…³çš„æŒ‡ä»¤å¸®åŠ©ã€‚ ä¸‹é¢æˆ‘ä»¬è¦ç”¨åˆ°çš„æ¨¡æ‹Ÿç™»å½•ä¸»è¦æ˜¯ä½¿ç”¨curlæ¨¡æ‹Ÿè¡¨å•ç™»å½•ã€‚ 2.2 ç™»å½•è¿‡ç¨‹åˆ†æä»ä¸Šé¢çš„æŠ¥æ–‡åˆ†ææˆ‘ä»¬å¾—çŸ¥ï¼Œç™»å½•çš„æ—¶å€™http postè¯·æ±‚æäº¤äº†å¤šä¸ªé€‰é¡¹ï¼Œä½†å®é™…ä¸Šéœ€è¦ç™»å½•æˆåŠŸåªéœ€è¦æäº¤ç™»å½•é€‰é¡¹ï¼ˆoprï¼‰ã€è´¦å·ï¼ˆuserNameï¼‰å’Œå¯†ç ï¼ˆpwdï¼‰å³å¯ã€‚ 1curl -d &quot;opr=pwdLogin&amp;userName=ä½ çš„è´¦å·&amp;pwd=ä½ çš„å¯†ç &quot; http://a.stu.edu.cn/ac_portal/login.php 2.3 æŸ¥è¯¢è¿‡ç¨‹åˆ†æ1curl -d &quot;opr=online_check&quot; http://a.stu.edu.cn/ac_portal/login.php 2.4 æ³¨é”€è¿‡ç¨‹åˆ†æåœ¨æ— IPv6åœ°å€çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ³¨é”€ç™»å½•åªéœ€è¦æäº¤ä¸€ä¸ªæ³¨é”€è¯·æ±‚ï¼ˆopr=logoutï¼‰å³å¯ã€‚ 12# å› ä¸ºè¿”å›çš„æ•°æ®ä¸­æœ‰ä¸­æ–‡ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¹±ç ï¼Œæ‰€ä»¥è¦ä½¿ç”¨iconvè¿›è¡Œç¼–ç è½¬æ¢curl -d &quot;opr=logout&quot; http://a.stu.edu.cn/ac_portal/login.php | iconv -f utf-8 -t gb2312 åœ¨æœ‰IPv6åœ°å€çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»ä¸Šé¢çš„æŠ¥æ–‡åˆ†æå¯çŸ¥ï¼Œé™¤äº†æ³¨é”€è¯·æ±‚ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æäº¤ä¸€ä¸ªIPv6åœ°å€ï¼ˆ``Temporary IPv6 Address`ï¼‰ï¼Œæ‰èƒ½å¤Ÿé¡ºåˆ©æ³¨é”€ã€‚ 12# å› ä¸ºè¿”å›çš„æ•°æ®ä¸­æœ‰ä¸­æ–‡ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¹±ç ï¼Œæ‰€ä»¥è¦ä½¿ç”¨iconvè¿›è¡Œç¼–ç è½¬æ¢curl -d &quot;opr=logout&amp;ipv4or6=ä½ çš„Temporary IPv6 Address&quot; http://a.stu.edu.cn/ac_portal/login.php | iconv -f utf-8 -t gb2312 3ã€å®ç°å®šæ—¶ç™»å½•å’Œçˆ†æµé‡æ¢è´¦å·é¦–å…ˆè¦è¯´æ˜ä¸€ä¸‹ç°åœ¨çš„ç½‘ç»œçŠ¶å†µï¼Œåœ¨å®¿èˆé‡Œé¢ï¼Œæ–­ç½‘æ—¶é—´æ˜¯ä»æ™šä¸Š12ç‚¹åˆ°æ—©ä¸Š6:30ï¼Œä¸”æ¯ä¸ªè´¦å·æ¯å¤©æœ‰é™åˆ¶ä½¿ç”¨æµé‡ï¼Œè€Œåœ¨æ—©ä¸Š6ï¼š30ä¹‹åï¼Œå¦‚æœå®¿èˆæ¥å…¥è·¯ç”±å™¨éœ€è¦æ‰‹åŠ¨ç™»å½•ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡æ¥å®ç°è‡ªåŠ¨ç™»å½•å’Œä¸€ä¸ªè´¦å·æµé‡ç”¨å®Œä¹‹ååˆ‡æ¢åˆ°å¦ä¸€ä¸ªè´¦å·ã€‚ 3.1 å®šæ—¶ç™»å½•1curl -d &quot;opr=pwdLogin&amp;userName=ä½ çš„è´¦å·&amp;pwd=ä½ çš„å¯†ç &quot; http://a.stu.edu.cn/ac_portal/login.php åœ¨linuxä¸­ï¼ˆæ ‘è“æ´¾æˆ–NASï¼‰è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œ6:32åˆ†æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚ 3.2 çˆ†æµé‡æ¢è´¦å·ç”±äºé€šè¿‡æ ¡å›­ç½‘ç™»å½•ç•Œé¢æŸ¥è¯¢æ˜¯å¦çˆ†æµé‡ä¼šæœ‰å»¶è¿Ÿï¼ˆå¤§æ¦‚5åˆ†é’Ÿï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨pingå‘½ä»¤æ¥å®æ—¶æ£€æµ‹ã€‚ 1ping baidu.com || curl -d &quot;opr=logout&quot; http://a.stu.edu.cn/ac_portal/login.php &amp;&amp; curl -d &quot;opr=pwdLogin&amp;userName=ä½ çš„è´¦å·&amp;pwd=ä½ çš„å¯†ç &quot; http://a.stu.edu.cn/ac_portal/login.php ä½¿ç”¨linuxä¸­çš„crontabå·¥å…·ï¼Œè®¾ç½®è¯¥ä»»åŠ¡æ‰§è¡Œæ—¶é—´ä¸ºæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œæ—¶é—´ä¸º7:00åˆ°23:59ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"},{"name":"wireshark","slug":"wireshark","permalink":"https://tinychen.com/tags/wireshark/"},{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"}]},{"title":"Ubuntu18.04å’ŒCentOS7æ›´æ¢é˜¿é‡Œæº","slug":"20190605-linux-use-ali-source","date":"2019-06-05T07:00:00.000Z","updated":"2019-06-05T07:00:00.000Z","comments":true,"path":"20190605-linux-use-ali-source/","link":"","permalink":"https://tinychen.com/20190605-linux-use-ali-source/","excerpt":"åœ¨CentOS7.6å’ŒUbuntu18.04ä¸Šé¢æ›´æ¢è½¯ä»¶æºä¸ºé˜¿é‡Œæºã€‚","text":"åœ¨CentOS7.6å’ŒUbuntu18.04ä¸Šé¢æ›´æ¢è½¯ä»¶æºä¸ºé˜¿é‡Œæºã€‚ 1ã€Ubuntu18.0412345678910111213141516171819202122232425262728# é¦–å…ˆå¤‡ä»½æºé•œåƒæºsudo cp /etc/apt/sources.list /etc/apt/sources.list.bak# æ¥ç€å°†æºé•œåƒæºçš„å†…å®¹å…¨éƒ¨æ³¨é‡Šæ‰ï¼Œæ›´æ”¹ä¸ºä¸‹åˆ—å†…å®¹deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse# æ›´æ–°é•œåƒæºä½¿å…¶ç”Ÿæ•ˆsudo apt-get updatesudo apt-get upgrade 2ã€CentOS71234567891011# é¦–å…ˆå¤‡ä»½æºé•œåƒæºcd /etc/yum.repos.dmv CentOS-Base.repo CentOS-Base.repo.bak# ä¸‹è½½æ–°é•œåƒæºå¹¶æ›´æ”¹åç§°wget http://mirrors.aliyun.com/repo/Centos-7.repo -O CentOS-Base.repo# æ›´æ–°é•œåƒæºä½¿å…¶ç”Ÿæ•ˆyum clean allyum makecacheyum update","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"Linuxå®‰è£…MPI","slug":"20190604-linux-install-mpi","date":"2019-06-04T07:00:00.000Z","updated":"2019-06-04T07:00:00.000Z","comments":true,"path":"20190604-linux-install-mpi/","link":"","permalink":"https://tinychen.com/20190604-linux-install-mpi/","excerpt":"åœ¨CentOS7.6å’ŒUbuntu19.04ä¸Šé¢å®‰è£…MPIå¼€å‘ç¯å¢ƒã€‚ éœ€è¦æ³¨æ„çš„æ˜¯é™¤éä½¿ç”¨rootè´¦å·ï¼Œä¸ç„¶éœ€è¦åŠ ä¸Šsudoä¿è¯æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œå®‰è£…æ“ä½œã€‚","text":"åœ¨CentOS7.6å’ŒUbuntu19.04ä¸Šé¢å®‰è£…MPIå¼€å‘ç¯å¢ƒã€‚ éœ€è¦æ³¨æ„çš„æ˜¯é™¤éä½¿ç”¨rootè´¦å·ï¼Œä¸ç„¶éœ€è¦åŠ ä¸Šsudoä¿è¯æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œå®‰è£…æ“ä½œã€‚ 1ã€ä¸‹è½½MPIMPIçš„å®˜ç½‘ä¸‹è½½åœ°å€ è¿™é‡Œå°ä¸ƒç›´æ¥ä¸‹è½½çš„3.3ç¨³å®šç‰ˆã€‚ 12# ä½¿ç”¨wgetå‘½ä»¤ç›´æ¥ä¸‹è½½wget http://www.mpich.org/static/downloads/3.3/mpich-3.3.tar.gz 2ã€è§£å‹MPI1sudo tar -zxvf mpich-3.3.tar.gz 3ã€ç¼–è¯‘å®‰è£…12345678cd mpich-3.3/# è¿™é‡Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å®‰è£…fortrançš„ç¼–è¯‘å™¨çš„è¯éœ€è¦ç¦ç”¨fortransudo ./configure -prefix=/usr/local/mpich --disable-fortransudo makesudo make install 4ã€é…ç½®ç¯å¢ƒå˜é‡1234567891011# è¿”å›å½“å‰ç”¨æˆ·ç›®å½•cd # ç¼–è¾‘ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶vim .bashrc # åœ¨é‡Œé¢æ·»åŠ ç¯å¢ƒå˜é‡export PATH=/usr/local/mpich/bin:$PATH # æ›´æ–°é…ç½®æ–‡ä»¶ä½¿å…¶ç”Ÿæ•ˆsource .bashrc 5ã€æµ‹è¯•12345# æµ‹è¯•cd mpich-3.3/# æ­¤å¤„çš„12ä¸ºå¯¹åº”çš„çº¿ç¨‹æ•°mpirun -np 12 ./examples/cpi","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"Optimizing Gradual SDN Upgrades in ISP Networks","slug":"20190601-isp-upgrade-sdn","date":"2019-06-01T07:00:00.000Z","updated":"2019-06-01T07:00:00.000Z","comments":true,"path":"20190601-isp-upgrade-sdn/","link":"","permalink":"https://tinychen.com/20190601-isp-upgrade-sdn/","excerpt":"å› ä¸ºä½œä¸šè¦æ±‚ï¼Œæœ€è¿‘æ‹œè¯»äº†IEEEä¸Šé¢çš„ä¸€ç¯‡å…³äºISPå‡çº§åˆ°SDNçš„æ–¹æ³•çš„ç ”ç©¶æ–‡ç« ï¼Œç„¶åè®°å½•äº†æ–‡ç« çš„ä¸€äº›è¦ç‚¹å’Œå¯¹ä¸€äº›è‡ªå·±ä¸æ‡‚çš„çŸ¥è¯†è¿›è¡Œè¡¥å……ã€‚","text":"å› ä¸ºä½œä¸šè¦æ±‚ï¼Œæœ€è¿‘æ‹œè¯»äº†IEEEä¸Šé¢çš„ä¸€ç¯‡å…³äºISPå‡çº§åˆ°SDNçš„æ–¹æ³•çš„ç ”ç©¶æ–‡ç« ï¼Œç„¶åè®°å½•äº†æ–‡ç« çš„ä¸€äº›è¦ç‚¹å’Œå¯¹ä¸€äº›è‡ªå·±ä¸æ‡‚çš„çŸ¥è¯†è¿›è¡Œè¡¥å……ã€‚ 0ã€AbstractNowadays, there is a fast-paced shift from legacy telecommunication systems to novel software-deï¬ned network (SDN) architectures that can support on-the-ï¬‚y network reconï¬guration, therefore, empowering advanced trafï¬c engineering mechanisms. Despite this momentum, migration to SDN cannot be realized at once especially in high-end networks of Internet service providers (ISPs). It is expected that ISPs will gradually upgrade their networks to SDN over a period that spans several years. In this paper, we study the SDN upgrading problem in an ISP network:**which nodes to upgrade and when we consider a general model that captures different migration costs and network topologies, and two plausible ISP objectives: ** the maximization of the trafï¬c that traverses at least one SDN node, the maximization of the number of dynamically selectable routing paths enabled by SDN nodes. We leverage the theory of submodular and supermodular functions to devise algorithms with provable approximation ratios for each objective. Using realworld network topologies and trafï¬c matrices, we evaluate the performance of our algorithms and show up to 54% gains over state-of-the-art methods. Moreover, we describe the interplay between the two objectives; maximizing one may cause a factor of 2 loss to the other. We also study the dual upgrading problem, i.e., minimizing the upgrading cost for the ISP while ensuring speciï¬c performance goals. Our analysis shows that our proposed algorithm can achieve up to 2.5 times lower cost to ensure performance goals over state-of-the-art methods. Index Termsâ€”Software deï¬ned networks, gradual deployment, ISP networks. 1ã€Motivation1.1 ä¼ ç»Ÿç½‘ç»œä¸è¶³1.1.1 ç¡¬ä»¶å‡çº§éš¾é¢˜çºµè§‚ç½‘ç»œè®¾å¤‡çš„è¯ç”Ÿï¼Œä¼ ç»Ÿç½‘ç»œè¡Œä¸šæŒ‰éœ€å‘å±•ï¼Œå³æ ¹æ®æš´éœ²çš„é—®é¢˜ç„¶åå»ç ”å‘è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åŒæ—¶ï¼Œç½‘ç»œç¡¬ä»¶ç ”å‘å‘¨æœŸé•¿ï¼Œè¿­ä»£å’Œå‡çº§ä¹Ÿè¿œè¿œè·Ÿä¸ä¸Šè½¯ä»¶ã€‚ åœ¨ä¼ ç»Ÿç½‘ç»œè¡Œä¸šä¸­ï¼Œè¯è¯­æƒæ˜¯æŒæ§åœ¨ç½‘ç»œè®¾å¤‡å•†æ‰‹ä¸Šçš„ï¼Œå¦‚æ€ç§‘ã€åä¸ºã€æ–°åä¸‰ç­‰ã€‚åº•å±‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œæ˜¯å®Œå…¨å°é—­çš„ï¼Œå¦‚åŒé»‘ç›’å­èˆ¬ï¼Œæ— æ³•å»æŒæ§ã€‚ 1.1.2 ç½‘ç®¡ç³»ç»Ÿçš„ä¸è¶³ä¼ ç»Ÿçš„ä¸»æµç½‘ç»œæ–¹æ¡ˆä¸­ï¼Œä¸€èˆ¬æ˜¯é…ç½®ç½‘ç®¡æœåŠ¡å™¨ï¼Œç½‘ç»œè®¾å¤‡ï¼ˆè·¯ç”±å™¨ã€äº¤æ¢æœºã€é˜²ç«å¢™ï¼‰å’Œç½‘ç®¡ç³»ç»Ÿéƒ¨ç½²SNMPåè®®ï¼Œé€šè¿‡ç½‘ç®¡ç³»ç»Ÿå¯¹å…¨ç½‘è¿›è¡Œå¯è§†åŒ–æ‹“æ‰‘å‘ç°ã€é…ç½®ç®¡ç†ã€é“¾è·¯è´¨é‡æ£€æµ‹ã€‚ ç„¶è€Œï¼ŒSNMPä½œä¸ºç®€å•ç½‘ç»œç®¡ç†åè®®ï¼Œæ›´å¤šä¾§é‡äºç½‘ç»œè®¾å¤‡çš„ç›‘æ§ã€‚è€Œä¸æ˜¯éƒ¨ç½²å’Œé…ç½®ã€‚ä¸€èˆ¬ä»…ä»…å¯¹IDCæœºæˆ¿çš„æ•…éšœè¿›è¡Œå‘Šè­¦ï¼Œæ— æ³•é€šè¿‡ç½‘ç®¡æœåŠ¡å™¨å»è‡ªåŠ¨é…ç½®ã€‚ 1.1.3 æµé‡åˆ†é…ä¸å‡è¡¡åŒæ—¶ï¼Œé’ˆå¯¹äº’è”ç½‘å…¬å¸çš„é“¾è·¯æµé‡åˆ†é…ä¸å‡è¡¡ï¼Œä¹Ÿæ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå¯åˆ†é…å‡è¡¡çš„ä¸€å¤§éš¾ç‚¹ï¼Œåˆåœ¨äºæµé‡çš„å¯è§†åŒ–ã€‚ å¸¸è§„æµæ§äº§å“åªèƒ½å®ç°éƒ¨åˆ†å¸¦å®½åˆ†é…å¯è§†åŒ–ï¼Œå¸¸è§„ç½‘ç®¡ç³»ç»Ÿåªèƒ½å®ç°é“¾è·¯æ•…éšœæ£€æµ‹ï¼Œæ— æ³•å¸¦å®½å¯è§†åŒ– å…¨ç½‘æµé‡å¯è§†åŒ–æ˜¯å¸¦å®½æ™ºèƒ½è°ƒé…çš„åŸºç¡€ 1.1.4 ç½‘ç»œè®¾å¤‡æœ¬èº«é—®é¢˜ç½‘ç»œè®¾å¤‡é€šè¿‡â€œç½‘è·¯åè®®â€è¿›è¡Œå¯¹è¯ï¼Œå¦‚OSPFã€BGPã€MPLSã€MSTPç­‰ï¼Œå»ºç«‹è¿æ¥ä¼šé€šè¿‡ä¸‰ä¸ªæ­¥éª¤ï¼šé‚»å±…å»ºç«‹ã€ä¿¡æ¯å…±äº«ã€è·¯å¾„é€‰æ‹©ã€‚ è€Œç”±äºå¤§éƒ¨åˆ†çš„ç½‘ç»œè®¾å¤‡é‡‡ç”¨â€œåˆ†å¸ƒå¼æ¶æ„â€ï¼Œæ¯æ¬¡äº¤äº’éƒ½ä¼šæ ¹æ®â€œè·¯å¾„ç®—æ³•ï¼ˆå¦‚SPFç®—æ³•ï¼‰â€é€‰æ‹©æœ€ä¼˜çš„è·¯å¾„ã€‚ä½†æ˜¯é€‰æ‹©è·¯å¾„æ—¶ï¼Œåªèƒ½é€‰æ‹©æœ€çŸ­ï¼Œä¸èƒ½æ ¹æ®æµé‡ç­‰å› ç´ åŠ ä»¥åŒºåˆ†ã€‚åŒæ—¶ï¼Œç”±äºæ¯ä¸ªäº¤æ¢æœºéƒ½ä¼šæœ‰è‡ªå·±çš„æ§åˆ¶å™¨ï¼Œä¹Ÿä¼šæ¶ˆè€—ä¸€éƒ¨åˆ†çš„è½¬å‘æ€§èƒ½ã€‚ 1.2 SDNå®šä¹‰ SDNï¼šå³è½¯ä»¶å®šä¹‰ç½‘ç»œï¼Œæ˜¯ä¸€ç§ç½‘ç»œè®¾è®¡ç†å¿µ ç½‘ç»œè®¾å¤‡å¯ä»¥é›†ä¸­å¼ç®¡ç†ï¼Œå¯ç¼–ç¨‹ï¼Œæ§åˆ¶å’Œè½¬å‘åˆ†ç¦»ã€‚å³å¯å®šä¹‰ä¸ºSDN SDNæ¡†æ¶ç”±åº”ç”¨å±‚ã€æ§åˆ¶å±‚ã€è½¬å‘å±‚ï¼ˆåŸºç¡€è®¾æ–½å±‚ï¼‰ç»„æˆï¼Œå…¶ä¸­åº”ç”¨å±‚æä¾›åº”ç”¨å’ŒæœåŠ¡ï¼ˆç½‘ç®¡ã€å®‰å…¨ã€æµæ§ç­‰ï¼‰ï¼Œæ§åˆ¶å±‚ç»Ÿä¸€ç®¡ç†å’Œæ§åˆ¶ï¼ˆåè®®è®¡ç®—ã€ç­–ç•¥ä¸‹å‘ã€é“¾è·¯ä¿¡æ¯ç­‰ï¼‰ã€è½¬å‘å±‚æä¾›ç¡¬ä»¶è®¾å¤‡ï¼ˆäº¤æ¢æœºã€è·¯ç”±å™¨ã€é˜²ç«å¢™ï¼‰è¿›è¡Œæ•°æ®è½¬å‘ åŸºäºREST APIçš„åŒ—å‘æ¥å£è´Ÿè´£é¢å‘åº”ç”¨ï¼Œæä¾›ç½‘ç»œæŠ½è±¡ï¼Œä½¿å¾—ç½‘ç»œå…·å¤‡è½¯ä»¶ç¼–ç¨‹çš„èƒ½åŠ›ã€‚å—å‘æ¥å£ä¸»è¦è´Ÿè´£é¢å‘åŸºç¡€è®¾æ–½å±‚ï¼Œä¸»è¦æä¾›Openflowæµã€‚ æ³¨æ„ï¼šæ§åˆ¶å±‚æ¥å£ä¹Ÿå±äºåŒ—å‘æ¥å£ 1.3 ä¼ ç»Ÿç½‘ç»œå¯¹æ¯”SDNç½‘ç»œ ä¼ ç»Ÿç½‘ç»œ SDN æ§åˆ¶è½¬å‘è€¦åˆ æ§åˆ¶è½¬å‘åˆ†ç¦» åˆ†å¸ƒå¼æ§åˆ¶ é›†ä¸­å¼æ§åˆ¶ ä¸å¯ç¼–ç¨‹ å¯ç¼–ç¨‹ ä¸å¼€æ”¾ å¼€æ”¾æ¥å£ ç¡¬ä»¶åŒ– è™šæ‹ŸåŒ– ç¬¬ä¸‰æ¡ä¸»è¦æ˜¯SDNå¯ä»¥é€šè¿‡ä»£ç å†™è„šæœ¬å®ç°è½¬å‘ç­–ç•¥ï¼Œå¦‚C/JAVA/Pythonã€‚ ç¬¬å››æ¡å¼€æ”¾æ¥å£ä¹Ÿå¾ˆå¥½ç†è§£ï¼ŒåŸºäºå¼€æ”¾åè®®çš„æ–¹æ¡ˆæ˜¯å½“å‰SDNå®ç°çš„ä¸»æµæ–¹æ¡ˆã€‚ ï¼ˆä¸»è¦æ˜¯OpenFlowï¼‰ ç¬¬äº”æ¡ç½‘ç»œè™šæ‹ŸåŒ–ï¼Œå³è™šæ‹ŸåŒ–å¹³å°æ˜¯ä»‹äºæ•°æ®ç½‘ç»œæ‹“æ‰‘å’Œç§Ÿæˆ·æ§åˆ¶å™¨ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œä¸ºäº†å®ç°è™šæ‹ŸåŒ–ï¼Œè™šæ‹ŸåŒ–å¹³å°éœ€è¦å¯¹ç‰©ç†ç½‘ç»œèµ„æºè¿›è¡ŒæŠ½è±¡è™šæ‹ŸåŒ–ï¼Œå…¶ä¸­åŒ…æ‹¬æ‹“æ‰‘è™šæ‹ŸåŒ–ï¼ŒèŠ‚ç‚¹èµ„æºè™šæ‹ŸåŒ–å’Œé“¾è·¯èµ„æºè™šæ‹ŸåŒ–ã€‚ 1.4 MPLSç®€ä»‹å¤šåè®®æ ‡ç­¾äº¤æ¢ï¼ˆè‹±è¯­ï¼šMulti-Protocol Label Switchingï¼Œç¼©å†™ä¸ºMPLSï¼‰æ˜¯ä¸€ç§åœ¨å¼€æ”¾çš„é€šä¿¡ç½‘ä¸Šåˆ©ç”¨æ ‡ç­¾å¼•å¯¼æ•°æ®é«˜é€Ÿã€é«˜æ•ˆä¼ è¾“çš„æ–°æŠ€æœ¯ã€‚å¤šåè®®çš„å«ä¹‰æ˜¯æŒ‡MPLSä¸ä½†å¯ä»¥æ”¯æŒå¤šç§ç½‘ç»œå±‚å±‚é¢ä¸Šçš„åè®®ï¼Œè¿˜å¯ä»¥å…¼å®¹ç¬¬äºŒå±‚çš„å¤šç§æ•°æ®é“¾è·¯å±‚æŠ€æœ¯ã€‚ MPLSæ˜¯åˆ©ç”¨æ ‡è®°ï¼ˆlabelï¼‰è¿›è¡Œæ•°æ®è½¬å‘çš„ã€‚å½“åˆ†ç»„è¿›å…¥ç½‘ç»œæ—¶ï¼Œè¦ä¸ºå…¶åˆ†é…å›ºå®šé•¿åº¦çš„çŸ­çš„æ ‡è®°ï¼Œå¹¶å°†æ ‡è®°ä¸åˆ†ç»„å°è£…åœ¨ä¸€èµ·ï¼Œåœ¨æ•´ä¸ªè½¬å‘è¿‡ç¨‹ä¸­ï¼Œäº¤æ¢èŠ‚ç‚¹ä»…æ ¹æ®æ ‡è®°è¿›è¡Œè½¬å‘ã€‚ MPLS ç‹¬ç«‹äºç¬¬äºŒå’Œç¬¬ä¸‰å±‚åè®®ï¼Œè¯¸å¦‚ATM å’ŒIPã€‚å®ƒæä¾›äº†ä¸€ç§æ–¹å¼ï¼Œå°†IPåœ°å€æ˜ å°„ä¸ºç®€å•çš„å…·æœ‰å›ºå®šé•¿åº¦çš„æ ‡ç­¾ï¼Œç”¨äºä¸åŒçš„åŒ…è½¬å‘å’ŒåŒ…äº¤æ¢æŠ€æœ¯ã€‚å®ƒæ˜¯ç°æœ‰è·¯ç”±å’Œäº¤æ¢åè®®çš„æ¥å£ï¼Œå¦‚IPã€ATMã€å¸§ä¸­ç»§ã€èµ„æºé¢„ç•™åè®®ï¼ˆRSVPï¼‰ã€å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼ˆOSPFï¼‰ç­‰ç­‰ã€‚ 1.5 OSPFç®€ä»‹OSPF(Open Shortest Path Firstå¼€æ”¾å¼æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼‰æ˜¯ä¸€ä¸ªå†…éƒ¨ç½‘å…³åè®®(Interior Gateway Protocolï¼Œç®€ç§°IGPï¼‰ï¼Œç”¨äºåœ¨å•ä¸€è‡ªæ²»ç³»ç»Ÿï¼ˆautonomous system,ASï¼‰å†…å†³ç­–è·¯ç”±ã€‚æ˜¯å¯¹é“¾è·¯çŠ¶æ€è·¯ç”±åè®®çš„ä¸€ç§å®ç°ï¼Œéš¶å±å†…éƒ¨ç½‘å…³åè®®ï¼ˆIGPï¼‰ï¼Œæ•…è¿ä½œäºè‡ªæ²»ç³»ç»Ÿå†…éƒ¨ã€‚è‘—åçš„è¿ªå…‹æ–¯åŠ ç®—æ³•(Dijkstra)è¢«ç”¨æ¥è®¡ç®—æœ€çŸ­è·¯å¾„æ ‘ã€‚OSPFåˆ†ä¸ºOSPFv2å’ŒOSPFv3ä¸¤ä¸ªç‰ˆæœ¬,å…¶ä¸­OSPFv2ç”¨åœ¨IPv4ç½‘ç»œï¼ŒOSPFv3ç”¨åœ¨IPv6ç½‘ç»œã€‚ 1.6 æ··åˆSDNçš„å¥½å¤„ å¯¹äºè·¨è¶Šè‡³å°‘ä¸€ä¸ªSDNèŠ‚ç‚¹çš„æµé‡ï¼Œå¯ä»¥åº”ç”¨å„ç§å¤æ‚çš„ç­–ç•¥ï¼Œä¾‹å¦‚è®¿é—®æ§åˆ¶ï¼Œé˜²ç«å¢™åŠ¨ä½œä»¥åŠå…¶ä»–æ”¯æŒä¸­é—´ç›’çš„ç½‘å†…æœåŠ¡ã€‚ ä½¿ç”¨SDNèŠ‚ç‚¹å¯ä»¥é€šè¿‡è¦†ç›–åº•å±‚çš„OSPFæˆ–MPLSæ¥åŠ¨æ€åœ°æ§åˆ¶æµçš„è·¯ç”±è·¯å¾„ï¼Œä»è€Œåˆ›é€ æ›´çµæ´»çš„ç½‘ç»œã€‚ å›¾1.éƒ¨åˆ†å‡çº§åˆ°SDNçš„ç½‘ç»œã€‚ä¸¤ä¸ªSDNèŠ‚ç‚¹å¯ä»¥å……å½“é˜²ç«å¢™æˆ–åŠ¨æ€æ§åˆ¶è·¯ç”±è·¯å¾„ã€‚ è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜è¿™ç§æ–¹æ³•çš„æ½œåŠ›ã€‚è€ƒè™‘å›¾1æ‰€ç¤ºçš„æ··åˆSDNç½‘ç»œï¼Œå®ƒå°†æµä»æºèŠ‚ç‚¹1è·¯ç”±åˆ°ç›®çš„èŠ‚ç‚¹3.è¿™é‡Œï¼Œä¸ƒä¸ªèŠ‚ç‚¹ä¸­åªæœ‰ä¸¤ä¸ªç”¨SDNcapabilitiesï¼ˆèŠ‚ç‚¹1å’Œ4ï¼‰å‡çº§ã€‚ä½¿ç”¨OSPFï¼Œæµå§‹ç»ˆæ²¿æœ€çŸ­è·¯å¾„è·¯ç”±ã€‚ç„¶è€Œï¼ŒèŠ‚ç‚¹1å¯ä»¥åŠ¨æ€åœ°å†³å®šä¸¢å¼ƒï¼ˆè€Œä¸æ˜¯è½¬å‘ï¼‰æŠ¥æ–‡ï¼Œä¾‹å¦‚ä½œä¸ºé˜²ç«å¢™ã€‚å®ƒè¿˜å¯ä»¥é€šè¿‡èŠ‚ç‚¹4è·¯ç”±åˆ†ç»„æ¥è¦†ç›–OSPFæœ€çŸ­è·¯å¾„ã€‚ç„¶åï¼ŒæŠ¥æ–‡å°†è·Ÿéšå¤‡ç”¨è·¯å¾„1ï¼Œè¯¥å¤‡ç”¨è·¯å¾„1æ˜¯å…·æœ‰3çš„OSPFæœ€çŸ­è·¯å¾„è¿æ¥èŠ‚ç‚¹4.å½“æœ€çŸ­è·¯å¾„çš„é“¾è·¯å¤±è´¥æˆ–å˜ä¸ºä¸´æ—¶æ‹¥å¡æ—¶ï¼Œè¿™ç§æµé‡æ–°è·¯ç”±æ˜¯é‡è¦çš„ã€‚ç”±äºèŠ‚ç‚¹4ä¹Ÿå‡çº§åˆ°SDNï¼Œå› æ­¤å®ƒå¯ä»¥ç±»ä¼¼åœ°å°†æŠ¥æ–‡æ¨å‘æ›¿ä»£è·¯å¾„2.æ¢å¥è¯è¯´ï¼Œéšç€å¯ç”¨SDNçš„èŠ‚ç‚¹çš„æ•°é‡å¢åŠ ï¼Œæ›¿ä»£è·¯å¾„çš„é›†åˆä¹Ÿå¢åŠ ã€‚å› æ­¤ï¼Œåœ¨æ‰§è¡ŒåŠ¨æ€TEæ—¶å­˜åœ¨æ›´å¤šçš„è‡ªç”±åº¦ï¼ˆæˆ–çµæ´»æ€§ï¼‰ã€‚ 1.7 å°ç»“æ€»ä¹‹ï¼Œæ¯ä¸ªISPåœ¨å‡çº§SDNçš„æ—¶å€™éƒ½å¿…é¡»è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š ï¼ˆå‡çº§çš„èŠ‚ç‚¹æ•°é‡å’Œæ—¶é—´ï¼‰æ¯ä¸ªæ—¶æ®µè¦å‡çº§å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Ÿå®ƒåº”è¯¥å°½æ—©å‡çº§æ‰€æœ‰èŠ‚ç‚¹è¿˜æ˜¯ç­‰å¾…ä»·æ ¼ä¸‹é™åå†å‡çº§ï¼Ÿ ï¼ˆå‡çº§å“ªäº›ç‰¹å®šèŠ‚ç‚¹ï¼‰åœ¨å†³å®šè¦å‡çº§çš„èŠ‚ç‚¹æ•°é‡ä¹‹åï¼Œè¦é€‰æ‹©å“ªäº›ç‰¹å®šèŠ‚ç‚¹å…ˆè¿›è¡Œå‡çº§ï¼Ÿ å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è¿™é¡¹å·¥ä½œä¸­çš„ç›®æ ‡æ˜¯ç ”ç©¶å¤§å‹ï¼ˆæ˜‚è´µï¼‰è¿è¥ISPç½‘ç»œä¸­SDNå‡çº§è°ƒåº¦çš„ç­–ç•¥ï¼Œå¹¶ä¸»è¦å…³æ³¨æ—¶é—´ç»´åº¦çš„å½±å“ä»¥åŠæµé‡å¯ç¼–ç¨‹æ€§å’ŒTEçµæ´»æ€§ä¼˜åŠ¿ä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚ Therefore, our goal in this work is to investigate policies for SDN upgrade scheduling in large (and expensive) operational ISP networks, and focus mainly on the impact of time-dimension and the interplay between traffic programmability and TE flexibility benefits. 2ã€Methodology and Contributions2.1 ç®€ä»‹ISPå‡çº§SDNçš„æ—¶å€™éœ€è¦å…³æ³¨çš„ä¸¤ä¸ªé‡è¦å› ç´ ï¼š è‡³å°‘éå†ä¸€ä¸ªSDNèŠ‚ç‚¹çš„æµé‡æœ€å¤§åŒ–ï¼Œå› ä¸ºè¿™å…è®¸ISPæ§åˆ¶æµé‡åœ¨è‡ªå·±çš„ç½‘ç»œä¸­çš„æµåŠ¨æ–¹å¼ã€‚ First, we target the maximization of the programmable traffic, i.e., the traffic that traverses at least one SDN node (Obj1). æ—¨åœ¨æœ€å¤§åŒ–TEçš„çµæ´»æ€§ã€‚é€šè¿‡å¢åŠ é€šè¿‡SDNå‡çº§çš„å¤‡é€‰è·¯å¾„çš„æ•°é‡æ¥å®ç°è¯¥ç›®æ ‡ã€‚ The second objective (Obj2) aims to maximize the TE flexibility. 2.2 æ¬¡æ¨¡å‡½æ•°å’Œè¶…æ¨¡å‡½æ•°2.2.1 å®šä¹‰åœ¨æ•°å­¦ä¸­ï¼Œä¸€ä¸ªå‡½æ•°f:R^k^â†’Ræ˜¯è¶…æ¨¡çš„ï¼Œå½“f(xâ¬†y)+f(xâ¬‡y)â‰¥f(x)+f(y)å¯¹æ‰€æœ‰x,yâˆˆR^k^æˆç«‹ å¦‚æœ-fæ˜¯è¶…æ¨¡å‡½æ•°ï¼Œé‚£ä¹ˆfç§°ä¸ºæ¬¡æ¨¡å‡½æ•°ï¼Œå¦‚æœä¸ç­‰å¼å˜ä¸ºç›¸ç­‰ï¼Œåˆ™å‡½æ•°æ˜¯æ¨¡å—åŒ–çš„ã€‚ 2.2.2 Submodularityæ¬¡æ¨¡å‡½æ•°ï¼ˆsubmodular functionï¼‰åˆç§°â€œå­æ¨¡å‡½æ•°â€æˆ–â€œäºšæ¨¡å‡½æ•°â€ï¼Œæ¬¡æ¨¡å‡½æ•°å…·æœ‰æ¬¡æ¨¡æ€§ï¼ˆsubmodularityï¼‰ï¼Œå®ƒæ˜¯ç»æµå­¦ä¸Šè¾¹é™…æ•ˆç›Šé€’å‡ï¼ˆproperty of diminishing returnsï¼‰ç°è±¡çš„å½¢å¼åŒ–æè¿°ã€‚ ç»™å®šä¸€ä¸ªé›†åˆå‡½æ•°f:2Vâ†’R f:2^V^â†’Rï¼Œå…¶å°†æœ‰é™é›†V VVçš„ä¸€ä¸ªå­é›†SâŠ†V æ˜ å°„ä¸ºä¸€ä¸ªå®æ•°ã€‚å¦‚æœå¯¹äºä»»æ„Sï¼Œæ»¡è¶³ï¼š f(SâˆªT)+f(Sâˆ©T)â‰¤f(S)+f(T) (1) åˆ™ç§°f(â‹…) æ˜¯æ¬¡æ¨¡å‡½æ•°ã€‚ä»è¾¹é™…æ•ˆç›Šé€’å‡çš„è§’åº¦è€ƒè™‘ï¼Œæ¬¡æ¨¡å‡½æ•°è¿˜æœ‰ä¸€ç§ç­‰ä»·å®šä¹‰ï¼š å¯¹ä»»æ„çš„RâŠ†SâŠ†Vï¼Œå¹¶ä¸”sâˆˆVâˆ–Sï¼Œ f(Sâˆª{s})âˆ’f(S)â‰¤f(Râˆª{s})âˆ’f(R) (2) å…¬å¼ï¼ˆ2ï¼‰æŒ‡å‡ºï¼Œå½“é›†åˆè¶Šæ¥è¶Šå¤§ï¼Œsçš„â€œä»·å€¼â€å°†è¶Šæ¥è¶Šå°ï¼Œæ­£æ˜¯è¾¹é™…æ•ˆç›Šé€’å‡çš„ç‰¹æ€§ã€‚è¿™ä¸ªç°è±¡åœ¨è‡ªç„¶ç•Œæ™®éå­˜åœ¨ï¼Œä¾‹å¦‚ï¼šé¦™å†œç†µå‡½æ•°å°±æ˜¯éšæœºå˜é‡é›†åˆä¸Šçš„æ¬¡æ¨¡å‡½æ•°ã€‚å½“SâŠ†Tæ—¶æœ‰f(S)â‰¤f(T) f(S)ï¼Œåˆ™ç§°è¯¥æ¬¡æ¨¡å‡½æ•°æ˜¯å•è°ƒçš„ï¼ˆmonotoneï¼‰ã€‚ æ›´è¿›ä¸€æ­¥ï¼Œæ¬¡æ¨¡æ€§æ˜¯convexityï¼ˆå‡¸æ€§ï¼‰çš„ç¦»æ•£æ¨¡æ‹Ÿã€‚ç”±äºconvexityä½¿å¾—è¿ç»­å‡½æ•°æ›´å®¹æ˜“æœ€ä¼˜åŒ–ï¼Œå› è€Œæ¬¡æ¨¡æ€§åœ¨ç»„åˆä¼˜åŒ–ä¸­é‡è¦ä½œç”¨ã€‚å½“ç›®æ ‡å‡½æ•°æ˜¯æ¬¡æ¨¡å‡½æ•°æ—¶ï¼Œè®¸å¤šç»„åˆä¼˜åŒ–é—®é¢˜èƒ½å¤Ÿåœ¨å¤šé¡¹å¼æ—¶é—´å†…å¾—åˆ°æœ€ä¼˜è§£æˆ–è¿‘ä¼¼è§£ã€‚æ¬¡æ¨¡å‡½æ•°æœ€å¤§åŒ–è¢«è¯æ˜æ˜¯ä¸€ä¸ªNP-hardé—®é¢˜ï¼Œå¹¸è¿çš„æ˜¯ï¼Œå­˜åœ¨é«˜æ•ˆå¹¶ä¸”è§£çš„è´¨é‡æœ‰ä¿è¯çš„è¿‘ä¼¼ç®—æ³•ã€‚ ä¸€ä¸ªæµè¡Œçš„ç»“æœæ˜¯ï¼šæœ€å¤§åŒ–ä¸€ä¸ªå•è°ƒéè´Ÿçš„å¸¦åŸºæ•°çº¦æŸï¼ˆcardinality constraintï¼Œå³å¯¹å­é›†Så¤§å°çš„çº¦æŸï¼‰çš„æ¬¡æ¨¡å‡½æ•°ï¼Œè´ªå¿ƒç®—æ³•è‡³å°‘èƒ½å¤Ÿè¾¾åˆ°(1âˆ’1/e)f(Sopt)çš„ç»“æœï¼Œå…¶ä¸­f(Sopt)è¡¨ç¤ºé—®é¢˜çš„æœ€ä¼˜è§£ï¼Œ1âˆ’1/eå¤§çº¦æ˜¯0.63ã€‚ f(Sapp)â‰¥(1âˆ’1/e)f(Sopt) 2.3 ç›®æ ‡1åˆ†æå¯¹äºObj1ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯NP-Hardäº‹ä»¶ï¼Œè¿‘ä¼¼äºä»»ä½•ä¼˜äº1-1 / eçš„å› å­ã€‚ NPé—®é¢˜æ˜¯æŒ‡å¯ä»¥åœ¨å¤šé¡¹å¼çš„æ—¶é—´é‡ŒéªŒè¯ä¸€ä¸ªè§£çš„é—®é¢˜ã€‚ NPé—®é¢˜ï¼šå¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…è¢«éªŒè¯çš„é—®é¢˜ã€‚æˆ–è€…è¯´ï¼Œå¯ä»¥åœ¨éç¡®å®šæ€§å¤šé¡¹å¼æ—¶é—´å†…è¢«è§£å†³çš„é—®é¢˜ã€‚ å³å¯ä»¥åœ¨éç¡®å®šå‹å›¾çµæœºä¸Šåœ¨å¤šé¡¹å¼æ—¶é—´å†…æ‰¾å‡ºè§£çš„é—®é¢˜ã€‚NPé—®é¢˜å¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…è¢«éªŒè¯ï¼Œä½†æ˜¯ä¸ç¡®å®šæ˜¯å¦å¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…æ‰¾å‡ºè§£ã€‚ NPCé—®é¢˜çš„å®šä¹‰éå¸¸ç®€å•ã€‚åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶çš„é—®é¢˜å°±æ˜¯NPCé—®é¢˜ã€‚é¦–å…ˆï¼Œå®ƒå¾—æ˜¯ä¸€ä¸ªNPé—®é¢˜ï¼›ç„¶åï¼Œæ‰€æœ‰çš„NPé—®é¢˜éƒ½å¯ä»¥å½’çº¦åˆ°å®ƒã€‚ NP-Hardé—®é¢˜æ˜¯è¿™æ ·ä¸€ç§é—®é¢˜ï¼Œå®ƒæ»¡è¶³NPCé—®é¢˜å®šä¹‰çš„ç¬¬äºŒæ¡ä½†ä¸ä¸€å®šè¦æ»¡è¶³ç¬¬ä¸€æ¡ï¼ˆå°±æ˜¯è¯´ï¼ŒNP-Hardé—®é¢˜è¦æ¯”NPCé—®é¢˜çš„èŒƒå›´å¹¿ï¼‰ï¼Œæ³¨æ„æ˜¯ä¸ä¸€å®šï¼Œå¹¶ä¸æ˜¯å®Œå…¨å¦å®šã€‚NP-Hardé—®é¢˜åŒæ ·éš¾ä»¥æ‰¾åˆ°å¤šé¡¹å¼çš„ç®—æ³•ï¼Œä½†å®ƒä¸åˆ—å…¥æˆ‘ä»¬çš„ç ”ç©¶èŒƒå›´ï¼Œå› ä¸ºå®ƒä¸ä¸€å®šæ˜¯NPé—®é¢˜ã€‚å³ä½¿NPCé—®é¢˜å‘ç°äº†å¤šé¡¹å¼çº§çš„ç®—æ³•ï¼ŒNP-Hardé—®é¢˜æœ‰å¯èƒ½ä»ç„¶æ— æ³•å¾—åˆ°å¤šé¡¹å¼çº§çš„ç®—æ³•ã€‚äº‹å®ä¸Šï¼Œç”±äºNP-Hardæ”¾å®½äº†é™å®šæ¡ä»¶ï¼Œå®ƒå°†æœ‰å¯èƒ½æ¯”æ‰€æœ‰çš„NPCé—®é¢˜çš„æ—¶é—´å¤æ‚åº¦æ›´é«˜ä»è€Œæ›´éš¾ä»¥è§£å†³ã€‚ å¯¹äºæ‰€æœ‰èŠ‚ç‚¹å‡çº§å‘ç”Ÿåœ¨åŒä¸€æ—¶é—´æ®µçš„ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬å±•ç¤ºäº†ç»å…¸è´ªå©ªç®—æ³•çš„ä¿®æ”¹ç‰ˆæœ¬ï¼Œå®ƒæšä¸¾äº†æ‰€æœ‰å¯èƒ½çš„èŠ‚ç‚¹ä¸‰å…ƒç»„ä½œä¸ºå€™é€‰è§£å†³æ–¹æ¡ˆï¼Œå®ç°äº†æœ€ä½³å¯èƒ½çš„è¿‘ä¼¼ã€‚æˆ‘ä»¬è¿˜å±•ç¤ºäº†ä¸€ç§æ‰©å±•æ­¤ç®—æ³•çš„ç®€å•æ–¹æ³•ï¼Œé€‚ç”¨äºèŠ‚ç‚¹å‡çº§å¯ä»¥åœ¨ä¸åŒæ—¶é—´æ®µè¿›è¡Œçš„ä¸€èˆ¬æƒ…å†µã€‚æˆ‘ä»¬è¿˜æå‡ºäº†ç¬¬äºŒç±»æ›´å¤æ‚çš„ç®—æ³•ï¼Œå®ƒä»¬é€šè¿‡å°†Obj1è¡¨ç¤ºä¸ºæ¬¡æ¨¡å‡½æ•°[12]çš„æœ€å¤§åŒ–æ¥æ”¹è¿›è¿‘ä¼¼åº¦ï¼Œå³æ»¡è¶³é€’å‡å›å½’æ€§è´¨çš„å‡½æ•°ã€‚ In both cases, finding the upgrading policy requires the solution of challenging combinatorial optimization problems. Namely, we show that for Obj1 this problem is NP-Hard even to approximate to any factor better than 1âˆ’1/e. For the special case in which all the node upgrades take place at the same time period, we show that a modified version of a classic greedy algorithm, which enumerates all possible triplets of nodes as candidate solutions, achieves the best possible approximation ratio. We also show a simple way to extend this algorithm for the general case where the node upgrades can take place at different time periods. We also present a second class of more sophisticated algorithms with improved approximation ratios by expressing Obj1 as the maximization of a submodular set function [12], i.e., a function that satisfies the diminishing returns property. 2.4 ç›®æ ‡2åˆ†æç„¶åï¼Œæˆ‘ä»¬ç ”ç©¶Obj2ï¼ˆæœ€å¤§åŒ–TEçµæ´»æ€§ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„é—®é¢˜ï¼Œå¯ä»¥è¡¨è¾¾ä¸ºå…·æœ‰æœ‰ç•Œè¶…æ¨¡ç¨‹åº¦çš„å‡½æ•°çš„æœ€å¤§åŒ–[13]ã€‚ä½¿ç”¨æ­¤ç»“æœï¼Œæˆ‘ä»¬æå‡ºäº†å¦ä¸€ç§åŸºäºè´ªå©ªçš„ç®—æ³•ï¼Œè¯¥ç®—æ³•å¤§è‡´è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¸ºäº†å®Œæ•´èµ·è§ï¼Œæˆ‘ä»¬è¿˜è€ƒè™‘å‡çº§é—®é¢˜ï¼ˆObj3ï¼‰çš„â€œåŒé‡â€ç‰ˆæœ¬ï¼Œå…¶ä¸­ä¸Šè¿°ç›®æ ‡è¢«è§†ä¸ºçº¦æŸå¹¶å—å…¶çº¦æŸï¼Œæˆ‘ä»¬å°†è¿ç§»æˆæœ¬é™è‡³æœ€ä½ã€‚å¯¹äºç®€å•ä½†å®ç”¨çš„æƒ…å†µï¼Œä½¿ç”¨äºŒåˆ†æœç´¢æŠ€æœ¯æå‡ºäº†è¿‘ä¼¼ç®—æ³•ã€‚ Then, we study Obj2 (maximizing TE flexibility). This is a more complex problem which can be expressed as the maximization of a function with bounded supermodular degree [13]. Using this result, we present another greedy-based algorithm that approximately solves this problem. For the sake of completeness, we also consider the â€œdualâ€ version of the upgrading problem (Obj3), where the above objectives are treated as constraints and subject to them we minimize migration costs. For a simple, yet practical, case an approximation algorithm is proposed using a binary search technique. 3ã€MODEL AND PROBLEM FORMULATION3.1 SDNå‡çº§é—®é¢˜ï¼ˆSDN Upgrading Problemï¼‰æˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨é€šç”¨çš„æˆæœ¬æ¨¡å‹å’Œä¸åŒçš„ç›®æ ‡ï¼Œé€æ­¥ï¼ˆéƒ¨åˆ†ï¼‰å°†ISPç½‘ç»œå‡çº§åˆ°SDNçš„é—®é¢˜ã€‚å‡çº§å¯ä»¥åœ¨ä¸åŒçš„æ—¶é—´æ®µè¿›è¡Œï¼Œåœ¨æ¯ä¸ªæ—¶æœŸå¼•å…¥ä¸åŒçš„æˆæœ¬ï¼ŒæŠ€æœ¯æˆç†Ÿåº¦ï¼Œç½‘ç»œè®¾å¤‡çš„ä¸åŒç”Ÿå‘½å‘¨æœŸå’Œå…¶ä»–å®é™…é™åˆ¶ã€‚ 3.2 æœ€å¤§åŒ–å¯ç¼–ç¨‹æµé‡ï¼ˆObj1ï¼‰ï¼ˆMaximizing Programmable Traffic (Obj1)ï¼‰å¯ç¼–ç¨‹æµé‡æœ€å¤§åŒ–ç›®æ ‡ï¼Œæˆ‘ä»¬è¡¨æ˜SDNå‡çº§é—®é¢˜æ˜¯NP-Hardæ¥è¿‘ä»»ä½•ä¼˜äº1-1 / eçš„å› ç´ ã€‚ç„¶åï¼Œé’ˆå¯¹ä¸€ä¸ªæ—¶é—´æ®µçš„ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬æå‡ºäº†åŒ¹é…è¯¥å› å­çš„ç®€å•ç®—æ³•ï¼Œå¹¶è¯´æ˜äº†å¦‚ä½•åœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œæ‰©å±•ã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨å­æ¨¡å‡½æ•°ç†è®ºæå‡ºäº†æ›´å¤šæ›´å¤æ‚çš„è¿‘ä¼¼ç®—æ³•ã€‚ 3.3 æœ€å¤§åŒ–TEçµæ´»æ€§ï¼ˆObj2ï¼‰ï¼ˆMaximizing TE Flexibility (Obj2)ï¼‰ä¸ºäº†é€šè¿‡æ”¯æŒSDNçš„è·¯ç”±è·¯å¾„çš„æœ€å¤§åŒ–æ¥æœ€å¤§åŒ–TEçµæ´»æ€§ï¼Œæˆ‘ä»¬è¡¨æ˜ä¼˜åŒ–é—®é¢˜æ›´å¤æ‚ã€‚æˆ‘ä»¬é€šè¿‡å°†å…¶è¡¨ç¤ºä¸ºå…·æœ‰æœ‰ç•Œè¶…æ¨¡å‡½æ•°çš„æœ€å¤§åŒ–æ¥æå‡ºè¿‘ä¼¼ç®—æ³•ã€‚ 3.4 æœ€å°åŒ–è¿ç§»æˆæœ¬ï¼ˆObj3ï¼‰ï¼ˆMinimizing migration costs (Obj3)ï¼‰å¯¹äºæœ€å°åŒ–è¿ç§»æˆæœ¬çš„â€œåŒé‡â€é—®é¢˜ï¼Œæˆ‘ä»¬è¡¨æ˜å®ƒä¸ä¸Šè¿°é—®é¢˜åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨äºŒå…ƒæœç´¢æŠ€æœ¯è¿›è¡Œè¿‘ä¼¼ç®—æ³•ã€‚ 3.5 æ•°æ®é›†é©±åŠ¨è¯„ä¼°ï¼ˆDataset-driven Evaluationï¼‰æˆ‘ä»¬ä½¿ç”¨çœŸå®ç½‘ç»œæ‹“æ‰‘å’Œæµé‡çŸ©é˜µè¯„ä¼°æå‡ºçš„ç®—æ³•ã€‚æˆ‘ä»¬å‘ç°ï¼Œä¸å®é™…åœºæ™¯ä¸­çš„ä¸¤ç§æœ€å…ˆè¿›çš„æ–¹æ³•ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥å°†å¯ç¼–ç¨‹æµé‡çš„æ•°é‡å¢åŠ 54ï¼…ã€‚æˆ‘ä»¬è¿˜å‘ç°ï¼Œé€šè¿‡ä¼˜åŒ–Obj1ï¼Œå¯¹Obj2è¿›è¡Œäº†å¤šæ–¹é¢çš„å¥½å¤„ï¼ˆåä¹‹äº¦ç„¶ï¼‰ï¼Œæˆ‘ä»¬æ¢ç´¢äº†å®ƒä»¬ä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚è¿™ä¸¤ä¸ªç›®æ ‡ã€‚æœ€åï¼Œæˆ‘ä»¬å±•ç¤ºäº†æˆ‘ä»¬æå‡ºçš„Obj3ç®—æ³•å¯ä»¥èŠ‚çº¦é«˜è¾¾2.5å€çš„æˆæœ¬ï¼Œä»¥ç¡®ä¿æ€§èƒ½ç›®æ ‡è¶…è¶Šå…¶ä»–æœ€å…ˆè¿›çš„æ–¹æ³•ã€‚ 3.6 ç¤ºä¾‹ åœ¨ä¼ ç»Ÿçš„IPåè®®ä¸‹ï¼Œå¦‚OSPFï¼Œæµé‡æ€»æ˜¯éµå¾ªæœ€çŸ­è·¯å¾„çš„åŸåˆ™åˆ°è¾¾ç›®çš„åœ°å€ï¼Œä½¿ç”¨æ›´é«˜çº§çš„åè®®ï¼Œå¦‚MPLSï¼Œæµé‡åˆ™å¯ä»¥éµå¾ªå…¶ä»–çš„è‡ªå®šä¹‰åŸåˆ™ä¸èµ°æœ€çŸ­çš„è·¯å¾„ã€‚ 4ã€Dataset-driven Evaluationä¸€èˆ¬è€Œè¨€ï¼ŒISPé€šè¿‡å°†å‡çº§æ‰©å±•åˆ°è®¸å¤šè€Œä¸æ˜¯ä¸€å¹´æ¥è·å¾—æ›´å¤šå¥½å¤„ã€‚ç„¶è€Œï¼Œå½“SDNæˆæœ¬éšæ—¶é—´ç›¸å¯¹ç¨³å®šï¼ˆæ¯å¹´ä¸‹é™é«˜è¾¾20ï¼…ï¼‰æ—¶ï¼Œè¿™ç§ç­–ç•¥å¯èƒ½æ˜¯æœ‰å®³çš„ã€‚ æˆ‘ä»¬è¿˜æŒ‡å‡ºï¼Œé€šè¿‡ä¼˜åŒ–å¯ç¼–ç¨‹æµé‡æœ€å¤§åŒ–çš„ç›®æ ‡ï¼Œä¹Ÿå¯ä»¥å®ç°æœ€å¤§åŒ–çµæ´»æ€§æœ€å¤§åŒ–çš„ç›®æ ‡ï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚ç„¶è€Œï¼Œç”±äºæ¯ä¸ªç®—æ³•æ”¯æŒä¸€ä¸ªç›®æ ‡è€Œä¸æ˜¯å¦ä¸€ä¸ªç›®æ ‡ï¼Œå› æ­¤ä¼šæœ‰æ€§èƒ½æŸå¤±ï¼ˆé«˜è¾¾2å€ï¼‰ã€‚ In general, the ISP acquires more benefits by spreading the upgrades over many instead of one year. Nevertheless, this strategy can be detrimental when the SDN costs are relatively stable over time (up to 20% drop per year). However, there will be a performance loss (up to a factor of 2), since each algorithm favors one objective over the other. 5ã€æ¶‰åŠç®—æ³•5.1 DEGæ­¤æ–¹æ¡ˆåœ¨æ‹“æ‰‘å›¾ä¸­å‡çº§å…·æœ‰æœ€é«˜åº¦æ•°ï¼ˆä¼ å…¥å’Œä¼ å‡ºçš„ç›¸é‚»é“¾æ¥æ•°ï¼‰çš„èŠ‚ç‚¹ï¼Œç›´åˆ°æ‰€æœ‰é¢„ç®—ç”¨å®Œã€‚æ‰€æœ‰å‡çº§éƒ½åœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œã€‚ 5.2 VOLæ­¤æ–¹æ¡ˆå‡çº§å…·æœ‰æœ€é«˜æµé‡çš„èŠ‚ç‚¹ï¼Œç›´åˆ°æ‰€æœ‰é¢„ç®—ç”¨å®Œã€‚æ‰€æœ‰å‡çº§éƒ½åœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œã€‚ 5.3 Modified-greedyæ­¤æ–¹æ¡ˆä½¿ç”¨ç®—æ³•1è¿›è¡Œåˆ†æ—¶é—´æ®µå‡çº§ã€‚ 5.4 Local searchæ­¤æ–¹æ¡ˆä½¿ç”¨ç®—æ³•2è¿›è¡Œåˆ†æ—¶é—´æ®µå‡çº§ã€‚å…¶ä¸­å˜é‡eä¸º2 5.5 Super greedyæ­¤æ–¹æ¡ˆä½¿ç”¨ç®—æ³•3è¿›è¡ŒTEçµæ´»æ€§æœ€å¤§åŒ–ã€‚ 5.6 MUcPFæ­¤æ–¹æ¡ˆå‡çº§è¦†ç›–æœ€å¤§æµé‡çš„èŠ‚ç‚¹ï¼Œç›´åˆ°æ»¡è¶³æœ€å°å¯ç¼–ç¨‹æµé‡ç›®æ ‡ã€‚æ‰€æœ‰å‡çº§éƒ½åœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œã€‚ This scheme upgrades the node that covers the maximum number of flows until the minimum programmable traffic target is met. All the upgrades take place at the first time period. 5.7 Highest ratioè¯¥æ–¹æ¡ˆå‡çº§å…·æœ‰æœ€é«˜æµé‡æ¯”ç‡çš„èŠ‚ç‚¹ï¼Œä½¿å…¶è¶…è¿‡æˆæœ¬ï¼Œç›´åˆ°æ»¡è¶³æœ€å°å¯ç¼–ç¨‹æµé‡ç›®æ ‡ã€‚æ‰€æœ‰å‡çº§éƒ½åœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œ This scheme upgrades the node with the highest ratio of traffic volume that traverses it over upgrading cost, until the minimum programmable traffic target is met. All the upgrades take place at the first time period. 5.8 Binary searchå˜é‡e= 0.1ï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°é™ä½å‡çº§æˆæœ¬ã€‚æ‰€æœ‰å‡çº§éƒ½åœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œã€‚ ä¸Šè¿°å‰å››ç§ç®—æ³•å°†æ ¹æ®ç‰¹å®šé¢„ç®—Bå¯¹Obj1è¿›è¡Œæ¯”è¾ƒã€‚å°†æ ¹æ®ç›¸åŒé¢„ç®—å¯¹Obj2è¯„ä¼°æ·¡åŒ–ç®—æ³•ã€‚æœ€åï¼Œæœ€åä¸‰ä¸ªç®—æ³•å°†é’ˆå¯¹Obj3è¿›è¡Œæ¯”è¾ƒï¼Œå…·ä½“å–å†³äºç‰¹å®šçš„æ€§èƒ½ç›®æ ‡Ptã€‚ 6ã€ç½‘ç»œæ‹“æ‰‘è¯„ä¼°çš„ä¸»è¦éƒ¨åˆ†æ˜¯ä½¿ç”¨ä»åŒ—ç¾çš„æ•™è‚²éª¨å¹²ç½‘ç»œè·å¾—çš„â€œè‰¾åˆ©æ£®â€æ•°æ®é›†[14]è¿›è¡Œçš„ã€‚è¯¥ç½‘ç»œç”±12ä¸ªèŠ‚ç‚¹å’Œ30ä¸ªæœ‰å‘é“¾è·¯ç»„æˆï¼Œå¦‚å›¾3æ‰€ç¤ºã€‚æ•°æ®é›†è®°å½•æµé‡çŸ©é˜µï¼Œå³æ¯å¯¹èŠ‚ç‚¹ä¹‹é—´ä¼ è¾“çš„æ•°æ®ï¼Œæ¯5åˆ†é’Ÿä¼ è¾“ä¸€ä¸ªå…­ä¸ªæœˆçš„æ•´ä¸ªå‘¨æœŸã€‚ æ‰€æœ‰æµé‡èšåˆä¹‹åæœ€å¤§å¯è¾¾5.46Gbpsï¼Œå¹¶è®¾å®šæ¯å¹´å¢é•¿22%ã€‚åŒæ—¶ä½¿ç”¨OSPFè®°å½•é“¾æ¥ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ã€‚ 7ã€ç»“æœåˆ†æ7.1 ä¸€æ¬¡å‡çº§æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œç”±äºAbileneç½‘ç»œç›¸å½“å°ï¼ˆN = 12ä¸ªèŠ‚ç‚¹ï¼‰å’ŒT = 1ä¸ªæ—¶é—´æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ç©·ä¸¾æœç´¢æ–¹æ³•åœ¨åˆç†çš„æ—¶é—´å†…è®¡ç®—å‡ºæœ€ä¼˜è§£ã€‚è¿™æ˜¯é€šè¿‡æšä¸¾æ‰€æœ‰2^12^ = 4,096ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œç„¶åé€‰æ‹©äº§ç”Ÿæœ€å¤§å¯ç¼–ç¨‹æµé‡çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æ‰§è¡Œæ­¤è¿‡ç¨‹ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°Modified greedyå’ŒLocal searchç®—æ³•éå¸¸æ¥è¿‘æœ€ä¼˜ï¼ˆå›¾ï¼ˆaï¼‰ä¸­çš„åœºæ™¯å°äº1ï¼…ï¼‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•åº”ç”¨è¯¦å°½çš„æœç´¢æ–¹æ³•æ¥æ‰¾åˆ°æ›´å¤§æˆ–æ›´å¤§ç½‘ç»œçš„æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚ 7.2 åˆ†æ®µå‡çº§ç„¶åæˆ‘ä»¬æ¢è®¨äº†å›¾ï¼ˆbï¼‰ä¸­æ—¶é—´æ®µæ•°çš„å½±å“ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¿æŒB = $ 200Kï¼Œä½†Tè®¾å®šä¸ºä»1åˆ°5ã€‚ ä¸ºäº†æ•è·æŠ€æœ¯æˆç†Ÿåº¦ï¼Œæˆ‘ä»¬å°†SDNå‡çº§æˆæœ¬æ¯å¹´é™ä½40ï¼…ï¼Œ å½“T = 1ï¼Œç»“æœä¸å›¾ï¼ˆaï¼‰ç›¸åŒ¹é…ã€‚ å½“T&gt; 1ï¼Œé€šè¿‡æ¨è¿Ÿä¸€äº›å‡çº§åçš„æˆæœ¬å°†ä¼šé™ä½ï¼Œå¯ä»¥è·å¾—é¢å¤–çš„å¥½å¤„ã€‚ Local searchç®—æ³•å¯ä»¥é€šè¿‡åˆ†æ—¶é—´æ®µé€æ¸å‡çº§ï¼Œä»¥å®ç°å››ç§ç®—æ³•ä¸­çš„æœ€ä½³æ€§èƒ½ã€‚ æœ€å¥½çš„æƒ…å†µä¸‹ï¼ˆT=5ï¼‰æ¯”Local searchç®—æ³•æ¯”æœ€å·®çš„VOLè¦é«˜47%ä¸”æ¯”ç¬¬äºŒé«˜çš„Modified greedyé«˜5.5ï¼… 7.3 ä¸€æ¬¡å‡çº§å’Œåˆ†æ®µå‡çº§åœ¨å›¾ï¼ˆcï¼‰ä¸­ï¼Œæˆ‘ä»¬ä»”ç»†ç ”ç©¶äº†ä½¿ç”¨Local searchç®—æ³•æ—¶å¤šå¹´æ¥çš„å‡çº§åˆ†å¸ƒã€‚æˆ‘ä»¬è¯„ä¼°äº†å„ç§æƒ…æ™¯ï¼Œè¿™äº›æƒ…æ™¯ä¸å‡çº§æˆæœ¬çš„å¹´é™ä½ç‡ä¸åŒã€‚æˆ‘ä»¬å‘ç°ï¼Œå¯¹äºç›¸å¯¹è¾ƒä½çš„æˆæœ¬é™ä½ç‡ï¼ˆé«˜è¾¾20ï¼…ï¼‰ï¼Œæ‰€æœ‰å‡çº§éƒ½åº”åœ¨ç¬¬ä¸€å¹´å†…å®Œæˆã€‚ä½†æ˜¯ï¼Œåœ¨æ­¤ä¹‹åï¼Œå°†æ¥æ¨è¿Ÿä¸€äº›å‡çº§æ›´æœ‰åˆ©ã€‚éšç€æˆæœ¬é™ä½çš„é€Ÿåº¦å¢åŠ ï¼Œåˆ†æ—¶é—´æ®µè¿›è¡Œå‡çº§ã€‚ 7.4 Obj1å’ŒObj2ç›¸äº’å…³ç³»ç„¶åæ¢è®¨çš„æ˜¯traffic programmability (Obj1) å’ŒTE flexibility benefits (Obj2)çš„ç›¸äº’å…³ç³»ã€‚ Local searchå®é™…ä¸Šæ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„ç®—æ³•ï¼Œå¯ä»¥æœ€å¤§åŒ–å¯ç¼–ç¨‹æµé‡ã€‚ä½†æ˜¯ï¼Œå¤§é‡çš„å¯ç¼–ç¨‹æµé‡ä¸èƒ½ä¿è¯è‡ªå·±æœ‰å¤§é‡çš„å¤‡ç”¨è·¯ç”±è·¯å¾„ã€‚ å›¾ï¼ˆaï¼‰æ—¨åœ¨é€šè¿‡æ¯”è¾ƒLocal search algorithmï¼ˆä¼˜åŒ–å¯ç¼–ç¨‹æµé‡ï¼‰å’ŒSuper-greedyï¼ˆä¼˜åŒ–TEçµæ´»æ€§ï¼‰çš„æ€§èƒ½æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ åœ¨è¿™é‡Œï¼Œä¸ºäº†æ¨¡æ‹ŸTE flexibility benefits (Obj2)ï¼Œæˆ‘ä»¬å…³æ³¨å…·æœ‰æœ€é«˜é€Ÿç‡çš„10ä¸ªFlowï¼Œå…¶ä¸­TEæ˜¯æœ€é‡è¦çš„ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æ¯ä¸ªæµçš„ç¬¬äºŒå’Œç¬¬ä¸‰æœ€çŸ­è·¯å¾„è§†ä¸ºæ›¿ä»£è·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸ä¸æœ€çŸ­è·¯å¾„ï¼ˆPfsetsï¼‰é‡å ã€‚ æˆ‘ä»¬å‘ç°é€šè¿‡ä¼˜åŒ–å…¶ä¸­ä¸€ä¸ªç›®æ ‡ï¼Œä¹Ÿå¯ä»¥ä¸ºå¦ä¸€ä¸ªç›®æ ‡å®ç°æ”¶ç›Šã€‚ç„¶è€Œï¼Œç”±äºæ¯ç§ç®—æ³•éƒ½åå‘äºå¦ä¸€ç§ç›®æ ‡ï¼Œå› æ­¤ä¼šæœ‰æ€§èƒ½æŸå¤±ï¼ˆé«˜è¾¾2å€ï¼‰ã€‚ 7.5 Obj3æˆ‘ä»¬è¿˜æå‡ºäº†Obj3çš„è¯„ä¼°ç»“æœï¼Œä»¥ç ”ç©¶æ‰€æå‡ºçš„ç®—æ³•ï¼ˆBinary searchï¼‰å¦‚ä½•ä¸æœ€å…ˆè¿›çš„æ–¹æ³•ï¼ˆMUcPFå’ŒHighest ratioï¼‰è¿›è¡Œæ¯”è¾ƒã€‚ æˆ‘ä»¬å°†è¿™ä¸€æ—¶é—´æ®µä¸Ptçš„ä¸åŒå€¼è¿›è¡Œæ¯”è¾ƒã€‚ç»“æœå¦‚å›¾ï¼ˆbï¼‰æ‰€ç¤ºã€‚ 7.6 ä½¿ç”¨æ›´å¤§å‹ç½‘ç»œè™½ç„¶åœ¨æˆ‘ä»¬çš„è¯„ä¼°ä¸­æˆ‘ä»¬ä½¿ç”¨äº†çœŸå®çš„ç½‘ç»œæ‹“æ‰‘å’Œæµé‡çŸ©é˜µï¼Œä½†ç ”ç©¶å¤§å‹ç½‘ç»œä¸­çš„ç»“æœä¹Ÿå¾ˆæœ‰æ„æ€ã€‚ ä¸ºå®ç°è¿™ä¸€ç›®æ ‡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åŒ—ç¾Deltacoméª¨å¹²ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„ï¼Œè¯¥ç½‘ç»œç”±113ä¸ªèŠ‚ç‚¹å’Œ161ä¸ªé“¾è·¯ç»„æˆï¼Œå¹¶ä¸”åœ¨[15]ä¸­å¯åœ¨çº¿å…¬å¼€ã€‚ ç”±äºæ²¡æœ‰å…³äºæµé‡çš„å¯ç”¨ä¿¡æ¯ï¼Œæˆ‘ä»¬äººä¸ºåœ°ç”Ÿæˆæ­¤ä¿¡æ¯ã€‚ ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨éšæœºåŸå§‹ - ç›®çš„åœ°å¯¹ç»Ÿä¸€é€‰æ‹©æ¥åˆ›å»ºF = 1,000flowã€‚ æˆ‘ä»¬æ ¹æ®è·³æ•°é•¿åº¦è®¡ç®—æœ€çŸ­è·¯å¾„ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†æµé€Ÿè®¾ç½®ä¸ºä¸å®ƒæˆæ¯”ä¾‹ï¼ˆéµå¾ªé‡åŠ›æ¨¡å‹[36]ï¼‰ã€‚ åœ¨å›¾ä¸­ï¼Œæˆ‘ä»¬é‡å¤7.1ä¸­æ‰€ç¤ºçš„å®éªŒï¼Œä½†å¯¹äºè¿™ä¸ªæ›´å¤§çš„ç½‘ç»œã€‚æˆ‘ä»¬å‘ç°æ‰€æå‡ºçš„ç®—æ³•æ¯”å…¶å¯¹åº”çš„ç®—æ³•æ‰§è¡Œå¾—æ›´å¥½ã€‚ é¥±å’Œç‚¹ä¸ºB = $ 3Mï¼Œå¤§çº¦æ˜¯å°å‹ç½‘ç»œçš„ä¸‰å€ã€‚ æˆ‘ä»¬å°†è¿™ç§å·®å¼‚å½’å› äºDeltacomç½‘ç»œä¸­è¾ƒå¤§çš„èŠ‚ç‚¹æ•°ï¼ˆ10xï¼‰å’Œæ‹“æ‰‘ç‰¹å¾ï¼Œå› ä¸ºDeltacomå…·æœ‰æ›´é«˜çš„é“¾è·¯å¯†åº¦ï¼Œå¯ä»¥å®ç°SDNèŠ‚ç‚¹è¦†ç›–æ›´å¤šçš„æµé‡ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"},{"name":"sdn","slug":"sdn","permalink":"https://tinychen.com/tags/sdn/"}]},{"title":"CentOS7å®‰è£…MariaDB","slug":"20190521-centos-install-mariadb","date":"2019-05-21T07:00:00.000Z","updated":"2019-05-21T07:00:00.000Z","comments":true,"path":"20190521-centos-install-mariadb/","link":"","permalink":"https://tinychen.com/20190521-centos-install-mariadb/","excerpt":"ä¸»è¦æ˜¯åœ¨CentOS7ä¸Šå®‰è£…MariaDBæœåŠ¡ã€‚","text":"ä¸»è¦æ˜¯åœ¨CentOS7ä¸Šå®‰è£…MariaDBæœåŠ¡ã€‚ 1ã€ä¸ºä»€ä¹ˆæ¢ç”¨MariaDBï¼Ÿä¹‹å‰å†™è¿‡ä¸€ç¯‡æ•™ç¨‹æ˜¯æŠŠå†…ç½®çš„MariaDBå¸è½½ç„¶åæ¢ç”¨MySQLï¼Œæœ€è¿‘å› ä¸ºMySQLä¸æ”¯æŒCheckå­å¥ï¼Œè¿˜æœ‰ä¸€æ¬¡æ’å…¥å¤šæ¡æ•°æ®ä¹Ÿä¸è¡Œï¼Œåæ­£å°±æ˜¯æƒ³ç”¨ä¸€ä¸‹MariaDBï¼Œå°±åˆæ¢å›æ¥äº†ã€‚ 2ã€å¸è½½MySQLæ³¨æ„ï¼Œåœ¨å¸è½½MySQLä¹‹å‰è¯·å…ˆä½¿ç”¨dumpå‘½ä»¤å¤‡ä»½æ•°æ®åº“ã€‚ 12# æŸ¥çœ‹ç³»ç»Ÿä¸­å®‰è£…çš„MySQLæœåŠ¡rpm -qa | grep mysql 1234# ä½¿ç”¨rpmå¸è½½æ‰å¯¹åº”çš„ç»„ä»¶rpm -e &lt;packege&gt;# å¦‚æœå‡ºç°æç¤ºä¾èµ–çš„é—®é¢˜ï¼ŒåŠ ä¸Š--nodepsrpm -e --nodeps &lt;packege&gt; 3ã€æ–°å»ºyumæºMariaDBçš„yumå®‰è£…å®˜ç½‘é“¾æ¥ï¼š http://yum.mariadb.org/ è¿›å»å¯ä»¥çœ‹åˆ°ç›®å‰æœ€æ–°çš„åº”è¯¥æ˜¯10.4.5ç‰ˆæœ¬ï¼Œäºæ˜¯æˆ‘ä»¬å°±åœ¨/etc/yum.repos.dç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ªyumæºæ–‡ä»¶ã€‚ 1vim /etc/yum.repos.d/MariaDB.repo åœ¨repoæ–‡ä»¶ä¸­å†™å…¥ä¸‹åˆ—å†…å®¹ï¼Œæ³¨æ„baseurlå¯ä»¥æ ¹æ®ç‰ˆæœ¬çš„æ›´æ–°è€Œæ”¹å˜ã€‚ 12345[MariaDB]name = MariaDBbaseurl = http://yum.mariadb.org/10.4.5/centos7-amd64/gpgkey = http://yum.mariadb.org/RPM-GPG-KEY-MariaDBgpgcheck = 1 12# è¾“å…¥ä¸‹åˆ—å‘½ä»¤æ¸…é™¤å¹¶æ›´æ–°yumæºyum clean all -v 4ã€å®‰è£…MariaDB12# æŸ¥çœ‹yumæºä¸­çš„Mariaï¼Œæ³¨æ„å­—æ¯çš„å¤§å°å†™è¦å’Œä¸Šé¢å†™çš„yumæºæ–‡ä»¶ä¸€æ ·yum list | grep Maria è¿™é‡Œåº”è¯¥æ˜¯10.4.5ï¼Œå°±è¯´æ˜æ˜¯ä¹‹å‰æˆ‘ä»¬å†™çš„yumæºã€‚ 12# è¾“å…¥ä¸‹é¢è¿™æ¡æŒ‡ä»¤è¿›è¡Œå®‰è£…MariaDBï¼Œæ³¨æ„ä¸è¦åŠ -yé€‰é¡¹ï¼Œå…ˆç¡®å®šä¸€ä¸‹ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®yum install MariaDB ç¡®å®šç‰ˆæœ¬æ— è¯¯åï¼ŒæŒ‰yç¡®å®šå®‰è£…ã€‚ 12345# è®¾ç½®å¼€æœºå¯åŠ¨systemctl enable mariadb# å¼€å¯mariadbæœåŠ¡systemctl start mariadb 12# æŸ¥çœ‹å®‰è£…åçš„mysqlç‰ˆæœ¬mysql --version è¿™é‡Œå¯ä»¥çœ‹åˆ°MariaDBï¼Œä½¿ç”¨çš„æ–¹æ³•è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œè´¦å·ä¹Ÿè¿˜æ˜¯ä¹‹å‰çš„Mysqlçš„è´¦å·ã€‚ 5ã€å®‰è£…è¿‡ç¨‹çš„ä¸€äº›æ„å¤–å°ä¸ƒåœ¨å®‰è£…çš„æ—¶å€™ï¼Œå¯åŠ¨çš„è¿‡ç¨‹ä¸­å‡ºç°äº†æŠ¥é”™ã€‚ è™½ç„¶ä½¿ç”¨systemctlå¯ä»¥æˆåŠŸå¼€å¯æœåŠ¡ï¼Œä½†æ˜¯æ— æ³•é¡ºåˆ©ç™»å½•è¿›å» ä½¿ç”¨-lå‚æ•°æŸ¥çœ‹è¯¦ç»†çŠ¶æ€ çœ‹åˆ°è¿™é‡Œæœ‰ä¸¤ä¸ªERRORï¼Œå†æŒ‰ç…§æç¤ºè¾“å…¥ä¸‹åˆ—å‘½ä»¤å‡çº§mysqlå³å¯ 1mysql_upgrade -u root -p æŠ¥é”™çš„åŸå› åº”è¯¥æ˜¯å› ä¸ºmysqlæ¢ä¸ºmariadbä¹‹åé…ç½®ä¿¡æ¯çš„é“¾æ¥æ²¡æœ‰åŠæ—¶æ›´æ–°å¯¼è‡´æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œå› æ­¤éœ€è¦upgradeã€‚","categories":[{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"mysql","slug":"mysql","permalink":"https://tinychen.com/tags/mysql/"},{"name":"database","slug":"database","permalink":"https://tinychen.com/tags/database/"}]},{"title":"CentOSé…ç½®Python3å¼€å‘ç¯å¢ƒ","slug":"20190413-centos-install-python","date":"2019-04-13T07:00:00.000Z","updated":"2019-04-13T07:00:00.000Z","comments":true,"path":"20190413-centos-install-python/","link":"","permalink":"https://tinychen.com/20190413-centos-install-python/","excerpt":"CentOS7é…ç½®Python3.7å¼€å‘ç¯å¢ƒ","text":"CentOS7é…ç½®Python3.7å¼€å‘ç¯å¢ƒ 1ã€ä¸‹è½½Python312345wget https://www.python.org/ftp/python/3.7.3/Python-3.7.3.tgz# ä½¿ç”¨wgetå‘½ä»¤ä¸‹è½½å®˜ç½‘çš„tgzå®‰è£…åŒ…tar -zxvf Python-3.7.3.tgz# ä½¿ç”¨tarå‘½ä»¤è§£å‹å®‰è£…åŒ… 2ã€å®‰è£…ç›¸å…³å·¥å…·12345678yum install -y gcc# å®‰è£…gccç¼–è¯‘å™¨yum -y groupinstall &quot;Development tools&quot;yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel libffi-devel# å®‰è£…ç›¸å¯¹åº”çš„æ’ä»¶ 3ã€ç¼–è¯‘å®‰è£…Python1234567891011121314151617mkdir /usr/local/python3# åˆ›å»ºç›®å½•ç»™python3cd Python-3.7.3/# è¿›å…¥åˆšåˆšè§£å‹çš„pythonå®‰è£…åŒ…ç›®å½•é‡Œé¢./configure --prefix=/usr/local/python3# ç”Ÿæˆmakefileæ–‡ä»¶ï¼Œè¿™é‡Œçš„å®‰è£…ç›®å½•è¦è®¾ç½®ä¸ºåˆšåˆšè‡ªå·±æ–°å»ºçš„ç›®å½•make# ä½¿ç”¨makeå‘½ä»¤ç¼–è¯‘ä¸€æ³¢make test# æ£€æŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰é”™è¯¯make install# è¿›è¡Œå®‰è£… çœ‹åˆ°è¿™ä¸ªå°±ç®—å®‰è£…æˆåŠŸå•¦ã€‚ 4ã€åˆ›å»ºè½¯è¿æ¥123ln -s /usr/local/python3/bin/python3.7 /usr/bin/python3ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3 5ã€ä¿®æ”¹é»˜è®¤ç‰ˆæœ¬pythonå’Œyumç”±äºè¿™æ—¶å€™é»˜è®¤çš„pythonè¿˜æ˜¯ä¹‹å‰å†…ç½®çš„2.xç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸‹ 12345rm /usr/bin/python# åˆ é™¤ä¹‹å‰çš„python2çš„è½¯è¿æ¥ln -s /usr/local/python3/bin/python3.7 /usr/bin/python# æ–°å»ºä¸€ä¸ªè½¯è¿æ¥åˆ°python ç”±äºyumé»˜è®¤ä½¿ç”¨çš„æ˜¯python2ï¼Œè¿™ä¸ªæ—¶å€™ä¿®æ”¹äº†è‚¯å®šå°±æ— æ³•è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦æŠŠyumçš„é…ç½®æ–‡ä»¶ä¹Ÿä¿®æ”¹ä¸€ä¸‹ 12ll /usr/bin/ | grep python# é¦–å…ˆæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹pythonçš„å®‰è£…æƒ…å†µ ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™å°ç”µè„‘å®‰è£…äº†python2.7å’Œpython3.7ï¼Œé»˜è®¤çš„pythonæ˜¯æŒ‡å‘3.7çš„ã€‚ 12vim /usr/bin/yum# æŠŠç¬¬ä¸€è¡Œçš„pythonæ”¹æˆå¯¹åº”çš„ç‰ˆæœ¬ï¼Œå›¾ç¤ºä¸ºpython2.7 12vim /usr/libexec/urlgrabber-ext-down# è¿™é‡Œæ“ä½œä¹Ÿå’Œä¸Šé¢çš„ä¸€æ · æœ€ååˆ†åˆ«è¾“å…¥yumï¼Œpythonï¼Œpython2ï¼Œpython3ï¼Œpipç­‰å‘½ä»¤æ£€æŸ¥ä¸€ä¸‹ æ³¨æ„è¿™é‡Œçš„Væ˜¯å¤§å†™å“¦ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"},{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"python","slug":"python","permalink":"https://tinychen.com/tags/python/"}]},{"title":"SSHè¿œç¨‹è¿æ¥Linuxä¸»æœºè¶…æ—¶è‡ªåŠ¨æ–­å¼€","slug":"20190411-fix-ssh-disconnect","date":"2019-04-11T07:00:00.000Z","updated":"2019-04-11T07:00:00.000Z","comments":true,"path":"20190411-fix-ssh-disconnect/","link":"","permalink":"https://tinychen.com/20190411-fix-ssh-disconnect/","excerpt":"ä½¿ç”¨SSHè¿œç¨‹è¿æ¥Linuxä¸»æœºçš„æ—¶å€™ï¼Œä¼šå› ä¸ºä¸€æ®µæ—¶é—´æ²¡æœ‰æ‰§è¡Œæ“ä½œï¼Œå°±å’Œä¸»æœºæ–­å¼€è¿æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ä¸»æœºç«¯çš„SSHDé…ç½®æ–‡ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚","text":"ä½¿ç”¨SSHè¿œç¨‹è¿æ¥Linuxä¸»æœºçš„æ—¶å€™ï¼Œä¼šå› ä¸ºä¸€æ®µæ—¶é—´æ²¡æœ‰æ‰§è¡Œæ“ä½œï¼Œå°±å’Œä¸»æœºæ–­å¼€è¿æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ä¸»æœºç«¯çš„SSHDé…ç½®æ–‡ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 12vim /etc/ssh/sshd_config# ç¼–è¾‘sshdçš„é…ç½®æ–‡ä»¶ åœ¨å¤§æ¦‚ä¸€ç™¾å¤šè¡Œçš„ä½ç½®æ‰¾åˆ°è¿™ä¸‰ä¸ªå‚æ•°ï¼Œå–æ¶ˆæ‰æ³¨é‡Š TCPKeepAliveæ˜¯ä¿å­˜TCPè¿æ¥å­˜æ´» ClientAliveIntervalçš„æ„æ€æ˜¯æœåŠ¡å™¨æ¯éš”ä¸€æ®µæ—¶é—´å‘é€ä¸€ä¸ªåŠ å¯†çš„æ¢æ´»åŒ…åˆ°å®¢æˆ·ç«¯ï¼Œè¿™é‡Œçš„é»˜è®¤å•ä½æ˜¯ç§’ ClientAliveCountMaxåˆ™æ˜¯å½“å®¢æˆ·ç«¯å¤šå°‘æ¬¡æ²¡æœ‰å“åº”ä¹‹åï¼Œä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥ã€‚æ³¨æ„ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¸ä¼šä¸å“åº” é‚£ä¹ˆæˆ‘ä»¬æŠŠé…ç½®æ”¹æˆä¸Šé¢è¿™æ ·ï¼Œå°±å¯ä»¥ç†è§£ä¸º60ç§’*30æ¬¡ï¼ˆ30åˆ†é’Ÿï¼‰æ— å“åº”å°±æ–­å¼€è¿æ¥ã€‚ æœ€åæˆ‘ä»¬é‡å¯ä¸€ä¸‹æœåŠ¡è®©ä¿®æ”¹çš„é…ç½®ç”Ÿæ•ˆå³å¯ã€‚ 12systemctl restart sshd.service# é‡å¯sshdæœåŠ¡è®©é…ç½®ç”Ÿæ•ˆ","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"ssh","slug":"ssh","permalink":"https://tinychen.com/tags/ssh/"}]},{"title":"iperf3å®‰è£…é…ç½®ä½¿ç”¨è¸©å‘è®°å½•","slug":"20190409-iperf3","date":"2019-04-09T07:00:00.000Z","updated":"2021-06-09T08:00:00.000Z","comments":true,"path":"20190409-iperf3/","link":"","permalink":"https://tinychen.com/20190409-iperf3/","excerpt":"iperf3æ˜¯ä¸€ä¸ªå¼€æºçš„å¤šå¹³å°æµ‹é€Ÿå·¥å…·ï¼Œæ¶µç›–äº†Windowsï¼ŒAndroidï¼ŒLinuxï¼ŒiOSï¼ŒMacOSç­‰ä¸»æµæ“ä½œç³»ç»Ÿã€‚æœ¬æ–‡ä»¥Windowsä¸ºä¾‹è®°å½•ä¸€ä¸‹åœ¨ä½¿ç”¨iperf3çš„è¿‡ç¨‹ä¸­è¸©çš„ä¸€äº›å‘ã€‚","text":"iperf3æ˜¯ä¸€ä¸ªå¼€æºçš„å¤šå¹³å°æµ‹é€Ÿå·¥å…·ï¼Œæ¶µç›–äº†Windowsï¼ŒAndroidï¼ŒLinuxï¼ŒiOSï¼ŒMacOSç­‰ä¸»æµæ“ä½œç³»ç»Ÿã€‚æœ¬æ–‡ä»¥Windowsä¸ºä¾‹è®°å½•ä¸€ä¸‹åœ¨ä½¿ç”¨iperf3çš„è¿‡ç¨‹ä¸­è¸©çš„ä¸€äº›å‘ã€‚ 1ã€ä¸‹è½½å®‰è£…iperf3iperf3çš„å®˜ç½‘æä¾›äº†æ‰€æœ‰å¹³å°çš„ä¸‹è½½æ–¹æ³•ï¼Œæˆ‘ä»¬ç‚¹å‡»è¿™é‡Œè·³è½¬åˆ°å®˜ç½‘ã€‚ windowsç«¯Windowsåˆ†ä¸º32ä½å’Œ64ä½çš„ï¼Œå¯¹åº”è‡ªå·±çš„ç³»ç»Ÿç‰ˆæœ¬ä¸‹è½½ï¼Œä¸‹è½½è§£å‹å®Œæˆä¹‹åï¼Œå°†è§£å‹å¾—åˆ°çš„æ–‡ä»¶å¤åˆ¶åˆ°%systemroot%ç›®å½•ä¸‹ï¼Œå°±èƒ½å¤Ÿç›´æ¥ä½¿ç”¨äº†ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š Windowsçš„%systemroot%ç›®å½•æ˜¯C:\\Windows\\System32 ä¸ç®¡æ˜¯ä½¿ç”¨CMDè¿˜æ˜¯Powershellï¼Œéƒ½å¿…é¡»è¦ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œå¦åˆ™æ— æ³•æ­£å¸¸ä½¿ç”¨ Linuxç«¯å¸¸è§çš„ä¸»æµLinuxå‘è¡Œç‰ˆï¼ˆçº¢å¸½ç³»ã€debianç³»ã€suseç³»ç­‰ï¼‰éƒ½å¯ä»¥ç›´æ¥é€šè¿‡å¯¹åº”çš„æºæˆ–è€…åŒ…è¿›è¡Œå®‰è£…ï¼Œå¦‚æœæ˜¯å…¶ä»–çš„Linuxå‘è¡Œç‰ˆï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ‰‹åŠ¨å®‰è£… 123sudo wget -O /usr/lib/libiperf.so.0 https://iperf.fr/download/ubuntu/libiperf.so.0_3.1.3sudo wget -O /usr/bin/iperf3 https://iperf.fr/download/ubuntu/iperf3_3.1.3sudo chmod +x /usr/bin/iperf3 å¦‚æœå‡ºç°ä¸‹é¢è¿™ä¸€ç±»çš„æŠ¥é”™ï¼Œåˆ™éœ€è¦å°†ä¾èµ–æ–‡ä»¶æ‹·è´åˆ°/libç›®å½•å’Œ/lib64ç›®å½• 12345678910111213141516root@tiny-unraid:~# iperf3 --helpiperf3: error while loading shared libraries: libiperf.so.0: cannot open shared object file: No such file or directoryroot@tiny-unraid:~# ldd /usr/bin/iperf3 linux-vdso.so.1 (0x00007ffd35bde000) libiperf.so.0 =&gt; not found libc.so.6 =&gt; /lib64/libc.so.6 (0x0000154f00c69000) /lib64/ld-linux-x86-64.so.2 (0x0000154f00e5e000) root@tiny-unraid:~# cp /usr/lib/libiperf.so.0 /lib/libiperf.so.0root@tiny-unraid:~# cp /usr/lib/libiperf.so.0 /lib64/libiperf.so.0root@tiny-unraid:~# ldd /usr/bin/iperf3 linux-vdso.so.1 (0x00007ffd36c72000) libiperf.so.0 =&gt; /lib64/libiperf.so.0 (0x000014dd232e4000) libc.so.6 =&gt; /lib64/libc.so.6 (0x000014dd230ff000) libm.so.6 =&gt; /lib64/libm.so.6 (0x000014dd22fb2000) /lib64/ld-linux-x86-64.so.2 (0x000014dd23516000) 2ã€è¿è¡ŒæœåŠ¡ç«¯(server)iperf3æ˜¯ä¸€æ¬¾c-sè½¯ä»¶ï¼Œå³client-serverè½¯ä»¶ï¼Œåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯éœ€è¦ä¸€ç›´è¿è¡Œï¼Œå®¢æˆ·ç«¯æ‰èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚ 12iperf3 -help# æŸ¥çœ‹æ‰€æœ‰çš„æ“ä½œæŒ‡ä»¤ 2.1 è¿è¡Œä¸é€€å‡ºæœ€å¸¸è§çš„è¿è¡ŒæœåŠ¡ç«¯çš„å‘½ä»¤æ˜¯ï¼š 12iperf3 -s# è¿™é‡Œçš„så°±æ˜¯serverçš„æ„æ€ è¿™ç§æƒ…å†µä¸‹é»˜è®¤ç›‘å¬çš„æ˜¯5201ç«¯å£ æŒ‰ä¸‹ctrl+cå°±å¯ä»¥å…³é—­æœåŠ¡ç«¯ å¦‚æœæ˜¯åªè¿è¡Œä¸€æ¬¡æµ‹é€Ÿå°±é€€å‡ºï¼Œå¯ä»¥è¿™æ ·ï¼š 12iperf3 -s -1# è¿è¡Œä¸€æ¬¡åè‡ªåŠ¨é€€å‡ºæœåŠ¡ç«¯ 2.2 æŒ‡å®šç›‘å¬ç«¯å£å¦‚æœéœ€è¦æŒ‡å®šç‰¹å®šçš„ç›‘å¬ç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨-på‚æ•°ï¼Œè¿™é‡Œçš„på°±æ˜¯portçš„æ„æ€ã€‚ 12iperf3 -s -p 7777# æ‰‹åŠ¨æŒ‡å®šç›‘å¬ç«¯å£ä¸º7777 éœ€è¦æ³¨æ„çš„æ˜¯æ‰‹åŠ¨æŒ‡å®šç›‘å¬ç«¯å£çš„æ—¶å€™ä¸è¦å’Œå…¶ä»–åº”ç”¨çš„ç«¯å£å†²çªäº†ï¼Œå¦åˆ™ä¼šæ— æ³•è¿è¡ŒæœåŠ¡æˆ–äº§ç”ŸæœåŠ¡å†²çªã€‚ 2.3 å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¦‚æœéœ€è¦æœåŠ¡ç«¯åœ¨åå°è¿è¡Œè€Œä¸è¢«å…³é—­ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ã€‚ Daemon()ç¨‹åºæ˜¯ä¸€ç›´è¿è¡Œçš„æœåŠ¡ç«¯ç¨‹åºï¼Œåˆç§°ä¸ºå®ˆæŠ¤è¿›ç¨‹ã€‚é€šå¸¸åœ¨ç³»ç»Ÿåå°è¿è¡Œï¼Œæ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œä¸ä¸å‰å°äº¤äº’ï¼ŒDaemonç¨‹åºä¸€èˆ¬ä½œä¸ºç³»ç»ŸæœåŠ¡ä½¿ç”¨ã€‚Daemonæ˜¯é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿå¯åŠ¨åå°±è¿è¡Œï¼Œåœ¨ç³»ç»Ÿå…³é—­æ—¶æ‰ç»“æŸã€‚ä¸€èˆ¬è¯´Daemonç¨‹åºåœ¨åå°è¿è¡Œï¼Œæ˜¯å› ä¸ºå®ƒæ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œæ— æ³•å’Œå‰å°çš„ç”¨æˆ·äº¤äº’ã€‚Daemonç¨‹åºä¸€èˆ¬éƒ½ä½œä¸ºæœåŠ¡ç¨‹åºä½¿ç”¨ï¼Œç­‰å¾…å®¢æˆ·ç«¯ç¨‹åºä¸å®ƒé€šä¿¡ã€‚æˆ‘ä»¬ä¹ŸæŠŠè¿è¡Œçš„Daemonç¨‹åºç§°ä½œå®ˆæŠ¤è¿›ç¨‹ã€‚ 12iperf3 -s -D# æ³¨æ„Dä¸€å®šè¦å¤§å†™ è¿™ä¸ªæ—¶å€™iperf3ä»¥æœåŠ¡ç«¯æ¨¡å¼åœ¨åå°è¿è¡Œï¼Œè¯¥è¿›ç¨‹ä¸ä¼šè½»æ˜“è¢«ç»“æŸè¿è¡Œã€‚ ä½¿ç”¨netstatå‘½ä»¤å¯ä»¥çœ‹åˆ°æ­¤æ—¶5201ç«¯å£æ­£åœ¨è¢«ä½¿ç”¨ã€‚ å¦‚æœéœ€è¦å…³é—­çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨taskkillæŒ‡ä»¤ã€‚ 12tasklist | findstr iperf3# Windowsä¸‹çš„CMDæ— æ³•ä½¿ç”¨grepå‘½ä»¤å¯ä»¥ä½¿ç”¨findstrå‘½ä»¤æ¥ä»£æ›¿ 123taskkill /PID 9492 /F# è¿™é‡Œçš„9492è¦æ”¹æˆæŸ¥è¯¢åˆ°çš„å¯¹åº”çš„PID# ç”±äºæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œæ‰€ä»¥éœ€è¦å¼ºåˆ¶ç»ˆæ­¢ å…¶ä»–çš„ä¸€äº›æŒ‡ä»¤å¤§å®¶å¯ä»¥è‡ªå·±ç»§ç»­å°è¯•ï¼Œå°ä¸ƒå°±ä¸å†èµ˜è¿°ã€‚ 3ã€è¿è¡Œå®¢æˆ·ç«¯(Client)è¿è¡Œå®¢æˆ·ç«¯çš„å‰ææ˜¯æœ‰æœåŠ¡ç«¯åœ¨è¿è¡Œä¸”æˆ‘ä»¬çŸ¥é“æœåŠ¡ç«¯çš„IPå¹¶èƒ½æ­£å¸¸è®¿é—®æœåŠ¡ç«¯ï¼ˆæœ‰æ—¶å€™å¯èƒ½ä¼šè¢«é˜²ç«å¢™æˆ–å…¶ä»–æ€è½¯æ‹¦æˆªï¼‰ã€‚ 3.1 ç®€å•æµ‹è¯•å› ä¸ºå¤–éƒ¨è®¾å¤‡æ‰€é™ï¼Œæ¥ä¸‹æ¥å°ä¸ƒåŒæ—¶åœ¨æœ¬æœºä¸Šè¿è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œæµ‹é€Ÿç¤ºä¾‹ã€‚ æœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•å°±æ˜¯ï¼š 12iperf3 -c ServerhostIP# hostIPä¸ºæœåŠ¡ç«¯çš„IPåœ°å€ ç”±äºè¿™é‡Œå°ä¸ƒæ˜¯åœ¨æœ¬æœºä¸Šè¿è¡Œçš„æœåŠ¡ç«¯ï¼Œå› æ­¤ä½¿ç”¨æœ¬æœºçš„IPåœ°å€æˆ–è€…localhostæˆ–è€…127.0.0.1éƒ½å¯ä»¥ã€‚ ä¸»è¦çš„å‡ ä¸ªå‚æ•°åˆ—è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼ŒIntervelæŒ‡çš„æ˜¯æ—¶é—´é—´éš”ï¼ŒTransferåˆ™æ˜¯å¯¹åº”æ—¶é—´æ®µé‡Œé¢ä¼ è¾“çš„æ•°æ®æ€»é‡ï¼ŒBandwidthåˆ™æ˜¯è¯¥æ—¶é—´æ®µå†…çš„å¹³å‡å¸¦å®½ã€‚ 3.2 è‡ªå®šä¹‰æµ‹è¯•æ—¶é—´å’Œè¾“å‡ºæ ¼å¼1iperf3 -c localhost -i 2 -t 30 --logfile output.log å¯¹äºè¿™ä¸€æ¡æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯¹åé¢çš„å‚æ•°è¿›è¡Œé€ä¸ªè§£æã€‚ -i 2çš„ä½œç”¨æ˜¯æ¯2ç§’è¾“å‡ºä¸€æ¬¡æµ‹è¯•ç»“æœï¼Œæ•°å­—2å¯ä»¥æŒ‰ç…§éœ€è¦æ”¹æˆä¸åŒçš„æ•°å­— -t 30çš„ä½œç”¨æ˜¯è¿ç»­æµ‹è¯•30sçš„æ—¶é—´ --logfile output.logçš„ä½œç”¨æ˜¯å°†æµ‹è¯•çš„ç»“æœè¾“å‡ºåˆ°å½“å‰ç›®å½•çš„output.logæ–‡ä»¶é‡Œé¢ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ­¤æ—¶ä¸ä¼šåœ¨æ§åˆ¶å°ä¸Šè¾“å‡ºæµ‹è¯•ä¿¡æ¯ â–²æ‰“å¼€logæ–‡ä»¶å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æµ‹è¯•æ•°æ®éƒ½ä¿å­˜åœ¨é‡Œé¢äº† å¦‚æœéœ€è¦æŒ‡å®šè·¯å¾„è¾“å‡ºjsonæ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨-Jå¹¶åœ¨æ–‡ä»¶åå‰é¢æŒ‡å®šè·¯å¾„å³å¯ï¼š 12iperf3 -c localhost -i 2 -t 30 -J --logfile C:\\Users\\Mr7th\\Desktop\\output.log# ä»¥Jsonæ ¼å¼å°†æµ‹è¯•ç»“æœæ–‡ä»¶è¾“å‡ºåˆ°æ¡Œé¢ ä¸‹é¢ä¸ºæˆªå–çš„éƒ¨åˆ†jsonæ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869&#123; &quot;start&quot;: &#123; &quot;connected&quot;: [&#123; &quot;socket&quot;: 5, &quot;local_host&quot;: &quot;::1&quot;, &quot;local_port&quot;: 7013, &quot;remote_host&quot;: &quot;::1&quot;, &quot;remote_port&quot;: 5201 &#125;], &quot;version&quot;: &quot;iperf 3.1.3&quot;, &quot;system_info&quot;: &quot;CYGWIN_NT-10.0 Tiny-Surface 2.5.1(0.297/5/3) 2016-04-21 22:14 x86_64&quot;, &quot;timestamp&quot;: &#123; &quot;time&quot;: &quot;Tue, 09 Apr 2019 11:40:34 GMT&quot;, &quot;timesecs&quot;: 1554810034 &#125;, &quot;connecting_to&quot;: &#123; &quot;host&quot;: &quot;localhost&quot;, &quot;port&quot;: 5201 &#125;, &quot;cookie&quot;: &quot;Tiny-Surface.1554810034.839053.017f3&quot;, &quot;tcp_mss_default&quot;: 0, &quot;test_start&quot;: &#123; &quot;protocol&quot;: &quot;TCP&quot;, &quot;num_streams&quot;: 1, &quot;blksize&quot;: 131072, &quot;omit&quot;: 0, &quot;duration&quot;: 30, &quot;bytes&quot;: 0, &quot;blocks&quot;: 0, &quot;reverse&quot;: 0 &#125; &#125;, &quot;intervals&quot;: [&#123; &quot;streams&quot;: [&#123; &quot;socket&quot;: 5, &quot;start&quot;: 0, &quot;end&quot;: 2.000219, &quot;seconds&quot;: 2.000219, &quot;bytes&quot;: 1222770688, &quot;bits_per_second&quot;: 4.890547e+09, &quot;omitted&quot;: false &#125;], &quot;sum&quot;: &#123; &quot;start&quot;: 0, &quot;end&quot;: 2.000219, &quot;seconds&quot;: 2.000219, &quot;bytes&quot;: 1222770688, &quot;bits_per_second&quot;: 4.890547e+09, &quot;omitted&quot;: false &#125; &#125;, &#123; &quot;streams&quot;: [&#123; &quot;socket&quot;: 5, &quot;start&quot;: 2.000219, &quot;end&quot;: 4.000079, &quot;seconds&quot;: 1.999860, &quot;bytes&quot;: 1384644608, &quot;bits_per_second&quot;: 5.538966e+09, &quot;omitted&quot;: false &#125;], &quot;sum&quot;: &#123; &quot;start&quot;: 2.000219, &quot;end&quot;: 4.000079, &quot;seconds&quot;: 1.999860, &quot;bytes&quot;: 1384644608, &quot;bits_per_second&quot;: 5.538966e+09, &quot;omitted&quot;: false &#125; &#125;, 3.3 ä½¿ç”¨åè½¬æ¨¡å¼(Reverse)é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼Œéƒ½æ˜¯å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶æ•°æ®ï¼Œè¿™ç§æƒ…å†µä¸‹ç›¸å½“äºåªå¯¹ä¸Šè¡Œå¸¦å®½è¿›è¡Œäº†æµ‹è¯•ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ£€æµ‹ä¸‹è¡Œå¸¦å®½ï¼Œåªéœ€è¦ä½¿ç”¨-Rå‘½ä»¤ï¼Œå³å¯å˜ä¸ºå®¢æˆ·ç«¯æ¥æ”¶ï¼ŒæœåŠ¡å™¨ç«¯å‘é€ã€‚ è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ‰‹æœºä½œä¸ºæœåŠ¡å™¨ç«¯è¿›è¡Œæµ‹è¯•ã€‚ â–¼é»˜è®¤æƒ…å†µä¸‹ï¼Œç”µè„‘ä½œä¸ºå®¢æˆ·ç«¯ï¼Œä¸»è¦æ˜¯å‘é€æ•°æ®ï¼ˆä¸Šè¡Œå¸¦å®½ï¼‰ã€‚ â–¼ä½¿ç”¨åè½¬æ¨¡å¼(Reverse)ï¼Œæ­¤æ—¶ç”µè„‘ä»ç„¶æ˜¯å®¢æˆ·ç«¯ï¼Œåªä¸è¿‡å˜æˆäº†æ¥æ”¶æ•°æ®ï¼ˆä¸‹è¡Œå¸¦å®½ï¼‰ã€‚ å…¶ä»–çš„ä¸€äº›æŒ‡ä»¤ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹å®˜æ–¹çš„è¯´æ˜æ–‡æ¡£ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"iperf3","slug":"iperf3","permalink":"https://tinychen.com/tags/iperf3/"}]},{"title":"é˜¿é‡Œäº‘è½»é‡çº§åº”ç”¨æœåŠ¡å™¨CentOSç³»ç»ŸApacheé…ç½®Https","slug":"20190407-aliyun-centos-apache-https","date":"2019-04-07T07:00:00.000Z","updated":"2019-04-07T07:00:00.000Z","comments":true,"path":"20190407-aliyun-centos-apache-https/","link":"","permalink":"https://tinychen.com/20190407-aliyun-centos-apache-https/","excerpt":"è®°å½•ä¸€ä¸‹ç»™Hexoåšå®¢é…ç½®httpsåŸŸåè¿‡ç¨‹ä¸­è¸©çš„å„ç§å‘ã€‚","text":"è®°å½•ä¸€ä¸‹ç»™Hexoåšå®¢é…ç½®httpsåŸŸåè¿‡ç¨‹ä¸­è¸©çš„å„ç§å‘ã€‚ 1ã€ç”³è¯·è¯ä¹¦SSLçš„è¯ä¹¦åŸºæœ¬å¯ä»¥åˆ†ä¸ºç”³è¯·çš„å’Œè‡ªå·±åˆ›å»ºçš„ï¼Œé˜¿é‡Œäº‘ä¸Šé¢æœ‰å…è´¹çš„å¯ä»¥ç”³è¯·ï¼Œæœ¬ç€å¤šä¸€äº‹ä¸å¦‚å°‘ä¸€äº‹çš„åŸåˆ™ï¼ˆå…¶å®æ˜¯å¤ªèœäº†ï¼‰ï¼Œæœæ–­é€‰æ‹©é˜¿é‡Œäº‘çš„SSLè¯ä¹¦ç”³è¯·ã€‚ â–¼ç‚¹å‡»SSLè¯ä¹¦ï¼ˆåº”ç”¨å®‰å…¨ï¼‰ â–¼é€‰æ‹©å…è´¹çš„é‚£ä¸ªã€‚ â–¼å¡«å†™ä¸€äº›ç”³è¯·çš„ä¿¡æ¯ã€‚ â–¼ç„¶åéœ€è¦è¿›è¡Œä¿¡æ¯éªŒè¯ï¼Œä¸€èˆ¬éƒ½æ˜¯DNSéªŒè¯ï¼Œå¦‚æœæ˜¯åœ¨é˜¿é‡Œäº‘è´­ä¹°çš„åŸŸåï¼Œä¼šè‡ªåŠ¨æ·»åŠ DNSè§£æéªŒè¯ï¼Œå…¶ä»–çš„å°±éœ€è¦åˆ°åŸŸåç®¡ç†é‡Œé¢æ‰‹åŠ¨æ·»åŠ äº†ã€‚ â–¼æäº¤æˆåŠŸä¹‹åè€å¿ƒç­‰å¾…ä¸€ä¸‹ï¼Œå¾ˆå¿«å°±ä¼šç”³è¯·é€šè¿‡ã€‚ 2ã€å®‰è£…Apacheå’Œopenssl2.1 å®‰è£…Apacheç”±äºæ˜¯åœ¨apacheæœåŠ¡å™¨ä¸Šé¢æ­å»ºçš„åšå®¢ï¼Œæ‰€ä»¥æˆ‘çš„æœåŠ¡å™¨å·²ç»å®‰è£…å¥½äº†apacheï¼Œè¾“å…¥ä¸‹åˆ—å‘½ä»¤å¯ä»¥æŸ¥çœ‹apacheçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚ 12httpd -v# è¾“å…¥è¯¥å‘½ä»¤æŸ¥çœ‹apacheçš„ç‰ˆæœ¬ä¿¡æ¯ å¦‚æœæ²¡æœ‰å®‰è£…apacheçš„è¯ï¼Œå¯ä»¥é€‰æ‹©æ‰‹åŠ¨ä¸‹è½½å®‰è£…åŒ…å®‰è£…æˆ–è€…æ˜¯ä½¿ç”¨yumè¿›è¡Œå®‰è£…ï¼Œä¸åŒçš„å®‰è£…æ–¹å¼ç”Ÿæˆçš„æ–‡ä»¶ç›®å½•ä¼šæœ‰ä¸€äº›ä¸å¤ªä¸€æ ·ï¼Œè¿™å¯¹åé¢çš„SSLè¯ä¹¦é…ç½®æœ‰ç€å¾ˆå¤§çš„å½±å“ã€‚ 12yum install httpd# ä½¿ç”¨yumå®‰è£…apacheï¼Œè¿™æ ·å®‰è£…çš„httpdçš„é»˜è®¤ç›®å½•æ˜¯åœ¨/etc/httpdæ–‡ä»¶å¤¹é‡Œé¢ æ¥ç€å†å®‰è£…ä¸€äº›å¿…è¦çš„å·¥å…·å’Œæ‰©å±• 1yum -y install gcc* make* apr apr-util pcre apr-devel apr-util-devel pcre-devel 1yum -y install httpd-manual mod_ssl mod_perl mod_auth_mysql 2.2 å®‰è£…opensslæ¥ç€æ˜¯ä½¿ç”¨yumå®‰è£…opensslæ¨¡å—ã€‚å¦‚æœæœ‰ç‰¹æ®Šéœ€æ±‚çš„ï¼Œå¯ä»¥åˆ°å®˜ç½‘ä¸‹è½½opensslè‡ªè¡Œç¼–è¯‘ï¼Œåœ¨è¿™é‡Œåªéœ€è¦ä½¿ç”¨yumè¿›è¡Œå®‰è£…å³å¯ã€‚ 1yum install openssl openssl-devel æŸ¥çœ‹opensslç‰ˆæœ¬ 1openssl version -a ç¡®è®¤å®‰è£…å¥½apacheå’Œopensslä¹‹åï¼Œæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€æ­¥ã€‚ 3ã€ä¸Šä¼ è¯ä¹¦åˆ°æœåŠ¡å™¨é˜¿é‡Œäº‘é‚£è¾¹çš„è¯ä¹¦ç”³è¯·å¥½ä¹‹åï¼Œæˆ‘ä»¬ä¸‹è½½è¯ä¹¦åˆ°è‡ªå·±çš„ç”µè„‘é‡Œé¢ï¼Œè§£å‹å¯ä»¥å¾—åˆ°ç±»ä¼¼è¿™æ ·å­çš„ä¸‰ä¸ªæ–‡ä»¶ã€‚ å›¾ä¸­çš„æ˜¯é»˜è®¤çš„åå­—ï¼Œæ”¹ä¸æ”¹éƒ½å¯ä»¥ï¼Œä¸è¦ææ··äº†å°±è¡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå®ƒä»¬ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­çš„apacheçš„å®‰è£…ç›®å½•ä¸‹é¢ï¼Œç»™ä»–ä»¬ä¸“é—¨æ–°å»ºä¸€ä¸ªcertæ–‡ä»¶å¤¹ã€‚ é¦–å…ˆæˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸­ç»™ä»–æ–°å»ºä¸€ä¸ªç›®å½• 1mkdir /etc/httpd/cert ç„¶åæŠŠæœ¬æœºçš„è¯ä¹¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨scpå‘½ä»¤ä¸Šä¼ æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Xshellä¸­çš„Xftpæ¥ä¼ è¾“ï¼Œè¿˜æœ‰å…¶ä»–çš„å„ç§æ–¹å¼ä¹Ÿéƒ½å¯ä»¥ï¼Œåæ­£ä¼ ä¸Šå»äº†å°±è¡Œã€‚ æˆ‘è¿™é‡Œä½¿ç”¨scpå‘½ä»¤ä¸ºä¾‹ï¼š 1234# scpå‘½ä»¤çš„æœ€åŸºæœ¬ç”¨æ³•æ˜¯ï¼šscp fileLocation username@hostIP: DestinationLocation# ä»¥åœ¨æ¡Œé¢ä¼ é€ä¸€ä¸ªæ–‡ä»¶åˆ°/etc/httpd/certç›®å½•ä¸ºä¾‹ï¼ˆæ­¤æ—¶æˆ‘æ˜¯åœ¨æ¡Œé¢ç›´æ¥æ‰“å¼€gitbashï¼‰scp 1692315_tiny777.com.key root@47.107.188.168:/etc/httpd/cert 4ã€å¼€å¯443ç«¯å£httpsé»˜è®¤æ˜¯ä½¿ç”¨443ç«¯å£è¿›è¡Œç›‘å¬ï¼Œè™½ç„¶é˜¿é‡Œäº‘é»˜è®¤æ˜¯å¼€å¯äº†443ç«¯å£çš„ï¼Œä½†æ˜¯ä¸ºäº†ä¿é™©èµ·è§ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç¡®è®¤ä¸€ä¸‹ã€‚ ç‚¹å¼€é˜¿é‡Œäº‘çš„æ§åˆ¶å°ï¼Œç‚¹å‡»è½»é‡çº§åº”ç”¨æœåŠ¡å™¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 5ã€é…ç½®ssl5.1 å¯ç”¨sslæ¨¡å—æ”¯æŒè¿™é‡Œå°±æ˜¯æ¯”è¾ƒå‘çš„åœ°æ–¹äº†ï¼Œé˜¿é‡Œäº‘çš„å¸®åŠ©æ–‡æ¡£è¯´çš„å¯èƒ½æ˜¯åˆ«çš„æ–¹å¼å®‰è£…çš„apacheæœåŠ¡å™¨ï¼Œå’Œæˆ‘çš„æƒ…å†µä¸å¤ªä¸€æ ·ã€‚ä½†æ˜¯æ€è·¯å´è¿˜æ˜¯æ­£ç¡®çš„ã€‚ è¿™ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥çš„ä¸»è¦ä½œç”¨æ˜¯å¼€å¯apacheçš„sslæ¨¡å—æ”¯æŒï¼Œç¬¬äºŒæ­¥åˆ™æ˜¯Includeä»£ç sslçš„é…ç½®æ–‡ä»¶ä½¿å…¶ç”Ÿæ•ˆã€‚ ä½¿ç”¨yumå®‰è£…çš„apacheæœ‰ä¸€äº›ä¸å¤ªä¸€æ ·ï¼Œç›¸å¯¹åº”çš„é…ç½®æ–‡ä»¶éƒ½åœ¨/etc/httpd/conf.modules.dè¿™ä¸ªç›®å½•ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¸»è¦ä¼šç”¨åˆ°çš„å°±æ˜¯è¿™ä¸ª00-ssl.confå’Œ00-base.confæ–‡ä»¶ã€‚ æ‰“å¼€00-ssl.confå°±èƒ½çœ‹åˆ°å¯¹åº”é˜¿é‡Œäº‘æ•™ç¨‹é‡Œé¢çš„ç¬¬ä¸€æ­¥æ“ä½œï¼Œå¯ç”¨sslæ¨¡å—æ”¯æŒã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨/etc/httpd/conf/httpd.confè¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œå¯ä»¥æ‰¾åˆ°è¿™ä¸€è¡Œï¼ˆåœ¨56è¡Œå·¦å³çš„ä½ç½®ï¼‰ 1Include conf.modules.d/*.conf è¿™ä¸€è¡Œä»£ç çš„æ„æ€å°±æ˜¯Includeäº†æ•´ä¸ªconf.modules.dæ–‡ä»¶å¤¹é‡Œé¢çš„æ‰€æœ‰confåç¼€çš„æ–‡ä»¶ï¼Œè¿™ä¸ª00-ssl.confæ–‡ä»¶å½“ç„¶ä¹Ÿä¸ä¾‹å¤–ã€‚ 5.2 é…ç½®sslå®Œæˆä¸Šé¢çš„ä¸¤æ­¥æ“ä½œä¹‹åï¼Œæˆ‘ä»¬å°±è¦é…ç½®sslçš„é…ç½®æ–‡ä»¶äº†ã€‚æˆ‘ä»¬å†çœ‹é˜¿é‡Œäº‘çš„æ–‡æ¡£ã€‚ 1234567891011# æ·»åŠ  SSL åè®®æ”¯æŒåè®®ï¼Œå»æ‰ä¸å®‰å…¨çš„åè®®SSLProtocol all -SSLv2 -SSLv3# ä¿®æ”¹åŠ å¯†å¥—ä»¶å¦‚ä¸‹SSLCipherSuite HIGH:!RC4:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!EXP:+MEDIUMSSLHonorCipherOrder on# è¯ä¹¦å…¬é’¥é…ç½®SSLCertificateFile cert/a_public.crt# è¯ä¹¦ç§é’¥é…ç½®SSLCertificateKeyFile cert/a.key# è¯ä¹¦é“¾é…ç½®ï¼Œå¦‚æœè¯¥å±æ€§å¼€å¤´æœ‰ &#x27;#&#x27;å­—ç¬¦ï¼Œè¯·åˆ é™¤æ‰SSLCertificateChainFile cert/a_chain.crt è¿˜æ˜¯ä¸€æ ·çš„é—®é¢˜ï¼Œè·¯å¾„ä¸å¤ªæ­£ç¡®ï¼Œæˆ‘ä»¬è¿™é‡Œæ‰¾åˆ°çš„æ–‡ä»¶è·¯å¾„æ˜¯/etc/httpd/conf.d/ssl.conf åœ¨æ›´æ”¹é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œä¸ºäº†ä¿é™©èµ·è§ï¼Œå’±ä»¬å…ˆå¤‡ä»½ä¸€ä¸‹ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚ 1cp ssl.conf ssl.conf.bak è¿™é‡Œå†ç»™å‡ºæˆ‘è‡ªå·±çš„ssl.confæ–‡ä»¶å’Œå¤§å®¶äº¤æµä¸€ä¸‹ï¼š 12345678910111213141516171819202122232425Listen 443&lt;VirtualHost *:443&gt;DocumentRoot &quot;/var/www/html&quot;ServerName tiny777.comServerAlias www.tiny777.comSSLEngine onSSLProtocol all -SSLv2 -SSLv3SSLCertificateFile /etc/httpd/cert/1692315_tiny777.com_public.crtSSLCertificateKeyFile /etc/httpd/cert/1692315_tiny777.com.keySSLCertificateChainFile /etc/httpd/cert/1692315_tiny777.com_chain.crtDirectoryIndex index.html index.htm index.php&lt;Directory &quot;/var/www/html&quot;&gt; Options Indexes FollowSymLinks AllowOverride None Require all granted&lt;/Directory&gt;&lt;/VirtualHost&gt; ç†è®ºä¸Šè¿™ä¸ªæ—¶å€™é‡å¯apacheæœåŠ¡å·²ç»å¯ä»¥è¾“å…¥httpsåŠ ä¸Šæˆ‘ä»¬çš„åŸŸåæ¥å¼€å¯httpsè®¿é—®äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™çš„httpså’Œhttpç›¸äº’ç‹¬ç«‹ï¼Œé»˜è®¤æ˜¯è®¿é—®httpçš„åŸŸåï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯httpåŸŸåè‡ªåŠ¨è·³è½¬åˆ°httpsåŸŸåã€‚ 5.3 è‡ªåŠ¨è·³è½¬åˆ°httpsä¿é™©èµ·è§ï¼Œæˆ‘ä»¬åšæŒä¸€ä¸‹è‡ªåŠ¨è·³è½¬éœ€è¦ç”¨åˆ°çš„rewriteæ¨¡å—æ˜¯å¦å¼€å¯äº†ï¼Œè¿˜æ˜¯åœ¨ä¹‹å‰è¯´çš„/etc/httpd/conf.d/00-base.confæ–‡ä»¶é‡Œé¢æŸ¥æ‰¾ä¸€ä¸‹rewriteæ¨¡å—ï¼Œç¡®å®šå·²ç»å¯ç”¨ã€‚ 1LoadModule rewrite_module modules/mod_rewrite.so æ¥ä¸‹æ¥æˆ‘ä»¬å®šä½åˆ°è¿™ä¸ªç›®å½• 1cd /etc/httpd/conf æ›´æ”¹httpd.confæ–‡ä»¶ï¼Œåœ¨æœ€åé¢åŠ å…¥è¿™å‡ è¡Œä»£ç ï¼š 123RewriteEngine onRewriteCond %&#123;SERVER_PORT&#125; !^443$RewriteRule ^.*$ https://%&#123;SERVER_NAME&#125;%&#123;REQUEST_URI&#125; [L,R=301] æœ€åæˆ‘ä»¬é‡å¯apacheæœåŠ¡ï¼Œå°±èƒ½å¼€å¯åŸŸåçš„httpsè®¿é—®äº†ã€‚ 1systemctl restart httpd.service æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"}]},{"title":"åˆ é™¤Windowsä¸­çš„3Då¯¹è±¡æ–‡ä»¶å¤¹","slug":"20190405-delete-3d-objects","date":"2019-04-05T07:00:00.000Z","updated":"2019-04-05T07:00:00.000Z","comments":true,"path":"20190405-delete-3d-objects/","link":"","permalink":"https://tinychen.com/20190405-delete-3d-objects/","excerpt":"é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥åˆ é™¤èµ„æºç®¡ç†å™¨é‡Œé¢çš„3D Objectsæ–‡ä»¶å¤¹","text":"é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥åˆ é™¤èµ„æºç®¡ç†å™¨é‡Œé¢çš„3D Objectsæ–‡ä»¶å¤¹ è¿™ä¸ªæ–‡ä»¶å¤¹ç”¨ä¸åˆ°è€Œä¸”å¾ˆå ä½ç½®ï¼ŒæŠŠä¸‹é¢çš„ä»£ç å¤åˆ¶åˆ°æ–‡æœ¬æ–‡ä»¶é‡Œé¢å¹¶ä¸”æ›´æ”¹åç¼€ä¸ºregæ–‡ä»¶å³å¯é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥å¯¹å…¶åˆ é™¤ã€‚ 123Windows Registry Editor Version 5.00[-HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MyComputer\\NameSpace\\&#123;0DB7E03F-FC29-4DC6-9020-FF41B59E513A&#125;] æƒ³è¦æ¢å¤çš„è¯ï¼ŒæŠŠä¸Šé¢ä»£ç çš„æ³¨å†Œè¡¨è·¯å¾„æœ€å‰é¢çš„å‡å·â€œ-â€å»æ‰å°±å¯ä»¥äº†ã€‚ 123Windows Registry Editor Version 5.00[HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MyComputer\\NameSpace\\&#123;0DB7E03F-FC29-4DC6-9020-FF41B59E513A&#125;] â–²å¦‚å›¾æ‰€ç¤ºæˆ‘å°†å…¶å‘½åä¸ºAdd3DObject.regå’ŒDelete3DObject.regï¼Œç„¶åç›´æ¥åŒå‡»è¿è¡Œã€‚ è¿è¡Œçš„æ—¶å€™ä¼šæœ‰è­¦å‘Šï¼Œç‚¹å‡»ç¡®å®šå°±å¯ä»¥äº†ã€‚ æœ€åçš„æ•ˆæœï¼š","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"}]},{"title":"ç›´é€šçº¿å’Œäº¤å‰çº¿çš„åˆ¶ä½œ","slug":"20190404-make-cat6-cable","date":"2019-04-04T07:00:00.000Z","updated":"2019-04-04T07:00:00.000Z","comments":true,"path":"20190404-make-cat6-cable/","link":"","permalink":"https://tinychen.com/20190404-make-cat6-cable/","excerpt":"ä½¿ç”¨å…­ç±»ç½‘çº¿å’Œå…­ç±»æ°´æ™¶å¤´åˆ¶ä½œç›´é€šçº¿å’Œäº¤å‰çº¿ï¼Œå¤šå›¾é¢„è­¦ã€‚","text":"ä½¿ç”¨å…­ç±»ç½‘çº¿å’Œå…­ç±»æ°´æ™¶å¤´åˆ¶ä½œç›´é€šçº¿å’Œäº¤å‰çº¿ï¼Œå¤šå›¾é¢„è­¦ã€‚ 1ã€å·¥å…·å‡†å¤‡1.1 ç½‘çº¿å’Œæ°´æ™¶å¤´é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡åŸææ–™ï¼šç½‘çº¿ï¼ˆåŒç»çº¿ï¼‰å’Œæ°´æ™¶å¤´ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯250Mhzçš„å…­ç±»éå±è”½åŒç»çº¿ï¼ˆUTPï¼‰å’Œå…­ç±»çš„æ°´æ™¶å¤´ã€‚ ä»”ç»†è§‚å¯Ÿçº¿ç¼†å¤–é¢çš„å¡‘æ–™çš®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œå…¶ä¸­ 250æŒ‡çš„æ˜¯ç”µç¼†é‡Œé¢çš„ç”µæµæ˜¯250Mhz Category 6 åˆ™æ˜¯æˆ‘ä»¬å¸¸è¯´çš„6ç±»ç½‘çº¿ U/UTPåˆ™æ˜¯ Unshielded Twisted Pairçš„ç¼©å†™ï¼Œæ„ä¸ºéå±è”½åŒç»çº¿ 1.2 åˆ¶ä½œå·¥å…·åˆ¶ä½œå·¥å…·æœ€å°‘åº”è¯¥åŒ…æ‹¬å‰¥çº¿åˆ€ã€å°–å˜´é’³ã€å‹çº¿é’³ã€æµ‹çº¿ä»ªå››æ ·å·¥å…·ã€‚ä½†æ˜¯æœ‰äº›å‹çº¿é’³ä¹Ÿæœ‰åˆ€ç‰‡èƒ½å®Œæˆå‰¥çº¿åˆ€å’Œå°–å˜´é’³çš„åŠŸèƒ½ï¼Œæµ‹çº¿ä»ªå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå¯ä»¥ç›´æ¥æ¥åˆ°ç”µè„‘ä¸Šçœ‹èƒ½ä¸èƒ½æ­£å¸¸ä½¿ç”¨ã€‚ 2ã€å‰¥çš®ç†çº¿2.1 å‰¥çš®é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨å‰¥çº¿åˆ€æ‹¨å¼€åŒç»çº¿çš„å¤–çš®ï¼Œæ³¨æ„å…­ç±»çš„åŒç»çº¿æ¯”è¾ƒç²—ï¼Œå‰¥çš®çš„æ—¶å€™æ³¨æ„ä¸è¦å¤ªç”¨åŠ›æŠŠé‡Œé¢çš„çº¿èŠ¯ä¼¤åˆ°äº†ã€‚ å‰¥å¼€å¤–çš®ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…­ç±»åŒç»çº¿é‡Œé¢æœ‰å››è‚¡çº¿å…±å…«æ ¹ï¼Œåˆ†åˆ«æ˜¯æ©™ã€ç»¿ã€è“ã€æ£•å››ç§çº¯è‰²å’Œå¯¹åº”çš„ç™½è‰²ç›¸é—´é¢œè‰²ï¼Œæ¯ä¸¤æ ¹ç›¸äº’ç»åœ¨ä¸€èµ·ï¼Œç”¨æ¥ç›¸äº’æŠµæ¶ˆç”µæµçš„ç£æ•ˆåº”ã€‚è¿™å°±æ˜¯åŒç»çº¿åç§°çš„ç”±æ¥ã€‚ ä¸­é—´è¿˜æœ‰åå­—ç»ç¼˜éª¨æ¶å’Œæ£‰èŠ¯ï¼Œå…¶ä¸­æ£‰èŠ¯æ˜¯åŒç»çº¿å†…éƒ¨åŠ å¼ºæŠ—æ‹‰èƒ½åŠ›ï¼Œç”¨æ¥é˜²æ‹‰æ–­çš„ï¼Œè€Œåå­—ç»ç¼˜éª¨æ¶åˆ™æ˜¯å…­ç±»çº¿ä¸­æ–°åŠ å…¥çš„ï¼Œå…­ç±»ä¹‹å‰çš„åŒç»çº¿éƒ½æ²¡æœ‰ï¼ˆåŒ…æ‹¬è¶…äº”ç±»ï¼‰ï¼Œå…¶ä½œç”¨å’Œæ£‰èŠ¯åŸºæœ¬ç›¸åŒã€‚ 2.2 T568Aå’ŒT568Bç±»çº¿åºæˆ‘ä»¬æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºç»™å…«æ ¹çº¿ä¾æ¬¡æ ‡å·ä¸º1~8å·çº¿ï¼ŒT568Aç±»çº¿åºå’ŒT568Bç±»çº¿åºå¯¹åº”çš„ä¸åŒä¹‹å¤„å°±æ˜¯1236è¿™å››æ ¹çº¿çš„çº¿åºä¸ä¸€æ ·ï¼Œæˆ‘ä»¬çœ‹ä¸‹è¡¨åšä¸ªå¯¹æ¯”ã€‚ 1 2 3 4 5 6 7 8 T568A ç»¿ç™½ ç»¿ æ©™ç™½ è“ è“ç™½ æ©™ æ£•ç™½ æ£• T568B æ©™ç™½ æ©™ ç»¿ç™½ è“ è“ç™½ ç»¿ æ£•ç™½ æ£• åœ¨è¿™é‡Œæˆ‘ä»¬å°±èƒ½å¤Ÿçœ‹å‡ºæ¥ï¼ŒAç±»çº¿åºå’ŒBç±»çº¿åºçš„åŒºåˆ«å°±åœ¨äºæ©™è‰²å’Œç»¿è‰²è¿™ä¸¤è‚¡çº¿çš„å¯¹åº”ä½ç½®è¿›è¡Œäº†å¯¹è°ƒã€‚ 2.3 ç›´é€šçº¿å’Œäº¤å‰çº¿ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬é»˜è®¤ä¸¤ç«¯çš„çº¿åºéƒ½æ˜¯T568Bç±»çš„ä¸ºç›´é€šçº¿ï¼Œè€Œä¸€ç«¯ä¸ºAç±»ï¼Œå¦ä¸€ç«¯ä¸ºBç±»çš„ä¸ºäº¤å‰çº¿ã€‚ é‚£ä¹ˆç›´é€šçº¿å’Œäº¤å‰çº¿çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿ åœ¨ç”¨é€”ä¸Šï¼Œç›´é€šçº¿ç”¨äºè¿æ¥ä¸åŒç§çš„è®¾å¤‡ï¼Œä¾‹å¦‚è¿æ¥ç”µè„‘å’Œäº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œè·¯ç”±å™¨ç­‰ï¼Œè€Œäº¤å‰çº¿ç”¨äºè¿æ¥åŒç§è®¾å¤‡ï¼Œä¾‹å¦‚ç”µè„‘å’Œç”µè„‘ä¹‹é—´ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸¤ç§çº¿å‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œå¦‚æœé€Ÿç‡ä¸è¶…è¿‡ç™¾å…†ï¼Œå³100Mbitï¼Œåªéœ€è¦åŒç»çº¿ä¸­çš„1236å››æ ¹çº¿æ­£å¸¸å·¥ä½œå³å¯ï¼Œå…¶ä¸­ä¸¤æ ¹è´Ÿè´£æ¥æ”¶/è¾“å…¥ï¼Œä¸¤æ ¹è´Ÿè´£å‘é€/è¾“å‡ºã€‚ çº¿å· ç”¨é€” 1 è¾“å‡ºæ•°æ®(+) 2 è¾“å‡ºæ•°æ®(-) 3 è¾“å…¥æ•°æ®(+) 6 è¾“å…¥æ•°æ®(-) é‚£ä¹ˆåœ¨åŒç§è®¾å¤‡è¿æ¥é€šä¿¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä¸€ç«¯çš„è¾“å‡ºè¾“å…¥çº¿åºå¯¹è°ƒï¼Œå³å¯å®ŒæˆåŒç§è®¾å¤‡ä¹‹é—´çš„è¿æ¥é€šä¿¡ã€‚ ä½†æ˜¯å¯¹äºç°åœ¨çš„ç½‘ç»œè®¾å¤‡æ¥è¯´ï¼Œå·²ç»æ²¡æœ‰å¿…è¦å†ä½¿ç”¨äº¤å‰çº¿äº†ï¼Œå› ä¸ºç°åœ¨çš„ç½‘å¡åŸºæœ¬éƒ½æ”¯æŒè‡ªåŠ¨ç¿»è½¬åŠŸèƒ½ï¼Œèƒ½å°†è‡ªåŠ¨å°†è¾“å…¥/è¾“å‡ºç«¯è¿›è¡Œå¯¹è°ƒï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬å¯¹åŒç»çº¿çš„çº¿åºè¿›è¡Œæ›´æ”¹ï¼Œå› æ­¤ç°åœ¨åŸºæœ¬éƒ½æ˜¯ç»Ÿä¸€ä½¿ç”¨ç›´é€šçº¿ï¼ˆä¸¤ç«¯éƒ½æ˜¯Bç±»çº¿åºï¼Œåˆ¶ä½œæ–¹ä¾¿ï¼Œä¸å®¹æ˜“ææ··ï¼‰ã€‚ 3ã€åˆ¶ä½œæ°´æ™¶å¤´3.1 å±è”½å’Œéå±è”½æ°´æ™¶å¤´æ°´æ™¶å¤´æŒ‰ç…§æ˜¯å¦å±è”½å¯ä»¥åˆ†ä¸ºå±è”½æ°´æ™¶å¤´å’Œéå±è”½æ°´æ™¶å¤´ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬æ—¥å¸¸æ¥è§¦åˆ°çš„åº”è¯¥éƒ½æ˜¯éå±è”½æ°´æ™¶å¤´ã€‚ å±è”½æ°´æ™¶å¤´æœ€æ˜æ˜¾çš„ç‰¹å¾å°±æ˜¯æ˜¯å…¨é‡‘å±æˆ–è€…éƒ¨åˆ†é‡‘å±ï¼Œå› ä¸ºéœ€è¦å’Œå±è”½çº¿ç¼†çš„å±è”½å±‚æ¥è§¦å®Œæˆå±è”½å·¥ä½œã€‚æ‰€ä»¥å±è”½æ°´æ™¶å¤´æ›´è´µä¸€äº›ï¼Œèƒ½å¤Ÿç”¨åœ¨å±è”½çº¿ï¼ˆSTPï¼‰å’Œéå±è”½çº¿ï¼ˆUTPï¼‰ä¸Šé¢ï¼Œè€Œéå±è”½æ°´æ™¶å¤´åªèƒ½ç”¨åœ¨éå±è”½çº¿ä¸Šï¼Œç”¨åœ¨å±è”½çº¿ä¸Šçš„è¯ä¼šä½¿å±è”½çº¿å¤±å»å±è”½æ•ˆæœã€‚ 3.2 ä»€ä¹ˆæ˜¯8P8C8P8Cï¼ˆ8 position 8 contactï¼‰çš„æ„æ€æ˜¯8ä¸ªä½ç½®ï¼ˆPositionï¼ŒæŒ‡8ä¸ªå‡¹æ§½ï¼‰ã€8ä¸ªè§¦ç‚¹ï¼ˆContactï¼ŒæŒ‡8ä¸ªé‡‘å±æ¥ç‚¹ï¼‰ï¼Œæ­£å¥½å’ŒåŒç»çº¿é‡Œé¢çš„8æ ¹çº¿ç›¸å¯¹åº”ï¼Œä¸€æ ¹çº¿ä¸€ä¸ªæ§½ä¸€ä¸ªè§¦ç‚¹ã€‚ ä½†æ˜¯åœ¨æ¯”è¾ƒä¹…ä¹‹å‰ï¼Œä¸€äº›å»‰ä»·çš„ç½‘çº¿ä¼šç¼©å‡é1236å·çº¿çš„çº¿èŠ¯ï¼ˆä½¿ç”¨å»‰ä»·ææ–™ï¼‰ï¼Œæœ‰çš„ç”šè‡³ç›´æ¥ä¸æ”¾4578å·çº¿ï¼Œä¸€æ ¹ç½‘çº¿é‡Œé¢åªæœ‰1236è¿™å››æ ¹çº¿ï¼Œè¿™äº›éƒ½æ˜¯å’Œç°åœ¨çš„ä¸»æµåƒå…†ç½‘é€Ÿæ‰€ä¸å…¼å®¹çš„é—ç•™äº§ç‰©ï¼Œå¤§å®¶é€‰è´­ç½‘çº¿çš„æ—¶å€™è¿˜æ˜¯è¦ä¹°å¯é çš„å¤§ç‰Œå­æˆ–è€…æ˜¯ä»å¯é çš„é€”å¾„è´­ä¹°ï¼Œåˆ‡å¿Œè´ªå°ä¾¿å®œè¯¯äº†å¤§äº‹å„¿ã€‚ 3.3 è¶…äº”ç±»å’Œå…­ç±»æ°´æ™¶å¤´åŒæ ·æ˜¯éå±è”½æ°´æ™¶å¤´çš„æƒ…å†µä¸‹ï¼Œè¶…äº”ç±»çš„æ°´æ™¶å¤´å’Œå…­ç±»æ°´æ™¶å¤´çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€ä¸åŒçš„åœ°æ–¹å°±æ˜¯ï¼Œå†…éƒ¨çš„é‡‘å±è§¦ç‚¹çš„æ’åˆ—æ–¹å¼ï¼Œç”±äºå…­ç±»çº¿çš„çº¤èŠ¯æ¯”è¶…äº”ç±»çš„è¦æ›´ç²—ï¼Œæ‰€ä»¥å…­ç±»æ°´æ™¶å¤´çš„å†…éƒ¨é‡‘å±è§¦ç‚¹æ˜¯ä¸Šä¸‹äº¤é”™æ’åˆ—ï¼Œè€Œè¶…äº”ç±»çš„æ˜¯æ°´å¹³ä¸€å­—æ’å¼€ã€‚ 3.4 åˆ¶ä½œæ°´æ™¶å¤´æˆ‘ä»¬æŠŠä¸Šä¸€æ­¥å‰¥å¼€çš„ç½‘çº¿æŒ‰ç…§é¡ºåºæ’åˆ—å¥½ï¼Œç„¶åç”¨å°–å˜´é’³æŠŠçº¿å¤´å‰ªé½ã€‚ â–½å¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºT568Bç±»çº¿åº â–½å¦‚ä¸‹å›¾æ‰€ç¤ºåˆ™ä¸ºT568Aç±»çº¿åº æˆ‘ä»¬ä»¥T568Bç±»çº¿åºä¸ºä¾‹ï¼Œå·¦æ‰‹æ‹¿åŒç»çº¿ï¼Œå³æ‰‹æ‹¿æ°´æ™¶å¤´ï¼Œæ³¨æ„é‡‘å±è§¦ç‚¹æ˜¯é¢å‘è‡ªå·±ï¼Œå¦åˆ™çº¿åºä¼šåšåã€‚ å°†åŒç»çº¿æ’å…¥æ°´æ™¶å¤´ï¼Œå¹¶ä¸”é¡¶åˆ°æœ€é‡Œé¢ï¼Œæ³¨æ„æ’è¿›å»çš„æ—¶å€™ä¸è¦æŠŠçº¿åºå¼„ä¹±äº†ï¼Œå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹é¡¶éƒ¨ç¡®å®šæ¯æ ¹çº¿éƒ½é¡¶åˆ°äº†æœ€é‡Œé¢å¹¶ä¸”çº¿åºæ˜¯æ­£ç¡®çš„ã€‚ å°†æ°´æ™¶å¤´æ”¾å…¥å‹çº¿é’³ï¼Œå‹çº¿é’³ä¹Ÿå’Œç½‘çº¿ä¸€æ ·åˆ†ä¸ºäº”ç±»å…­ç±»ä¸ƒç±»ç­‰ï¼Œé«˜ç­‰çº§çš„å¯ä»¥å‹åˆ¶ä½ç­‰çº§çš„æ°´æ™¶å¤´ï¼ˆä¸ƒç±»å¯ä»¥å‹åˆ¶å…­ç±»ï¼Œå…­ç±»ä¸ä¸€å®šèƒ½å‹åˆ¶ä¸ƒç±»ï¼‰ã€‚ æ°´æ™¶å¤´å‹åˆ¶å‰ä¸€å®šè¦ç¡®è®¤å¥½çº¿åºï¼Œå› ä¸ºä¸€æ—¦å‹ä¸‹å»äº†ï¼Œå‘ç°çº¿åºé”™äº†æˆ–è€…æœ‰éƒ¨åˆ†çº¿æ²¡æœ‰æ¥è§¦å¥½ï¼Œåªèƒ½æŠŠæ°´æ™¶å¤´å‰ªäº†é‡æ–°åˆ¶ä½œã€‚ è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¸ƒç±»çš„å‹çº¿é’³ï¼Œå‹åˆ¶å…­ç±»çº¿å®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚ å°†æ°´æ™¶å¤´æ’å…¥åˆ°æœ€é‡Œé¢ã€‚ ä½¿ç”¨å‹çº¿é’³ä¹‹å‰ï¼Œå…ˆæŠŠå‹çº¿é’³å‹åˆ°æœ€åº•éƒ¨ï¼Œç„¶åä¼šè‡ªåŠ¨å›å¼¹ï¼Œè¿™æ—¶å†æ’å…¥æ°´æ™¶å¤´ï¼Œå†å‹åˆ¶ï¼Œåªæœ‰å‹åˆ°åº•éƒ¨å‹å¥½äº†ï¼Œå‹çº¿é’³æ‰ä¼šè‡ªåŠ¨å›å¼¹ï¼Œè¿™æ—¶å€™å°±èƒ½ç¡®å®šæ°´æ™¶å¤´å·²ç»æ˜¯åšå¥½äº†ã€‚ 4ã€æµ‹çº¿æœ€åéœ€è¦ä½¿ç”¨æµ‹çº¿ä»ªè¿›è¡Œæµ‹çº¿æ£€æµ‹æ˜¯å¦æ­£å¸¸ã€‚ä¸€èˆ¬çš„æµ‹çº¿ä»ªèƒ½è¿›è¡Œå•ç«¯æµ‹çº¿å’Œä¸¤ç«¯æµ‹çº¿ã€‚æµ‹çº¿ä»ªä¸Šé¢æ ‡ç€çš„1-8å·ç¯åˆ†åˆ«å¯¹åº”1-8å·çº¿ï¼ŒGå¯¹åº”çš„æ˜¯å±è”½çº¿çš„å±è”½å±‚ã€‚ å¦‚æœæ˜¯åˆ¶ä½œçš„ç›´é€šçº¿ï¼Œä¸¤ç«¯çš„ç¯åŒæ—¶æŒ‰ç…§1-8çš„é¡ºåºäº®èµ·å°±æ˜¯æ­£å¸¸çš„ï¼Œè€Œå¦‚æœåšçš„æ˜¯äº¤å‰çº¿ï¼Œåˆ™æµ‹çº¿ä»ªçš„ä¸»ç«¯ï¼ˆå‘å°„ç«¯ï¼‰è¿˜æ˜¯ä¼šæŒ‰ç…§1-8çš„é¡ºåºäº®ç¯ï¼Œå°ç«¯ï¼ˆæ¥æ”¶ç«¯ï¼‰åˆ™äº®ç¯çš„é¡ºåºæœ‰æ‰€ä¸åŒï¼Œå…·ä½“å‚è€ƒä¸‹è¡¨ã€‚ ä¸»ç«¯ï¼ˆå‘å°„ç«¯ï¼‰ å°ç«¯ï¼ˆæ¥æ”¶ç«¯ï¼‰ 1 3 2 6 3 1 4 4 5 5 6 2 7 7 8 8 æµ‹çº¿é€šè¿‡ä¹‹åï¼Œç½‘çº¿å°±ç®—æ˜¯åˆ¶ä½œå¥½äº†ï¼Œå¯ä»¥æ„‰å¿«åœ°ä¸Šç½‘å•¦ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"}]},{"title":"å°ç±³MIX2åˆ·è°·æ­Œç›¸æœº","slug":"20190401-mix2-install-google-camera","date":"2019-04-01T07:00:00.000Z","updated":"2019-04-01T07:00:00.000Z","comments":true,"path":"20190401-mix2-install-google-camera/","link":"","permalink":"https://tinychen.com/20190401-mix2-install-google-camera/","excerpt":"è®°å½•ä¸€ä¸‹å°ç±³MIX2ä»MIUIç¨³å®šç‰ˆâ†’è§£é”BLâ†’åˆ·å…¥MIUIå¼€å‘ç‰ˆâ†’è·å–ROOTæƒé™â†’å®‰è£…Googleç›¸æœºçš„å…¨è¿‡ç¨‹ã€‚","text":"è®°å½•ä¸€ä¸‹å°ç±³MIX2ä»MIUIç¨³å®šç‰ˆâ†’è§£é”BLâ†’åˆ·å…¥MIUIå¼€å‘ç‰ˆâ†’è·å–ROOTæƒé™â†’å®‰è£…Googleç›¸æœºçš„å…¨è¿‡ç¨‹ã€‚ 1ã€è§£é”BLå°ç±³MIX2æœ‰BLé”ï¼Œå› æ­¤éœ€è¦å…ˆå»å®˜ç½‘ç”³è¯·è§£é”BL http://www.miui.com/unlock/index.html åœ¨ä¸€ç³»åˆ—éªšæ“ä½œè·å¾—äº†è§£é”èµ„æ ¼ä¹‹åï¼Œä¸‹è½½è§£é”å·¥å…·ï¼ŒæŒ‰ç…§æŒ‡ç¤ºæ¥è¿›è¡Œè§£é”ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¼šæ¸…é™¤æ‰æ‰‹æœºä¸Šçš„æ‰€æœ‰æ•°æ®ï¼ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¼šæ¸…é™¤æ‰æ‰‹æœºä¸Šçš„æ‰€æœ‰æ•°æ®ï¼ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¼šæ¸…é™¤æ‰æ‰‹æœºä¸Šçš„æ‰€æœ‰æ•°æ®ï¼ è§£é”BLä¹‹åæ²¡æœ‰é‚£ä¹ˆå®‰å…¨äº†ï¼Œå› æ­¤éœ€è¦å°†è¿™å°æ‰‹æœºå’Œå°ç±³è´¦å·è¿›è¡Œç»‘å®šï¼Œä¹‹åæ¯æ¬¡é‡ç½®æ‰‹æœºéƒ½éœ€è¦è¾“å…¥å¯¹åº”ç»‘å®šçš„å°ç±³è´¦å·çš„å¯†ç ï¼Œå› æ­¤è¿™é‡Œè®¾ç½®çš„å°ç±³è´¦å·çš„å¯†ç ä¸€å®šè¦è®°ä½äº†ã€‚ ä¸‹è½½çš„è§£é”BLå·¥å…·åŒ…ä¸­æœ‰é©±åŠ¨å’Œè§£é”å·¥å…·ï¼Œå»ºè®®å…ˆè¿›å…¥BLæ¨¡å¼ï¼Œç„¶åå®‰è£…é©±åŠ¨ï¼Œå†è¿›è¡Œè§£é”BLæ“ä½œã€‚ è§£é”BLæˆåŠŸä¹‹åï¼Œæ‰‹æœºä¼šé‡ç½®ï¼Œéœ€è¦è¿›è¡Œé‡æ–°è®¾ç½®ï¼Œç›¸å½“äºåˆšä¹°å›æ‰‹æœºçš„æ—¶å€™ã€‚è¿™æ—¶å€™éšä¾¿è®¾ç½®ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œå› ä¸ºå¾…ä¼šå„¿è¿˜è¦åˆ·å…¥å¼€å‘ç‰ˆï¼Œè¿˜è¦é‡æ–°è®¾ç½®ä¸€æ¬¡ã€‚ 2ã€åˆ·å…¥MIUIå¼€å‘ç‰ˆ2.1 ä¸‹è½½åˆ·æœºåŒ…å’Œå·¥å…·é¦–å…ˆå‰å¾€å®˜ç½‘ä¸‹è½½å¼€å‘ç‰ˆçš„åˆ·æœºåŒ…å’Œçº¿åˆ·å·¥å…·ï¼Œä½¿ç”¨çº¿åˆ·åˆ·å…¥ã€‚ http://www.miui.com/shuaji-393.html 2.2 è¿›å…¥Fastbootæ¨¡å¼å…³æœºçŠ¶æ€ä¸‹ï¼ŒåŒæ—¶æŒ‰ä½ éŸ³é‡ä¸‹+ç”µæºé”® è¿›å…¥Fastbootæ¨¡å¼å°†æ‰‹æœºUSBè¿æ¥ç”µè„‘ã€‚ 2.3 åˆ·å…¥åˆ·æœºåŒ…æ‰“å¼€åˆ·æœºå·¥å…·ï¼Œè¿™é‡Œæç¤ºéœ€è¦å®‰è£…ä¸€äº›é©±åŠ¨ï¼Œç‚¹å‡»Installå®‰è£…å³å¯ã€‚ å¯¹ä¸‹è½½å®Œçš„tarå‹ç¼©åŒ…è¿›è¡ŒäºŒæ¬¡è§£å‹ï¼Œæœ€åå¾—åˆ°çš„æ–‡ä»¶å¤¹ç›®å½•åº”è¯¥ç±»ä¼¼ä¸‹é¢çš„å›¾ç‰‡ã€‚ æ‰“å¼€åˆ·æœºå·¥å…·é€‰æ‹©è§£å‹ç”Ÿæˆçš„æ–‡ä»¶å¤¹ï¼Œå³ä¸‹è§’è¦æ‰‹åŠ¨é€‰æ‹©clean allè€Œä¸æ˜¯clean all and lockï¼Œlockä¼šå†æ¬¡å¯¹BLä¸Šé”ï¼Œæ­¤æ—¶ä¹‹å‰çš„è§£é”æ“ä½œå°±ç™½å¿™æ´»äº†ã€‚ ç¡®è®¤ä¸Šé¢çš„å‡ å¤„ä½ç½®éƒ½æ²¡æœ‰é—®é¢˜ä¹‹åï¼Œæˆ‘ä»¬ç‚¹å‡»flashè¿›è¡Œåˆ·æœºï¼Œæ­¤æ—¶éœ€è¦è€å¿ƒç­‰å¾…ä¸€å°ä¼šå„¿ã€‚ åˆ·æœºæˆåŠŸä¹‹åæ‰‹æœºä¼šè‡ªåŠ¨é‡å¯è¿›å…¥è®¾ç½®ç•Œé¢ï¼Œè¿™æ¬¡æˆ‘ä»¬å¯ä»¥è®¤çœŸæŒ‰ç…§è‡ªå·±çš„éœ€è¦è¿›è¡Œè®¾ç½®ã€‚ 3ã€è·å–ROOTæƒé™MIUIçš„å¼€å‘ç‰ˆå¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å–ROOTæƒé™ï¼Œè™½ç„¶è¯´æ˜¯é˜‰å‰²ç‰ˆçš„ROOTï¼Œä½†æ˜¯ä¹Ÿå¤Ÿè°·æ­Œç›¸æœºä½¿ç”¨äº†ã€‚ æˆ‘ä»¬æ‰“å¼€æ‰‹æœºå†…ç½®çš„å®‰å…¨ä¸­å¿ƒï¼Œé€‰æ‹©åº”ç”¨ç®¡ç†ï¼Œç‚¹å‡»æƒé™ï¼Œé€‰æ‹©å¼€å¯ROOTæƒé™ï¼Œè¿™æ—¶å€™ä¼šä¸‹è½½ROOTåŒ…å¹¶ä¸”é‡å¯å®‰è£…ã€‚ 4ã€å®‰è£…è°·æ­Œå…¨å®¶æ¡¶é¦–å…ˆä¿è¯æ‰‹æœºå¯ä»¥æ­£å¸¸è®¿é—®Googleï¼ˆéœ€è¦ç§‘å­¦ä¸Šç½‘ï¼‰ï¼Œç„¶åè¿›å…¥åº”ç”¨å•†åº—ï¼ˆæ¨èå®‰æ™ºï¼‰ï¼Œæœç´¢è°·æ­Œå®‰è£…å™¨ä¸‹è½½å®‰è£…è°·æ­Œå…¨å®¶æ¡¶ã€‚ å®‰è£…å¥½å…¨å®¶æ¡¶ä¹‹åï¼Œç™»å½•è°·æ­Œè´¦æˆ·ï¼Œç¡®è®¤èƒ½æ­£å¸¸è®¿é—®GooglePlayå•†åº—ï¼Œå³å¯è¿›å…¥ä¸‹ä¸€æ­¥ã€‚ 5ã€å®‰è£…ç»ˆç«¯æ¨¡æ‹Ÿå™¨å®‰è£…ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼ˆä¸‹è½½é“¾æ¥åœ¨åé¢ï¼‰ï¼Œåœ¨çª—å£è¾“å…¥ 1su è¿™æ—¶ç³»ç»Ÿä¼šæç¤ºç»ˆç«¯æ¨¡æ‹Ÿå™¨è·å–ROOTæƒé™è¢«æ‹’ç»ï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€å®‰å…¨ä¸­å¿ƒçš„æƒé™ç®¡ç†â†’ROOTæƒé™ç®¡ç†ï¼Œæ‰‹åŠ¨ç»™å®ƒæˆäºˆROOTæƒé™ã€‚ æ­¤æ—¶æˆ‘ä»¬å†æ‰“å¼€ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œå†æ¬¡è¾“å…¥ 12su#åˆ‡æ¢åˆ°è¶…çº§ç”¨æˆ·æ¨¡å¼ 12setprop persist.camera.HAL3.enabled 1#å¼€å¯HAL3çš„æ”¯æŒ 12setprop persist.camera.eis.enable 1#å¼€å¯EISçš„æ”¯æŒ 12getprop persist.camera.HAL3.enabled#è¿”å›1åˆ™æˆåŠŸï¼Œå¦åˆ™é‡å¯æ‰‹æœºå†æ¬¡å°è¯• 6ã€å®‰è£…è°·æ­Œç›¸æœºè°·æ­Œç›¸æœºå’Œç»ˆç«¯æ¨¡æ‹Ÿå™¨çš„ä¸‹è½½åœ°å€åœ¨è¿™é‡Œï¼ˆMIX2ç‰ˆï¼‰ é“¾æ¥ï¼šhttps://pan.baidu.com/s/1T-4_eXkiiFSwX03axsppZAæå–ç ï¼šeo6r ä¸‹è½½åç›´æ¥å®‰è£…å³å¯ï¼Œæ‰“å¼€è®¾ç½®å¾®è°ƒä¸€ä¸‹HDRï¼Œå°±èƒ½ä½“éªŒè°·æ­Œç›¸æœºçš„å˜æ€çº§å¤œæ™¯æ¨¡å¼å’ŒHDR+äº†ã€‚ 7ã€æ•ˆæœå¯¹æ¯”ä¸Šé¢çš„æ˜¯å°ç±³è‡ªå¸¦çš„ç›¸æœºï¼Œä¸‹é¢çš„æ˜¯è°·æ­Œç›¸æœºï¼Œéƒ½æ‰“å¼€äº†å¤œæ™¯æ¨¡å¼ï¼Œè°·æ­Œçš„è¿˜å¤šäº†ä¸€ä¸ªHDR+ï¼Œå°ç±³çš„è²Œä¼¼ä¸èƒ½åŒæ—¶ä½¿ç”¨å¤œæ™¯å¢å¼ºå’ŒHDRã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"android","slug":"android","permalink":"https://tinychen.com/tags/android/"}]},{"title":"100æ¡è®¡ç®—æœºç½‘ç»œåŸºæœ¬çŸ¥è¯†ï¼ˆä¸‹ï¼‰","slug":"20190331-base-know-of-cn-2","date":"2019-03-31T07:00:00.000Z","updated":"2019-03-31T07:00:00.000Z","comments":true,"path":"20190331-base-know-of-cn-2/","link":"","permalink":"https://tinychen.com/20190331-base-know-of-cn-2/","excerpt":"ç®€å•ä»‹ç»ä¸€ç™¾æ¡å…³äºè®¡ç®—æœºç½‘ç»œçš„åŸºæœ¬çŸ¥è¯†ã€‚ç”±äºå¤ªé•¿äº†ï¼Œåˆ†æˆäº†ä¸Šä¸‹ä¸¤ç¯‡ï¼Œæ¯ç¯‡50æ¡ã€‚","text":"ç®€å•ä»‹ç»ä¸€ç™¾æ¡å…³äºè®¡ç®—æœºç½‘ç»œçš„åŸºæœ¬çŸ¥è¯†ã€‚ç”±äºå¤ªé•¿äº†ï¼Œåˆ†æˆäº†ä¸Šä¸‹ä¸¤ç¯‡ï¼Œæ¯ç¯‡50æ¡ã€‚ 51ã€å½“åœ¨ä¸åŒçš„å¹³å°ï¼ˆå¦‚UNIXå’ŒWindowsï¼‰ä¹‹é—´ä¼ è¾“æ–‡ä»¶æ—¶ï¼Œå¯ä»¥åº”ç”¨ä»€ä¹ˆåè®®ï¼Ÿä½¿ç”¨FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼ˆè‹±æ–‡ï¼šFile Transfer Protocolï¼‰ï¼‰åè®®åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæ–‡ä»¶ä¼ è¾“æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºFTPæ˜¯å¹³å°æ— å…³çš„ã€‚ 52ã€é»˜è®¤ç½‘å…³æ˜¯ä»€ä¹ˆï¼Ÿé»˜è®¤ç½‘å…³ï¼ˆDefault Gatewayï¼‰æä¾›äº†æœ¬åœ°ç½‘ç»œè¿æ¥åˆ°å¤–éƒ¨ç½‘ç»œçš„æ–¹æ³•ã€‚ç”¨äºè¿æ¥å¤–éƒ¨ç½‘ç»œçš„é»˜è®¤ç½‘å…³é€šå¸¸æ˜¯å¤–éƒ¨è·¯ç”±å™¨ç«¯å£çš„åœ°å€ã€‚ 53ã€ä¿æŠ¤ç½‘ç»œçš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å¯†ç ã€‚ä»€ä¹ˆå¯ä»¥è¢«è®¤ä¸ºæ˜¯å¥½çš„å¯†ç ï¼Ÿè‰¯å¥½çš„å¯†ç ä¸ä»…ç”±å­—æ¯ç»„æˆï¼Œè¿˜åŒ…æ‹¬å­—æ¯å’Œæ•°å­—çš„ç»„åˆï¼Œç»“åˆå¤§å°å†™å­—æ¯çš„å¯†ç æ¯”ä½¿ç”¨æ‰€æœ‰å¤§å†™å­—æ¯æˆ–å…¨éƒ¨å°å†™å­—æ¯çš„å¯†ç æœ‰åˆ©ã€‚å¯†ç å¿…é¡»ä¸èƒ½è¢«é»‘å®¢å¾ˆå®¹æ˜“çŒœåˆ°ï¼Œæ¯”å¦‚æ—¥æœŸã€å§“åã€æ”¶è—å¤¹ç­‰ç­‰ã€‚ 54ã€UTPç”µç¼†çš„æ­£ç¡®ç»ˆæ­¢ç‡æ˜¯å¤šå°‘ï¼Ÿéå±è”½åŒç»çº¿çš„æ­£å¸¸ç»ˆæ­¢æ˜¯100æ¬§å§†ã€‚ 55ã€ä»€ä¹ˆæ˜¯ netstat?Netstat æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®ç”¨ç¨‹åºã€‚å®ƒæä¾›æœ‰å…³è¿æ¥å½“å‰ TCP/IP è®¾ç½®çš„æœ‰ç”¨ä¿¡æ¯ã€‚ 56ã€C ç±»ç½‘ç»œä¸­çš„ç½‘ç»œ ID æ•°é‡æ˜¯å¤šå°‘?Cç±»ç½‘æ®µè®¡ç®—ï¼šæ ¹æ®è§„å®šï¼ŒCç±»åœ°å€çš„ç½‘ç»œæ ‡è¯†å¿…é¡»ä»¥â€œ110â€å¼€å¤´ã€‚é‚£ä¹ˆå…¶ç½‘æ®µæ•°åº”è¯¥ä¸º110XXXXXï¼XXXXXXXXï¼XXXXXXXXï¼YYYYYYYYå³åé¢æœ‰21ä½æ•°å­—ï¼Œå› ä¸ºæ˜¯äºŒè¿›åˆ¶æ•°ï¼Œæ‰€ä»¥ç½‘æ®µæ•°åº”è¯¥ä¸ºï¼š221ï¼Œå³2çš„21æ¬¡å¹‚ä¸ªç½‘æ®µï¼Œç­‰äº2097152ï¼Œæ‰€ä»¥Bç±»ç½‘ç»œå¯ä»¥æœ‰2097152ä¸ªç½‘æ®µã€‚Cç±»ä¸»æœºæ•°è®¡ç®—ï¼šå› ä¸ºåé¢8ä½æ˜¯ä¸»æœºæ ‡è¯†ï¼Œæ‰€ä»¥ä¸»æœºæ•°åº”è¯¥æ˜¯28ï¼Œå³2çš„8æ¬¡å¹‚=256ï¼Œæ‰£é™¤ä¸¤ä¸ªä¿ç•™åœ°å€åï¼Œä¸»æœºæœ€å¤§æ•°åº”è¯¥æ˜¯254ä¸ªã€‚ å…¨ä¸º0å’Œå…¨ä¸º1çš„ä¸ºä¿ç•™åœ°å€ã€‚ 57ã€ä½¿ç”¨é•¿äºè§„å®šé•¿åº¦çš„ç”µç¼†æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ?ç”µç¼†å¤ªé•¿ä¼šå¯¼è‡´ä¿¡å·ä¸¢å¤±ã€‚è¿™æ„å‘³ç€æ•°æ®ä¼ è¾“å’Œæ¥æ”¶å°†å—åˆ°å½±å“ï¼Œå› ä¸ºä¿¡å·é•¿åº¦ä¸‹é™ã€‚ 58ã€ä»€ä¹ˆå¸¸è§çš„è½¯ä»¶é—®é¢˜å¯èƒ½å¯¼è‡´ç½‘ç»œç¼ºé™·?è½¯ä»¶ç›¸å…³é—®é¢˜å¯ä»¥æ˜¯ä»¥ä¸‹ä»»ä½•ä¸€ç§æˆ–å…¶ç»„åˆï¼š å®¢æˆ·ç«¯æœåŠ¡å™¨é—®é¢˜ åº”ç”¨ç¨‹åºå†²çª é…ç½®é”™è¯¯ åè®®ä¸åŒ¹é… å®‰å…¨é—®é¢˜ ç”¨æˆ·æ”¿ç­–å’Œæƒåˆ©é—®é¢˜ 59ã€ä»€ä¹ˆæ˜¯ ICMP?ICMP æ˜¯ï¼ˆInternet Control Message Protocolï¼‰Internetæ§åˆ¶æŠ¥æ–‡åè®®ã€‚å®ƒä¸º TCP/IP åè®®æ ˆå†…çš„åè®®æä¾›æ¶ˆæ¯ä¼ é€’å’Œé€šä¿¡ã€‚è¿™ä¹Ÿæ˜¯ç®¡ç†ç”± PING ç­‰ç½‘ç»œå·¥å…·ä½¿ç”¨çš„é”™è¯¯ä¿¡æ¯çš„åè®®ã€‚ 60ã€ä»€ä¹ˆæ˜¯ Ping?Ping æ˜¯ä¸€ä¸ªå®ç”¨ç¨‹åºï¼Œå…è®¸æ‚¨æ£€æŸ¥ç½‘ç»œä¸Šçš„ç½‘ç»œè®¾å¤‡ä¹‹é—´çš„è¿æ¥ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å…¶ IP åœ°å€æˆ–è®¾å¤‡åç§° (å¦‚è®¡ç®—æœºåç§°)ping è®¾å¤‡ã€‚ 61ã€ä»€ä¹ˆæ˜¯ç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼‰ï¼Ÿå¯¹ç­‰ç½‘ç»œï¼ˆPeer-to-peer networkingï¼‰æˆ–å¯¹ç­‰è®¡ç®—ï¼ˆPeer-to-peer computingï¼‰ï¼Œå…¶å¯ä»¥å®šä¹‰ä¸ºï¼šç½‘ç»œçš„å‚ä¸è€…å…±äº«ä»–ä»¬æ‰€æ‹¥æœ‰çš„ä¸€éƒ¨åˆ†ç¡¬ä»¶èµ„æºï¼ˆå¤„ç†èƒ½åŠ›ã€å­˜å‚¨èƒ½åŠ›ã€ç½‘ç»œè¿æ¥èƒ½åŠ›ã€æ‰“å°æœºç­‰ï¼‰ï¼Œè¿™äº›å…±äº«èµ„æºé€šè¿‡ç½‘ç»œæä¾›æœåŠ¡å’Œå†…å®¹ï¼Œèƒ½è¢«å…¶å®ƒå¯¹ç­‰èŠ‚ç‚¹ï¼ˆPeerï¼‰ç›´æ¥è®¿é—®è€Œæ— éœ€ç»è¿‡ä¸­é—´å®ä½“ã€‚åœ¨æ­¤ç½‘ç»œä¸­çš„å‚ä¸è€…æ—¢æ˜¯èµ„æºã€æœåŠ¡å’Œå†…å®¹çš„æä¾›è€…ï¼ˆServerï¼‰ï¼Œåˆæ˜¯èµ„æºã€æœåŠ¡å’Œå†…å®¹çš„è·å–è€…ï¼ˆClientï¼‰ ã€‚ è¯¥ç½‘ç»œä¸Šçš„æ‰€æœ‰PCéƒ½æ˜¯å•ç‹¬çš„å·¥ä½œç«™/æœåŠ¡å™¨ã€‚ 62ã€ä»€ä¹ˆæ˜¯DNSï¼ŸåŸŸåç³»ç»Ÿï¼ˆè‹±æ–‡ï¼šDomain Name Systemï¼Œç¼©å†™ï¼šDNSï¼‰ï¼Œè¯¥ç½‘ç»œä¸Šçš„æ‰€æœ‰PCéƒ½æ˜¯å•ç‹¬çš„å·¥ä½œç«™ã€‚ 63ã€å…‰çº¤ä¸å…¶ä»–ä»‹è´¨æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿå…‰çº¤çš„ä¸€ä¸ªä¸»è¦ä¼˜ç‚¹æ˜¯ä¸å¤ªå®¹æ˜“æ”¶åˆ°ç”µæ°”å¹²æ‰°ï¼ˆä½¿ç”¨äºŒæ°§åŒ–ç¡…ä½œä¸ºä»‹è´¨ä¼ å¯¼å…‰ä¿¡å·ï¼‰ï¼Œå®ƒè¿˜æ”¯æŒæ›´é«˜çš„å¸¦å®½ï¼Œæ„å‘³ç€å¯ä»¥å‘é€å’Œæ¥æ”¶æ›´å¤šçš„æ•°æ®ï¼Œé•¿è·ç¦»ä¿¡å·é™çº§ä¹Ÿéå¸¸å°ã€‚ 64ã€é›†çº¿å™¨å’Œäº¤æ¢æœºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿé›†çº¿å™¨ä¸­æ‰€æœ‰çš„ç«¯å£ä¸ºåŒä¸€ä¸ªå†²çªåŸŸï¼Œè€Œäº¤æ¢æœºä¸­æ¯ä¸ªç«¯å£éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„å†²çªåŸŸã€‚ é›†çº¿å™¨å……å½“å¤šç«¯å£ä¸­ç»§å™¨ï¼Œç„¶è€Œï¼Œéšç€è¶Šæ¥è¶Šå¤šçš„è®¾å¤‡è¿æ¥åˆ°å®ƒï¼Œå®ƒå°†æ— æ³•æœ‰æ•ˆåœ°ç®¡ç†é€šè¿‡å®ƒçš„æµé‡ã€‚äº¤æ¢æœºæä¾›äº†ä¸€ä¸ªæ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå¯ä»¥æé«˜æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨æ‰€æœ‰ç«¯å£ä¸Šé¢„æœŸç”±é«˜æµé‡æ—¶ã€‚ 65ã€Windows RRASæœåŠ¡æ”¯æŒçš„ä¸åŒç½‘ç»œåè®®æ˜¯ä»€ä¹ˆï¼Ÿè·¯ç”±å’Œè¿œç¨‹è®¿é—®æœåŠ¡å™¨ï¼ˆRouting and Remote Access Serviceï¼‰æ”¯æŒä¸‰ç§ä¸»è¦çš„ç½‘ç»œåè®®ï¼šNetBEUIï¼ŒTCP/IPå’ŒIPXã€‚ NetBEUIï¼Œå³NetBios Enhanced User Interfaceï¼Œæˆ–NetBioså¢å¼ºç”¨æˆ·æ¥å£ã€‚å®ƒæ˜¯NetBIOSåè®®çš„å¢å¼ºç‰ˆæœ¬ï¼Œæ›¾è¢«è®¸å¤šæ“ä½œç³»ç»Ÿé‡‡ç”¨ï¼Œä¾‹å¦‚Windows for Workgroupã€Win 9xç³»åˆ—ã€Windows NTç­‰ã€‚NETBEUIæ˜¯ä¸ºIBMå¼€å‘çš„éè·¯ç”±åè®®ï¼Œç”¨äºæºå¸¦NETBIOSé€šä¿¡ã€‚ IPXï¼ˆInternetwork Packet Exchange protocolï¼Œäº’è”ç½‘åˆ†ç»„äº¤æ¢åè®®ï¼‰ï¼ŒIPXåè®®ä¸IPåè®®æ˜¯ä¸¤ç§ä¸åŒçš„ç½‘ç»œå±‚åè®®ï¼Œå®ƒä»¬çš„è·¯ç”±åè®®ä¹Ÿä¸ä¸€æ ·ï¼ŒIPXçš„è·¯ç”±åè®®ä¸åƒIPçš„è·¯ç”±åè®®é‚£æ ·ä¸°å¯Œï¼Œæ‰€ä»¥è®¾ç½®èµ·æ¥æ¯”è¾ƒç®€å•ã€‚ä½†IPXåè®®åœ¨ä»¥å¤ªç½‘ä¸Šè¿è¡Œæ—¶å¿…é¡»æŒ‡å®šå°è£…å½¢å¼ã€‚ 66ã€ABCä¸‰ç±»ç½‘ç»œä¸­çš„æœ€å¤§ç½‘ç»œå’Œä¸»æœºæ˜¯ä»€ä¹ˆï¼Ÿ ç½‘ç»œç±»åˆ« å¯èƒ½çš„ç½‘ç»œ æœ€å¤§ä¸»æœºæ•° A 126 16,777,214(2çš„24æ¬¡æ–¹å‡2) B 16,384 65,534ï¼ˆ2çš„16æ¬¡æ–¹å‡2ï¼‰ C 2,097,152 254ï¼ˆ2çš„8æ¬¡æ–¹å‡2ï¼‰ ç»“åˆ35é¢˜å’Œ56é¢˜çš„è¡¨æ ¼å’Œè§£ç­”æ•°æ®ä¸éš¾ç®—å‡ºä¸Šè¡¨ä¸­çš„æ•°æ®ã€‚ 67ã€ç›´é€šç”µç¼†çš„æ ‡å‡†é¢œè‰²é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿä¸€èˆ¬é‡‡ç”¨T568Bç±»æ ‡å‡†ï¼Œå…·ä½“çº¿åºä¸ºï¼šæ©™ç™½ã€æ©™ã€ç»¿ç™½ã€è“ã€è“ç™½ã€ç»¿ã€æ£•ç™½ã€æ£• 68ã€ä»€ä¹ˆåè®®å±äºTCP/IPåè®®æ ˆçš„åº”ç”¨å±‚ï¼Ÿä»¥ä¸‹æ˜¯TCP/IPåº”ç”¨å±‚åè®®ï¼šFTP,TFTP,Telnetå’ŒSMTPã€‚ 69ã€å¯å¦ä¸ä½¿ç”¨é›†çº¿å™¨æˆ–è·¯ç”±å™¨è€Œç›´æ¥è¿æ¥ä¸¤å°ç”µè„‘è¿›è¡Œæ–‡ä»¶å…±äº«ï¼Ÿå¯ä»¥ï¼Œä½¿ç”¨äº¤å‰å‹ç”µç¼†ç›´æ¥è¿æ¥ä¸¤å°ç”µè„‘çš„ç½‘å¡å³å¯ã€‚æ­¤æ—¶ä¸€æ¡äº¤å‰å‹ç”µç¼†çš„ä¸¤å¤´çš„æ•°æ®å‘é€å’Œæ¥æ”¶çš„å¼•è„šå¯¹è°ƒã€‚ 70ã€ä»€ä¹ˆæ˜¯ipconfigï¼Ÿipconfigæ˜¯ä¸€ä¸ªå¸¸ç”¨äºè¯†åˆ«ç½‘ç»œä¸Šè®¡ç®—æœºçš„åœ°å€ä¿¡æ¯çš„å®ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºMACåœ°å€ã€IPåœ°å€ã€å­ç½‘æ©ç ç­‰å„ç§ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657$ ipconfig -helpError: unrecognized or incomplete command line.USAGE: ipconfig [/allcompartments] [/? | /all | /renew [adapter] | /release [adapter] | /renew6 [adapter] | /release6 [adapter] | /flushdns | /displaydns | /registerdns | /showclassid adapter | /setclassid adapter [classid] | /showclassid6 adapter | /setclassid6 adapter [classid] ]where adapter Connection name (wildcard characters * and ? allowed, see examples) Options: /? Display this help message /all Display full configuration information. /release Release the IPv4 address for the specified adapter. /release6 Release the IPv6 address for the specified adapter. /renew Renew the IPv4 address for the specified adapter. /renew6 Renew the IPv6 address for the specified adapter. /flushdns Purges the DNS Resolver cache. /registerdns Refreshes all DHCP leases and re-registers DNS names /displaydns Display the contents of the DNS Resolver Cache. /showclassid Displays all the dhcp class IDs allowed for adapter. /setclassid Modifies the dhcp class id. /showclassid6 Displays all the IPv6 DHCP class IDs allowed for adapter. /setclassid6 Modifies the IPv6 DHCP class id.The default is to display only the IP address, subnet mask anddefault gateway for each adapter bound to TCP/IP.For Release and Renew, if no adapter name is specified, then the IP addressleases for all adapters bound to TCP/IP will be released or renewed.For Setclassid and Setclassid6, if no ClassId is specified, then the ClassId is removed.Examples: &gt; ipconfig ... Show information &gt; ipconfig /all ... Show detailed information &gt; ipconfig /renew ... renew all adapters &gt; ipconfig /renew EL* ... renew any connection that has its name starting with EL &gt; ipconfig /release *Con* ... release all matching connections, eg. &quot;Wired Ethernet Connection 1&quot; or &quot;Wired Ethernet Connection 2&quot; &gt; ipconfig /allcompartments ... Show information about all compartments &gt; ipconfig /allcompartments /all ... Show detailed information about all compartments 71ã€ç›´é€šå’Œäº¤å‰å‹ç”µç¼†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç‰©ç†ä¸Šï¼Œç›´é€šå‹ç”µç¼†ä¸¤å¤´çš„çº¿åºç›¸åŒï¼ˆå›½å†…ä¸€èˆ¬å‡ä¸ºT568Bç±»æ¥æ³•ï¼‰ï¼Œè€Œäº¤å‰å‹ç”µç¼†ä¸¤å¤´çš„çº¿åºä¸åŒï¼Œæ¥æ”¶ç«¯å’Œå‘å°„ç«¯å¯¹è°ƒï¼ˆå›½å†…ä¸€èˆ¬æ˜¯ä¸€å¤´ä¸ºT568Aå¦ä¸€å¤´ä¸ºT568Bï¼‰ã€‚ ç”¨é€”ä¸Šï¼Œç›´é€šå‹ç”µç¼†è¿æ¥ä¸åŒç±»å‹è®¾å¤‡ï¼Œå¦‚ç”µè„‘å’Œäº¤æ¢æœºä¹‹é—´çš„è¿æ¥ï¼›äº¤å‰å‹ç”µç¼†è¿æ¥åŒç±»å‹è®¾å¤‡ï¼Œå¦‚ç”µè„‘å’Œç”µè„‘ç›´è¿ã€‚ ç°åœ¨çš„æ–°å‹ç½‘å¡åŸºæœ¬éƒ½æ”¯æŒè‡ªåŠ¨ç¿»è½¬åŠŸèƒ½ï¼Œèƒ½è‡ªåŠ¨è¯†åˆ«ç¿»è½¬æ¥æ”¶ç«¯å’Œå‘å°„ç«¯çš„çº¿åºï¼Œå› æ­¤æ™®ééƒ½ä½¿ç”¨T568Bç±»çº¿åºçš„ç›´é€šå‹ç”µç¼†æ¥è¿æ¥å„ç§è®¾å¤‡ã€‚ 72ã€ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼Ÿå®¢æˆ·ç«¯/æœåŠ¡ç«¯æ˜¯ä¸€ç§ç±»å‹çš„ç½‘ç»œï¼Œå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªè®¡ç®—æœºå……å½“æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æä¾›é›†ä¸­çš„èµ„æºåº“ï¼Œå¦‚æ‰“å°æœºå’Œæ–‡ä»¶ç­‰ã€‚å®¢æˆ·ç«¯æ˜¯æŒ‡è®¿é—®æœåŠ¡å™¨çš„å·¥ä½œç«™ã€‚ 73ã€æè¿°ç½‘ç»œã€‚ç½‘ç»œæ˜¯æŒ‡ç”¨äºæ•°æ®é€šä¿¡çš„è®¡ç®—æœºå’Œå¤–å›´è®¾å¤‡ä¹‹é—´çš„äº’è¿ï¼Œå¯ä»¥ä½¿ç”¨æœ‰çº¿ç”µç¼†æˆ–é€šè¿‡æ— çº¿é“¾è·¯è¿›è¡Œç½‘ç»œè¿æ¥ã€‚ 74ã€å°†NICå¡ä»ä¸€å°PCç§»åŠ¨åˆ°å¦ä¸€å°PCæ—¶ï¼ŒMACåœ°å€æ˜¯å¦ä¹Ÿè¢«è½¬ç§»ï¼Ÿæ˜¯çš„ï¼Œå› ä¸ºMACåœ°å€æ—¶ç¡¬è¿çº¿åˆ°NICç”µè·¯è€Œä¸æ˜¯PCï¼Œè¿™ä¹Ÿæ„å‘³ç€å½“NICå¡è¢«å¦ä¸€ä¸ªæ›¿æ¢æ—¶ï¼ŒPCå¯ä»¥å…·æœ‰ä¸åŒçš„MACåœ°å€ã€‚ 75ã€è§£é‡Šé›†ç¾¤æ”¯æŒã€‚é›†ç¾¤æ”¯æŒæ—¶æŒ‡ç½‘ç»œæ“ä½œç³»ç»Ÿåœ¨å®¹é”™ç»„ä¸­è¿æ¥å¤šå°æœåŠ¡å™¨çš„èƒ½åŠ›ã€‚è¿™æ ·åšçš„ä¸»è¦ç›®çš„æ—¶åœ¨ä¸€å°æœåŠ¡å™¨å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¸­çš„ä¸‹ä¸€ä¸ªæœåŠ¡å™¨å°†ç»§ç»­è¿›è¡Œæ‰€æœ‰å¤„ç†ã€‚ 76ã€åœ¨åŒ…å«ä¸¤ä¸ªæœåŠ¡å™¨å’ŒäºŒåä¸ªå·¥ä½œç«™çš„ç½‘ç»œä¸­ï¼Œå®‰è£…é˜²ç—…æ¯’ç¨‹åºçš„æœ€ä½³ä½ç½®æ˜¯å“ªé‡Œï¼Ÿå¿…é¡»åœ¨æ‰€æœ‰æœåŠ¡å™¨å’Œå·¥ä½œç«™ä¸Šå®‰è£…é˜²ç—…æ¯’ç¨‹åºï¼Œä»¥ç¡®ä¿å®‰å…¨ã€‚è¿™æ˜¯å› ä¸ºä¸ªäººç”¨æˆ·å¯ä»¥è®¿é—®ä»»ä½•å·¥ä½œç«™ï¼Œå¹¶åœ¨æ’å…¥å¯ç§»åŠ¨ç¡¬ç›˜é©±åŠ¨å™¨æˆ–é—ªå­˜é©±åŠ¨å™¨æ—¶å¼•å…¥è®¡ç®—æœºç—…æ¯’ã€‚ 77ã€æè¿°ä»¥å¤ªç½‘ã€‚ä»¥å¤ªç½‘æ˜¯å½“ä»Šä½¿ç”¨çš„æµè¡Œç½‘ç»œæŠ€æœ¯ä¹‹ä¸€ã€‚å®ƒæ˜¯åœ¨20å®é™…70å¹´ä»£åˆå¼€å‘çš„ï¼Œå¹¶ä¸”åŸºäºIEEEä¸­è§„å®šçš„è§„èŒƒã€‚ä»¥å¤ªç½‘åœ¨å±€åŸŸç½‘ä¸­ä½¿ç”¨ã€‚ 78ã€å®ç°ç¯å½¢æ‹“æ‰‘æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿå¦‚æœç½‘ç»œä¸Šçš„ä¸€ä¸ªå·¥ä½œç«™å‘ç”Ÿæ•…éšœï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªç½‘ç»œä¸¢å¤±ã€‚å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œå½“éœ€è¦åœ¨ç½‘ç»œçš„ç‰¹å®šéƒ¨åˆ†è¿›è¡Œè°ƒæ•´å’Œé‡æ–°é…ç½®æ—¶ï¼Œæ•´ä¸ªç½‘ç»œä¹Ÿå¿…é¡»è¢«æš‚æ—¶å…³é—­ã€‚ 79ã€CSMA/CDå’ŒCSMA/CAæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸCSMA/CDï¼šå¸¦æœ‰å†²çªæ£€æµ‹çš„è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®ï¼Œå¯ä»¥æ£€æµ‹å†²çªï¼Œä½†æ— æ³•â€œé¿å…â€ CSMA/CAï¼šå¸¦æœ‰å†²çªé¿å…çš„è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®ï¼Œå‘é€åŒ…çš„åŒæ—¶ä¸èƒ½æ£€æµ‹åˆ°ä¿¡é“ä¸Šæœ‰æ— å†²çªï¼Œåªèƒ½å°½é‡â€œé¿å…â€ CSMA/CDï¼ˆCarrier Sense Multiple Access with Collision Detectionï¼‰å³å¸¦å†²çªæ£€æµ‹çš„è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®æŠ€æœ¯(è½½æ³¢ç›‘å¬å¤šç‚¹æ¥å…¥/ç¢°æ’æ£€æµ‹)ã€‚ CSMA/CDæ§åˆ¶æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼šåŸç†æ¯”è¾ƒç®€å•ï¼ŒæŠ€æœ¯ä¸Šæ˜“å®ç°ï¼Œç½‘ç»œä¸­å„å·¥ä½œç«™å¤„äºå¹³ç­‰åœ°ä½ ï¼Œä¸éœ€é›†ä¸­æ§åˆ¶ï¼Œä¸æä¾›ä¼˜å…ˆçº§æ§åˆ¶ã€‚ä½†åœ¨ç½‘ç»œè´Ÿè½½å¢å¤§æ—¶ï¼Œå‘é€æ—¶é—´å¢é•¿ï¼Œå‘é€æ•ˆç‡æ€¥å‰§ä¸‹é™ã€‚ CSMA/CDåº”ç”¨åœ¨ OSI çš„ç¬¬äºŒå±‚æ•°æ®é“¾è·¯å±‚ã€‚ CSMA/CAï¼ˆCarrier Sense Multiple Access with Collision Avoidanceï¼‰å³è½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®/å†²çªé¿å…ã€‚ å·¥ä½œåŸç†æ˜¯ï¼šé¦–å…ˆæ£€æµ‹ä¿¡é“æ˜¯å¦æœ‰ä½¿ç”¨ï¼Œå¦‚æœæ£€æµ‹å‡ºä¿¡é“ç©ºé—²ï¼Œåˆ™ç­‰å¾…ä¸€æ®µéšæœºæ—¶é—´åï¼Œæ‰é€å‡ºæ•°æ®ã€‚æ¥æ”¶ç«¯å¦‚æœæ­£ç¡®æ”¶åˆ°æ­¤å¸§ï¼Œåˆ™ç»è¿‡ä¸€æ®µæ—¶é—´é—´éš”åï¼Œå‘å‘é€ç«¯å‘é€ç¡®è®¤å¸§ACKã€‚å‘é€ç«¯æ”¶åˆ°ACKå¸§ï¼Œç¡®å®šæ•°æ®æ­£ç¡®ä¼ è¾“ï¼Œåœ¨ç»å†ä¸€æ®µæ—¶é—´é—´éš”åï¼Œä¼šå‡ºç°ä¸€æ®µç©ºé—²æ—¶é—´ã€‚ 80ã€ä»€ä¹ˆæ˜¯SMTPï¼Ÿç®€å•é‚®ä»¶ä¼ è¾“åè®® (Simple Mail Transfer Protocol, SMTP) ï¼Œè¯¥åè®®å¤„ç†æ‰€æœ‰å†…éƒ¨é‚®ä»¶ï¼Œå¹¶åœ¨TCP/IPåè®®æ ˆä¸Šæä¾›å¿…è¦çš„é‚®ä»¶ä¼ é€’æœåŠ¡ã€‚ 81ã€ä»€ä¹ˆæ˜¯ç»„æ’­è·¯ç”±ï¼Ÿç»„æ’­è·¯ç”±æ˜¯ä¸€ç§æœ‰é’ˆå¯¹æ€§çš„å¹¿æ’­å½¢å¼ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°æ‰€é€‰æ‹©çš„ç”¨æˆ·ç»„ï¼Œè€Œä¸æ˜¯å°†å…¶å‘é€åˆ°å­ç½‘ä¸Šçš„æ‰€æœ‰ç”¨æˆ·ã€‚ 82ã€åŠ å¯†åœ¨ç½‘ç»œä¸Šçš„é‡è¦æ€§æ˜¯ä»€ä¹ˆï¼ŸåŠ å¯†æ˜¯å°†ä¿¡æ¯è½¬æ¢æˆç”¨æˆ·ä¸å¯è¯»çš„ä»£ç çš„è¿‡ç¨‹ï¼Œç„¶åä½¿ç”¨ç§˜å¯†å¯†é’¥æˆ–å¯†ç å°†å…¶ç¿»è¯‘æˆ–è§£å¯†å›å…¶æ­£å¸¸å¯è¯»æ ¼å¼ã€‚åŠ å¯†æœ‰åŠ©äºç¡®ä¿ä¸­é€”æˆªè·çš„ä¿¡æ¯ä»ç„¶ä¸å¯è¯»ï¼Œå› ä¸ºç”¨æˆ·å¿…é¡»å…·æœ‰æ­£ç¡®çš„å¯†ç æˆ–å¯†é’¥ã€‚ 83ã€å¦‚ä½•å®‰æ’å’Œæ˜¾ç¤ºIPåœ°å€ï¼ŸIPåœ°å€æ˜¾ç¤ºä¸ºä¸€ç³»åˆ—ç”±å‘¨æœŸæˆ–ç‚¹åˆ†éš”çš„å››ä½åè¿›åˆ¶æ•°å­—ã€‚è¿™ç§å®‰æ’çš„å¦ä¸€ä¸ªæœ¯è¯­æ˜¯ç‚¹åˆ†åè¿›åˆ¶æ ¼å¼ã€‚ä¸€ä¸ªä¾‹å­æ˜¯192.168.1.1 84ã€è§£é‡Šè®¤è¯çš„é‡è¦æ€§ã€‚è®¤è¯æ˜¯åœ¨ç”¨æˆ·ç™»å½•ç½‘ç»œä¹‹å‰éªŒè¯ç”¨æˆ·å‡­è¯çš„è¿‡ç¨‹ã€‚å®ƒé€šå¸¸ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œã€‚è¿™æä¾›äº†é™åˆ¶æ¥è‡ªç½‘ç»œä¸Šçš„æœ‰å®³å…¥ä¾µè€…çš„è®¿é—®çš„å®‰å…¨æ‰‹æ®µã€‚ 85ã€éš§é“æ¨¡å¼æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¿™æ˜¯ä¸€ç§æ•°æ®äº¤æ¢æ¨¡å¼ï¼Œå…¶ä¸­ä¸¤ä¸ªé€šä¿¡è®¡ç®—æœºæœ¬èº«ä¸é€‚ç”¨IPSecã€‚ç›¸åï¼Œå°†LANè¿æ¥åˆ°ä¸­è½¬ç½‘ç»œçš„ç½‘å…³åˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨IPSecåè®®æ¥ä¿æŠ¤é€šè¿‡å®ƒçš„æ‰€æœ‰é€šä¿¡çš„è™šæ‹Ÿéš§é“ã€‚ IPSecï¼ˆè‹±è¯­ï¼šInternet Protocol Securityï¼Œç¼©å†™ä¸ºIPsecï¼‰ï¼Œæ˜¯ä¸€ä¸ªåè®®åŒ…ï¼Œé€è¿‡å¯¹IPåè®®çš„åˆ†ç»„è¿›è¡ŒåŠ å¯†å’Œè®¤è¯æ¥ä¿æŠ¤IPåè®®çš„ç½‘ç»œä¼ è¾“åè®®æ—ï¼ˆä¸€äº›ç›¸äº’å…³è”çš„åè®®çš„é›†åˆï¼‰ã€‚ 86ã€å»ºç«‹WANé“¾è·¯æ¶‰åŠçš„ä¸åŒæŠ€æœ¯æœ‰å“ªäº›ï¼Ÿ æ¨¡æ‹Ÿè¿æ¥â€”â€”ä½¿ç”¨å¸¸è§„ç”µè¯çº¿ï¼› æ•°å­—è¿æ¥â€”â€”ä½¿ç”¨æ•°å­—ç”µè¯çº¿ï¼› äº¤æ¢è¿æ¥â€”â€”ä½¿ç”¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´çš„å¤šç»„é“¾æ¥æ¥ç§»åŠ¨æ•°æ®ã€‚ 87ã€ç½‘çŠ¶æ‹“æ‰‘çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä¸€ä¸ªé“¾æ¥å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæ€»ä¼šæœ‰å¦ä¸€ä¸ªé“¾æ¥å¯ç”¨ã€‚ç½‘çŠ¶æ‹“æ‰‘å®é™…ä¸Šæ˜¯å®¹é”™ç‡æœ€é«˜çš„ç½‘ç»œæ‹“æ‰‘ä¹‹ä¸€ã€‚ 88ã€åœ¨æ’é™¤è®¡ç®—æœºç½‘ç»œé—®é¢˜æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿä»€ä¹ˆå¸¸è§çš„ç¡¬ä»¶ç›¸å…³é—®é¢˜ï¼Ÿå¤§éƒ¨åˆ†ç½‘ç»œç”±ç¡¬ä»¶ç»„æˆï¼Œè¿™äº›é¢†åŸŸçš„é—®é¢˜å¯èƒ½åŒ…æ‹¬ç¡¬ç›˜æ•…éšœï¼ŒNICæŸåç”šè‡³ç¡¬ä»¶å¯åŠ¨ã€‚ä¸æ­£ç¡®çš„ç¡¬ä»¶é…ç½®ä¹Ÿæ˜¯å…¶ä¸­ä¸€ä¸ªç–‘éš¾é—®é¢˜ã€‚ 89ã€å¯ä»¥åšä»€ä¹ˆæ¥ä¿®å¤ä¿¡å·è¡°å‡é—®é¢˜ï¼Ÿå¤„ç†è¿™ç§é—®é¢˜çš„å¸¸è§æ–¹æ³•æ—¶ä½¿ç”¨ä¸­ç»§å™¨å’Œé›†çº¿å™¨ï¼Œå› ä¸ºå®ƒå°†æœ‰åŠ©äºé‡æ–°ç”Ÿæˆä¿¡å·ï¼Œä»è€Œé˜²æ­¢ä¿¡å·ä¸¢å¤±ã€‚æ£€æŸ¥ç”µç¼†æ˜¯å¦æ­£ç¡®ç»ˆæ­¢ä¹Ÿæ˜¯å¿…é¡»çš„ã€‚ 90ã€åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼ˆDHCPï¼‰å¦‚ä½•ååŠ©ç½‘ç»œç®¡ç†ï¼Ÿç½‘ç»œç®¡ç†å‘˜ä¸å¿…è®¿é—®æ¯å°å®¢æˆ·ç«¯è®¡ç®—æœºæ¥é…ç½®é™æ€IPåœ°å€ï¼Œè€Œæ˜¯å¯ä»¥åº”ç”¨DHCPæ¥åˆ›å»ºç§°ä¸ºå¯ä»¥åŠ¨æ€åˆ†é…ç»™å®¢æˆ·ç«¯çš„èŒƒå›´çš„IPåœ°å€æ± ã€‚ 91ã€è§£é‡Šç”¨æˆ·é…ç½®æ–‡ä»¶ï¼Ÿé…ç½®æ–‡ä»¶æ˜¯ä¸ºæ¯ä¸ªç”¨æˆ·è®¾ç½®çš„é…ç½®è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºå°†ç”¨æˆ·è‡³äºç»„ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ 92ã€ä»€ä¹ˆæ˜¯Sneakernetï¼ŸSneakernetè¢«è®¤ä¸ºæ˜¯æœ€æ—©çš„è”ç½‘å½¢å¼ï¼Œå…¶ä¸­ä½¿ç”¨å¯ç§»åŠ¨ä»‹è´¨ï¼ˆå¦‚ç£ç›˜ã€ç£å¸¦ï¼‰ç‰©ç†ä¼ è¾“æ•°æ®ã€‚ Sneakernetæ˜¯ä¸€ä¸ªéæ­£å¼æœ¯è¯­ï¼Œç”¨äºé€šè¿‡å°†ç£å¸¦ï¼Œè½¯ç›˜ï¼Œå…‰ç›˜ï¼ŒUSBé—ªå­˜é©±åŠ¨å™¨æˆ–å¤–éƒ¨ç¡¬ç›˜é©±åŠ¨å™¨ç­‰åª’ä½“ä»ä¸€å°è®¡ç®—æœºç§»åŠ¨åˆ°å¦ä¸€å°è®¡ç®—æœºæ¥ä¼ è¾“ç”µå­ä¿¡æ¯ã€‚è€Œä¸æ˜¯é€šè¿‡è®¡ç®—æœºç½‘ç»œä¼ è¾“ä¿¡æ¯ã€‚ 93ã€IEEEåœ¨è®¡ç®—æœºç½‘ç»œä¸­çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿç”µæ°”å’Œç”µå­å·¥ç¨‹å¸ˆåä¼šï¼ˆIEEEï¼Œå…¨ç§°æ˜¯Institute of Electrical and Electronics Engineersï¼‰æ˜¯ä¸€ä¸ªå›½é™…æ€§çš„ç”µå­æŠ€æœ¯ä¸ä¿¡æ¯ç§‘å­¦å·¥ç¨‹å¸ˆçš„åä¼šã€‚ IEEEåˆ¶å®šäº†è®¸å¤šå…³äºè®¡ç®—æœºç½‘ç»œçš„åè®®å’Œæ ‡å‡†ï¼Œå¦‚802.3ç­‰ã€‚ 94ã€TCP/IP Internetå±‚ä¸‹æœ‰å“ªäº›åè®®ï¼Ÿè¯¥å±‚ç®¡ç†çš„åè®®æœ‰4ç§ã€‚åˆ†åˆ«æ˜¯ICMP,IGMP,IPå’ŒARPã€‚ 95ã€è°ˆåˆ°ç½‘ç»œï¼Œä»€ä¹ˆæ˜¯æƒé™ï¼Ÿæƒé™æ˜¯æŒ‡åœ¨ç½‘ç»œä¸Šæ‰§è¡Œç‰¹å®šæ“ä½œçš„æˆæƒè®¸å¯ã€‚ç½‘ç»œä¸Šçš„æ¯ä¸ªç”¨æˆ·å¯ä»¥åˆ†é…ä¸ªäººæƒé™ï¼Œå…·ä½“å–å†³äºè¯¥ç”¨æˆ·å¿…é¡»å…è®¸çš„å†…å®¹ã€‚ 96ã€å»ºç«‹VLANçš„ä¸€ä¸ªåŸºæœ¬è¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿéœ€è¦ä¸€ä¸ªæ”¯æŒVLANçš„ç½‘ç»œè®¾å¤‡ã€‚å› ä¸ºåœ¨äº¤æ¢æœºçº§åˆ«åªæœ‰ä¸€ä¸ªå¹¿æ’­åŸŸï¼Œè¿™æ„å‘³ç€æ¯å½“æ–°ç”¨æˆ·è¿æ¥æ—¶ï¼Œè¯¥ä¿¡æ¯éƒ½ä¼šä¼ æ’­åˆ°æ•´ä¸ªç½‘ç»œã€‚äº¤æ¢æœºä¸Šçš„VLANæœ‰åŠ©äºåœ¨äº¤æ¢æœºçº§åˆ«åˆ›å»ºå•ç‹¬çš„å¹¿æ’­åŸŸï¼Œå®ƒç”¨äºå®‰å…¨ç›®çš„ã€‚ 97ã€ä»€ä¹ˆæ˜¯IPv6ï¼ŸIPv6æ˜¯è‹±æ–‡â€œInternet Protocol Version 6â€ï¼ˆäº’è”ç½‘åè®®ç¬¬6ç‰ˆï¼‰çš„ç¼©å†™ï¼Œæ˜¯äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆIETFï¼‰è®¾è®¡çš„ç”¨äºæ›¿ä»£IPv4çš„ä¸‹ä¸€ä»£IPåè®®ï¼Œèƒ½å¤Ÿå…‹æœIPv4åœ°å€æ•°é‡ä¸è¶³çš„ç¼ºé™·ã€‚ 98ã€ä»€ä¹ˆæ˜¯RSAç®—æ³•ï¼ŸRSAæ˜¯Rivest-Shamir-Adlemanç®—æ³•çš„ç¼©å†™ã€‚å®ƒæ˜¯ç›®å‰æœ€å¸¸ç”¨çš„å…¬é’¥åŠ å¯†ç®—æ³•ã€‚ 99ã€ä»€ä¹ˆæ˜¯ç½‘çŠ¶æ‹“æ‰‘ï¼Ÿç½‘çŠ¶æ‹“æ‰‘æ˜¯ä¸€ç§è®¾ç½®ï¼Œå…¶ä¸­æ¯ä¸ªè®¾å¤‡éƒ½ç›´æ¥è¿æ¥åˆ°ç½‘ç»œä¸Šçš„æ¯ä¸ªå…¶ä»–è®¾å¤‡ã€‚å› æ­¤ï¼Œå®ƒè¦æ±‚æ¯ä¸ªè®¾å¤‡å…·æœ‰è‡³å°‘ä¸¤ä¸ªç½‘ç»œè¿æ¥ã€‚ 100ã€100Base-FXç½‘ç»œçš„æœ€å¤§æ®µé•¿åº¦æ˜¯å¤šå°‘ï¼Ÿä½¿ç”¨100Base-FXçš„ç½‘æ®µçš„æœ€å¤§å…è®¸é•¿åº¦ä¸º412ç±³ï¼Œæ•´ä¸ªç½‘ç»œçš„æœ€å¤§é•¿åº¦ä¸º5å…¬é‡Œã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[]},{"title":"100æ¡è®¡ç®—æœºç½‘ç»œåŸºæœ¬çŸ¥è¯†ï¼ˆä¸Šï¼‰","slug":"20190330-base-know-of-cn-1","date":"2019-03-30T07:00:00.000Z","updated":"2019-03-30T07:00:00.000Z","comments":true,"path":"20190330-base-know-of-cn-1/","link":"","permalink":"https://tinychen.com/20190330-base-know-of-cn-1/","excerpt":"ç®€å•ä»‹ç»ä¸€ç™¾æ¡å…³äºè®¡ç®—æœºç½‘ç»œçš„åŸºæœ¬çŸ¥è¯†ã€‚ç”±äºå¤ªé•¿äº†ï¼Œåˆ†æˆäº†ä¸Šä¸‹ä¸¤ç¯‡ï¼Œæ¯ç¯‡50æ¡ã€‚","text":"ç®€å•ä»‹ç»ä¸€ç™¾æ¡å…³äºè®¡ç®—æœºç½‘ç»œçš„åŸºæœ¬çŸ¥è¯†ã€‚ç”±äºå¤ªé•¿äº†ï¼Œåˆ†æˆäº†ä¸Šä¸‹ä¸¤ç¯‡ï¼Œæ¯ç¯‡50æ¡ã€‚ 1ã€ä»€ä¹ˆæ˜¯é“¾æ¥ï¼Ÿé“¾æ¥æ˜¯æŒ‡ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´çš„è¿æ¥ï¼Œå®ƒåŒ…æ‹¬ç”¨äºä¸€ä¸ªè®¾å¤‡èƒ½å¤Ÿä¸å¦ä¸€ä¸ªè®¾å¤‡é€šä¿¡çš„ç”µç¼†ç±»å‹å’Œåè®®ã€‚ 2ã€OSIå‚è€ƒæ¨¡å‹çš„å±‚æ¬¡æ˜¯ä»€ä¹ˆï¼Ÿ7ä¸ªå±‚æ¬¡ã€‚ ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€åº”ç”¨å±‚ã€‚ 3ã€ä»€ä¹ˆæ˜¯éª¨å¹²ç½‘ï¼Ÿéª¨å¹²ç½‘ç»œæ˜¯é›†ä¸­çš„åŸºç¡€è®¾æ–½ï¼Œæ—¨åœ¨å°†ä¸åŒçš„è·¯ç”±å’Œæ•°æ®åˆ†å‘åˆ°å„ç§ç½‘ç»œã€‚å®ƒè¿˜å¤„ç†å¸¦å®½ç®¡ç†å’Œå„ç§é€šé“ã€‚ 4ã€ä»€ä¹ˆæ˜¯LANï¼ŸLANæ˜¯Local Area Networkçš„ç¼©å†™ï¼Œå³å±€åŸŸç½‘ã€‚å®ƒæ˜¯æŒ‡è®¡ç®—æœºä¸ä½äºå°ç‰©ç†ä½ç½®ï¼ˆä¸€èˆ¬æ˜¯æ–¹åœ†å‡ åƒç±³ä»¥å†…ï¼‰çš„å…¶ä»–ç½‘ç»œè®¾å¤‡ä¹‹é—´çš„è¿æ¥ã€‚ 5ã€ä»€ä¹ˆæ˜¯èŠ‚ç‚¹ï¼ŸèŠ‚ç‚¹æ˜¯æŒ‡å‘ç”Ÿè¿æ¥çš„ç‚¹ã€‚å®ƒå¯ä»¥æ˜¯ä½œä¸ºç½‘ç»œä¸€éƒ¨åˆ†çš„è®¡ç®—æœºæˆ–è®¾å¤‡ã€‚ä¸ºäº†å½¢æˆç½‘ç»œè¿æ¥ï¼Œéœ€è¦ä¸¤ä¸ªæˆ–æ›´å¤šä¸ªèŠ‚ç‚¹ã€‚ 6ã€ä»€ä¹ˆæ˜¯è·¯ç”±å™¨ï¼Ÿè·¯ç”±å™¨å¯ä»¥è¿æ¥ä¸¤ä¸ªæˆ–æ›´å¤šçš„ç½‘æ®µã€‚è¿™äº›æ˜¯åœ¨å…¶è·¯ç”±è¡¨ä¸­å­˜å‚¨ä¿¡æ¯çš„æ™ºèƒ½ç½‘ç»œè®¾å¤‡ï¼Œä¾‹å¦‚è·¯å¾„ã€è·³æ•°ç­‰ã€‚æœ‰äº†è¿™ä¸ªä¿¡æ¯ï¼Œä»–ä»¬å°±å¯ä»¥ç¡®å®šæ•°æ®ä¼ è¾“çš„æœ€ä½³è·¯å¾„ã€‚ è·¯ç”±å™¨åœ¨OSIç½‘ç»œå±‚ï¼ˆä¸‰å±‚ï¼‰è¿è¡Œã€‚ 7ã€ä»€ä¹ˆæ˜¯ç‚¹å¯¹ç‚¹è¿æ¥ï¼Ÿå®ƒæ˜¯æŒ‡ç½‘ç»œä¸Šä¸¤å°è®¡ç®—æœºä¹‹é—´çš„ç›´æ¥è¿æ¥ã€‚é™¤äº†å°†ç”µç¼†è¿æ¥åˆ°ä¸¤å°è®¡ç®—æœºçš„NICå¡ä¹‹å¤–ï¼Œç‚¹å¯¹ç‚¹è¿æ¥ä¸éœ€è¦ä»»ä½•å…¶ä»–è®¾å¤‡ã€‚ 8ã€ä»€ä¹ˆæ˜¯åŒ¿åFTPï¼ŸåŒ¿åFTPï¼ˆFile Transfer Protocolï¼‰æ˜¯æˆäºˆç”¨æˆ·è®¿é—®å…¬å…±æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶çš„ä¸€ç§æ–¹å¼ã€‚å…è®¸è®¿é—®è¿™äº›æœåŠ¡å™¨ä¸­çš„æ•°æ®çš„ç”¨æˆ·ä¸éœ€è¦è¯†åˆ«è‡ªå·±ï¼Œè€Œæ˜¯ä»¥åŒ¿åè®¿å®¢èº«ä»½ç™»å½•ã€‚ 9ã€ä»€ä¹ˆæ˜¯å­ç½‘æ©ç ?å­ç½‘æ©ç ä¸IPåœ°å€ç»„åˆï¼Œä»¥è¯†åˆ«ä¸¤ä¸ªéƒ¨åˆ†ï¼šæ‰©å±•ç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€ã€‚åƒIPåœ°å€ä¸€æ ·ï¼Œå­ç½‘æ©ç ç”±32ä½ç»„æˆã€‚ è¯¦æƒ…å¯ä»¥äº†è§£ä¸€ä¸‹CIDRã€‚ 10ã€UTPç”µç¼†å…è®¸çš„æœ€å¤§é•¿åº¦æ˜¯å¤šå°‘ï¼ŸUTPï¼ˆUnshielded Twisted Pairï¼Œéå±è”½åŒç»çº¿ï¼‰ç”µç¼†çš„å•æ®µå…·æœ‰90åˆ°100ç±³çš„å…è®¸é•¿åº¦ï¼Œè¿™ç§é™åˆ¶å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸­ç»§å™¨å’Œå¼€å…³æ¥å…‹æœã€‚ 11ã€ä»€ä¹ˆæ˜¯æ•°æ®å°è£…ï¼Ÿæ•°æ®å°è£…æ˜¯åœ¨é€šè¿‡ç½‘ç»œä¼ è¾“ä¿¡æ¯ä¹‹å‰å°†ä¿¡æ¯åˆ†è§£æˆæ›´å°çš„å¯ç®¡ç†å—çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæºå’Œç›®æ ‡åœ°å€ä¸å¥‡å¶æ ¡éªŒä¸€èµ·é™„åŠ åˆ°æ ‡é¢˜ä¸­ã€‚ 12ã€æè¿°ç½‘ç»œæ‹“æ‰‘ã€‚ç½‘ç»œæ‹“æ‰‘æ˜¯æŒ‡è®¡ç®—æœºç½‘ç»œçš„å¸ƒå±€ã€‚å®ƒæ˜¾ç¤ºäº†è®¾å¤‡å’Œç”µç¼†çš„ç‰©ç†å¸ƒå±€ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•è¿æ¥åˆ°å½¼æ­¤ã€‚ 13ã€ä»€ä¹ˆæ˜¯VPNï¼ŸVPNæ„å‘³ç€è™šæ‹Ÿä¸“ç”¨ç½‘ç»œï¼ˆVirtual Private Networkï¼‰ï¼Œè¿™ç§æŠ€æœ¯å…è®¸é€šè¿‡ç½‘ç»œï¼ˆå¦‚Internetï¼‰åˆ›å»ºå®‰å…¨é€šé“ã€‚ä¾‹å¦‚ï¼ŒVPNå…è®¸æ‚¨å»ºç«‹åˆ°è¿œç¨‹æœåŠ¡å™¨çš„å®‰å…¨æ‹¨å·è¿æ¥ã€‚ 14ã€ç®€è¦æè¿°NATã€‚NATæ˜¯ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNetwork Address Translationï¼‰ã€‚è¿™æ˜¯ä¸€ç§åè®®ï¼Œä¸ºå…¬å…±ç½‘ç»œä¸Šçš„å¤šå°è®¡ç®—æœºæä¾›ä¸€ç§æ–¹å¼æ¥å…±äº«åˆ°Internetçš„å•ä¸€è¿æ¥ã€‚ 15ã€OSIç½‘ç»œå±‚çš„å·¥ä½œæ˜¯ä»€ä¹ˆï¼Ÿç½‘ç»œå±‚è´Ÿè´£æ•°æ®è·¯ç”±ï¼Œåˆ†ç»„äº¤æ¢å’Œç½‘ç»œæ‹¥å¡æ§åˆ¶ã€‚è·¯ç”±å™¨åœ¨æ­¤å±‚ä¸‹è¿è¡Œã€‚ 16ã€ç½‘ç»œæ‹“æ‰‘å¦‚ä½•å½±å“æ‚¨åœ¨å»ºç«‹ç½‘ç»œæ—¶çš„å†³ç­–ï¼Ÿç½‘ç»œæ‹“æ‰‘å†³å®šäº†äº’è”è®¾å¤‡å¿…é¡»ä½¿ç”¨ä»€ä¹ˆåª’ä»‹ã€‚å®ƒè¿˜ä½œä¸ºé€‚ç”¨äºè®¾ç½®çš„ææ–™ï¼Œè¿æ¥å™¨å’Œç»ˆç«¯çš„åŸºç¡€ã€‚ 17ã€ä»€ä¹ˆæ˜¯RIP?RIP(Routing Information Protocol,è·¯ç”±ä¿¡æ¯åè®®)ï¼Œç”±è·¯ç”±å™¨ç”¨äºå°†æ•°æ®ä»ä¸€ä¸ªç½‘ç»œå‘é€åˆ°å¦ä¸€ä¸ªç½‘ç»œï¼Œå®ƒé€šè¿‡å°†å…¶è·¯ç”±è¡¨å¹¿æ’­åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰å…¶ä»–è·¯ç”±æ¥æœ‰æ•ˆåœ°ç®¡ç†è·¯ç”±æ•°æ®ã€‚å®ƒä»¥è·³æ•°ä¸ºå•ä½ç¡®å®šç½‘ç»œè·ç¦»ã€‚ 18ã€ä»€ä¹ˆæ˜¯ä¸åŒçš„æ–¹å¼æ¥ä¿æŠ¤è®¡ç®—æœºç½‘ç»œ?æœ‰å‡ ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å»ºè®®å¤šç§æ–¹æ³•ç»„åˆä½¿ç”¨ã€‚ åœ¨æ‰€æœ‰è®¡ç®—æœºä¸Šå®‰è£…å¯é å’Œæ›´æ–°çš„é˜²ç—…æ¯’ç¨‹åºã€‚ ç¡®ä¿é˜²ç«å¢™çš„è®¾ç½®å’Œé…ç½®æ­£ç¡®ã€‚ ä½¿ç”¨ç”¨æˆ·è®¤è¯ã€‚ 19ã€ä»€ä¹ˆæ˜¯NICï¼ŸNICï¼ˆNetwork Interface Controllerï¼‰ç½‘ç»œæ¥å£æ§åˆ¶å™¨ï¼ˆç½‘å¡ï¼‰ã€‚è¿™æ˜¯è¿æ¥åˆ°PCä»¥è¿æ¥åˆ°ç½‘ç»œçš„è®¾å¤‡ã€‚æ¯ä¸ªNICéƒ½æœ‰è‡ªå·±çš„MACåœ°å€ï¼Œç”¨äºæ ‡è¯†ç½‘ç»œä¸Šçš„PCã€‚ 20ã€ä»€ä¹ˆæ˜¯WANï¼ŸWANï¼ˆWide Area Networkï¼‰å¹¿åŸŸç½‘ã€‚å®ƒæ˜¯åœ°ç†ä¸Šåˆ†æ•£çš„è®¡ç®—æœºå’Œè®¾å¤‡çš„äº’è¿ï¼Œå®ƒè¿æ¥ä½äºä¸åŒåœ°åŒºå’Œå›½å®¶/åœ°åŒºçš„ç½‘ç»œã€‚ 21ã€OSIç‰©ç†å±‚çš„é‡è¦æ€§æ˜¯ä»€ä¹ˆï¼Ÿç‰©ç†å±‚è¿›è¡Œä»æ•°æ®ä½åˆ°ç”µä¿¡å·çš„ç›¸äº’è½¬æ¢ï¼Œä¸ºæ•°æ®ç«¯è®¾å¤‡æä¾›ä¼ é€æ•°æ®çš„é€šè·¯ã€‚ 22ã€TCP/IPä¸‹æœ‰å¤šå°‘å±‚ï¼Ÿå››å±‚ã€‚ ç½‘ç»œå±‚ã€äº’è”ç½‘å±‚ã€ä¼ è¾“å±‚ã€åº”ç”¨å±‚ã€‚ 23ã€ä»€ä¹ˆæ˜¯ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒä»¬å¦‚ä½•ä¿æŠ¤è®¡ç®—æœºç½‘ç»œï¼Ÿä»£ç†æœåŠ¡å™¨ä¸»è¦é˜²æ­¢å¤–éƒ¨ç”¨æˆ·è¯†åˆ«å†…éƒ¨ç½‘ç»œçš„IPåœ°å€ï¼Œä¸çŸ¥é“æ­£ç¡®çš„IPåœ°å€ï¼Œç”šè‡³æ— æ³•è¯†åˆ«ç½‘ç»œçš„ç‰©ç†ä½ç½®ï¼Œä»£ç†æœåŠ¡å™¨å¯ä»¥ä½¿å¤–éƒ¨ç”¨æˆ·å‡ ä¹çœ‹ä¸åˆ°ç½‘ç»œã€‚ 24ã€OSIä¼šè¯å±‚çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿè¯¥å±‚ä¸ºç½‘ç»œä¸Šçš„ä¸¤ä¸ªè®¾å¤‡æä¾›åè®®å’Œæ–¹æ³•ï¼Œé€šè¿‡ä¸¾è¡Œä¼šè¯æ¥ç›¸äº’é€šä¿¡ã€‚è¿™åŒ…æ‹¬è®¾ç½®ä¼šè¯ï¼Œç®¡ç†ä¼šè¯æœŸé—´çš„ä¿¡æ¯äº¤æ¢ä»¥åŠç»ˆæ­¢ä¼šè¯æ—¶çš„è§£é™¤è¿‡ç¨‹ã€‚ 25ã€å®æ–½å®¹é”™ç³»ç»Ÿçš„é‡è¦æ€§æ˜¯ä»€ä¹ˆï¼Ÿæœ‰é™å—ï¼Ÿå®¹é”™ç³»ç»Ÿç¡®ä¿æŒç»­çš„æ•°æ®å¯ç”¨æ€§ã€‚è¿™æ˜¯é€šè¿‡æ¶ˆé™¤å•ç‚¹æ•…éšœæ¥å®ç°çš„ã€‚ ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§ç±»å‹çš„ç³»ç»Ÿå°†æ— æ³•ä¿æŠ¤æ•°æ®ï¼Œä¾‹å¦‚æ„å¤–åˆ é™¤ï¼ˆåˆ åº“ï¼‰ã€‚ 26ã€10 Base - Tæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ10æ˜¯æŒ‡æ•°æ®ä¼ è¾“é€Ÿç‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯10Mbpsï¼Œâ€œBaseâ€æ˜¯æŒ‡åŸºå¸¦ä¼ è¾“ã€‚Tè¡¨ç¤ºåŒç»çº¿ï¼Œè¿™æ˜¯ç”¨äºè¯¥ç½‘ç»œçš„ç”µç¼†ã€‚ 27ã€ä»€ä¹ˆæ˜¯ç§æœ‰IPåœ°å€ï¼Ÿä¸“ç”¨IPåœ°å€è¢«åˆ†é…ç”¨äºå†…éƒ¨ç½‘ã€‚è¿™äº›åœ°å€ç”¨äºå†…éƒ¨ç½‘ç»œï¼Œä¸èƒ½åœ¨å¤–éƒ¨å…¬å…±ç½‘ç»œä¸Šè·¯ç”±ã€‚è¿™äº›ç¡®ä¿å†…éƒ¨ç½‘ç»œä¹‹é—´ä¸å­˜åœ¨ä»»ä½•å†²çªï¼ŒåŒæ—¶ç§æœ‰IPåœ°å€çš„èŒƒå›´åŒæ ·å¯é‡å¤ä½¿ç”¨äºå¤šä¸ªå†…éƒ¨ç½‘ç»œï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šâ€œçœ‹åˆ°â€å½¼æ­¤ã€‚ 28ã€ä»€ä¹ˆæ˜¯NOS?NOSï¼ˆNetwork Operating Systemï¼‰å³ç½‘ç»œæ“ä½œç³»ç»Ÿæ˜¯ä¸“é—¨çš„è½¯ä»¶ï¼Œå…¶ä¸»è¦ä»»åŠ¡æ˜¯å‘è®¡ç®—æœºæä¾›ç½‘ç»œè¿æ¥ï¼Œä»¥ä¾¿èƒ½å¤Ÿä¸å…¶ä»–è®¡ç®—æœºå’Œè¿æ¥çš„è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚ 29ã€ä»€ä¹ˆæ˜¯DoSï¼ŸDoSï¼ˆDenial of Serviceï¼‰å³æ‹’ç»æœåŠ¡æ”»å‡»æ˜¯è¯•å›¾é˜»æ­¢ç”¨æˆ·è®¿é—®äº’è”ç½‘æˆ–ä»»ä½•å…¶ä»–ç½‘ç»œæœåŠ¡ã€‚è¿™ç§æ”»å‡»å¯èƒ½æœ‰ä¸åŒçš„å½¢å¼ï¼Œç”±ä¸€ç¾¤æ°¸ä¹…è€…ç»„æˆã€‚è¿™æ ·åšçš„ä¸€ä¸ªå¸¸è§æ–¹æ³•æ˜¯ä½¿ç³»ç»ŸæœåŠ¡å™¨è¿‡è½½ï¼Œä½¿å…¶æ— æ³•å†å¤„ç†åˆæ³•æµé‡ï¼Œå¹¶å°†è¢«å¼ºåˆ¶é‡ç½®ã€‚ 30ã€ä»€ä¹ˆæ˜¯OSIï¼Œå®ƒåœ¨ç”µè„‘ç½‘ç»œä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼ŸOSIï¼ˆå¼€æ”¾ç³»ç»Ÿäº’è”(Open System Interconnection)ï¼‰ä½œä¸ºæ•°æ®é€šä¿¡çš„å‚è€ƒæ¨¡å‹ã€‚å®ƒç”±7å±‚ç»„æˆï¼Œæ¯å±‚å®šä¹‰äº†ç½‘ç»œè®¾å¤‡å¦‚ä½•è¿æ¥å’Œé€šä¿¡çš„ç‰¹å®šæ–¹é¢ã€‚æ¯ä¸€å±‚è¦å®Œæˆç›¸åº”çš„åŠŸèƒ½ï¼Œä¸‹ä¸€å±‚ï¼ˆä½å±‚ï¼‰ä¸ºä¸Šä¸€å±‚ï¼ˆé«˜å±‚ï¼‰æä¾›æœåŠ¡ï¼Œä»è€ŒæŠŠå¤æ‚çš„é€šä¿¡è¿‡ç¨‹åˆ†æˆäº†å¤šä¸ªç‹¬ç«‹çš„ã€æ¯”è¾ƒå®¹æ˜“è§£å†³çš„å­é—®é¢˜ã€‚ 31ã€å±è”½ç”µç¼†çš„å±è”½ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿå…¶ä¸»è¦ç›®çš„æ˜¯é˜²æ­¢ä¸²æ‰°ã€‚ä¸²æ‰°æ˜¯ç”µç£å¹²æ‰°æˆ–å™ªéŸ³ï¼Œå¯èƒ½å½±å“é€šè¿‡ç”µç¼†ä¼ è¾“çš„æ•°æ®ã€‚ 32ã€åœ°å€å…±äº«çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿé€šè¿‡ä½¿ç”¨åœ°å€è½¬æ¢ï¼ˆNATï¼‰è€Œä¸æ˜¯è·¯ç”±ï¼Œåœ°å€å…±äº«æä¾›äº†å›ºæœ‰çš„å®‰å…¨æ€§ä¼˜åŠ¿ã€‚è¿™æ˜¯å› ä¸ºäº’è”ç½‘ä¸Šçš„ä¸»æœºåªèƒ½çœ‹åˆ°æä¾›åœ°å€è½¬æ¢çš„è®¡ç®—æœºä¸Šçš„å¤–éƒ¨æ¥å£çš„å…¬å…±IPåœ°å€ï¼Œè€Œä¸æ˜¯å†…éƒ¨ç½‘ç»œä¸Šçš„ç§æœ‰IPåœ°å€ã€‚ 33ã€ä»€ä¹ˆæ˜¯MACåœ°å€ï¼ŸMACï¼ˆMedia Access Controlï¼‰å³åª’ä½“ä»‹å…¥æ§åˆ¶ï¼Œå±äºOSIä¸­çš„æ•°æ®é“¾è·¯å±‚ï¼Œç”±12ä½16è¿›åˆ¶çš„æ•°å­—ç»„æˆï¼Œå…±è®¡6ä¸ªByteã€‚å¯ä»¥å”¯ä¸€åœ°æ ‡è¯†ç½‘ç»œä¸Šçš„è®¾å¤‡ï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºç‰©ç†åœ°å€æˆ–ä»¥å¤ªç½‘åœ°å€ã€‚ 34ã€åœ¨OSIå‚è€ƒæ¨¡å‹æ–¹é¢ï¼ŒTCP/IPåº”ç”¨å±‚çš„ç­‰åŒå±‚æˆ–å¤šå±‚æ˜¯ä»€ä¹ˆï¼Ÿ TCP/IPåº”ç”¨å±‚å®é™…ä¸Šåœ¨OSIæ¨¡å‹ä¸Šå…·æœ‰ä¸‰ä¸ªå¯¹ç­‰ä½“ï¼šä¼šè¯å±‚ï¼Œè¡¨ç¤ºå±‚å’Œåº”ç”¨å±‚ã€‚ 35ã€å¦‚ä½•è¯†åˆ«ç»™å®šIPåœ°å€çš„IPç±»ï¼Ÿ IPåœ°å€ç”±32ä¸ªBitç»„æˆï¼Œæ¯8ä¸ªBitåˆ†æˆä¸€æ®µï¼Œä¸€å…±å››æ®µã€‚é€šè¿‡æŸ¥çœ‹ä»»ä½•ç»™å®šIPåœ°å€çš„ç¬¬ä¸€æ®µçš„8ä¸ªBitï¼Œå°±å¯ä»¥è¯†åˆ«å®ƒæ˜¯å“ªä¸€ç±»ã€‚ ç¬¬ä¸€æ®µå…«ä¸ªBitï¼ˆäºŒè¿›åˆ¶ï¼‰ ç¬¬ä¸€æ®µ8ä¸ªBitï¼ˆåè¿›åˆ¶ï¼‰ IPç±»åˆ« ä»¥0ä½å¼€å¤´ 0~127 Class A ä»¥10å¼€å¤´ 128~191 Class B ä»¥110å¼€å¤´ 192~223 Class C 36ã€OSPFçš„ä¸»è¦ç›®çš„æ˜¯ä»€ä¹ˆï¼ŸOSPF(Open Shortest Path Firstå¼€æ”¾å¼æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼‰,æ˜¯ä½¿ç”¨è·¯ç”±è¡¨ç¡®å®šæ•°æ®äº¤æ¢çš„æœ€ä½³è·¯å¾„çš„é“¾è·¯çŠ¶æ€è·¯ç”±åè®®ã€‚ 37ã€ä»€ä¹ˆæ˜¯é˜²ç«å¢™ï¼Ÿé˜²ç«å¢™ç”¨äºä¿æŠ¤å†…éƒ¨ç½‘ç»œå…å—å¤–éƒ¨æ”»å‡»ã€‚è¿™äº›å¤–éƒ¨å¨èƒå¯èƒ½æ˜¯é»‘å®¢æƒ³è¦çªƒå–æ•°æ®æˆ–è®¡ç®—æœºç—…æ¯’ï¼Œå¯ä»¥ç«‹å³æ¶ˆé™¤æ•°æ®ã€‚å®ƒè¿˜å¯ä»¥é˜²æ­¢æ¥è‡ªå¤–éƒ¨ç½‘ç»œçš„å…¶ä»–ç”¨æˆ·è®¿é—®ä¸“ç”¨ç½‘ç»œã€‚ 38ã€æè¿°æ˜Ÿå‹æ‹“æ‰‘ã€‚æ˜Ÿå‹æ‹“æ‰‘ç”±è¿æ¥åˆ°èŠ‚ç‚¹çš„ä¸­å¤®é›†çº¿å™¨ï¼ˆHUBï¼‰ç»„æˆï¼Œè¿™æ˜¯æœ€ç®€å•çš„è®¾ç½®å’Œç»´æŠ¤ä¹‹ä¸€ã€‚ 39ã€ä»€ä¹ˆæ˜¯ç½‘å…³ï¼Ÿç½‘å…³æä¾›ä¸¤ä¸ªæˆ–å¤šä¸ªç½‘æ®µä¹‹é—´çš„è¿æ¥ã€‚å®ƒé€šå¸¸æ˜¯è¿è¡Œç½‘å…³è½¯ä»¶å¹¶æä¾›ç¿»è¯‘æœåŠ¡çš„è®¡ç®—æœºã€‚è¯¥ç¿»è¯‘æ˜¯å…è®¸ä¸åŒç³»ç»Ÿåœ¨ç½‘ç»œä¸Šé€šä¿¡çš„å…³é”®ã€‚ 40ã€æ˜Ÿå‹æ‹“æ‰‘çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿæ˜Ÿå‹æ‹“æ‰‘çš„ä¸€ä¸ªä¸»è¦ç¼ºç‚¹æ˜¯ï¼šä¸€æ—¦ä¸­å¤®é›†çº¿å™¨æˆ–äº¤æ¢æœºæŸåï¼Œæ•´ä¸ªç½‘ç»œå°±ä¼šç˜«ç—ªã€‚ 41ã€ä»€ä¹ˆæ˜¯SLIPï¼ŸSLIPï¼ˆSerial Line Internet Protocolï¼Œä¸²è¡Œçº¿è·¯ç½‘é™…åè®®ï¼‰å®é™…ä¸Šæ˜¯åœ¨UNIXæ—©æœŸå¼€å‘çš„æ—§åè®®ã€‚è¿™æ˜¯ç”¨äºè¿œç¨‹è®¿é—®çš„åè®®ä¹‹ä¸€ã€‚ 42ã€ç»™å‡ºä¸€äº›ç§æœ‰ç½‘ç»œåœ°å€çš„ä¾‹å­ã€‚ IPåœ°å€ å­ç½‘æ©ç  10.0.0.0 255.0.0.0 172.16.0.0 255.240.0.0 192.168.0.0 255.255.0.0 43ã€ä»€ä¹ˆæ˜¯Tracertï¼ŸTracertæ˜¯ä¸€ä¸ªWindowså®ç”¨ç¨‹åºï¼Œå¯ç”¨äºè·Ÿè¸ªä»è·¯ç”±å™¨åˆ°ç›®æ ‡ç½‘ç»œçš„æ•°æ®é‡‡é›†çš„è·¯ç”±ã€‚å®ƒè¿˜æ˜¾ç¤ºäº†åœ¨æ•´ä¸ªä¼ è¾“è·¯ç”±æœŸé—´é‡‡ç”¨çš„è·³æ•°ã€‚ 44ã€ç½‘ç»œç®¡ç†å‘˜çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆ?ç½‘ç»œç®¡ç†å‘˜æœ‰è®¸å¤šè´£ä»»ï¼Œå¯ä»¥æ€»ç»“ä¸º3ä¸ªå…³é”®åŠŸèƒ½ï¼š å®‰è£…ç½‘ç»œ é…ç½®ç½‘ç»œ ç½‘ç»œçš„ç»´æŠ¤å’Œæ•…éšœæ’é™¤ 45ã€æè¿°å¯¹ç­‰ç½‘ç»œçš„ä¸€ä¸ªç¼ºç‚¹ã€‚å½“æ­£åœ¨è®¿é—®ç”±ç½‘ç»œä¸Šçš„æŸä¸ªå·¥ä½œç«™å…±äº«çš„èµ„æºçš„æ—¶å€™ï¼Œè¯¥å·¥ä½œç«™çš„æ€§èƒ½ä¼šé™ä½ã€‚ å¯¹ç­‰ç½‘ç»œï¼ˆPeer-to-peer networkingï¼‰æˆ–å¯¹ç­‰è®¡ç®—ï¼ˆPeer-to-peer computingï¼‰ï¼Œå…¶å¯ä»¥å®šä¹‰ä¸ºï¼šç½‘ç»œçš„å‚ä¸è€…å…±äº«ä»–ä»¬æ‰€æ‹¥æœ‰çš„ä¸€éƒ¨åˆ†ç¡¬ä»¶èµ„æºï¼ˆå¤„ç†èƒ½åŠ›ã€å­˜å‚¨èƒ½åŠ›ã€ç½‘ç»œè¿æ¥èƒ½åŠ›ã€æ‰“å°æœºç­‰ï¼‰ï¼Œè¿™äº›å…±äº«èµ„æºé€šè¿‡ç½‘ç»œæä¾›æœåŠ¡å’Œå†…å®¹ï¼Œèƒ½è¢«å…¶å®ƒå¯¹ç­‰èŠ‚ç‚¹ï¼ˆPeerï¼‰ç›´æ¥è®¿é—®è€Œæ— éœ€ç»è¿‡ä¸­é—´å®ä½“ã€‚åœ¨æ­¤ç½‘ç»œä¸­çš„å‚ä¸è€…æ—¢æ˜¯èµ„æºã€æœåŠ¡å’Œå†…å®¹çš„æä¾›è€…ï¼ˆServerï¼‰ï¼Œåˆæ˜¯èµ„æºã€æœåŠ¡å’Œå†…å®¹çš„è·å–è€…ï¼ˆClientï¼‰ ã€‚ 46ã€ä»€ä¹ˆæ˜¯æ··åˆç½‘ç»œï¼Ÿæ··åˆç½‘ç»œæ˜¯åˆ©ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨å’Œå¯¹ç­‰ä½“ç³»ç»“æ„çš„ç½‘ç»œè®¾ç½®ã€‚ 47ã€ä»€ä¹ˆæ˜¯DHCPï¼ŸDHCPï¼ŒåŠ¨æ€ä¸»æœºè®¾ç½®åè®®ï¼ˆDynamic Host Configuration Protocolï¼‰æ˜¯ä¸€ä¸ªå±€åŸŸç½‘çš„ç½‘ç»œåè®®ï¼Œä½¿ç”¨UDPåè®®å·¥ä½œã€‚ å…¶ä¸»è¦ä»»åŠ¡æ˜¯è‡ªåŠ¨ä¸ºç½‘ç»œä¸Šçš„è®¾å¤‡åˆ†é…IPåœ°å€ï¼Œå®ƒé¦–å…ˆæ£€æŸ¥ä»»ä½•è®¾å¤‡å°šæœªå ç”¨çš„ä¸‹ä¸€ä¸ªå¯ç”¨åœ°å€ï¼Œç„¶åå°†å…¶åˆ†é…ç»™ç½‘ç»œè®¾å¤‡ã€‚ 48ã€ARPçš„ä¸»è¦å·¥ä½œæ˜¯ä»€ä¹ˆï¼ŸARPï¼ˆAddress Resolution Protocolï¼‰åœ°å€è§£æåè®®çš„ä¸»è¦ä»»åŠ¡æ˜¯å°†å·²çŸ¥çš„IPåœ°å€æ˜ å°„åˆ°MACå±‚åœ°å€ã€‚ 49ã€ä»€ä¹ˆæ˜¯TCP/IPï¼ŸTCP/IP(Transmission Control Protocol/Internet Protocol)ä¼ è¾“æ§åˆ¶åè®®/äº’è”ç½‘åè®®ï¼Œè¿™æ˜¯ä¸€ç»„åè®®å±‚/åè®®æ ˆï¼Œæ—¨åœ¨åœ¨ä¸åŒç±»å‹çš„è®¡ç®—æœºç½‘ç»œï¼ˆå¼‚æ„ç½‘ç»œï¼‰ä¸Šè¿›è¡Œæ•°æ®äº¤æ¢ã€‚ 50ã€å¦‚ä½•ä½¿ç”¨è·¯ç”±å™¨ç®¡ç†ç½‘ç»œï¼Ÿè·¯ç”±å™¨å†…ç½®äº†æ§åˆ¶å°ï¼Œå¯ä»¥é…ç½®ä¸åŒçš„è®¾ç½®ï¼Œå¦‚å®‰å…¨å’Œæ•°æ®è®°å½•ã€‚ç½‘ç»œç®¡ç†å‘˜å¯ä»¥ä¸ºè®¡ç®—æœºåˆ†é…é™åˆ¶ï¼Œä¾‹å¦‚å…è®¸è®¿é—®çš„èµ„æºï¼Œæˆ–è€…å¯ä»¥æµè§ˆäº’è”ç½‘çš„ç‰¹å®šæ—¶é—´æ®µé™åˆ¶ï¼Œç”šè‡³å¯ä»¥å¯¹æ•´ä¸ªç½‘ç»œä¸­çœ‹ä¸åˆ°çš„ç½‘ç«™åŠ ä»¥é™åˆ¶ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[]},{"title":"CentOSé…ç½®JDKç¯å¢ƒ","slug":"20190317-centos-install-jdk","date":"2019-03-17T07:00:00.000Z","updated":"2019-03-17T07:00:00.000Z","comments":true,"path":"20190317-centos-install-jdk/","link":"","permalink":"https://tinychen.com/20190317-centos-install-jdk/","excerpt":"åœ¨CentOS7ä¸Šé¢å®ç°JDKçš„ç¯å¢ƒé…ç½®ã€‚","text":"åœ¨CentOS7ä¸Šé¢å®ç°JDKçš„ç¯å¢ƒé…ç½®ã€‚ 1ã€ä¸‹è½½è½¯ä»¶åŒ…æ³¨æ„ä½¿ç”¨wgetå‘½ä»¤çš„æ—¶å€™ä¸èƒ½ç›´æ¥å¯¹æ–‡ä»¶é“¾æ¥è¿›è¡Œä¸‹è½½ å› ä¸ºOracleå®˜ç½‘éœ€è¦æˆ‘ä»¬åœ¨ä¸‹è½½ä¹‹å‰å…ˆåŒæ„åè®®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨cookieï¼Œå¦åˆ™åªèƒ½ä¸‹è½½åˆ°ä¸€ä¸ªhtmlæ–‡ä»¶ 1wget --no-check-certificate --no-cookies --header &quot;Cookie: oraclelicense=accept-securebackup-cookie&quot; https://download.oracle.com/otn-pub/java/jdk/8u201-b09/42970487e3af4f5aa5bca3f542482c60/jdk-8u201-linux-x64.tar.gz ä½¿ç”¨fileå‘½ä»¤æ£€æµ‹ä¸‹è½½åˆ°çš„æ–‡ä»¶æ˜¯å¦æ­£å¸¸ 1file jdk-8u201-linux-x64.tar.gz 12[root@izwz91m0zmp2dkbj20vjz7z ~]# file jdk-8u201-linux-x64.tar.gzjdk-8u201-linux-x64.tar.gz: gzip compressed data, from Unix, last modified: Sun Dec 16 03:48:30 2018 2ã€æ£€æµ‹å¹¶å¸è½½ç›¸å…³JDKè¾“å…¥è¯¥æŒ‡ä»¤æ£€æµ‹æ˜¯å¦å­˜åœ¨å·²å®‰è£…çš„jdkæˆ–è€…openJDK 1rpm -qa | grep java ä½¿ç”¨è¯¥ä¸‹é¢ä¸¤ä¸ªæŒ‡ä»¤å¯¹å·²å®‰è£…çš„jdkè¿›è¡Œå¸è½½å’Œå¼ºåˆ¶å¸è½½ï¼ˆè®°å¾—è¡¥å……è½¯ä»¶åï¼‰ 12rpm erpm e --nodeps 3ã€è§£å‹æ–‡ä»¶è§£å‹æ–‡ä»¶ 1tar -zxvf jdk-8u201-linux-x64.tar.gz å°†è§£å‹åçš„æ–‡ä»¶å¤¹ç§»åŠ¨åˆ°homeç›®å½•ä¸‹ 1cp -r jdk1.8.0_201/ /home/ 4ã€é…ç½®ç¯å¢ƒå˜é‡ç¼–è¾‘ç¯å¢ƒå˜é‡ 1vim /etc/profile 1234JAVA_HOME=/home/jdk_1.8.0_201CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/libPATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/binexport JAVA_HOME CLASSPATH PATH é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶ 1source /etc/profile 5ã€æ£€éªŒå®‰è£…æ˜¯å¦æˆåŠŸæŸ¥çœ‹javaç‰ˆæœ¬æ˜¯å¦é…ç½®æˆåŠŸ 1java -version 1234[root@izwz91m0zmp2dkbj20vjz7z home]# java -versionjava version &quot;1.8.0_201&quot;Java(TM) SE Runtime Environment (build 1.8.0_201-b09)Java HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"jdk","slug":"jdk","permalink":"https://tinychen.com/tags/jdk/"}]},{"title":"MySQLå­¦ä¹ ç¬”è®°3-SQLåŸºæœ¬æ“ä½œ","slug":"20190310-mysql-note-03","date":"2019-03-10T07:00:00.000Z","updated":"2019-03-10T07:00:00.000Z","comments":true,"path":"20190310-mysql-note-03/","link":"","permalink":"https://tinychen.com/20190310-mysql-note-03/","excerpt":"MySQLå­¦ä¹ ç¬”è®°ï¼Œç¬¬3ç¯‡ã€‚ä¸»è¦æ˜¯åœ¨å®ç°MySQLçš„ä¸€äº›åŸºæœ¬æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ã€‚","text":"MySQLå­¦ä¹ ç¬”è®°ï¼Œç¬¬3ç¯‡ã€‚ä¸»è¦æ˜¯åœ¨å®ç°MySQLçš„ä¸€äº›åŸºæœ¬æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ã€‚ 1ã€MySQLæ•°æ®åº“MySQLæ•°æ®åº“æ˜¯ä¸€ç§C/Sç»“æ„çš„è½¯ä»¶ï¼šå®¢æˆ·ç«¯/æœåŠ¡ç«¯ã€‚ç‰¹ç‚¹ï¼šè‹¥æƒ³è®¿é—®æœåŠ¡å™¨å¿…é¡»é€šè¿‡å®¢æœç«¯ï¼ˆæœåŠ¡å™¨ä¸€ç›´è¿è¡Œï¼Œå®¢æˆ·ç«¯åœ¨éœ€è¦ä½¿ç”¨çš„æ—¶å€™è¿è¡Œï¼‰ 1.1 äº¤äº’æ–¹å¼ å®¢æˆ·ç«¯è¿æ¥è®¤è¯ï¼šè¿æ¥æœåŠ¡å™¨ï¼Œè®¤è¯èº«ä»½ï¼šmysql.exe -hPup 1mysql -hlocalhost -P3306 -uroot -p å…¶ä¸­hæ˜¯æ‰¾ä¸»æœºçš„IPï¼Œè¿™é‡Œæ˜¯localhostå³ä¸ºæœ¬æœºï¼ŒPæ˜¯æ‰¾ç«¯å£ï¼Œmysqlå¯¹åº”çš„æ˜¯3306ç«¯å£ï¼Œuæ˜¯ç”¨æˆ·ï¼Œè¿™é‡Œæ˜¯rootç”¨æˆ·ï¼Œpåˆ™æ˜¯ä½¿ç”¨å¯†ç  å®¢æˆ·ç«¯å‘é€SQLæŒ‡ä»¤ æœåŠ¡å™¨æ¥å—SQLæŒ‡ä»¤ï¼›å¤„ç†SQLæŒ‡ä»¤ï¼›è¿”å›æ“ä½œç»“æœ å®¢æˆ·ç«¯æ¥å—ç»“æœï¼šæ˜¾ç¤ºç»“æœ æ–­å¼€è¿æ¥ï¼ˆé‡Šæ”¾èµ„æºï¼šä¿è¯æœåŠ¡å™¨çš„å¹¶å‘æ€§ï¼‰ 2ã€MySQLæœåŠ¡å™¨å¯¹è±¡å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åŠæ³•å®Œå…¨äº†è§£æœåŠ¡å™¨å†…éƒ¨çš„å†…å®¹ï¼Œåªèƒ½ç²—ç•¥åœ°å»åˆ†ææ•°æ®åº“æœåŠ¡å™¨å†…éƒ¨çš„ç»“æ„ã€‚ å°†MySQLæœåŠ¡å™¨å†…éƒ¨å¯¹è±¡åˆ†ä¸ºå››å±‚ï¼š æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰-&gt; æ•°æ®åº“ï¼ˆDBï¼‰-&gt; æ•°æ®è¡¨ï¼ˆtableï¼‰-&gt; å­—æ®µï¼ˆfieldï¼‰ 3ã€SQLåŸºæœ¬æ“ä½œåŸºæœ¬æ“ä½œï¼šå¢åˆ æ”¹æŸ¥ å°†SQLçš„åŸºæœ¬æ“ä½œæ ¹æ®æ“ä½œå¯¹è±¡åˆ†ä¸ºä¸‰ç±»ï¼šåº“æ“ä½œï¼Œè¡¨æ“ä½œï¼ˆå­—æ®µï¼‰ï¼Œæ•°æ®æ“ä½œ 4ã€æ•°æ®åº“æ“ä½œ4.1 æ–°å¢æ•°æ®åº“4.1.1 æŒ‡ä»¤1create database æ•°æ®åº“å [åº“é€‰é¡¹] 4.1.2æ•°æ®åº“å‘½åè§„åˆ™ æ•°æ®åº“åå­—ä¸èƒ½ä½¿ç”¨å…³é”®å­—æˆ–è€…ä¿ç•™å­— å¦‚æœä½¿ç”¨å…³é”®å­—æˆ–è€…ä¿ç•™å­—ï¼Œéœ€è¦ä½¿ç”¨åå¼•å·æŠŠæ•°æ®åº“åå­—æ‹¬èµ·æ¥ ä¿è¯æœåŠ¡å™¨å¯ä»¥è¯†åˆ«ä¸­æ–‡çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ä¸­æ–‡å‘½åæ•°æ®åº“ï¼Œä½†æ˜¯éå¸¸ä¸å»ºè®®è¿™æ ·åš 4.1.3 åº“é€‰é¡¹åº“é€‰é¡¹ï¼šç”¨æ¥çº¦æŸæ•°æ®åº“ï¼Œåˆ†ä¸ºä¸¤ä¸ªé€‰é¡¹ å­—ç¬¦é›†è®¾å®šï¼šcharset/character set å…·ä½“å­—ç¬¦é›†ï¼ˆæ•°æ®å­˜å‚¨çš„ç¼–ç æ ¼å¼ï¼‰ æ ¡å¯¹é›†è®¾å®šï¼šcollate å…·ä½“æ ¡å¯¹é›†ï¼ˆæ•°æ®æ¯”è¾ƒçš„è§„åˆ™ï¼‰ 4.1.4 æ³¨é‡ŠåŒä¸­åˆ’çº¿+ç©ºæ ¼æˆ–è€…ä½¿ç”¨äº•å· -- è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š # è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ³¨é‡Š 4.1.5 æŠ¥é”™è§„åˆ™é™é»˜æ¨¡å¼ï¼Œå³åªä¼šå‘ŠçŸ¥æŠ¥é”™çš„å¤§æ¦‚ä½ç½®è€Œä¸ä¼šå‘ŠçŸ¥é”™è¯¯çš„åŸå› ã€‚ 4.1.6 åˆ›å»ºäº†æ•°æ®åº“ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆ åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¢åŠ äº†å¯¹åº”çš„æ•°æ®åº“ä¿¡æ¯ï¼› ä¼šåœ¨ä¿å­˜æ•°æ®åº“çš„æ–‡ä»¶ç›®å½•ä¸‹æ–°å¢ä¸€ä¸ªå¯¹åº”æ•°æ®åº“åå­—çš„æ–‡ä»¶å¤¹ï¼› æ¯ä¸ªæ•°æ®åº“æ–‡ä»¶å¤¹ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„db.optæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­è®°å½•åº“é€‰é¡¹ â–¼å›¾ä¸­ä¸ºå¯¹åº”æ•°æ®åº“çš„å­—ç¬¦é›†è®¾å®šå’Œæ ¡å¯¹é›†è®¾å®šã€‚ï¼ˆæ ¡å¯¹é›†ä¾èµ–å­—ç¬¦é›†ï¼‰ 4.2 æŸ¥çœ‹æ•°æ®åº“4.2.1 æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“1mysql&gt; show databases; 4.2.2 æŸ¥çœ‹æŒ‡å®šéƒ¨åˆ†çš„æ•°æ®åº“ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰1show databases like &#x27;pattern&#x27;ï¼› å…¶ä¸­patternæ˜¯åŒ¹é…æ¨¡å¼çš„æ„æ€ï¼Œåˆ†ä¸ºä¸¤ç§åŒ¹é…æ¨¡å¼ %ï¼šåŒ¹é…å¤šä¸ªå­—ç¬¦_:åŒ¹é…å•ä¸ªå­—ç¬¦ æŸ¥çœ‹ä»¥mydata_å¼€å¤´çš„æ•°æ®åº“æ—¶ï¼Œéœ€è¦å¯¹_è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œå³åœ¨å‰é¢åŠ ä¸€ä¸ªåæ–œæ ï¼Œå¦åˆ™ä¼šæŸ¥è¯¢é”™è¯¯ï¼Œå› ä¸ºç³»ç»Ÿä¼šè®¤ä¸ºmydata_ä¸­çš„_æ˜¯åŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œè€Œ%æ˜¯åŒ¹é…å¤šä¸ªå­—ç¬¦ï¼Œè¿™æ ·å­çš„è¯ï¼š 123show databases like &#x27;mydata_%&#x27;show databases like &#x27;mydata%&#x27; è¿™ä¸¤æ¡è¯­å¥çš„å®é™…ä½¿ç”¨æ•ˆæœå°±æ˜¯ä¸€æ ·çš„äº†ã€‚ æ­£ç¡®çš„æ“ä½œåº”è¯¥æ˜¯ 1show databases like &#x27;mydata\\_%&#x27; 4.2.3 æŸ¥çœ‹åˆ›å»ºæ•°æ®åº“çš„æ—¶å€™ä½¿ç”¨çš„è¯­å¥1show create database æ•°æ®åº“å; å› ä¸ºSQLæ˜¯ä¸€ç§ç¼–è¯‘å‹è¯­è¨€ï¼Œæ‰€ä»¥æ•°æ®åº“åœ¨æ‰§è¡ŒSQLè¯­å¥ä¹‹å‰ä¼šå¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œå¯¼è‡´æœ€ç»ˆæˆ‘ä»¬æŸ¥è¯¢åˆ°çš„åˆ›å»ºæ•°æ®åº“æ—¶ä½¿ç”¨çš„è¯­å¥å’Œæˆ‘ä»¬è¾“å…¥çš„è¯­å¥å¹¶ä¸å®Œå…¨ä¸€è‡´ã€‚ 4.3 æ›´æ–°æ•°æ®åº“ æ•°æ®åº“åå­—ä¸å¯ä»¥ä¿®æ”¹ï¼ˆä¿®æ”¹åå­—ä¸å®‰å…¨ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼‰ æ•°æ®åº“çš„ä¿®æ”¹ ä»…é™äºåº“é€‰é¡¹ï¼Œå³å­—ç¬¦é›†å’Œæ ¡å¯¹é›†ï¼ˆæ³¨æ„æ ¡å¯¹é›†ä¾èµ–å­—ç¬¦é›†ï¼‰ alter database æ•°æ®åº“å [åº“é€‰é¡¹] charset/character set = å­—ç¬¦é›† //æ³¨æ„æ­¤å¤„å¯ä»¥ä½¿ç”¨=ä¹Ÿå¯ä»¥ä¸ç”¨ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ç”¨ collate = æ ¡å¯¹é›† ä¸€èˆ¬ä¸è½»æ˜“ä¿®æ”¹åº“é€‰é¡¹ 4.4 åˆ é™¤æ•°æ®åº“æ•°æ®åº“å±äºç»“æ„ï¼Œæ‰€ä»¥ä½¿ç”¨ddlè¯­è¨€ï¼Œå³dropè¯­å¥ï¼› 1drop database æ•°æ®åº“å; æ³¨æ„ï¼šæ•°æ®åº“åˆ é™¤åæéš¾æ¢å¤ï¼Œä¸€å®šè¦æ³¨æ„å¤‡ä»½ï¼Œä¸è¦è½»æ˜“åˆ åº“ 4.4.1 æ•°æ®åº“åˆ é™¤åå‘ç”Ÿäº†ä»€ä¹ˆ åœ¨æ•°æ®åº“å†…éƒ¨è¯¥æ•°æ®åº“è¢«åˆ é™¤äº†ï¼› æ•°æ®åº“å¯¹åº”çš„æ–‡ä»¶å¤¹ä¹Ÿè¢«é€’å½’åˆ é™¤äº†ï¼›","categories":[{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://tinychen.com/tags/mysql/"},{"name":"database","slug":"database","permalink":"https://tinychen.com/tags/database/"}]},{"title":"CentOS7å®‰è£…MySQL","slug":"20190310-centos-install-mysql","date":"2019-03-10T02:00:00.000Z","updated":"2019-03-10T02:00:00.000Z","comments":true,"path":"20190310-centos-install-mysql/","link":"","permalink":"https://tinychen.com/20190310-centos-install-mysql/","excerpt":"ä¸»è¦æ˜¯åœ¨CentOS7ä¸Šå®‰è£…MySQLæœåŠ¡ã€‚","text":"ä¸»è¦æ˜¯åœ¨CentOS7ä¸Šå®‰è£…MySQLæœåŠ¡ã€‚ 1ã€MySQLå’ŒMariaDBéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨CentOS7ä¸­ï¼ŒMySQLå·²ç»ä»é»˜è®¤çš„ç¨‹åºåˆ—è¡¨ä¸­ç§»é™¤äº†ï¼Œå¹¶æ›´æ¢ä¸ºäº†MariaDBã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨MariaDBæ¥æ›¿ä»£MySQLåˆæˆ–è€…æ˜¯ç”¨æ‰‹åŠ¨çš„æ–¹å¼æ¥ä¸‹è½½yumèµ„æºåŒ…å†è¿›è¡Œå®‰è£…ã€‚ MariaDB æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ˜¯ MySQL çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸»è¦ç”±å¼€æºç¤¾åŒºåœ¨ç»´æŠ¤ï¼Œé‡‡ç”¨ GPL æˆæƒè®¸å¯ã€‚å¼€å‘è¿™ä¸ªåˆ†æ”¯çš„åŸå› ä¹‹ä¸€æ˜¯ï¼šç”²éª¨æ–‡å…¬å¸æ”¶è´­äº† MySQL åï¼Œæœ‰å°† MySQL é—­æºçš„æ½œåœ¨é£é™©ï¼Œå› æ­¤ç¤¾åŒºé‡‡ç”¨åˆ†æ”¯çš„æ–¹å¼æ¥é¿å¼€è¿™ä¸ªé£é™©ã€‚MariaDBçš„ç›®çš„æ˜¯å®Œå…¨å…¼å®¹MySQLï¼ŒåŒ…æ‹¬APIå’Œå‘½ä»¤è¡Œï¼Œä½¿ä¹‹èƒ½è½»æ¾æˆä¸ºMySQLçš„ä»£æ›¿å“ã€‚ 2ã€æ£€æµ‹å¹¶åˆ é™¤MySQL1rpm -qa | grep mysql è¿™æ¡æŒ‡ä»¤æ˜¯ç”¨rpmæ¥æŸ¥è¯¢å®‰è£…çš„æ‰€æœ‰è½¯ä»¶ï¼Œå…¶ä¸­qå°±æ˜¯queryï¼Œè€Œaå°±æ˜¯allã€‚ä½¿ç”¨ç®¡é“å‘½ä»¤å°†æŸ¥è¯¢åˆ°çš„ç»“æœäº¤ç»™grepå‘½ä»¤ï¼Œæ¥æŠ“å–é‡Œé¢æ˜¯å¦æœ‰mysqlç›¸å…³çš„è½¯ä»¶ã€‚ å¦‚æœæŸ¥è¯¢åˆ°æ²¡æœ‰mysqlï¼Œå°±å¯ä»¥ç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¦‚æœæœ‰ï¼Œå°±å…ˆå¸è½½æ‰ã€‚ 12345rpm -e mysql//-e å°±æ˜¯eraseå¸è½½è½¯ä»¶rpm -e --nodeps mysql//å¼ºåŠ›åˆ é™¤æ¨¡å¼ï¼Œå¦‚æœä½¿ç”¨ä¸Šé¢å‘½ä»¤åˆ é™¤æ—¶ï¼Œæç¤ºæœ‰ä¾èµ–çš„å…¶å®ƒæ–‡ä»¶ï¼Œåˆ™ç”¨è¯¥å‘½ä»¤å¯ä»¥å¯¹å…¶è¿›è¡Œå¼ºåŠ›åˆ é™¤ 3ã€å®‰è£…MySQLæ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼ŒCentOS7å·²ç»å°†MySQLç§»é™¤å‡ºé»˜è®¤ç¨‹åºåˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆå»å®˜ç½‘ä¸‹è½½yumèµ„æºåŒ…ï¼Œä¸‹è½½åœ°å€ï¼šhttps://dev.mysql.com/downloads/repo/yum/ 12345wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm//ä½¿ç”¨wgetå‘½ä»¤ä¸‹è½½èµ„æºåŒ…åˆ°æœ¬åœ°ç›®å½•ä¸­rpm -ivh mysql-community-release-el7-5.noarch.rpmä½¿ç”¨rpmå‘½ä»¤è¿›è¡Œå®‰è£… RPMå®‰è£…å‚æ•°è§£é‡Š-i, â€“install install package(s)-v, â€“verbose provide more detailed output-h, â€“hashprint hash marks as package installs (good with -v) 12345yum update//æ›´æ–°yumyum install mysql-server//å®‰è£…mysql-server 4ã€è®¾ç½®æƒé™12chown mysql:mysql -R /var/lib/mysql//ä½¿ç”¨chownå‘½ä»¤æ›´æ”¹æƒé™ï¼ŒRè¡¨ç¤ºé€’å½’å¤„ç†è¯¥ç›®å½• 5ã€å¯åŠ¨MySQL åœ¨centos7ä¸­ï¼Œserviceå‘½ä»¤å·²è¢«systemctlå‘½ä»¤æ›¿ä»£ 123456systemctl start mysqld.service//å¯åŠ¨mysqlæœåŠ¡systemctl status mysqld.service//æŸ¥è¯¢mysqlæœåŠ¡çŠ¶æ€systemctl restart mysqld.service//é‡å¯mysqlæœåŠ¡ æŸ¥è¯¢mysqlç‰ˆæœ¬ä¿¡æ¯ 1mysqladmin --version è¾“å‡ºç»“æœå¦‚ä¸‹ 12[root@izwz91m0zmp2dkbj20vjz7z ~]# mysqladmin --versionmysqladmin Ver 8.42 Distrib 5.6.43, for Linux on x86_64 6ã€è®¾ç½®å¯†ç mysqlå®‰è£…åï¼Œé»˜è®¤çš„rootç”¨æˆ·å¯†ç ä¸ºç©ºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è®¾ç½®å¯†ç  12345678mysql -u root//æ­¤æ—¶è¿˜æ²¡æœ‰å¯†ç ï¼Œç›´æ¥ä½¿ç”¨rootç”¨æˆ·å³å¯ç™»å½•set password for root@localhost = password(&#x27;a_new_password&#x27;);//æ­¤æ—¶å³å¯ä¸ºrootç”¨æˆ·è®¾ç½®æ–°çš„å¯†ç mysql&gt; set password for root@localhost = password(&#x27;a_new_password&#x27;);Query OK, 0 rows affected (0.00 sec) 7ã€ç™»å½•ä½¿ç”¨mysqlä½¿ç”¨mysql -u root -pè¿›è¡Œç™»å½•ï¼Œç„¶åè¾“å…¥å¯†ç ï¼Œå³å¯è¿›å…¥mysqlå‘½ä»¤è¡Œï¼Œæ­¤æ—¶å¦‚æœæƒ³è¦é€€å‡ºmysqlå‘½ä»¤è¡Œï¼Œè¾“å…¥quitæˆ–è€…exitæˆ–è€…æŒ‰ä¸‹ctrl+Cå³å¯ã€‚ 1234567891011121314151617181920212223242526[root@izwz91m0zmp2dkbj20vjz7z ~]# mysql -u root -pEnter password:Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 2Server version: 5.6.43 MySQL Community Server (GPL)Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#x27;help;&#x27; or &#x27;\\h&#x27; for help. Type &#x27;\\c&#x27; to clear the current input statement.mysql&gt; show databases;+--------------------+| Database |+--------------------+| information_schema || mysql || performance_schema |+--------------------+3 rows in set (0.01 sec)mysql&gt; Ctrl-C -- exit!Aborted","categories":[{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"mysql","slug":"mysql","permalink":"https://tinychen.com/tags/mysql/"},{"name":"database","slug":"database","permalink":"https://tinychen.com/tags/database/"}]},{"title":"MySQLæ•°æ®åº“åŸºæœ¬æ¦‚å¿µ","slug":"20190309-mysql-base-know","date":"2019-03-09T07:00:00.000Z","updated":"2019-03-09T07:00:00.000Z","comments":true,"path":"20190309-mysql-base-know/","link":"","permalink":"https://tinychen.com/20190309-mysql-base-know/","excerpt":"MySQLå­¦ä¹ ç¬”è®°ã€‚ä¸»è¦æ˜¯å„ç±»åŸºæœ¬å®šä¹‰å’Œæ¦‚å¿µçš„äº†è§£ã€‚","text":"MySQLå­¦ä¹ ç¬”è®°ã€‚ä¸»è¦æ˜¯å„ç±»åŸºæœ¬å®šä¹‰å’Œæ¦‚å¿µçš„äº†è§£ã€‚ 1ã€ä»€ä¹ˆæ˜¯æ•°æ®åº“ï¼Ÿ1.1 æ•°æ®ï¼ˆDataï¼‰çš„å®šä¹‰æè¿°äº‹ç‰©çš„ç¬¦å·è®°å½•ç§°ä¸ºæ•°æ®ã€‚ 1.2 æ•°æ®åº“ï¼ˆDataBaseï¼‰çš„å®šä¹‰æ•°æ®åº“æ˜¯é•¿æœŸå‚¨å­˜åœ¨è®¡ç®—æœºå†…çš„ï¼Œæœ‰ç»„ç»‡çš„ï¼Œå¯å…±äº«çš„å¤§é‡æ•°æ®çš„é›†åˆã€‚ æ•°æ®åº“ä¸­çš„æ•°æ®æŒ‰ä¸€å®šçš„æ•°æ®æ¨¡å‹ç»„ç»‡ã€æè¿°å’Œå‚¨å­˜ï¼Œå…·æœ‰è¾ƒå°çš„å†—ä½™åº¦ã€è¾ƒé«˜çš„æ•°æ®ç‹¬ç«‹æ€§å’Œæ˜“æ‰©å±•æ€§ï¼Œå¹¶å¯ä¸ºå„ç§ç”¨æˆ·å…±äº«ã€‚æ¦‚å†µåœ°è®²ï¼Œæ•°æ®åº“æ•°æ®å…·æœ‰æ°¸ä¹…å­˜å‚¨ã€æœ‰ç»„ç»‡å’Œå¯å…±äº«ä¸‰ä¸ªç‰¹ç‚¹ã€‚ 1.3 æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDataBase Management Systemï¼‰çš„å®šä¹‰##æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ˜¯ä½äºç”¨æˆ·ä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„ä¸€å±‚æ•°æ®ç®¡ç†è½¯ä»¶ã€‚ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªç³»ç»Ÿè½¯ä»¶ï¼Œå®ƒçš„ä»»åŠ¡æ˜¯ç§‘å­¦åœ°ç»„ç»‡å’Œå­˜å‚¨æ•°æ®ï¼Œé«˜æ•ˆåœ°è·å–å’Œç»´æŠ¤æ•°æ®ã€‚ DBMSçš„ä¸»è¦åŠŸèƒ½æœ‰æ•°æ®å®šä¹‰åŠŸèƒ½ï¼Œæ•°æ®ç»„ç»‡ã€å­˜å‚¨å’Œç®¡ç†ï¼Œæ•°æ®æ“çºµåŠŸèƒ½ï¼Œæ•°æ®åº“çš„äº‹åŠ¡ç®¡ç†å’Œè¿è¡Œç®¡ç†ï¼Œæ•°æ®åº“çš„å»ºç«‹å’Œç»´æŠ¤åŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½ã€‚ 1.4 æ•°æ®åº“ç³»ç»Ÿï¼ˆDataBase Systemï¼‰çš„å®šä¹‰æ•°æ®åº“ç³»ç»Ÿæ˜¯ç”±æ•°æ®åº“ã€æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆåŠå…¶åº”ç”¨å¼€å‘å·¥å…·ï¼‰ã€åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ç®¡ç†å‘˜ï¼ˆDataBase Administratorï¼‰ç»„æˆçš„å­˜å‚¨ã€ç®¡ç†ã€å¤„ç†å’Œç»´æŠ¤æ•°æ®çš„ç³»ç»Ÿã€‚ 1.5 å­˜å‚¨æ•°æ®åº“çš„ä»‹è´¨ä»‹è´¨ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼šç¡¬ç›˜å’Œå†…å­˜ 2ã€æ•°æ®åº“çš„åˆ†ç±»å’ŒåŒºåˆ«2.1 åˆ†ç±»æ•°æ®åº“åŸºäºå­˜å‚¨ä»‹è´¨çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šå…³ç³»å‹æ•°æ®åº“ï¼ˆSQLï¼‰å’Œéå…³ç³»å‹æ•°æ®åº“ï¼ˆNoSQLï¼‰ã€‚ NoSQLï¼šNot Only SQLï¼Œ ä¸æ˜¯å…³ç³»å‹çš„æ•°æ®åº“éƒ½å«åšéå…³ç³»å‹æ•°æ®åº“ æ­¤å¤–è¿˜å¯ä»¥åŸºäºå¯¹æ•°æ®çš„å¤„ç†æ–¹å¼çš„ä¸åŒè¿›è¡Œåˆ†ç±»ï¼Œè¿˜æœ‰è¯¸å¦‚é¢å‘å¯¹è±¡å‹æ•°æ®åº“ï¼ˆobject-oriented database(OODB)ï¼‰ç­‰ã€‚ 2.2åŒºåˆ«2.2.1 SQL å®‰å…¨ï¼ˆä¿å­˜åˆ°ç£ç›˜ï¼Œæ–­ç”µä¸ä¼šä¸¢å¤±ï¼‰ åŸºäºå…³ç³»çš„æ•°æ®åº“ä¾¿äºäººç±»ç†è§£å’Œä½¿ç”¨ ä½†æ˜¯æ¯”è¾ƒæµªè´¹ç©ºé—´ï¼ˆä½¿ç”¨äºŒç»´è¡¨ï¼Œå¯¹åº”çš„è¡¨æ ¼ä¸­ä¸è®ºæœ‰æ²¡æœ‰æ•°æ®éƒ½è¦å ç”¨ç©ºé—´ï¼‰ 2.2.2 NoSQL æ•ˆç‡é«˜ï¼ˆå› ä¸ºå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜çš„é€Ÿåº¦è¦è¿œé«˜äºç¡¬ç›˜ï¼‰ ä¸å®‰å…¨ï¼ˆå†…å­˜æ–­ç‚¹ä¸¢å¤±æ•°æ®ï¼‰ 3ã€å¸¸è§çš„æ•°æ®åº“3.1 å…³ç³»å‹æ•°æ®åº“å¤§å‹ï¼šOracle,DB2ä¸­å‹ï¼šSQL-SERVER,MySQLå°å‹ï¼šaccessç­‰ 3.2 éå…³ç³»å‹æ•°æ®åº“memcached(å°)ï¼Œmongodbï¼ˆä¸­ï¼‰ï¼Œredisï¼ˆå¤§ï¼Œå¯å®ç°æ–­ç”µä¸ä¸¢å¤±æ•°æ®ï¼‰ 4ã€ä»€ä¹ˆæ˜¯å…³ç³»å‹æ•°æ®åº“4.1 å®šä¹‰å…³ç³»å‹æ•°æ®åº“æ˜¯ä¸€ç§å»ºç«‹åœ¨å…³ç³»æ¨¡å‹ï¼ˆæ•°å­¦æ¨¡å‹ï¼‰ä¸Šçš„æ•°æ®åº“ã€‚ 4.2 å…³ç³»æ¨¡å‹å…³ç³»æ¨¡å‹æ˜¯ä¸€ç§å»ºç«‹åœ¨å…³ç³»ä¸Šçš„æ¨¡å‹ï¼Œå…³ç³»æ¨¡å‹åŒ…å«ä¸‹åˆ—ä¸‰ä¸ªéƒ¨åˆ†ï¼š æ•°æ®ç»“æ„ï¼šè§£å†³æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œä½¿ç”¨äºŒç»´è¡¨æ¥å­˜å‚¨æ•°æ®ï¼ˆåŒ…æ‹¬è¡Œå’Œåˆ—ï¼‰ æ“ä½œæŒ‡ä»¤é›†åˆï¼šæ‰€æœ‰çš„SQLè¯­å¥ å®Œæ•´æ€§çº¦æŸï¼šè¡¨å†…æ•°æ®çº¦æŸï¼ˆå­—æ®µä¸å­—æ®µï¼‰ï¼Œè¡¨ä¸è¡¨ä¹‹é—´çš„æ•°æ®çº¦æŸï¼ˆå¤–é”®ï¼‰ æ•°æ®å®Œæ•´æ€§çº¦æŸæŒ‡çš„æ˜¯ä¸ºäº†é˜²æ­¢ä¸ç¬¦åˆè§„èŒƒçš„æ•°æ®è¿›å…¥æ•°æ®åº“ï¼Œåœ¨ç”¨æˆ·å¯¹æ•°æ®è¿›è¡Œæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œæ—¶ï¼ŒDBMSè‡ªåŠ¨æŒ‰ç…§ä¸€å®šçš„çº¦æŸæ¡ä»¶å¯¹æ•°æ®è¿›è¡Œç›‘æµ‹ï¼Œä½¿ä¸ç¬¦åˆè§„èŒƒçš„æ•°æ®ä¸èƒ½è¿›å…¥æ•°æ®åº“ï¼Œä»¥ç¡®ä¿æ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®æ­£ç¡®ã€æœ‰æ•ˆã€ç›¸å®¹ã€‚ 5ã€å…³ç³»å‹æ•°æ®åº“çš„è®¾è®¡å…³ç³»å‹æ•°æ®åº“ï¼šä»éœ€è¦å­˜å‚¨çš„æ•°æ®éœ€æ±‚ä¸­åˆ†æï¼Œå¦‚æœ æ˜¯ä¸€ç±»æ•°æ®ï¼ˆå®ä½“äº‹ç‰©ï¼‰åº”è¯¥è®¾è®¡æˆä¸€å¼ äºŒç»´è¡¨ã€‚ å…³ç³»å‹æ•°æ®åº“ï¼šç»´æŠ¤å®ä½“å†…éƒ¨ï¼Œå®ä½“ä¸å®ä½“ä¹‹é—´çš„è”ç³»ã€‚ è¡¨æ˜¯ç”±è¡¨å¤´å’Œæ•°æ®éƒ¨åˆ†ç»„æˆã€‚å…¶ä¸­è¡¨å¤´ä¸ºå­—æ®µåï¼Œç”¨æ¥è§„å®šæ•°æ®çš„åç§°ï¼›æ•°æ®ç»„æˆéƒ¨åˆ†ä¸ºå®é™…å­˜å‚¨çš„æ•°æ®å•å…ƒã€‚ å¦‚ä¸‹æ‰€ç¤ºä¸ºä¸€å¼ ç®€å•çš„äºŒç»´è¡¨: è¡¨å¤´ å­—æ®µå1 å­—æ®µå2 æ•°æ®å•å…ƒa æ•°æ®a1 æ•°æ®a2 æ•°æ®å•å…ƒb æ•°æ®b1 æ•°æ®b2 æ•°æ®å•å…ƒc æ•°æ®c1 æ•°æ®c2 6ã€ç®€å•æ¡ˆä¾‹åˆ†æä»¥æ•™å¸ˆã€å­¦ç”Ÿã€ç­çº§ä¸‰è€…ä¸ºæ ¸å¿ƒçš„æ•™å­¦ç³»ç»Ÿæ¡ˆä¾‹è¿›è¡Œä¸€ä¸ªç®€å•çš„åˆ†æï¼š æ‰¾å‡ºè¯¥æ•™å­¦ç³»ç»Ÿä¸­çš„æ‰€æœ‰å®ä½“ï¼šæ•™å¸ˆã€å­¦ç”Ÿã€ç­çº§ åˆ—å‡ºæ¯ä¸ªå®ä½“å¯¹åº”æ‰€æ‹¥æœ‰çš„æ•°æ®ä¿¡æ¯ï¼šï¼ˆæ­¤å¤„ä»…åˆ—ä¸¾å°‘é‡æ•°æ®ï¼‰ æ•™å¸ˆï¼šå§“åã€å¹´é¾„ã€èŒç§° å­¦ç”Ÿï¼šå§“åã€å­¦å·ã€ä¸“ä¸š ç­çº§ï¼šç­çº§åç§°ã€ç­çº§ç¼–å·ã€ä¸Šè¯¾åœ°ç‚¹ ä¸‹é¢å¼€å§‹å»ºè¡¨ 6.1 å®ä½“å†…éƒ¨è”ç³»ä¸‹é¢æ˜¯ä¸€å¼ å­¦ç”Ÿçš„ä¿¡æ¯è¡¨ å§“å å­¦å· ä¸“ä¸š å°æ˜ 001 è®¡ç®—æœº å°çº¢ 002 è‰ºæœ¯è®¾è®¡ å°é»‘ 003 null è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¡¨ä¸­å°é»‘çš„ä¸“ä¸šè¿™ä¸€æ æ˜¯ç©ºç™½çš„ï¼ˆnullï¼‰ï¼Œä½†æ˜¯è¿™ä¸€æ çš„ä½ç½®è¿˜æ˜¯è¦ç»™å°é»‘ç•™ç€ï¼Œä¸èƒ½å°±è¿™æ ·å°†å…¶åˆ é™¤ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå…³ç³»å‹æ•°æ®åº“å ç”¨ä½ç½®çš„åŸå› ã€‚ ç¬¬äºŒè¡Œçš„æ‰€æœ‰å­—æ®µï¼ˆå³æ•´ä¸ªç¬¬äºŒè¡Œï¼‰éƒ½æ˜¯åœ¨æè¿°å°æ˜çš„ä¸ªäººä¿¡æ¯ï¼Œå³æè¿°å°æ˜è¿™ä¸ªå­¦ç”Ÿï¼Œè¿™ä¸ªæ˜¯å†…éƒ¨è”ç³»ã€‚ ç¬¬äºŒåˆ—çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯å­¦å·ï¼Œå³æ•´ä¸ªç¬¬äºŒåˆ—åªèƒ½å­˜æ”¾å¯¹åº”çš„å­¦å·ä¿¡æ¯ï¼Œè¿™ä¸ªæ˜¯å†…éƒ¨çº¦æŸã€‚ 6.2 å®ä½“ä¸å®ä½“ä¹‹é—´çš„å…³ç³»æ¯ä¸ªå­¦ç”Ÿè‚¯å®šå±äºæŸä¸ªç­çº§ï¼Œè€Œä¸€ä¸ªç­çº§åº”è¯¥æœ‰å¤šä¸ªå­¦ç”Ÿï¼Œè¿™ç§æ˜¯ä¸€å¯¹å¤šçš„å¯¹åº”å…³ç³»ã€‚ è¿™é‡Œä»¥ç­çº§å’Œå­¦ç”Ÿä¸ºä¾‹ é¦–å…ˆæˆ‘ä»¬è¡¥å……ä¸€ä¸ªç­çº§è¡¨ï¼Œè¿˜æœ‰è¡¥å……é™å®šè§„åˆ™ï¼Œè¡¨ä¸­çš„ç­çº§åç§°å’Œç­çº§ç¼–å·æ˜¯å”¯ä¸€ä¸å¯é‡å¤çš„ï¼Œè€Œä¸Šè¯¾åœ°ç‚¹åˆ™ä¸æ˜¯ã€‚ ç­çº§è¡¨ ç­çº§ç¼–å· ç­çº§åç§° ä¸Šè¯¾åœ°ç‚¹ CS01 è®¡ç®—æœº1ç­ D301 CS02 è®¡ç®—æœº2ç­ E204 AD01 è‰ºæœ¯è®¾è®¡1ç­ G306 AD02 è‰ºæœ¯è®¾è®¡2ç­ G407 è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¦‚æœéœ€è¦æŠŠå­¦ç”Ÿå’Œç­çº§ä¹‹é—´å»ºç«‹è”ç³»ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š åœ¨ç­çº§è¡¨ä¸­æ’å…¥å­¦ç”Ÿä¿¡æ¯ åœ¨å­¦ç”Ÿè¡¨ä¸­æ’å…¥ç­çº§ä¿¡æ¯ å› ä¸ºæˆ‘ä»¬çŸ¥é“ç­çº§å’Œå­¦ç”Ÿæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä¸€ä¸ªç­çº§å¯ä»¥æœ‰å¾ˆå¤šä¸ªå­¦ç”Ÿï¼Œè€Œä¸€ä¸ªå­¦ç”Ÿåªèƒ½å±äºä¸€ä¸ªç­çº§ï¼Œå› æ­¤åœ¨å­¦ç”Ÿè¡¨ä¸­æ’å…¥ç­çº§ä¿¡æ¯åˆ™åªéœ€è¦å¤šæ·»åŠ ä¸€åˆ—å­—æ®µå³å¯ã€‚ä¸ºäº†ä¿è¯æ·»åŠ ç­çº§ä¿¡æ¯çš„æ—¶å€™åªèƒ½å¤Ÿæ‰¾åˆ°å”¯ä¸€ä¸€ä¸ªå¯¹åº”çš„ç­çº§è€Œä¸å‘ç”Ÿé‡å¤å†²çªçš„æƒ…å†µï¼Œå¯¹åº”çš„ç­çº§æ•°æ®ä¿¡æ¯å¿…é¡»æ˜¯åœ¨ç­çº§è¡¨ä¸­å”¯ä¸€ä¸é‡å¤çš„ï¼Œä¹Ÿå°±æ˜¯ç­çº§ç¼–å·æˆ–è€…æ˜¯ç­çº§åç§°ã€‚ äºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†ä¸‹è¡¨ å¸¦ç­çº§ä¿¡æ¯çš„å­¦ç”Ÿè¡¨ å§“å å­¦å· ä¸“ä¸š ç­çº§ å°æ˜ 001 è®¡ç®—æœº CS01 å°çº¢ 002 è‰ºæœ¯è®¾è®¡ AD02 å°é»‘ 003 null null è¡Œ/è®°å½•å’Œåˆ—/å­—æ®µçš„åŒºåˆ« è¡Œ/è®°å½•ï¼šrow/recordï¼Œæœ¬è´¨ç›¸åŒï¼Œéƒ½æ˜¯æŒ‡è¡¨ä¸­çš„ä¸€è¡Œ/ä¸€æ¡è®°å½•ã€‚ åˆ—/å­—æ®µï¼šcolumn/fieldï¼Œæœ¬è´¨ç›¸åŒï¼Œéƒ½æ˜¯æŒ‡è¡¨ä¸­çš„ä¸€åˆ—/ä¸€ä¸ªå­—æ®µã€‚ åªæ˜¯è¡Œå’Œåˆ—æ˜¯ä»äºŒç»´è¡¨çš„ç»“æ„è§’åº¦å‡ºå‘ï¼Œè€Œè®°å½•å’Œå­—æ®µæ˜¯ä»æ•°æ®åº“çš„æ•°æ®è§’åº¦å‡ºå‘ã€‚ 7ã€ä»€ä¹ˆæ˜¯SQL SQLï¼šStructured Query Languageï¼Œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œï¼ˆå¹¶ä¸åªæ˜¯æŸ¥è¯¢æ“ä½œï¼Œä¹Ÿæœ‰å…¶ä»–æ“ä½œï¼Œåªæ˜¯å› ä¸ºæ•°æ®åº“ä¸­çš„99%çš„æ“ä½œéƒ½æ˜¯æŸ¥è¯¢æ“ä½œï¼‰ SQLåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š DDLï¼šData Definition Languageï¼Œæ•°æ®å®šä¹‰è¯­è¨€ï¼Œç”¨æ¥ç»´æŠ¤å­˜å‚¨æ•°æ®çš„ç»“æ„ï¼ˆæ•°æ®åº“ã€è¡¨ï¼‰ï¼Œä»£è¡¨æŒ‡ä»¤ï¼šcreateï¼Œdropï¼Œalterç­‰ DMLï¼šData Manipulation Languageï¼Œæ•°æ®æ“çºµè¯­è¨€ï¼Œç”¨æ¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼ˆæ•°æ®è¡¨ä¸­çš„å†…å®¹ï¼‰ï¼Œä»£è¡¨æŒ‡ä»¤ï¼šinsertï¼Œdeleteï¼Œupdateç­‰ï¼ˆåˆ†åˆ«å¯¹åº”å¢åˆ æ”¹ä¸‰ä¸ªæ“ä½œï¼‰ï¼› å…¶ä¸­åœ¨DMLå†…éƒ¨åˆä¸“é—¨åˆ’åˆ†å‡ºä¸€ä¸ªåˆ†ç±»ï¼šDQLï¼šData Query Languageï¼šæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œå¦‚select DCLï¼šData Control Languageï¼Œæ•°æ®æ§åˆ¶è¯­è¨€ï¼Œä¸»è¦æ˜¯è´Ÿè´£æƒé™ç®¡ç†ï¼ˆç”¨æˆ·ï¼‰ï¼Œä»£è¡¨æŒ‡ä»¤ï¼šgrantï¼Œrevokeç­‰ã€‚ï¼ˆå¯¹åº”åˆ†é…å’Œå›æ”¶æƒé™ï¼‰ æ³¨æ„ï¼ŒSQLæ˜¯å…³ç³»å‹æ•°æ®åº“çš„æ“ä½œæŒ‡ä»¤ï¼ŒSQLæ˜¯ä¸€ç§çº¦æŸä½†ä¸å¼ºåˆ¶ï¼ˆç±»ä¼¼W3Cæ ‡å‡†ï¼‰ã€‚è¿™æ„å‘³ç€ä¸åŒçš„æ•°æ®åº“å¦‚Oracleå’ŒMySQLä¹‹é—´çš„æŒ‡ä»¤ä¸ä¸€å®šèƒ½é€šç”¨ï¼Œå¯èƒ½ä¼šæœ‰ç»†å¾®çš„å·®åˆ«ã€‚ 8ã€MySQLæ•°æ®åº“MySQLæ•°æ®åº“æ˜¯ä¸€ç§C/Sç»“æ„çš„è½¯ä»¶ï¼šå®¢æˆ·ç«¯/æœåŠ¡ç«¯ã€‚ç‰¹ç‚¹ï¼šè‹¥æƒ³è®¿é—®æœåŠ¡å™¨å¿…é¡»é€šè¿‡å®¢æœç«¯ï¼ˆæœåŠ¡å™¨ä¸€ç›´è¿è¡Œï¼Œå®¢æˆ·ç«¯åœ¨éœ€è¦ä½¿ç”¨çš„æ—¶å€™è¿è¡Œï¼‰ 8.1 äº¤äº’æ–¹å¼ å®¢æˆ·ç«¯è¿æ¥è®¤è¯ï¼šè¿æ¥æœåŠ¡å™¨ï¼Œè®¤è¯èº«ä»½ï¼šmysql.exe -hPup 1mysql -hlocalhost -P3306 -uroot -p å…¶ä¸­hæ˜¯æ‰¾ä¸»æœºçš„IPï¼Œè¿™é‡Œæ˜¯localhostå³ä¸ºæœ¬æœºï¼ŒPæ˜¯æ‰¾ç«¯å£ï¼Œmysqlå¯¹åº”çš„æ˜¯3306ç«¯å£ï¼Œuæ˜¯ç”¨æˆ·ï¼Œè¿™é‡Œæ˜¯rootç”¨æˆ·ï¼Œpåˆ™æ˜¯ä½¿ç”¨å¯†ç  å®¢æˆ·ç«¯å‘é€SQLæŒ‡ä»¤ æœåŠ¡å™¨æ¥å—SQLæŒ‡ä»¤ï¼›å¤„ç†SQLæŒ‡ä»¤ï¼›è¿”å›æ“ä½œç»“æœ å®¢æˆ·ç«¯æ¥å—ç»“æœï¼šæ˜¾ç¤ºç»“æœ æ–­å¼€è¿æ¥ï¼ˆé‡Šæ”¾èµ„æºï¼šä¿è¯æœåŠ¡å™¨çš„å¹¶å‘æ€§ï¼‰ 9ã€MySQLæœåŠ¡å™¨å¯¹è±¡å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åŠæ³•å®Œå…¨äº†è§£æœåŠ¡å™¨å†…éƒ¨çš„å†…å®¹ï¼Œåªèƒ½ç²—ç•¥åœ°å»åˆ†ææ•°æ®åº“æœåŠ¡å™¨å†…éƒ¨çš„ç»“æ„ã€‚ å°†MySQLæœåŠ¡å™¨å†…éƒ¨å¯¹è±¡åˆ†ä¸ºå››å±‚ï¼š æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰-&gt; æ•°æ®åº“ï¼ˆDBï¼‰-&gt; æ•°æ®è¡¨ï¼ˆtableï¼‰-&gt; å­—æ®µï¼ˆfieldï¼‰ 10ã€SQLåŸºæœ¬æ“ä½œåŸºæœ¬æ“ä½œï¼šå¢åˆ æ”¹æŸ¥ å°†SQLçš„åŸºæœ¬æ“ä½œæ ¹æ®æ“ä½œå¯¹è±¡åˆ†ä¸ºä¸‰ç±»ï¼šåº“æ“ä½œï¼Œè¡¨æ“ä½œï¼ˆå­—æ®µï¼‰ï¼Œæ•°æ®æ“ä½œ 11ã€æ•°æ®åº“æ“ä½œ11.1 æ–°å¢æ•°æ®åº“11.1.1 æŒ‡ä»¤1create database æ•°æ®åº“å [åº“é€‰é¡¹] 11.1.2æ•°æ®åº“å‘½åè§„åˆ™ æ•°æ®åº“åå­—ä¸èƒ½ä½¿ç”¨å…³é”®å­—æˆ–è€…ä¿ç•™å­— å¦‚æœä½¿ç”¨å…³é”®å­—æˆ–è€…ä¿ç•™å­—ï¼Œéœ€è¦ä½¿ç”¨åå¼•å·æŠŠæ•°æ®åº“åå­—æ‹¬èµ·æ¥ ä¿è¯æœåŠ¡å™¨å¯ä»¥è¯†åˆ«ä¸­æ–‡çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ä¸­æ–‡å‘½åæ•°æ®åº“ï¼Œä½†æ˜¯éå¸¸ä¸å»ºè®®è¿™æ ·åš 11.1.3 åº“é€‰é¡¹åº“é€‰é¡¹ï¼šç”¨æ¥çº¦æŸæ•°æ®åº“ï¼Œåˆ†ä¸ºä¸¤ä¸ªé€‰é¡¹ å­—ç¬¦é›†è®¾å®šï¼šcharset/character set å…·ä½“å­—ç¬¦é›†ï¼ˆæ•°æ®å­˜å‚¨çš„ç¼–ç æ ¼å¼ï¼‰ æ ¡å¯¹é›†è®¾å®šï¼šcollate å…·ä½“æ ¡å¯¹é›†ï¼ˆæ•°æ®æ¯”è¾ƒçš„è§„åˆ™ï¼‰ 11.1.4 æ³¨é‡ŠåŒä¸­åˆ’çº¿+ç©ºæ ¼æˆ–è€…ä½¿ç”¨äº•å· 12-- è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š# è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ³¨é‡Š 11.1.5 æŠ¥é”™è§„åˆ™é™é»˜æ¨¡å¼ï¼Œå³åªä¼šå‘ŠçŸ¥æŠ¥é”™çš„å¤§æ¦‚ä½ç½®è€Œä¸ä¼šå‘ŠçŸ¥é”™è¯¯çš„åŸå› ã€‚ 11.1.6 åˆ›å»ºäº†æ•°æ®åº“ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆ åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¢åŠ äº†å¯¹åº”çš„æ•°æ®åº“ä¿¡æ¯ï¼› ä¼šåœ¨ä¿å­˜æ•°æ®åº“çš„æ–‡ä»¶ç›®å½•ä¸‹æ–°å¢ä¸€ä¸ªå¯¹åº”æ•°æ®åº“åå­—çš„æ–‡ä»¶å¤¹ï¼› æ¯ä¸ªæ•°æ®åº“æ–‡ä»¶å¤¹ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„db.optæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­è®°å½•åº“é€‰é¡¹ â–¼å›¾ä¸­ä¸ºå¯¹åº”æ•°æ®åº“çš„å­—ç¬¦é›†è®¾å®šå’Œæ ¡å¯¹é›†è®¾å®šã€‚ï¼ˆæ ¡å¯¹é›†ä¾èµ–å­—ç¬¦é›†ï¼‰ 11.2 æŸ¥çœ‹æ•°æ®åº“11.2.1 æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“1mysql&gt; show databases; 11.2.2 æŸ¥çœ‹æŒ‡å®šéƒ¨åˆ†çš„æ•°æ®åº“ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰1show databases like &#x27;pattern&#x27;ï¼› å…¶ä¸­patternæ˜¯åŒ¹é…æ¨¡å¼çš„æ„æ€ï¼Œåˆ†ä¸ºä¸¤ç§åŒ¹é…æ¨¡å¼ %ï¼šåŒ¹é…å¤šä¸ªå­—ç¬¦_:åŒ¹é…å•ä¸ªå­—ç¬¦ æŸ¥çœ‹ä»¥mydata_å¼€å¤´çš„æ•°æ®åº“æ—¶ï¼Œéœ€è¦å¯¹_è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œå³åœ¨å‰é¢åŠ ä¸€ä¸ªåæ–œæ ï¼Œå¦åˆ™ä¼šæŸ¥è¯¢é”™è¯¯ï¼Œå› ä¸ºç³»ç»Ÿä¼šè®¤ä¸ºmydata_ä¸­çš„_æ˜¯åŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œè€Œ%æ˜¯åŒ¹é…å¤šä¸ªå­—ç¬¦ï¼Œè¿™æ ·å­çš„è¯ï¼š 123show databases like &#x27;mydata_%&#x27;show databases like &#x27;mydata%&#x27; è¿™ä¸¤æ¡è¯­å¥çš„å®é™…ä½¿ç”¨æ•ˆæœå°±æ˜¯ä¸€æ ·çš„äº†ã€‚ æ­£ç¡®çš„æ“ä½œåº”è¯¥æ˜¯ 1show databases like &#x27;mydata\\_%&#x27; 11.2.3 æŸ¥çœ‹åˆ›å»ºæ•°æ®åº“çš„æ—¶å€™ä½¿ç”¨çš„è¯­å¥1show create database æ•°æ®åº“å; å› ä¸ºSQLæ˜¯ä¸€ç§ç¼–è¯‘å‹è¯­è¨€ï¼Œæ‰€ä»¥æ•°æ®åº“åœ¨æ‰§è¡ŒSQLè¯­å¥ä¹‹å‰ä¼šå¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œå¯¼è‡´æœ€ç»ˆæˆ‘ä»¬æŸ¥è¯¢åˆ°çš„åˆ›å»ºæ•°æ®åº“æ—¶ä½¿ç”¨çš„è¯­å¥å’Œæˆ‘ä»¬è¾“å…¥çš„è¯­å¥å¹¶ä¸å®Œå…¨ä¸€è‡´ã€‚ 11.3 æ›´æ–°æ•°æ®åº“ æ•°æ®åº“åå­—ä¸å¯ä»¥ä¿®æ”¹ï¼ˆä¿®æ”¹åå­—ä¸å®‰å…¨ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼‰ æ•°æ®åº“çš„ä¿®æ”¹ ä»…é™äºåº“é€‰é¡¹ï¼Œå³å­—ç¬¦é›†å’Œæ ¡å¯¹é›†ï¼ˆæ³¨æ„æ ¡å¯¹é›†ä¾èµ–å­—ç¬¦é›†ï¼‰ alter database æ•°æ®åº“å [åº“é€‰é¡¹] charset/character set = å­—ç¬¦é›† //æ³¨æ„æ­¤å¤„å¯ä»¥ä½¿ç”¨=ä¹Ÿå¯ä»¥ä¸ç”¨ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ç”¨ collate = æ ¡å¯¹é›† ä¸€èˆ¬ä¸è½»æ˜“ä¿®æ”¹åº“é€‰é¡¹ 11.4 åˆ é™¤æ•°æ®åº“æ•°æ®åº“å±äºç»“æ„ï¼Œæ‰€ä»¥ä½¿ç”¨ddlè¯­è¨€ï¼Œå³dropè¯­å¥ï¼› 1drop database æ•°æ®åº“å; æ³¨æ„ï¼šæ•°æ®åº“åˆ é™¤åæéš¾æ¢å¤ï¼Œä¸€å®šè¦æ³¨æ„å¤‡ä»½ï¼Œä¸è¦è½»æ˜“åˆ åº“ 11.4.1 æ•°æ®åº“åˆ é™¤åå‘ç”Ÿäº†ä»€ä¹ˆ åœ¨æ•°æ®åº“å†…éƒ¨è¯¥æ•°æ®åº“è¢«åˆ é™¤äº†ï¼› æ•°æ®åº“å¯¹åº”çš„æ–‡ä»¶å¤¹ä¹Ÿè¢«é€’å½’åˆ é™¤äº†ï¼›","categories":[{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://tinychen.com/tags/mysql/"},{"name":"database","slug":"database","permalink":"https://tinychen.com/tags/database/"}]},{"title":"è®¡ç®—æœºä¸­çš„ä¸€äº›ç‰¹æ®ŠIPåœ°å€","slug":"20190227-special-ip","date":"2019-02-27T07:00:00.000Z","updated":"2019-02-27T07:00:00.000Z","comments":true,"path":"20190227-special-ip/","link":"","permalink":"https://tinychen.com/20190227-special-ip/","excerpt":"è®°å½•ä¸€äº›ç‰¹æ®Šçš„IPåœ°å€ï¼Œæ’æŸ¥ç½‘ç»œæ•…éšœçš„æ—¶å€™æœ‰åˆ©äºå¿«é€Ÿå®šä½é—®é¢˜ã€‚","text":"è®°å½•ä¸€äº›ç‰¹æ®Šçš„IPåœ°å€ï¼Œæ’æŸ¥ç½‘ç»œæ•…éšœçš„æ—¶å€™æœ‰åˆ©äºå¿«é€Ÿå®šä½é—®é¢˜ã€‚ 0.0.0.0ä¸¥æ ¼è¯´æ¥ï¼Œè¿™ä¸ªå¥‡è‘©çš„åœ°å€0.0.0.0å·²ç»ä¸æ˜¯ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šçš„IPåœ°å€äº†ã€‚å®ƒè¡¨ç¤ºçš„æ˜¯è¿™æ ·ä¸€ä¸ªé›†åˆï¼šä¹Ÿå°±æ˜¯è¯´ï¼›æ‰€æœ‰ä¸æ¸…æ¥šçš„ä¸»æœºå’Œç›®çš„ç½‘ç»œã€‚è¿™é‡Œçš„â€œä¸æ¸…æ¥šâ€æ˜¯æŒ‡åœ¨æœ¬æœºçš„è·¯ç”±è¡¨é‡Œæ²¡æœ‰ç‰¹å®šæ¡ç›®æŒ‡æ˜å¦‚ä½•åˆ°è¾¾ã€‚å¯¹æœ¬æœºæ¥è¯´ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªâ€œæ”¶å®¹æ‰€â€ï¼Œæ‰€æœ‰ä¸è®¤è¯†çš„â€œä¸‰æ— â€äººå‘˜ï¼Œä¸€å¾‹é€è¿›å»ã€‚å¦‚æœä½ åœ¨ç½‘ç»œè®¾ç½®ä¸­è®¾ç½®äº†ç¼ºçœç½‘å…³ï¼Œé‚£ä¹ˆè®¡ç®—æœºç³»ç»Ÿä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªç›®çš„åœ°å€ä¸º0.0.0.0çš„ç¼ºçœè·¯ç”±ã€‚ 255.255.255.255 é™åˆ¶å¹¿æ’­åœ°å€å¯¹æœ¬æœºæ¥è¯´ï¼Œè¿™ä¸ªåœ°å€æŒ‡æœ¬ç½‘æ®µå†…(åŒä¸€å¹¿æ’­åŸŸ)çš„æ‰€æœ‰ä¸»æœºã€‚ç„¶è€Œå®ƒçš„æ„æ€å¾ˆæ˜ç¡®ï¼Œä½¿ç”¨äººç±»è¯­è¨€æ¥è¯´æ„æ€å°±æ˜¯â€œè¿™é‡Œçš„æ‰€æœ‰è®¡ç®—æœºéƒ½æ³¨æ„äº†â€è¿™ä¸ªåœ°å€ä¸èƒ½è¢«è·¯ç”±å™¨æ‰€è½¬å‘ã€‚ 127.0.0.1 æœ¬æœºåœ°å€ä¸»è¦ç”¨äºæµ‹è¯•ã€‚ç”¨æ±‰è¯­è¡¨ç¤ºï¼Œå°±æ˜¯â€œæˆ‘è‡ªå·±â€ã€‚åœ¨Windowsç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªåœ°å€æœ‰ä¸€ä¸ªåˆ«åâ€œLocalhostâ€ã€‚å¯»å€è¿™æ ·ä¸€ä¸ªåœ°å€ï¼Œæ˜¯ä¸èƒ½æŠŠå®ƒå‘åˆ°ç½‘ç»œæ¥å£çš„ã€‚é™¤éå‡ºé”™ï¼Œå¦åˆ™åœ¨ä¼ è¾“ä»‹è´¨ä¸Šæ°¸è¿œä¸åº”è¯¥å‡ºç°ç›®çš„åœ°å€ä¸ºâ€œ127.0.0.1â€çš„æ•°æ®åŒ…ã€‚ 224.0.0.1 ç»„æ’­åœ°å€æ³¨æ„å®ƒå’Œå¹¿æ’­çš„åŒºåˆ«ã€‚ä»224.0.0.0åˆ°239.255.255.255éƒ½æ˜¯è¿™æ ·çš„åœ°å€ã€‚224.0.0.1ç‰¹æŒ‡æ‰€æœ‰ä¸»æœºï¼Œ224.0.0.2ç‰¹æŒ‡æ‰€æœ‰è·¯ç”±å™¨ã€‚è¿™æ ·çš„åœ°å€å¤šç”¨äºä¸€äº›ç‰¹å®šçš„ç¨‹åºä»¥åŠå¤šåª’ä½“ç¨‹åºã€‚å¦‚æœä½ çš„ä¸»æœºå¼€å¯äº†IRDP(Internetè·¯ç”±å‘ç°åè®®ï¼‰ï¼Œä½¿ç”¨ç»„æ’­åŠŸèƒ½åŠŸèƒ½ï¼Œé‚£ä¹ˆä½ çš„ä¸»æœºè·¯ç”±è¡¨ä¸­åº”è¯¥æœ‰è¿™æ ·ä¸€æ¡è·¯ç”±ã€‚ 169.254.x.xå¦‚æœä½ çš„ä¸»æœºä½¿ç”¨äº†DHCPåŠŸèƒ½è‡ªåŠ¨è·å¾—ä¸€ä¸ªIPåœ°å€ï¼Œé‚£ä¹ˆå½“ä½ çš„DHCPæœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œæˆ–å“åº”æ—¶é—´å¤ªé•¿è€Œè¶…å‡ºäº†ä¸€ä¸ªç³»ç»Ÿè§„å®šçš„æ—¶é—´ï¼Œè®¡ç®—æœºæ“ä½œç³»ç»Ÿä¼šä¸ºä½ åˆ†é…è¿™æ ·ä¸€ä¸ªåœ°å€ã€‚å¦‚æœä½ å‘ç°ä½ çš„ä¸»æœºIPåœ°å€æ˜¯ä¸€ä¸ªè¯¸å¦‚æ­¤ç±»çš„åœ°å€ï¼Œå¾ˆä¸å¹¸çš„æ˜¯ï¼Œç°åœ¨ä½ çš„ç½‘ç»œä¸èƒ½æ­£å¸¸è¿è¡Œäº†ã€‚ 10.x.x.xï¼›172.16.0.0â€”172.31.255.254ï¼›192.168.x.xï¼›ç§æœ‰åœ°å€è¿™äº›åœ°å€è¢«å¤§é‡ç”¨äºä¼ä¸šå†…éƒ¨ç½‘ç»œä¸­ã€‚ä¸€äº›å®½å¸¦è·¯ç”±å™¨ï¼Œä¹Ÿå¾€å¾€ä½¿ç”¨192.168.1.1ä½œä¸ºç¼ºçœåœ°å€ã€‚ç§æœ‰ç½‘ç»œç”±äºä¸ä¸å¤–éƒ¨äº’è¿ï¼Œå› è€Œå¯èƒ½ä½¿ç”¨éšæ„çš„IPåœ°å€ã€‚ä¿ç•™è¿™æ ·çš„åœ°å€ä¾›å…¶ä½¿ç”¨æ˜¯ä¸ºäº†é¿å…ä»¥åæ¥å…¥å…¬ç½‘æ—¶å¼•èµ·åœ°å€æ··ä¹±ã€‚ä½¿ç”¨ç§æœ‰åœ°å€çš„ç§æœ‰ç½‘ç»œåœ¨æ¥å…¥Internetæ—¶ï¼Œè¦ä½¿ç”¨åœ°å€ç¿»è¯‘(NAT)ï¼Œå°†ç§æœ‰åœ°å€ç¿»è¯‘æˆå…¬ç”¨åˆæ³•åœ°å€ã€‚åœ¨Internetä¸Šï¼Œè¿™ç±»åœ°å€æ˜¯ä¸èƒ½å‡ºç°çš„ã€‚å¯¹ä¸€å°ç½‘ç»œä¸Šçš„ä¸»æœºæ¥è¯´ï¼Œå®ƒå¯ä»¥æ­£å¸¸æ¥æ”¶çš„åˆæ³•ç›®çš„ç½‘ç»œåœ°å€æœ‰ä¸‰ç§ï¼šæœ¬æœºçš„IPåœ°å€ã€å¹¿æ’­åœ°å€ä»¥åŠç»„æ’­åœ°å€ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"ip","slug":"ip","permalink":"https://tinychen.com/tags/ip/"}]},{"title":"ç¼–è¯‘åŸç†å¤ä¹ æçº²","slug":"20190117-compiling","date":"2019-01-17T07:00:00.000Z","updated":"2019-01-17T07:00:00.000Z","comments":true,"path":"20190117-compiling/","link":"","permalink":"https://tinychen.com/20190117-compiling/","excerpt":"ã€Šç¼–è¯‘åŸç†ã€‹å¤ä¹ æçº²ï¼Œå•¥ä¹Ÿåˆ«è¯´äº†ï¼Œå¤§å®¶è€ƒè¯•å¥½è¿(à¸‡ â€¢_â€¢)à¸‡","text":"ã€Šç¼–è¯‘åŸç†ã€‹å¤ä¹ æçº²ï¼Œå•¥ä¹Ÿåˆ«è¯´äº†ï¼Œå¤§å®¶è€ƒè¯•å¥½è¿(à¸‡ â€¢_â€¢)à¸‡ ç¼–è¯‘è¿‡ç¨‹ç¼–è¯‘ç¨‹åºçš„åŸºæœ¬ä»»åŠ¡æ˜¯å°†æºè¯­è¨€ç¨‹åºç¿»è¯‘æˆç­‰ä»·çš„ç›®æ ‡è¯­è¨€ç¨‹åºã€‚ ä¸€èˆ¬çš„ï¼Œå°†ç¼–è¯‘è¿‡ç¨‹åˆ’åˆ†æˆè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€ä¸­é—´ä»£ç ç”Ÿæˆã€ä»£ç ä¼˜åŒ–å’Œç›®æ ‡ä»£ç ç”Ÿæˆ6ä¸ªé˜¶æ®µã€‚ è¯æ³•åˆ†æ è¯æ³•åˆ†æçš„ä»»åŠ¡æ˜¯ä»å·¦åˆ°å³ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å…¥æºç¨‹åºï¼Œå¯¹æ„æˆæºç¨‹åºçš„å­—ç¬¦æµè¿›è¡Œæ‰«æå’Œåˆ†è§£ï¼Œä»è€Œè¯†åˆ«å‡ºä¸€ä¸ªä¸ªå•è¯*ï¼ˆä¸€äº›åœºåˆä¸‹ä¹Ÿç§°å•è¯ç¬¦å·æˆ–ç¬¦å·ï¼‰*ã€‚ è¿™é‡Œæ‰€è°“çš„å•è¯æ˜¯æŒ‡é€»è¾‘ä¸Šç´§å¯†ç›¸è¿çš„ä¸€ç»„å­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦å…·æœ‰é›†ä½“å«ä¹‰ã€‚ è¯­æ³•åˆ†æ è¯­æ³•åˆ†æçš„ä»»åŠ¡æ˜¯å†è¯æ³•åˆ†æçš„åŸºç¡€ä¸Šå°†å•è¯åºåˆ—åˆ†è§£æˆå„ç±»è¯­æ³•çŸ­è¯­ã€‚ è¿™ç§è¯­æ³•çŸ­è¯­ä¹Ÿç§°ä¸ºè¯­æ³•å•ä½ï¼Œå¯è¡¨ç¤ºæˆè¯­æ³•æ ‘ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ è¯­æ³•åˆ†ææ‰€ä¾æ®çš„æ˜¯è¯­è¨€çš„è¯­æ³•è§„åˆ™ï¼Œå³æè¿°ç¨‹åºç»“æ„çš„è§„åˆ™ã€‚é€šè¿‡è¯­æ³•åˆ†æç¡®å®šæ•´ä¸ªè¾“å…¥ä¸²æ˜¯å¦æ„æˆä¸€ä¸ªè¯­æ³•ä¸Šæ­£ç¡®çš„ç¨‹åºã€‚ è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†ææœ¬è´¨ä¸Šéƒ½æ˜¯å¯¹æºç¨‹åºçš„ç»“æ„è¿›è¡Œåˆ†æã€‚ä½†è¯æ³•åˆ†æçš„ä»»åŠ¡ä»…å¯¹æºç¨‹åºè¿›è¡Œçº¿æ€§æ‰«æå³å¯å®Œæˆï¼Œæ¯”å¦‚è¯†åˆ«æ ‡è¯†ç¬¦ï¼Œå› ä¸ºæ ‡è¯†ç¬¦çš„ç»“æ„æ˜¯å­—æ¯æ‰“å¤´çš„å­—æ¯å’Œæ•°å­—ä¸²ï¼Œè¿™åªè¦é¡ºåºæ‰«æè¾“å…¥æµï¼Œé‡åˆ°æ—¢ä¸æ˜¯å­—æ¯åˆä¸æ˜¯æ•°å­—çš„å­—ç¬¦æ—¶ï¼Œå°†å‰é¢æ‰€å‘ç°çš„æ‰€æœ‰å­—æ¯å’Œæ•°å­—ç»„åˆåœ¨ä¸€èµ·æ„æˆæ ‡è¯†ç¬¦å•è¯å³å¯ã€‚ä½†è¿™ç§çº¿æ€§æ‰«æä¸èƒ½ç”¨äºè¯†åˆ«é€’å½’å®šä¹‰çš„è¯­æ³•æˆåˆ†ï¼Œæ¯”å¦‚ä¸èƒ½ç”¨æ­¤åŠæ³•å»åŒ¹é…è¡¨è¾¾å¼ä¸­çš„æ‹¬å·ã€‚ è¯­ä¹‰åˆ†æ è¯­ä¹‰åˆ†ææ˜¯å®¡æŸ¥æºç¨‹åºæœ‰æ— è¯­ä¹‰é”™è¯¯ï¼Œä¸ºä»£ç ç”Ÿæˆé˜¶æ®µæ”¶é›†ç±»å‹ä¿¡æ¯ã€‚ ä¾‹å¦‚ï¼Œè¯­ä¹‰åˆ†æçš„ä¸€ä¸ªå·¥ä½œæ˜¯è¿›è¡Œç±»å‹å®¡æŸ¥ï¼Œå®¡æŸ¥æ¯ä¸ªç®—ç¬¦æ˜¯å¦å…·æœ‰è¯­è¨€è§„èŒƒå…è®¸çš„è¿ç®—å¯¹è±¡ï¼Œå½“ä¸ç¬¦åˆè¯­è¨€è§„èŒƒæ—¶ï¼Œç¼–è¯‘ç¨‹åºåº”æŠ¥å‘Šé”™è¯¯ã€‚ ä¸­é—´ä»£ç ç”Ÿæˆ åœ¨è¿›è¡Œäº†ä¸Šè¿°çš„è¯­æ³•åˆ†æå’Œè¯­ä¹‰åˆ†æé˜¶æ®µçš„å·¥ä½œä¹‹åï¼Œæœ‰çš„ç¼–è¯‘ç¨‹åºå°†æºç¨‹åºå˜æˆä¸€ç§å†…éƒ¨è¡¨ç¤ºå½¢å¼ï¼Œè¿™ç§è¡¨ç°å½¢å¼å«åšä¸­é—´è¯­è¨€æˆ–ä¸­é—´ä»£ç ã€‚ æ‰€è°“â€œä¸­é—´ä»£ç â€æ˜¯ä¸€ç§ç»“æ„ç®€å•ã€å«ä¹‰æ˜ç¡®çš„è®°å·ç³»ç»Ÿï¼Œè¿™ç§è®°å·ç³»ç»Ÿå¯ä»¥è®¾è®¡ä¸ºå¤šç§å¤šæ ·çš„å½¢å¼ï¼Œé‡è¦çš„è®¾è®¡åŸåˆ™ä¸ºä¸¤ç‚¹ï¼šä¸€æ˜¯å®¹æ˜“ç”Ÿæˆï¼›äºŒæ˜¯å®¹æ˜“å°†å®ƒç¿»è¯‘æˆç›®æ ‡ä»£ç ã€‚ å¾ˆå¤šç¼–è¯‘ç¨‹åºé‡‡ç”¨äº†ä¸€ç§è¿‘ä¼¼â€œä¸‰åœ°å€æŒ‡ä»¤â€çš„â€œå››å…ƒå¼â€ä¸­é—´ä»£ç ï¼Œè¿™ç§å››å…ƒå¼çš„å½¢å¼ä¸º ï¼ˆè¿ç®—ç¬¦ï¼Œè¿ç®—å¯¹è±¡1ï¼Œè¿ç®—å¯¹è±¡2ï¼Œç»“æœï¼‰ id1:= id2 + id3 * 10 (1) (* id3 10 t1) (2) (+ id2 t1 t2) (3) (:= t2 - id1) ä»£ç ä¼˜åŒ–å¯¹å‰ä¸€é˜¶æ®µäº§ç”Ÿçš„ä¸­é—´ä»£ç è¿›è¡Œå˜æ¢æˆ–è¿›è¡Œæ”¹é€ ï¼Œç›®çš„æ˜¯ä½¿ç”Ÿæˆçš„ç›®æ ‡ä»£ç æ›´ä¸ºé«˜æ•ˆï¼Œå³çœæ—¶é—´å’Œçœç©ºé—´ã€‚ id1:= id2 + id3 * 10 (1) (* id3 10 t1) (2) (+ id2 t1 id1) ç›®æ ‡ä»£ç ç”ŸæˆæŠŠä¸­é—´ä»£ç å˜æ¢æˆç‰¹å®šæœºå™¨ä¸Šçš„ä¸€ä¸ªç»å¯¹æŒ‡ä»¤ä»£ç æˆ–å¯é‡å®šä½çš„æŒ‡ä»¤ä»£ç æˆ–æ±‡ç¼–æŒ‡ä»¤ä»£ç ã€‚ (1) (* id3 10 t1) (2) (+ id2 t1 id1) mov id3,R2 mul 10, R2 mov id2,R1 add R2,R1 mov R1,id1 ä¸Šè¿°ç¼–è¯‘è¿‡ç¨‹çš„é˜¶æ®µåˆ’åˆ†æ˜¯ä¸€ä¸ªå…¸å‹å¤„ç†æ¨¡å¼ï¼Œäº‹å®ä¸Šå¹¶éæ‰€æœ‰çš„ç¼–è¯‘ç¨‹åºéƒ½åˆ†æˆè¿™å‡ ä¸ªé˜¶æ®µï¼Œæœ‰äº›ç¼–è¯‘ç¨‹åºå¹¶ä¸éœ€è¦ç”Ÿæˆä¸­é—´ä»£ç ï¼Œæœ‰äº›ç¼–è¯‘ç¨‹åºä¸è¿›è¡Œä¼˜åŒ–ï¼Œå³ä¼˜åŒ–é˜¶æ®µå¯çœå»ï¼Œæœ‰äº›æœ€ç®€å•çš„ç¼–è¯‘ç¨‹åºåœ¨è¯­æ³•åˆ†æçš„åŒæ—¶äº§ç”Ÿç›®æ ‡æŒ‡ä»¤ä»£ç ï¼Œå¦‚PL/0è¯­è¨€ç¼–è¯‘ç¨‹åºã€‚ä¸è¿‡å¤šæ•°å®ç”¨çš„ç¼–è¯‘ç¨‹åºéƒ½åŒ…å«ä¸Šè¿°å‡ ä¸ªé˜¶æ®µçš„å·¥ä½œè¿‡ç¨‹ã€‚ ç¼–è¯‘ç¨‹åºå…¶ä»–è¦ç‚¹ç¬¦å·è¡¨ è®°å½•æºç¨‹åºä¸­ä½¿ç”¨çš„åå­— æ”¶é›†æ¯ä¸ªåå­—çš„å„ç§å±æ€§ä¿¡æ¯ ç±»å‹ã€ä½œç”¨åŸŸã€åˆ†é…å­˜å‚¨ä¿¡æ¯ å‡ºé”™å¤„ç†æ£€æŸ¥é”™è¯¯ã€æŠ¥å‘Šå‡ºé”™ä¿¡æ¯ã€æ’é”™ã€æ¢å¤ç¼–è¯‘å·¥ä½œã€‚ ç¼–è¯‘é˜¶æ®µçš„åˆ’åˆ†å‰ç«¯å’Œåç«¯ ç¼–è¯‘çš„å‰ç«¯ï¼šä¸æºè¯­è¨€æœ‰å…³ä½†ä¸ç›®æ ‡æœºæ— å…³çš„é‚£äº›éƒ¨åˆ†ç»„æˆ ç¼–è¯‘çš„åç«¯ï¼šä¸ç›®æ ‡æœºæœ‰å…³çš„é‚£äº›éƒ¨åˆ†ç»„æˆ ä¸€ä¸ªå‰ç«¯+å¤šä¸ªåç«¯ï¼šå¤šå¹³å°ç¼–è¯‘å™¨ ä¾‹ Java å¤šä¸ªå‰ç«¯+ä¸€ä¸ªåç«¯ï¼šå¤šè¯­è¨€ç¼–è¯‘å™¨ ä¾‹ .NET éï¼ˆè¶Ÿï¼‰ï¼šä»å¤´åˆ°å°¾æ‰«ææºç¨‹åºä¸€æ¬¡ç§°ä¸ºä¸€é è§£é‡Šè¿‡ç¨‹ï¼ˆè§£é‡Šç¨‹åºï¼‰ è¿™é‡Œä»‹ç»å¦ä¸€ç§è¯­è¨€å¤„ç†ç¨‹åºï¼Œå®ƒä¸éœ€è¦åœ¨è¿è¡Œå‰å…ˆæŠŠæºç¨‹åºç¿»è¯‘æˆç›®æ ‡ä»£ç ï¼Œä¹Ÿå¯ä»¥å®ç°åœ¨æŸå°æœºå™¨ä¸Šè¿è¡Œç¨‹åºå¹¶ç”Ÿæˆç»“æœã€‚ è§£é‡Šç¨‹åºæ¥å—æŸä¸ªè¯­è¨€çš„ç¨‹åºå¹¶ç«‹å³è¿è¡Œè¿™ä¸ªæºç¨‹åºã€‚å®ƒçš„å·¥ä½œæ¨¡å¼æ˜¯ä¸€ä¸ªä¸ªçš„è·å–ã€åˆ†æå¹¶æ‰§è¡Œæºç¨‹åºè¯­å¥ï¼Œä¸€æ—¦ç¬¬ä¸€ä¸ªè¯­å¥åˆ†æç»“æŸï¼Œæºç¨‹åºä¾¿å¼€å§‹è¿è¡Œå¹¶ç”Ÿæˆç»“æœï¼Œå®ƒç‰¹åˆ«é€‚åˆç¨‹åºå‘˜ä»¥äº¤äº’å·¥ä½œæ–¹å¼å·¥ä½œçš„æƒ…å†µï¼Œå³å¸Œæœ›åœ¨è·å–ä¸‹ä¸€ä¸ªè¯­å¥ä¹‹å‰äº†è§£æ¯ä¸ªè¯­å¥çš„æ‰§è¡Œç»“æœï¼Œå…è®¸æ‰§è¡Œæ—¶ä¿®æ”¹ç¨‹åºã€‚ è‘—åçš„è§£é‡Šç¨‹åºæœ‰Basicè¯­è¨€è§£é‡Šç¨‹åº ,Lispè¯­è¨€è§£é‡Šç¨‹åº,UNIXå‘½ä»¤è¯­è¨€è§£é‡Šç¨‹åº(shell),æ•°æ®åº“æŸ¥è¯¢è¯­è¨€SQL è§£é‡Šç¨‹åºä»¥åŠbytecodeè§£é‡Šç¨‹åºã€‚ ç¼–è¯‘ç¨‹åºå’Œè§£é‡Šç¨‹åºçš„å¯¹æ¯”æ¦‚å¿µ ç¼–è¯‘ï¼šæ•´ä¸ªç¨‹åºå…¨éƒ¨ç¿»è¯‘ç»“æŸä¹‹åï¼Œç¨‹åºæ‰èƒ½å¼€å§‹è¿è¡Œï¼›ç¼–è¯‘å’Œè¿è¡Œæ˜¯ä¸¤ä¸ªç‹¬ç«‹åˆ†å¼€çš„é˜¶æ®µã€‚ è§£é‡Šï¼šä¸éœ€è¦å°†åˆ†æå’Œæ‰§è¡Œé˜¶æ®µåˆ†å¼€ï¼Œä¸€è¾¹åˆ†æä¸€è¾¹æ‰§è¡Œï¼›æ›´åŠ é€‚ç”¨äºäº¤äº’ç¯å¢ƒä¸­ã€‚ ç¼–è¯‘å’Œè§£é‡Šçš„æ¯”è¾ƒ ç¼–è¯‘ç»“æœçš„æ‰§è¡Œæ•ˆç‡æ¯”è§£é‡Šå¿«å¾ˆå¤š è§£é‡Šæ‰§è¡Œçš„ç©ºé—´å¼€é”€å¤§å¤§è¶…è¿‡ç¼–è¯‘ç»“æœçš„æ‰§è¡Œ Java C# å’Œ ä¼ ç»Ÿè¯­è¨€ C Pascal Javaè¯­è¨€çš„å¤„ç†ç¯å¢ƒæ—¢æœ‰ç¼–è¯‘ç¨‹åºï¼Œä¹Ÿæœ‰è§£é‡Šç¨‹åº javaæºç¨‹åºç»è¿‡JAVAç¼–è¯‘ç¨‹åºç¼–è¯‘åç”Ÿæˆclasså¯æ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼ˆBYTECODEï¼‰ å¯æ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼ˆBYTECODEï¼‰åœ¨javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸Šç»è¿‡è§£é‡Šç¨‹åºä¸€è¡Œè¡Œè§£é‡Šæ‰§è¡Œ å¯ä»¥è¯´JAVAç¼–è¯‘ç¨‹åºå…¼å…·ç¼–è¯‘å‹è¯­è¨€å’Œè§£é‡Šå‹è¯­è¨€çš„ç‰¹ç‚¹ ä¼ ç»Ÿè¯­è¨€éƒ½æ˜¯ä¸€æ¬¡ç¼–è¯‘ï¼Œæ²¡æœ‰ç”Ÿæˆä¸­é—´ä»£ç  æ–‡æ³•çš„æ¦‚å¿µæ–‡æ³•å³æ˜¯ä»¥æœ‰ç©·çš„é›†åˆåˆ»ç”»æ— ç©·çš„é›†åˆçš„ä¸€ä¸ªå·¥å…·ã€‚ æ–‡æ³•ç±»å‹ä¸å½¢å¼ï¼ˆ0â€”3ï¼‰ 0å‹æ–‡æ³•â†’çŸ­è¯­æ–‡æ³• 1å‹æ–‡æ³•â†’ä¸Šä¸‹æ–‡æœ‰å…³ 2å‹æ–‡æ³•â†’ä¸Šä¸‹æ–‡æ— å…³ 3å‹æ–‡æ³•â†’æ­£è§„æ–‡æ³• ç¼–ç¨‹è¯­è¨€ä½¿ç”¨å“ªäº›æ–‡æ³• è¯­æ³•ä¸Šä½¿ç”¨çš„æ˜¯ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼ˆ2å‹ï¼‰ æ ‡è¯†ç¬¦ã€æ•°å­—ç­‰ä½¿ç”¨çš„éƒ½æ˜¯æ­£è§„æ–‡æ³•ï¼ˆ3å‹ï¼‰ å¥å‹ã€å¥å­æˆ‘ä¸çŸ¥é“(ãƒï½€Ğ”)ãƒ æœ‰å®³è§„åˆ™å’Œå¤šä½™è§„åˆ™ æ–‡æ³•ä¸­ä¸å«æœ‰æœ‰å®³è§„åˆ™å’Œå¤šä½™è§„åˆ™ æœ‰å®³è§„åˆ™å½¢å¦‚Uâ†’Uçš„äº§ç”Ÿå¼ã€‚ä¼šå¼•èµ·æ–‡æ³•çš„äºŒä¹‰æ€§ å¤šä½™è§„åˆ™æŒ‡æ–‡æ³•ä¸­ä»»ä½•å¥å­çš„æ¨å¯¼éƒ½ä¸ä¼šç”¨åˆ°çš„è§„åˆ™ æ–‡æ³•ä¸­æŸäº›éç»ˆç»“ç¬¦ï¼ˆé™¤äº†å¼€å§‹ç¬¦ï¼‰ä¸åœ¨ä»»ä½•è§„åˆ™çš„å³éƒ¨å‡ºç°ï¼Œè¯¥éç»ˆç»“ç¬¦ç§°ä¸ºä¸å¯åˆ°è¾¾ã€‚ æ–‡æ³•ä¸­æŸäº›éç»ˆç»“ç¬¦ï¼Œç”±å®ƒä¸èƒ½æ¨å‡ºç»ˆç»“ç¬¦å·ä¸²ï¼Œè¯¥éç»ˆç»“ç¬¦ç§°ä¸ºä¸å¯ç»ˆæ­¢ã€‚ ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•åŠå…¶è¯­æ³•æ ‘ æœ€å·¦ï¼ˆæœ€å³ï¼‰æ¨å¯¼ï¼šåœ¨æ¨å¯¼çš„ä»»ä½•ä¸€æ­¥Î±=&gt;Î²ï¼Œå…¶ä¸­Î±ã€Î²æ˜¯å¥å‹ï¼Œéƒ½æ˜¯å¯¹Î±ä¸­çš„æœ€å·¦ï¼ˆå³ï¼‰éç»ˆç»“ç¬¦è¿›è¡Œæ›¿æ¢,åˆ™ç§°è¿™ç§æ¨å¯¼ä¸ºæœ€å·¦ï¼ˆå³ï¼‰æ¨å¯¼ã€‚ æœ€å³æ¨å¯¼è¢«ç§°ä¸ºè§„èŒƒæ¨å¯¼ï¼Œç”±è§„èŒƒæ¨å¯¼æ‰€å¾—çš„å¥å‹ç§°ä¸ºè§„èŒƒå¥å‹ çŸ­è¯­ï¼šå­æ ‘çš„æ‰€æœ‰å¶å­èŠ‚ç‚¹é›†åˆä¸ºä¸€ä¸ªçŸ­è¯­ï¼Œæ‹¥æœ‰å¤šä¸ªå­æ ‘å°±æœ‰å¤šä¸ªçŸ­è¯­ï¼ˆä¸€ä¸ªå¥å‹çš„è¯­æ³•æ ‘ä¸­ä»»ä¸€å­æ ‘å¶ç»“ç‚¹æ‰€ç»„æˆçš„ç¬¦å·ä¸²éƒ½æ˜¯è¯¥å¥å‹çš„çŸ­è¯­ï¼‰ ç›´æ¥çŸ­è¯­ï¼šå­æ ‘ä¸­ä¸å†åŒ…å«å…¶ä»–çš„å­æ ‘ï¼Œå³Aåªèƒ½æ¨å¯¼å‡ºbï¼Œè€Œbä¸èƒ½å†æ¨å‡ºå…¶ä»–çš„å¼å­ï¼Œåˆ™bä¸ºæ­¤å¥å‹çš„ç›´æ¥çŸ­è¯­ å¥æŸ„ï¼šæœ€å·¦ç›´æ¥çŸ­è¯­ æ–‡æ³•çš„äºŒä¹‰æ€§ä¸è¯­è¨€çš„äºŒä¹‰æ€§å…³ç³» å¦‚æœä¸€ä¸ªæ–‡æ³•å­˜åœ¨æŸä¸ªå¥å­å¯¹åº”ä¸¤é¢—ä¸åŒçš„è¯­æ³•æ ‘ï¼Œåˆ™è¯´è¿™ä¸ªæ–‡æ³•æ˜¯äºŒä¹‰çš„ã€‚ äºŒä¹‰æ€§æ–‡æ³•å¯èƒ½äº§ç”ŸåŒä¸€ä¸ªè¯­è¨€ã€‚ å¦‚æœäº§ç”Ÿä¸Šä¸‹æ–‡æ— å…³è¯­è¨€çš„æ¯ä¸€ä¸ªæ–‡æ³•éƒ½æ˜¯äºŒä¹‰çš„ï¼Œåˆ™è¯´æ­¤è¯­è¨€æ˜¯å…ˆå¤©äºŒä¹‰çš„ã€‚ ä¼˜å…ˆå…³ç³»æ¦‚å¿µ ç®—ç¬¦æ–‡æ³•æ¦‚å¿µ å­ç¨‹åºå‚æ•°ç±»å‹ æœºå™¨æŒ‡ä»¤ åŠ¨æ€å †å¼åˆ†é…","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"},{"name":"os","slug":"os","permalink":"https://tinychen.com/tags/os/"}]},{"title":"æ“ä½œç³»ç»Ÿéƒ¨åˆ†é‡ç‚¹å†…å®¹","slug":"20190109-operating-system","date":"2019-01-09T07:00:00.000Z","updated":"2019-01-09T07:00:00.000Z","comments":true,"path":"20190109-operating-system/","link":"","permalink":"https://tinychen.com/20190109-operating-system/","excerpt":"ã€Šæ“ä½œç³»ç»Ÿã€‹éƒ¨åˆ†é‡ç‚¹å†…å®¹ï¼ŒåŒ…æ‹¬è®¨è®ºé¢˜å’Œéƒ¨åˆ†å°ä¸ƒè‡ªå·±æ•´ç†çš„æ¦‚å¿µ. é‡è¦çŸ¥è¯†ç‚¹ã€‚","text":"ã€Šæ“ä½œç³»ç»Ÿã€‹éƒ¨åˆ†é‡ç‚¹å†…å®¹ï¼ŒåŒ…æ‹¬è®¨è®ºé¢˜å’Œéƒ¨åˆ†å°ä¸ƒè‡ªå·±æ•´ç†çš„æ¦‚å¿µ. é‡è¦çŸ¥è¯†ç‚¹ã€‚ ç¬¬ä¸€ç«  1. è¯·ä½ ç»™æ“ä½œç³»ç»Ÿä¸‹ä¸ªå®šä¹‰ï¼Ÿä¸€èˆ¬å¯æŠŠæ“ä½œç³»ç»Ÿå®šä¹‰ä¸ºï¼šç®¡ç†ç³»ç»Ÿèµ„æº. æ§åˆ¶ç¨‹åºæ‰§è¡Œ. æ”¹å–„äººæœºç•Œé¢. æä¾›å„ç§æœåŠ¡ï¼Œå¹¶åˆç†ç»„ç»‡è®¡ç®—æœºå·¥ä½œæµç¨‹å’Œä¸ºç”¨æˆ·æ–¹ä¾¿æœ‰æ•ˆåœ°ä½¿ç”¨è®¡ç®—æœºæä¾›è‰¯å¥½è¿è¡Œç¯å¢ƒçš„ä¸€ç§ç³»ç»Ÿè½¯ä»¶ã€‚ 2. è¯·å™è¿°æ“ä½œç³»ç»Ÿçš„ä¸“ä¸šåœ°ä½å’Œåœ¨è®¡ç®—æœºç³»ç»Ÿä¸­çš„åœ°ä½ï¼Ÿæ“ä½œç³»ç»Ÿå±äºä¸“ä¸šåŸºç¡€è¯¾ ç³»ç»Ÿè½¯ä»¶ï¼ˆæ“ä½œç³»ç»Ÿï¼‰å±‚æ˜¯æœ€é è¿‘ç¡¬ä»¶çš„ä¸€å±‚è½¯ä»¶ï¼Œå®ƒä¸€æ–¹é¢ç›´æ¥å’Œç¡¬ä»¶äº¤äº’ï¼Œåœ¨è£¸æœºä¸Šè¿è¡Œï¼›å¦ä¸€æ–¹é¢å’Œä¸Šå±‚çš„æ”¯æ’‘è½¯ä»¶å’Œåº”ç”¨è½¯ä»¶äº¤äº’ï¼ŒæŠŠå®ƒä»¬ä¸è®¡ç®—æœºç¡¬ä»¶éš”ç¦»å¼€æ¥ã€‚ æ“ä½œç³»ç»Ÿæ˜¯æœ€é è¿‘ç¡¬ä»¶çš„ä¸€å±‚è½¯ä»¶ï¼Œå®ƒæŠŠç¡¬ä»¶è£¸æœºæ”¹é€ æˆä¸ºå®Œå–„çš„è™šæ‹Ÿæœºï¼Œä½¿å¾—æœºå™¨åŠŸèƒ½å¾—åˆ°æ‰©å±•ï¼Œè¿è¡Œç¯å¢ƒå¾—åˆ°æ”¹å–„ï¼Œç³»ç»Ÿæ•ˆç‡å¾—åˆ°æé«˜ï¼Œå®‰å…¨æ€§èƒ½å¾—åˆ°ä¿éšœã€‚ ç³»ç»Ÿè½¯ä»¶ï¼ˆæ“ä½œç³»ç»Ÿï¼‰å±‚æ˜¯æœ€é è¿‘ç¡¬ä»¶çš„ä¸€å±‚è½¯ä»¶ï¼Œå®ƒä¸€æ–¹é¢ç›´æ¥å’Œç¡¬ä»¶äº¤äº’ï¼Œåœ¨è£¸æœºä¸Šè¿è¡Œï¼ŒæŠŠç¡¬ä»¶çš„å¤æ‚æ€§å°è£…èµ·æ¥ï¼Œè´Ÿè´£ç®¡ç†å’Œæ§åˆ¶æœºå™¨ç¡¬ä»¶å¹¶å¯¹å…¶åšé¦–æ¬¡æ‰©å……å’Œæ”¹é€ ï¼Œä¸»è¦åšå¥½èµ„æºçš„è°ƒåº¦ä¸åˆ†é…. ä¿¡æ¯çš„å­˜å–ä¸ä¿æŠ¤. å¹¶å‘æ´»åŠ¨çš„åè°ƒä¸æ§åˆ¶ç­‰å·¥ä½œï¼›å¦ä¸€æ–¹é¢å’Œä¸Šå±‚çš„æ”¯æ’‘è½¯ä»¶å’Œåº”ç”¨è½¯ä»¶äº¤äº’ï¼ŒæŠŠå®ƒä»¬ä¸è®¡ç®—æœºç¡¬ä»¶éš”ç¦»å¼€æ¥ï¼Œä¸ºç¨‹åºå‘˜æä¾›æ–¹ä¾¿çš„ç¼–ç¨‹æ¥å£. æœ‰åŠ›çš„åŠŸèƒ½æ”¯æ’‘. è‰¯å¥½çš„è¿è¡Œç¯å¢ƒï¼Œä½¿å¾—è®¡ç®—æœºç³»ç»Ÿæˆä¸ºå®Œæ•´. å¯ç”¨å’Œé«˜æ•ˆçš„è®¡ç®—å¹³å°ã€‚ 3. æ“ä½œç³»ç»Ÿç³»ç»Ÿçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿæ“ä½œç³»ç»Ÿåœ¨è®¡ç®—æœºç³»ç»Ÿä¸­èµ·4ä¸ªæ–¹é¢çš„ä½œç”¨ã€‚ æœåŠ¡ç”¨æˆ·è§‚ç‚¹â€”â€”æ“ä½œç³»ç»Ÿä½œä¸ºç”¨æˆ·æ¥å£å’Œå…¬å…±æœåŠ¡ç¨‹åº è¿›ç¨‹äº¤äº’è§‚ç‚¹â€”â€”æ“ä½œç³»ç»Ÿä½œä¸ºè¿›ç¨‹æ‰§è¡Œçš„æ§åˆ¶è€…å’Œåè°ƒè€… ç³»ç»Ÿå®ç°è§‚ç‚¹â€”â€”æ“ä½œç³»ç»Ÿä½œä¸ºæ‰©å±•æœºæˆ–è™šæ‹Ÿæœº èµ„æºç®¡ç†è§‚ç‚¹â€”â€”æ“ä½œç³»ç»Ÿä½œä¸ºèµ„æºçš„ç®¡ç†è€…å’Œæ§åˆ¶è€… 4. æ“ä½œç³»ç»Ÿæ‰€ç®¡ç†çš„èµ„æºæœ‰é‚£äº›ï¼Ÿæ”¯æŒçš„ç•Œé¢ä½¿ç”¨æ–¹å¼æœ‰å“ªäº›ï¼Ÿåœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œèƒ½åˆ†é…ç»™ç”¨æˆ·ä½¿ç”¨çš„å„ç§è½¯ç¡¬ä»¶è®¾æ–½æ€»ç§°ä¸ºèµ„æºã€‚ èµ„æºåŒ…æ‹¬ä¸¤å¤§ç±»ï¼šç¡¬ä»¶èµ„æºå’Œè½¯ä»¶èµ„æºã€‚å…¶ä¸­ï¼Œç¡¬ä»¶èµ„æºæœ‰å¤„ç†å™¨. å­˜å‚¨å™¨. å¤–éƒ¨è®¾å¤‡ç­‰ï¼›è½¯ä»¶èµ„æºåˆ™åˆ†ä¸ºç¨‹åºå’Œæ•°æ®ã€‚ æ”¯æŒçš„ç•Œé¢ä½¿ç”¨æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šå‘½ä»¤è¡Œæ¨¡å¼ï¼ˆCLIï¼‰å’Œå›¾å½¢åŒ–ç•Œé¢ï¼ˆGUIï¼‰ 5. ä»€ä¹ˆåŸå› æ¨åŠ¨æˆ‘ä»¬æ“ä½œç³»ç»Ÿçš„å‘å±•ï¼Ÿä¸¤ä¸ªåŸå› ï¼šäººç±»æ—¥å¸¸ç”Ÿäº§ç”Ÿæ´»çš„å®é™…éœ€æ±‚å’Œç¡¬ä»¶è®¾å¤‡ï¼ˆå°¤å…¶æ˜¯é›†æˆç”µè·¯ï¼‰çš„å‘å±•ã€‚ 6. ä½•ä¸ºä¸­æ–­ï¼Ÿä¸­æ–­å¤„ç†è¿‡ç¨‹å¦‚ä½•ï¼Ÿä¸­æ–­åˆ†ç±»ï¼Ÿä¸­æ–­æœåŠ¡ï¼Ÿä¸­æ–­æºï¼Ÿä¸­æ–­ä¼˜å…ˆçº§ï¼Ÿä¸­æ–­å±è”½ä¸å¼€å…³ä¸­æ–­ï¼Ÿä¸­æ–­è¦ä¿å­˜å’Œæ¢å¤çš„å†…å®¹æœ‰å“ªäº›ï¼Ÿä¸­æ–­çš„å®šä¹‰ä¸­æ–­æŒ‡åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°æ€¥éœ€å¤„ç†çš„äº‹ä»¶æ—¶ï¼Œæš‚æ—¶ä¸­æ­¢ç°è¡Œç¨‹åºåœ¨CPUä¸Šçš„è¿è¡Œï¼Œè½¬è€Œæ‰§è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¾…å¤„ç†å®Œæˆåå†è¿”å›æ–­ç‚¹æˆ–è°ƒåº¦å…¶ä»–ç¨‹åºæ‰§è¡Œçš„è¿‡ç¨‹ã€‚ ä¸­æ–­å¤„ç†è¿‡ç¨‹å¦‚ä½•ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œä¸­æ–­/å¼‚å¸¸çš„å“åº”éœ€è¦é¡ºåºåš4ä»¶äº‹ï¼š å‘ç°ä¸­æ–­æº ä¿æŠ¤ç°åœº è½¬å‘ä¸­æ–­/å¼‚å¸¸äº‹ä»¶å¤„ç†ç¨‹åºæ‰§è¡Œ æ¢å¤ç°åœº ä¸­æ–­åˆ†ç±»ï¼Ÿç”±ç¡¬ä»¶å‘å‡ºæˆ–äº§ç”Ÿçš„ä¸­æ–­ç§°ä¸ºç¡¬ä¸­æ–­ï¼ŒæŒ‰ç¡¬ä¸­æ–­äº‹ä»¶çš„æ¥æºå’Œå®ç°æ‰‹æ®µå¯å°†ä¸­æ–­åˆ’åˆ†ä¸ºå¤–ä¸­æ–­å’Œå†…ä¸­æ–­ã€‚ å¤–ä¸­æ–­åˆç§°ä¸­æ–­æˆ–å¼‚æ­¥ä¸­æ–­ï¼Œæ˜¯æŒ‡æ¥è‡ªå¤„ç†å™¨ä¹‹å¤–çš„ä¸­æ–­ä¿¡å·ï¼› å†…ä¸­æ–­åˆç§°å¼‚å¸¸æˆ–åŒæ­¥ä¸­æ–­ï¼Œæ˜¯æŒ‡æ¥è‡ªå¤„ç†å™¨å†…éƒ¨çš„ä¸­æ–­ä¿¡å·ï¼› ä¸­æ–­çš„å‘ç”Ÿä¸CPUå½“å‰çŠ¶æ€æ— å…³ï¼Œå³å¯å‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼Œåˆå¯å‘ç”Ÿåœ¨å†…æ ¸æ€ï¼›å¼‚å¸¸ä¸CPUæ˜¯åŒæ­¥çš„ï¼Œå¤§éƒ¨åˆ†å¼‚å¸¸å‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼Œå†…æ ¸æ€å”¯ä¸€å‘ç”Ÿçš„å¼‚å¸¸æ˜¯â€œç¼ºé¡µå¼‚å¸¸â€ ä¸­æ–­æœåŠ¡ï¼Ÿ æ‘˜è‡ªç™¾åº¦ç™¾ç§‘ï¼šä¸­æ–­æœåŠ¡ç¨‹åºï¼Œå¤„ç†å™¨å¤„ç†â€œæ€¥ä»¶â€ï¼Œå¯ç†è§£ä¸ºæ˜¯ä¸€ç§æœåŠ¡ï¼Œæ˜¯é€šè¿‡æ‰§è¡Œäº‹å…ˆç¼–å¥½çš„æŸä¸ªç‰¹å®šçš„ç¨‹åºæ¥å®Œæˆçš„ï¼Œè¿™ç§å¤„ç†â€œæ€¥ä»¶â€çš„ç¨‹åºè¢«ç§°ä¸ºâ€”â€”ä¸­æ–­æœåŠ¡ç¨‹åºã€‚ ä¸­æ–­æºï¼Ÿä¸­æ–­æºæŒ‡ä¸­æ–­ä¿¡å·çš„æ¥æºã€‚ ä¸­æ–­ä¼˜å…ˆçº§ä¸­æ–­è£…ç½®æ‰€é¢„è®¾çš„å“åº”é¡ºåºç§°ä¸ºä¸­æ–­ä¼˜å…ˆçº§ã€‚ ä¸­æ–­å±è”½ä¸å¼€å…³ä¸­æ–­ï¼Ÿä¸­æ–­å±è”½æ˜¯æŒ‡ç¦æ­¢CPUå“åº”ä¸­æ–­æˆ–ç¦æ­¢ä¸­æ–­äº§ç”Ÿã€‚ å‰è€…æŒ‡ç¡¬ä»¶äº§ç”Ÿä¸­æ–­è¯·æ±‚åï¼ŒCPUæš‚æ—¶ä¸äºˆå“åº”çš„çŠ¶æ€ï¼Œç­‰å¾…ç›´åˆ°ä¸­æ–­å¼€æ”¾åè¢«å±è”½çš„ä¸­æ–­æ‰èƒ½è¢«å“åº”å¹¶è·å¾—å¤„ç†ã€‚ åè€…æŒ‡å¯å¼•èµ·ä¸­æ–­çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œç¡¬ä»¶ä¸å…è®¸æå‡ºä¸­æ–­è¯·æ±‚ä¹Ÿä¸é€šçŸ¥å¤„ç†å™¨ï¼Œæ•…ç”±äºä¸­æ–­è¢«ç¦æ­¢è€Œä¸å¯èƒ½å¯¼è‡´ä¸­æ–­ã€‚ ä¸­æ–­è¦ä¿å­˜å’Œæ¢å¤çš„å†…å®¹æœ‰å“ªäº›ï¼Ÿé€šç”¨å¯„å­˜å™¨. çŠ¶æ€å¯„å­˜å™¨. ç¨‹åºè®¡æ•°å™¨(PC). ç¨‹åºçŠ¶æ€å­—(PSW) 7. ç³»ç»Ÿè°ƒç”¨ï¼Ÿç³»ç»Ÿè°ƒç”¨æ˜¯ä¸€ç§ä¸­ä»‹è§’è‰²ï¼ŒæŠŠç”¨æˆ·å’Œç¡¬ä»¶éš”ç¦»å¼€æ¥ï¼Œåº”ç”¨ç¨‹åºåªæœ‰é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‰èƒ½è¯·æ±‚ç³»ç»ŸæœåŠ¡å¹¶ä½¿ç”¨ç³»ç»Ÿèµ„æºã€‚ ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨ï¼šä¸€æ˜¯å†…æ ¸å¯ä»¥åŸºäºæƒé™å’Œè§„åˆ™å¯¹èµ„æºè®¿é—®è¿›è¡Œè£å†³ï¼Œä¿è¯ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼›äºŒæ˜¯ç³»ç»Ÿè°ƒç”¨å¯¹èµ„æºè¿›è¡ŒæŠ½è±¡ï¼Œæä¾›ä¸€è‡´æ€§æ¥å£ï¼Œé¿å…ç”¨æˆ·åœ¨ä½¿ç”¨èµ„æºæ—¶å‘ç”Ÿé”™è¯¯ï¼Œä¸”ä½¿ç¼–ç¨‹æ•ˆç‡å¤§å¤§æé«˜ã€‚ å¯ä»¥è¿™æ ·è®¤ä¸ºï¼šå†…æ ¸çš„ä¸»ä½“æ˜¯ç³»ç»Ÿè°ƒç”¨çš„é›†åˆï¼Œå¯ä»¥å°†å†…æ ¸çš„æœåŠ¡ä¾‹ç¨‹çœ‹æˆç‰¹æ®Šçš„å…¬å…±å­ç¨‹åºã€‚ ç³»ç»Ÿè°ƒç”¨æ˜¯åº”ç”¨ç¨‹åºè·å¾—æ“ä½œç³»ç»ŸæœåŠ¡çš„å”¯ä¸€é€”å¾„ã€‚ 8. å¸‚åœºä¸Šosçš„åˆ†ç±»ï¼Ÿå¸‚åœºä¸ŠOSçš„åˆ†ç±»ä¾æ®åˆ†ç±»æ ‡å‡†çš„ä¸åŒå¯ä»¥æœ‰è®¸å¤šç§åˆ†æ³•ï¼š æŒ‰ç…§ä½¿ç”¨è®¾å¤‡æ¥è¿›è¡Œåˆ†ç±»çš„è¯ï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š ç§»åŠ¨ç«¯ï¼šä¸»è¦æ˜¯Androidå’ŒIOSå ä¸»æµï¼Œä¹Ÿæœ‰å°‘æ•°çš„å¦‚WindowsMobileç­‰å°ä¼—ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼› æ¡Œé¢ç«¯ï¼šä¸»è¦æ˜¯Windows. MacOSå’Œä¸»æµçš„Linuxå‘è¡Œç‰ˆå¦‚Redhat. Ubuntu. CentOS. SUSEç­‰ï¼Œè¿˜æœ‰å°‘æ•°çš„Unixæ“ä½œç³»ç»Ÿï¼› æœåŠ¡å™¨ç«¯ï¼šä¸»è¦è¿è¡Œçš„æ˜¯Linuxå’ŒUnixæ“ä½œç³»ç»Ÿ å…¶ä»–è¿˜æœ‰æ›´ç»†è‡´çš„åˆ†ç±»è¯¸å¦‚åµŒå…¥å¼ç³»ç»Ÿç­‰ã€‚ æŒ‰ç…§åŠŸèƒ½. ç‰¹ç‚¹å’Œä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥æŠŠæ“ä½œç³»ç»Ÿåˆ†ä¸ºä¸‰ç§åŸºæœ¬ç±»å‹æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿ æ‰¹å¤„ç†æ“ä½œç³»ç»ŸæœåŠ¡äºä¸€ç³»åˆ—ç§°ä¸ºæ‰¹ï¼ˆbatchï¼‰çš„ä½œä¸šã€‚ é‡‡ç”¨æ‰¹å¤„ç†æ–¹å¼å·¥ä½œçš„æ“ä½œç³»ç»Ÿç§°ä¸ºæ‰¹å¤„ç†æ“ä½œç³»ç»Ÿã€‚ æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿæ˜¯æœ€å…ˆé‡‡ç”¨å¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯çš„ç³»ç»Ÿï¼Œå®ƒæ ¹æ®é¢„å…ˆè®¾å®šçš„è°ƒåº¦ç­–ç•¥é€‰æ‹©è‹¥å¹²ä½œä¸šå¹¶å‘åœ°æ‰§è¡Œï¼Œç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œä½œä¸šååé‡å¤§ã€‚ æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿçš„ç¼ºç‚¹æ˜¯ä½œä¸šå‘¨è½¬æ—¶é—´å»¶é•¿ï¼Œä¸å…·å¤‡äº¤äº’å¼è®¡ç®—èƒ½åŠ›ï¼Œä¸åˆ©äºç¨‹åºçš„å¼€å‘å’Œè°ƒè¯•ã€‚ æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿçš„ç‰¹å¾æ˜¯æ‰¹é‡é›†ä¸­å¤„ç†. å¤šé“ç¨‹åºè¿è¡Œ. ä½œä¸šè„±æœºå·¥ä½œã€‚ åˆ†æ—¶æ“ä½œç³»ç»Ÿ å®è´¨ä¸Šï¼Œåˆ†æ—¶æ“ä½œç³»ç»Ÿæ˜¯å¤šé“ç¨‹åºçš„ä¸€ä¸ªå˜ç§ï¼ŒCPUè¢«è‹¥å¹²äº¤äº’å¼ç”¨æˆ·å¤šè·¯å¤ç”¨ï¼Œä¸åŒä¹‹å¤„åœ¨äºæ¯ä¸ªç”¨æˆ·éƒ½æ‹¥æœ‰ä¸€å°è”æœºç»ˆç«¯ã€‚ åˆ†æ—¶æ“ä½œç³»ç»Ÿçš„å››å¤§ç‰¹ç‚¹ä¸ºï¼šåŒæ—¶æ€§. ç‹¬ç«‹æ€§. åŠæ—¶æ€§. äº¤äº’æ€§ã€‚ åŒæ—¶æ€§ï¼šå³è‹¥å¹²ç»ˆç«¯ç”¨æˆ·è”æœºä½¿ç”¨è®¡ç®—æœºï¼Œåˆ†æ—¶æ˜¯æŒ‡å¤šä¸ªç”¨æˆ·åˆ†äº«åŒä¸€å°è®¡ç®—æœºçš„CPUæ—¶é—´ï¼› ç‹¬ç«‹æ€§ï¼šå³ç»ˆç«¯ç”¨æˆ·å½¼æ­¤ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ï¼Œæ¯ä¸ªç»ˆç«¯ç”¨æˆ·æ„Ÿè§‰å¥½åƒç‹¬å æ•´å°è®¡ç®—æœºï¼› åŠæ—¶æ€§ï¼šå³ç»ˆç«¯ç”¨æˆ·æ²¡æœ‰å¤§è®¡ç®—é‡çš„ç«‹å³å‹è¯·æ±‚èƒ½å¤Ÿåœ¨è¶³å¤ŸçŸ­æ—¶é—´å†…å¾—åˆ°å“åº”ï¼› äº¤äº’æ€§ï¼šå³äººæœºäº¤äº’ï¼Œè”æœºå·¥ä½œæ—¶ç”¨æˆ·ç›´æ¥æ§åˆ¶ç¨‹åºè¿è¡Œï¼Œä¾¿äºç¨‹åºè°ƒè¯•å’Œæ’é”™ã€‚ å®æ—¶æ“ä½œç³»ç»Ÿ å®æ—¶æ“ä½œç³»ç»Ÿæ—¶æŒ‡å¤–éƒ¨äº‹ä»¶æˆ–æ•°æ®äº§ç”Ÿæ—¶ï¼Œèƒ½å¤Ÿå¯¹å…¶äºˆä»¥è¶³å¤Ÿå¿«çš„é€Ÿåº¦è¿›è¡Œå¤„ç†ï¼Œæ‰€å¾—ç»“æœèƒ½å¤Ÿåœ¨è§„å®šçš„æ—¶é—´å†…æ§åˆ¶ç”Ÿäº§è¿‡ç¨‹æˆ–å¯¹æ§åˆ¶å¯¹è±¡åšå‡ºå¿«é€Ÿå“åº”ï¼Œå¹¶æ§åˆ¶æ‰€æœ‰å®æ—¶ä»»åŠ¡åè°ƒè¿è¡Œçš„æ“ä½œç³»ç»Ÿã€‚ æä¾›åŠæ—¶å“åº”å’Œé«˜å¯é æ€§æ˜¯å…¶ä¸»è¦ç‰¹ç‚¹ã€‚ æœ‰ä¸‰ç§å…¸å‹å®æ—¶ç³»ç»Ÿï¼šè¿‡ç¨‹æ§åˆ¶ç³»ç»Ÿ. ä¿¡æ¯æŸ¥è¯¢ç³»ç»Ÿå’Œäº‹åŠ¡å¤„ç†ç³»ç»Ÿã€‚ å¦‚æœæŸä¸ªæ“ä½œç³»ç»Ÿå…¼å…·æ‰¹å¤„ç†. åˆ†æ—¶å’Œå®æ—¶å¤„ç†çš„å…¨éƒ¨æˆ–ä¸¤ç§åŠŸèƒ½ï¼Œåˆ™æ­¤æ“ä½œç³»ç»Ÿç§°ä¸ºé€šç”¨æ“ä½œç³»ç»Ÿã€‚ 9. å•é“ç¨‹åºè®¾è®¡å’Œå¤šé“çš„åŒºåˆ«ï¼Ÿåœ¨æ—©æœŸå•é“æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œå†…å­˜ä¸­ä»…æœ‰å•ä¸ªä½œä¸šåœ¨è¿è¡Œï¼ŒCPUå’Œå…¶ä»–ç¡¬ä»¶è®¾å¤‡ä¸²è¡Œå·¥ä½œï¼Œè‡´ä½¿ç³»ç»Ÿä¸­ä»æœ‰è®¸å¤šèµ„æºç©ºé—²ï¼Œè®¾å¤‡åˆ©ç”¨ç‡æä½ã€‚ å¤šé“ç¨‹åºè®¾è®¡æ˜¯æŒ‡å…è®¸å¤šä¸ªä½œä¸šï¼ˆç¨‹åºï¼‰åŒæ—¶è¿›å…¥è®¡ç®—æœºç³»ç»Ÿçš„å†…å­˜å¹¶å¯åŠ¨äº¤æ›¿è®¡ç®—çš„æ–¹æ³•ã€‚ 10. ç³»ç»Ÿè°ƒç”¨ä¸å‡½æ•°è°ƒç”¨ä¹‹é—´çš„åŒºåˆ«ï¼Ÿä¸¤è€…ä»è°ƒç”¨å½¢å¼åˆ°å…·ä½“å®ç°éƒ½å­˜åœ¨å¾ˆå¤§åŒºåˆ«ï¼š ï¼ˆ1ï¼‰è°ƒç”¨å½¢å¼å’Œå®ç°æ–¹å¼ä¸åŒï¼š å‡½æ•°è°ƒç”¨æ‰€è½¬å‘çš„åœ°å€å¼å›ºå®šä¸å˜çš„ï¼Œä½†ç³»ç»Ÿè°ƒç”¨ä¸­ä¸åŒ…å«å†…æ ¸æœåŠ¡ä¾‹ç¨‹å…¥å£åœ°å€ï¼Œä»…æä¾›åŠŸèƒ½å·ï¼ŒæŒ‰åŠŸèƒ½å·è°ƒç”¨ï¼› å‡½æ•°è°ƒç”¨æ˜¯åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼Œåªèƒ½è®¿é—®ç”¨æˆ·æ ˆï¼› ç³»ç»Ÿè°ƒç”¨éœ€è¦é€šè¿‡é™·é˜±æœºåˆ¶ï¼Œä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼ŒæœåŠ¡ä¾‹ç¨‹åœ¨å†…æ ¸æ€æ‰§è¡Œå¹¶è®¿é—®æ ¸å¿ƒæ ˆã€‚ ï¼ˆ2ï¼‰è¢«è°ƒç”¨ä»£ç çš„ä½ç½®ä¸åŒï¼š å‡½æ•°è°ƒç”¨æ˜¯é™æ€è°ƒç”¨ï¼Œè°ƒç”¨ç¨‹åºå’Œè¢«è°ƒç”¨ä»£ç å¤„äºåŒä¸€ç¨‹åºå†…ï¼Œè¿™æ˜¯ç”¨æˆ·çº§ç¨‹åº ç³»ç»Ÿè°ƒç”¨æ˜¯åŠ¨æ€è°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨çš„æœåŠ¡ä¾‹ç¨‹ä½äºæ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™æ˜¯ç³»ç»Ÿçº§ç¨‹åº ï¼ˆ3ï¼‰æä¾›æ–¹å¼ä¸åŒï¼š å‡½æ•°è°ƒç”¨é€šå¸¸ç”±ç¼–ç¨‹è¯­è¨€æä¾›ï¼Œä¸åŒçš„è¯­è¨€æä¾›çš„å‡½æ•°åŠŸèƒ½çš„ç±»å‹å’Œæ•°é‡å¯ä»¥ä¸åŒ ç³»ç»Ÿè°ƒç”¨ç”±æ“ä½œç³»ç»Ÿæä¾›ï¼Œæ“ä½œç³»ç»Ÿä¸€èˆ¬è®¾è®¡å¥½ï¼Œç³»ç»Ÿè°ƒç”¨çš„åŠŸèƒ½. ç±»å‹å’Œæ•°é‡ä¾¿å›ºå®šä¸å˜ 11. æ“ä½œç³»ç»Ÿç»“æ„åˆ†ç±»ï¼Ÿ Linuxç³»ç»Ÿä½¿ç”¨çš„æ˜¯å•ä½“å¼ç»“æ„ã€‚ å•ä½“å¼ç»“æ„æ“ä½œç³»ç»Ÿå•ä½“å¼ç»“æ„é‡‡ç”¨æ¨¡å—ç»„åˆæ³•ï¼Œæ˜¯åŸºäºç»“æ„åŒ–ç¨‹åºè®¾è®¡çš„ä¸€ç§è½¯ä»¶ç»“æ„è®¾è®¡æ–¹æ³•ã€‚ ä¼˜ç‚¹æ˜¯ï¼šç»“æ„ç´§å¯†. ç»„åˆæ–¹ä¾¿ï¼Œå¯¹ä¸åŒç¯å¢ƒå’Œç”¨æˆ·çš„ä¸åŒéœ€æ±‚å¯ä»¥ç»„åˆä¸åŒæ¨¡å—æ¥æ»¡è¶³ï¼Œçµæ´»æ€§å¤§ï¼›é’ˆå¯¹æŸä¸ªåŠŸèƒ½å¯ç”¨æœ€æœ‰æ•ˆçš„ç®—æ³•å’Œä»»æ„è°ƒç”¨å…¶ä»–æ¨¡å—ä¸­çš„è¿‡ç¨‹æ¥å®ç°ï¼Œå› æ­¤ç³»ç»Ÿæ•ˆç‡é«˜ã€‚ ** ç¼ºç‚¹æ˜¯ï¼š**æ¨¡å—ç‹¬ç«‹æ€§å·®ï¼Œæ¨¡å—ä¹‹é—´ç‰µè¿ç”šå¤šï¼Œå½¢æˆå¤æ‚çš„è°ƒç”¨å…³ç³»ï¼Œç”šè‡³æœ‰å¾ªç¯è°ƒç”¨ï¼Œé€ æˆç³»ç»Ÿç»“æ„ä¸æ¸…æ™°ï¼Œæ­£ç¡®æ€§éš¾ä»¥ä¿è¯ï¼Œå¯é æ€§é™ä½ï¼Œç³»ç»Ÿçš„å¢. åˆ . æ”¹å›°éš¾ã€‚ å±‚æ¬¡å¼ç»“æ„è¿™ç§ç»“æ„æŠŠæ“ä½œç³»ç»Ÿåˆ’åˆ†ä¸ºå†…æ ¸å’Œè‹¥å¹²æ¨¡å—ï¼ˆè¿›ç¨‹ï¼‰ï¼Œè¿™äº›æ¨¡å—ï¼ˆè¿›ç¨‹ï¼‰æŒ‰åŠŸèƒ½çš„è°ƒç”¨æ¬¡åºæ’åˆ—æˆè‹¥å¹²å±‚æ¬¡ï¼Œå„å±‚ä¹‹é—´åªèƒ½å­˜åœ¨å•å‘ä¾èµ–æˆ–å•å‘è°ƒç”¨å…³ç³»ï¼Œå³ä½å±‚ä¸ºé«˜å±‚æœåŠ¡ï¼Œé«˜å±‚å¯ä»¥è°ƒç”¨ä½å±‚åŠŸèƒ½ï¼Œåä¹‹åˆ™ä¸èƒ½ã€‚ è™šæ‹Ÿæœºç»“æ„å®ƒåŸºäºå¦‚ä¸‹æ€æƒ³ï¼šç‰©ç†è®¡ç®—æœºèµ„æºé€šè¿‡å¤šé‡åŒ–å’Œå…±äº«æŠ€æœ¯å¯æ”¹é€ æˆå¤šä¸ªè™šæ‹Ÿæœºã€‚è¿™ç§æŠ€æœ¯çš„åŸºæœ¬åšæ³•æ˜¯ï¼šé€šè¿‡ç”¨ä¸€ç±»ç‰©ç†è®¾å¤‡æ¥æ¨¡æ‹Ÿå¦ä¸€ç±»ç‰©ç†è®¾å¤‡ï¼Œæˆ–é€šè¿‡åˆ†æ—¶åœ°ä½¿ç”¨ä¸€ç±»ç‰©ç†è®¾å¤‡ï¼ŒæŠŠä¸€ä¸ªç‰©ç†å®ä½“æ”¹å˜æˆè‹¥å¹²ä¸ªé€»è¾‘ä¸Šçš„å¯¹åº”ç‰©ã€‚ å¾®å†…æ ¸ç»“æ„æ“ä½œç³»ç»Ÿä»…å°†æ‰€æœ‰åº”ç”¨å¿…éœ€çš„æ ¸å¿ƒåŠŸèƒ½æ”¾å…¥å†…æ ¸ï¼Œç§°ä¸ºå¾®å†…æ ¸ï¼Œå…¶ä»–åŠŸèƒ½éƒ½åœ¨å†…æ ¸ä¹‹å¤–ï¼Œç”±åœ¨ç”¨æˆ·æ€è¿è¡Œçš„æœåŠ¡è¿›ç¨‹å®ç°ï¼Œé€šè¿‡å¾®å†…æ ¸æ‰€æä¾›çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶å®Œæˆè¿›ç¨‹é—´æ¶ˆæ¯é€šä¿¡ã€‚ å¾®å†…æ ¸ç»“æ„çš„ä¼˜ç‚¹ï¼Œä¸€æ˜¯å¯¹è¿›ç¨‹çš„è¯·æ±‚æä¾›ä¸€è‡´æ€§æ¥å£ï¼Œä¸å¿…åŒºåˆ†å†…æ ¸çº§æœåŠ¡å’Œç”¨æˆ·çº§æœåŠ¡ï¼Œæ‰€æœ‰æœåŠ¡å‡å€ŸåŠ©æ¶ˆæ¯ä¼ é€’æœºåˆ¶æä¾›ï¼›äºŒæ˜¯å…·æœ‰è¾ƒå¥½çš„å¯æ‰©å……æ€§å’Œæ˜“ä¿®æ”¹æ€§ï¼Œä¸‰æ˜¯å¯ç§»æ¤æ€§å¥½ï¼›å››æ˜¯å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿæä¾›æœ‰åŠ›æ”¯æ’‘ï¼› å¾®å†…æ ¸ç»“æ„çš„ç¼ºç‚¹æ˜¯è¿è¡Œæ•ˆç‡è¾ƒä½ï¼Œè¿™æ˜¯å› ä¸ºè¿›ç¨‹é—´å¿…é¡»é€šè¿‡å†…æ ¸çš„é€šä¿¡æœºåˆ¶æ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚ 12. è‡ªç”±è½¯ä»¶ï¼Ÿè‡ªç”±è½¯ä»¶ï¼ˆfree softwareï¼Œåˆç§°freewareï¼‰æ˜¯æŒ‡éµå¾ªé€šç”¨å…¬å…±è®¸å¯è¯ï¼ˆGeneral Public Licenseï¼ŒGPLï¼‰è§„åˆ™ï¼Œä¿è¯ä½¿ç”¨ä¸Šçš„è‡ªç”±ï¼Œè·å¾—æºç¨‹åºçš„è‡ªç”±ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹çš„è‡ªç”±ï¼Œå¯ä»¥å¤åˆ¶å’Œæ¨å¹¿çš„è‡ªç”±ï¼Œä¹Ÿå¯ä»¥æœ‰æ”¶è´¹è‡ªç”±çš„ä¸€ç§è½¯ä»¶ã€‚ æ³¨æ„ ï¼šè‡ªç”±è½¯ä»¶ä¸æ˜¯å…è´¹è½¯ä»¶ï¼Œè‡ªç”±è½¯ä»¶ä¹Ÿæœ‰æ”¶è´¹çš„ã€‚ ç¬¬äºŒç«  1. ä½œä¸šç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼Ÿ è¾“å…¥çŠ¶æ€ åå¤‡çŠ¶æ€ æ‰§è¡ŒçŠ¶æ€ å®ŒæˆçŠ¶æ€ 2. ä½•ä¸ºä½çº§è°ƒåº¦ï¼Ÿä½çº§è°ƒåº¦åˆç§°è¿›ç¨‹è°ƒåº¦/çº¿ç¨‹è°ƒåº¦. çŸ­ç¨‹è°ƒåº¦ï¼Œæ ¹æ®æŸç§åŸåˆ™å†³å®šå°±ç»ªé˜Ÿåˆ—ä¸­çš„å“ªä¸ªè¿›ç¨‹/çº¿ç¨‹è·å¾—å¤„ç†å™¨ï¼Œå¹¶å°†å¤„ç†å™¨å‡ºè®©ç»™å®ƒä½¿ç”¨ã€‚ 3. è¿›ç¨‹è°ƒåº¦æ–¹å¼æœ‰å“ªäº›ï¼Ÿè§£é‡Šè¿™äº›æ–¹å¼ï¼Ÿä½çº§è°ƒåº¦æœ‰ä¸¤ç±»åŸºæœ¬è°ƒåº¦æ–¹å¼ï¼šå‰¥å¤ºå¼å’Œéå‰¥å¤ºå¼ã€‚ å‰¥å¤ºå¼å‰¥å¤ºå¼åˆç§°ä¸ºæŠ¢å…ˆå¼ã€‚å½“è¿›ç¨‹/çº¿ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šè¿è¡Œæ—¶ï¼Œç³»ç»Ÿå¯æ ¹æ®è§„å®šçš„åŸåˆ™å‰¥å¤ºåˆ†é…ç»™æ­¤è¿›ç¨‹/çº¿ç¨‹çš„å¤„ç†å™¨ï¼Œå¹¶å°†å…¶ç§»å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œé€‰æ‹©å…¶ä»–è¿›ç¨‹/çº¿ç¨‹è¿è¡Œã€‚ éå‰¥å¤ºå¼éå‰¥å¤ºå¼åˆç§°éæŠ¢å…ˆå¼ã€‚ä¸€æ—¦æŸä¸ªè¿›ç¨‹/çº¿ç¨‹å¼€å§‹è¿è¡Œåä¾¿ä¸å†è®©å‡ºå¤„ç†å™¨ï¼Œé™¤éæ­¤è¿›ç¨‹/çº¿ç¨‹è¿è¡Œç»“æŸæˆ–ä¸»åŠ¨æ”¾å¼ƒå¤„ç†å™¨ï¼Œæˆ–å› å‘ç”ŸæŸä¸ªäº‹ä»¶è€Œä¸èƒ½ç»§ç»­æ‰§è¡Œã€‚ 4. è¿›ç¨‹è°ƒåº¦é˜Ÿåˆ—æ¨¡å‹æœ‰ä½•ä½œç”¨ï¼Ÿè¿›ç¨‹é˜Ÿåˆ—è°ƒåº¦æ¨¡å‹è´Ÿè´£å¤„ç†å™¨çš„åˆ†é…ï¼Œä½œç”¨ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š å°†ç³»ç»Ÿä¸­å„è¿›ç¨‹çš„æ‰§è¡Œæƒ…å†µå’ŒçŠ¶æ€ç‰¹å¾è®°å½•åœ¨å„è¿›ç¨‹çš„PCBè¡¨ä¸­å¹¶å°†å„è¿›ç¨‹çš„PCBè¡¨æ’æˆç›¸åº”çš„é˜Ÿåˆ—ã€‚ é€šè¿‡PCBå˜åŒ–æ¥æŒæ¡ç³»ç»Ÿä¸­å­˜åœ¨çš„æ‰€æœ‰è¿›ç¨‹çš„æ‰§è¡Œæƒ…å†µå’ŒçŠ¶æ€ç‰¹å¾ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶æœºä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©å‡ºä¸€ä¸ªè¿›ç¨‹å æ®CPUã€‚ å½“è¿›ç¨‹è°ƒåº¦ä¸ºå‰¥å¤ºå¼æ—¶ä¸”æ–°å°±ç»ªè¿›ç¨‹ä¼˜å…ˆçº§é«˜äºå½“å‰è¿›ç¨‹æ—¶èƒ½å–å›CPUå¹¶åˆ†é…ç»™æ–°è¿›ç¨‹ã€‚ 5. ä½•ä¸ºå‘¨è½¬æ—¶é—´ï¼Ÿå¹³å‡å‘¨è½¬æ—¶é—´ï¼Ÿå“åº”æ—¶é—´ï¼Ÿå‘¨è½¬æ—¶é—´æ‰¹å¤„ç†ç”¨æˆ·ä»å‘ç³»ç»Ÿæäº¤ä½œä¸šå¼€å§‹åˆ°ä½œä¸šå®Œæˆä¸ºæ­¢çš„æ—¶é—´é—´éš”ç§°ä¸ºä½œä¸šå‘¨è½¬æ—¶é—´ã€‚ å¹³å‡å‘¨è½¬æ—¶é—´æ‰€æœ‰è¿›ç¨‹çš„å‘¨è½¬æ—¶é—´ä¹‹å’Œé™¤ä»¥è¿›ç¨‹æ•°å¾—åˆ°çš„å°±æ˜¯å¹³å‡å‘¨è½¬æ—¶é—´ã€‚ å“åº”æ—¶é—´ä»äº¤äº’å¼è¿›ç¨‹æäº¤ä¸€ä¸ªè¯·æ±‚ï¼ˆå‘½ä»¤ï¼‰ç›´åˆ°è·å¾—å“åº”ä¹‹é—´çš„æ—¶é—´é—´éš”ç§°ä¸ºå“åº”æ—¶é—´ã€‚ 6. è¿›ç¨‹è°ƒåº¦ç®—æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿæ— è®ºæ˜¯åœ¨æ‰¹å¤„ç†ç³»ç»Ÿè¿˜æ˜¯åˆ†æ—¶ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·è¿›ç¨‹æ•°ä¸€èˆ¬éƒ½å¤šäºå¤„ç†æœºæ•°. è¿™å°†å¯¼è‡´å®ƒä»¬äº’ç›¸äº‰å¤ºå¤„ç†æœºã€‚å¦å¤–ï¼Œç³»ç»Ÿè¿›ç¨‹ä¹ŸåŒæ ·éœ€è¦ä½¿ç”¨å¤„ç†æœºã€‚è¿™å°±è¦æ±‚è¿›ç¨‹è°ƒåº¦ç¨‹åºæŒ‰ä¸€å®šçš„ç­–ç•¥ï¼ŒåŠ¨æ€åœ°æŠŠå¤„ç†æœºåˆ†é…ç»™å¤„äºå°±ç»ªé˜Ÿåˆ—ä¸­çš„æŸä¸€ä¸ªè¿›ç¨‹ï¼Œä»¥ä½¿ä¹‹æ‰§è¡Œã€‚ 7. æŒæ¡ä¸‰ç§è¿›ç¨‹è°ƒåº¦ç®—æ³•çš„åå­—ä¸æ€æƒ³ï¼Ÿé‡ç‚¹æŒæ¡å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ã€‚FCFS/å…ˆæ¥å…ˆæœåŠ¡ç®—æ³• éå‰¥å¤ºå¼è°ƒåº¦ç®—æ³• FCFSæŒ‰ç…§ä½œä¸šè¿›å…¥ç³»ç»Ÿåå¤‡ä½œä¸šé˜Ÿåˆ—çš„å…ˆåæ¬¡åºæ¥æŒ‘é€‰ä½œä¸šï¼Œå…ˆè¿›å…¥ç³»ç»Ÿçš„ä½œä¸šå°†ä¼˜å…ˆè¢«æŒ‘é€‰è¿›å…¥å†…å­˜ï¼Œåˆ›å»ºç”¨æˆ·è¿›ç¨‹ï¼Œåˆ†é…æ‰€éœ€èµ„æºï¼Œç„¶åç§»å…¥å°±ç»ªé˜Ÿåˆ—ã€‚ SJF/æœ€çŸ­æ—¶é—´ä¼˜å…ˆç®—æ³• éå‰¥å¤ºå¼è°ƒåº¦ç®—æ³• SJFä»¥è¿›å…¥ç³»ç»Ÿä½œä¸šæ‰€è¦æ±‚çš„CPUè¿è¡Œæ—¶é—´çš„é•¿çŸ­ä¸ºæ ‡å‡†ï¼Œæ€»æ˜¯é€‰å–é¢„è®¡è®¡ç®—æ—¶é—´æœ€çŸ­çš„ä½œä¸šæŠ•å…¥è¿è¡Œã€‚ SRTF/æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆç®—æ³• å‰¥å¤ºå¼è°ƒåº¦ç®—æ³• å‡è®¾å½“å‰æŸè¿›ç¨‹/çº¿ç¨‹æ­£åœ¨è¿è¡Œï¼Œå¦‚æœæœ‰æ–°è¿›ç¨‹/çº¿ç¨‹ç§»å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œè‹¥å®ƒæ‰€éœ€è¦çš„CPUè¿è¡Œæ—¶é—´æ¯”å½“å‰è¿è¡Œè¿›ç¨‹/çº¿ç¨‹æ‰€éœ€è¦çš„å‰©ä½™CPUæ—¶é—´è¿˜çŸ­ï¼ŒæŠ¢å å¼æœ€çŸ­ä½œä¸šä¼˜å…ˆç®—æ³•å¼ºè¡Œå‰¥å¤ºå½“å‰æ‰§è¡Œè€…çš„æ§åˆ¶æƒï¼Œè°ƒåº¦æ–°è¿›ç¨‹/çº¿ç¨‹æ‰§è¡Œã€‚ HRRF/æœ€é«˜å“åº”æ¯”ä¼˜å…ˆç®—æ³• éå‰¥å¤ºå¼è°ƒåº¦ç®—æ³• å“åº”æ¯” = ä½œä¸šå‘¨è½¬æ—¶é—´ / ä½œä¸šå¤„ç†æ—¶é—´ = 1 + ä½œä¸šç­‰å¾…æ—¶é—´ / ä½œä¸šå¤„ç†æ—¶é—´ ä½œä¸šå¤„ç†æ—¶é—´ç”±ç”¨æˆ·ç»™å‡ºï¼Œæ˜¯ä¸€ä¸ªå¸¸é‡ï¼›ä½œä¸šç­‰å¾…æ—¶é—´å¼€å§‹äºæ—¶é—´ç‚¹0ï¼Œéšç€ä½œä¸šåœ¨åå¤‡é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´çš„å¢åŠ è€Œå˜é•¿ï¼Œæ¯å½“è°ƒåº¦ä½œä¸šè¿è¡Œæ—¶ï¼Œè®¡ç®—åå¤‡ä½œä¸šé˜Ÿåˆ—ä¸­æ¯ä¸ªä½œä¸šçš„å“åº”æ¯”ä½œä¸ºå…¶ä¼˜å…ˆçº§ï¼Œé€‰æ‹©å“åº”æ¯”æœ€é«˜è€…æŠ•å…¥è¿è¡Œã€‚ ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³• ç³»ç»Ÿå¯é¢„å…ˆè§„å®šä¸ºéå‰¥å¤ºå¼æˆ–å‰¥å¤ºå¼ ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•æ ¹æ®ç¡®å®šçš„ä¼˜å…ˆçº§æ¥é€‰å–è¿›ç¨‹/çº¿ç¨‹ï¼Œæ€»æ˜¯é€‰æ‹©å°±ç»ªé˜Ÿåˆ—ä¸­ä¼˜å…ˆçº§æœ€é«˜è€…æŠ•å…¥è¿è¡Œã€‚ RR/è½®è½¬è°ƒåº¦ç®—æ³•/æ—¶é—´ç‰‡è°ƒåº¦ å‰¥å¤ºå¼è°ƒåº¦ç®—æ³• è°ƒåº¦ç¨‹åºæ¯æ¬¡æŠŠCPUåˆ†é…ç»™å°±ç»ªé˜Ÿåˆ—é¦–è¿›ç¨‹/çº¿ç¨‹ä½¿ç”¨è§„å®šçš„æ—¶é—´é—´éš”ï¼Œç§°ä¸ºæ—¶é—´ç‰‡ï¼Œé€šå¸¸ä¸º10ms~200msï¼Œå°±ç»ªé˜Ÿåˆ—ä¸­çš„æ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹è½®æµåœ°è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œå½“æ—¶é—´ç‰‡è€—å°½æ—¶å°±å¼ºè¿«å½“å‰è¿è¡Œè¿›ç¨‹/çº¿ç¨‹è®©å‡ºå¤„ç†å™¨ï¼Œè½¬è€Œæ’åˆ—åˆ°å°±ç»ªé˜Ÿåˆ—å°¾éƒ¨ï¼Œç­‰å€™ä¸‹ä¸€è½®è°ƒåº¦ã€‚ MLFQ/å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³• å‰¥å¤ºå¼è°ƒåº¦ç®—æ³• ç”±ç³»ç»Ÿå»ºç«‹å¤šä¸ªå°±ç»ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯¹åº”äºä¸€ä¸ªä¼˜å…ˆçº§ï¼Œç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¬¬äºŒä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§æ¬¡ä¹‹ï¼Œå…¶åçš„ä¼˜å…ˆçº§é€ä¸ªé™ä½ã€‚ è¾ƒé«˜ä¼˜å…ˆçº§é˜Ÿåˆ—çš„è¿›ç¨‹/çº¿ç¨‹åˆ†é…ç»™è¾ƒçŸ­æ—¶é—´ç‰‡ï¼Œè¾ƒä½ä¼˜å…ˆçº§é˜Ÿåˆ—çš„è¿›ç¨‹/çº¿ç¨‹åˆ†é…ç»™è¾ƒé•¿æ—¶é—´ç‰‡ï¼Œæœ€åä¸€ä¸ªé˜Ÿåˆ—è¿›ç¨‹/çº¿ç¨‹æŒ‰FCFSç®—æ³•è¿›è¡Œè°ƒåº¦ã€‚ 8. å¤šçº§åé¦ˆè°ƒåº¦ç®—æ³•æœ‰ä½•æ€§èƒ½ç‰¹ç‚¹ï¼ŸMLFQè°ƒåº¦ç®—æ³•å…·æœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œèƒ½æ»¡è¶³å„ç±»åº”ç”¨éœ€è¦ã€‚ å¯¹äºåˆ†æ—¶äº¤äº’æ€§çŸ­ä½œä¸šï¼Œç³»ç»Ÿé€šå¸¸å¯åœ¨ç¬¬ä¸€é˜Ÿåˆ—ï¼ˆæœ€é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰è§„å®šçš„æ—¶é—´ç‰‡å†…å®Œæˆå·¥ä½œã€‚ å¯¹äºçŸ­çš„æ‰¹å¤„ç†ä½œä¸šï¼Œé€šå¸¸åªéœ€åœ¨ç¬¬ä¸€é˜Ÿåˆ—å’Œç¬¬äºŒé˜Ÿåˆ—ä¸­å„æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡å°±èƒ½å®Œæˆå·¥ä½œï¼Œå‘¨è½¬æ—¶é—´ä»ç„¶å¾ˆçŸ­ã€‚ å¯¹äºé•¿çš„æ‰¹å¤„ç†ä½œä¸šï¼Œå®ƒå°†ä¾æ¬¡åœ¨ç¬¬ä¸€. ç¬¬äºŒ. ç¬¬ä¸‰ç­‰å„ä¸ªé˜Ÿåˆ—ä¸­è·å¾—æ—¶é—´ç‰‡è¿è¡Œã€‚ å‡å¦‚ä¸€ä¸ªé•¿ä½œä¸šè¿›å…¥MLFQï¼Œæœ€ç»ˆè¿›å…¥æœ€ä½ä¼˜å…ˆçº§é˜Ÿåˆ—åï¼Œæœ‰å¾ˆå¤šçŸ­ä½œä¸šè¿›å…¥é˜Ÿåˆ—ï¼Œä½¿å…¶ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œåˆ™ä¼šäº§ç”Ÿé¥¥é¥¿ã€‚ä¸€ç§é¢„é˜²æªæ–½æ˜¯å¯¹äºä½ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´è¶³å¤Ÿé•¿å¾—è¿›ç¨‹æå‡å…¶ä¼˜å…ˆçº§ï¼Œä»è€Œè®©å®ƒè·å¾—è¿è¡Œæœºä¼šã€‚ 9. å¤„ç†å™¨è°ƒåº¦åˆ†ä¸ºå“ªä¸‰çº§ï¼Ÿ é«˜çº§è°ƒåº¦ï¼šç”¨äºå†³å®šå“ªäº›æ»¡è¶³èµ„æºéœ€æ±‚çš„åå¤‡ä½œä¸šè¢«é€‰ä¸­è¿›å…¥å†…å­˜å»å¤šé“è¿è¡Œï¼ŒFCFA. SJF. SRTF. HRRF. ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ç­‰æ˜¯å¸¸ç”¨çš„ä½œä¸šè°ƒåº¦ç®—æ³•ï¼› ä¸­çº§è°ƒåº¦ï¼šèµ·å‡è¡¡ç³»ç»Ÿè´Ÿè½½çš„ä½œç”¨ï¼Œæ ¹æ®å†…å­˜èµ„æºæƒ…å†µå†³å®šå†…å­˜ä¸­æ‰€èƒ½å®¹çº³çš„è¿›ç¨‹æ•°ç›®ï¼Œå¹¶å®Œæˆå¤–å­˜å’Œå†…å­˜ä¸­çš„è¿›ç¨‹å¯¹æ¢å·¥ä½œï¼› ä½çº§è°ƒåº¦ï¼šç”¨äºå†³å®šé€‰æ‹©å“ªä¸ªè¿›ç¨‹/çº¿ç¨‹å æœ‰å¤„ç†å™¨è¿è¡Œï¼ŒFCFS. RR. ä¼˜å…ˆæ•°. MLFQç­‰æ˜¯å¸¸ç”¨çš„è¿›ç¨‹/çº¿ç¨‹è°ƒåº¦ç®—æ³•ã€‚ è¡¡é‡è°ƒåº¦ç®—æ³•ä¼˜åŠ£çš„å› ç´ åŒ…æ‹¬å“åº”æ—¶é—´. å‘¨è½¬æ—¶é—´. èµ„æºåˆ©ç”¨ç‡. ä½œä¸šååç‡å’Œå…¬å¹³æ€§ç­‰ã€‚ ç¬¬ä¸‰ç«  1. ä½•ä¸ºå¹¶å‘ä¸å¹¶è¡Œï¼ŸåŒºåˆ«ï¼Ÿå¹¶å‘åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œåœ¨æŸä¸€æ—¶é—´æ®µæœ‰å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹åŒæ—¶å­˜åœ¨ã€‚ å¹¶å‘çš„å®è´¨æ˜¯ä¸€ä¸ªå¤„ç†å™¨åœ¨å‡ ä¸ªè¿›ç¨‹ä¹‹é—´çš„å¤šè·¯å¤ç”¨ï¼Œå¹¶å‘æ˜¯å¯¹æœ‰é™çš„ç‰©ç†èµ„æºå¼ºåˆ¶è¡Œä½¿å¤šç”¨æˆ·å…±äº«ï¼Œæ¶ˆé™¤è®¡ç®—æœºéƒ¨ä»¶ä¹‹é—´çš„äº’ç­‰ç°è±¡ï¼Œä»¥æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡ã€‚ å¹¶è¡Œåœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œåœ¨æŸä¸€æ—¶é—´æ®µæœ‰å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹åŒæ—¶æ‰§è¡Œ åŒºåˆ«å¹¶è¡Œä¸€å®šè¦å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œè€Œå¹¶å‘åªè¦æ±‚èƒ½å…è®¸å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹åŒæ—¶å­˜åœ¨ï¼Œå¯ä»¥åœ¨å•ä¸ªCPUä¸­äº¤æ›¿æ‰§è¡Œï¼Œå› æ­¤ï¼Œå¹¶è¡Œæ˜¯å¹¶å‘çš„ä¸€ä¸ªå­é›†ã€‚ 2. ä½•ä¸ºå¹¶å‘è¿‡ç¨‹çš„ä¸ç¡®å®šæ€§ï¼Ÿä¸ºä½•ä¼šå¯¼è‡´ä¸ç¡®å®šæ€§é—®é¢˜ï¼Ÿè¯·ä½ ä¸¾ä¾‹è¯´æ˜ï¼Ÿå¹¶å‘è¿‡ç¨‹çš„ä¸ç¡®å®šæ€§æŒ‡æ¯æ¬¡æ‰§è¡Œç»“æœéƒ½å¯èƒ½æœ‰æ‰€ä¸åŒã€‚å¯¼è‡´ä¸ç¡®å®šæ€§çš„åŸå› æ˜¯ç¨‹åºå¤–éƒ¨çš„é¡ºåºç‰¹æ€§æ¶ˆå¤±ï¼Œç¨‹åºä¸è®¡ç®—ä¸å†ä¸€ä¸€å¯¹åº”ã€‚ ä¾‹å­ï¼šåœ¨ç…®å’–å•¡æ—¶ï¼Œè‹¥æ¯æ¬¡éƒ½æŒ‰è¯´æ˜ä¹¦ä¸Šçš„é¡ºåºæ“ä½œï¼Œé‚£æ¯æ¬¡å‡ºæ¥çš„å’–å•¡éƒ½ä¸€æ ·ã€‚ä½†è‹¥é‡‡ç”¨å¹¶å‘ï¼Œåœ¨æŸæ¬¡å‡†å¤‡å¾€çƒ­æ°´é‡Œæ”¾å’–å•¡è±†æ—¶ï¼Œè€æ¿å‡ºæ¥ä¸­æ–­äº†ä½ ï¼Œç„¶åå–äº†ä¸€å£çƒ­æ°´ï¼Œä¹‹åå°†å’–å•¡å£¶è¿˜ç»™ä½ ï¼Œåœ¨è¿›è¡Œç›¸åŒæ“ä½œåå’–å•¡æ¯”ä»¥å‰æµ“ã€‚ 3. ä½•ä¸ºè¿›ç¨‹ï¼Ÿè¯·ç”¨ä½ è‡ªå·±çš„æ–¹å¼ç»™è¿›ç¨‹ä¸‹ä¸ªå®šä¹‰ï¼Ÿä¸ºä½•è¦å¼•å…¥è¿›ç¨‹ï¼Ÿ è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­æœ€é‡è¦å’Œæœ€åŸºæœ¬çš„æ¦‚å¿µä¹‹ä¸€ï¼Œå¼•å…¥è¿›ç¨‹æ˜¯ç”±ç³»ç»Ÿèµ„æºçš„æœ‰é™å’Œç³»ç»Ÿå†…çš„å¹¶å‘æ€§æ‰€å†³å®šçš„ã€‚ è¿›ç¨‹å…·æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œç”±åˆ›å»ºè€Œäº§ç”Ÿï¼Œç”±è°ƒåº¦è€Œæ‰§è¡Œï¼Œ ç”±æ’¤é”€è€Œæ¶ˆäº¡ï¼Œæ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½æ˜¯è¿›ç¨‹çš„åˆ›å»º. ç®¡ç†å’Œæ’¤é”€ã€‚ 4. ä¸ºä½•ç¨‹åºä¸€å½“å¹¶å‘æ‰§è¡Œï¼Œç»“æœå°±å¯èƒ½ä¸å†å¦‚ä¼ ç»Ÿé¡ºåºæ‰§è¡Œæ—¶çš„å¯å†ç°æ€§ï¼Ÿå› ä¸ºç¨‹åºå¤–éƒ¨çš„é¡ºåºç‰¹æ€§æ¶ˆå¤±ï¼Œç¨‹åºä¸è®¡ç®—ä¸å†ä¸€ä¸€å¯¹åº”ã€‚æ¯æ¬¡æ‰§è¡Œéƒ½å¯èƒ½è¢«ä¸­æ–­æˆ–è€…ç¯å¢ƒå˜é‡è¢«åˆ«çš„è¿›ç¨‹æ”¹å˜ã€‚ 5. è¿›ç¨‹çš„ç‰¹å¾æœ‰é‚£äº›ï¼Ÿå¦‚ä½•ç†è§£è¿™äº›ç‰¹å¾ï¼Ÿ 6. è¿›ç¨‹çš„çŠ¶æ€æœ‰å“ªäº›ï¼Ÿå¦‚ä½•ç†è§£è¿™äº›çŠ¶æ€ï¼Ÿè¿›ç¨‹çš„çŠ¶æ€æœ‰è¿è¡Œæ€. å°±ç»ªæ€. ç­‰å¾…æ€ è¿è¡Œæ€è¿›ç¨‹å ç”¨å¤„ç†å™¨æ­£åœ¨è¿è¡Œçš„çŠ¶æ€ å°±ç»ªæ€è¿›ç¨‹å…·å¤‡è¿è¡Œæ¡ä»¶ï¼Œç­‰å¾…ç³»ç»Ÿåˆ†é…å¤„ç†å™¨ä»¥ä¾¿è¿è¡Œçš„çŠ¶æ€ ç­‰å¾…æ€åˆç§°é˜»å¡æ€æˆ–ç¡çœ æ€ï¼ŒæŒ‡è¿›ç¨‹ä¸å…·å¤‡è¿è¡Œæ¡ä»¶ï¼Œæ­£åœ¨ç­‰å¾…æŸä¸ªäº‹ä»¶å®Œæˆçš„çŠ¶æ€ 7. è¯·è§£é‡ŠP95ï¼Œ118å›¾2-4ï¼Ÿ 8. è¿›ç¨‹æœ‰å“ªå‡ éƒ¨åˆ†æ„æˆï¼Ÿè¿™äº›æ„æˆå­˜äºä½•å¤„ï¼ŸPCBä¸»è¦æ„æˆï¼ŸPCBæ’é˜Ÿé ä»€ä¹ˆæ–¹å¼å®ç°ï¼Ÿè¿›ç¨‹ç”±è¿›ç¨‹æ§åˆ¶å—(PCB). è¿›ç¨‹ç¨‹åºå—. è¿›ç¨‹æ ¸å¿ƒæ ˆå’Œè¿›ç¨‹æ•°æ®å—ç»„æˆ å­˜å‚¨ä½ç½® è¿›ç¨‹æ§åˆ¶å—å­˜äºç³»ç»Ÿå†…å­˜ä¸­çš„ä¸€ä¸ªè¿ç»­åŒºåŸŸ è¿›ç¨‹ç¨‹åºå—å­˜äºï¼Ÿï¼Ÿ è¿›ç¨‹æ ¸å¿ƒæ ˆå­˜äºï¼Ÿï¼Ÿ è¿›ç¨‹æ•°æ®å—å­˜äºï¼Ÿï¼Ÿ PCBä¸»è¦æ„æˆ æ ‡å¿—ä¿¡æ¯ ç°åœºä¿¡æ¯ æ§åˆ¶ä¿¡æ¯ PCBæ’é˜Ÿ é“¾æ¥æ–¹å¼ ç´¢å¼•æ–¹å¼ 9. ä½•ä¸ºå†…æ ¸æ€ä¸ç”¨æˆ·æ€ï¼Ÿå†…æ ¸æ€å½“å¤„ç†å™¨å¤„äºå†…æ ¸æ€æ—¶ï¼Œè¿™æ˜¯æ“ä½œç³»ç»Ÿç®¡ç†ç¨‹åºè¿è¡Œæ—¶æ‰€åœ¨çŠ¶æ€ï¼Œå¯è®¤ä¸ºå¤„ç†å™¨æ­£åœ¨è¿è¡Œå¯ä¿¡ç³»ç»Ÿè½¯ä»¶ï¼Œæ­¤æ—¶å…¨éƒ¨æœºå™¨æŒ‡ä»¤éƒ½è¢«å…è®¸åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œï¼Œç¨‹åºå¯è®¿é—®æ‰€æœ‰å†…å­˜å•å…ƒå’Œç³»ç»Ÿèµ„æºå¹¶å…·æœ‰æ”¹å˜å¤„ç†å™¨çŠ¶æ€çš„èƒ½åŠ›ã€‚ ç”¨æˆ·æ€å½“å¤„ç†å™¨å¤„äºç”¨æˆ·æ€æ—¶ï¼Œå®ƒæ­£åœ¨è¿è¡Œéå¯ä¿¡åº”ç”¨ç¨‹åºæ­¤æ—¶æ— æ³•æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œä¸”è®¿é—®æƒé™ä»…é™äºå½“å‰å¤„ç†å™¨ä¸Šæ‰§è¡Œç¨‹åºæ‰€åœ¨çš„åœ°å€ç©ºé—´ã€‚ 10. åŸè¯­æŒ‡å•¥ï¼Ÿä¸ºä½•è¦å¼•å…¥åŸè¯­ï¼ŸåŸè¯­ä¸å¯ä¸­æ–­é å•¥å®ç°ï¼ŸåŸè¯­åŸè¯­åŸè¯­é€šå¸¸ç”±è‹¥å¹²æ¡æŒ‡ä»¤ç»„æˆï¼Œç”¨æ¥å®ç°æŸä¸ªç‰¹å®šçš„æ“ä½œã€‚é€šè¿‡ä¸€æ®µä¸å¯åˆ†å‰²çš„æˆ–ä¸å¯ä¸­æ–­çš„ç¨‹åºå®ç°å…¶åŠŸèƒ½ã€‚ ä¸ºä½•å¼•å…¥åŸè¯­æˆ‘ä»¬å¸Œæœ›æœ‰è‹¥å¹²æŒ‡ä»¤çš„è¿ç»­æ“ä½œä¸ä¼šè¢«æ‰“æ–­ åŸè¯­ä¸å¯ä¸­æ–­é å•¥å®ç°é€šè¿‡å…³ä¸­æ–­æ¥å®ç° 11. ä½•ä¸ºçº¿ç¨‹ï¼Ÿç°ä»£OSä¸ºä½•è¦å¼•å…¥çº¿ç¨‹ï¼Ÿä¸è¿›ç¨‹çš„åŒºåˆ«ï¼Ÿä½•ä¸ºçº¿ç¨‹çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­èƒ½å¹¶å‘æ‰§è¡Œçš„å®ä½“ï¼Œæ˜¯è¿›ç¨‹çš„ç»„æˆéƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ç³»ç»Ÿè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œè¿è¡Œåœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­,å¹¶ä½¿ç”¨è¿›ç¨‹çš„èµ„æºå’Œç¯å¢ƒã€‚ å¼•å…¥çº¿ç¨‹çš„ç†ç”±ä¸ºäº†å‡å°‘ç¨‹åºå¹¶å‘æ‰§è¡Œæ—¶æ‰€ä»˜å‡ºçš„æ—¶ç©ºå¼€é”€ï¼Œä½¿å¾—å¹¶å‘ç²’åº¦æ›´ç»†. å¹¶å‘æ€§æ›´å¥½ã€‚ ä¸è¿›ç¨‹çš„åŒºåˆ« çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ç»„æˆéƒ¨åˆ† çº¿ç¨‹åˆ‡æ¢è¾ƒå¿« çº¿ç¨‹é€šä¿¡æ˜“äºå®ç° çº¿ç¨‹å¹¶å‘ç¨‹åº¦æ¯”è¿›ç¨‹é«˜ 12. å•é“ä¸å¤šé“ç³»ç»Ÿä¼˜ç¼ºç‚¹æ¯”è¾ƒï¼Ÿå¤šé“ç¨‹åºèƒ½äº¤æ›¿ä½¿ç”¨CPUï¼Œæé«˜äº†CPUåŠå…¶ä»–ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†ç³»ç»Ÿçš„æ•ˆç‡ã€‚ç¼ºç‚¹æ˜¯å»¶é•¿äº†ä½œä¸šçš„å‘¨è½¬æ—¶é—´ï¼Œç”¨æˆ·ä¸èƒ½è¿›è¡Œç›´æ¥å¹²é¢„ï¼Œç¼ºå°‘äº¤äº’æ€§ï¼Œä¸åˆ©äºç¨‹åºçš„å¼€å‘ä¸è°ƒè¯•ã€‚ 13. ä¸ºä½•è¯´ä¸­æ–­æ˜¯ç°ä»£OSçš„ä¸€é¡¹å¿…å¤‡æŠ€æœ¯ï¼Ÿå› ä¸ºä¸­æ–­ä½¿åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°æ€¥éœ€å¤„ç†çš„äº‹ä»¶æ—¶ï¼Œå¯ä»¥æš‚æ—¶ä¸­æ­¢CPUä¸Šç°è¡Œç¨‹åºçš„è¿è¡Œï¼Œè½¬å»æ‰§è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¾…å¤„ç†å®Œæˆåå†è¿”å›åŸç¨‹åºè¢«ä¸­æ–­å¤„æˆ–è°ƒåº¦å…¶ä»–ç¨‹åºæ‰§è¡Œã€‚ 14. è¯·ä½ ç»™æ­»é”ä¸‹ä¸ªå®šä¹‰ï¼Ÿä¸ºä½•æœ‰æ­»é”å­˜åœ¨ï¼Ÿæ­»é”å®šä¹‰æ“ä½œç³»ç»Ÿä¸­çš„æ­»é”æŒ‡ï¼šå¦‚æœåœ¨ä¸€ä¸ªè¿›ç¨‹é›†åˆä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…åªèƒ½ç”±è¯¥é›†åˆä¸­çš„å…¶ä»–ä¸€ä¸ªè¿›ç¨‹æ‰èƒ½å¼•å‘çš„äº‹ä»¶ï¼Œåˆ™ç§°ä¸€ç»„è¿›ç¨‹æˆ–ç³»ç»Ÿæ­¤æ—¶å‘ç”Ÿæ­»é”ã€‚ æ­»é”å­˜åœ¨åŸå› æ­»é”äº§ç”Ÿä¸ä»…ä¸ç³»ç»Ÿæ‹¥æœ‰çš„èµ„æºæ•°é‡æœ‰å…³ï¼Œè€Œä¸”ä¸èµ„æºåˆ†é…ç­–ç•¥ï¼Œè¿›ç¨‹å¯¹èµ„æºçš„ä½¿ç”¨è¦æ±‚ä»¥åŠå¹¶å‘è¿›ç¨‹çš„æ¨è¿›é¡ºåºæœ‰å…³ã€‚ 15. äº§ç”Ÿæ­»é”çš„åŸå› ï¼Ÿæ­»é”äº§ç”Ÿä¸ä»…ä¸ç³»ç»Ÿæ‹¥æœ‰çš„èµ„æºæ•°é‡æœ‰å…³ï¼Œè€Œä¸”ä¸èµ„æºåˆ†é…ç­–ç•¥ï¼Œè¿›ç¨‹å¯¹èµ„æºçš„ä½¿ç”¨è¦æ±‚ä»¥åŠå¹¶å‘è¿›ç¨‹çš„æ¨è¿›é¡ºåºæœ‰å…³ã€‚ 16. æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶ï¼Ÿä¸¾ä¾‹è¯´æ˜ï¼Ÿ1. äº’æ–¥æ¡ä»¶è¿›ç¨‹äº’æ–¥ä½¿ç”¨èµ„æº ä¾‹å¦‚ï¼Œå½“åªæœ‰ä¸€è¢‹å’–å•¡ç²‰æ—¶ï¼ŒAæ‹¿äº†Bå°±ä¸èƒ½æ‹¿ã€‚ 2. éƒ¨åˆ†åˆ†é…æ¡ä»¶ç”³è¯·æ–°èµ„æºæ—¶ä¸é‡Šæ”¾å·²å æœ‰èµ„æº ä¾‹å¦‚ï¼Œå½“Aæ‹¿åˆ°å’–å•¡ç²‰æ—¶ï¼Œåœ¨æ‹¿åˆ°çƒ­æ°´ä¹‹å‰Aä¸ä¼šå°†å’–å•¡ç²‰æ”¾å‡ºæ¥ï¼Œå…¶ä»–äººä¸èƒ½ä½¿ç”¨å’–å•¡ç²‰ã€‚ 3. ä¸å‰¥å¤ºæ¡ä»¶ä¸€ä¸ªè¿›ç¨‹ä¸èƒ½æŠ¢å¤ºå…¶ä»–è¿›ç¨‹å æœ‰çš„èµ„æº ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒBæƒ³è¦å’–å•¡ç²‰ä½†å®ƒä¸èƒ½æŠ¢Açš„ã€‚ 4. ç¯è·¯æ¡ä»¶å­˜åœ¨ä¸€ç»„è¿›ç¨‹å¾ªç¯ç­‰å¾…èµ„æº ä¾‹å¦‚ï¼Œåœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼ŒBæ°å¥½æœ‰çƒ­æ°´ï¼Œä½†ä»–åœ¨æ‹¿åˆ°å’–å•¡ç²‰å‰ä¸ä¼šæ”¾å‡ºçƒ­æ°´ç»™Aä½¿ç”¨ï¼Œä¸¤è€…å½¢æˆä¸€ä¸ªç¯è·¯ã€‚ 17. è§£é‡Šå¹¶åˆ†æå…¶ä¸åŒï¼šé¢„é˜²æ­»é”. é¿å…æ­»é”. æ£€æµ‹æ­»é”. è§£é™¤æ­»é”ï¼Ÿé¢„é˜²æ­»é”åœ¨èµ„æºåˆ†é…ä¸­ç ´åéƒ¨åˆ†æ­»é”å¿…è¦æ¡ä»¶ã€‚ é¿å…æ­»é”å¦‚æœä¸€ä¸ªè¿›ç¨‹å½“å‰è¯·æ±‚èµ„æºä¼šå¯¼è‡´æ­»é”ï¼Œç³»ç»Ÿå°†æ‹’ç»å¯åŠ¨æ­¤è¿›ç¨‹ï¼›å¦‚æœä¸€ä¸ªèµ„æºåˆ†é…ä¼šå¯¼è‡´ç³»ç»Ÿä¸‹ä¸€æ­¥æ­»é”ï¼Œä¾¿æ‹’ç»æœ¬æ¬¡åˆ†é…ã€‚ æ­»é”æ£€æµ‹ç³»ç»Ÿå®šæ—¶åœ°è¿è¡Œä¸€ä¸ªâ€œæ­»é”æ£€æµ‹â€ç¨‹åºï¼Œåˆ¤æ–­ç³»ç»Ÿå†…æ˜¯å¦å·²å‡ºç°æ­»é”ã€‚ è§£é™¤æ­»é”æ£€æµ‹åˆ°æ­»é”å‘ç”Ÿä»¥åï¼Œé‡‡ç”¨å„ç§æ–¹æ³•è§£é™¤æ­»é”çŠ¶æ€ä»¥æ¢å¤åˆ°å¯è¿è¡ŒçŠ¶æ€ã€‚ å·®å¼‚é¢„é˜²æ­»é”æ˜¯é€šè¿‡èµ„æºåˆ†é…ç­–ç•¥è®©æ­»é”ä¸å¯èƒ½å‘ç”Ÿï¼Œé¿å…æ­»é”æ˜¯æ¯æ¬¡åˆ†é…éƒ½è¿›è¡Œå®‰å…¨æ€§æ£€æµ‹æ¥é¿å…è¿›å…¥æ­»é”çŠ¶æ€ã€‚è€Œæ­»é”æ£€æµ‹å’Œè§£é™¤æ­»é”æ˜¯ä¸é˜²æ­¢æˆ–é¿å…æ­»é”ï¼Œå½“æ£€æµ‹åˆ°ç³»ç»Ÿå·²ç»è¿›å…¥æ­»é”çŠ¶æ€åå†å¤„ç†ã€‚ 18. é¢„å…ˆåˆ†é…ç­–ç•¥æ˜¯èµ„æºåŠ¨æ€è¿˜æ˜¯é™æ€åˆ†é…æ³•ï¼Ÿæœ‰ä½•ä¼˜ç¼ºç‚¹ï¼Ÿé¢„å…ˆåˆ†é…ç­–ç•¥æ˜¯èµ„æºé™æ€åˆ†é…æ³•ã€‚ ä¼˜ç‚¹ç­–ç•¥å®ç°ç®€å• ç¼ºç‚¹èµ„æºåˆ©ç”¨ç‡ä½ 19. åŠ¨æ€ä¸é™æ€å“ªä¸ªå¯¹èµ„æºçš„åˆ©ç”¨ç‡é«˜ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå®ƒä»¬ä¸ºä½•å¯ä»¥é¢„é˜²æ­»é”ï¼ŸåŠ¨æ€èµ„æºåˆ©ç”¨ç‡é«˜ï¼Œå› ä¸ºåœ¨æ¯ä¸ªè¿›ç¨‹å æœ‰çš„èµ„æºä¸­ï¼Œæœ‰äº›èµ„æºåœ¨è¿è¡ŒåæœŸä½¿ç”¨ï¼Œæœ‰äº›èµ„æºåœ¨ä¾‹å¤–æƒ…å†µä¸‹æ‰è¢«ä½¿ç”¨ï¼Œå¯èƒ½ä¼šé€ æˆè¿›ç¨‹å æœ‰ä¸€äº›å‡ ä¹ç”¨ä¸åˆ°çš„èµ„æºï¼Œè€Œä½¿å…¶ä»–æƒ³ä½¿ç”¨è¿™äº›èµ„æºçš„è¿›ç¨‹ç­‰å¾…ã€‚ é™æ€ç ´åäº†éƒ¨åˆ†åˆ†é…æ¡ä»¶ï¼Œè€ŒåŠ¨æ€ç ´åç¯è·¯æ¡ä»¶ã€‚ 20. ä½•ä¸ºå®‰å…¨çŠ¶æ€ï¼Ÿä½•ä¸ºä¸å®‰å…¨çŠ¶æ€ï¼Ÿå¦‚ä½•é¿å…èµ„æºåˆ†é…æ—¶è¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Ÿå®‰å…¨çŠ¶æ€å°±æ˜¯å­˜åœ¨ä¸€ä¸ªå®‰å…¨åºåˆ—ä½¿æ‰€æœ‰è¿›ç¨‹éƒ½èƒ½æ‰§è¡Œå®Œå¹¶æ”¶å›æ‰€æœ‰èµ„æºã€‚ä¸å®‰å…¨çŠ¶æ€æ˜¯ä¸å­˜åœ¨è¿™æ ·çš„å®‰å…¨åºåˆ—ï¼Œå³æœ‰å¯èƒ½è¿›å…¥æ­»é”çŠ¶æ€ã€‚åœ¨èµ„æºåˆ†é…æ—¶ï¼Œåº”è¯¥å…ˆå¯¹èµ„æºè¿›è¡Œé¢„åˆ†é…ï¼Œè‹¥è¯¥åˆ†é…ä¼šä½¿ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œåˆ™æ‹’ç»æ­¤åˆ†é…ã€‚ 21. é“¶è¡Œå®¶ç®—æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå±äºä»€ä¹ˆç­–ç•¥ï¼Ÿæ¯ä¸€æ¬¡åˆ†é…ä¹‹å‰éƒ½è¿›è¡Œé¢„åˆ†é…å’Œå®‰å…¨æ€§è¯„ä¼°æ¥å†³å®šæ˜¯å¦è¿›è¡Œæ­¤åˆ†é… å±äºæ­»é”é¿å…ç­–ç•¥ã€‚ 22. é“¶è¡Œå®¶ç®—æ³•ä¸å®‰å…¨æ£€æµ‹ç®—æ³•çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿå®‰å…¨æ£€æµ‹ç®—æ³•æ˜¯é“¶è¡Œå®¶ç®—æ³•çš„æ ¸å¿ƒã€‚ 23. é“¶è¡Œå®¶ç®—æ³•çš„å¼€é”€å’Œå¯¹èµ„æºçš„åˆ©ç”¨ç‡å¦‚ä½•ï¼Ÿé“¶è¡Œå®¶ç®—æ³•çš„å¼€é”€è¾ƒé«˜ï¼Œå› ä¸ºè¦ä¸æ–­è¿›è¡Œé¢„åˆ†é…å’Œå®‰å…¨æ£€æµ‹ï¼Œèµ„æºåˆ©ç”¨ç‡è¾ƒé«˜ã€‚ 24. ä»æ­»é”å¿…è¦æ¡ä»¶çš„è§’åº¦è§£é‡Šèµ„æºé¢„å…ˆåˆ†é…æ³•. èµ„æºæš‚æ—¶é‡Šæ”¾æ³•. èµ„æºæœ‰åºä½¿ç”¨æ³•. é“¶è¡Œå®¶ç®—æ³•ç­‰æ˜¯å¦‚ä½•é¢„é˜²æˆ–é¿å…æ­»é”å‘ç”Ÿçš„ï¼Ÿ é¢„å…ˆåˆ†é…æ³•ç ´åäº†éƒ¨åˆ†åˆ†é…æ¡ä»¶ èµ„æºæš‚æ—¶é‡Šæ”¾æ³•ç ´åäº†ä¸å‰¥å¤ºæ¡ä»¶ èµ„æºæœ‰åºä½¿ç”¨æ³•ç ´åäº†ç¯è·¯æ¡ä»¶ é“¶è¡Œå®¶ç®—æ³•ç ´ç¯äº†ç¯è·¯æ¡ä»¶ 25. ç®€å•å™è¿°é“¶è¡Œå®¶ç®—æ³•çš„æ€æƒ³ï¼Ÿ ç³»ç»Ÿä¸­çš„æ‰€æœ‰è¿›ç¨‹è¿›å…¥è¿›ç¨‹é›†åˆ, åœ¨å®‰å…¨çŠ¶æ€ä¸‹ç³»ç»Ÿæ”¶åˆ°è¿›ç¨‹çš„èµ„æºè¯·æ±‚å,å…ˆæŠŠèµ„æºè¯•æ¢æ€§åˆ†é…ç»™å®ƒã€‚ ç³»ç»Ÿç”¨å‰©ä¸‹çš„å¯ç”¨èµ„æºå’Œè¿›ç¨‹é›†åˆä¸­å…¶ä»–è¿›ç¨‹è¿˜è¦çš„èµ„æºæ•°ä½œæ¯”è¾ƒï¼Œåœ¨è¿›ç¨‹é›†åˆä¸­æ‰¾åˆ°å‰©ä½™èµ„æºèƒ½æ»¡è¶³æœ€å¤§éœ€æ±‚é‡çš„è¿›ç¨‹,ä»è€Œ,ä¿è¯è¿™ä¸ªè¿›ç¨‹è¿è¡Œå®Œæ¯•å¹¶å½’è¿˜å…¨éƒ¨èµ„æºã€‚ æŠŠè¿™ä¸ªè¿›ç¨‹ä»é›†åˆä¸­å»æ‰, ç³»ç»Ÿçš„å‰©ä½™èµ„æºæ›´å¤šäº†,åå¤æ‰§è¡Œä¸Šè¿°æ­¥éª¤ã€‚ æœ€å,æ£€æŸ¥è¿›ç¨‹é›†åˆ,è‹¥ä¸ºç©ºè¡¨æ˜æœ¬æ¬¡ç”³è¯·å¯è¡Œ,ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€,å¯å®æ–½æœ¬æ¬¡åˆ†é…;å¦åˆ™,æœ‰è¿›ç¨‹æ‰§è¡Œä¸å®Œï¼Œç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€,æœ¬æ¬¡èµ„æºåˆ†é…æš‚ä¸å®æ–½,è®©ç”³è¯·è¿›ç¨‹ç­‰å¾…ã€‚ 26. ä½•ä¸ºèµ„æºåˆ†é…å›¾ï¼Ÿ çº¦å®šPiâ†’Rjä¸ºè¯·æ±‚è¾¹ï¼Œè¡¨ç¤ºè¿›ç¨‹Piç”³è¯·èµ„æºç±»Rjä¸­çš„ä¸€ä¸ªèµ„æºå¾—ä¸åˆ°æ»¡è¶³è€Œå¤„äºç­‰å¾…Rjç±»èµ„æºçš„çŠ¶æ€ï¼Œè¯¥æœ‰å‘è¾¹ä»è¿›ç¨‹å¼€å§‹æŒ‡åˆ°æ–¹æ¡†çš„è¾¹ç¼˜ï¼Œè¡¨ç¤ºè¿›ç¨‹Piç”³è¯·Rjç±»ä¸­çš„ä¸€ä¸ªèµ„æºã€‚ Rjâ†’Piä¸ºåˆ†é…è¾¹ï¼Œè¡¨ç¤ºRjç±»ä¸­çš„ä¸€ä¸ªèµ„æºå·²è¢«è¿›ç¨‹Piå ç”¨ï¼Œç”±äºå·²æŠŠä¸€ä¸ªå…·ä½“çš„èµ„æºåˆ†ç»™äº†è¿›ç¨‹Piï¼Œæ•…è¯¥æœ‰å‘è¾¹ä»æ–¹æ¡†å†…çš„æŸä¸ªé»‘åœ†ç‚¹å‡ºå‘æŒ‡å‘è¿›ç¨‹ã€‚ 27. ä½•ä¸ºæ­»é”å®šç†ï¼Ÿ å¦‚æœèƒ½åœ¨è¿›ç¨‹-èµ„æºåˆ†é…å›¾ä¸­æ¶ˆå»æ­¤è¿›ç¨‹çš„æ‰€æœ‰è¯·æ±‚è¾¹å’Œåˆ†é…è¾¹ï¼Œæˆä¸ºå­¤ç«‹ç»“ç‚¹ã€‚ç»ä¸€ç³»åˆ—ç®€åŒ–ï¼Œä½¿æ‰€æœ‰è¿›ç¨‹æˆä¸ºå­¤ç«‹ç»“ç‚¹ï¼Œåˆ™è¯¥å›¾æ˜¯å¯å®Œå…¨ç®€åŒ–çš„ï¼›å¦åˆ™åˆ™ç§°è¯¥å›¾æ˜¯ä¸å¯å®Œå…¨ç®€åŒ–çš„ã€‚ ç³»ç»Ÿä¸ºæ­»é”çŠ¶æ€çš„å……åˆ†æ¡ä»¶æ˜¯ï¼šå½“ä¸”ä»…å½“è¯¥çŠ¶æ€çš„è¿›ç¨‹-èµ„æºåˆ†é…å›¾æ˜¯ä¸å¯å®Œå…¨ç®€åŒ–çš„ã€‚è¯¥å……åˆ†æ¡ä»¶ç§°ä¸ºæ­»é”å®šç†ã€‚ 28. ä¸ºä½•ä»èµ„æºåˆ†é…å›¾èƒ½å¦åŒ–ç®€å°±èƒ½åˆ¤æ–­æ­»é”çš„æƒ…å½¢ï¼Ÿå›¾ä¸èƒ½åŒ–ç®€æ˜¯å¦å°±è¯´æ˜æœºå™¨å­˜åœ¨æ­»é”ï¼Ÿå› ä¸ºå¯¹èµ„æºåˆ†é…å›¾è¿›è¡Œç®€åŒ–å°±ç›¸å½“äºè®©ä¸€ä¸ªè¿›ç¨‹è·å¾—è¶³å¤Ÿçš„èµ„æºï¼Œåœ¨æœ‰é™æ—¶é—´å†…æ‰§è¡Œå®Œå¹¶é‡Šæ”¾èµ„æºã€‚è‹¥ä¸èƒ½å®Œå…¨åŒ–ç®€ï¼Œå°±æ„å‘³ç€æ²¡æœ‰æ–¹æ³•è®©è¿›ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œå¹¶æ”¶å›èµ„æºï¼Œç³»ç»Ÿæ­¤æ—¶æ˜¯æ­»é”çŠ¶æ€ã€‚ 29. æ­»é”æ£€æµ‹ç®—æ³•çš„ç†è®ºåŸºç¡€æ˜¯ä»€ä¹ˆï¼Ÿç†è®ºåŸºç¡€å°±æ˜¯æ¨¡æ‹Ÿèµ„æºåˆ†é…å›¾çš„åŒ–ç®€è¿‡ç¨‹ï¼Œè‹¥ä¸èƒ½å®Œå…¨åŒ–ç®€ï¼Œåˆ™è¿›å…¥æ­»é”çŠ¶æ€ã€‚ 30. æ­»é”å¦‚ä½•è§£é™¤ï¼Ÿè°ˆè°ˆè§£é™¤æ­»é”çš„ä»£ä»·ï¼Ÿ ç»“æŸæ‰€æœ‰è¿›ç¨‹çš„æ‰§è¡Œï¼Œé‡æ–°å¯åŠ¨æ“ä½œç³»ç»Ÿã€‚æ–¹æ³•ç®€å•ï¼Œä½†ä»¥å‰å·¥ä½œå…¨éƒ¨ä½œåºŸï¼ŒæŸå¤±å¾ˆå¤§ã€‚ æ’¤é”€é™·äºæ­»é”çš„æ‰€æœ‰è¿›ç¨‹ï¼Œè§£é™¤æ­»é”ç»§ç»­è¿è¡Œã€‚ é€ä¸ªæ’¤é”€é™·äºæ­»é”çš„è¿›ç¨‹ï¼Œå›æ”¶å…¶èµ„æºé‡æ–°åˆ†æ´¾ï¼Œç›´è‡³æ­»é”è§£é™¤ã€‚ å‰¥å¤ºé™·äºæ­»é”çš„è¿›ç¨‹å ç”¨çš„èµ„æºï¼Œä½†å¹¶ä¸æ’¤é”€å®ƒï¼Œç›´è‡³æ­»é”è§£é™¤ã€‚å¯ç…§æ’¤é”€é™·äºæ­»é”è¿›ç¨‹çš„æ¡ä»¶æ¥é€‰æ‹©å‰¥å¤ºèµ„æºçš„è¿›ç¨‹ æ ¹æ®ç³»ç»Ÿä¿å­˜çš„æ£€æŸ¥ç‚¹ï¼Œè®©æ‰€æœ‰è¿›ç¨‹å›é€€ï¼Œç›´åˆ°è¶³ä»¥è§£é™¤æ­»é”ï¼Œè¿™ç§æªæ–½è¦æ±‚ç³»ç»Ÿå»ºç«‹ä¿å­˜æ£€æŸ¥ç‚¹. å›é€€åŠé‡å¯æœºåˆ¶ã€‚ å½“æ£€æµ‹åˆ°æ­»é”æ—¶ï¼Œå¦‚æœå­˜åœ¨æŸäº›æœªå·å…¥æ­»é”çš„è¿›ç¨‹ï¼Œè€Œéšç€è¿™äº›è¿›ç¨‹æ‰§è¡Œåˆ°ç»“æŸï¼Œæœ‰å¯èƒ½é‡Šæ”¾è¶³å¤Ÿçš„èµ„æºæ¥è§£é™¤æ­»é”ã€‚ ç¬¬å››ç«  1. ç«‹ä½“ï¼ˆå¤šçº§ï¼‰å­˜å‚¨ä½“ç³»æŒ‡å•¥ï¼Ÿä¸ºä½•è¦è¿›è¡Œé‡å®šä½ï¼Ÿä¸ºä½•è¦è¿›è¡Œåœ°å€æ˜ å°„?ç«‹ä½“ï¼ˆå¤šçº§ï¼‰å­˜å‚¨ä½“ç³»æŒ‡ç”±å¯„å­˜å™¨. é«˜é€Ÿç¼“å­˜. å†…å­˜å‚¨å™¨. ç£ç›˜ç¼“å­˜. å›ºå®šç£ç›˜. å¯ç§»åŠ¨å­˜å‚¨ä»‹è´¨ç»„æˆçš„ä¸€ä¸ªå­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ã€‚ 2. ä»å•é“åˆ°ç°ä»£OSçš„è™šæ‹Ÿå†…å­˜ç®¡ç†è¿™ä¸€å‘å±•çº¿æ¡ï¼Ÿä½ æ¥çºµè®ºä¸€ä¸‹ï¼Ÿ OSæœ€åˆçš„å•ä»»åŠ¡ç³»ç»Ÿ OSä»å•ä»»åŠ¡å¤„ç†å˜ä¸ºå¤šä»»åŠ¡å¹¶è¡Œå¤„ç† MMUçš„å¼€å§‹ä½¿ç”¨ è™šæ‹Ÿå†…å­˜æ¦‚å¿µçš„å‡ºç° 3. ä½ èƒ½å¦è¯´æ¸…ä¸€ç§å†…å­˜ç®¡ç†æ€æƒ³çš„åŸç†åŠå…¶åœ°å€æ˜ å°„è¿‡ç¨‹ï¼ˆå¦‚ï¼šè™šæ‹Ÿåˆ†é¡µï¼‰ï¼Ÿ4. è¿™äº›æ¦‚å¿µæŒ‡å•¥ï¼šå¿«è¡¨å‘½ä¸­ï¼Œé¡µå†…é›¶å¤´ï¼Œæ·˜æ±°ç®—æ³•ï¼ŒæŠ–åŠ¨ï¼Œç¢ç‰‡ï¼Œç´§å‡‘ï¼Œé¡µæ•…éšœç‡ã€‚å¿«è¡¨å‘½ä¸­å½“æŠŠé¡µå·äº¤ç»™å¿«è¡¨åï¼Œå®ƒé€šè¿‡å¹¶è¡ŒåŒ¹é…åŒæ—¶å¯¹æ‰€æœ‰å¿«è¡¨é¡¹è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™ä¸ºå¿«è¡¨å‘½ä¸­ã€‚ é¡µå†…é›¶å¤´åœ¨é¡µé‡Œé¢ç”¨æˆ·æ²¡æœ‰åˆ©ç”¨çš„éƒ¨åˆ†ã€‚ æ·˜æ±°ç®—æ³•ä¸€ä¸ªå°†å¿«è¡¨æˆ–é¡µè¡¨é‡Œå°†æŸä¸€é¡µæ·˜æ±°æ‰å¹¶è£…å…¥æ–°çš„é¡µçš„ç®—æ³•ã€‚ æŠ–åŠ¨å½“å­˜å‚¨ç®¡ç†æ–¹å¼é‡‡ç”¨é¡µå¼å­˜å‚¨æ—¶ï¼Œç¼“å­˜ä¸­çš„é¡µéœ€è¦å¯èƒ½è¢«æ›¿æ¢ï¼Œä¸‹æ¬¡è¦ä½¿ç”¨çš„é¡µåœ¨è¿™å›å´æ›¿æ¢å‡ºå»äº†ï¼Œè¿™æ ·çš„ç°è±¡å°±ç§°ä¸ºæŠ–åŠ¨ã€‚å°±ä¼šä½¿å¾—åˆšè¢«æ›¿æ¢å‡ºå»çš„é¡µåˆè¦é‡æ–°åŠ è½½ã€‚ ç¢ç‰‡æŒ‡æ“ä½œç³»ç»Ÿåœ¨å†…å­˜åˆ†é…è¿‡ç¨‹ä¸­ï¼Œé—ç•™ä¸‹æ¥çš„ä¸èƒ½è¢«åˆ©ç”¨åˆ°çš„å†…å­˜åŒºåŸŸã€‚å†…å­˜ç¢ç‰‡å¯¼è‡´éƒ¨åˆ†å†…å­˜è¢«æµªè´¹ï¼Œå¤§é‡çš„å†…å­˜ç¢ç‰‡ä¹Ÿä¼šå½±å“åˆ°ç³»ç»Ÿçš„æ€§èƒ½ã€‚ ç´§å‡‘å°†å†…å­˜ç©ºé—²åŒºåŸŸé›†ä¸­åœ¨å†…å­˜çš„ä¸€ç«¯æ‹¼æ¥æˆä¸€ä¸ªè¾ƒå¤§çš„ç©ºé—²åˆ†åŒºï¼Œè¿™ç§æ–¹æ³•æˆä¸ºç´§å‡‘ã€‚ é¡µæ•…éšœç‡å‘ç”Ÿç¼ºé¡µä¸­æ–­çš„æ¯”ç‡ã€‚ 5. å†…å­˜åœ°å€æ˜ å°„è¿‡ç¨‹ä¸ºä½•è¦å¼•å…¥ç¡¬ä»¶å¯„å­˜å™¨ï¼Ÿå®ƒä¸é¡µè¡¨. æ®µè¡¨. å¿«è¡¨. è¿›ç¨‹è¡¨åœ¨æ•°é‡è®¾ç½®ä¸Šæœ‰ä½•å…³ç³»ï¼Ÿå†…å®¹å‘¢ï¼Œä½•æ—¶è£…å…¥ï¼Ÿå¼•å…¥ç¡¬ä»¶å¯„å­˜å™¨ä¸ºäº†å‡å°‘å†…å­˜è®¿é—®æ¬¡æ•°ï¼Œæé«˜è®¿é—®æ•ˆç‡ã€‚ é¡µè¡¨åªæœ‰ä¸€ä¸ªï¼Œåªæœ‰å ç”¨CPUçš„è¿›ç¨‹æ‰å æœ‰å®ƒã€‚ æ¯ä¸ªç”¨æˆ·ä½œä¸šéƒ½æœ‰è‡ªå·±çš„æ®µè¡¨ã€‚ å¿«è¡¨åªæœ‰ä¸€ä¸ªï¼Œå­˜æœ€è¿‘è®¿é—®çš„é¡µè¡¨é¡¹ã€‚ è¿›ç¨‹è¡¨åªæœ‰ä¸€ä¸ªï¼Œå­˜è¿›ç¨‹ä¿¡æ¯ã€‚ é¡µè¡¨ä¸­å­˜æ”¾çš„æ˜¯é¡µæ¡†çš„é€»è¾‘åœ°å€ï¼Œåœ¨æœ‰æ–°é¡µæ¡†åˆ›å»ºæ—¶è£…å…¥ã€‚ æ®µè¡¨ä¸­å­˜æ”¾çš„æ˜¯æ®µçš„é€»è¾‘åœ°å€ï¼Œåœ¨æœ‰æ–°æ®µåˆ›å»ºæ—¶è£…å…¥ã€‚ å¿«è¡¨å­˜çš„æ˜¯å¸¸ç”¨é¡µæ¡†çš„é€»è¾‘åœ°å€ï¼Œåœ¨æ·˜æ±°é¡µæ¡†å¹¶æ›´æ–°å¿«è¡¨æ—¶è£…å…¥ã€‚ è¿›ç¨‹è¡¨å­˜çš„æ˜¯æ­£åœ¨è¿è¡Œæˆ–å°±ç»ªçš„è¿›ç¨‹ä¿¡æ¯ï¼Œåœ¨åˆ›å»ºè¿›ç¨‹æ—¶è£…å…¥ã€‚ ç¬¬äº”ç«  1. è®¾å¤‡é©±åŠ¨æŒ‡ä»€ä¹ˆï¼Ÿæ˜¯å¦æ˜¯OSçš„ä¸€éƒ¨åˆ†ï¼Ÿä¸ºä½•ä½¿ç”¨è®¾å¤‡æ—¶éœ€è¦å®‰è£…é©±åŠ¨ï¼Ÿä¸èƒ½äº‹å…ˆé›†æˆå…¥å—ï¼Ÿ è®¾å¤‡é©±åŠ¨ç¨‹åºåŒ…æ‹¬ä¸è®¾å¤‡å¯†åˆ‡ç›¸å…³çš„æ‰€æœ‰ä»£ç ï¼Œå…¶ä»»åŠ¡æ˜¯æŠŠç”¨æˆ·æäº¤çš„é€»è¾‘I/Oè¯·æ±‚è½¬åŒ–ä¸ºç‰©ç†I/Oæ“ä½œçš„å¯åŠ¨å’Œæ‰§è¡Œï¼›åŒæ—¶ï¼Œç›‘ç£è®¾å¤‡æ˜¯å¦æ­£ç¡®æ‰§è¡Œï¼Œç®¡ç†æ•°æ®ç¼“å†²åŒºï¼Œè¿›è¡Œå¿…è¦çš„çº é”™å¤„ç†ã€‚ ç¬¼ç»Ÿåœ°è¯´ï¼Œè®¾å¤‡é©±åŠ¨ç¨‹åºçš„åŠŸèƒ½æ˜¯ä»ç‹¬ç«‹äºè®¾å¤‡çš„è½¯ä»¶ä¸­æ¥æ”¶å¹¶æ‰§è¡ŒI/Oè¯·æ±‚ã€‚ è®¾å¤‡é©±åŠ¨æ˜¯OSçš„ä¸€éƒ¨åˆ† é©±åŠ¨è´Ÿè´£æ²Ÿé€šå¯¹åº”çš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿï¼Œæ˜¯ä¸¤è€…ä¹‹é—´çš„æ¡¥æ¢ï¼Œä¸å®‰è£…é©±åŠ¨çš„è¯æ“ä½œç³»ç»Ÿåˆ™æ— æ³•è¯†åˆ«å¯¹åº”çš„ç¡¬ä»¶è®¾å¤‡ å¯ä»¥äº‹å…ˆé›†æˆè®¾å¤‡é©±åŠ¨ 2. CPUå¦‚ä½•å®ç°å¯¹è®¾å¤‡çš„æ§åˆ¶ï¼Ÿæœ‰å“ªäº›æ–¹å¼ï¼Ÿå„ç§æ–¹å¼çš„ç‰¹ç‚¹ä¸åŸç†ï¼Ÿè®¾å¤‡ï¼ˆå¦‚ç¡¬ç›˜ï¼‰è¦ä¸å†…å­˜ä¼ æ•°ï¼Œéš¾é“ä¸å’ŒCPUå†²çªå—ï¼Ÿ æŒ‰ç…§I/Oæ§åˆ¶å™¨åŠŸèƒ½çš„å¼ºå¼±ä»¥åŠå®ƒå’ŒCPUä¹‹é—´è”ç³»æ–¹å¼çš„ä¸åŒï¼Œå¯ä»¥æŠŠè®¾å¤‡æ§åˆ¶æ–¹å¼åˆ†ä¸ºè½®è¯¢. ä¸­æ–­. DMA. å’Œé€šé“4ç±»ã€‚ å®ƒä»¬ä¹‹é—´çš„å·®åˆ«åœ¨äºCPUå’Œè®¾å¤‡å¹¶è¡Œå·¥ä½œçš„æ–¹å¼å’Œç¨‹åº¦ä¸åŒã€‚ è½®è¯¢æ–¹å¼ è½®è¯¢æ–¹å¼åˆç§°ç¨‹åºç›´æ¥æ§åˆ¶æ–¹å¼ï¼Œä½¿ç”¨æŸ¥è¯¢æŒ‡ä»¤æµ‹è¯•è®¾å¤‡æ§åˆ¶å™¨çš„å¿™é—²çŠ¶æ€ä½ï¼Œç¡®å®šå†…å­˜å’Œè®¾å¤‡æ˜¯å¦èƒ½äº¤æ¢æ•°æ®ã€‚ è½®è¯¢æ–¹å¼ä½¿ç”¨ä¸‰æ¡æŒ‡ä»¤ï¼š æŸ¥è¯¢æŒ‡ä»¤ï¼šæŸ¥è¯¢è®¾å¤‡æ˜¯å¦å°±ç»ªï¼› è¯»å†™æŒ‡ä»¤ï¼šå½“è®¾å¤‡å°±ç»ªæ—¶æ‰§è¡Œæ•°æ®äº¤æ¢ï¼› è½¬ç§»æŒ‡ä»¤ï¼šå½“è®¾å¤‡æœªå°±ç»ªæ—¶æ‰§è¡Œè½¬ç§»æŒ‡ä»¤è½¬å‘æŸ¥è¯¢æŒ‡ä»¤ç»§ç»­æŸ¥è¯¢ï¼› ä¸­æ–­æ–¹å¼-ä¸­æ–­æ–¹å¼è¦æ±‚CPUä¸è®¾å¤‡æ§åˆ¶å™¨åŠè®¾å¤‡ä¹‹é—´å­˜åœ¨ä¸­æ–­è¯·æ±‚çº¿ï¼Œè®¾å¤‡æ§åˆ¶å™¨çš„çŠ¶æ€å¯„å­˜å™¨æœ‰ç›¸åº”çš„ä¸­æ–­å…è®¸ä½ã€‚ DMAæ–¹å¼ åœ¨DMAæ–¹å¼ä¸­ï¼Œå†…å­˜å’Œè®¾å¤‡ä¹‹é—´æœ‰ä¸€æ¡æ•°æ®é€šè·¯æˆå—åœ°ä¼ é€æ•°æ®ï¼Œæ— é¡»CPUå¹²æ‰°ï¼Œå®é™…æ•°æ®ä¼ è¾“æ“ä½œç”±DMAç›´æ¥å®Œæˆã€‚ DMAæ–¹å¼éœ€ä»¥ä¸‹è®¾æ–½ï¼š (1)å†…å­˜åœ°å€å¯„å­˜å™¨ï¼šå­˜æ”¾å†…å­˜ä¸­éœ€è¦äº¤æ¢æ•°æ®çš„åœ°å€ï¼ŒDMAä¼ é€ä¹‹å‰ç”±ç¨‹åºé€å…¥é¦–åœ°å€ï¼›DMAä¼ é€è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡äº¤æ¢æ•°æ®éƒ½æŠŠåœ°å€å¯„å­˜å™¨çš„å†…å®¹åŠ 1ã€‚ (2)å­—è®¡æ•°å™¨ï¼šè®°å½•ä¼ é€æ•°æ®çš„æ€»å­—æ•°ï¼Œæ¯æ¬¡ä¼ é€ä¸€ä¸ªå­—å°±æŠŠå­—è®¡æ•°å™¨å‡1ã€‚ (3)æ•°æ®ç¼“å†²å¯„å­˜å™¨æˆ–æ•°æ®ç¼“å†²åŒºï¼šæš‚å­˜æ¯æ¬¡ä¼ é€çš„æ•°æ®ã€‚ (4)è®¾å¤‡åœ°å€å¯„å­˜å™¨ï¼šå­˜æ”¾I/Oä¿¡æ¯çš„åœ°å€ï¼Œå¦‚ç£ç›˜çš„æŸ±é¢å·. ç£å¤´å·. æ‰‡åŒºå·ã€‚ (5)ä¸­æ–­æœºåˆ¶å’Œæ§åˆ¶é€»è¾‘ï¼šç”¨äºå‘CPUæå‡ºI/Oä¸­æ–­è¯·æ±‚åŠä¿å­˜CPUå‘æ¥çš„I/Oã€‚ é€šé“æ–¹å¼ é‡‡ç”¨é€šé“åçš„I/Oæ“ä½œè¿‡ç¨‹ï¼šCPUåœ¨æ‰§è¡Œä¸»ç¨‹åºæ—¶é‡åˆ°I/Oè¯·æ±‚ï¼Œå®ƒå¯åŠ¨æŒ‡å®šé€šé“ä¸Šé€‰å€çš„å¤–å›´è®¾å¤‡ï¼Œä¸€æ—¦å¯åŠ¨æˆåŠŸï¼Œé€šé“å¼€å§‹æ§åˆ¶å¤–å›´è®¾å¤‡è¿›è¡Œæ“ä½œã€‚CPUå°±å¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡å¹¶ä¸é€šé“å¹¶è¡Œå·¥ä½œï¼Œç›´åˆ°I/Oæ“ä½œå®Œæˆã€‚é€šé“å‘å‡ºæ“ä½œç»“æŸä¸­æ–­æ—¶ï¼ŒCPUæ‰åœæ­¢å½“å‰å·¥ä½œï¼Œè½¬å‘å¤„ç†I/Oæ“ä½œç»“æŸäº‹ä»¶ã€‚ 3. OSçš„è®¾å¤‡ç®¡ç†I/Oå­ç³»ç»Ÿå·¥ä½œæœºåˆ¶å¦‚ä½•ï¼Ÿè¯·ä»¥ç¼ºé¡µä¸­æ–­ä¸ºä¾‹åŠ ä»¥è¯´æ˜ï¼ŸI/Oæ“ä½œæ‰§è¡Œæ­¥éª¤ è¿›ç¨‹å¯¹å·²æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦æ‰§è¡Œè¯»åº“å‡½æ•°ï¼› ç‹¬ç«‹è®¾å¤‡I/Oè½¯ä»¶æ£€æŸ¥å‚æ•°æ­£ç¡®æ€§ã€‚é«˜é€Ÿç¼“å­˜ä¸­æœ‰è¦è¯»çš„ä¿¡æ¯å—ï¼Œä»ç¼“å†²åŒºç›´æ¥è¯»åˆ°ç”¨æˆ·åŒºï¼Œå®ŒæˆI/Oè¯·æ±‚ï¼› è‹¥æ•°æ®ä¸åœ¨ç¼“å†²åŒºï¼Œæ‰§è¡Œç‰©ç†I/Oï¼Œå®ç°å°†è®¾å¤‡é€»è¾‘åè½¬æ¢æˆç‰©ç†åï¼Œæ£€æŸ¥å¯¹è®¾å¤‡æ“ä½œçš„æƒé™ï¼Œå°†I/Oè¯·æ±‚æ’é˜Ÿï¼Œé˜»å¡è¿›ç¨‹ä¸”ç­‰å¾…I/Oå®Œæˆï¼› å†…æ ¸å¯åŠ¨è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œåˆ†é…å­˜æ”¾è¯»å‡ºå—çš„ç¼“å†²åŒºï¼Œå‡†å¤‡æ¥æ”¶æ•°æ®ï¼Œä¸”å‘è®¾å¤‡æ§åˆ¶å¯„å­˜å™¨å‘å¯åŠ¨å‘½ä»¤ï¼Œæˆ–å»ºç«‹DMAä¼ è¾“ï¼Œå¯åŠ¨I/Oï¼› è®¾å¤‡æ§åˆ¶å™¨æ“ä½œè®¾å¤‡ï¼Œæ‰§è¡Œæ•°æ®ä¼ è¾“ï¼› DMAæ§åˆ¶å™¨æ§åˆ¶ä¸€å—ä¼ è¾“å®Œæˆï¼Œç¡¬ä»¶äº§ç”ŸI/Oç»“æŸä¸­æ–­ï¼› CPUå“åº”ä¸­æ–­ï¼Œè½¬å‘ç£ç›˜ä¸­æ–­å¤„ç†ç¨‹åºã€‚ å½“åº”ç”¨è¿›ç¨‹è¢«å†æ¬¡è°ƒåº¦æ‰§è¡Œæ—¶ï¼Œä»I/Oç³»ç»Ÿè°ƒç”¨çš„æ–­ç‚¹æ¢å¤æ‰§è¡Œã€‚ ç¼ºé¡µå¼‚å¸¸å¤„ç†è¿‡ç¨‹ ç¼ºé¡µå¼‚å¸¸æ˜¯ç”±äºå‘ç°å½“å‰è®¿é—®é¡µé¢ä¸åœ¨å†…å­˜æ—¶ç”±ç¡¬ä»¶æ‰€äº§ç”Ÿçš„ä¸€ç§ç‰¹æ®Šä¸­æ–­ä¿¡å·ï¼Œæ˜¯åœ¨æŒ‡ä»¤æ‰§è¡ŒæœŸé—´äº§ç”Ÿå¹¶ç”±ç³»ç»Ÿå¤„ç†çš„ã€‚ **ç¼ºé¡µæœ¬èº«æ˜¯ä¸€ç§ä¸­æ–­ï¼Œä¸ä¸€èˆ¬çš„ä¸­æ–­ä¸€æ ·ï¼Œéœ€è¦ç»è¿‡4ä¸ªå¤„ç†æ­¥éª¤ï¼š ** ä¿æŠ¤CPUç°åœº åˆ†æä¸­æ–­åŸå›  è½¬å…¥ç¼ºé¡µä¸­æ–­å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç† æ¢å¤CPUç°åœºï¼Œç»§ç»­æ‰§è¡Œ **ä½†æ˜¯ç¼ºé¡µä¸­æ–­æ—¶ç”±äºæ‰€è¦è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨å†…å­˜æ—¶ï¼Œæœ‰ç¡¬ä»¶æ‰€äº§ç”Ÿçš„ä¸€ç§ç‰¹æ®Šçš„ä¸­æ–­ï¼Œå› æ­¤ï¼Œä¸ä¸€èˆ¬çš„ä¸­æ–­å­˜åœ¨åŒºåˆ«ï¼š ** åœ¨æŒ‡ä»¤æ‰§è¡ŒæœŸé—´äº§ç”Ÿå’Œå¤„ç†ç¼ºé¡µä¸­æ–­ä¿¡å· ä¸€æ¡æŒ‡ä»¤åœ¨æ‰§è¡ŒæœŸé—´ï¼Œå¯èƒ½äº§ç”Ÿå¤šæ¬¡ç¼ºé¡µä¸­æ–­ ç¼ºé¡µä¸­æ–­è¿”å›æ—¶ï¼Œæ‰§è¡Œäº§ç”Ÿä¸­æ–­çš„é‚£ä¸€æ¡æŒ‡ä»¤ï¼Œè€Œä¸€èˆ¬çš„ä¸­æ–­è¿”å›æ—¶ï¼Œæ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ ç¼ºé¡µå¼‚å¸¸çš„æ•´ä¸ªè¿‡ç¨‹ é¦–å…ˆç¡¬ä»¶ä¼šé™·å…¥å†…æ ¸ï¼Œåœ¨å †æ ˆä¸­ä¿å­˜ç¨‹åºè®¡æ•°å™¨ã€‚å¤§å¤šæ•°æœºå™¨å°†å½“å‰æŒ‡ä»¤çš„å„ç§çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨CPUä¸­ç‰¹æ®Šçš„å¯„å­˜å™¨ä¸­ã€‚ å¯åŠ¨ä¸€ä¸ªæ±‡ç¼–ä»£ç ä¾‹ç¨‹ä¿å­˜é€šç”¨å¯„å­˜å™¨åŠå…¶å®ƒæ˜“å¤±æ€§ä¿¡æ¯ï¼Œä»¥å…è¢«æ“ä½œç³»ç»Ÿç ´åã€‚è¿™ä¸ªä¾‹ç¨‹å°†æ“ä½œç³»ç»Ÿä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚ï¼ˆåœ¨é¡µé¢æ¢å…¥æ¢å‡ºçš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‘ç”Ÿä¸Šä¸‹æ–‡æ¢è¡Œï¼Œå¯¼è‡´ç ´åå½“å‰ç¨‹åºè®¡æ•°å™¨åŠé€šç”¨å¯„å­˜å™¨ä¸­æœ¬è¿›ç¨‹çš„ä¿¡æ¯ï¼‰ å½“æ“ä½œç³»ç»Ÿå‘ç°æ˜¯ä¸€ä¸ªé¡µé¢ä¸­æ–­æ—¶ï¼ŒæŸ¥æ‰¾å‡ºæ¥å‘ç”Ÿé¡µé¢ä¸­æ–­çš„è™šæ‹Ÿé¡µé¢ï¼ˆè¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„é¡µé¢ï¼‰ã€‚è¿™ä¸ªè™šæ‹Ÿé¡µé¢çš„ä¿¡æ¯é€šå¸¸ä¼šä¿å­˜åœ¨ä¸€ä¸ªç¡¬ä»¶å¯„å­˜å™¨ä¸­ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»æ£€ç´¢ç¨‹åºè®¡æ•°å™¨ï¼Œå–å‡ºè¿™æ¡æŒ‡ä»¤ï¼Œç”¨è½¯ä»¶åˆ†æè¯¥æŒ‡ä»¤ï¼Œé€šè¿‡åˆ†ææ‰¾å‡ºå‘ç”Ÿé¡µé¢ä¸­æ–­çš„è™šæ‹Ÿé¡µé¢ã€‚ æ£€æŸ¥è™šæ‹Ÿåœ°å€çš„æœ‰æ•ˆæ€§åŠå®‰å…¨ä¿æŠ¤ä½ã€‚å¦‚æœå‘ç”Ÿä¿æŠ¤é”™è¯¯ï¼Œåˆ™æ€æ­»è¯¥è¿›ç¨‹ã€‚ æ“ä½œç³»ç»ŸæŸ¥æ‰¾ä¸€ä¸ªç©ºé—²çš„é¡µæ¡†(ç‰©ç†å†…å­˜ä¸­çš„é¡µé¢)ï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²é¡µæ¡†åˆ™éœ€è¦é€šè¿‡é¡µé¢ç½®æ¢ç®—æ³•æ‰¾åˆ°ä¸€ä¸ªéœ€è¦æ¢å‡ºçš„é¡µæ¡†ã€‚ å¦‚æœæ‰¾çš„é¡µæ¡†ä¸­çš„å†…å®¹è¢«ä¿®æ”¹äº†ï¼Œåˆ™éœ€è¦å°†ä¿®æ”¹çš„å†…å®¹ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œæ­¤æ—¶ä¼šå¼•èµ·ä¸€ä¸ªå†™ç£ç›˜è°ƒç”¨ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆåœ¨ç­‰å¾…ç£ç›˜å†™çš„è¿‡ç¨‹ä¸­è®©å…¶å®ƒè¿›ç¨‹è¿è¡Œï¼‰ã€‚ï¼ˆæ³¨ï¼šæ­¤æ—¶éœ€è¦å°†é¡µæ¡†ç½®ä¸ºå¿™çŠ¶æ€ï¼Œä»¥é˜²é¡µæ¡†è¢«å…¶å®ƒè¿›ç¨‹æŠ¢å æ‰ï¼‰ é¡µæ¡†å¹²å‡€åï¼Œæ“ä½œç³»ç»Ÿæ ¹æ®è™šæ‹Ÿåœ°å€å¯¹åº”ç£ç›˜ä¸Šçš„ä½ç½®ï¼Œå°†ä¿æŒåœ¨ç£ç›˜ä¸Šçš„é¡µé¢å†…å®¹å¤åˆ¶åˆ°â€œå¹²å‡€â€çš„é¡µæ¡†ä¸­ï¼Œæ­¤æ—¶ä¼šå¼•èµ·ä¸€ä¸ªè¯»ç£ç›˜è°ƒç”¨ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ å½“ç£ç›˜ä¸­çš„é¡µé¢å†…å®¹å…¨éƒ¨è£…å…¥é¡µæ¡†åï¼Œå‘æ“ä½œç³»ç»Ÿå‘é€ä¸€ä¸ªä¸­æ–­ã€‚æ“ä½œç³»ç»Ÿæ›´æ–°å†…å­˜ä¸­çš„é¡µè¡¨é¡¹ï¼Œå°†è™šæ‹Ÿé¡µé¢æ˜ å°„çš„é¡µæ¡†å·æ›´æ–°ä¸ºå†™å…¥çš„é¡µæ¡†ï¼Œå¹¶å°†é¡µæ¡†æ ‡è®°ä¸ºæ­£å¸¸çŠ¶æ€ã€‚ æ¢å¤ç¼ºé¡µä¸­æ–­å‘ç”Ÿå‰çš„çŠ¶æ€ï¼Œå°†ç¨‹åºæŒ‡ä»¤å™¨é‡æ–°æŒ‡å‘å¼•èµ·ç¼ºé¡µä¸­æ–­çš„æŒ‡ä»¤ã€‚ è°ƒåº¦å¼•èµ·é¡µé¢ä¸­æ–­çš„è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿè¿”å›æ±‡ç¼–ä»£ç ä¾‹ç¨‹ã€‚ æ±‡ç¼–ä»£ç ä¾‹ç¨‹æ¢å¤ç°åœºï¼Œå°†ä¹‹å‰ä¿å­˜åœ¨é€šç”¨å¯„å­˜å™¨ä¸­çš„ä¿¡æ¯æ¢å¤ã€‚ ç¼ºé¡µä¸­æ–­çš„è¿‡ç¨‹æ¶‰åŠäº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„åˆ‡æ¢ï¼Œè™šæ‹Ÿåœ°å€å’Œç‰©ç†ä¹‹é—´çš„è½¬æ¢ï¼ˆè¿™ä¸ªè½¬æ¢è¿‡ç¨‹éœ€è¦ä½¿ç”¨MMUå’ŒTLBï¼‰ï¼ŒåŒæ—¶æ¶‰åŠäº†å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„è½¬æ¢ã€‚ 4. ç£ç›˜é©±åŠ¨è¿™ä¸€ä¸¾ä¾‹ä¸­ä¸ºä½•è¦æåˆ°â€œè°ƒåº¦ç­–ç•¥â€ï¼Ÿ å¯¹äºç³»ç»Ÿæ€§èƒ½äº§ç”Ÿé‡è¦å½±å“çš„æ˜¯ç£ç›˜I/Oï¼Œä¸ºäº†æé«˜ç£ç›˜I/Oæ€§èƒ½ï¼Œå¹¿ä¸ºä½¿ç”¨çš„æœ‰ä¸¤ç§æ–¹æ³•ï¼šç£ç›˜é©±åŠ¨è°ƒåº¦å’Œç£ç›˜ç¼“å†²åŒºã€‚ ä¸åŒçš„è°ƒåº¦ç­–ç•¥ç®—æ³•å¯¹äºç£ç›˜é©±åŠ¨è°ƒåº¦çš„æ€§èƒ½å½±å“å¾ˆå¤§ï¼Œä»è€Œå¯¹ç£ç›˜I/Oæ€§èƒ½å†åˆ°ç³»ç»Ÿæ•´ä½“æ€§èƒ½è¡¨ç°å½±å“ä¹Ÿå¾ˆå¤§ã€‚ 5. ä¸ºä½•è¦ç”¨åˆ°ç¼“å†²ï¼ŸDMAä¸­çš„ç¼“å†²åŒºä½œç”¨ä¸ºä½•ï¼Ÿä¸ºä½•è¦ç”¨åˆ°ç¼“å†²ï¼Ÿ æ•°æ®ç¦»å¼€è®¾å¤‡ä¹‹åé€šå¸¸ä¸èƒ½ç›´æ¥é€è¾¾ç›®çš„åœ°ï¼Œæ‰€ä»¥å¿…é¡»é€šè¿‡ç¼“å†²åŒºæ¥æ¶ˆé™¤å¡«æ»¡é€Ÿç‡å’Œæ¸…ç©ºé€Ÿç‡çš„å½±å“ã€‚ ä¹Ÿå°±æ˜¯è¯´ç¼“å†²æ˜¯ä¸ºäº†è§£å†³é«˜é€Ÿè®¾å¤‡å’Œä½é€Ÿè®¾å¤‡ä¹‹é—´çš„é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜ã€‚ DMAä¸­çš„ç¼“å†²åŒºä½œç”¨ä¸ºä½•ï¼Ÿ å†…å­˜ä¸­ç”¨äºä¸å¤–è®¾äº¤äº’æ•°æ®çš„ä¸€å—åŒºåŸŸè¢«ç§°ä½œDMAç¼“å†²åŒºã€‚ å¤–è®¾çš„è®¾å¤‡è¯»å†™é€Ÿåº¦ä¸å†…å­˜ç›¸æ¯”éå¸¸æ…¢ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ç¼“å†²åŒºæ¥å‡å°‘ç­‰å¾…æ—¶é—´ï¼Œæé«˜DMAçš„è¿è¡Œæ•ˆç‡ã€‚ 6. ä½•ä¸ºè™šæ‹Ÿè®¾å¤‡ï¼Ÿ åœ¨ä¸€å°å…±äº«è®¾å¤‡ä¸Šæ¨¡æ‹Ÿè‹¥å¹²å°ç‹¬äº«è®¾å¤‡çš„æ“ä½œï¼ŒæŠŠç‹¬å å‹è®¾å¤‡å˜æˆé€»è¾‘ä¸Šçš„å…±äº«å‹è®¾å¤‡ï¼Œè¿™ç§æŠ€æœ¯å«åšè™šæ‹Ÿè®¾å¤‡æŠ€æœ¯ã€‚ å®ç°è¿™ç§æŠ€æœ¯çš„è½¯ä»¶å’Œç¡¬ä»¶è¢«ç§°ä¸ºSPOOLINGç³»ç»Ÿï¼Œä½¿ç”¨SPOOLINGæŠ€æœ¯æ‰€æä¾›çš„è®¾å¤‡å°±ç§°ä¸ºè™šæ‹Ÿè®¾å¤‡ã€‚ å®ç°è™šæ‹Ÿè®¾å¤‡çš„ä¸»è¦æ¡ä»¶æ˜¯ï¼šç¡¬ä»¶ä¸Šéœ€è¦åœ¨ç£ç›˜ä¸Šå¼€è¾Ÿè¾“å…¥äº•å’Œè¾“å‡ºäº•ç”¨åšç¼“å†²çš„å­˜å‚¨åŒºåŸŸã€‚è½¯ä»¶ä¸Šéœ€è¦é¢„è¾“å…¥ç¨‹åº. ç¼“è¾“å‡ºç¨‹åºå’Œäº•ç®¡ç†ç¨‹åºã€‚ 7. OSä¸­ä¸ºä½•è¦å¼•å…¥é€»è¾‘è®¾å¤‡ï¼Ÿå³åœ¨é©±åŠ¨ä¸­å®Œæˆâ€œé€»è¾‘è®¾å¤‡â€”ç‰©ç†è®¾å¤‡â€å¯¹åº”ï¼Ÿæ¦‚å¿µä¸ºäº†å®ç°è®¾å¤‡ç‹¬ç«‹æ€§è€Œå¼•å…¥äº†é€»è¾‘è®¾å¤‡å’Œç‰©ç†è®¾å¤‡ä¸¤æ¦‚å¿µã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºç‹¬ç«‹äºå…·ä½“ä½¿ç”¨çš„ç‰©ç†è®¾å¤‡ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æé«˜äº†OSçš„å¯é€‚åº”æ€§å’Œå¯æ‰©å±•æ€§,åœ¨åº”ç”¨ç¨‹åºä¸­,ä½¿ç”¨é€»è¾‘è®¾å¤‡åç§°æ¥è¯·æ±‚ä½¿ç”¨æŸç±»è®¾å¤‡;è€Œç³»ç»Ÿåœ¨å®é™…æ‰§è¡Œæ—¶,è¿˜å¿…é¡»ä½¿ç”¨ç‰©ç†è®¾å¤‡åç§°ã€‚ è®¾å¤‡ç‹¬ç«‹æ€§å¸¦æ¥çš„å¥½å¤„ åº”ç”¨ç¨‹åºä¸å…·ä½“ç‰©ç†è®¾å¤‡æ— å…³ï¼Œç³»ç»Ÿå¢å‡æˆ–å˜æ›´è®¾å¤‡æ—¶å¯¹æºç¨‹åºä¸å¿…åŠ ä»¥ä»»ä½•ä¿®æ”¹ï¼› æ˜“äºåº”å¯¹I/Oè®¾å¤‡æ•…éšœï¼Œä»è€Œæé«˜ç³»ç»Ÿå¯é æ€§ï¼Œå¢åŠ è®¾å¤‡åˆ†é…çš„çµæ´»æ€§ï¼Œèƒ½æ›´æœ‰æ•ˆåœ°åˆ©ç”¨è®¾å¤‡èµ„æºï¼Œå®ç°å¤šé“ç¨‹åºè®¾è®¡ï¼› 8. IDEæ˜¯ä»€ä¹ˆï¼Ÿä¸²å£ä¸å¹¶å£æŒ‡ä»€ä¹ˆï¼Ÿä¸¾ä¾‹ï¼ŸPCIå‘¢ï¼ŸIDE å¹³å¸¸æ‰€è¯´çš„IDEæ¥å£ï¼Œä¹Ÿç§°ä¹‹ä¸ºATAæ¥å£ã€‚ATAçš„è‹±æ–‡æ‹¼å†™ä¸ºâ€œAdvanced Technology Attachmentâ€ï¼Œå«ä¹‰æ˜¯â€œé«˜çº§æŠ€æœ¯é™„åŠ è£…ç½®â€ã€‚ æ—©æœŸçš„IDEæ¥å£æœ‰ä¸¤ç§ä¼ è¾“æ¨¡å¼ï¼Œä¸€ä¸ªæ˜¯PIOï¼ˆProgramming I/Oï¼‰æ¨¡å¼ï¼Œå¦ä¸€ä¸ªæ˜¯DMAï¼ˆDirect Memory Accessï¼‰ã€‚ ä¸²å£ä¸å¹¶å£ ä¸²è¡Œæ¥å£ç®€ç§°ä¸²å£ï¼Œä¹Ÿç§°ä¸²è¡Œé€šä¿¡æ¥å£æˆ–ä¸²è¡Œé€šè®¯æ¥å£ï¼ˆé€šå¸¸æŒ‡COMæ¥å£ï¼‰ï¼Œæ˜¯é‡‡ç”¨ä¸²è¡Œé€šä¿¡æ–¹å¼çš„æ‰©å±•æ¥å£ã€‚ä¸²è¡Œæ¥å£ (Serial Interface) æ˜¯æŒ‡æ•°æ®ä¸€ä½ä¸€ä½åœ°é¡ºåºä¼ é€ï¼Œå…¶ç‰¹ç‚¹æ˜¯é€šä¿¡çº¿è·¯ç®€å•ï¼Œåªè¦ä¸€å¯¹ä¼ è¾“çº¿å°±å¯ä»¥å®ç°åŒå‘é€šä¿¡ï¼ˆå¯ä»¥ç›´æ¥åˆ©ç”¨ç”µè¯çº¿ä½œä¸ºä¼ è¾“çº¿ï¼‰ï¼Œä»è€Œå¤§å¤§é™ä½äº†æˆæœ¬ï¼Œç‰¹åˆ«é€‚ç”¨äºè¿œè·ç¦»é€šä¿¡ï¼Œä½†ä¼ é€é€Ÿåº¦è¾ƒæ…¢ã€‚ å¹¶è¡Œæ¥å£ï¼ŒæŒ‡é‡‡ç”¨å¹¶è¡Œä¼ è¾“æ–¹å¼æ¥ä¼ è¾“æ•°æ®çš„æ¥å£æ ‡å‡†ã€‚ä¸€ä¸ªå¹¶è¡Œæ¥å£çš„æ¥å£ç‰¹æ€§å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢åŠ ä»¥æè¿°ï¼š1. ä»¥å¹¶è¡Œæ–¹å¼ä¼ è¾“çš„æ•°æ®é€šé“çš„å®½åº¦ï¼Œä¹Ÿç§°æ¥å£ä¼ è¾“çš„ä½æ•°ï¼›2. ç”¨äºåè°ƒå¹¶è¡Œæ•°æ®ä¼ è¾“çš„é¢å¤–æ¥å£æ§åˆ¶çº¿æˆ–ç§°äº¤äº’ä¿¡å·çš„ç‰¹æ€§ã€‚ æ•°æ®çš„å®½åº¦å¯ä»¥ä»1ï½128ä½æˆ–è€…æ›´å®½ SCSIå’ŒIDEéƒ½æ˜¯å¹¶è¡Œæ¥å£ã€‚ ä¸²å£å½¢å®¹ä¸€ä¸‹å°±æ˜¯ï¼šä¸€æ¡è½¦é“ï¼Œè€Œå¹¶å£å°±æ˜¯æœ‰å¤šä¸ªè½¦é“åŒä¸€æ—¶åˆ»èƒ½ä¼ é€å¤šä½ï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰æ•°æ®ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯å¹¶å£å¿«ã€‚ç”±äºå¤šä½é€šé“ä¹‹é—´çš„äº’ç›¸å¹²æ‰°ï¼Œä¼ è¾“æ—¶é€Ÿåº¦å°±å—åˆ°äº†é™åˆ¶ã€‚è€Œä¸”å½“ä¼ è¾“å‡ºé”™æ—¶ï¼Œè¦åŒæ—¶é‡æ–°ä¼ å¤šä¸ªä½çš„æ•°æ®ã€‚è€Œä¸²å£æ²¡æœ‰å¹²æ‰°ï¼Œä¼ è¾“å‡ºé”™åé‡å‘ä¸€ä½å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥è¦æ¯”å¹¶å£å¿«ã€‚ PCI PCIæ˜¯Peripheral Component Interconnect(å¤–è®¾éƒ¨ä»¶äº’è¿æ ‡å‡†)çš„ç¼©å†™ï¼Œå®ƒæ˜¯ç›®å‰ä¸ªäººç”µè„‘ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„æ¥å£ï¼Œå‡ ä¹æ‰€æœ‰çš„ä¸»æ¿äº§å“ä¸Šéƒ½å¸¦æœ‰è¿™ç§æ’æ§½ã€‚ï¼ˆå¯æƒœç°åœ¨éƒ½å˜æˆäº†PCIeæ¥å£ï¼‰ PCI ï¼ˆPeripheral Component Interconnectï¼‰æ€»çº¿æ˜¯ä¸€ç§é«˜æ€§èƒ½å±€éƒ¨æ€»çº¿ï¼Œæ˜¯ä¸ºäº†æ»¡è¶³å¤–è®¾é—´ä»¥åŠå¤–è®¾ä¸ä¸»æœºé—´é«˜é€Ÿæ•°æ®ä¼ è¾“è€Œæå‡ºæ¥çš„ã€‚åœ¨æ•°å­—å›¾å½¢. å›¾åƒå’Œè¯­éŸ³å¤„ç†ï¼Œä»¥åŠé«˜é€Ÿå®æ—¶æ•°æ®é‡‡é›†ä¸å¤„ç†ç­‰å¯¹æ•°æ®ä¼ è¾“ç‡è¦æ±‚è¾ƒé«˜çš„åº”ç”¨ä¸­ï¼Œé‡‡ç”¨PCIæ€»çº¿æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå¯ä»¥è§£å†³åŸæœ‰çš„æ ‡å‡†æ€»çº¿æ•°æ®ä¼ è¾“ç‡ä½å¸¦æ¥çš„ç“¶é¢ˆé—®é¢˜ã€‚ 9. ç£ç›˜è°ƒåº¦ç®—æ³•å…ˆæ¥å…ˆæœåŠ¡/FCFS First Come First Serve algorithm é¡¾åæ€ä¹‰ï¼Œå…ˆæ¥çš„å…ˆæœåŠ¡ï¼Œä¸è€ƒè™‘å„I/Oè¯·æ±‚ä¹‹é—´çš„ç›¸å¯¹æ¬¡åºå’Œç§»åŠ¨è‡‚å½“å‰æ‰€å¤„ä½ç½®ï¼› è¿›ç¨‹ç­‰å¾…I/Oè¯·æ±‚çš„æ—¶é—´ä¼šå¾ˆé•¿ï¼Œå¯»é“æ€§èƒ½è¾ƒå·®ï¼› æœ€çŸ­æŸ¥æ‰¾æ—¶é—´ä¼˜å…ˆç®—æ³•/SSTF Shortest Seek Time First algorithm SSTFè€ƒè™‘I/Oè¯·æ±‚ä¹‹é—´çš„åŒºåˆ«ï¼Œæ€»æ˜¯å…ˆæ‰§è¡ŒæŸ¥æ‰¾æ—¶é—´æœ€çŸ­çš„è¯·æ±‚ï¼Œä¸FCSç®—æ³•ç›¸æ¯”æœ‰è¾ƒå¥½çš„å¯»é“æ€§èƒ½ã€‚ æ‰«æç®—æ³•/SCAN SCAN algorithm åœ¨SCANä¸­ï¼Œç§»åŠ¨è‡‚æ¯æ¬¡æ²¿ä¸€ä¸ªæ–¹å‘ç§»åŠ¨ï¼Œæ‰«è¿‡æ‰€æœ‰æŸ±é¢ï¼Œé‡åˆ°æœ€è¿‘çš„I/Oè¯·æ±‚ä¾¿è¿›è¡Œå¤„ç†ï¼Œç›´è‡³åˆ°è¾¾æœ€åä¸€ä¸ªæŸ±é¢åï¼Œå†å‘ç›¸åçš„æ–¹å‘ç§»åŠ¨å›æ¥ã€‚ SCANä¸ç”µæ¢¯è°ƒåº¦ç®—æ³•ä¸åŒçš„æ˜¯ï¼šå³ä½¿å½“å‰ç§»åŠ¨æ–¹å‘æš‚æ—¶æ²¡æœ‰I/Oè¯·æ±‚ï¼Œç§»åŠ¨è‡‚ä¹Ÿéœ€è¦æ‰«æåˆ°å¤´ã€‚ æ‰«æç®—æ³•åçˆ±é‚£äº›æœ€æ¥è¿‘é‡Œé¢æˆ–é è¿‘å¤–é¢çš„è¯·æ±‚ï¼Œå¯¹æœ€è¿‘æ‰«ææ‰€è·¨è¶ŠåŒºåŸŸçš„I/Oè¯·æ±‚çš„å“åº”é€Ÿåº¦ä¼šè¾ƒæ…¢ã€‚ åˆ†æ­¥æ‰«æç®—æ³•/N-steps N-steps scan algorithm å°†I/Oè¯·æ±‚åˆ†ä¸ºé•¿åº¦ä¸ºNçš„å­é˜Ÿåˆ—ï¼ŒæŒ‰FIFOç®—æ³•ä¾æ¬¡å¤„ç†æ¯ä¸ªå­é˜Ÿåˆ—ï¼Œè€Œæ¯ä¸ªå­é˜Ÿåˆ—é‡‡ç”¨æ‰«æç®—æ³•ï¼Œå¤„ç†å®Œä¸€ä¸ªåå†æœåŠ¡ä¸‹ä¸€ä¸ªå­é˜Ÿåˆ—ã€‚ åœ¨ä¸€æ®µæ—¶é—´å†…è¿›ç¨‹é‡å¤è¯·æ±‚è®¿é—®åŒä¸€æŸ±é¢ä¼šå„æ–­æ•´ä¸ªè®¾å¤‡ï¼Œé€ æˆç£ç›˜è‡‚åœç•™åœ¨æŸ±é¢ä¸Šä¸åŠ¨ï¼Œç§°ä¸ºâ€œç£è‡‚ç²˜æ€§â€ï¼Œä½¿æ‰€æœ‰å…¶ä»–æŸ±é¢çš„è®¿é—®è¯·æ±‚å¯èƒ½é•¿æ—¶é—´å¾—ä¸åˆ°æœåŠ¡ã€‚ å½“Nå¾ˆå¤§çš„æ—¶å€™ ï¼Œæ¥è¿‘äºæ‰«æç®—æ³•æ€§èƒ½ï¼›å½“N=1çš„æ—¶å€™ï¼Œæ¥è¿‘äºFIFOç®—æ³•æ€§èƒ½ã€‚ ç”µæ¢¯è°ƒåº¦ç®—æ³•/LOOK elevator algorithmåˆç§°LOOKç®—æ³• SCANç®—æ³•çš„æ”¹è¿›ï¼Œæ— è®¿é—®è¯·æ±‚æ—¶ï¼Œç§»åŠ¨è‡‚åœæ­¢ä¸åŠ¨ï¼Œæœ‰è®¿é—®è¯·æ±‚æ—¶ï¼Œç§»åŠ¨è‡‚æŒ‰ç”µæ¢¯è§„å¾‹ç§»åŠ¨ã€‚ LOOKä¸éœ€è¦æ‰«æåˆ°ç£ç›˜çš„å°½å¤´ï¼ å¾ªç¯æ‰«æç®—æ³•/Circular scan Circular scan algorithm ç§»åŠ¨è‡‚æ€»æ˜¯ä»0å·æŸ±é¢è‡³æœ€å¤§å·æŸ±é¢é¡ºåºæ‰«æï¼Œç„¶åç›´æ¥è¿”å›0å·æŸ±é¢é‡å¤è¿›è¡Œï¼Œå½’é€”ä¸­ä¸å†æä¾›æœåŠ¡ï¼Œæ„æˆä¸€ä¸ªå¾ªç¯ï¼Œç¼©çŸ­å¤„ç†æ–°æ¥è¯·æ±‚çš„æœ€å¤§å»¶è¿Ÿã€‚ ç¬¬å…­ç«  1. æ–‡ä»¶å¦‚ä½•åˆ†ç±»ï¼Ÿä¸ºä½•æœ‰è¿™ä¹ˆå¤šç§åˆ†ç±»ï¼Ÿæ–‡ä»¶æ˜¯ç”±æ–‡ä»¶åå­—æ ‡è¯†çš„ä¸€ç»„ä¿¡æ¯çš„é›†åˆã€‚å¯æŒ‰å„ç§æ–¹æ³•è¿›è¡Œåˆ†ç±»ï¼š æŒ‰ç”¨é€”åˆ†ç±»ï¼š æŒ‰ä¿æŠ¤çº§åˆ«åˆ†ç±»ï¼š æŒ‰ä¿¡æ¯æµå‘åˆ†ç±»ï¼š æŒ‰å­˜æ”¾æ—¶é™åˆ†ç±»ï¼š æŒ‰è®¾å¤‡ç±»å‹åˆ†ç±»ï¼š æŒ‰æ–‡ä»¶çš„ç»“æ„åˆ†ç±»ï¼š æœ‰å¤šç§åˆ†ç±»çš„åŸå› æ˜¯æ–‡ä»¶æœ¬èº«çš„ä¿¡æ¯å’Œå±æ€§å¤šæ ·ï¼Œæ ¹æ®ä¸åŒçš„ç”¨é€”. æƒé™. å­˜å‚¨æ–¹å¼ç­‰å‡å¯è¿›è¡Œä¸åŒéœ€æ±‚çš„åˆ’åˆ†ã€‚ å‚è€ƒèµ„æ–™ï¼šhttps://blog.csdn.net/liu_fei_er/article/details/80619625 2. ç³»ç»Ÿå®ç°æŒ‰åå­˜å–æ–‡ä»¶ä¸»è¦ä¾é ä»€ä¹ˆæ•°æ®ç»“æ„ï¼Ÿ **æ–‡ä»¶æ§åˆ¶å— (FCB)**æ˜¯OSä¸ºæ¯ä¸ªæ–‡ä»¶å»ºç«‹çš„å”¯ä¸€æ•°æ®ç»“æ„ï¼Œå…¶ä¸­åŒ…å«äº†å…¨éƒ¨æ–‡ä»¶å±æ€§ï¼Œå…¶ç›®çš„æ˜¯æ—¢ä¾¿äºç”¨æˆ·çš„æ“ä½œå’Œä½¿ç”¨ï¼Œåˆä¾¿äºæ“ä½œç³»ç»Ÿå¯¹æ–‡ä»¶çš„ç®¡ç†å’Œæ§åˆ¶ã€‚ ä¸€ä¸ªæ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆ ï¼šFCB å’Œæ–‡ä»¶ä½“ï¼ˆæ–‡ä»¶ä¿¡æ¯ï¼‰ã€‚æœ‰äº† FCB å°±å¯ä»¥å®ç°æ–‡ä»¶çš„â€œæŒ‰åå­˜å–â€ 3. æ–‡ä»¶çš„ç»„ç»‡æœ‰å“ªå‡ ç§å½¢å¼ï¼Ÿæ–‡ä»¶å’Œå­˜å‚¨ä»‹è´¨æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿæ–‡ä»¶ç»„ç»‡æ˜¯æŒ‡æ–‡ä»¶ä¸­ä¿¡æ¯çš„é…ç½®å’Œæ„é€ æ–¹å¼ï¼Œåº”è¯¥ä»æ–‡ä»¶çš„é€»è¾‘ç»“æ„å’Œç»„ç»‡ä»¥åŠæ–‡ä»¶çš„ç‰©ç†ç»“æ„å’Œç»„ç»‡ä¸¤æ–¹é¢åŠ ä»¥è€ƒè™‘ã€‚ æ–‡ä»¶å’Œå­˜å‚¨ä»‹è´¨çš„å…³ç³» æ–‡ä»¶çš„å¢åˆ æ”¹æŸ¥æ“ä½œéƒ½ä¸å­˜å‚¨ä»‹è´¨å¯†åˆ‡ç›¸å…³ã€‚ æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç£ç›˜ç®¡ç†é™¤ç®¡ç†æ–‡ä»¶ç©ºé—´å¤–ï¼Œè¿˜å°†æ–‡ä»¶çš„é€»è¾‘åœ°å€è½¬æ¢æˆç£ç›˜çš„ç‰©ç†åœ°å€ï¼Œå³ç”±é€»è¾‘å—å·æ‰¾åˆ°æŸ±é¢å·. ç£å¤´å·å’Œæ‰‡åŒºå·ï¼Œè®¾å¤‡ä¸å†…å­˜ä¹‹é—´çš„æ•°æ®ä¼ è¾“æ“ä½œç”±æ–‡ä»¶ç³»ç»Ÿè°ƒç”¨è®¾å¤‡ç®¡ç†å®ç°ã€‚ 4. æ–‡ä»¶çš„é€»è¾‘ç»„ç»‡æ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Ÿæœ‰å“ªäº›æ–¹å¼ï¼Ÿæ–‡ä»¶çš„é€»è¾‘ç»“æ„å’Œç»„ç»‡æŒ‡ä»ç”¨æˆ·è§‚ç‚¹å‡ºå‘ï¼Œç ”ç©¶ç”¨æˆ·æ¦‚å¿µä¸­æŠ½è±¡çš„ä¿¡æ¯ç»„ç»‡æ–¹å¼ï¼Œè¿™æ˜¯ç”¨æˆ·æ‰€èƒ½è§‚å¯Ÿåˆ°çš„ï¼Œå¯åŠ ä»¥å¤„ç†çš„æ•°æ®é›†åˆã€‚ æ–‡ä»¶çš„é€»è¾‘ç»“æ„åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼šæµå¼æ–‡ä»¶å’Œè®°å½•å¼æ–‡ä»¶ã€‚ æµå¼æ–‡ä»¶æµå¼æ–‡ä»¶æ˜¯ä¸€ç§æ— ç»“æ„çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…çš„æ•°æ®ä¸å†ç»„æˆè®°å½•ï¼Œåªæ˜¯ä¾æ¬¡çš„ä¸€ä¸²ä¿¡æ¯é›†åˆï¼Œç§°ä¸ºå­—èŠ‚æµæ–‡ä»¶ï¼Œå¯ä»¥çœ‹æˆæ˜¯åªæœ‰ä¸€ä¸ªè®°å½•çš„è®°å½•å¼æ–‡ä»¶ã€‚ ä¸ºäº†ç®€åŒ–ç³»ç»Ÿï¼Œå¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿå¦‚Linuxç³»ç»Ÿåªæä¾›æµå¼æ–‡ä»¶ã€‚ è®°å½•å¼æ–‡ä»¶è®°å½•å¼æ–‡ä»¶æ˜¯ä¸€ç§æœ‰ç»“æ„çš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«è‹¥å¹²é€»è¾‘è®°å½•ï¼Œé€»è¾‘è®°å½•æ˜¯æ–‡ä»¶ä¸­æŒ‰ä¿¡æ¯åœ¨é€»è¾‘ä¸Šçš„ç‹¬ç«‹å«ä¹‰æ‰€åˆ’åˆ†çš„ä¿¡æ¯å•ä½ã€‚ è®°å½•å¼æ–‡ä»¶ä¸­æœ‰ä¸¤ç§å¸¸ç”¨çš„è®°å½•ç»„ç»‡å’Œä½¿ç”¨æ–¹æ³•ï¼š è®°å½•å¼é¡ºåºæ–‡ä»¶ï¼šæ–‡ä»¶çš„è®°å½•é¡ºåºç”Ÿæˆå¹¶è¢«é¡ºåºè®¿é—®ã€‚ è®°å½•å¼ç´¢å¼•é¡ºåºæ–‡ä»¶ï¼šè¿™ç§æ–‡ä»¶ä½¿ç”¨ç´¢å¼•è¡¨ï¼Œè¡¨é¡¹åŒ…å«è®°å½•é”®å’Œç´¢å¼•æŒ‡é’ˆï¼Œè®°å½•é”®ç”±åº”ç”¨ç¨‹åºç¡®å®šï¼Œè€Œç´¢å¼•æŒ‡é’ˆä¾¿æŒ‡å‘ç›¸åº”è®°å½•ã€‚ 5. æ–‡ä»¶çš„ç‰©ç†ç»„ç»‡æ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Ÿæœ‰å“ªäº›æ–¹å¼ï¼Ÿ æ–‡ä»¶çš„ç‰©ç†ç»“æ„å’Œç»„ç»‡æ˜¯æŒ‡é€»è¾‘æ–‡ä»¶åœ¨ç‰©ç†å­˜å‚¨ç©ºé—´ä¸­çš„å­˜æ”¾æ–¹æ³•å’Œç»„ç»‡å…³ç³»ï¼Œè¿™æ—¶çš„æ–‡ä»¶çœ‹åšç‰©ç†æ–‡ä»¶ï¼Œå³ç›¸å…³ç‰©ç†å—çš„é›†åˆã€‚ æ–‡ä»¶çš„å­˜å‚¨ç»“æ„æ¶‰åŠï¼šå—çš„åˆ’åˆ†. è®°å½•çš„æ’åˆ—. ç´¢å¼•çš„ç»„ç»‡. ä¿¡æ¯çš„æœç´¢ï¼Œå…¶ä¼˜åŠ£ç›´æ¥å½±å“æ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½ã€‚ æœ‰ä¸¤ç±»æ–¹æ³•å¯ä»¥ç”¨æ¥æ„é€ æ–‡ä»¶ç‰©ç†ç»“æ„ï¼šè®¡ç®—æ³•å’ŒæŒ‡é’ˆæ³•ã€‚ å¸¸ç”¨çš„æ–‡ä»¶ç‰©ç†ç»“æ„å’Œç»„ç»‡æ–¹æ³•æœ‰ï¼šé¡ºåºæ–‡ä»¶. è¿æ¥æ–‡ä»¶. ç´¢å¼•æ–‡ä»¶. ç›´æ¥æ–‡ä»¶ã€‚ 6. æ–‡ä»¶ç›®å½•ä¸ç›®å½•æ–‡ä»¶æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿæ–‡ä»¶ç›®å½•ä¸ºäº†åŠ å¿«æ–‡ä»¶æŸ¥æ‰¾é€Ÿåº¦ï¼Œé€šå¸¸æŠŠFCBæ±‡é›†å’Œç»„ç»‡åœ¨ä¸€èµ·å½¢æˆæ–‡ä»¶ç›®å½•ï¼Œæ–‡ä»¶ç›®å½•åŒ…å«è®¸å¤šç›®å½•é¡¹ï¼Œç›®å½•é¡¹æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«ç”¨äºæè¿°å­ç›®å½•å’Œæè¿°æ–‡ä»¶ã€‚ ç›®å½•æ–‡ä»¶ ç›®å½•é¡¹çš„æ ¼å¼æŒ‰ç»Ÿä¸€æ ‡å‡†å®šä¹‰ï¼Œå…¨éƒ¨ç”±ç›®å½•é¡¹æ‰€æ„æˆçš„æ–‡ä»¶ç§°ä¸ºç›®å½•æ–‡ä»¶ã€‚ ç›®å½•æ–‡ä»¶ä¿å­˜åœ¨å¤–å­˜ä¸Šï¼ŒæŸ¥æ‰¾æ–‡ä»¶æ—¶è°ƒå…¥å†…å­˜å·¥ä½œåŒºã€‚ ä¸æ™®é€šæ–‡ä»¶ä¸åŒï¼Œç›®å½•æ–‡ä»¶æ°¸è¿œä¸ä¼šç©ºï¼Œå®ƒè‡³å°‘åŒ…å«ä¸¤ä¸ªç›®å½•é¡¹ï¼šå½“å‰ç›®å½•â€œ.â€å’Œçˆ¶ç›®å½•é¡¹â€œ..â€ã€‚ 7. æ–‡ä»¶çš„è®¿é—®æ–¹å¼æœ‰å“ªäº›ï¼Ÿè¯·åšè¯´æ˜ï¼Ÿå¸¸ç”¨çš„æ–‡ä»¶è®¿é—®æ–¹å¼æœ‰ï¼šé¡ºåºå­˜å–. ç›´æ¥å­˜å–å’Œç´¢å¼•å­˜å– é¡ºåºå­˜å– æ— è®ºæ˜¯æ— ç»“æ„å­—èŠ‚æµæ–‡ä»¶ï¼Œè¿˜æ˜¯æœ‰ç»“æ„è®°å½•å¼æ–‡ä»¶ï¼Œå­˜å–æ“ä½œéƒ½åœ¨ä¸Šæ¬¡æ“ä½œçš„åŸºç¡€ä¸Šè¿›è¡Œã€‚ç³»ç»Ÿè®¾ç½®è¯»å†™ä¸¤ä¸ªä½ç½®æŒ‡é’ˆï¼ŒæŒ‡å‘è¦è¯»å‡ºæˆ–å†™å…¥çš„å­—èŠ‚ä½ç½®æˆ–è®°å½•ä½ç½®ã€‚ é¡ºåºå­˜å–ä¸»è¦ç”¨äºç£å¸¦æ–‡ä»¶ï¼Œä½†ä¹Ÿé€‚ç”¨äºç£ç›˜ä¸Šçš„é¡ºåºæ–‡ä»¶ã€‚ ç›´æ¥å­˜å– åˆç§°éšæœºå­˜å–ï¼Œå¯ä»¥éé¡ºåºåœ°ä»æ–‡ä»¶ä¸­çš„ä»»ä½•ä½ç½®å­˜å–æ–‡ä»¶å†…å®¹ã€‚ ç›´æ¥å­˜å–æ–¹æ³•é€‚åˆäºè¦æ±‚å¿«é€Ÿåœ°ä»¥ä»»æ„æ¬¡åºç›´æ¥è¯»å†™æŸæ¡è®°å½•çš„åº”ç”¨ï¼Œå¦‚è®¢æœºç¥¨ï¼›å®ƒä¹Ÿé€šå¸¸ç”¨äºç£ç›˜æ–‡ä»¶ã€‚ ç´¢å¼•å­˜å– è¿™æ˜¯åŸºäºç´¢å¼•æ–‡ä»¶çš„å­˜å–æ–¹æ³•ï¼Œç”±äºæ–‡ä»¶ä¸­çš„è®°å½•ä¸æŒ‰ä½ç½®è€Œæ˜¯æŒ‰å…¶è®°å½•åæˆ–è®°å½•é”®æ¥ç¼–å€ï¼Œæ‰€ä»¥ç”¨æˆ·æä¾›è®°å½•åæˆ–è®°å½•é”®åï¼Œå…ˆæŒ‰åæœç´¢ï¼Œå†æŸ¥æ‰¾æ‰€éœ€è¦çš„è®°å½•ã€‚ 8. æ–‡ä»¶æ§åˆ¶å—ï¼ˆFCBï¼‰çš„ä½œç”¨ï¼Ÿ æ–‡ä»¶æ§åˆ¶å—ï¼ˆFile Control Blockï¼ŒFCBï¼‰æ˜¯æ“ä½œç³»ç»Ÿä¸ºæ¯ä¸ªæ–‡ä»¶å»ºç«‹çš„å”¯ä¸€æ•°æ®ç»“æ„ï¼Œå…¶ä¸­åŒ…å«äº†å…¨éƒ¨æ–‡ä»¶å±æ€§ï¼Œå…¶ç›®çš„æ˜¯ä¸ºæ–¹ä¾¿æ“ä½œç³»ç»Ÿå¯¹æ–‡ä»¶çš„ç®¡ç†. æ§åˆ¶å’Œå­˜å–ã€‚ æœ‰äº†FCBå°±å¯ä»¥æ–¹ä¾¿åœ°å®ç°æ–‡ä»¶çš„æŒ‰åå­˜å–ã€‚ æ¯å½“åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿå°±è¦ä¸ºå…¶å»ºç«‹ä¸€ä¸ªFCBï¼Œç”¨æ¥è®°å½•æ–‡ä»¶çš„å±æ€§ä¿¡æ¯ï¼›æ¯å½“å­˜å–æ–‡ä»¶æ—¶ï¼Œå…ˆæ‰¾åˆ°å…¶FCBï¼Œå†æ‰¾åˆ°æ–‡ä»¶ä¿¡æ¯ç›˜å—å·. é¦–å—ç‰©ç†ä½ç½®æˆ–ç´¢å¼•è¡¨å°±èƒ½å­˜å–æ–‡ä»¶ä¿¡æ¯ã€‚ 9. ç›®å½•ç»“æ„çš„æ¦‚å¿µä¸åˆ†çº§æƒ…å½¢ï¼Ÿ æœ€ç®€å•çš„æ–‡ä»¶ç›®å½•æ—¶ä¸€çº§ç›®å½•ç»“æ„ï¼Œæ‰€æœ‰FCBæ’åˆ—åœ¨ä¸€å¼ çº¿æ€§è¡¨ä¸­ï¼Œå…¶ç¼ºç‚¹æ˜¯æ–‡ä»¶é‡åå’Œæ–‡ä»¶å…±äº«é—®é¢˜éš¾ä»¥è§£å†³ã€‚ å®é™…ä¸Šï¼Œæ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒå¤šçº§å±‚æ¬¡ç»“æ„ï¼Œæ ¹ç›®å½•æ˜¯å”¯ä¸€çš„ï¼Œæ¯ä¸€çº§ç›®å½•å¯ä»¥æ˜¯ä¸‹ä¸€çº§ç›®å½•çš„è¯´æ˜ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–‡ä»¶çš„è¯´æ˜ï¼Œä»è€Œå½¢æˆæ ‘çŠ¶ç›®å½•ç»“æ„ã€‚ æ ‘çŠ¶å¤šçº§ç›®å½•ç»“æ„æœ‰è®¸å¤šä¼˜ç‚¹ï¼š å¯ä»¥è¾ƒå¥½åœ°åæ˜ ç°å®ä¸–ç•Œä¸­å…·æœ‰å±‚æ¬¡å…³ç³»çš„æ•°æ®é›†åˆï¼Œç¡®åˆ‡åœ°åæ˜ ç³»ç»Ÿå†…éƒ¨æ–‡ä»¶çš„åˆ†æ”¯ç»“æ„ï¼› ä¸åŒæ–‡ä»¶å¯ä»¥é‡åï¼Œåªè¦å®ƒä»¬ä¸ä½äºåŒä¸€æœ«ç«¯å­ç›®å½•ä¸­å³å¯ï¼› æ˜“äºè§„å®šä¸åŒå±‚æ¬¡æˆ–å­ç›®å½•ä¸­æ–‡ä»¶çš„ä¸åŒå­˜å–æƒé™ï¼Œä¾¿äºæ–‡ä»¶çš„ä¿æŠ¤. ä¿å¯†å’Œå…±äº«ç­‰ï¼› æœ‰åˆ©äºç³»ç»Ÿçš„ç»´æŠ¤å’ŒæŸ¥æ‰¾ã€‚ 10. åˆ é™¤æ–‡ä»¶ä¸»è¦åˆ é™¤å“ªäº›å†…å®¹ï¼Ÿä¸ºä½•åˆ é™¤çš„æ–‡ä»¶å¯ä»¥è¢«æ¢å¤ï¼Ÿä½ è®¤ä¸ºåˆ é™¤æ–‡ä»¶åº”è¯¥åˆ é™¤å“ªäº›å†…å®¹ï¼Ÿè¯·ä»å®‰å…¨æ€§ä¸æ€§èƒ½ä¸¤æ–¹é¢æ¥è§£é‡Šå„è‡ªçš„å½±å“ï¼Ÿ ä¸€ä¸ªæ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šFCBå’Œæ–‡ä»¶ä½“ï¼ˆæ–‡ä»¶ä¿¡æ¯ï¼‰ï¼› åˆ é™¤æ–‡ä»¶ä¸»è¦åˆ é™¤å…¶FCBä¿¡æ¯ï¼Œæ–‡ä»¶ä¿¡æ¯è¿˜ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œå› æ­¤åªè¦æ‰¾åˆ°ç£ç›˜ä¸­å¯¹åº”ä½ç½®çš„æ•°æ®å°±å¯ä»¥æ¢å¤è¢«åˆ é™¤çš„æ–‡ä»¶ã€‚ ä»æ€§èƒ½æ–¹é¢æ¥è¯´ï¼Œåªåˆ é™¤FCBæ˜¯ä¼˜ç§€çš„é€‰æ‹©ï¼Œè¿™æ ·é€Ÿåº¦æ›´å¿«ï¼Œç³»ç»Ÿå¼€é”€æ›´å°ï¼› ä»å®‰å…¨æ€§æ–¹é¢æ¥è¯´ï¼Œåˆ é™¤æ–‡ä»¶æ—¶åº”å°†æ–‡ä»¶ä¿¡æ¯ä¹Ÿä¸€å¹¶åˆ é™¤ï¼› 11. å°±ä½ æ‰€äº†è§£çš„æ–‡ä»¶ç‰©ç†ç»„ç»‡ä¸­ï¼Œå“ªäº›æ˜¯ä½ è®¤ä¸ºä¸é”™çš„ç»„ç»‡æ–¹å¼ï¼Ÿé¡ºåºæ–‡ä»¶ å°†æ–‡ä»¶ä¸­é€»è¾‘ä¸Šè¿ç»­çš„ä¿¡æ¯å­˜æ”¾åˆ°å­˜å‚¨ä»‹è´¨çš„ç›¸é‚»ç‰©ç†å—ä¸Šå½¢æˆé¡ºåºç»“æ„ï¼Œå«åšé¡ºåºæ–‡ä»¶ï¼Œåˆç§°è¿ç»­æ–‡ä»¶ã€‚ é¡ºåºæ–‡ä»¶çš„ä¼˜ç‚¹æ˜¯é¡ºåºå­˜å–è®°å½•æ—¶é€Ÿåº¦å¿«ï¼Œåœ¨æ‰¹å¤„ç†æ–‡ä»¶. ç³»ç»Ÿæ–‡ä»¶ä¸­ç”¨å¾—å¾ˆå¤šã€‚ é¡ºåºæ–‡ä»¶çš„ç¼ºç‚¹æ˜¯å»ºç«‹æ–‡ä»¶ä¹‹å‰éœ€è¦é¢„å…ˆç¡®å®šæ–‡ä»¶é•¿åº¦ï¼Œä»¥ä¾¿åˆ†é…å­˜å‚¨ç©ºé—´ï¼›ä¿®æ”¹. æ’å…¥å’Œæ·»åŠ æ–‡ä»¶è®°å½•æœ‰ä¸€å®šçš„éš¾åº¦ï¼›å¯¹äºå˜é•¿è®°å½•çš„å¤„ç†å¾ˆå›°éš¾ï¼›å¯¹ç£ç›˜ä½œè¿ç»­åˆ†é…ä¼šé€ æˆç©ºé—²å—çš„æµªè´¹ã€‚ è¿æ¥æ–‡ä»¶ è¿æ¥ç»“æ„çš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨è¿æ¥å­—ï¼Œåˆç§°æŒ‡é’ˆï¼Œæ¥è¡¨ç¤ºæ–‡ä»¶ä¸­å„æ¡è®°å½•ä¹‹é—´çš„å…³ç³»ã€‚ è¿æ¥ç»“æ„å…‹æœäº†é¡ºåºç»“æ„ä¸é€‚åº”äºå¢. åˆ . æ”¹çš„ç¼ºç‚¹ï¼Œå¯¹æŸäº›æ“ä½œä¼šå¸¦æ¥å¥½å¤„ï¼Œä½†åœ¨å…¶ä»–æ–¹é¢åˆä¼šå¤±å»ä¸€äº›æ€§èƒ½ã€‚ ä½¿ç”¨è¿æ¥æ–‡ä»¶å¾ˆå®¹æ˜“æŠŠæ•°æ®è®°å½•ç»„ç»‡èµ·æ¥ï¼Œä½†æ˜¯æŸ¥æ‰¾æŸæ¡è®°å½•éœ€éå†é“¾æ¥ç»“æ„ï¼Œæ•ˆç‡å¾ˆä½ã€‚ ç´¢å¼•æ–‡ä»¶ ç´¢å¼•ç»“æ„å¼å®ç°éè¿ç»­å­˜å‚¨çš„å¦ä¸€ç§æ–¹æ³•ï¼Œé€‚ç”¨äºæ•°æ®è®°å½•ä¿å­˜åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚ ç´¢å¼•ç»“æ„æ˜¯è¿æ¥ç»“æ„çš„ä¸€ç§æ‰©å±•ï¼Œé™¤äº†å…·å¤‡è¿æ¥æ–‡ä»¶çš„ä¼˜ç‚¹å¤–ï¼Œè®°å½•å¯ä»¥æ•£åˆ—å­˜å‚¨ï¼Œå…·æœ‰ç›´æ¥è¯»å†™ä»»æ„è®°å½•çš„èƒ½åŠ›ï¼Œä¾¿äºä¿¡æ¯çš„å¢. åˆ . æ”¹ã€‚ ç¼ºç‚¹æ˜¯ç´¢å¼•è¡¨çš„ç©ºé—´å¼€é”€å’ŒæŸ¥æ‰¾æ—¶é—´çš„å¼€é”€å¤§ï¼Œå¤§å‹æ–‡ä»¶çš„ç´¢å¼•è¡¨çš„ä¿¡æ¯é‡ç”šè‡³å¯èƒ½è¿œè¿œè¶…è¿‡æ–‡ä»¶è®°å½•æœ¬èº«çš„ä¿¡æ¯é‡ã€‚ ç›´æ¥æ–‡ä»¶ åœ¨ç›´æ¥å­˜å–å­˜å‚¨è®¾å¤‡ä¸Šï¼Œåˆ©ç”¨å“ˆå¸Œæ³•å°†è®°å½•çš„å…³é”®å­—ä¸å…¶åœ°å€ä¹‹é—´å»ºç«‹æŸç§å¯¹åº”å…³ç³»ï¼Œä»¥ä¾¿å®ç°å¿«é€Ÿå­˜å–çš„æ–‡ä»¶å«åšç›´æ¥æ–‡ä»¶. æ•£åˆ—æ–‡ä»¶æˆ–å“ˆå¸Œæ–‡ä»¶ã€‚ è¿™ç§å­˜å‚¨ç»“æ„ç”¨åœ¨ä¸èƒ½é‡‡ç”¨é¡ºåºç»„ç»‡æ–¹æ³•. æ¬¡åºè¾ƒä¹±. åˆéœ€åœ¨æçŸ­æ—¶é—´å†…è¿›è¡Œå­˜å–çš„åœºåˆï¼Œå¯¹äºå®æ—¶å¤„ç†æ–‡ä»¶. ç›®å½•æ–‡ä»¶. å­˜å‚¨ç®¡ç†çš„é¡µè¡¨æŸ¥æ‰¾. ç¼–è¯‘ç¨‹åºå˜é‡åè¡¨ç­‰çš„ç®¡ç†ååˆ†æœ‰æ•ˆã€‚ 12. è¯·ä½ æŠŠæ–‡ä»¶æ“ä½œä¸ä¸Šä¸€ç« çš„è®¾å¤‡ç®¡ç†ç»“åˆèµ·æ¥ï¼Œå™è¿°æ–‡ä»¶è¯»å†™çš„æ•´ä¸ªè¿‡ç¨‹ï¼Ÿå¿ƒç´¯ï¼Œä¸è¯´ã€‚ 13. å®šæœŸç´§ç¼©ç£ç›˜ç©ºé—´ä¼šå¯¼è‡´ä»€ä¹ˆå¥½å¤„ï¼Ÿ å› ä¸ºæ–‡ä»¶è¢«åˆ†æ•£ä¿å­˜åˆ°æ•´ä¸ªç£ç›˜çš„ä¸åŒåœ°æ–¹ï¼Œè€Œä¸æ˜¯è¿ç»­åœ°ä¿å­˜åœ¨ç£ç›˜è¿ç»­çš„ç°‡ä¸­å½¢æˆçš„ã€‚ç¡¬ç›˜åœ¨ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œç”±äºåå¤å†™å…¥å’Œåˆ é™¤æ–‡ä»¶ï¼Œç£ç›˜ä¸­çš„ç©ºé—²æ‰‡åŒºä¼šåˆ†æ•£åˆ°æ•´ä¸ªç£ç›˜ä¸­ä¸è¿ç»­çš„ç‰©ç†ä½ç½®ä¸Šï¼Œä»è€Œä½¿æ–‡ä»¶ä¸èƒ½å­˜åœ¨è¿ç»­çš„æ‰‡åŒºé‡Œã€‚è¿™æ ·ï¼Œå†è¯»å†™æ–‡ä»¶æ—¶å°±éœ€è¦åˆ°ä¸åŒçš„åœ°æ–¹å»è¯»å–ï¼Œå¢åŠ äº†ç£å¤´çš„æ¥å›ç§»åŠ¨ï¼Œé™ä½äº†ç£ç›˜çš„è®¿é—®é€Ÿåº¦ã€‚ å®šæœŸç´§ç¼©ç£ç›˜ç©ºé—´å¯ä»¥ä½¿åŸæœ¬åˆ†æ•£çš„æ–‡ä»¶ç¢ç‰‡è¢«é‡æ–°æ•´ç†åˆ°ä¸€èµ·ï¼Œå‡å°‘ç£ç›˜åœ¨è¯»å–çš„æ—¶å€™çš„ç£å¤´ç§»åŠ¨ï¼Œå¢é«˜ç£ç›˜çš„è¯»å†™æ•ˆç‡ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"operatingsystem","slug":"operatingsystem","permalink":"https://tinychen.com/tags/operatingsystem/"},{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"}]},{"title":"Windowsä¸ŠApache Tomcatçš„å®‰è£…é…ç½®","slug":"20181112-win-install-tomcat","date":"2018-11-12T07:00:00.000Z","updated":"2018-11-12T07:00:00.000Z","comments":true,"path":"20181112-win-install-tomcat/","link":"","permalink":"https://tinychen.com/20181112-win-install-tomcat/","excerpt":"æœ¬æ–‡ä»‹ç»ä½¿ç”¨JAVA8+Apache Tomcat 9.0.19çš„å®‰è£…é…ç½®ã€‚ æ–‡ä¸­éƒ¨åˆ†å†…å®¹æ›´æ–°äº2019å¹´5æœˆ10æ—¥ã€‚","text":"æœ¬æ–‡ä»‹ç»ä½¿ç”¨JAVA8+Apache Tomcat 9.0.19çš„å®‰è£…é…ç½®ã€‚ æ–‡ä¸­éƒ¨åˆ†å†…å®¹æ›´æ–°äº2019å¹´5æœˆ10æ—¥ã€‚ 1ã€Tomcatæ˜¯ä»€ä¹ˆï¼Ÿ Tomcat æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾æºä»£ç çš„Web åº”ç”¨æœåŠ¡å™¨ï¼Œå±äºè½»é‡çº§åº”ç”¨æœåŠ¡å™¨ï¼Œåœ¨ä¸­å°å‹ç³»ç»Ÿå’Œå¹¶å‘è®¿é—®ç”¨æˆ·ä¸æ˜¯å¾ˆå¤šçš„åœºåˆä¸‹è¢«æ™®éä½¿ç”¨ï¼Œæ˜¯å¼€å‘å’Œè°ƒè¯•JSP ç¨‹åºçš„é¦–é€‰ã€‚å¯¹äºä¸€ä¸ªåˆå­¦è€…æ¥è¯´ï¼Œå¯ä»¥è¿™æ ·è®¤ä¸ºï¼Œå½“åœ¨ä¸€å°æœºå™¨ä¸Šé…ç½®å¥½Apache æœåŠ¡å™¨ï¼Œå¯åˆ©ç”¨å®ƒå“åº”HTMLï¼ˆæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ä¸‹çš„ä¸€ä¸ªåº”ç”¨ï¼‰é¡µé¢çš„è®¿é—®è¯·æ±‚ã€‚å®é™…ä¸ŠTomcatæ˜¯Apache æœåŠ¡å™¨çš„æ‰©å±•ï¼Œä½†è¿è¡Œæ—¶å®ƒæ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œæ‰€ä»¥å½“ä½ è¿è¡Œtomcat æ—¶ï¼Œå®ƒå®é™…ä¸Šä½œä¸ºä¸€ä¸ªä¸Apache ç‹¬ç«‹çš„è¿›ç¨‹å•ç‹¬è¿è¡Œçš„ã€‚ æ‘˜è‡ªç™¾åº¦ç™¾ç§‘ 2ã€é…ç½®JAVA8JAVA8ä¸‹è½½åœ°å€ï¼Œä¸‹è½½å‰è®°å¾—è¦å…ˆå‹¾é€‰acceptï¼Œå¦åˆ™æ— æ³•ä¸‹è½½ï¼Œi586/x86å³ä¸º32ä½ï¼Œx64ä¸º64ä½ï¼Œå¤§å®¶æ ¹æ®è‡ªå·±çš„æœºå™¨é…ç½®ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬ã€‚https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html æ³¨æ„ï¼Œç°åœ¨åœ¨ç”²éª¨æ–‡å®˜ç½‘ä¸‹è½½JDKéœ€è¦å…ˆè¿›è¡Œæ³¨å†Œç™»å½•ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸ä¸‹è½½ã€‚ JAVA8å®‰è£…æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œä¸å†è´´è¿‡å¤šçš„å›¾ç‰‡ï¼Œéœ€è¦å®‰è£…æ›´æ–°çš„ç‰ˆæœ¬çš„åŒå­¦å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼šJDKå®‰è£…ä¸ç¯å¢ƒå˜é‡é…ç½® å®‰è£…ä¸‹è½½å¥½çš„JDKæ–‡ä»¶ï¼Œæ­¤å¤„ä¸ºjdk-8u211-windows-x64.exeï¼Œå®‰è£…å®Œæˆåï¼Œé…ç½®ç¯å¢ƒå˜é‡ï¼Œå³å‡»ã€æˆ‘çš„ç”µè„‘ã€‘â€”ã€å±æ€§ã€‘â€”â€“ã€é«˜çº§ã€‘â€”ã€ç¯å¢ƒå˜é‡ã€‘; é€‰æ‹©ã€æ–°å»ºç³»ç»Ÿå˜é‡ã€‘â€“å¼¹å‡ºâ€œæ–°å»ºç³»ç»Ÿå˜é‡â€å¯¹è¯æ¡†ï¼Œåœ¨â€œå˜é‡åâ€æ–‡æœ¬æ¡†è¾“å…¥JAVA_HOME,åœ¨â€œå˜é‡å€¼â€æ–‡æœ¬æ¡†è¾“å…¥JDKçš„å®‰è£…è·¯å¾„ï¼Œå•å‡»â€œç¡®å®šâ€æŒ‰é’®; åœ¨â€œç³»ç»Ÿå˜é‡â€é€‰é¡¹åŒºåŸŸä¸­æŸ¥çœ‹PATHå˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºå˜é‡ PATHï¼Œå¦åˆ™é€‰ä¸­è¯¥å˜é‡ï¼Œå•å‡»â€œç¼–è¾‘â€æŒ‰é’®ï¼Œåœ¨â€œå˜é‡å€¼â€æ–‡æœ¬æ¡†çš„èµ·å§‹ä½ç½®æ·»åŠ %JAVA_HOME%\\bin;%JAVA_HOME%\\jre\\bin;ï¼Œæˆ–è€…æ˜¯ç›´æ¥%JAVA_HOME%\\binï¼Œå•å‡»ç¡®å®šæŒ‰é’®ï¼› åœ¨â€œç³»ç»Ÿå˜é‡â€é€‰é¡¹åŒºåŸŸä¸­æŸ¥çœ‹CLASSPATH å˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºå˜é‡CLASSPATHï¼Œå¦åˆ™é€‰ä¸­è¯¥å˜é‡ï¼Œå•å‡»â€œç¼–è¾‘â€æŒ‰é’®ï¼Œåœ¨â€œå˜é‡å€¼â€æ–‡æœ¬æ¡†çš„èµ·å§‹ä½ç½®æ·»åŠ .;%JAVA_HOME%\\lib\\dt.jar;%JAVA_HOME%\\lib\\tools.jar; æµ‹è¯•ç¯å¢ƒå˜é‡çš„é…ç½®æˆåŠŸä¸å¦ã€‚åœ¨DOSå‘½ä»¤è¡Œçª—å£æˆ–powershellè¾“å…¥JAVACï¼Œè¾“å‡ºå¸®åŠ©ä¿¡æ¯å³ä¸ºé…ç½®æ­£ç¡®ã€‚ 3ã€å®‰è£…Apacheçš„Tomcat ç”¨æµè§ˆå™¨æ‰“å¼€tomcatå®˜ç½‘ï¼š https://tomcat.apache.org/ ç‚¹å‡»å·¦ä¾§çš„å¯¼èˆªæ Downloadä¸‹æ–¹é€‰æ‹©æœ€æ–°çš„Tomcat 9ï¼Œå‡ºç°ä»¥ä¸‹é¡µé¢ï¼Œç‚¹å‡»é¡µé¢ä¸‹æ–¹çš„â€œ64-bit Windows zip (pgp, sha1,sha512)â€œè¿›è¡Œä¸‹è½½ã€‚ å®Œæˆä¸‹è½½åï¼Œç›´æ¥è§£å‹ï¼Œè·¯å¾„è‡ªé€‰ã€‚ï¼ˆè¿™é‡Œä»¥D:\\apache-tomcat-9.0.19ä¸ºä¾‹ï¼‰ å³é”® â€œæ­¤ç”µè„‘â€ï¼Œç‚¹å‡»â€å±æ€§â€ï¼Œç‚¹å‡»â€é«˜çº§ç³»ç»Ÿè®¾ç½®â€â€”&gt;â€é«˜çº§â€â€”&gt;â€ç¯å¢ƒå˜é‡â€ åœ¨â€ç³»ç»Ÿå˜é‡â€é‡Œæ–°å»ºå˜é‡åï¼šCATALINA_BASEï¼Œå˜é‡å€¼ï¼šD:\\apache-tomcat-9.0.19ï¼ˆæ­¤å¤„ä¸ºä½ çš„è§£å‹åŒ…è·¯å¾„ï¼‰ åœ¨â€ç³»ç»Ÿå˜é‡â€é‡Œæ–°å»ºå˜é‡åï¼šCATALINA_HOMEï¼Œå˜é‡å€¼ï¼šD:\\apache-tomcat-9.0.19 åœ¨â€ç³»ç»Ÿå˜é‡â€é‡Œæ‰“å¼€Pathå˜é‡ï¼Œæ·»åŠ å˜é‡å€¼ï¼š%CATALINA_HOME%\\libå’Œ%CATALINA_HOME%\\binï¼ˆè¿™ä¸€æ­¥å¯æœ‰å¯æ— ï¼Œæœ‰äº›ç”µè„‘æ— éœ€é…ç½®æ­¤æ­¥éª¤ä¾¿å¯å®Œæˆï¼Œå› æ­¤å¯ä»¥å…ˆè·³è¿‡ï¼‰ ä½¿ç”¨DOSæˆ–è€…powershellè¿›å…¥tomcatä¸‹çš„binç›®å½•ï¼ˆæœ¬äººç”µè„‘çš„è·¯å¾„ä¸ºD:\\apache-tomcat-9.0.19\\binï¼‰ï¼Œæ‰§è¡Œâ€œservice.bat installâ€ ã€‚ï¼ˆé™„ï¼šserviceå¸è½½å‘½ä»¤ï¼šservice.bat removeï¼‰ å¯åŠ¨tomcatï¼Œåœ¨tomcatè§£å‹è·¯å¾„ä¸‹çš„binæ–‡ä»¶å¤¹å†…åŒå‡»æ‰“å¼€â€tomcat9w.exeâ€ï¼Œåœ¨æ‰“å¼€çš„è½¯ä»¶ç•Œé¢ç‚¹å‡»â€œStartâ€å³å¯ è¿™é‡Œçš„startup typeä¸ºå¯åŠ¨ç±»å‹ï¼Œå³å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼ˆAutomaticï¼‰ï¼Œæ‰‹åŠ¨å¯åŠ¨ï¼ˆManualï¼‰å’Œç¦ç”¨ï¼ˆDisabledï¼‰ æ³¨ï¼šåœ¨cmdä¸­æˆ–è€…powershellç›´æ¥è¿è¡Œbinç›®å½•ä¸‹çš„shutdowm.batæ–‡ä»¶æˆ–startup.batæ–‡ä»¶ä¹Ÿå¯ä»¥ç›´æ¥å…³é—­æˆ–æ‰“å¼€tomcatæœåŠ¡ å®Œæˆæ–¹æ³•æ“ä½œåï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥http://localhost:8080/å‡ºç°ä¸‹å›¾æ‰€ç¤ºä¿¡æ¯å³ä¸ºæˆåŠŸé…ç½® 4ã€Eclipse é…ç½®Tomcat4.1 ä¸‹è½½Eclipseæ³¨æ„åœ¨å®‰è£…Eclipseçš„æ—¶å€™è¦é€‰æ‹©Eclipse IDE for Enterprise Java Developers Eclipseå®˜ç½‘ä¸‹è½½åœ°å€ï¼š https://www.eclipse.org/downloads/download.php?file=/oomph/epp/2019-03/R/eclipse-inst-win64.exe 4.2 Eclipseä¸­å…³è”Tomcatæ‰“å¼€Eclipseï¼Œç‚¹å‡»èœå•æ çš„Windowï¼Œç„¶åé€‰æ‹©Preferencesï¼Œé€‰æ‹©Serverï¼Œç‚¹å‡»Runtime Environments ï¼Œç‚¹å‡»å³ä¾§çš„Add, é€‰æ‹©Apache Tomcat v9.0 é€‰æ‹©ç”µè„‘ä¸Šå®‰è£…å¥½tomcatçš„ç›®å½•ï¼Œç„¶åé€‰æ‹©JREã€‚ ç¡®è®¤ä¹‹åï¼Œç‚¹å‡»Apply and Closeã€‚","categories":[{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"},{"name":"tomcat","slug":"tomcat","permalink":"https://tinychen.com/tags/tomcat/"}]},{"title":"Ubuntu18.04ä¸Win10æ—¶é—´ä¸ä¸€è‡´","slug":"20181109-ubuntu-change-time","date":"2018-11-09T07:00:00.000Z","updated":"2018-11-09T07:00:00.000Z","comments":true,"path":"20181109-ubuntu-change-time/","link":"","permalink":"https://tinychen.com/20181109-ubuntu-change-time/","excerpt":"æœ€è¿‘åœ¨å®‰è£…Ubuntu18.04å’Œwin10åŒç³»ç»Ÿçš„æ—¶å€™å‘ç°ä¸¤ä¸ªç³»ç»Ÿçš„æ—¶é—´æ€»æ˜¯ç›¸å·®å…«ä¸ªå°æ—¶ï¼Œå³win10çš„æ—¶é—´è¦æ¯”Ubuntuæ—©å…«ä¸ªå°æ—¶ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸ªåœ¨Ubuntuä¸‹çš„è§£å†³æ–¹æ¡ˆã€‚","text":"æœ€è¿‘åœ¨å®‰è£…Ubuntu18.04å’Œwin10åŒç³»ç»Ÿçš„æ—¶å€™å‘ç°ä¸¤ä¸ªç³»ç»Ÿçš„æ—¶é—´æ€»æ˜¯ç›¸å·®å…«ä¸ªå°æ—¶ï¼Œå³win10çš„æ—¶é—´è¦æ¯”Ubuntuæ—©å…«ä¸ªå°æ—¶ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸ªåœ¨Ubuntuä¸‹çš„è§£å†³æ–¹æ¡ˆã€‚ 1ã€ä¸ºä»€ä¹ˆæ—¶é—´ä¼šä¸ä¸€è‡´åœ¨æˆ‘ä»¬ç”µè„‘çš„BIOSä¸­ï¼Œæœ‰ç€ä¸€ä¸ªè®°å½•çš„æ—¶é—´ï¼Œwindowsç³»ç»Ÿä¼šå°†BIOSä¸­çš„æ—¶é—´è§†ä¸ºæœ¬åœ°æ—¶é—´ï¼Œå³ä½ windowsä¸­è®¾ç½®ä¸ºä¸­å›½åœ°åŒºï¼Œé‚£ä¹ˆè¿™ä¸ªBIOSçš„æ—¶é—´å¯¹äºwindowsæ¥è¯´å°±æ˜¯ä¸­å›½æ—¶é—´ã€‚ åœ¨Ubuntuä¸­ï¼Œä¼šå°†BIOSä¸­çš„æ—¶é—´è§†ä¸ºUTCæ—¶é—´ï¼Œå³Universal Time Coordinated(åè°ƒä¸–ç•Œæ—¶)ï¼Œè€Œä¸­å›½è¿™è¾¹çš„æ—¶é—´æ˜¯UTC+8ï¼Œå³æ­£å¥½ç›¸å·®å…«ä¸ªå°æ—¶ã€‚ åè°ƒä¸–ç•Œæ—¶æ˜¯ä»¥åŸå­æ—¶ç§’é•¿ä¸ºåŸºç¡€ï¼Œåœ¨æ—¶åˆ»ä¸Šå°½é‡æ¥è¿‘äºä¸–ç•Œæ—¶çš„ä¸€ç§æ—¶é—´è®¡é‡ç³»ç»Ÿã€‚ä¸­å›½å¤§é™†é‡‡ç”¨ISO 8601-1988çš„ã€Šæ•°æ®å…ƒå’Œäº¤æ¢æ ¼å¼ä¿¡æ¯äº¤æ¢æ—¥æœŸå’Œæ—¶é—´è¡¨ç¤ºæ³•ã€‹ï¼ˆGB/T 7408-1994ï¼‰ç§°ä¹‹ä¸ºå›½é™…åè°ƒæ—¶é—´ï¼Œä»£æ›¿åŸæ¥çš„GB/T 7408-1994ï¼›ä¸­å›½å°æ¹¾é‡‡ç”¨CNS 7648çš„ã€Šèµ„æ–™å…ƒåŠäº¤æ¢æ ¼å¼â€“èµ„è®¯äº¤æ¢â€“æ—¥æœŸåŠæ—¶é—´çš„è¡¨ç¤ºæ³•ã€‹ï¼Œç§°ä¹‹ä¸ºä¸–ç•Œç»Ÿä¸€æ—¶é—´ã€‚ ä¸­å›½å¤§é™†ã€ä¸­å›½é¦™æ¸¯ã€ä¸­å›½æ¾³é—¨ã€ä¸­å›½å°æ¹¾ã€è’™å¤å›½ã€æ–°åŠ å¡ã€é©¬æ¥è¥¿äºšã€è²å¾‹å®¾ã€è¥¿æ¾³å¤§åˆ©äºšå·çš„æ—¶é—´ä¸UTCçš„æ—¶å·®å‡ä¸º+8ï¼Œä¹Ÿå°±æ˜¯UTC+8ã€‚ 2ã€å¦‚ä½•ä¿®æ”¹å…ˆä»‹ç»åœ¨Ubuntuä¸‹çš„è§£å†³æ–¹æ¡ˆã€‚ é¦–å…ˆæˆ‘ä»¬æŠŠç¡¬ä»¶æ—¶é—´ï¼ˆBIOSæ—¶é—´ï¼‰å°†é»˜è®¤çš„UTCæ”¹ä¸ºCSTï¼Œç„¶åé‡å¯ï¼Œä½¿å¾—ä¸¤ä¸ªç³»ç»Ÿçš„æ—¶é—´ä¿æŒä¸€è‡´ã€‚ 1234sudo timedatectl set-local-rtc 1#ä¸Šè¿°ä»£ç ä¸­çš„1æ”¹ä¸º0å³å¯å°†ç¡¬ä»¶æ—¶é—´ä¿®æ”¹ä¸ºé»˜è®¤çš„UTCæ—¶é—´sudo reboot#é‡å¯ç³»ç»Ÿä½¿æ”¹åŠ¨ç”Ÿæ•ˆ æ¥ç€æˆ‘ä»¬æ›´æ–°ä¸€ä¸‹ç³»ç»Ÿæ—¶é—´ 1234sudo apt-get install ntpdate#è¿™é‡Œçš„æ“ä½œæ˜¯å®‰è£…ntpdateå·¥å…·sudo ntpdate time.windows.com#ä½¿ç”¨ntpdateå·¥å…·ä»time.windows.comä¸Šé¢åŒæ­¥æ—¶é—´ æœ€åæˆ‘ä»¬å°†æ—¶é—´æ›´æ–°åˆ°ç¡¬ä»¶ä¸Šï¼Œä»¥ä¿è¯é‡å¯åæ”¹åŠ¨ä¸ä¼šè¢«è¿˜åŸ 12sudo hwclock --localtime --systohc#è¿™é‡Œçš„ä»£ç æ„æ€æ˜¯ä½¿ç”¨hwclockå‘½ä»¤å°†æœ¬åœ°æ—¶é—´localtimeä»sysclockåŒæ­¥åˆ°hwclock åˆ°è¿™é‡ŒåŒç³»ç»Ÿçš„æ—¶é—´å°±éƒ½æ­£å¸¸äº†ã€‚ æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨windowsä¸‹çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€powershellï¼Œç„¶åè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œæ¥ç€é‡å¯å°±å¯ä»¥äº†ã€‚ 1reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1 åŸç†å°±æ˜¯ï¼šåœ¨æ³¨å†Œè¡¨é¡¹HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformationä¸­æ·»åŠ ä¸€ä¸ªåä¸ºRealTimeIsUniversalçš„å€¼ï¼Œç±»å‹ä¸ºREG_DWORDï¼Œæ•°æ®ä¸º1ã€‚æ­¤é¡¹çš„ä½œç”¨å°±æ˜¯è®©Windowså°†ç¡¬ä»¶æ—¶é—´å½“ä½œUTCï¼Œä¸Ubuntuçš„é»˜è®¤è®¾ç½®ä¸€è‡´ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"}]},{"title":"æ ‘è“æ´¾3B+æ‰“é€ å¤šåª’ä½“ä¸­å¿ƒ","slug":"20180910-raspi-multi-media-centre","date":"2018-09-10T07:00:00.000Z","updated":"2018-09-10T07:00:00.000Z","comments":true,"path":"20180910-raspi-multi-media-centre/","link":"","permalink":"https://tinychen.com/20180910-raspi-multi-media-centre/","excerpt":"å°ä¸ƒæ¯”è¾ƒå–œæ¬¢åœ¨å®¿èˆå’Œå®¤å‹ä¸€èµ·çœ‹ç”µå½±æˆ–å¬éŸ³ä¹ï¼Œä¸”å¯¹ç”»è´¨å’ŒéŸ³è´¨è¦æ±‚è¾ƒé«˜ï¼Œä¸€èˆ¬éƒ½æ˜¯è§‚çœ‹1080Pçš„è“å…‰REMUXç”µå½±ï¼ˆçº¦30Gä¸€éƒ¨ï¼‰å’Œå¬æ— æŸéŸ³è´¨çš„éŸ³ä¹ï¼ˆ30Mä¸€é¦–ï¼‰ï¼Œä¸”è§‚çœ‹è®¾å¤‡è¾ƒå¤šï¼ˆç”µè§†ç›’å­ã€ç”µè„‘ã€æ‰‹æœºï¼‰ï¼Œå†åŠ ä¸Šå¹³æ—¶éœ€è¦ä¸‹è½½ç”µå½±ä¸”è‡ªå·±æœ‰å†™åšå®¢çš„ä¹ æƒ¯ï¼Œåšå®¢å’Œä¸€äº›å…¶ä»–çš„é‡è¦èµ„æ–™ä¹Ÿéœ€è¦å¤‡ä»½ï¼Œå› æ­¤å†³å®šä½¿ç”¨æ ‘è“æ´¾3B+ã€ä¸€å—ç§»åŠ¨ç¡¬ç›˜å’Œä¸€ä¸ªè·¯ç”±å™¨æ­å»ºä¸€ä¸ªå®¿èˆå¤šåª’ä½“ä¸­å¿ƒæ¥æ»¡è¶³è¿™äº›éœ€æ±‚ã€‚","text":"å°ä¸ƒæ¯”è¾ƒå–œæ¬¢åœ¨å®¿èˆå’Œå®¤å‹ä¸€èµ·çœ‹ç”µå½±æˆ–å¬éŸ³ä¹ï¼Œä¸”å¯¹ç”»è´¨å’ŒéŸ³è´¨è¦æ±‚è¾ƒé«˜ï¼Œä¸€èˆ¬éƒ½æ˜¯è§‚çœ‹1080Pçš„è“å…‰REMUXç”µå½±ï¼ˆçº¦30Gä¸€éƒ¨ï¼‰å’Œå¬æ— æŸéŸ³è´¨çš„éŸ³ä¹ï¼ˆ30Mä¸€é¦–ï¼‰ï¼Œä¸”è§‚çœ‹è®¾å¤‡è¾ƒå¤šï¼ˆç”µè§†ç›’å­ã€ç”µè„‘ã€æ‰‹æœºï¼‰ï¼Œå†åŠ ä¸Šå¹³æ—¶éœ€è¦ä¸‹è½½ç”µå½±ä¸”è‡ªå·±æœ‰å†™åšå®¢çš„ä¹ æƒ¯ï¼Œåšå®¢å’Œä¸€äº›å…¶ä»–çš„é‡è¦èµ„æ–™ä¹Ÿéœ€è¦å¤‡ä»½ï¼Œå› æ­¤å†³å®šä½¿ç”¨æ ‘è“æ´¾3B+ã€ä¸€å—ç§»åŠ¨ç¡¬ç›˜å’Œä¸€ä¸ªè·¯ç”±å™¨æ­å»ºä¸€ä¸ªå®¿èˆå¤šåª’ä½“ä¸­å¿ƒæ¥æ»¡è¶³è¿™äº›éœ€æ±‚ã€‚ 1ã€åŠŸèƒ½ç®€ä»‹1.1 SambaSambaæ˜¯åœ¨Linuxå’ŒUNIXç³»ç»Ÿä¸Šå®ç°SMBåè®®çš„ä¸€ä¸ªå…è´¹è½¯ä»¶ï¼Œç”±æœåŠ¡å™¨åŠå®¢æˆ·ç«¯ç¨‹åºæ„æˆã€‚SMBï¼ˆServer Messages Blockï¼Œä¿¡æ¯æœåŠ¡å—ï¼‰æ˜¯ä¸€ç§åœ¨å±€åŸŸç½‘ä¸Šå…±äº«æ–‡ä»¶å’Œæ‰“å°æœºçš„ä¸€ç§é€šä¿¡åè®®ï¼Œå®ƒä¸ºå±€åŸŸç½‘å†…çš„ä¸åŒè®¡ç®—æœºä¹‹é—´æä¾›æ–‡ä»¶åŠæ‰“å°æœºç­‰èµ„æºçš„å…±äº«æœåŠ¡ã€‚ æ¢è¨€ä¹‹ï¼Œä½¿ç”¨Sambaå¯ä»¥åœ¨å±€åŸŸç½‘å†…å®ç°æ–‡ä»¶çš„å…±äº«æ“ä½œï¼Œæœ‰äº›æ”¾åœ¨ç§»åŠ¨ç¡¬ç›˜é‡Œé¢çš„æ–‡ä»¶éœ€è¦ç”¨çš„æ—¶å€™å°±ä¸ç”¨å†æ’ç§»åŠ¨ç¡¬ç›˜ï¼Œåœ¨ç½‘ä¸Šé‚»å±…å¤„æ‹·è´å³å¯ã€‚ 1.2 miniDLNADLNAçš„å…¨ç§°æ˜¯DIGITAL LIVING NETWORK ALLIANCE(æ•°å­—ç”Ÿæ´»ç½‘ç»œè”ç›Ÿ)ï¼ŒDLNAå¹¶ä¸æ˜¯åˆ›é€ æŠ€æœ¯ï¼Œè€Œæ˜¯å½¢æˆä¸€ç§è§£å†³çš„æ–¹æ¡ˆï¼Œä¸€ç§å¤§å®¶å¯ä»¥éµå®ˆçš„è§„èŒƒã€‚ æ‰€ä»¥ï¼Œå…¶é€‰æ‹©çš„å„ç§æŠ€æœ¯å’Œåè®®éƒ½æ˜¯å½“å‰æ‰€åº”ç”¨å¾ˆå¹¿æ³›çš„æŠ€æœ¯å’Œåè®®ã€‚miniDLNAå¯ä»¥å®ç°éŸ³ä¹è§†é¢‘å›¾ç‰‡çš„å±€åŸŸç½‘è·¨è®¾å¤‡å…±äº«ï¼Œä¸”ç›®å‰å¤§å¤šæ•°æ™ºèƒ½æ‰‹æœºã€å¹³æ¿å’Œç”µè§†å‡æ”¯æŒDLNAåè®®ï¼Œåœ¨æ ‘è“æ´¾ä¸Šå®‰è£…miniDLNAæœåŠ¡åå³å¯è®©å¤„åœ¨åŒä¸€å±€åŸŸç½‘ä¸‹çš„è®¾å¤‡èƒ½è½»æ¾è®¿é—®åˆ°æ ‘è“æ´¾ä¸Šçš„å½±éŸ³èµ„æºã€‚ 1.3 ä¸‹è½½æœºTransmissionå…¨ç§°TransmissionBittorrentï¼Œç”±Cå¼€å‘è€Œæˆï¼ˆMac OSä¸Šç”¨çš„æ˜¯Objective-Cï¼‰ï¼Œç¡¬ä»¶èµ„æºæ¶ˆè€—æå°‘ï¼Œç•Œé¢æåº¦ç²¾ç®€ã€‚æ”¯æŒåŒ…æ‹¬Linuxã€BSDã€Solarisã€Mac OS Xç­‰å¤šç§æ“ä½œç³»ç»Ÿï¼Œä»¥åŠNetworked Media Tankã€WD MyBookã€ReadyNASã€D-Link DNS-323 &amp; CH3SNASã€Synologyç­‰å¤šç§è®¾å¤‡ã€‚æ”¯æŒGTK+ã€å‘½ä»¤è¡Œã€Webç­‰å¤šç§ç•Œé¢ã€‚ Aria2æ”¯æŒHttpã€FTPã€ç£åŠ›é“¾æ¥å’ŒBTä¸‹è½½ï¼Œå¯ä»¥å’ŒTransimissionäº’è¡¥ã€‚ 1.4 è‡ªåŠ¨å¤‡ä»½æ•°æ®å¤‡ä»½æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œä½†æ˜¯æ€»æ˜¯ä¼šæœ‰é—å¿˜æˆ–è€…æ˜¯ç–æ¼çš„æƒ…å†µå‡ºç°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ‘è“æ´¾æ¥å®ç°è‡ªåŠ¨å¤‡ä»½ã€‚é¦–å…ˆå¯ä»¥åˆ›å»ºpowershellå‘½ä»¤å®ç°å¤‡ä»½åŠŸèƒ½ï¼Œå†å¦å­˜ä¸ºbatè„šæœ¬æ–‡ä»¶ï¼Œæœ€ååˆ©ç”¨windowsè‡ªå¸¦çš„å®šæ—¶ä»»åŠ¡åŠŸèƒ½å’Œlinuxçš„å®šæ—¶æ‰§è¡Œå‘½ä»¤æ“ä½œæ¥å®ç°æ–‡ä»¶è‡ªåŠ¨å¤‡ä»½åˆ°æ ‘è“æ´¾ä¸Šçš„æ“ä½œã€‚ 1.5 çŠ¶æ€ç›‘æ§ä½œä¸ºé•¿æ—¶é—´è¿è¡Œçš„å¤šåª’ä½“ä¸­å¿ƒï¼Œæ ‘è“æ´¾çš„è¿è¡ŒçŠ¶æ€ä¸èƒ½å¿½è§†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨LCD1602æ˜¾ç¤ºå±è¿æ¥æ ‘è“æ´¾ï¼Œæ˜¾ç¤ºä¸€äº›å¿…è¦çš„ä¿¡æ¯æ¥ç›‘æ§å®ƒçš„è¿è¡ŒçŠ¶æ€ã€‚ï¼ˆCPUï¼ŒGPU, RAM, IP, TIMEï¼‰ 2ã€å®‰è£…æ“ä½œ2.1 Samba2.1.1 å®‰è£…ntfs-3gæ ‘è“æ´¾æ¥ä¸Šç§»åŠ¨ç¡¬ç›˜åï¼Œä¼šè‡ªåŠ¨æŒ‚è½½åˆ°/mediaç›®å½•ä¸‹ï¼Œä½†æ˜¯ç”±äºæˆ‘çš„ç¡¬ç›˜æ˜¯ntfsæ ¼å¼ï¼Œåœ¨æ ‘è“ç³»ç»Ÿä¸‹åªèƒ½è¯»ä¸èƒ½å†™ï¼Œå› æ­¤æˆ‘éœ€è¦å®‰è£…ntfs-3gæœåŠ¡å®ç°å¯¹ç§»åŠ¨ç¡¬ç›˜çš„å†™æ“ä½œï¼Œç„¶åå†è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ç§»åŠ¨ç¡¬ç›˜ã€‚ 12345sudo apt-get install ntfs-3g#å®‰è£…ntfs -3gæœåŠ¡sudo mkdir /home/pi/share#åˆ›å»ºç”¨äºæŒ‚è½½ç§»åŠ¨ç¡¬ç›˜çš„ç›®å½• 123456789101112sudo umount /dev/sda1#æœ‰äº›ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‚è½½ï¼Œå› æ­¤å…ˆä½¿ç”¨umontå‘½ä»¤å–æ¶ˆæŒ‚è½½ç§»åŠ¨ç¡¬ç›˜#åé¢çš„/dev/sda1æ˜¯ç¡¬ç›˜åœ¨æ­¤ç³»ç»Ÿä¸­å¯¹åº”çš„ç¼–å·ï¼Œå¯ä»¥ä½¿ç”¨ df -hå‘½ä»¤æŸ¥çœ‹ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ç¡¬ç›˜åä»£æ›¿sudo mount -t ntfs-3g /dev/sda1 /home/pi/share#ä½¿ç”¨ntfs -3gæŒ‚è½½ç¡¬ç›˜åˆ°æŒ‡å®šç›®å½•sudo chmod 777 /home/pi/share#ä½¿ç”¨chmodå‘½ä»¤èµ‹äºˆç›®å½•è¯»å†™æƒé™sudo chmod 777 /home/pi#ç›®å½•çš„ä¸Šçº§ç›®å½•ä¹Ÿéœ€è¦èµ‹äºˆè¯»å†™æƒé™ 1234567891011sudo vim /etc/fstab#ç¼–è¾‘/etc/fstabæ–‡ä»¶å®ç°å¼€æœºè‡ªåŠ¨æŒ‚è½½ç¡¬ç›˜#åœ¨æ–‡ä»¶çš„æœ€åä¸€è¡ŒåŠ å…¥ä¸‹åˆ—ä»£ç /dev/sda1 /home/pi/share ntfsdefaults0 0#ç¬¬ä¸€åˆ—æ˜¯æŒ‚è½½çš„ç¡¬ç›˜è®¾å¤‡åæˆ–è€…uuid#ç¬¬äºŒåˆ—æ˜¯æŒ‚è½½çš„ç›®å½•#ç¬¬ä¸‰åˆ—æ˜¯ç¡¬ç›˜çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹#ç¬¬å››åˆ—æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„å‚æ•°ï¼Œdefaultsè¡¨ç¤ºåŒæ—¶å…·æœ‰rw, suid, dev, exec, auto, nouser, asyncç­‰é»˜è®¤å‚æ•°çš„è®¾ç½®#ç¬¬äº”åˆ—æ˜¯èƒ½å¦è¢«dumpå¤‡ä»½å‘½ä»¤ä½œç”¨ï¼šdumpæ˜¯ä¸€ä¸ªç”¨æ¥ä½œä¸ºå¤‡ä»½çš„å‘½ä»¤ã€‚é€šå¸¸è¿™ä¸ªå‚æ•°çš„å€¼ä¸º0æˆ–è€…1ï¼Œ0è¡¨ç¤ºä¸å¤‡ä»½#ç¬¬å…­åˆ—æ˜¯æ˜¯å¦æ£€éªŒæ‰‡åŒºï¼šå¼€æœºçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿé»˜è®¤ä¼šä»¥fsckæ£€éªŒæˆ‘ä»¬ç³»ç»Ÿæ˜¯å¦ä¸ºå®Œæ•´ï¼ˆcleanï¼‰ã€‚0è¡¨ç¤ºä¸è¦æ£€éªŒ 2.1.2å®‰è£…Samba123456sudo apt-get update#é¦–å…ˆæ›´æ–°ä¸€ä¸‹ç³»ç»Ÿæºsudo apt-get install samba samba-common-bin#å®‰è£…samba-commonç‰ˆæœ¬#samba-commonï¼šè¿™ä¸ªå¥—ä»¶åˆ™ä¸»è¦æä¾›äº† SAMBA çš„ä¸»è¦è®¾å®šæ¡£(smb.conf) ã€ smb.conf è¯­æ³•æ£€éªŒçš„æµ‹è¯•ç¨‹åº ( testparm )ç­‰ç­‰ï¼› 12sudo vim /etc/samba/smb.conf#ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­åŠ å…¥ä¸‹åˆ—å†…å®¹ 123456789101112131415161718192021security = share#å¼€æ”¾securityæƒé™ç­‰çº§ä¸ºshare#share---ä¸éœ€è¦æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚#user----éœ€è¦æä¾›ç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œä¸”èº«ä»½éªŒè¯ç”± samba server è´Ÿè´£ã€‚#server--éœ€è¦æä¾›ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯æŒ‡å®šå…¶ä»–æœºå™¨(winNT/2000/XP)æˆ–å¦ä¸€å° samba serverä½œèº«ä»½éªŒè¯ã€‚#domain--éœ€è¦æä¾›ç”¨æˆ·åå’Œå¯†ç ï¼ŒæŒ‡å®šwinNT/2000/XPåŸŸæœåŠ¡å™¨ä½œèº«ä»½éªŒè¯ã€‚[share] #shareä¸ºå¼€å¯å…±äº«åçš„æ–‡ä»¶å¤¹åcomment = samba share #commentä¸ºå¤‡æ³¨ï¼Œå¸®åŠ©ç†è§£è¿™ä¸ªå…±äº«æ–‡ä»¶å¤¹path = /home/pi/share #pathä¸ºå…±äº«çš„æ–‡ä»¶ç›®å½•è·¯å¾„valid user = pi root #vaild users-----è®¾å®šåªæœ‰æ­¤åå•å†…çš„ç”¨æˆ·æ‰èƒ½è®¿é—®å…±äº«èµ„æº(æ‹’ç»ä¼˜å…ˆ)(ç”¨æˆ·å/@ç»„å)ï¼Œè¿™é‡Œè®¾ç½®ä¸ºpiå’Œrootä¸¤ä¸ªpublic = yes#public----------æ˜¯yes/å¦noå…¬å¼€å…±äº«ï¼Œè‹¥ä¸ºå¦åˆ™è¿›è¡Œèº«ä»½éªŒè¯(åªæœ‰å½“security = share æ—¶æ­¤é¡¹æ‰èµ·ä½œç”¨)browseable = yes#browseable------æ˜¯yes/å¦noåœ¨æµè§ˆèµ„æºä¸­æ˜¾ç¤ºå…±äº«ç›®å½•ï¼Œè‹¥ä¸ºå¦åˆ™å¿…é¡»æŒ‡å®šå…±äº«è·¯å¾„æ‰èƒ½å­˜å–writable = yes #writable--------æ˜¯yes/å¦noä¸ä»¥åªè¯»æ–¹å¼å…±äº«å½“ä¸read onlyå‘ç”Ÿå†²çªæ—¶ï¼Œæ— è§†read only 123456789101112sudo smbpasswd -a pi#æ–°å»ºä¸€ä¸ªåä¸ºpiçš„ç”¨æˆ·ï¼Œç„¶åä¼šæç¤ºè¾“å…¥ä¸¤æ¬¡å¯†ç #smbpasswdå‘½ä»¤çš„ä¸€äº›ç”¨æ³•å¦‚ä¸‹#-aï¼šå‘smbpasswdæ–‡ä»¶ä¸­æ·»åŠ ç”¨æˆ·ï¼›#-cï¼šæŒ‡å®šsambaçš„é…ç½®æ–‡ä»¶ï¼›#-xï¼šä»smbpasswdæ–‡ä»¶ä¸­åˆ é™¤ç”¨æˆ·ï¼›#-dï¼šåœ¨smbpasswdæ–‡ä»¶ä¸­ç¦ç”¨æŒ‡å®šçš„ç”¨æˆ·ï¼›#-eï¼šåœ¨smbpasswdæ–‡ä»¶ä¸­æ¿€æ´»æŒ‡å®šçš„ç”¨æˆ·ï¼›#-nï¼šå°†æŒ‡å®šçš„ç”¨æˆ·çš„å¯†ç ç½®ç©ºã€‚#è®¾ç½®å®Œç”¨æˆ·åå’Œå¯†ç åè¾“å…¥ä¸‹åˆ—å‘½ä»¤æ¿€æ´»ç”¨æˆ·sudo smbpasswd -e pi 12#ç„¶åé‡å¯sambaæœåŠ¡å³å¯ç”Ÿæ•ˆsudo /etc/init.d/samba restart 12345#æœ€åè¿˜æ˜¯è¦è®¾ç½®å¼€æœºå¯åŠ¨sudo vim /etc/rc.local#åœ¨ä¸‹é¢æ·»åŠ å¦‚ä¸‹ä»£ç sudo /etc/init.d/samba restart 2.1.3æ·»åŠ ç½‘ç»œæ˜ å°„æ·»åŠ ç½‘ç»œæ˜ å°„ä¸»è¦æ˜¯æ–¹ä¾¿è®¿é—®ï¼Œå¯ä»¥å°†å…±äº«çš„sambaæ–‡ä»¶å¤¹æ·»åŠ åˆ°æˆ‘çš„ç”µè„‘ä¸­ã€‚é¦–å…ˆå³é”®æˆ‘çš„ç”µè„‘ï¼Œç‚¹å‡»æ·»åŠ ç½‘ç»œæ˜ å°„/Add a network location è¾“å…¥å…±äº«çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œç„¶åå‘½åï¼Œæœ€åå³å¯å®Œæˆã€‚ 2.2 miniDLNA2.2.1 å®‰è£…miniDLNA12345sudo apt-get update#å…ˆæ›´æ–°ä¸€ä¸‹å®‰è£…æºsudo apt-get install minidlna#å®‰è£…minidlna 12345678910111213#å®‰è£…å®Œåç¼–è¾‘é…ç½®æ–‡ä»¶sudo vim /etc/minidlna.confmedia_dir=A,/home/pi/share/Music#Aè¡¨ç¤ºè¿™ä¸ªç›®å½•æ˜¯å­˜æ”¾éŸ³ä¹çš„ï¼Œå½“minidlnaè¯»åˆ°é…ç½®æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åŠ è½½è¿™ä¸ªç›®å½•ä¸‹çš„éŸ³ä¹æ–‡ä»¶ media_dir=P,/home/pi/share/Picture #Pè¡¨ç¤ºå›¾ç‰‡æ–‡ä»¶ media_dir=V,/home/pi/share/Video#Vè¡¨ç¤ºè§†é¢‘æ–‡ä»¶db_dir=/home/pi/share/dlnadb#é…ç½®minidlnaçš„æ•°åº“æ•°æ®çš„å­˜æ”¾ç›®å½• log_dir=/home/pi/share/dlnalog #é…ç½®æ—¥å¿—ç›®å½• 123456789101112131415161718#ç„¶åå»ºç«‹å¯¹åº”çš„æ–‡ä»¶å¤¹å¹¶ç»™äºˆå¯¹åº”çš„æƒé™sudo mkdir /home/pi/share/Musicsudo mkdir /home/pi/share/Picturesudo mkdir /home/pi/share/Videosudo mkdir /home/pi/share/dlnadbsudo mkdir /home/pi/share/dlnalogsudo chmod 777 /home/pi/share/Musicsudo chmod 777 /home/pi/share/Picturesudo chmod 777 /home/pi/share/Videosudo chmod 777 /home/pi/share/dlnadbsudo chmod 777 /home/pi/share/dlnalog#ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤é‡å¯dlnaæœåŠ¡sudo /etc/init.d/minidlna restart#å†ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æŸ¥çœ‹dlnaçŠ¶æ€sudo /etc/init.d/minidlna status 1234#æœ€åä¿®æ”¹å¼€æœºå¯åŠ¨æ–‡ä»¶sudo vim /etc/rc.local#åœ¨åé¢åŠ å…¥ä»¥ä¸‹ä»£ç sudo /etc/init.d/minidlna restart 2.2.2 æ·»åŠ DLNAè®¾å¤‡ç‚¹å‡»æˆ‘çš„ç”µè„‘å·¦ä¸Šæ–¹çš„æµåª’ä½“ ç³»ç»Ÿä¼šè‡ªåŠ¨æœç´¢åˆ°å±€åŸŸç½‘ä¸­çš„æ”¯æŒDLNAçš„è®¾å¤‡ï¼Œç‚¹å‡»æ·»åŠ ï¼Œç­‰å¾…æ·»åŠ å®Œæˆã€‚ æ‰“å¼€æ”¯æŒDLNAæˆ–è€…æ˜¯æµåª’ä½“æ’­æ”¾çš„è½¯ä»¶ï¼Œå°±èƒ½çœ‹åˆ°æ ‘è“æ´¾ä¸­çš„æµåª’ä½“æ–‡ä»¶ã€‚ 2.3 ä¸‹è½½æœº2.3.1 å®‰è£…transmission1234sudo apt-get update#å…ˆæ›´æ–°ä¸€ä¸‹å®‰è£…æºsudo apt-get install transmission-daemon#ç„¶åå®‰è£…transmission 12345678910111213#åˆ›å»ºç›®å½•ç”¨äºå­˜æ”¾ä¸‹è½½æ–‡ä»¶sudo mkdir /home/pi/share/Downloads/Incomplete #å­˜æ”¾æœªä¸‹è½½å®Œæˆçš„æ–‡ä»¶sudo mkdir /home/pi/share/Downloads/complete#å­˜æ”¾ä¸‹è½½å®Œæˆçš„æ–‡ä»¶#æ›´æ”¹æ–‡ä»¶æ‰€å±ç»„åˆ«sudo chgrp debian-transmission /home/pi/share/Downloads/Incompletesudo chgrp debian-transmission /home/pi/share/Downloads/complete#èµ‹äºˆæ–‡ä»¶å¤¹æƒé™sudo chmod 777 /home/pi/share/Downloads/Incomplete sudo chmod 777 /home/pi/share/Downloads/complete 123456789101112131415161718#ä¿®æ”¹é…ç½®æ–‡ä»¶sudo vim /etc/transmission-daemon/settings.json#æ‰¾åˆ°ä»¥ä¸‹é¡¹è¿›è¡Œä¿®æ”¹#å·²å®Œæˆçš„ä¸‹è½½ç›®å½•&quot;download-dir&quot;: &quot;/home/pi/share/Downloads/complete&quot;,#æœªå®Œæˆçš„ä¸‹è½½ç›®å½•&quot;incomplete-dir&quot;: &quot;/home/pi/share/Downloads/Incomplete&quot;,#å…è®¸Webè®¿é—®çš„ç™½åå•åœ°å€,è¿™é‡Œè¦æ ¹æ®è‡ªå·±çš„è·¯ç”±å™¨å®é™…IPåœ°å€è¿›è¡Œä¿®æ”¹&quot;rpc-whitelist&quot;: &quot;192.168.8.*&quot;,#ç™»å½•çš„ç”¨æˆ·åâ€œrpc-usernameâ€: â€œyournameâ€,#ç™»å½•çš„å¯†ç â€œrpc-passwordâ€: â€œyoursecretcodeâ€,#æœ€åä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„ä¸¤æ¡å‘½ä»¤å®Œæˆé‡å¯æœåŠ¡sudo service transmission-daemon reloadsudo service transmission-daemon restart æœ€åæˆ‘ä»¬è®¿é—®æ ‘è“æ´¾çš„IPå†åŠ ä¸Š9091ç«¯å£å°±èƒ½ç™»å½•åˆ°ä¸‹è½½ç•Œé¢ã€‚ 2.3.2 å®‰è£…Aria22.3.2.1 å®‰è£…Aria21234sudo apt-get update#æ›´æ–°ä¸€ä¸‹å®‰è£…æºsudo apt-get install aria2#å®‰è£…aria2 12345678#åœ¨/etcç›®å½•ä¸‹åˆ›å»ºaria2ç›®å½•ç”¨æ¥å­˜æ”¾é…ç½®æ–‡ä»¶ï¼šsudo mkdir /etc/aria2#åˆ›å»ºç©ºç™½çš„aria2.sessionæ–‡ä»¶ï¼šsudo touch /etc/aria2/aria2.session#åˆ›å»ºé…ç½®æ–‡ä»¶sudo vim /etc/aria2/aria2.conf 123456789101112131415#åœ¨è¯¥æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼šdir=/home/pi/share/Downloads#è®¾ç½®æ–‡ä»¶ä¸‹è½½çš„å­˜æ”¾ç›®å½• disable-ipv6=true #æ‰“å¼€rpcçš„ç›®çš„æ˜¯ä¸ºäº†ç»™webç®¡ç†ç«¯ç”¨ enable-rpc=true rpc-allow-origin-all=true rpc-listen-all=true #rpc-listen-port=6800 continue=true input-file=/etc/aria2/aria2.session save-session=/etc/aria2/aria2.session max-concurrent-downloads=3#è®¾ç½®æœ€å¤§åŒæ—¶ä¸‹è½½çš„ä»»åŠ¡æ•° 123456789101112#å¯åŠ¨aria2sudo aria2c --conf-path=/etc/aria2/aria2.conf#å¦‚æœæ²¡æœ‰æç¤ºä»»ä½•é”™è¯¯ä¿¡æ¯ï¼Œé‚£å°±æŒ‰ctrl+cåœæ­¢ä¸Šé¢çš„è¯­å¥ï¼Œè½¬ä¸ºåå°è¿è¡Œï¼šsudo aria2c --conf-path=/etc/aria2/aria2.conf ï¼D#åŒæ—¶å…¶æ­¤å¥å†™åˆ°å¼€æœºå¯åŠ¨ä¸­ï¼Œç¼–è¾‘/etc/rc.localsudo vim /etc/rc.local#åœ¨æ–‡ä»¶çš„æœ€åé¢æ·»åŠ è¿™ä¸€è¡Œsudo aria2c --conf-path=/etc/aria2/aria2.conf ï¼D 2.3.2.2 å®‰è£…appache12345#å®‰è£…appachsudo apt-get install apache2#ä¿®æ”¹/var/www/htmlçš„æƒé™chmod 777 /var/www/html 2.3.2.3 å®‰è£…yaawä»https://github.com/binux/yaawä¸‹è½½yaawï¼Œç‚¹å‡»å³ä¸‹è§’çš„Download Zip, ä¸‹è½½åå°†è§£å‹åçš„æ–‡ä»¶å¤¹å†…å®¹æ‹·è´åˆ°/var/www/htmlæ–‡ä»¶å¤¹ä¸‹ã€‚è¿™æ—¶åœ¨æµè§ˆå™¨å†…è¾“å…¥æ ‘è“æ´¾çš„IPï¼Œå¦‚æœå‡ºç°ä»¥ä¸‹é¡µé¢ï¼Œåˆ™è¡¨ç¤ºå·²ç»æ­£å¸¸å·¥ä½œäº†ã€‚ ç‚¹å‡»å·¦ä¸Šæ–¹çš„addå°±å¯ä»¥è¿›è¡Œä¸‹è½½ã€‚ 2.4 è‡ªåŠ¨å¤‡ä»½2.4.1 åˆ›å»ºè‡ªåŠ¨æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨è®°äº‹æœ¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢è¾“å…¥ä¸‹åˆ—ä»£ç ï¼Œç„¶åä¿å­˜å¹¶æ›´æ”¹æ–‡ä»¶ååç¼€ä¸ºbatæ‰§è¡Œæ–‡ä»¶ã€‚ 1234@echo offecho Backuping D:\\MyBlog\\source\\_posts---------&gt;192.168.8.106\\share\\Backupxcopy &quot;D:\\MyBlog\\source\\_posts&quot; &quot;\\\\RASPBERRYPI\\share\\Backup&quot; /e/I/d/h/r/yexit å…¶ä¸­xcopyæŒ‡ä»¤åä¸¤ä¸ªè·¯å¾„åˆ†åˆ«ä¸ºéœ€è¦å¤‡ä»½çš„æ–‡ä»¶å¤¹è·¯å¾„å’Œç”¨äºå­˜æ”¾å¤‡ä»½çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œå…¶ä½™å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š /eï¼šæ‹·è´æ‰€æœ‰å­ç›®å½•ï¼ŒåŒ…æ‹¬ç©ºå­ç›®å½•ï¼› /Iï¼š å¦‚æœç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨ä¸”æ‹·è´çš„æ–‡ä»¶æ•°å¤šäºä¸€ï¼Œåˆ™å‡è®¾ç›®æ ‡ä¸ºç›®å½•ï¼› /dï¼šåªæ‹·è´æ–‡ä»¶æ—¥æœŸä¸åœ¨ç›®æ ‡æ–‡ä»¶åçš„æ–‡ä»¶ï¼ˆå³ä¿®æ”¹è¿‡çš„æºæ–‡ä»¶ï¼‰ /hï¼šåŒæ—¶æ‹·è´éšè—æ–‡ä»¶å’Œç³»ç»Ÿæ–‡ä»¶ /rï¼šæ‹·è´å¹¶è¦†ç›–åªè¯»æ–‡ä»¶ /yï¼š å¤åˆ¶æ–‡ä»¶å®¡æ ¸è®¾ç½®ï¼ˆä¸æ˜¾ç¤ºå·²æœ‰æ–‡ä»¶è¦†ç›–ç¡®è®¤ï¼‰ ä»¥ä¸Šå‚æ•°å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ ï¼Œæ¨èéƒ½åŠ ä¸Šæœ€å¥½ã€‚ 2.4.2 è®¾ç½®å®šæ—¶ä»»åŠ¡ç„¶åæˆ‘ä»¬æ‰“å¼€â€æ§åˆ¶é¢æ¿â€â€”â€œè®¡åˆ’ä»»åŠ¡â€æ·»åŠ è®¡åˆ’ä»»åŠ¡ï¼Œè®¡åˆ’ä»»åŠ¡é‡Œçš„æ‰§è¡Œç›®æ ‡ä¸ºè¯¥æ‰¹å¤„ç†æ–‡ä»¶ï¼Œè®¾å®šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œåˆ™ç”±ä¸ªäººå†³å®šã€‚ æ‰§è¡Œæ•ˆæœç¤ºä¾‹å¦‚ä¸‹ï¼š 2.5 çŠ¶æ€ç›‘æ§æŒ‰ç…§é’ˆè„šè·³çº¿è¿æ¥å¥½LCD1602å’Œæ ‘è“æ´¾å¹¶è°ƒèŠ‚å¥½LCD1602çš„å¯¹æ¯”åº¦ï¼Œä½¿ç”¨pythonç¼–å†™ä»£ç ï¼Œæ§åˆ¶1602è¾“å‡ºç›¸å…³ä¿¡æ¯ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š å°†ä¸‹é¢è¿™ä¸ªæ–‡ä»¶ä¿å­˜ä¸ºlcd1602.py 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#!/usr/bin/python ## based on code from lrvick and LiquidCrystal# lrvic - https://github.com/lrvick/raspi-hd44780/blob/master/hd44780.py# LiquidCrystal - https://github.com/arduino/Arduino/blob/master/libraries/LiquidCrystal/LiquidCrystal.cpp# from time import sleep class lcd1602: # commandsLCD_CLEARDISPLAY= 0x01LCD_RETURNHOME = 0x02LCD_ENTRYMODESET= 0x04LCD_DISPLAYCONTROL = 0x08LCD_CURSORSHIFT = 0x10LCD_FUNCTIONSET = 0x20LCD_SETCGRAMADDR= 0x40LCD_SETDDRAMADDR= 0x80 # flags for display entry modeLCD_ENTRYRIGHT = 0x00LCD_ENTRYLEFT = 0x02LCD_ENTRYSHIFTINCREMENT = 0x01LCD_ENTRYSHIFTDECREMENT = 0x00 # flags for display on/off controlLCD_DISPLAYON = 0x04LCD_DISPLAYOFF = 0x00LCD_CURSORON= 0x02LCD_CURSOROFF = 0x00LCD_BLINKON = 0x01LCD_BLINKOFF= 0x00 # flags for display/cursor shiftLCD_DISPLAYMOVE = 0x08LCD_CURSORMOVE = 0x00 # flags for display/cursor shiftLCD_DISPLAYMOVE = 0x08LCD_CURSORMOVE = 0x00LCD_MOVERIGHT = 0x04LCD_MOVELEFT= 0x00 # flags for function setLCD_8BITMODE= 0x10LCD_4BITMODE= 0x00LCD_2LINE = 0x08LCD_1LINE = 0x00LCD_5x10DOTS= 0x04LCD_5x8DOTS = 0x00 â€‹â€‹ 12345678910111213141516171819202122232425262728293031323334def __init__(self, pin_rs=14, pin_e=15, pins_db=[17, 18, 27, 22], GPIO = None):# Emulate the old behavior of using RPi.GPIO if we haven&#x27;t been given# an explicit GPIO interface to useif not GPIO:import RPi.GPIO as GPIOself.GPIO = GPIOself.pin_rs = pin_rsself.pin_e = pin_eself.pins_db = pins_db self.GPIO.setmode(GPIO.BCM)self.GPIO.setwarnings(False)self.GPIO.setup(self.pin_e, GPIO.OUT)self.GPIO.setup(self.pin_rs, GPIO.OUT) for pin in self.pins_db:self.GPIO.setup(pin, GPIO.OUT) self.write4bits(0x33) # initializationself.write4bits(0x32) # initializationself.write4bits(0x28) # 2 line 5x7 matrixself.write4bits(0x0C) # turn cursor off 0x0E to enable cursorself.write4bits(0x06) # shift cursor right self.displaycontrol = self.LCD_DISPLAYON | self.LCD_CURSOROFF | self.LCD_BLINKOFF self.displayfunction = self.LCD_4BITMODE | self.LCD_1LINE | self.LCD_5x8DOTSself.displayfunction |= self.LCD_2LINE &quot;&quot;&quot; Initialize to default text direction (for romance languages) &quot;&quot;&quot;self.displaymode = self.LCD_ENTRYLEFT | self.LCD_ENTRYSHIFTDECREMENTself.write4bits(self.LCD_ENTRYMODESET | self.displaymode) # set the entry mode self.clear() â€‹ 123456def begin(self, cols, lines): if (lines &gt; 1):self.numlines = linesself.displayfunction |= self.LCD_2LINEself.currline = 0 â€‹ 1234def home(self): self.write4bits(self.LCD_RETURNHOME) # set cursor position to zeroself.delayMicroseconds(3000) # this command takes a long time! â€‹ 1234def clear(self): self.write4bits(self.LCD_CLEARDISPLAY) # command to clear displayself.delayMicroseconds(3000)# 3000 microsecond sleep, clearing the display takes a long time â€‹ 12345678def setCursor(self, col, row): self.row_offsets = [ 0x00, 0x40, 0x14, 0x54 ] if ( row &gt; self.numlines ): row = self.numlines - 1 # we count rows starting w/0 self.write4bits(self.LCD_SETDDRAMADDR | (col + self.row_offsets[row])) â€‹ 12345def noDisplay(self): &quot;&quot;&quot; Turn the display off (quickly) &quot;&quot;&quot; self.displaycontrol &amp;= ~self.LCD_DISPLAYONself.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol) â€‹ 12345def display(self):&quot;&quot;&quot; Turn the display on (quickly) &quot;&quot;&quot; self.displaycontrol |= self.LCD_DISPLAYONself.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol) â€‹ 12345def noCursor(self):&quot;&quot;&quot; Turns the underline cursor on/off &quot;&quot;&quot; self.displaycontrol &amp;= ~self.LCD_CURSORONself.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol) â€‹ 12345def cursor(self):&quot;&quot;&quot; Cursor On &quot;&quot;&quot; self.displaycontrol |= self.LCD_CURSORONself.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol) â€‹ 12345def noBlink(self):&quot;&quot;&quot; Turn on and off the blinking cursor &quot;&quot;&quot; self.displaycontrol &amp;= ~self.LCD_BLINKONself.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol) â€‹ 12345def noBlink(self):&quot;&quot;&quot; Turn on and off the blinking cursor &quot;&quot;&quot; self.displaycontrol &amp;= ~self.LCD_BLINKONself.write4bits(self.LCD_DISPLAYCONTROL | self.displaycontrol) â€‹ 1234def DisplayLeft(self):&quot;&quot;&quot; These commands scroll the display without changing the RAM &quot;&quot;&quot; self.write4bits(self.LCD_CURSORSHIFT | self.LCD_DISPLAYMOVE | self.LCD_MOVELEFT) â€‹ 1234def scrollDisplayRight(self):&quot;&quot;&quot; These commands scroll the display without changing the RAM &quot;&quot;&quot; self.write4bits(self.LCD_CURSORSHIFT | self.LCD_DISPLAYMOVE | self.LCD_MOVERIGHT); â€‹ 12345def leftToRight(self):&quot;&quot;&quot; This is for text that flows Left to Right &quot;&quot;&quot; self.displaymode |= self.LCD_ENTRYLEFTself.write4bits(self.LCD_ENTRYMODESET | self.displaymode); â€‹ 1234def rightToLeft(self):&quot;&quot;&quot; This is for text that flows Right to Left &quot;&quot;&quot;self.displaymode &amp;= ~self.LCD_ENTRYLEFTself.write4bits(self.LCD_ENTRYMODESET | self.displaymode) â€‹ 12345def autoscroll(self):&quot;&quot;&quot; This will &#x27;right justify&#x27; text from the cursor &quot;&quot;&quot; self.displaymode |= self.LCD_ENTRYSHIFTINCREMENTself.write4bits(self.LCD_ENTRYMODESET | self.displaymode) â€‹ 12345def noAutoscroll(self): &quot;&quot;&quot; This will &#x27;left justify&#x27; text from the cursor &quot;&quot;&quot; self.displaymode &amp;= ~self.LCD_ENTRYSHIFTINCREMENTself.write4bits(self.LCD_ENTRYMODESET | self.displaymode) â€‹ 1234567891011121314151617181920212223242526def write4bits(self, bits, char_mode=False):&quot;&quot;&quot; Send command to LCD &quot;&quot;&quot; self.delayMicroseconds(1000) # 1000 microsecond sleep bits=bin(bits)[2:].zfill(8) self.GPIO.output(self.pin_rs, char_mode) for pin in self.pins_db:self.GPIO.output(pin, False) for i in range(4):if bits[i] == &quot;1&quot;:self.GPIO.output(self.pins_db[::-1][i], True) self.pulseEnable() for pin in self.pins_db:self.GPIO.output(pin, False) for i in range(4,8):if bits[i] == &quot;1&quot;:self.GPIO.output(self.pins_db[::-1][i-4], True) self.pulseEnable() â€‹ 123def delayMicroseconds(self, microseconds):seconds = microseconds / float(1000000) # divide microseconds by 1 million for secondssleep(seconds) â€‹ 1234567def pulseEnable(self):self.GPIO.output(self.pin_e, False)self.delayMicroseconds(1) # 1 microsecond pause - enable pulse must be &gt; 450ns self.GPIO.output(self.pin_e, True)self.delayMicroseconds(1) # 1 microsecond pause - enable pulse must be &gt; 450ns self.GPIO.output(self.pin_e, False)self.delayMicroseconds(1) # commands need &gt; 37us to settle â€‹ 12345678def message(self, text):&quot;&quot;&quot; Send string to LCDã€Newline wraps to second line&quot;&quot;&quot; for char in text:if char == &#x27;\\n&#x27;:self.write4bits(0xC0) # next lineelse:self.write4bits(ord(char),True) â€‹ 12345if __name__ == &#x27;__main__&#x27;: lcd = lcd1602()lcd.clear()lcd.message(&quot;hello world!&quot;) å†å°†è¿™ä¸ªæ–‡ä»¶ä¿å­˜ä¸º1602.py 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#!/usr/bin/python from lcd1602 import *from datetime import *import commands def get_cpu_temp():tmp = open(&#x27;/sys/class/thermal/thermal_zone0/temp&#x27;)cpu = tmp.read()tmp.close()return &#x27;&#123;:.2f&#125;&#x27;.format( float(cpu)/1000 ) + &#x27; C&#x27; def get_gpu_temp():tmp = commands.getoutput(&#x27;vcgencmd measure_temp|awk -F= \\&#x27;&#123;print $2&#125;\\&#x27;&#x27;).replace(&#x27;\\&#x27;C&#x27;,&#x27;&#x27;)gpu = float(tmp)return &#x27;&#123;:.2f&#125;&#x27;.format( gpu ) + &#x27; C&#x27; def get_time_now():return datetime.now().strftime(&#x27;%H:%M:%S\\n %Y-%m-%d&#x27;) def get_ip_info():ip= commands.getoutput(&#x27;ifconfig eth0 | grep inet | awk \\&#x27;&#123; print $2 &#125;\\&#x27; | awk \\&#x27;NR==1\\&#x27;&#x27;)return &#x27;Ethernet IP:\\n&#x27; + ip def get_mem_info():total= commands.getoutput(&#x27;free -m|grep Mem:|awk \\&#x27;&#123;print $2&#125;\\&#x27;&#x27;) free= commands.getoutput(&#x27;free -m|grep Mem:|awk \\&#x27;&#123;print $4&#125;\\&#x27;&#x27;)return &#x27;MEM:\\n&#x27; + free +&#x27;/&#x27;+ total +&#x27;M&#x27; lcd = lcd1602()lcd.clear() if __name__ == &#x27;__main__&#x27;: while(1):lcd.clear()lcd.message( get_ip_info() )sleep(5) lcd.clear()lcd.message( get_time_now() )sleep(5) lcd.clear()lcd.message( get_mem_info() )sleep(5) lcd.clear()lcd.message( &#x27;CPU: &#x27; + get_cpu_temp()+&#x27;\\n&#x27; )lcd.message( &#x27;GPU: &#x27; + get_gpu_temp() )sleep(5) æœ€åå°†ä¸¤ä¸ªæ–‡ä»¶ä¿å­˜åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹é¢ï¼Œç„¶åç¼–è¾‘æ–‡ä»¶è®¾ç½®å¼€æœºå¯åŠ¨å³å¯è®©LCD1602å¾ªç¯æ˜¾ç¤ºä¿¡æ¯ã€‚ æˆ‘å°†è¿™ä¸¤ä¸ªæ–‡ä»¶ä¿å­˜åˆ°/home/pi/1602ç›®å½•ä¸‹ 1234#ç¼–è¾‘é…ç½®æ–‡ä»¶sudo vim /etc/rc.local#å°†æ­¤å‘½ä»¤æ·»åŠ åˆ°æ–‡ä»¶æœ€åsudo python /home/pi/1602/1602.py 3ã€çˆ¬è™«æœåŠ¡å™¨3.1 Pythonæºç ç¤ºä¾‹123456789101112#encoding=&#x27;UTF-8&#x27;from urllib import requestimport jsonimport timefrom datetime import datetimefrom datetime import timedeltaimport pandas as pdfrom lxml import etreefrom tqdm import tqdmimport randomimport reimport csv 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556# è·å–æ•°æ®ï¼Œæ ¹æ®urlè·å–def get_data(url):headers = &#123;&#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36&#x27;&#125;req = request.Request(url, headers=headers)response = request.urlopen(req)if response.getcode() == 200:return response.read()return None# å¤„ç†æ•°æ®def parse_data(html):data = json.loads(html)[&#x27;cmts&#x27;] # å°†strè½¬æ¢ä¸ºjsoncomments = []for item in data:comment = &#123;&#x27;id&#x27;: item[&#x27;id&#x27;],#&#x27;nickName&#x27;: item[&#x27;nickName&#x27;],&#x27;cityName&#x27;: item[&#x27;cityName&#x27;] if &#x27;cityName&#x27; in item else &#x27;&#x27;, # å¤„ç†cityNameä¸å­˜åœ¨çš„æƒ…å†µ# å¤„ç†è¯„è®ºå†…å®¹æ¢è¡Œçš„æƒ…å†µ,å¹¶ä¸”å°†é€—å·æ›¿æ¢ä¸ºç©ºæ ¼&#x27;content&#x27;: item[&#x27;content&#x27;].replace(&#x27;â€&#x27;,&#x27; &#x27;).replace(&#x27;â€œ&#x27;,&#x27; &#x27;).replace(&#x27;,&#x27;,&#x27; &#x27;).replace(&#x27;ï¼Œ&#x27;,&#x27; &#x27;).replace(&#x27;\\n&#x27;, &#x27; &#x27;), &#x27;score&#x27;: item[&#x27;score&#x27;],&#x27;startTime&#x27;: item[&#x27;startTime&#x27;]&#125;comments.append(comment)return comments# å­˜å‚¨æ•°æ®ï¼Œå­˜å‚¨åˆ°æ–‡æœ¬æ–‡ä»¶def savetoCSV():#è®¾ç½®æŒ‡å®šæ—¶é—´å‘å‰çˆ¬å–è¯„è®ºæ•°æ®æˆ–è€…ä»ç‰¹å®šçš„æ—¶é—´æ®µçˆ¬å–è¯„è®º#start_time = &#x27;2015-05-12 02:40:34&#x27;start_time = datetime.now().strftime(&#x27;%Y-%m-%d %H:%M:%S&#x27;) # è·å–å½“å‰æ—¶é—´ï¼Œä»å½“å‰æ—¶é—´å‘å‰è·å–#è®¾ç½®çˆ¬å–è¯„è®ºæ•°æ®çš„æˆªè‡³æ—¶é—´end_time = &#x27;2015-05-01 00:00:00&#x27;while start_time &gt; end_time:url = &#x27;http://m.maoyan.com/mmdb/comments/movie/248170.json?_v_=yes&amp;offset=0&amp;startTime=&#x27; + start_time.replace(&#x27; &#x27;, &#x27;%20&#x27;)html = None&#x27;&#x27;&#x27;é—®é¢˜ï¼šå½“è¯·æ±‚è¿‡äºé¢‘ç¹æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ‹’ç»è¿æ¥ï¼Œå®é™…ä¸Šæ˜¯æœåŠ¡å™¨çš„åçˆ¬è™«ç­–ç•¥è§£å†³ï¼š1.åœ¨æ¯ä¸ªè¯·æ±‚é—´å¢åŠ å»¶æ—¶0.1ç§’ï¼Œå°½é‡å‡å°‘è¯·æ±‚è¢«æ‹’ç» 2.å¦‚æœè¢«æ‹’ç»ï¼Œåˆ™0.5ç§’åé‡è¯•&#x27;&#x27;&#x27;try:html = get_data(url)except Exception as e:time.sleep(0.5)html = get_data(url)else:time.sleep(0.1)comments = parse_data(html)print(comments)start_time = comments[14][&#x27;startTime&#x27;] # è·å¾—æœ«å°¾è¯„è®ºçš„æ—¶é—´start_time = datetime.strptime(start_time, &#x27;%Y-%m-%d %H:%M:%S&#x27;) + timedelta(seconds=-1) # è½¬æ¢ä¸ºdatetimeç±»å‹ï¼Œå‡1ç§’ï¼Œé¿å…è·å–åˆ°é‡å¤æ•°æ®start_time = datetime.strftime(start_time, &#x27;%Y-%m-%d %H:%M:%S&#x27;) # è½¬æ¢ä¸ºstr â€‹ 1234for item in comments:with open(&#x27;test3.csv&#x27;, &#x27;a&#x27;, encoding=&#x27;utf-8&#x27;) as f:f.write(str(item[&#x27;id&#x27;]) + &#x27;,&#x27; + item[&#x27;startTime&#x27;].strip(&#x27;[\\&#x27;&#x27;).split(&#x27; &#x27;)[0] + &#x27;,&#x27; + str(item[&#x27;score&#x27;]) + &#x27;,&#x27; + item[&#x27;cityName&#x27;] + &#x27;,&#x27; + str(item[&#x27;content&#x27;]) + &#x27;\\n&#x27;)#f.write(str(item[&#x27;id&#x27;])+&#x27;,&#x27;+item[&#x27;nickName&#x27;] + &#x27;,&#x27; + item[&#x27;cityName&#x27;] + &#x27;,&#x27; + item[&#x27;content&#x27;] + &#x27;,&#x27; + str(item[&#x27;score&#x27;])+ &#x27;,&#x27; + item[&#x27;startTime&#x27;] + &#x27;\\n&#x27;) â€‹â€‹ 12345if __name__ == &#x27;__main__&#x27;:html = get_data(&#x27;http://m.maoyan.com/mmdb/comments/movie/248170.json?_v_=yes&amp;offset=0&amp;startTime=2018-12-31%2022%3A25%3A03&#x27;)comments = parse_data(html)print(comments)savetoCSV() 3.2 æ•ˆæœå±•ç¤º 4ã€å†™åœ¨æœ€åé‡å¯ä¹‹åå°±å¯ä»¥å°½æƒ…åœ°äº«ç”¨æ ‘è“æ´¾æ‰“é€ çš„å¤šåª’ä½“ä¸­å¿ƒäº†ï¼Œè™½ç„¶æ ‘è“æ´¾3B+åªæœ‰USB2.0æ¥å£ï¼Œä½†æ˜¯åªè¦æ­é…ä¸Šç™¾å…†lanå£çš„è·¯ç”±å™¨ï¼Œå±€åŸŸç½‘å†…æµç•…è§‚çœ‹40Gå·¦å³å¤§å°çš„ä¸€éƒ¨ç”µå½±è¿˜æ˜¯æ¯«æ— é—®é¢˜çš„ã€‚ å¦‚æœæœ‰æ›´é«˜çš„éœ€æ±‚ï¼Œè¿˜æ˜¯å»ºè®®ä¸Šæ›´å¥½çš„è·¯ç”±å™¨å’ŒNASå§ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"}]},{"title":"Android Studioé…ç½®","slug":"20180824-androidstudio-install","date":"2018-08-24T07:00:00.000Z","updated":"2018-08-24T07:00:00.000Z","comments":true,"path":"20180824-androidstudio-install/","link":"","permalink":"https://tinychen.com/20180824-androidstudio-install/","excerpt":"(å¤šå›¾é¢„è­¦ï¼ï¼ï¼)Android Studioä½œä¸ºè°·æ­Œå®˜æ–¹çš„å®‰å“å¼€å‘å·¥å…·ï¼Œé…ç½®ä¸Šå¹¶ä¸ç®—å¤ªéš¾ï¼Œä½†æ˜¯æœ‰äº›åœ°æ–¹éœ€è¦é¢å¤–æ³¨æ„ä¸€ä¸‹ã€‚","text":"(å¤šå›¾é¢„è­¦ï¼ï¼ï¼)Android Studioä½œä¸ºè°·æ­Œå®˜æ–¹çš„å®‰å“å¼€å‘å·¥å…·ï¼Œé…ç½®ä¸Šå¹¶ä¸ç®—å¤ªéš¾ï¼Œä½†æ˜¯æœ‰äº›åœ°æ–¹éœ€è¦é¢å¤–æ³¨æ„ä¸€ä¸‹ã€‚ æ³¨æ„ï¼šæœ¬æ–‡éµå¾ªä¸€æ­¥ä¸€æˆªå›¾çš„åŸåˆ™ï¼Œå°½é‡è¯¦ç»†ï¼ˆä¹Ÿå¯èƒ½æœ‰ç‚¹å†—é•¿ï¼‰ï¼Œå¸Œæœ›å„ä½åŒå­¦æ³¨æ„è€å¿ƒã€æ—¶é—´å’Œæµé‡ã€‚ 1ã€é…ç½®JDKå®‰è£…Android Studioï¼ˆä»¥ä¸‹ç®€ç§°ASï¼‰ï¼Œéœ€è¦å…ˆé…ç½®JAVAï¼Œè¿˜æ²¡æœ‰é…ç½®çš„åŒå­¦å¯ä»¥ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥çœ‹å°ä¸ƒä¹‹å‰çš„æ•™ç¨‹ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚ JDKå®‰è£…ä¸ç¯å¢ƒå˜é‡é…ç½® 2ã€ä¸‹è½½ASç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå›½å†…æ— æ³•ç›´æ¥ä¸Šè°·æ­Œçš„å®˜ç½‘ï¼Œä½†æ˜¯å¯¹äºASçš„ä¸‹è½½ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ æˆ‘ä»¬ç™»å½•è¿™ä¸ªç½‘å€ï¼š http://www.android-studio.org/ é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ï¼Œä¸€èˆ¬æ¥è¯´å¯¹äºæ–°æ‰‹å»ºè®®ä¸‹è½½exeæ–‡ä»¶è¿›è¡Œå®‰è£…ï¼Œå¦‚æœå¯¹ASå·²ç»æœ‰ä¸€å®šçš„äº†è§£åˆ™å¯ä»¥ä¸‹è½½zipæ–‡ä»¶ç›´æ¥è§£å‹è¿›è¡Œä½¿ç”¨ã€‚ 3ã€å®‰è£…AS3.1 æ–°å»ºå®‰è£…ç›®å½•ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘åœ¨Dç›˜æ ¹ç›®å½•ä¸‹é¢æ–°å»ºäº†ä¸€ä¸ªAndroidçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å†æ–°å»ºä¸‰ä¸ªåˆ†åˆ«åä¸ºAndroidStudioã€AndroidProjectå’ŒAndroidSDKçš„æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾AS,Androidçš„é¡¹ç›®å’ŒASçš„SDKã€‚ å»ºè®®ä¸è¦åœ¨Cç›˜æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹ï¼Œå®¹æ˜“å‡ºç°æƒé™é—®é¢˜ï¼Œä¹Ÿä¸€å®šä¸è¦ä½¿ç”¨ä¸­æ–‡åç»™æ–‡ä»¶å¤¹å‘½åï¼ŒåŒ…æ‹¬ä½ ç°åœ¨ç™»å½•åˆ°windowsç³»ç»Ÿçš„ç”¨æˆ·åä¹Ÿä¸è¦æ˜¯ä¸­æ–‡åï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚ 3.2 è¿è¡Œexeå®‰è£…æ–‡ä»¶â–²åŒå‡»è¿è¡Œå®‰è£…æ–‡ä»¶ï¼Œç‚¹å‡»Next â–²æ­¤å¤„å‹¾é€‰Android Virtual Device(AVD)ï¼Œå³å®‰å“è™šæ‹Ÿæœºï¼Œå¯ä»¥åœ¨ä¸è¿æ¥å®‰å“æ‰‹æœºçš„æƒ…å†µä¸‹è¿›è¡Œé¡¹ç›®çš„è°ƒè¯• â–²æ­¤å¤„å³ä¸ºASçš„å®‰è£…ç›®å½•ï¼Œå°†å…¶æ›´æ”¹ä¸ºæˆ‘ä»¬ä¹‹å‰çš„æ–°å»ºçš„å®‰è£…ç›®å½•ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨é»˜è®¤ç›®å½•ï¼ â–²è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä¾¿æ˜¯æ›´æ”¹äº†å®‰è£…ç›®å½•ï¼Œä¹Ÿä¼šåœ¨ç³»ç»Ÿçš„Usersæ–‡ä»¶å¤¹å¯¹åº”çš„è´¦æˆ·ä¸‹é¢æ–°å»ºä¸€ä¸ª.androidæ–‡ä»¶å¤¹,å› æ­¤è¿™ä¸ªè´¦æˆ·åæ³¨æ„ä¸èƒ½æ˜¯ä¸­æ–‡ï¼Œå¦åˆ™åé¢ä¼šæŠ¥é”™ã€‚ â–²åˆ°è¿™é‡ŒASå°±å·²ç»ç®—æ˜¯åŸºæœ¬å®‰è£…å®Œæˆäº†ï¼Œä½†æ˜¯ASéœ€è¦çš„å…¶ä»–çš„ä¸€äº›æ’ä»¶éƒ½è¿˜æ²¡æœ‰å®‰è£…ï¼Œå› æ­¤æˆ‘ä»¬å‹¾é€‰Startï¼Œç‚¹å‡»Finishã€‚ 4ã€å®‰è£…SDKå’ŒAVDâ–²åˆæ¬¡è¿è¡ŒASä¼šæç¤ºä½ æ˜¯å¦éœ€è¦å¯¼å…¥ä¹‹å‰çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæœ‰åŒå­¦ä¹‹å‰ä½¿ç”¨è¿‡ASå¹¶ä¸”å¯¼å‡ºäº†é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œåªéœ€è¦ç›´æ¥å¯¼å…¥å°±å¯ä»¥äº†ï¼Œæ²¡æœ‰çš„åŒå­¦ç›´æ¥ç‚¹å‡»Do notç„¶åOKã€‚ â–²è¿™æ—¶å€™å°±ä¼šå¼¹å‡ºæç¤ºè¯´æ‰¾ä¸åˆ°Android SDKï¼Œæˆ‘ä»¬ä¸éœ€è¦è®¾ç½®ä»£ç†ï¼Œç›´æ¥ç‚¹å‡»å³è¾¹çš„Cancel â–²ç‚¹å‡»å³è¾¹çš„Cancelä¹‹åä¼šå¼€å§‹ä¸‹è½½ä¸€äº›é…ç½®æ–‡ä»¶ â–²ä¸‹è½½å®Œæˆä¹‹åå°±ä¼šå¼€å§‹é…ç½®SDK â–²åŒæ ·è¿˜æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘ä»¬åœ¨å®‰è£…é€‰é¡¹è¿™é‡Œé€‰æ‹©Customï¼ˆè‡ªå®šä¹‰ï¼‰ â–²é¦–å…ˆè¿›è¡Œé€‰æ‹©çš„æ˜¯ç•Œé¢é£æ ¼ï¼Œæœ‰æ˜æš—ä¸¤ç§è‰²è°ƒï¼Œåƒå°ä¸ƒè¿™ç§å¤œçŒ«å­æœæ–­é€‰æš—è‰²è°ƒã€‚ â–²è¿™é‡Œä¼šè‡ªåŠ¨é€‰æ‹©æœ€æ–°çš„SDKå’ŒAPIï¼Œä¸è¿‡æˆ‘ä»¬è¦æ›´æ”¹ä¸‹é¢çš„å®‰è£…ç›®å½•ä¸ºæˆ‘ä»¬ä¹‹å‰å‡†å¤‡å¥½çš„æ–°ç›®å½•ï¼Œç„¶åæŠŠä¸Šé¢çš„Intel HAXMå’ŒAndroid Virtual Deviceä¹Ÿå‹¾é€‰ä¸Šï¼Œè¿™æ ·å°±æŠŠAVDä¹Ÿä¸€å¹¶å®‰è£…äº†ã€‚ æ³¨æ„ï¼šè¿è¡Œå®‰å“è™šæ‹Ÿæœºéœ€è¦å®‰è£…Intel HAXMå’Œåœ¨ç”µè„‘çš„BIOSä¸­å¼€å¯Intel Virtualization Technologyï¼ˆIntel VT/è‹±ç‰¹å°”è™šæ‹ŸåŒ–æŠ€æœ¯ï¼‰ï¼ŒäºŒè€…ç¼ºä¸€ä¸å¯ã€‚ â–²æ¥ä¸‹æ¥æ˜¯è®¾ç½®AVDçš„å†…å­˜å¤§å°ï¼Œä¸€èˆ¬æˆ‘ä»¬é€‰æ‹©é»˜è®¤çš„2Gæ¨èå€¼ï¼Œå¦‚æœç”µè„‘æœ¬èº«å†…å­˜æ˜¯4Gå¯ä»¥è°ƒå°ä¸€ç‚¹ï¼ŒåŒæ ·ï¼Œå¦‚æœç”µè„‘å†…å­˜æ˜¯16Gä¹‹ç±»çš„å¤§å†…å­˜è¯·éšæ„ã€‚ â–²æ¥ä¸‹æ¥ä¼šåˆ—å‡ºå„ç§å®‰è£…åŒ…ç»„ä»¶çš„å¤§å°ï¼Œæˆ‘ä»¬ç›´æ¥ç‚¹å‡»Finishè¿›è¡Œå®‰è£… â–²å®‰è£…çš„è¿‡ç¨‹å¯èƒ½ä¼šæœ‰ç‚¹æ…¢ï¼Œè¯·åŒå­¦ä»¬ä¿æŒè€å¿ƒå’Œç½‘ç»œç•…é€šï¼Œç­‰å¾…å…¨éƒ¨å®‰è£…å®Œæˆä¹‹åå†ç‚¹å‡»Finishã€‚ åˆ°è¿™é‡ŒASå’Œå¯¹åº”çš„SDKè¿˜æœ‰AVDå°±å·²ç»å®‰è£…å®Œæˆäº†å•¦ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è·‘ä¸ªHelloWorldè¯•è¯•ã€‚ 5ã€HelloWorld5.1 æ–°å»ºé¡¹ç›®â–²è¿™é‡Œæ¥åˆ°äº†ASçš„å¯åŠ¨ç•Œé¢ï¼Œå’ŒJerBrainå®¶å‡ºå“çš„å…¶ä»–IDEé£æ ¼ä¸€è„‰ç›¸æ‰¿ï¼Œæˆ‘ä»¬ç‚¹å‡»Start a new Android Studio Projectæ¥æ–°å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªHelloWorldç¨‹åºã€‚ â–²æ¥ä¸‹æ¥å°±æ˜¯è®¾ç½®é¡¹ç›®çš„åç§°ï¼ˆä¸€èˆ¬ä¹Ÿæ˜¯APPçš„åç§°ï¼‰ï¼Œæ¥ç€å°†é¡¹ç›®ç›®å½•æ”¹æˆæˆ‘ä»¬ä¹‹å‰æ–°å»ºçš„Android Projectæ–‡ä»¶å¤¹ï¼Œä¸­é—´çš„Company Domainï¼Œå¦‚æœæ˜¯ä¸ªäººå¼€å‘è€…å°±å¡«è‡ªå·±çš„é‚®ç®±æˆ–è€…åå­—å•¥çš„ï¼Œå…¬å¸å¼€å‘è€…å°±å¡«å…¬å¸ã€‚ â–²æ¥ä¸‹æ¥å°±æ˜¯é€‰æ‹©ä½ çš„é¡¹ç›®ç±»å‹ï¼Œæ˜¯æ­£å¸¸çš„å®‰å“æ‰‹æœºAPPè¿˜æ˜¯å…¶ä»–çš„å®‰å“TVã€Wearç­‰ç­‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥å®‰å“æ‰‹æœºAPPä¸ºä¾‹ï¼Œç„¶åå°±è¦é€‰æ‹©APIç‰ˆæœ¬ï¼Œè¿™é‡Œçš„APIç‰ˆæœ¬æŒ‡çš„æ˜¯è¿™ä¸ªé¡¹ç›®å‘ä¸‹å…¼å®¹çš„æœ€ä½ç‰ˆæœ¬ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒAPIè¶Šä½ï¼Œå…¼å®¹çš„è®¾å¤‡è¶Šå¤šï¼Œä½†æ˜¯æ–°APIé‡Œé¢çš„æ–°åŠŸèƒ½å’Œç‰¹æ€§å°±è¶Šå®¹æ˜“å‡ºé—®é¢˜ï¼Œå…·ä½“å¦‚ä½•é€‰æ‹©çœ‹åŒå­¦ä»¬çš„å®é™…éœ€æ±‚ã€‚ â–²æ¥ä¸‹æ¥å°±æ˜¯é€‰æ‹©Activityï¼ŒASå®˜æ–¹æä¾›äº†ä¸€äº›å¸¸ç”¨çš„Activityï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªç©ºç™½çš„Activityï¼ˆEmpty Activityï¼‰ã€‚ â–²æ¥ä¸‹æ¥æ˜¯å¡«å†™Activityçš„åå­—å’ŒLayoutçš„åå­—ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨é»˜è®¤å€¼ã€‚ï¼ˆActivityå’ŒLayoutæ•°é‡å¤šäº†ä¹‹åæœ€å¥½æ ¹æ®åŠŸèƒ½ç”¨é€”è¿›è¡Œå‘½åï¼Œå¦åˆ™æŸ¥æ‰¾çš„æ—¶å€™å¾ˆéº»çƒ¦ï¼‰ â–²ç¬¬ä¸€æ¬¡æ–°å»ºé¡¹ç›®è¿˜æœ‰ä¸€äº›SDKéœ€è¦å†é…ç½®ä¸€ä¸‹ã€‚ â–²æ¥ç€å°±æ˜¯ä¸‹è½½Gradleï¼ŒGradleçš„ç‰ˆæœ¬å¯ä»¥åœ¨å¯¹åº”çš„é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼Œä¿®æ”¹çš„æ—¶å€™æ³¨æ„ä¼šå¼•å‘ä¸€ç³»åˆ—çš„è¿é”ååº”ï¼Œå› æ­¤è¦å°å¿ƒè°¨æ…ã€‚ Gradleæ˜¯ASä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œä»¥åæœ‰æœºä¼šæˆ‘ä»¬å†å¼€æ–°å¸–ç ”ç©¶æ¢è®¨ä¸€ä¸‹ã€‚ â–²ASåˆ°äº†3.xç‰ˆæœ¬ä¹‹åå°±ä¼šåˆè¿™ä¸ªæ¸©é¦¨æç¤ºçª—å£ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥è·³è¿‡ã€‚ â–²æ¥ä¸‹æ¥æˆ‘ä»¬ç‚¹å‡»å³ä¸Šæ–¹çš„SyncæŒ‰é’®çœ‹ä¸€ä¸‹é¡¹ç›®æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚å›¾æ‰€ç¤ºè¿™é‡Œæ˜¯æ¯”è¾ƒæ­£å¸¸çš„ã€‚ 5.2 è¿è¡ŒAVDâ–²æ¥ä¸‹æ¥æˆ‘ä»¬ç‚¹å‡»Syncæ—è¾¹çš„AVDæŒ‰é’®ï¼Œæ‰“å¼€AVDçª—å£ â–²å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ä¹‹å‰åœ¨å®‰è£…çš„æ—¶å€™å‹¾é€‰äº†AVDé€‰é¡¹ï¼Œæ‰€ä»¥è¿™é‡Œå·²ç»æœ‰äº†ä¸€ä¸ªé…ç½®å¥½çš„AVDï¼Œæˆ‘ä»¬ç‚¹å‡»å³è¾¹çš„ç»¿è‰²æ’­æ”¾æŒ‰é’®ï¼ˆRUNï¼‰å°±å¯ä»¥ç›´æ¥è¿è¡Œã€‚ä¸ºäº†æ–¹ä¾¿åŒå­¦ä»¬ç†è§£ï¼Œæ­¤å¤„æˆ‘ä»¬å†æ–°å»ºä¸€ä¸ªAVDè®¾å¤‡ï¼Œç‚¹å‡»å·¦ä¸‹æ–¹çš„Creat Virtual Devicesã€‚ â–²è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è°·æ­Œè‡ªå®¶çš„ä¸€äº›æœºå‹ä»¥åŠå¯¹åº”çš„åˆ†è¾¨ç‡å’Œå±å¹•å°ºå¯¸ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥ç‚¹å‡»å·¦ä¸‹æ–¹å¯¼å…¥æˆ–è€…æ–°å»ºä¸€ä¸ªï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©è°·æ­Œå®¶çš„Pixel2 XLã€‚ â–²æ¥ä¸‹æ¥å°±æ˜¯é€‰æ‹©APIç‰ˆæœ¬ä¹Ÿå°±æ˜¯ç³»ç»Ÿç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹åŒä¸€æœºå‹çš„ä¸åŒç³»ç»Ÿç‰ˆæœ¬çš„AVDæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•ã€‚ â–²æ¥ä¸‹æ¥å¯ä»¥é€‰æ‹©AVDæ˜¯æ¨ªå‘è¿˜æ˜¯çºµå‘ï¼Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼Œç›´æ¥å®Œæˆå³å¯ã€‚ â–²å¦‚å›¾æ‰€ç¤ºAVDè™šæ‹Ÿæœºæ­£åœ¨å¼€å¯ã€‚ â–²åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è™šæ‹Ÿæœºå·²ç»å¼€å¯å®Œæ¯•ï¼Œé‡Œé¢çš„ç³»ç»Ÿæ­£åœ¨å¼€æœºï¼Œæ—è¾¹æ˜¯æˆ‘ä»¬ä½¿ç”¨æ‰‹æœºå¸¸ç”¨åˆ°çš„ä¸€äº›æ“ä½œã€‚ â–²æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠç•Œé¢åˆ‡å›ASã€‚ç‚¹å‡»å³ä¸Šæ–¹çš„ç»¿è‰²æ’­æ”¾æŒ‰é’®ï¼Œå…¶å®æ˜¯RUNæŒ‰é’®ã€‚ â–²ç„¶åæˆ‘ä»¬é€‰æ‹©åœ¨åˆšåˆšå·²ç»å¼€å¯çš„Pixel2 XLè™šæ‹Ÿæœºä¸Šè¿è¡Œã€‚ â–²æ¥ç€æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°Hello Worldå•¦ã€‚ â–²æˆ‘ä»¬æ‰“å¼€è™šæ‹Ÿæœºé‡Œé¢çš„åº”ç”¨æŠ½å±‰ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšåˆšrunçš„åº”ç”¨å·²ç»å®‰è£…åœ¨è¿™ä¸Šé¢äº†ã€‚ 5.3 æ–‡å­—å†…å®¹å°æ”¹æ¥ä¸‹æ¥æˆ‘ä»¬è¯•è¯•æŠŠHelloWorldæ”¹æˆHelloAndroid â–²åœ¨å¦‚å›¾æ‰€ç¤ºçš„ç›®å½•ä¸­æ‰¾åˆ°HelloWorldå¯¹åº”çš„æ§ä»¶ï¼Œç›´æ¥ä¿®æ”¹æ–‡å­—å†…å®¹ï¼Œä¿å­˜ç„¶åå†Syncå†Runä¸€æ¬¡ã€‚ â–²Hello Androidï¼","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"}]},{"title":"Win10ä¸‹å®‰è£…UbuntuåŒç³»ç»Ÿ","slug":"20180817-ubuntu-install","date":"2018-08-17T07:00:00.000Z","updated":"2018-08-17T07:00:00.000Z","comments":true,"path":"20180817-ubuntu-install/","link":"","permalink":"https://tinychen.com/20180817-ubuntu-install/","excerpt":"Ubuntu18.04å‘å¸ƒäº†å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼ŒåŸºæœ¬ä¸Šç³»ç»Ÿæœ¬èº«ä¹Ÿè¶‹äºç¨³å®šï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨æ¥å°è¯•ä¸€ä¸‹åœ¨å·²ç»å­˜åœ¨win10ç³»ç»Ÿçš„æƒ…å†µä¸‹å®‰è£…Ubuntu18.04ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯å•ç¡¬ç›˜+GPTåˆ†åŒºè¡¨é…ç½®æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯ç›®å‰çš„ä¸»æµæ–¹æ¡ˆã€‚","text":"Ubuntu18.04å‘å¸ƒäº†å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼ŒåŸºæœ¬ä¸Šç³»ç»Ÿæœ¬èº«ä¹Ÿè¶‹äºç¨³å®šï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨æ¥å°è¯•ä¸€ä¸‹åœ¨å·²ç»å­˜åœ¨win10ç³»ç»Ÿçš„æƒ…å†µä¸‹å®‰è£…Ubuntu18.04ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯å•ç¡¬ç›˜+GPTåˆ†åŒºè¡¨é…ç½®æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯ç›®å‰çš„ä¸»æµæ–¹æ¡ˆã€‚ 1ã€ä¸‹è½½Ubuntu18.04åŠç›¸å…³å·¥å…·1.1 ä¸‹è½½UbuntuUbuntuå·²ç»æœ‰äº†ä¸­æ–‡å®˜ç½‘ï¼Œè€Œä¸”åœ¨å›½å†…ä¹Ÿèƒ½æ­£å¸¸è®¿é—®ï¼Œå› æ­¤ä¸‹è½½ç›¸å¯¹ç®€å•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUbuntu18.04åªæœ‰64ä½çš„ç‰ˆæœ¬ã€‚ è¿™æ˜¯ä¸‹è½½é“¾æ¥ï¼š http://releases.ubuntu.com/18.04/ â–¼æˆ‘ä»¬ä¸‹è½½å›¾ä¸­çš„ç¬¬ä¸€ä¸ªåç¼€ä¸ºdesktop-amd64çš„isoé•œåƒæ–‡ä»¶ã€‚ 1.2 ä¸‹è½½UltraISOä½¿ç”¨æœç´¢å¼•æ“æœç´¢ä¸‹è½½UltraISOå¹¶å®‰è£…ï¼Œå…³äºUltraISOçš„ä½¿ç”¨å¯ä»¥å‚è€ƒä¸€ä¸‹å°ä¸ƒä¹‹å‰å‘è¿‡çš„æ–‡ç« ï¼ˆåŒå¯åŠ¨Uç›˜ï¼‰ã€‚ 1.3 å‡†å¤‡Uç›˜å’Œç¡¬ç›˜åˆ†åŒºå‡†å¤‡ä¸€ä¸ª8Gå·¦å³çš„Uç›˜å³å¯ï¼ŒUSB3.0æœ€å¥½ï¼Œæ²¡æœ‰çš„è¯2.0çš„Uç›˜ä¹Ÿå¯ä»¥ã€‚ ç¡¬ç›˜ä¸Šéœ€è¦åˆ’åˆ†å‡ºä¸€å—ç©ºç™½ç©ºé—´ï¼Œæœ€å°‘åº”è¯¥è¦æœ‰20Gå·¦å³ï¼Œå°ä¸ƒè¿™é‡Œåˆ’åˆ†äº†50Gå·¦å³çš„ç©ºé—´ã€‚å¦‚æœåªæ˜¯æƒ³å°è¯•ä¸€ä¸‹Ubuntuçš„è¯ï¼Œé¢„ç•™20åˆ°30Gæ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚ å…·ä½“çš„åˆ’åˆ†ç©ºé—´æ“ä½œå¯ä»¥ä½¿ç”¨windowsç³»ç»Ÿè‡ªå¸¦çš„ç£ç›˜ç®¡ç†è¿›è¡Œå‹ç¼©æ“ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨DiskGeniusè¿›è¡Œåˆ†åŒºï¼Œæ“ä½œååˆ†ç®€å•ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ 2ã€åˆ»å½•å®‰è£…Uç›˜â–¼å¦‚å›¾æ‰€ç¤ºï¼Œæ‰“å¼€UltraISOåï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„æ–‡ä»¶-&gt;æ‰“å¼€ï¼Œé€‰æ‹©åˆšåˆšä¸‹è½½å¥½çš„ISOé•œåƒæ–‡ä»¶ã€‚ â–¼å†ç‚¹å‡»ä¸Šæ–¹èœå•æ çš„å¯åŠ¨-&gt;å†™å…¥ç¡¬ç›˜ï¼Œç¡¬ç›˜é©±åŠ¨å™¨è¦é€‰æ‹©å¯¹åº”çš„Uç›˜ï¼Œä¸èƒ½é€‰é”™ï¼Œç„¶åç‚¹å‡»ä¾¿æ·å¯åŠ¨-&gt;å†™å…¥æ–°çš„é©±åŠ¨å™¨å¼•å¯¼æ‰‡åŒº-&gt;Syslinuxã€‚ â–¼æ¥ä¸‹æ¥ç‚¹å‡»å†™å…¥ï¼Œå°±ä¼šå¯¹Uç›˜è¿›è¡Œæ ¼å¼åŒ–å¹¶å°†ISOæ–‡ä»¶åˆ»å½•åˆ°Uç›˜é‡Œé¢ã€‚ 3ã€è¿›å…¥å®‰è£…ç•Œé¢åˆ»å½•å®Œæˆä¹‹åï¼Œæˆ‘ä»¬é‡å¯ç”µè„‘è¿›å…¥BIOSæˆ–è€…æ˜¯å¿«æ·å¯åŠ¨èœå•é€‰æ‹©å¯åŠ¨é¡¹ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯ESC/F1/F2/F8/F9/F11/F12ç­‰æŒ‰é”®ï¼Œå…·ä½“ä¼šå› ç¬”è®°æœ¬çš„å‹å·ä¸åŒæˆ–æ˜¯å°å¼æœºçš„ä¸»æ¿ä¸åŒè€Œä¸åŒï¼Œè¿›å…¥ä¹‹åæˆ‘ä»¬é€‰æ‹©å¯¹åº”çš„UEFIå¯åŠ¨é¡¹ï¼Œåç§°åº”è¯¥æ˜¯å¯¹åº”çš„Uç›˜å‹å·ã€‚ å°ä¸ƒæ³¨ï¼šæœ‰äº›ç”µè„‘å¯èƒ½éœ€è¦å…³é—­BIOSè®¾ç½®ä¸­çš„Security Booté€‰é¡¹æ‰èƒ½é¡ºåˆ©ä½¿ç”¨Uç›˜å¯åŠ¨ã€‚ â–¼åˆ°è¿™é‡Œæˆ‘ä»¬é€‰æ‹©Try Ubuntu without installï¼Œè¿™æ ·å¯ä»¥å…ˆçœ‹ä¸€ä¸‹Ubuntuçš„ç•Œé¢UIå’Œå„ç§æ“ä½œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥é€‰æ‹©ä¸‹é¢çš„Install Ubuntuã€‚ â–¼æ¥ä¸‹æ¥å°±è¿›å…¥åˆ°äº†Ubuntuçš„ç•Œé¢ï¼Œè¿™é‡Œé™¤äº†è¿˜æ²¡æœ‰å¯¹åº”çš„Ubuntuç¡¬ç›˜åˆ†åŒºä¹‹å¤–ï¼Œå…¶ä»–çš„åŸºæœ¬æ²¡æœ‰å¤ªå¤§å·®åˆ«ï¼Œæˆ‘ä»¬ç‚¹å‡»æ¡Œé¢çš„Install Ubuntu 18.04.1LTSè¿›è¡Œå®‰è£…ã€‚ 4ã€å¼€å§‹å®‰è£…æ¥ä¸‹æ¥åˆ°åˆ†åŒºä¹‹å‰éƒ½æ˜¯ä¸€äº›ç®€å•çš„è®¾ç½®ï¼Œæˆ‘ä»¬æ ¹æ®å®é™…éœ€è¦é€‰æ‹©å³å¯ã€‚ 4.1 è¯­è¨€è®¾ç½®â–¼è¯­è¨€é€‰æ‹©ä¸­æ–‡ 4.2 é”®ç›˜è®¾ç½®â–¼é”®ç›˜å¸ƒå±€é€‰æ‹©æ±‰è¯­ 4.3 ç½‘ç»œè®¾ç½®â–¼WiFiæš‚æ—¶å…ˆä¸è¦è¿æ¥ 4.4 ç³»ç»Ÿå®‰è£…åˆ†åŒºâ–¼å®‰è£…ç±»å‹é€‰æ‹©å…¶ä»–é€‰é¡¹ â–¼å¦‚å›¾æ‰€ç¤ºï¼Œç¡¬ç›˜ä¸Šçš„åˆ†åŒºå¤šæ•°æ˜¯NTFSåˆ†åŒºï¼Œè¿™æ˜¯windowsç³»ç»Ÿä½¿ç”¨çš„åˆ†åŒºï¼Œè€Œä¸Šæ–¹çš„EFIåˆ†åŒºåˆ™æ˜¯ä½¿ç”¨UEFI+GPTåˆ†åŒºè¡¨æ¨¡å¼ä¸‹äº§ç”Ÿçš„ç”¨äºè®°å½•ç³»ç»Ÿå¼•å¯¼æ–‡ä»¶çš„åˆ†åŒº ä¸€èˆ¬æ¥è¯´ï¼ŒUbuntuçš„å®‰è£…åˆ†åŒºå¯ä»¥åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š 4.4.1 ç¬¬ä¸€ç§ç®€å•ç²—æš´ï¼Œåªåˆ†ä¸€ä¸ª / ï¼ˆä¸»åˆ†åŒºï¼‰ï¼Œå°†æ‰€æœ‰çš„ç©ºé—´å…¨éƒ¨åˆ†åˆ°è¿™ä¸ªåˆ†åŒºé‡Œé¢ã€‚ è¿™ç§æ–¹æ¡ˆæ¯”è¾ƒé€‚åˆåˆšå…¥é—¨Ubuntuçš„èŒæ–°ï¼Œæƒ³å…ˆä½“éªŒä¸Šæ‰‹ä¸€ä¸‹Ubuntuï¼Œä¸éœ€è¦æ‹…å¿ƒåˆ†åŒºçš„è®¾ç½®åˆç†æƒ…å†µã€‚ 4.4.2 ç¬¬äºŒç§åˆ†ä¸¤ä¸ªï¼ŒSwapäº¤æ¢åˆ†åŒºå’Œ/ä¸»åˆ†åŒºï¼Œswapåˆ†åŒºä¸€èˆ¬æ ¹æ®å†…å­˜å¤§å°æ¥åˆ†ï¼Œå‰©ä¸‹çš„å…¨éƒ¨ç»™/ä¸»åˆ†åŒº Swapäº¤æ¢åˆ†åŒºå…¶å®å°±æ˜¯è™šæ‹Ÿå†…å­˜åˆ†åŒºï¼Œå¦‚æœç”µè„‘å†…å­˜æ¯”è¾ƒå°ï¼ˆå°äº8Gï¼‰è€Œä¸”å¹³æ—¶éœ€è¦ç”¨åˆ°è¾ƒå¤šå†…å­˜çš„è¯å¯ä»¥åˆ’åˆ†å¤§ä¸€ç‚¹ï¼ˆ4Gå·¦å³ï¼‰ï¼Œå¦‚æœå¹³æ—¶å†…å­˜è¶³å¤Ÿç”¨å¯ä»¥åˆ’åˆ†å°ä¸€ç‚¹ï¼Œå‡ ç™¾Måˆ°ä¸€ä¸¤Géƒ½æ˜¯æ²¡é—®é¢˜çš„ã€‚ æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç‚¹å‡»è¿™é‡Œè·³è½¬åˆ°å°ä¸ƒä¹‹å‰çš„åšå®¢äº†è§£ä¸€ä¸‹ã€‚ï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰ 4.4.3 ç¬¬ä¸‰ç§åˆ†å››ä¸ªï¼Œ/bootå¼•å¯¼åˆ†åŒºã€/homeç”¨æˆ·åˆ†åŒºã€swapäº¤æ¢åˆ†åŒºå’Œ / ä¸»åˆ†åŒº/bootï¼ˆå¼•å¯¼åˆ†åŒºï¼‰ï¼šç›¸å½“äºwindowsçš„efiåˆ†åŒºï¼Œå¤§å°è®¾ç½®ä¸º200Må³å¯ï¼Œä¹Ÿå¯ä»¥æ›´å¤§ä¸€ç‚¹ï¼› /ï¼ˆä¸»åˆ†åŒºï¼‰ï¼šç”¨äºå­˜æ”¾Ubuntuç³»ç»Ÿï¼Œç›¸å½“äºwindowsçš„Cç›˜ï¼Œä¸€èˆ¬æ¥è¯´10åˆ°15Gå°±å¤Ÿäº†ã€‚ Swap(äº¤æ¢åˆ†åŒºï¼‰ï¼šè™šæ‹Ÿå†…å­˜åˆ†åŒºï¼Œå¤§å°å‚çœ‹ç¬¬äºŒç§åˆ†æ³•ã€‚ /homeï¼ˆç”¨æˆ·åˆ†åŒºï¼‰ï¼šå­˜å‚¨ç”¨æˆ·çš„å„ç§æ•°æ®ï¼Œå‰©ä¸‹çš„ç¡¬ç›˜ç©ºé—´æœ‰å¤šå¤§å°±åˆ†å¤šå¤§ç»™è¿™ä¸ªåˆ†åŒº è¿™é‡Œå°ä¸ƒé€‰æ‹©ç¬¬äºŒç§åˆ†åŒºæ–¹æ¡ˆï¼Œä¸€æ¥æ˜¯å› ä¸ºå°ä¸ƒè¿™é‡Œåªåˆ’äº†50Gæ¥å®‰è£…Ubuntuï¼Œç¡¬ç›˜æœ¬èº«çš„ç©ºé—´å°±ä¸å¤§ï¼Œåˆ†å¤ªå¤šåŒºä¸å¤ªå¥½ï¼›äºŒæ¥å°±æ˜¯å°ä¸ƒè‡ªå·±ä¹Ÿæ²¡æœ‰ä»€ä¹ˆåˆ†åŒºçš„ä¹ æƒ¯ï¼ˆwindowsä¸‹ä¹Ÿåªæ˜¯åˆ†äº†ä¸¤ä¸ªç›˜ï¼‰ã€‚â–¼å¦‚å›¾æ‰€ç¤ºï¼Œç»™äº¤æ¢åˆ†åŒºï¼ˆSwapï¼‰åˆ†2Gï¼ˆè¿™å°ç”µè„‘çš„å†…å­˜æ˜¯16Gï¼Œä¸éœ€è¦åˆ†å¤ªå¤§çš„äº¤æ¢ç©ºé—´ï¼‰ â–¼å¦‚å›¾æ‰€ç¤ºï¼Œå‰©ä¸‹çš„ç©ºé—´å…¨éƒ¨åˆ†ç»™ / ä¸»åˆ†åŒº â–¼ç¡®è®¤æ— è¯¯åç‚¹å‡»ç¡®è®¤ã€‚ 4.5 è®¾ç½®åŒºåŸŸâ–¼è®¾ç½®åŒºåŸŸï¼Œé€‰æ‹©ä¸­å›½ï¼Œé»˜è®¤åŸå¸‚æ˜¯ä¸Šæµ·ã€‚ 4.6 è®¾ç½®ç”¨æˆ·åâ–¼è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯è®¾ç½®ä¸€ä¸‹ï¼Œä¸€äº›è¶…çº§ç”¨æˆ·æ“ä½œéœ€è¦è¾“å…¥å¯†ç è§£é”æƒé™ï¼Œæ²¡æœ‰å¯†ç çš„è¯ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚ â–¼æ¥ä¸‹æ¥å°±é™é™åœ°ç­‰å¾…å®‰è£…å®Œæˆã€‚ â–¼å®‰è£…å®Œæˆåä¼šæç¤ºé‡å¯è¿›å…¥ç³»ç»Ÿã€‚ 5ã€é‡å¯ç³»ç»Ÿâ–¼é‡å¯åæˆ‘ä»¬å†è¿›å…¥å¯åŠ¨é€‰é¡¹å¯ä»¥çœ‹åˆ°Ubuntuå·²ç»åœ¨é»˜è®¤çš„ç¬¬ä¸€ä¸ªå¯åŠ¨é¡¹ä¸­ï¼Œå¦‚æœå¹³æ—¶ä½¿ç”¨windowsæ¯”è¾ƒå¤šçš„å¯ä»¥æŠŠç¬¬ä¸€ä¸ªæ”¹å›windowsã€‚ â–¼å¦‚å›¾æ‰€ç¤ºå³å¯è¿›å…¥Ubuntuç³»ç»Ÿï¼Œä¸‹é¢çš„ç¬¬ä¸‰ä¸ªå°±æ˜¯windowsç³»ç»Ÿã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"}]},{"title":"ç¡¬ç›˜RaidOnæ¨¡å¼æ— æŸè½¬æ¢ä¸ºAHCIæ¨¡å¼","slug":"20180814-raidon-2-ahci","date":"2018-08-14T07:00:00.000Z","updated":"2018-08-14T07:00:00.000Z","comments":true,"path":"20180814-raidon-2-ahci/","link":"","permalink":"https://tinychen.com/20180814-raidon-2-ahci/","excerpt":"æœ‰äº›ç”µè„‘çš„ç¡¬ç›˜å‡ºå‚æ¨¡å¼å°±æ˜¯RaidOn,RAIDæ¨¡å¼å¯¹äºæ··åˆç¡¬ç›˜æ¥è¯´æœ‰ä¸€å®šçš„å¥½å¤„ï¼Œä½†æ˜¯å¯¹äºå•å›ºæ€æ¥è¯´è¿˜æ˜¯AHCIæ›´ä¸ºæ–¹ä¾¿ä¸€äº›ã€‚ä»Šå¤©åœ¨è£…Ubuntuçš„æ—¶å€™å‘ç°å®‰è£…ç¨‹åºä¸è®¤RaidOnæ¨¡å¼çš„ç¡¬ç›˜ï¼Œåªèƒ½æ”¹æˆAHCIæ¨¡å¼ã€‚","text":"æœ‰äº›ç”µè„‘çš„ç¡¬ç›˜å‡ºå‚æ¨¡å¼å°±æ˜¯RaidOn,RAIDæ¨¡å¼å¯¹äºæ··åˆç¡¬ç›˜æ¥è¯´æœ‰ä¸€å®šçš„å¥½å¤„ï¼Œä½†æ˜¯å¯¹äºå•å›ºæ€æ¥è¯´è¿˜æ˜¯AHCIæ›´ä¸ºæ–¹ä¾¿ä¸€äº›ã€‚ä»Šå¤©åœ¨è£…Ubuntuçš„æ—¶å€™å‘ç°å®‰è£…ç¨‹åºä¸è®¤RaidOnæ¨¡å¼çš„ç¡¬ç›˜ï¼Œåªèƒ½æ”¹æˆAHCIæ¨¡å¼ã€‚ å¦‚æœç›´æ¥åœ¨BIOSä¸­æ›´æ”¹ç¡¬ç›˜æ¨¡å¼ä¸ºAHCIï¼Œåˆ™ä¼šå‡ºç°æ— æ³•è¿›å…¥ç³»ç»Ÿçš„æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨å®‰å…¨å¯åŠ¨æ¨¡å¼ã€‚ 1ã€æ‰“å¼€å®‰å…¨å¯åŠ¨æ¨¡å¼åŒæ—¶æŒ‰ä¸‹win+RæŒ‰é”®ï¼Œè¾“å…¥msconfigï¼š æ‰“å¼€é…ç½®èœå•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç‚¹å‡»bootï¼Œå‹¾é€‰safe bootï¼Œé€‰æ‹©minimalã€‚ ç‚¹å‡»OKï¼Œç„¶åé‡æ–°å¯åŠ¨ç³»ç»Ÿã€‚ 2ã€æ›´æ”¹BIOSä¸­ç¡¬ç›˜æ¨¡å¼è¿›å…¥BIOSï¼Œæ›´æ”¹ç¡¬ç›˜æ¨¡å¼ä¸ºAHCIï¼Œç‚¹å‡»ç¡®å®šã€‚ 3ã€å…³é—­å®‰å…¨å¯åŠ¨æ¨¡å¼æ­¤æ—¶é‡å¯å®Œæˆè¿›å…¥ç”µè„‘æ˜¯å®‰å…¨æ¨¡å¼ï¼Œé‡å¤ç¬¬ä¸€æ­¥ï¼Œå–æ¶ˆå‹¾é€‰ã€‚ ç‚¹å‡»OKï¼Œå†æ¬¡é‡å¯å³å¯ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"}]},{"title":"JDKå®‰è£…ä¸ç¯å¢ƒå˜é‡é…ç½®","slug":"20180803-jdk-install","date":"2018-08-03T07:00:00.000Z","updated":"2018-08-03T07:00:00.000Z","comments":true,"path":"20180803-jdk-install/","link":"","permalink":"https://tinychen.com/20180803-jdk-install/","excerpt":"æœ¬æ–‡ä»¥JAVA10ä¸ºä¾‹ï¼ŒJAVA8çš„å®‰è£…é…ç½®åŸºæœ¬å¤§åŒå°å¼‚ã€‚","text":"æœ¬æ–‡ä»¥JAVA10ä¸ºä¾‹ï¼ŒJAVA8çš„å®‰è£…é…ç½®åŸºæœ¬å¤§åŒå°å¼‚ã€‚ 1ã€ä¸‹è½½JAVA10é¦–å…ˆæˆ‘ä»¬è¦å»å®˜ç½‘ä¸‹è½½JAVA10çš„å®‰è£…åŒ…ã€‚ç‚¹å‡»è¿™é‡Œè·³è½¬åˆ°å®˜ç½‘ã€‚ æˆªè‡³åˆ°å‘æ–‡ä¸ºæ­¢ï¼Œæœ€æ–°çš„ç‰ˆæœ¬æ˜¯10.0.2ã€‚ä¸‹è½½ä¹‹å‰è¦è®°å¾—å…ˆç‚¹å‡»ä¸Šé¢çš„Accept License Agreementï¼Œå¦åˆ™å°†æ— æ³•ä¸‹è½½ã€‚ å¦å¤–ï¼ŒWindowsä¸ŠJAVA10åªæä¾›64ä½çš„ç‰ˆæœ¬ã€‚ä¸è¿‡ç°åœ¨å¤§å¤šæ•°ç”µè„‘éƒ½æ˜¯64ä½ï¼Œè¿™ä¸ªé—®é¢˜åº”è¯¥ä¸å¤§ã€‚ ä¸‹è½½å®Œæˆä¹‹åï¼Œç›´æ¥åŒå‡»å®‰è£…ã€‚ 2ã€å®‰è£…JAVA10å› ä¸ºå°ä¸ƒè¿™é‡Œåªæœ‰10.0.1çš„ç‰ˆæœ¬ï¼Œä¸”ç³»ç»Ÿçš„é»˜è®¤æ˜¾ç¤ºè¯­è¨€ä¸ºè‹±è¯­ï¼Œæ‰€ä»¥å°±ä»¥è¿™ä¸ªç‰ˆæœ¬ä¸ºä¾‹ã€‚ï¼ˆè¿™é‡Œéœ€è¦é¢å¤–æä¸€ä¸‹ï¼Œå„ç§å¼€å‘å·¥å…·å’ŒIDEçš„å­˜æ”¾æ–‡ä»¶å¤¹å’Œè·¯å¾„æœ€å¥½éƒ½ä»¥è‹±æ–‡å‘½åï¼Œä¸å®¹æ˜“å‡ºç°é—®é¢˜ï¼‰ â–²æˆ‘ä»¬ç‚¹å‡»next â–²è¿™é‡Œæˆ‘ä»¬å–æ¶ˆå‹¾é€‰JREï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦è€Œä¸”ä¼šä½¿åé¢çš„ç¯å¢ƒå˜é‡é…ç½®å˜å¾—å¾ˆå¤æ‚ã€‚â–²ä¸ºäº†æ–¹ä¾¿ç®¡ç†å’Œè®°å¿†ï¼Œæˆ‘å°†å®ƒå®‰è£…åˆ°äº†Dç›˜ï¼Œè¿™ä¸ªå®‰è£…è·¯å¾„éœ€è¦è®°ä½ï¼Œå› ä¸ºåé¢é…ç½®ç¯å¢ƒå˜é‡çš„æ—¶å€™éœ€è¦ç”¨åˆ°ã€‚ â–²åˆ°è¿™é‡ŒJAVA10å°±å·²ç»å®‰è£…å®Œæˆäº†ï¼Œä¸‹é¢æˆ‘ä»¬è¿›å…¥ç¯å¢ƒå˜é‡çš„é…ç½®é˜¶æ®µã€‚ 3ã€é…ç½®ç¯å¢ƒå˜é‡3.1 JAVA10 â–²æˆ‘ä»¬æ‰¾åˆ°æˆ‘çš„ç”µè„‘ï¼Œå³é”®é€‰æ‹©å±æ€§ï¼Œç„¶åç‚¹å‡»å·¦ä¸Šæ–¹åˆ—è¡¨æœ€ä¸‹é¢çš„é«˜çº§ç³»ç»Ÿè®¾ç½®ï¼Œç‚¹å‡»ä¸‹æ–¹çš„ç¯å¢ƒå˜é‡è®¾ç½®ï¼Œçœ‹åˆ°æœ€ä¸‹é¢çš„ç³»ç»Ÿå˜é‡ã€‚ â–²é¦–å…ˆæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåä¸ºJAVA_HOMEçš„å˜é‡ï¼Œå˜é‡çš„å€¼å°±æ˜¯åˆšåˆšæˆ‘ä»¬å®‰è£…JAVA10çš„ç›®å½•ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ å‰é¢å®‰è£…äº†JREï¼Œåœ¨å¯¹åº”çš„å®‰è£…ç›®å½•ä¸‹é¢ä¼šæœ‰JDKå’ŒJREä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦é€‰æ‹©JDKæ–‡ä»¶å¤¹ã€‚ â–²æ¥ç€æˆ‘ä»¬ä¿®æ”¹PATHå˜é‡ï¼ˆpathä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚åœ¨pathå˜é‡çš„æœ€å‰é¢æ·»åŠ å¦‚ä¸‹å˜é‡å€¼ï¼š 1;%JAVA_HOME%\\bin; æ³¨æ„è¿™ä¸ªå˜é‡å€¼è¦å’Œä¸Šé¢å®Œå…¨ä¸€æ ·ã€‚ ä¾æ¬¡ç‚¹å‡»ç¡®å®šå¹¶å…³é—­æ‰€æœ‰çª—å£ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å°±å·²ç»å®‰è£…é…ç½®å¥½JAVA10äº†ã€‚ 3.2 JAVA8JAVA8çš„ç¯å¢ƒå˜é‡é…ç½®å¤§åŒå°å¼‚ã€‚ 1C:\\Java\\jdk1.8.0_202 1%JAVA_HOME%\\bin;%JAVA_HOME%\\jre\\bin; 1.;%JAVA_HOME%\\lib\\dt.jar;%JAVA_HOME%\\lib\\tools.jar; 4ã€æ£€éªŒå®‰è£… â–²æˆ‘ä»¬æ‰“å¼€CMDï¼Œè¾“å…¥javaæˆ–è€…javacï¼Œå‡ºç°ä¸‹é¢çš„å‘½ä»¤è¡Œå°±è¡¨ç¤ºå·²ç»é…ç½®æˆåŠŸã€‚ ä¸ºäº†è¿›ä¸€æ­¥ç¡®å®šæ˜¯å…¨å±€å˜é‡é…ç½®æˆåŠŸï¼Œæˆ‘ä»¬åœ¨å…¶ä»–ä½ç½®ï¼ˆå¦‚Dç›˜ï¼‰æ–°å»ºä¸€ä¸ªjavaæ–‡ä»¶ï¼Œå†™ä¸ªç®€å•çš„helloæµ‹è¯•ä¸€ä¸‹ã€‚ 12345public class Hello&#123; public static void main(String[] args)&#123; System.out.println(&quot;HelloJAVA10!&quot;); &#125;&#125; â–²ç„¶åæˆ‘ä»¬å…ˆä½¿ç”¨javacå‘½ä»¤ç¼–è¯‘javaæ–‡ä»¶ç”Ÿæˆclassæ–‡ä»¶ï¼Œå†ä½¿ç”¨javaå‘½ä»¤æ‰§è¡Œclassæ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°å®é™…æ•ˆæœäº†ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"}]},{"title":"å°ç¨‹åºä¹‹app.json","slug":"20180718-tiny-program-02","date":"2018-07-18T07:00:00.000Z","updated":"2018-07-18T07:00:00.000Z","comments":true,"path":"20180718-tiny-program-02/","link":"","permalink":"https://tinychen.com/20180718-tiny-program-02/","excerpt":"app.jsonæ–‡ä»¶ç”¨æ¥å¯¹å¾®ä¿¡å°ç¨‹åºè¿›è¡Œå…¨å±€é…ç½®ï¼Œå†³å®šé¡µé¢æ–‡ä»¶çš„è·¯å¾„ã€çª—å£è¡¨ç°ã€è®¾ç½®ç½‘ç»œè¶…æ—¶æ—¶é—´ã€è®¾ç½®å¤š tab å’Œdebugæ¨¡å¼äº”æ–¹é¢çš„é…ç½®ã€‚","text":"app.jsonæ–‡ä»¶ç”¨æ¥å¯¹å¾®ä¿¡å°ç¨‹åºè¿›è¡Œå…¨å±€é…ç½®ï¼Œå†³å®šé¡µé¢æ–‡ä»¶çš„è·¯å¾„ã€çª—å£è¡¨ç°ã€è®¾ç½®ç½‘ç»œè¶…æ—¶æ—¶é—´ã€è®¾ç½®å¤š tab å’Œdebugæ¨¡å¼äº”æ–¹é¢çš„é…ç½®ã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªDemoæ¥å¯¹å…¶è¿›è¡Œæ·±å…¥çš„äº†è§£ã€‚ 1ã€Demoå…ˆçœ‹ä¸€ä¸‹å¾®ä¿¡å®˜æ–¹ç»™å‡ºçš„ä¸€äº›è¯´æ˜ã€‚ å±æ€§ ç±»å‹ å¿…å¡« æè¿° pages String Array æ˜¯ è®¾ç½®é¡µé¢è·¯å¾„ window Object å¦ è®¾ç½®é»˜è®¤é¡µé¢çš„çª—å£è¡¨ç° tabBar Object å¦ è®¾ç½®åº•éƒ¨ tab çš„è¡¨ç° networkTimeout Object å¦ è®¾ç½®ç½‘ç»œè¶…æ—¶æ—¶é—´ debug Boolean å¦ è®¾ç½®æ˜¯å¦å¼€å¯ debug æ¨¡å¼ å†æ¥çœ‹ä¸€æ®µåŒ…å«äº†ä¸Šè¿°äº”ä¸ªéƒ¨åˆ†çš„ä»£ç ã€‚ &#123; &quot;pages&quot;: [ &quot;pages/index/index&quot;, &quot;pages/logs/logs&quot;, &quot;pages/mine/mine&quot;, &quot;pages/resume/resume&quot;, &quot;pages/share/share&quot; ], &quot;window&quot;: &#123; &quot;backgroundTextStyle&quot;: &quot;light&quot;, &quot;navigationBarBackgroundColor&quot;: &quot;#fff&quot;, &quot;navigationBarTitleText&quot;: &quot;SchoolHunting&quot;, &quot;navigationBarTextStyle&quot;: &quot;black&quot; &#125;, &quot;tabBar&quot;: &#123; &quot;list&quot;: [ &#123; &quot;pagePath&quot;: &quot;pages/index/index&quot;, &quot;text&quot;: &quot;é¦–é¡µ&quot;, &quot;iconPath&quot;: &quot;images/tabBar/index.png&quot;, &quot;selectedIconPath&quot;: &quot;images/tabBar/index_sel.png&quot; &#125;, &#123; &quot;pagePath&quot;:&quot;pages/share/share&quot;, &quot;text&quot;: &quot;åˆ†äº«&quot;, &quot;iconPath&quot;: &quot;images/tabBar/share.png&quot;, &quot;selectedIconPath&quot;: &quot;images/tabBar/share_sel.png&quot; &#125;, &#123; &quot;pagePath&quot;:&quot;pages/resume/resume&quot;, &quot;text&quot;: &quot;ç®€å†&quot;, &quot;iconPath&quot;: &quot;images/tabBar/resume.png&quot;, &quot;selectedIconPath&quot;: &quot;images/tabBar/resume_sel.png&quot; &#125;, &#123; &quot;pagePath&quot;: &quot;pages/mine/mine&quot;, &quot;text&quot;: &quot;æˆ‘çš„&quot;, &quot;iconPath&quot;: &quot;images/tabBar/mine.png&quot;, &quot;selectedIconPath&quot;: &quot;images/tabBar/mine.png&quot; &#125; ] &#125;, &quot;networkTimeout&quot;: &#123; &quot;request&quot;: 10000, &quot;downloadFile&quot;: 10000 &#125;, &quot;debug&quot;: true &#125; 2ã€pagesï¼šé¡µé¢æ–‡ä»¶çš„è·¯å¾„ æ¥å—ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€é¡¹éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ¥æŒ‡å®šå°ç¨‹åºç”±å“ªäº›é¡µé¢ç»„æˆã€‚ æ¯ä¸€é¡¹ä»£è¡¨å¯¹åº”é¡µé¢çš„ã€è·¯å¾„+æ–‡ä»¶åã€‘ä¿¡æ¯ï¼Œæ•°ç»„çš„ç¬¬ä¸€é¡¹ä»£è¡¨å°ç¨‹åºçš„åˆå§‹é¡µé¢ã€‚ å°ç¨‹åºä¸­æ–°å¢/å‡å°‘é¡µé¢ï¼Œéƒ½éœ€è¦å¯¹ pages æ•°ç»„è¿›è¡Œä¿®æ”¹ï¼Œåœ¨IDEçš„æ–‡ä»¶ç›®å½•æ–°å»ºpagesçš„æ—¶å€™IDEä¼šæé†’æ˜¯å¦è‡ªåŠ¨æ›´æ–°app.jsonä¸­çš„pageså­—æ®µã€‚ æ–‡ä»¶åä¸éœ€è¦å†™æ–‡ä»¶åç¼€ï¼Œå› ä¸ºæ¡†æ¶ä¼šè‡ªåŠ¨å»å¯»æ‰¾è·¯å¾„ä¸‹ .json, .js, .wxml, .wxss å››ä¸ªæ–‡ä»¶è¿›è¡Œæ•´åˆã€‚ 3ã€windowï¼šçª—å£è¡¨ç°ä¸»è¦ä¼šç”¨åˆ°çš„æ˜¯navigationBarTitleTextè¿™ä¸ªå˜é‡ï¼Œå˜é‡è®¾ç½®çš„æ˜¯å°ç¨‹åºç•Œé¢ä¸Šæ–¹æ˜¾ç¤ºçš„åç§°ï¼Œä¸€èˆ¬è®¾ç½®æˆå°ç¨‹åºçš„åç§°ï¼Œå…¶ä½™å˜é‡æ˜¯å¯¹å…¶çš„æ ·å¼è®¾ç½®ã€‚å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹å®˜æ–¹çš„è¯¦ç»†è¯´æ˜ã€‚ 4ã€tabBarï¼šè®¾ç½®å¤šbar tabBarå­—æ®µä¸»è¦æ˜¯è®¾ç½®å°ç¨‹åºçš„Barï¼Œæœ€å°‘ä¸ºä¸¤ä¸ªï¼Œæœ€å¤šä¸ºäº”ä¸ªã€‚ positionå˜é‡å¯ä»¥è®¾ç½®Barçš„ä½ç½®æ˜¯åœ¨ä¸‹é¢ï¼ˆbottomï¼‰è¿˜æ˜¯åœ¨ä¸Šæ–¹ï¼ˆtopï¼‰ï¼Œéœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯ï¼Œå½“è®¾ç½®ä¸ºä¸Šæ–¹ï¼ˆtopï¼‰æ—¶ï¼Œä¸ä¼šæ˜¾ç¤ºå›¾æ ‡Iconã€‚ listä½œä¸ºæ•°ç»„ï¼Œå…¶ä¸­çš„å˜é‡pagePathå’Œtextè®¾ç½®barå¯¹åº”çš„é¡µé¢è·¯å¾„å’Œåç§°ï¼ŒiconPathå’ŒselectediconPathæ˜¯æœªé€‰ä¸­çŠ¶æ€å’Œé€‰ä¸­çŠ¶æ€çš„ä¸¤ä¸ªå›¾æ ‡çš„è·¯å¾„ï¼Œä¸è®¾ç½®åˆ™æ— ï¼Œåªè®¾ç½®å…¶ä¸­ä¸€ä¸ªåˆ™å¦ä¸€ä¸ªä¹Ÿç›¸åŒï¼Œå»ºè®®è¦è®¾ç½®ä¸¤ä¸ªä¸”æœ€å¥½ç”¨ç›¸åŒå›¾æ ‡ä¸åŒé¢œè‰²ï¼ˆé»‘ç°æˆ–é»‘å½©ï¼‰æ¥è¿›è¡ŒåŒºåˆ†ã€‚ è¿™é‡Œç»™å‡ºä¸¤å¼ å¯¹æ¯”å›¾ã€‚ 5ã€networkTimeoutï¼šè®¾ç½®ç½‘ç»œè¶…æ—¶æ—¶é—´ä¸»è¦æ˜¯å››ä¸ªç½‘ç»œè¯·æ±‚çš„è¶…æ—¶è®¾ç½®ï¼ˆrequestã€connectSocketã€uploadFileå’ŒdownloadFileï¼‰ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼ˆmsï¼‰ï¼Œä¸€ç§’ç­‰äºä¸€åƒæ¯«ç§’ï¼Œé»˜è®¤çš„æ—¶é—´æ˜¯60000mså³ä¸€åˆ†é’Ÿã€‚ 6ã€debugï¼šdebugæ¨¡å¼è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œdebugè¿™ä¸ªå˜é‡æœ¬èº«æ˜¯ä¸ªå¸ƒå°”å‹ï¼Œé»˜è®¤å€¼ä¹Ÿæ˜¯trueï¼ˆå¼€å¯çŠ¶æ€ï¼‰ã€‚ debugæ¨¡å¼å¼€å¯ä¹‹åï¼Œåœ¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°é¢æ¿ï¼Œè°ƒè¯•ä¿¡æ¯ä»¥ info çš„å½¢å¼ç»™å‡ºï¼Œå…¶ä¿¡æ¯æœ‰Pageçš„æ³¨å†Œï¼Œé¡µé¢è·¯ç”±ï¼Œæ•°æ®æ›´æ–°ï¼Œäº‹ä»¶è§¦å‘ ã€‚ å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½ä¸€äº›å¸¸è§çš„é—®é¢˜ã€‚ è¿™é‡ŒåŒæ ·ç»™å‡ºä¸¤å¼ å¯¹æ¯”å›¾ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"}]},{"title":"å°ç¨‹åºä¹‹HelloWorld","slug":"20180717-tiny-program-01","date":"2018-07-17T02:00:00.000Z","updated":"2018-07-17T02:00:00.000Z","comments":true,"path":"20180717-tiny-program-01/","link":"","permalink":"https://tinychen.com/20180717-tiny-program-01/","excerpt":"å¾®ä¿¡å°ç¨‹åºä¹Ÿæ¨å‡ºäº†æœ‰äº›æ—¶é—´äº†ï¼Œæœ€è¿‘å› ä¸ºç§ç§åŸå› ç»ˆäºè¦æ­£å„¿å…«ç»åœ°å¼€å§‹å¾®ä¿¡å°ç¨‹åºå¼€å‘äº†ï¼Œå…ˆè®°å½•ä¸€ä¸‹åŸºæœ¬çš„å¼€å‘è€…è´¦å·æ³¨å†Œå’Œå¼€å‘ç¯å¢ƒæ­å»ºã€‚","text":"å¾®ä¿¡å°ç¨‹åºä¹Ÿæ¨å‡ºäº†æœ‰äº›æ—¶é—´äº†ï¼Œæœ€è¿‘å› ä¸ºç§ç§åŸå› ç»ˆäºè¦æ­£å„¿å…«ç»åœ°å¼€å§‹å¾®ä¿¡å°ç¨‹åºå¼€å‘äº†ï¼Œå…ˆè®°å½•ä¸€ä¸‹åŸºæœ¬çš„å¼€å‘è€…è´¦å·æ³¨å†Œå’Œå¼€å‘ç¯å¢ƒæ­å»ºã€‚ 1ã€å¼€å‘è€…è´¦å·æ³¨å†Œå¾®ä¿¡å°ç¨‹åºçš„å¼€å‘å’Œå…¶ä»–çš„è½¯ä»¶å¼€å‘ä¸å¤ªä¸€æ ·ï¼Œéœ€è¦å…ˆå®åæ³¨å†Œè´¦å·ï¼Œè€Œä¸”å®˜æ–¹çš„IDEå¾—å…ˆç™»å½•æ‰èƒ½ä½¿ç”¨ã€‚ æ³¨å†Œçš„ç½‘å€åœ¨è¿™é‡Œï¼š https://mp.weixin.qq.com/cgi-bin/wx éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªé‚®ç®±åªèƒ½å¯¹åº”ä¸€ä¸ªå°ç¨‹åºå¼€å‘ï¼Œå¦‚æœä½ æƒ³å¼€å‘å¤šä¸ªå°ç¨‹åºï¼Œé‚£å°±å¤šæ‹¿å‡ ä¸ªé‚®ç®±å»æ³¨å†Œï¼Œé‚®ç®±è¿˜è¦ç»‘å®šå·²ç»ç”¨é“¶è¡Œå¡å®åè®¤è¯çš„å¾®ä¿¡å·ç»‘å®šï¼Œå…¶ä»–çš„ä¿¡æ¯å¦‚å®å¡«å†™å³å¯ï¼Œå¡«é”™äº†ä¹Ÿæ²¡å…³ç³»ï¼Œåæ­£å¡«äº†ä¹‹åè¿˜èƒ½ä¿®æ”¹ã€‚ 2ã€å¼€å‘ç¯å¢ƒæ­å»ºå¾®ä¿¡å®˜æ–¹ä¹Ÿæä¾›äº†å¼€å‘IDEï¼Œå®‰è£…åŒ…å¹¶ä¸å¤§ï¼Œåªæœ‰å‡ åMBï¼Œä¸‹è½½ä¹‹åå‚»ç“œå¼å®‰è£…å³å¯ã€‚ è¿™æ˜¯ä¸‹è½½é“¾æ¥ï¼š https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html å®‰è£…ä¹‹åç‚¹å‡»æ‰“å¼€ï¼Œéœ€è¦ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç ç™»é™† ç„¶åæˆ‘ä»¬é€‰æ‹©å°ç¨‹åº æ¥ä¸‹æ¥å°±è¦å¡«å†™å°ç¨‹åºé¡¹ç›®çš„ç›®å½•ï¼ŒAppIDä»¥åŠå°ç¨‹åºçš„åç§° å…¶ä¸­ï¼ŒAppIDéœ€è¦ç™»å½•ç½‘é¡µçš„å¾®ä¿¡å…¬ä¼—å¹³å°ï¼Œ https://mp.weixin.qq.com åœ¨è®¾ç½®â†’å¼€å‘è®¾ç½®é‡Œé¢æŸ¥çœ‹ã€‚ 3ã€ç†Ÿæ‚‰åŸºæœ¬å¼€å‘ç¯å¢ƒ3.1 åŸºæœ¬ç¯å¢ƒæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•´ä¸ªIDEçš„åŸºæœ¬å¼€å‘ç¯å¢ƒ å·¦ä¸Šæ–¹å¯ä»¥é€‰æ‹©æ¨¡æ‹Ÿå™¨ï¼Œç”±äºå°ç¨‹åºå’Œwebç¨‹åºå·®ä¸å¤šï¼Œï¼ˆIDEæœ¬èº«ä¹Ÿå«webå¼€å‘è€…å·¥å…·ï¼‰æ‰€ä»¥è¿™ä¸ªæ¨¡æ‹Ÿå™¨åŸºæœ¬ä¹Ÿå°±æ˜¯æ¨¡æ‹Ÿä¸€ä¸‹åˆ†è¾¨ç‡çš„æ ·å­ï¼Œå½“ç„¶ä¸åŒçš„å¯èƒ½è¿˜æœ‰å®‰å“å’ŒIOSå¹³å°ä¹‹é—´çš„ä¸€äº›æƒé™ã€‚ å·¦è¾¹çš„è¿™ä¸€å¤§ä¸ªå°±æ˜¯æ¨¡æ‹Ÿå™¨äº†ã€‚ å†è¿‡æ¥çš„å°±æ˜¯æ–‡ä»¶ç›®å½•ï¼Œä»¥åŠä¸»è¦çš„å·¥ä½œåŒºã€‚ ä¸Šé¢çš„éƒ¨åˆ†æ˜¯å·¥å…·æ ï¼Œä¸‹é¢çš„æ§åˆ¶å°ï¼Œå’ŒVisual Studioã€Android Studio è¿™ç±»IDEåŸºæœ¬å¤§åŒå°å¼‚ã€‚ å¯èƒ½ä¸åŒçš„åœ°æ–¹å°±æ˜¯å¾®ä¿¡çš„webå¼€å‘è€…å·¥å…·BUGæ¯”è¾ƒå¤šï¼Ÿ 3.2 å››ç±»æ–‡ä»¶è¿™é‡Œæˆ‘ä»¬å†è¯´ä¸€ä¸‹å°ç¨‹åºé‡Œé¢çš„å››ç±»ä¸»è¦æ–‡ä»¶ï¼š ç½‘é¡µç¼–ç¨‹é‡‡ç”¨çš„æ˜¯ HTML + CSS + JS è¿™æ ·çš„ç»„åˆï¼Œå…¶ä¸­ HTML æ˜¯ç”¨æ¥æè¿°å½“å‰è¿™ä¸ªé¡µé¢çš„ç»“æ„ï¼ŒCSS ç”¨æ¥æè¿°é¡µé¢çš„æ ·å­ï¼ŒJS é€šå¸¸æ˜¯ç”¨æ¥å¤„ç†è¿™ä¸ªé¡µé¢å’Œç”¨æˆ·çš„äº¤äº’ã€‚åœ¨å°ç¨‹åºä¸­ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ 3.2.1 .jsjsæ˜¯å…¸å‹çš„è„šæœ¬æ–‡ä»¶ï¼Œåœ¨å°ç¨‹åºè¿™é‡Œï¼Œè¿˜å¯ä»¥åœ¨jsä¸­è°ƒç”¨å°ç¨‹åºçš„APIï¼Œå®ç°æ›´ä¸°å¯Œçš„åŠŸèƒ½ã€‚ ï¼ˆå®˜æ–¹æ˜¯è¿™ä¹ˆè¯´çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘æ€»è§‰å¾—å¾®ä¿¡å°ç¨‹åºçš„æœ‰å¾ˆå¤šåŠŸèƒ½éƒ½æ— æ³•å®ç°ï¼Œè¢«é™åˆ¶å¾—å¤ªæ­»äº†ï¼‰ 3.2.2 .jsonjsonå°±æ˜¯é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´ï¼Œä½†æ˜¯æ ¹æ®æ–‡ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„jsonæ–‡ä»¶å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œæˆ‘ä»¬ä»¥ åœ¨æ ¹ç›®å½•ä¸‹çš„app.json ï¼Œ project.config.jsonï¼Œå’Œåœ¨ pages/logs ç›®å½•ä¸‹çš„logs.jsonä¸ºä¾‹ä¾æ¬¡æ¥è¯´æ˜ä¸€ä¸‹ä»–ä»¬çš„ç”¨é€”ã€‚ app.json æ˜¯å°ç¨‹åºçš„é…ç½®æ–‡ä»¶ã€‚å®ƒæ˜¯å¯¹å½“å‰å°ç¨‹åºçš„å…¨å±€é…ç½®ï¼ŒåŒ…æ‹¬äº†å°ç¨‹åºçš„æ‰€æœ‰é¡µé¢è·¯å¾„ã€ç•Œé¢è¡¨ç°ã€ç½‘ç»œè¶…æ—¶æ—¶é—´ã€åº•éƒ¨ tab ç­‰ã€‚ project.config.jsonæ˜¯æ•´ä¸ªIDEçš„é…ç½®æ–‡ä»¶ã€‚å®ƒä¿å­˜ç€IDEçš„å„ç±»é…ç½®ï¼Œæ¯”å¦‚ä»£ç çš„å­—ä½“é¢œè‰²å¤§å°ç­‰å„ç±»ä¿¡æ¯ï¼Œç±»ä¼¼äºJetBrainså®¶çš„IDEå¯¼å‡ºçš„settingæ–‡ä»¶ï¼Œæ–¹ä¾¿è¿ç§»IDEç¯å¢ƒçš„æ—¶å€™æ¢å¤åŸæ¥çš„å¼€å‘ç¯å¢ƒé…ç½®çš„ã€‚ page.jsonæ˜¯æ‰€å±é¡µé¢çš„é…ç½®æ–‡ä»¶ã€‚å’Œapp.jsonä¸åŒï¼Œå®ƒåªå¯¹æ‰€åœ¨ç›®å½•çš„é¡µé¢ç”Ÿæ•ˆã€‚å¦‚æœå°†app.jsonçœ‹ä½œæ˜¯å…¨å±€é…ç½®ï¼Œé‚£ä¹ˆpage.jsonå°±å¯ä»¥çœ‹ä½œæ˜¯å±€éƒ¨é…ç½®ã€‚ 3.2.3 .wxssç±»æ¯”cssæ–‡ä»¶ï¼Œå°±æ˜¯ç”¨æ¥é…ç½®é¡µé¢çš„å„ç§æ ·å¼ã€‚ 3.2.4 .wxmlç±»æ¯”htmlæ–‡ä»¶ï¼Œåœ¨å°ç¨‹åºä¸­ WXML å……å½“çš„å°±æ˜¯ç±»ä¼¼ HTML çš„è§’è‰²ã€‚ 4ã€HelloWorldå›åˆ°æ¨¡æ‹Ÿå™¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°â€¦â€¦emmmï¼Œå¯¹çš„ï¼Œhello worldå°±åœ¨è¿™é‡Œã€‚ï¼ˆå¤©å“ªå¥½æ²¡æˆå°±æ„Ÿï¼Œè¿™ä¸ªhelloworldæ²¡æœ‰ä¸€ä¸ªä»æ— åˆ°æœ‰çš„å‡ºç°è¿‡ç¨‹ï¼Œå¤ªæ²¡æ„æ€äº†ã€‚ï¼‰ æˆ‘ä»¬ç‚¹å‡»è·å–å¤´åƒæ˜µç§°ï¼Œç„¶åå°±å¯ä»¥ç™»å½•äº†ï¼Œç”¨çš„å¾®ä¿¡è´¦å·å°±æ˜¯æˆ‘ä»¬åˆšåˆšæ‰«ç ç™»å½•çš„é‚£ä¸ªå¾®ä¿¡è´¦å·ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ç”¨æ¥ç»‘å®šè¿™ä¸ªå°ç¨‹åºå¼€å‘è´¦å·çš„å¾®ä¿¡è´¦å·ã€‚ æœ€ååˆ°è¿™é‡Œå°±ç®—æ˜¯ç™»å½•æˆåŠŸäº†ï¼Œæ•´ä¸ªç¬¬ä¸€æ­¥ä¹Ÿå°±å®Œæˆäº†ã€‚ æœ€åå†é¢å¤–æä¸€ä¸‹ï¼Œå…³äºç¬¬ä¸‰æ–¹å¼€å‘è€…èƒ½è·å–çš„å¾®ä¿¡ç”¨æˆ·çš„ä¿¡æ¯å…¶å®å¾ˆå°‘ï¼Œé™¤äº†å¤´åƒæ˜µç§°å’ŒIDåŸºæœ¬å°±æ²¡æœ‰äº†ã€‚ ä½†æ˜¯æœ‰äº›ä¾‹å¤–ï¼š è…¾è®¯çš„å«¡ç³»ï¼ˆäº²å„¿å­ï¼‰ï¼šQQéŸ³ä¹ã€è…¾è®¯è§†é¢‘ç­‰å¯ä»¥é€šè¿‡å°ç¨‹åºå®ç°ä¸€äº›ç®€å•çš„è¾“å‡ºåˆ°æœ‹å‹åœˆçš„æ“ä½œã€‚ è…¾è®¯çš„æ—ç³»ï¼ˆå¹²å„¿å­ï¼‰ï¼šå¤§ä¼—ç‚¹è¯„ã€ç¾å›¢ç­‰ç­‰å¯ä»¥é€€ä¸€æ­¥ï¼Œèƒ½å¤Ÿè·å–å¾®ä¿¡ç”¨æˆ·çš„å¥½å‹ä»¥åŠå±•ç¤ºä»–ä»¬çš„æ“ä½œã€‚ å’Œè…¾è®¯æ‰¯ä¸ä¸Šå•¥å…³ç³»çš„ç¬¬ä¸‰æ–¹å¼€å‘è€…ï¼šè·å–æ˜µç§°å¤´åƒIDå°±å·®ä¸å¤šäº†ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¾®ä¿¡çš„å°ç¨‹åºå¹¶ä¸æ˜¯å¯¹æ‰€æœ‰å¼€å‘è€…å¹³ç­‰çš„ï¼Œè‡³å°‘åœ¨ç°åœ¨æ¥è¯´ï¼Œå¯¹å¼€å‘è€…èƒ½è·å–çš„æƒé™æ¥è¯´æ˜¯ä¸å¹³ç­‰çš„ï¼Œå®ƒå’ŒFacebookçš„botsè™½ç„¶çœ‹èµ·æ¥å¾ˆåƒï¼Œä½†æ˜¯åœ¨å¼€å‘è€…å±‚é¢æ¥è¯´è¿˜æ˜¯æœ‰å¾ˆå¤§å·®åˆ«çš„ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"}]},{"title":"æ•°æ®ç»“æ„å¤ä¹ æçº²","slug":"20180630-data-structure","date":"2018-06-30T07:00:00.000Z","updated":"2018-06-30T07:00:00.000Z","comments":true,"path":"20180630-data-structure/","link":"","permalink":"https://tinychen.com/20180630-data-structure/","excerpt":"æ±•å¤´å¤§å­¦äºæ´¥è€å¸ˆçš„æ•°æ®ç»“æ„å¤ä¹ é¢˜ï¼Œå¯¹åº”æ•™ææ˜¯æ¸…åçš„ä¸¥è”šæ•è€å¸ˆçš„ã€Šæ•°æ®ç»“æ„ã€‹ã€‚","text":"æ±•å¤´å¤§å­¦äºæ´¥è€å¸ˆçš„æ•°æ®ç»“æ„å¤ä¹ é¢˜ï¼Œå¯¹åº”æ•™ææ˜¯æ¸…åçš„ä¸¥è”šæ•è€å¸ˆçš„ã€Šæ•°æ®ç»“æ„ã€‹ã€‚ ä»¥Niklus Wirthçš„è§‚ç‚¹ï¼Œç¨‹åºç­‰äºä»€ä¹ˆ? ç¨‹åº=æ•°æ®ç»“æ„+ç®—æ³• ç®—æ³•çš„é‡è¦ç‰¹æ€§ï¼›å¥½ç®—æ³•çš„æ ‡å‡†ã€‚ ç®—æ³•çš„é‡è¦ç‰¹æ€§ï¼šâ‘ æœ‰ç©·æ€§â‘¡ç¡®å®šæ€§â‘¢å¯è¡Œæ€§â‘£è¾“å…¥â‘¤è¾“å‡º å¥½ç®—æ³•çš„æ ‡å‡†ï¼šâ‘ æ­£ç¡®æ€§â‘¡å¯è¯»æ€§â‘¢å¥å£®æ€§â‘£é«˜æ•ˆç‡å’Œä½å­˜å‚¨ æ•°æ®ç»“æ„ä¸»è¦ç ”ç©¶å¯¹è±¡ï¼š é€»è¾‘ç»“æ„ï¼ˆçº¿æ€§ã€éçº¿æ€§ï¼‰ã€ å­˜è´®ç»“æ„ï¼ˆé¡ºåºã€é“¾å¼ã€ç´¢å¼•ã€æ•£åˆ—hashï¼‰ï¼› è¿ç®—/æ“ä½œï¼ˆå¯¹æ•°æ®çš„æœ€ä¸»è¦çš„æ“ä½œï¼šå¢åˆ æ”¹æŸ¥ï¼‰ï¼› æ•°æ®çš„é€»è¾‘ç»“æ„æœ‰å‡ å¤§ç±»ï¼Ÿ çº¿æ€§ã€éçº¿æ€§ æ•°æ®çš„å­˜è´®ç»“æ„æœ‰å‡ ç±»ï¼Ÿ å››ç±»ï¼šé¡ºåºã€é“¾å¼ã€ç´¢å¼•ã€æ•£åˆ—hash çº¿æ€§ç»“æ„çš„ç‰¹ç‚¹ã€‚ çº¿æ€§ç»“æ„ä¸­çš„æ•°æ®å…ƒç´ å­˜åœ¨ä¸€ä¸ªå¯¹ä¸€ä¸ªçš„å…³ç³»ï¼Œåœ¨çº¿æ€§ç»“æ„ä¸­åªæœ‰ä¸€ä¸ªå¼€å§‹ç»“ç‚¹å’Œä¸€ä¸ªç»ˆç«¯ç»“ç‚¹ï¼Œå…¶ä»–çš„æ¯ä¸€ä¸ªç»“ç‚¹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå‰é©±ç»“ç‚¹å’Œåç»§ç»“ç‚¹ã€‚ çº¿æ€§ç»“æ„ä¸éçº¿æ€§ç»“æ„çš„åŒºåˆ«ã€‚ çº¿æ€§ç»“æ„ä¸­çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œè€Œéçº¿æ€§ç»“æ„ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯ä¸€å¯¹å¤šæˆ–è€…æ˜¯å¤šå¯¹å¤šã€‚ åˆ—å‡ºæ‰€å­¦è¿‡çš„çº¿æ€§ç»“æ„ä¸éçº¿æ€§ç»“æ„ã€‚ çº¿æ€§ç»“æ„ï¼šçº¿æ€§è¡¨ï¼Œæ ˆï¼Œé˜Ÿåˆ—ï¼Œä¸²ï¼Œä¸€ç»´æ•°ç»„ï¼› éçº¿æ€§ç»“æ„ï¼šäºŒç»´æ•°ç»„ï¼Œå¤šç»´æ•°ç»„ï¼Œå¹¿ä¹‰è¡¨ï¼Œæ ‘ï¼Œæ£®æ—ï¼Œå›¾ï¼› å¤´æŒ‡é’ˆã€å¤´ç»“ç‚¹ã€é¦–å…ƒç»“ç‚¹çš„åŒºåˆ«ã€‚ å¤´æŒ‡é’ˆï¼šæŒ‡å‘é“¾è¡¨ä¸­ç¬¬ä¸€ä¸ªç»“ç‚¹ï¼ˆå¤´ç»“ç‚¹/é¦–å…ƒç»“ç‚¹ï¼‰çš„æŒ‡é’ˆï¼› å¤´ç»“ç‚¹ï¼šé“¾è¡¨çš„é¦–å…ƒç»“ç‚¹ä¹‹å‰é™„è®¾çš„ä¸€ä¸ªç»“ç‚¹ï¼› é¦–å…ƒç»“ç‚¹ï¼šé“¾è¡¨ä¸­å­˜å‚¨çº¿æ€§è¡¨ä¸­ç¬¬ä¸€ä¸ªæ•°æ®å…ƒç´ a1çš„ç»“ç‚¹ï¼› å¸¦å¤´ç»“ç‚¹å’Œä¸å¸¦å¤´ç»“ç‚¹çš„çº¿æ€§é“¾è¡¨(å•é“¾è¡¨)çš„åŒºåˆ«ã€‚ åœ¨ç»“æ„ä¸Šï¼Œå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œä¸ç®¡é“¾è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå‡å«æœ‰ä¸€ä¸ªå¤´ç»“ç‚¹ï¼Œä¸å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ä¸å«å¤´ç»“ç‚¹ã€‚ åœ¨æ“ä½œä¸Šï¼Œå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨çš„åˆå§‹åŒ–ä¸ºç”³è¯·ä¸€ä¸ªå¤´ç»“ç‚¹ã€‚æ— è®ºæ’å…¥æˆ–åˆ é™¤çš„ä½ç½®æ˜¯é¦–å…ƒç»“ç‚¹è¿˜æ˜¯å…¶ä»–ç»“ç‚¹ï¼Œç®—æ³•æ­¥éª¤éƒ½ç›¸åŒã€‚ä¸å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œåˆ™è¦è€ƒè™‘æ’å…¥æˆ–åˆ é™¤çš„ä½ç½®ã€‚ å•é“¾è¡¨ã€åŒé“¾è¡¨ã€å¾ªç¯é“¾è¡¨çš„åŒºåˆ«ã€å„è‡ªçš„ä¼˜ç¼ºç‚¹åŠæ€æ ·å†³å®šé€‰å–ä½•ç§å­˜è´®ç»“æ„ã€‚ å•é“¾è¡¨ï¼šæ¯ä¸ªç»“ç‚¹ä¸­åªåŒ…å«ä¸€ä¸ªæŒ‡é’ˆåŸŸ ä¼˜ç‚¹ï¼šæ’å…¥å’Œåˆ é™¤æ—¶å€™ä¸éœ€è¦ç§»åŠ¨å¤§é‡çš„å…ƒç´  ç¼ºç‚¹ï¼šæŒ‡é’ˆåªèƒ½å•æ–¹å‘ç§»åŠ¨ åŒé“¾è¡¨ï¼šæœ‰ä¸¤ä¸ªæŒ‡é’ˆåŸŸï¼Œå…¶ä¸€æŒ‡å‘ç›´æ¥åç»§ï¼Œå…¶äºŒæŒ‡å‘ç›´æ¥å‰é©± ä¼˜ç‚¹ï¼šæŸ¥æ‰¾ç›´æ¥å‰é©±çš„æ—¶å€™ï¼Œåˆ™ä»å¤´æŒ‡é’ˆå‡ºå‘ï¼Œèƒ½å¤Ÿå…‹æœå•é“¾è¡¨è¿™ç§å•å‘æ€§çš„ç¼ºç‚¹ ç¼ºç‚¹ï¼šæ’å…¥åˆ é™¤æ“ä½œæ—¶éœ€è¦ä¿®æ”¹å¤šä¸ªæŒ‡é’ˆåŸŸ å¾ªç¯é“¾è¡¨ï¼šæœ€åä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘å¤´ç»“ç‚¹ ä¼˜ç‚¹ï¼šä½¿ä¸¤ä¸ªè¡¨è¿æ¥èµ·æ¥å°±å¾ˆç®€å•ï¼Œè¿™ä¸ªæ“ä½œä»…éœ€ä¸¤ä¸ªæŒ‡é’ˆå³å¯ï¼Œæ’å…¥ã€åˆ é™¤æ—¶ï¼Œä¸ä¼šæ–­é“¾ç­‰ã€‚ ç¼ºç‚¹ï¼šä¸å®¹æ˜“ç¡®å®šé€€å‡ºå¾ªç¯çš„æ¡ä»¶ æ ˆå’Œé˜Ÿåˆ—æ˜¯ä»€ä¹ˆæ ·çš„çº¿æ€§è¡¨? æ ˆå’Œé˜Ÿåˆ—éƒ½æ˜¯æ“ä½œå—é™çš„çº¿æ€§è¡¨ã€‚ æ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„çº¿æ€§è¡¨ï¼Œé™å®šä»…åœ¨è¡¨å°¾è¿›è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨ã€‚ é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„çº¿æ€§è¡¨ï¼Œåªå…è®¸åœ¨è¡¨çš„ä¸€ç«¯è¿›è¡Œæ’å…¥ï¼Œè€Œåœ¨å¦ä¸€ç«¯åˆ é™¤å…ƒç´ ã€‚ æŒ‡å‡ºé¡ºåºçº¿æ€§è¡¨ã€é¡ºåºæ ˆã€é¡ºåºé˜Ÿåˆ—çš„åŒºåˆ«ã€‚ ç›¸åŒï¼šéƒ½æ˜¯çº¿æ€§è¡¨ï¼Œéƒ½æ˜¯ä¸€ç»´æ•°ç»„ï¼Œ ä¸åŒï¼šæ“ä½œä¸åŒï¼›ï¼ˆçº¿æ€§è¡¨æ˜¯ä»»æ„ä½ç½®æ“ä½œï¼Œæ ˆæ˜¯æ ˆé¡¶æ“ä½œï¼Œé˜Ÿåˆ—æ˜¯å°¾è¿›å¤´å‡ºï¼‰ é¡ºåºçº¿æ€§è¡¨ï¼šç”¨ä¸€ç»„åœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜å‚¨çº¿æ€§è¡¨çš„æ•°æ®å…ƒç´ ã€‚ é¡ºåºæ ˆï¼šå³æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„æ˜¯åˆ©ç”¨ä¸€ç»„åœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜æ”¾è‡ªæ ˆåº•åˆ°æ ˆé¡¶çš„æ•°æ®å…ƒç´ ï¼ŒåŒæ—¶é™„è®¾æŒ‡é’ˆtopæŒ‡ç¤ºæ ˆé¡¶å…ƒç´ åœ¨é¡ºåºæ ˆä¸­çš„ä½ç½®ã€‚ é¡ºåºé˜Ÿåˆ—ï¼šé™¤äº†ç”¨ä¸€ç»„åœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜æ”¾ä»é˜Ÿåˆ—å¤´åˆ°é˜Ÿåˆ—å°¾çš„å…ƒç´ ä¹‹å¤–ï¼Œå°šéœ€é™„è®¾ä¸¤ä¸ªæŒ‡é’ˆfrontå’Œrearåˆ†åˆ«æŒ‡ç¤ºé˜Ÿåˆ—å¤´å…ƒç´ åŠé˜Ÿåˆ—å°¾å…ƒç´ çš„ä½ç½®ã€‚ ä¾‹ä¸¾æ ˆå’Œé˜Ÿåˆ—çš„å®ä¾‹åŠç”¨æ ˆå’Œé˜Ÿåˆ—æ‰€èƒ½è§£å†³çš„é—®é¢˜ã€‚ æ ˆï¼šåè¿›å…ˆå‡ºçš„æ•°æ®ï¼ˆLIFOï¼‰ï¼Œå¦‚ï¼šæ•°åˆ¶è½¬æ¢ã€æ‹¬å·åŒ¹é…çš„æ ¡éªŒã€è¡Œç¼–è¾‘ç¨‹åºã€è¿·å®«æ±‚è§£ã€è¡¨è¾¾å¼æ±‚å€¼ã€é“è·¯ä¸­è½¬ç«™ï¼Œé¤å…çš„é£Ÿç‰©ç›˜, å­å¼¹å£³ã€‚ é˜Ÿåˆ—ï¼šå…ˆè¿›å…ˆå‡ºçš„æ•°æ® (FIFO)ï¼Œå¦‚ï¼šæ“ä½œç³»ç»Ÿä½œä¸šæ’é˜Ÿï¼Œæ’é˜Ÿä¹°ä¸œè¥¿ æŒ‡å‡ºé€šå¸¸è§£å†³é˜Ÿåˆ—å’Œæ ˆæº¢å‡ºæ—¶æ‰€èƒ½ç”¨åˆ°çš„æ–¹æ³•ã€‚ é˜Ÿåˆ—ï¼šåŒå‘é˜Ÿåˆ—ï¼Œé“¾é˜Ÿåˆ—ï¼Œå¾ªç¯é˜Ÿåˆ— æ ˆï¼šåŒæ ˆå…±äº«ï¼Œå¤šæ ˆå…±äº«ï¼Œé“¾æ ˆ å¾ªç¯é˜Ÿåˆ—çš„å¾ªç¯æ˜¯æ€æ ·å®ç°çš„? é˜Ÿå¤´ã€é˜Ÿå°¾æŒ‡é’ˆåŠ 1ï¼Œç”¨å–æ¨¡(ä½™æ•°)è¿ç®—å®ç°å¾ªç¯ ç»™å‡ºå¯¹ç§°çŸ©é˜µã€ä¸‰è§’çŸ©é˜µã€å¯¹è§’çŸ©é˜µèŠ‚çœå†…å­˜çš„å­˜è´®ç»“æ„å¹¶å†™å‡ºç›¸åº”çš„è¾“å…¥ã€è¾“å‡ºç®—æ³•ã€‚ å¯¹ç§°çŸ©é˜µçš„å­˜è´®ç»“æ„ï¼š åˆ©ç”¨ = æ¥å­˜å‚¨(ä»¥æŒ‰è¡Œå­˜å‚¨ä¸ºä¾‹) K=I(I-1)/2 +J-1 I&gt;=J; K=J(J-1)/2 +I-1 I&lt;J; k æ˜¯å¯¹ç§°çŸ©é˜µä½äºï¼ˆiï¼Œjï¼‰ä½ç½®çš„å…ƒç´ åœ¨ä¸€ç»´æ•°ç»„ä¸­çš„å­˜æ”¾ä½ç½®ï¼Œä»0å¼€å§‹ a11 a21 a22 a31 â€¦â€¦ ann ä¸‰è§’çŸ©é˜µçš„å­˜è´®ç»“æ„ï¼š ä»¥ä¸‹ä¸‰è§’ä¸ºä¾‹ï¼Œå½“i&lt;jæ—¶,aij=0 K=0çš„ä½ç½®å­˜å‚¨0 0 a11 a21 a22 â€¦â€¦ a å¯¹è§’çŸ©é˜µçš„å­˜è´®ç»“æ„ï¼š è®°ä½loc( aij )=loc( a11 )+( 2i+j-3 ) L i-1&lt;=j&lt;=i+1 è¾“å…¥è¾“å‡ºç®—æ³•ï¼š ç»™å‡ºç¨€ç–çŸ©é˜µçš„èŠ‚çœå†…å­˜çš„å­˜è´®ç»“æ„å¹¶å†™å‡ºç›¸åº”çš„è¾“å…¥ã€è¾“å‡ºç®—æ³•ã€‚ ä¸ºäº†èŠ‚çœå­˜å‚¨å•å…ƒï¼Œå¯åªå­˜å‚¨éé›¶å…ƒç´ ã€‚ç”±äºéé›¶å…ƒç´ çš„åˆ†å¸ƒä¸€èˆ¬æ˜¯æ²¡æœ‰è§„å¾‹çš„ï¼Œå› æ­¤åœ¨å­˜å‚¨éé›¶å…ƒç´ çš„åŒæ—¶ï¼Œè¿˜å¿…é¡»å­˜å‚¨éé›¶å…ƒç´ æ‰€åœ¨çš„è¡Œå·ã€åˆ—å·ï¼Œæ‰èƒ½è¿…é€Ÿç¡®å®šä¸€ä¸ªéé›¶å…ƒç´ æ˜¯çŸ©é˜µä¸­çš„å“ªä¸€ä¸ªå…ƒç´ ã€‚å…¶ä¸­æ¯ä¸€ä¸ªéé›¶å…ƒç´ æ‰€åœ¨çš„è¡Œå·ã€åˆ—å·å’Œå€¼ç»„æˆä¸€ä¸ªä¸‰å…ƒç»„ï¼Œå¹¶ç”±æ­¤ä¸‰å…ƒç»„æƒŸä¸€ç¡®å®šã€‚ 123456789101112131415161718192021222324252627282930313233343536373839//ä¸‰å…ƒç»„è¡¨#define MAXSIZE 100 //éé›¶å…ƒä¸ªæ•°çš„æœ€å¤§å€¼typedef struct&#123;int i,j; // è¡Œä¸‹æ ‡,åˆ—ä¸‹æ ‡ElemType e; // éé›¶å…ƒç´ å€¼&#125;Triple;typedef struct&#123;Triple data[MAXSIZE+1]; //éé›¶å…ƒä¸‰å…ƒç»„è¡¨,data[0]æœªç”¨int mu,nu, tu; // çŸ©é˜µçš„è¡Œæ•°ã€åˆ—æ•°å’Œéé›¶å…ƒä¸ªæ•°&#125;TSMatrix;//åå­—é“¾è¡¨typedef struct OLNode //ç»“ç‚¹çš„å®šä¹‰&#123;int i,j; // éé›¶å…ƒçš„è¡Œå’Œåˆ—ä¸‹æ ‡ElemType e; // éé›¶å…ƒç´ å€¼struct OLNode *right,*down; // è¯¥éé›¶å…ƒæ‰€åœ¨è¡Œè¡¨å’Œåˆ—è¡¨çš„åç»§é“¾åŸŸ&#125;OLNode, *OLink;typedef struct //é“¾è¡¨çš„å®šä¹‰&#123; OLink *rhead,*chead; // è¡Œå’Œåˆ—é“¾è¡¨å¤´æŒ‡é’ˆå‘é‡åŸºå€,ç”±CreatSMatrix_OL()åˆ†é…int mu,nu,tu; // ç¨€ç–çŸ©é˜µçš„è¡Œã€åˆ—æ•°å’Œéé›¶å…ƒä¸ªæ•°&#125;CrossList; è¾“å…¥è¾“å‡ºç®—æ³• ç”¨åå­—é“¾è¡¨å­˜è´®ç¨€ç–çŸ©é˜µæ—¶, çŸ©é˜µçš„æ¯ä¸ªå…ƒç´ åŒæ—¶åœ¨å‡ æ¡é“¾ä¸Š, åˆ†åˆ«è¢«ç§°ä¸ºä»€ä¹ˆé“¾ï¼Ÿ ä¸¤æ¡é“¾ï¼šè¡Œé“¾å’Œåˆ—é“¾ ç»™å‡ºæ ‘çš„ä¸åŒçš„å‡ ç§è¡¨ç¤ºï¼ˆå›¾ç¤ºï¼‰å½¢å¼ã€‚ ï¼ˆä¸€ï¼‰å±‚æ¬¡è¡¨ç¤ºæ³• ï¼ˆäºŒï¼‰å¹¿ä¹‰è¡¨è¡¨ç¤ºæ³• ï¼ˆä¸‰ï¼‰åµŒå¥—è¡¨ç¤ºæ³• ï¼ˆå››ï¼‰å‡¹å…¥æ³•è¡¨ç¤ºæ³• åœ¨äºŒå‰æ ‘çš„ç¬¬ iå±‚ä¸Šè‡³å¤šæœ‰å¤šå°‘ä¸ªç»“ç‚¹ã€‚æ·±åº¦ä¸º Kçš„äºŒå‰æ ‘è‡³å¤šæœ‰å¤šå°‘ä¸ªç»“ç‚¹ã€‚ ç¬¬iå±‚ä¸Šè‡³å¤šæœ‰2^ï¼ˆi-1ï¼‰^ä¸ªç»“ç‚¹ æ·±åº¦ä¸º Kçš„äºŒå‰æ ‘è‡³å¤šæœ‰2^k^-1ä¸ªç»“ç‚¹ åœ¨ä¸€é¢—äºŒå‰æ ‘ä¸­, å…¶å¶å­ç»“ç‚¹æ•°n0å’Œåº¦ä¸ºäºŒçš„ç»“ç‚¹æ•°n2ä¹‹é—´çš„å…³ç³»ã€‚ n0=n2+1 è¯æ˜è¿‡ç¨‹å¦‚ä¸‹ï¼š å‡è®¾äºŒå‰æ ‘çš„0åº¦,1åº¦,2åº¦ç»“ç‚¹ä¸ºn0,n1,n2,æ€»èŠ‚ç‚¹æ•°ä¸ºT åˆ™æœ‰æŒ‰ç…§ç»“ç‚¹æ±‚å’Œçš„ï¼šT = n0 + n1 + n2 ï¼ˆ1ï¼‰ æŒ‰ç…§è¾¹æ±‚å’Œå¾—ï¼šT = n1 + 2 * n2 + 1 ï¼ˆ2ï¼‰ æ‰€ä»¥ ï¼ˆ2ï¼‰ - ï¼ˆ1ï¼‰å¯å¾—ï¼šn2 + 1 - n0 = 0 æ‰€ä»¥n0 = n2 + 1 æœ‰ nä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„æ·±åº¦ã€‚ (log2n)+1 åœ¨äºŒå‰æ ‘çš„é¡ºåºå­˜è´®ç»“æ„ä¸­å¦‚ä½•æ±‚ç»“ç‚¹çš„åŒäº²ã€å­©å­? åŒäº²ï¼ši/2ï¼› å·¦å­©å­ï¼š2*iï¼› å³å­©å­ï¼š2*i+1ï¼› 25. æœ‰ nä¸ªç»“ç‚¹çš„äºŒå‰æ ‘ç”¨äºŒå‰é“¾è¡¨å­˜è´®æ—¶æœ‰å¤šå°‘ä¸ªç©ºé“¾åŸŸï¼Œç”¨ä¸‰å‰é“¾è¡¨å­˜è´®æ—¶æœ‰å¤šå°‘ä¸ªç©ºé“¾åŸŸã€‚ äºŒå‰ï¼šn+1ä¸ªç©ºé“¾åŸŸ ä¸‰å‰ï¼šn+2ä¸ªç©ºé“¾åŸŸ 26. ä¸ºä»€ä¹ˆå¯åœ¨ä¸å¢åŠ æŒ‡é’ˆåŸŸçš„æƒ…å†µä¸‹ï¼Œå¯¹äºŒå‰æ ‘è¿›è¡Œçº¿ç´¢åŒ–ï¼Œçº¿ç´¢åŒ–çš„ç›®çš„æ˜¯ä»€ä¹ˆ? â‘ åˆ©ç”¨n+1ä¸ªç©ºé“¾åŸŸ â‘¡ç›®çš„ï¼šéå†æ–¹ä¾¿ 27. å¯¹äºå·²çº¿ç´¢åŒ–äºŒå‰æ ‘å¦‚ä½•è¯†åˆ«æŒ‡é’ˆåŸŸæ˜¯æŒ‡å‘å­©å­è¿˜æ˜¯å…¶åç»§ç»“ç‚¹? å¢åŠ æ ‡å¿—åŸŸï¼šLeftThreadå’ŒRightThreadï¼ˆ0æŒ‡å‘å­©å­æŒ‡é’ˆï¼Œ1æŒ‡å‘å‰é©±/åç»§æŒ‡é’ˆï¼‰ 28. æ ‘çš„å‡ ç§å­˜è´®ç»“æ„(åŒäº²è¡¨ç¤ºæ³•ã€å­©å­è¡¨ç¤ºæ³•ã€å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•)çš„ä¼˜ç¼ºç‚¹ï¼Œå„è‡ªé€‚åº”çš„è¿ç®—ã€‚ åŒäº²è¡¨ç¤ºæ³•ï¼šä¾¿äºæŸ¥æ‰¾åŒäº²ï¼Œç¼ºç‚¹ï¼šæ‰¾å­©å­éš¾ å­©å­è¡¨ç¤ºæ³•ï¼šä¾¿äºæ¶‰åŠåˆ°å­©å­çš„æ“ä½œï¼Œç¼ºç‚¹ï¼šæ‰¾åŒäº²éš¾ å­©å­å…„å¼Ÿæ³•ï¼šæ“ä½œå®¹æ˜“ï¼Œç¼ºç‚¹ï¼šç ´åäº†æ ‘çš„å±‚æ¬¡ 29. å“ªç§å­˜è´®ç»“æ„å¯å°†æ£®æ—è½¬ä¸ºäºŒå‰æ ‘ã€‚å¯¹æ­¤ç§ç»“æ„çš„å„ä¸ªåŸŸç»™äºˆæ³¨é‡Šã€‚è¯´æ˜åœ¨è¿™ä¸ªç»“æ„ä¸­æ€æ ·æ‰¾åˆ°æ£®æ—çš„næ£µæ ‘ã€‚ å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•ï¼Œå·¦æŒ‡é’ˆæ˜¯ç¬¬ä¸€ä¸ªå­©å­ï¼Œå³æŒ‡é’ˆæ˜¯ç¬¬ä¸€ä¸ªå…„å¼Ÿï¼Œæœ€å³çš„ä¸ºç¬¬næ£µæ ‘ 30. æ ‘çš„å…ˆæ ¹éå†ã€åæ ¹éå†å¯¹åº”å…¶äºŒå‰æ ‘çš„å“ªç§éå†ï¼Œæ£®æ—çš„å…ˆæ ¹éå†ã€ä¸­æ ¹éå†å¯¹åº”å…¶äºŒå‰æ ‘çš„å“ªç§éå†? ï¼ˆå…ˆæ ¹å¯¹åº”å…ˆåºï¼Œå‰©ä¸‹çš„å‡‘åˆä¸€ä¸‹ï¼‰ æ ‘çš„å…ˆæ ¹éå† â†’ äºŒå‰æ ‘çš„å…ˆåºéå†ï¼› æ ‘çš„åæ ¹éå† â†’ äºŒå‰æ ‘çš„ä¸­åºéå†ï¼› æ£®æ—çš„å…ˆæ ¹éå† â†’ äºŒå‰æ ‘çš„å…ˆåºéå†ï¼› æ£®æ—çš„ä¸­æ ¹éå† â†’ äºŒå‰æ ‘çš„ä¸­åºéå†ã€‚ 31. ï¼ˆé€å‘½é¢˜ï¼‰å†™ç®—æ³•æ±‚æ ‘ä¸­ç»“ç‚¹çš„åº¦ï¼›æ ‘çš„åº¦ï¼›æ ‘ä¸­çš„å¶å­ç»“ç‚¹æ•°ï¼›æ ‘ä¸­çš„éç»ˆç«¯ç»“ç‚¹æ•°ï¼›æ ‘ä¸­æŸç»“ç‚¹çš„å…„å¼Ÿã€ç¥–å…ˆã€å­å­™ã€å±‚æ¬¡ã€å ‚å…„å¼Ÿï¼›æ ‘çš„é«˜åº¦ï¼›æ£®æ—ä¸­æ ‘çš„æ•°ç›®ã€‚ï¼ˆé»˜è®¤ä¸ºæ ‘æ˜¯äºŒå‰æ ‘ï¼‰ æ±‚æ ‘ä¸­ç»“ç‚¹çš„åº¦ï¼šï¼ˆå­©å­è¡¨ç¤ºæ³•ï¼‰æ±‚æ ‘çš„åº¦åªéœ€è¦æŒ‡é’ˆç§»åŠ¨ï¼Œåº¦æ•°é€’å¢å°±å¥½ æ ‘çš„åº¦ï¼šå…ˆæŠŠæ¯ä¸ªç»“ç‚¹çš„åº¦æ•°æ±‚å‡ºæ¥ï¼Œå†æŠŠæ‰€æœ‰ç»“ç‚¹çš„åº¦æ•°æ€»å’Œæ±‚å‡ºæ¥å°±å¥½å•¦ æ±‚æ ‘çš„å¶å­ç»“ç‚¹çš„ä¸ªæ•°ï¼šï¼ˆä¸‹é¢è¿™ä¸ªåªæ˜¯æ±‚äºŒå‰æ ‘çš„ï¼‰ 12345678910111213int Leaf_Count(Bitree T)&#123;*//æ±‚äºŒå‰æ ‘ä¸­å¶å­ç»“ç‚¹çš„æ•°ç›®*if(!T) return 0; //ç©ºæ ‘æ²¡æœ‰å¶å­else if(!T-&gt;lchild&amp;&amp;!T-&gt;rchild) return 1; //å¶å­ç»“ç‚¹else return Leaf_Count(T-lchild)+Leaf_Count(T-rchild);//å·¦å­æ ‘çš„å¶å­æ•°åŠ ä¸Šå³å­æ ‘çš„å¶å­æ•°&#125; æ±‚æ£®æ—ä¸­æ ‘çš„æ•°ç›®ï¼šå°±æ˜¯å³å­©å­å¾ªç¯è¿‡å»ï¼Œç®—å‡ºå³å­©å­çš„æ•°ç›®ï¼Œå†åŠ ä¸Šæœ¬èº«æ ¹èŠ‚ç‚¹ï¼ˆå³å³å­©å­æ ‘+1ï¼‰ 32. Huffmanæ ‘èƒ½å¤Ÿè§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå›¾ç¤ºhuffmanç¼–ç è¿‡ç¨‹ã€‚ 1ï¼‰æ•°æ®é€šä¿¡ä¸­çš„æ•°æ®å‹ç¼©ç¼–ç é—®é¢˜ 2ï¼‰æ„é€ Huffmanæ ‘æ­¥éª¤ï¼š å›¾ç¤ºï¼š 33. å¦‚ä½•è®¾è®¡Huffmanç¼–è¯‘ç å™¨æœ€æœ‰æ•ˆï¼Ÿ ï¼ˆçœ‹ä¸æ‡‚å°±çœ‹ä¸Šé¢çš„å›¾ï¼‰ â‘ æ ¹æ®ç»™å®šçš„nä¸ªæƒå€¼{w1,w2,â€¦â€¦wn}ï¼Œæ„é€ næ£µåªæœ‰æ ¹ ç»“ç‚¹çš„äºŒå‰æ ‘ï¼Œä»¤å…¶æƒå€¼ä¸ºwjï¼› â‘¡åœ¨æ£®æ—ä¸­é€‰å–ä¸¤æ£µæ ¹ç»“ç‚¹æƒå€¼æœ€å°çš„æ ‘ä½œå·¦å³å­æ ‘ï¼Œæ„é€ ä¸€æ£µæ–°çš„äºŒå‰æ ‘ï¼Œç½®æ–°äºŒå‰æ ‘æ ¹ç»“ç‚¹æƒå€¼ä¸ºå…¶å·¦å³å­æ ‘æ ¹ç»“ç‚¹æƒå€¼ä¹‹å’Œï¼› â‘¢åœ¨æ£®æ—ä¸­åˆ é™¤è¿™ä¸¤æ£µæ ‘ï¼ŒåŒæ—¶å°†æ–°å¾—åˆ°çš„äºŒå‰æ ‘åŠ å…¥æ£®æ—ä¸­é‡å¤ä¸Šè¿°ä¸¤æ­¥ï¼Œç›´åˆ°åªå«ä¸€æ£µæ ‘ä¸ºæ­¢ï¼Œè¿™æ£µæ ‘å³å“ˆå¤«æ›¼æ ‘ã€‚ 34. ä½•ä¸ºå®Œå…¨å›¾ã€ç¨€ç–å›¾ã€ç¨ å¯†å›¾ã€‚ å®Œå…¨å›¾ï¼šå³ä¸€ä¸ªå›¾ä¸­çš„ä»»æ„ä¸€ä¸ªé¡¶ç‚¹éƒ½ä¸å…¶ä½™æ‰€æœ‰é¡¶ç‚¹ç›¸é‚»ï¼ˆæœ‰è¿çº¿ï¼‰ã€‚å¯¹æœ‰å‘å›¾æ¥è¯´ï¼Œè¾¹æ•°ä¸ºn(n-1),å¯¹æ— å‘å›¾æ¥è¯´,è¾¹æ•°ä¸ºn(n-1)/2ç¨€ç–å›¾å’Œç¨ å¯†å›¾æ²¡æœ‰æ˜ç¡®é‡åŒ–å®šä¹‰ ç¨€ç–å›¾ï¼šæœ‰å¾ˆå°‘æ¡è¾¹çš„å›¾(e&lt;&lt;n ) ç¨ å¯†å›¾ï¼šæœ‰å¾ˆå¤šæ¡è¾¹çš„å›¾ 35. å†™ç®—æ³•æ±‚æ— å‘å›¾ä¸­ç»“ç‚¹çš„åº¦ï¼›æœ‰å‘å›¾ä¸­ç»“ç‚¹çš„å…¥åº¦å’Œå‡ºåº¦ã€‚ï¼ˆé‚»æ¥çŸ©é˜µå­˜å›¾ï¼‰ ** æ— å‘å›¾ï¼šé‚»æ¥çŸ©é˜µçš„ä¸€è¡Œæˆ–ä¸€åˆ—çš„æ•°å€¼å’Œä»£è¡¨å¯¹åº”å®šç‚¹çš„åº¦**ã€‚ ** æœ‰å‘å›¾ï¼šé‚»æ¥çŸ©é˜µçš„å¯¹åº”é¡¶ç‚¹çš„è¡Œä»£è¡¨å‡ºåº¦ï¼Œåˆ—ä»£è¡¨å…¥åº¦**ã€‚ 36. å›¾çš„é‚»æ¥çŸ©é˜µã€é‚»æ¥è¡¨å­˜è´®ç»“æ„å„è‡ªä¼˜ç¼ºç‚¹ï¼Œé€‚åº”è¿ç®—ã€‚ æ•°ç»„è¡¨ç¤ºæ³•ï¼ˆé‚»æ¥çŸ©é˜µè¡¨ç¤ºæ³•ï¼‰ï¼šäºŒç»´æ•°ç»„å­˜å‚¨å›¾ ä¼˜ç‚¹ï¼šå®¹æ˜“æ±‚å„ä¸ªé¡¶ç‚¹çš„åº¦ ç¼ºç‚¹ï¼šå½“å›¾ä¸ºç¨€ç–å›¾æ—¶æµªè´¹ç©ºé—´ é‚»æ¥è¡¨è¡¨ç¤ºæ³•ï¼š ä¼˜ç‚¹ï¼šå®¹æ˜“æ‰¾åˆ°ç¬¬ä¸€ä¸ªé‚»æ¥ç‚¹å’Œä¸‹ä¸€ä¸ªé‚»æ¥ç‚¹ ç¼ºç‚¹ï¼šä¸æ–¹ä¾¿æ‰¾ä¸€ä¸ªç»“ç‚¹çš„å…¥åº¦ 37. æœ€å°ä»£ä»·ç”Ÿæˆæ ‘çš„å®é™…åº”ç”¨èƒŒæ™¯ã€‚ è¦åœ¨nä¸ªåŸå¸‚é—´å»ºç«‹é€šä¿¡è”ç»œç½‘ï¼Œé¡¶ç‚¹è¡¨ç¤ºåŸå¸‚ï¼Œæƒè¡¨ç¤ºåŸå¸‚é—´å»ºç«‹é€šä¿¡çº¿è·¯æ‰€éœ€èŠ±è´¹ä»£ä»·ï¼Œå¸Œæœ›æ‰¾åˆ°ä¸€æ£µç”Ÿæˆæ ‘ï¼Œå®ƒçš„æ¯æ¡è¾¹ä¸Šçš„æƒå€¼ä¹‹å’Œï¼ˆå³å»ºç«‹è¯¥é€šä¿¡ç½‘æ‰€éœ€èŠ±è´¹çš„æ€»ä»£ä»·ï¼‰æœ€å°â€”â€”â€”æœ€å°ä»£ä»·ç”Ÿæˆæ ‘ 38. ä»€ä¹ˆå›¾é€‚åˆç”¨Primç®—æ³•æ±‚æœ€å°ä»£ä»·ç”Ÿæˆæ ‘ï¼Œä»€ä¹ˆå›¾é€‚åˆç”¨ Kruskalç®—æ³•æ±‚æœ€å°ä»£ä»·ç”Ÿæˆæ ‘ã€‚ Primç®—æ³•ï¼ˆç¨ å¯†å›¾ï¼Œn&gt;47ï¼‰Kruskalç®—æ³•ï¼ˆç¨€ç–å›¾ï¼‰ 39. å›¾ç¤ºç”¨ Primç®—æ³•åŠ Kruskalç®—æ³•æ±‚æœ€å°ä»£ä»·ç”Ÿæˆæ ‘è¿‡ç¨‹ã€‚ ï¼ˆçœ‹ä½œä¸šé¢˜7.5ï¼‰ Primç®—æ³•â€”â€”åŠ ç‚¹æ³•ï¼Œæ—¶é—´å¤æ‚åº¦O(n2) ä»æŸé¡¶ç‚¹å¼€å§‹ï¼Œæ‰¾å…¶ç›¸é‚»è¾¹ä¸­æƒå€¼æœ€å°çš„è¾¹æ‰€è¿å¦ä¸€ä¸ªé¡¶ç‚¹ï¼Œå†æ‰¾ä¸è¿™ä¸¤ä¸ªé¡¶ç‚¹ç›¸é‚»è¾¹ä¸­æƒå€¼æœ€å°çš„è¾¹æ‰€è¿ç¬¬ä¸‰ä¸ªé¡¶ç‚¹ï¼Œé‡å¤ï¼Œæ‰©å±•åˆ°æ‰€æœ‰é¡¶ç‚¹ã€‚ Kruskalç®—æ³•â€”â€”åŠ è¾¹æ³•,æ—¶é—´å¤æ‚åº¦ä¸è¾¹ç›¸å…³ å…ˆå°†æ‰€æœ‰é¡¶ç‚¹éƒ½çœ‹ä½œæ— è¾¹çš„éè¿é€šå›¾ï¼Œé€‰æ‹©å„é¡¶ç‚¹é—´æœ€å°è¾¹åšè¿é€šåˆ†é‡ï¼Œç›´åˆ°æ‰€æœ‰é¡¶ç‚¹éƒ½åœ¨åŒä¸€ä¸ªè¿é€šåˆ†é‡ä¸Šã€‚ 40. ä¸¾ä¾‹ç®€è¿°â€æ‹“æ‰‘æ’åºâ€æ‰€è§£å†³çš„å®é™…é—®é¢˜ã€‚ æµç¨‹å›¾ï¼Œæ–½å·¥æµç¨‹å›¾ï¼Œè¯¾ç¨‹å†³å®šçš„ä¼˜å…ˆæƒ 41. è¯·å›¾ç¤ºâ€æ‹“æ‰‘æ’åºâ€çš„è¿‡ç¨‹ã€‚ æ‹“æ‰‘æ’åºçš„æ–¹æ³•ï¼š â‘ åœ¨æœ‰å‘å›¾ä¸­é€‰ä¸€ä¸ªæ²¡æœ‰å‰é©±çš„é¡¶ç‚¹ä¸”è¾“å‡ºä¹‹ â‘¡ä»å›¾ä¸­åˆ é™¤è¯¥é¡¶ç‚¹å’Œæ‰€æœ‰ä»¥å®ƒä¸ºå°¾çš„å¼§ â‘¢é‡å¤ä¸Šè¿°ä¸¤æ­¥ï¼Œç›´è‡³å…¨éƒ¨é¡¶ç‚¹å‡å·²è¾“å‡ºï¼›æˆ–è€…å½“å›¾ä¸­ä¸å­˜åœ¨æ— å‰é©±çš„é¡¶ç‚¹ä¸ºæ­¢ 42. ä¸¾ä¾‹ç®€è¿°â€å…³é”®è·¯å¾„â€æ‰€è§£å†³çš„å®é™…é—®é¢˜ã€‚ ä¸€ä¸ªå·¥ç¨‹çš„å¹¶è¡Œçš„è¿›è¡Œè¿‡ç¨‹ ï¼ˆ1ï¼‰ å®Œæˆæ•´ä¸ªå·¥ç¨‹è‡³å°‘éœ€è¦å¤šå°‘æ—¶é—´ï¼› ï¼ˆ2ï¼‰ å“ªäº›æ´»åŠ¨æ˜¯å½±å“å·¥ç¨‹çš„å…³é”®ã€‚ 43. æœ€çŸ­è·¯å¾„çš„ä¸¤ä¸ªç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿ è¿ªæ°æ–¯ç‰¹æ‹‰(Dijkstra)ç®—æ³•å’Œå¼—æ´›ä¼Šå¾·(Floyd)ç®—æ³• ï¼ˆçœ‹ä½œä¸š7.6å’ŒPPTç¬¬7ç« ç¬¬100-117é¡µï¼‰ è¿ªæ°æ–¯ç‰¹æ‹‰(Dijkstra)ç®—æ³• æŒ‰è·¯å¾„é•¿åº¦é€’å¢æ¬¡åºäº§ç”Ÿæœ€çŸ­è·¯å¾„ï¼Œæ±‚ä»æŸä¸ªæºç‚¹åˆ°å…¶ä½™å„é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼› 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081void ShortestPath_DIJ( MGraph G, int v0, PathMatrix &amp;pre, ShortPathTable &amp;D)&#123;*// ç”¨Dijkstra ç®—æ³•æ±‚æœ‰å‘ç½‘Gçš„v0é¡¶ç‚¹åˆ°å…¶ä½™é¡¶ç‚¹vçš„æœ€çŸ­è·¯å¾„pre[v]åŠå…¶å¸¦æƒé•¿åº¦D[v]*// final[v]ä¸ºTRUEå½“ä¸”ä»…å½“vâˆˆS, å³å·²ç»æ±‚å¾—v0åˆ°vçš„æœ€çŸ­è·¯å¾„for (v=0;v&lt;G.vexnum;++v) &#123; pre[v] = -1;final[v]=FALSE; D[v]=G.arcs[v0][v];if (D[v]&lt;INFINITY) pre[v]=V0;&#125; //forD[v0]=0; final[v0]=TRUE; //åˆå§‹åŒ–ï¼Œv0é¡¶ç‚¹å±äºSé›†//å¼€å§‹ä¸»å¾ªç¯ï¼Œæ¯æ¬¡æ±‚å¾—v0åˆ°æŸä¸ªvé¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼Œå¹¶åŠ våˆ°Sé›†for (i=1;i&lt;G.vexnum; ++i)&#123; // å…¶ä½™G.vexnum-1ä¸ªé¡¶ç‚¹min=INFINITY; // å½“å‰æ‰€çŸ¥ç¦»v0é¡¶ç‚¹çš„æœ€è¿‘è·ç¦»for (w=0;w&lt;G.vexnum; ++w)if(!final[w])if(D[w]&lt;min) &#123;v=w; min=D[w];&#125; //wé¡¶ç‚¹ç¦»v0é¡¶ç‚¹æ›´è¿‘final[v]=TRUE; //ç¦»v0é¡¶ç‚¹æœ€è¿‘çš„våŠ å…¥Sé›†for (w=0; w&lt;G.vexnum; ++w) // æ›´æ–°å½“å‰æœ€çŸ­è·¯å¾„åŠè·ç¦»if(!final[w] &amp;&amp;(min+G.arcs[v][w]&lt;D[w])) &#123; //ä¿®æ”¹D[w]å’Œpre[w], wâˆˆV-SD[w]=min+G.arcs[v][w];pre[w]=v;&#125; //if&#125; //for&#125; //ShortestPath_DIJå¼—æ´›ä¼Šå¾·(Floyd)ç®—æ³•é€ä¸ªé¡¶ç‚¹è¯•æ¢æ³•ï¼Œæ±‚ä»æŸä¸ªæºç‚¹åˆ°å…¶ä½™å„é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼›void shortestPath_FLOYD(MGrgph G, PathMatrix &amp;path ,DistancMatrix &amp;length) &#123;//ç”¨Floydç®—æ³•æ±‚å¾—æœ‰å‘ç½‘Gä¸­å„å¯¹é¡¶ç‚¹vå’Œwä¹‹é—´çš„æœ€çŸ­è·¯å¾„ Path[v][w]åŠå…¶å¸¦æƒ//é•¿åº¦length[v][w]ã€‚ path[i][j]æ˜¯ç›¸åº”è·¯å¾„ä¸Šé¡¶ç‚¹ j çš„å‰ä¸€é¡¶ç‚¹çš„é¡¶ç‚¹å·,for ( int i = 0; i &lt; n; i++ ) //çŸ©é˜µlengthä¸pathåˆå§‹åŒ–for ( int j = 0; j &lt; n; j++ ) &#123;length[i][j] = G.arcs [i][j];if ( i &lt;&gt; j &amp;&amp; length [i][j] &lt; INFINITY ) path[i][j] = i; // i åˆ° j æœ‰è·¯å¾„else path[i][j] = -1; // i åˆ° j æ— è·¯å¾„&#125;for ( int k = 0; k &lt; n; k++ ) //äº§ç”Ÿlength(k)åŠpath(k)for ( i = 0; i &lt; n; i++ )for ( j = 0; j &lt; n; j++ )if ( length[i][k] + length[k][j] &lt; length[i][j] ) &#123;length [i][j] = length [i][k] + length [k][j];path[i][j] = k;&#125; //ç¼©çŸ­è·¯å¾„é•¿åº¦, ç»•è¿‡ k åˆ° j&#125; 44. ç®€è¿°é™æ€æŸ¥æ‰¾å’ŒåŠ¨æ€æŸ¥æ‰¾ï¼Ÿ é™æ€æŸ¥æ‰¾ï¼šåŸºäºçº¿æ€§è¡¨çš„æŸ¥æ‰¾ åŠ¨æ€æŸ¥æ‰¾ï¼šåŸºäºæ ‘çš„æŸ¥æ‰¾ æŸ¥æ‰¾è¡¨ï¼ˆSearch Tableï¼‰ï¼šæ˜¯ä¸€ç§ä»¥é›†åˆä¸ºé€»è¾‘ç»“æ„ã€ä»¥æŸ¥æ‰¾ä¸ºæ ¸å¿ƒè¿ç®—çš„æ•°æ®ç»“æ„ã€‚ é™æ€æŸ¥æ‰¾è¡¨ï¼šåªå¯¹æŸ¥æ‰¾è¡¨è¿›è¡ŒæŸ¥è¯¢æŸä¸ªç‰¹å®šçš„æ•°æ®å…ƒç´ æˆ–æŸä¸ªç‰¹å®šæ•°æ®å…ƒç´ çš„å„ç§å±æ€§çš„æ“ä½œã€‚å¦‚ï¼šæŸ¥è¯¢æˆç»©è¡¨ä¸­æ˜¯å¦æœ‰æŸå­¦ç”Ÿæˆ–è¯¥å­¦ç”ŸæŸé—¨è¯¾ç¨‹çš„æˆç»©ã€‚ åŠ¨æ€æŸ¥æ‰¾è¡¨ï¼šå¯¹æŸ¥æ‰¾è¡¨è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰¾ä¸åˆ°å°±æ’å…¥æŸä¸ªæ•°æ®å…ƒç´ çš„æ“ä½œã€‚å¦‚ï¼šæŸ¥æ‰¾æŸä¸ªå­¦ç”Ÿä¿¡æ¯ï¼Œæ‰¾ä¸åˆ°å°±æ’å…¥ã€‚ 45. é¡ºåºæŸ¥æ‰¾ã€æŠ˜åŠæŸ¥æ‰¾ã€åˆ†å—æŸ¥æ‰¾ç®—æ³•é€‚åˆçš„å…³é”®å­—ç»“æ„å’Œå­˜è´®ç»“æ„ã€‚ é¡ºåºæŸ¥æ‰¾ï¼šå¯¹å­˜å‚¨ç»“æ„å’Œå…³é”®å­—æ’åˆ—æ–¹å¼æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ æŠ˜åŠæŸ¥æ‰¾ï¼šå…³é”®å­—æ•´ä½“æœ‰åºï¼Œåªé€‚åˆé¡ºåºå­˜å‚¨çš„æœ‰åºè¡¨ åˆ†å—æŸ¥æ‰¾ï¼šå…³é”®å­—å±€éƒ¨æœ‰åºï¼Œå³åˆ†å—æœ‰åºï¼Œå¯¹å­˜å‚¨ç»“æ„ä¸ºé¡ºåºå’Œçº¿æ€§é“¾è¡¨çš„å‡é€‚ç”¨ 46. æ€æ ·ä»äºŒå‰æ’åºæ ‘å¾—åˆ°æœ‰åºè¡¨ã€‚ ä¸­åºéå† 47. å·²çŸ¥é•¿åº¦ä¸ºn çš„è¡¨æŒ‰è¡¨ä¸­å…ƒç´ é¡ºåºæ„é€ å¹³è¡¡äºŒå‰æ’åºæ ‘ï¼Œå›¾ç¤ºæ„é€ è¿‡ç¨‹ã€‚ https://blog.csdn.net/lemon_tree12138/article/details/50393548 å…ˆçœ‹ä¸Šé¢çš„åšå®¢ææ¸…æ¥šLLã€RRã€LRã€RLå››ç§éªšæ“ä½œï¼Œå†çœ‹è§£é‡Š æ ‘çš„å¹³è¡¡æ€§ç®€å•æ¥è¯´å°±æ˜¯å·¦è¾¹&lt;ä¸­é—´&lt;å³è¾¹,æ’å…¥æ–°çš„ç‚¹å¯èƒ½ä¼šç ´ä¼šè¿™ä¸ªå¹³è¡¡ï¼Œå°±è¦é€šè¿‡ä¸Šé¢çš„å››ä¸ªéªšæ“ä½œæ¥æ¢å¤å¹³è¡¡ã€‚ 48. è§£é‡Šæ„é€ å¹³è¡¡äºŒå‰æ’åºæ ‘çš„è¿‡ç¨‹ä¸­åšå„ç§æ—‹è½¬åä»èƒ½æ»¡è¶³äºŒå‰æ’åºæ ‘çš„ç‰¹æ€§ã€‚ å› ä¸ºè®°å½•çš„æ˜¯å¯¼è‡´æ•´æ£µå¹³è¡¡äºŒå‰æ ‘å¤±å»å¹³è¡¡çš„é‚£æ£µå­æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå› æ­¤åªè¦è°ƒèŠ‚è¿™æ£µå­æ ‘ä¾¿èƒ½è®©æ•´æ£µå¹³è¡¡äºŒå‰æ ‘æ ‘å¹³è¡¡ 49. å„ç§æŸ¥æ‰¾ç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ã€‚ 50. ç®€è¿°HashæŸ¥æ‰¾çš„æ„å»ºè¿‡ç¨‹ï¼›ä¸ºä¸€ç»„å…³é”®å­—æ„é€ å“ˆå¸Œå‡½æ•°å¹¶å»ºç«‹å“ˆå¸Œè¡¨ã€‚ 1ã€åˆ†ææ•°æ®ï¼› 2ã€æ„å»ºåˆé€‚çš„å“ˆå¸Œå‡½æ•°åŠè§£å†³å†²çªçš„æ–¹æ³•ï¼› 3ã€ç”¨å“ˆå¸Œå‡½æ•°å¯¹æ•°æ®è®¡ç®—å­˜å‚¨ä½ç½®ï¼Œå­˜å‚¨æ•°æ®ï¼› 4ã€å¯¹å“ˆå¸Œè¡¨è¿›è¡ŒæŸ¥æ‰¾ï¼› 51. æŒ‡å‡ºå¸Œå°”æ’åºï¼Œå½’å¹¶æ’åºï¼Œå¿«é€Ÿæ’åºï¼Œå †æ’åºï¼ŒåŸºæ•°æ’åºä¸­ç¨³å®šçš„æ’åºï¼Œå¯¹ä¸ç¨³å®šçš„ä¸¾å‡ºåä¾‹ã€‚ 52. å †æ’åºç®—æ³•é€‰ç”¨ä»€ä¹ˆæ ·çš„å­˜è´®ç»“æ„ï¼ŒæŒ‰æ­¤ç®—æ³•å¾—åˆ°çš„æœ‰åºè¡¨æ˜¯é€’å¢è¿˜æ˜¯é€’å‡çš„ã€‚å›¾ç¤ºå»ºå †è¿‡ç¨‹ã€‚ ä¸€ç»´æ•°ç»„å­˜å‚¨ï¼›å°é¡¶å †ï¼ˆé€’å¢ï¼‰ï¼›å¤§é¡¶å †ï¼ˆé€’å‡ï¼‰ 53. è—‰åŠ©äºâ€æ¯”è¾ƒâ€è¿›è¡Œæ’åºçš„ç®—æ³•åœ¨æœ€åæƒ…å†µä¸‹èƒ½è¾¾åˆ°çš„æœ€å¥½çš„æ—¶é—´å¤æ‚åº¦æ˜¯ä»€ä¹ˆ? n*log2n 54. æŒ‡å‡ºç›´æ¥æ’å…¥æ’åºï¼Œå†’æ³¡æ’åºï¼Œå¿«é€Ÿæ’åº, å †æ’åºï¼ŒåŸºæ•°æ’åºç®—æ³•å„é€‚åˆçš„å…³é”®å­—ç»“æ„ã€‚ ç›´æ¥æ’å…¥ï¼š åŸºæœ¬æœ‰åº å†’æ³¡æ’åºï¼š åŸºæœ¬æœ‰åº å¿«é€Ÿæ’åºï¼š å…³é”®å­—æ··ä¹±ï¼Œå‡åŒ€éšæœºåˆ†å¸ƒ å †æ’åºï¼š æ•°æ®éå¸¸å¤§ï¼Œéœ€è¦å¸¸å¸¸è·å¾—æœ€å¤§å’Œæœ€å°å€¼ åŸºæ•°æ’åºï¼š å¤šå…³é”®å­—æ’åº 55. æŒ‡å‡ºå„ç§æ’åºç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ã€æœ€åæƒ…å†µçš„æ—¶é—´å¤æ‚åº¦ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"},{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"}]},{"title":"åŒå¯åŠ¨Uç›˜","slug":"20180318-dou-boot-udisk","date":"2018-03-18T07:00:00.000Z","updated":"2018-03-18T07:00:00.000Z","comments":true,"path":"20180318-dou-boot-udisk/","link":"","permalink":"https://tinychen.com/20180318-dou-boot-udisk/","excerpt":"ä¸€èˆ¬æ¥è¯´ï¼Œä¿®ç”µè„‘çš„å„ä½è€é“ä»¬ï¼Œåœ¨åˆ¶ä½œPEå¯åŠ¨ç›˜çš„æ—¶å€™ï¼Œå°±ä¼šéœ€è¦æ ¼å¼åŒ–Uç›˜ï¼Œç„¶åå°†PEæ‰€éœ€è¦çš„æ–‡ä»¶åˆ»å½•è¿›Uç›˜é‡Œé¢ã€‚ å¯¹äºåƒå°ä¸ƒè¿™æ ·å–œæ¬¢ä½¿ç”¨Uç›˜åˆ»å½•å®‰è£…åŸç”Ÿçº¯å‡€çš„æ“ä½œç³»ç»Ÿçš„äººï¼Œå°±éœ€è¦å‡†å¤‡ä¸¤ä¸ªUç›˜ï¼Œä¸€ä¸ªç”¨æ¥åˆ¶ä½œPEå·¥å…·ç›˜ï¼Œä¸€ä¸ªç”¨æ¥å®‰è£…æ“ä½œç³»ç»Ÿï¼Œç°åœ¨å°ä¸ƒç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªæ–¹æ³•ï¼Œè®©ä¸€ä¸ªUç›˜å®ç°åŒå¯åŠ¨æˆ–è€…ä¸‰å¯åŠ¨ã€‚","text":"ä¸€èˆ¬æ¥è¯´ï¼Œä¿®ç”µè„‘çš„å„ä½è€é“ä»¬ï¼Œåœ¨åˆ¶ä½œPEå¯åŠ¨ç›˜çš„æ—¶å€™ï¼Œå°±ä¼šéœ€è¦æ ¼å¼åŒ–Uç›˜ï¼Œç„¶åå°†PEæ‰€éœ€è¦çš„æ–‡ä»¶åˆ»å½•è¿›Uç›˜é‡Œé¢ã€‚ å¯¹äºåƒå°ä¸ƒè¿™æ ·å–œæ¬¢ä½¿ç”¨Uç›˜åˆ»å½•å®‰è£…åŸç”Ÿçº¯å‡€çš„æ“ä½œç³»ç»Ÿçš„äººï¼Œå°±éœ€è¦å‡†å¤‡ä¸¤ä¸ªUç›˜ï¼Œä¸€ä¸ªç”¨æ¥åˆ¶ä½œPEå·¥å…·ç›˜ï¼Œä¸€ä¸ªç”¨æ¥å®‰è£…æ“ä½œç³»ç»Ÿï¼Œç°åœ¨å°ä¸ƒç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªæ–¹æ³•ï¼Œè®©ä¸€ä¸ªUç›˜å®ç°åŒå¯åŠ¨æˆ–è€…ä¸‰å¯åŠ¨ã€‚ æ­¤å¤„å…ˆä¸Šä¸€å¼ æˆå“å›¾ å›¾ä¸­ä¸‰ä¸ªç›˜å…¶å®éƒ½æ˜¯ä¸€ä¸ªUç›˜çš„ï¼Œç¬¬ä¸€ä¸ªé‡Œé¢çš„æ˜¯PEå·¥å…·ç®±ï¼Œç¬¬ä¸‰ä¸ªæ˜¯åŸè£…win10åˆ»å½•æ–‡ä»¶ï¼Œç¬¬äºŒä¸ªåˆ™å¯ä»¥å½“ä½œæ™®é€šUç›˜ä½¿ç”¨ã€‚ è¿™æ ·çš„å¥½å¤„æ˜¯ä¸€ä¸ªUç›˜åŒå¯åŠ¨ï¼Œå¹³æ—¶æ”¾çš„æ–‡ä»¶å’Œå·¥å…·ç®±/win10é•œåƒçš„æ–‡ä»¶ä¸å®¹æ˜“æ··æ·†ã€‚ æœ‰äº›åŒå­¦è¯´åœ¨åˆ»å½•win10é•œåƒçš„ç›˜ç¬¦é‡Œé¢ç”¨æ–‡ä»¶å¤¹å­˜æ”¾æ–‡ä»¶ä¹Ÿå¯ä»¥ï¼Œè¿™ä¸ªæ–¹æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ä½œä¸ºå¯åŠ¨ç›˜ä¸€èˆ¬éƒ½æ˜¯FAT32æ ¼å¼ï¼Œæ˜¯æ— æ³•å­˜æ”¾å•ä¸ªæ–‡ä»¶å¤§å°è¶…è¿‡4Gçš„æ–‡ä»¶çš„ã€‚ ï¼ˆPEå·¥å…·ç®±ä¹Ÿå¯ä»¥å®‰è£…æ“ä½œç³»ç»Ÿï¼Œä¹ æƒ¯ç”¨PEå®‰è£…ç³»ç»Ÿçš„æœ‹å‹å¯ä»¥å¿½ç•¥è¿™ç¯‡æ¨æ–‡ï¼‰ 1ã€å‡†å¤‡å·¥ä½œ åŸè£…ç³»ç»Ÿé•œåƒï¼ˆæ­¤å¤„ä½¿ç”¨æœ€æ–°ç‰ˆçš„64ä½win10ï¼Œå¯åœ¨msdn itellyouä¸­ä¸‹è½½ï¼‰ PEå·¥å…·ç®±çš„ISOæ–‡ä»¶ï¼ˆæ­¤å¤„ä½¿ç”¨å¾®PE2.0ç‰ˆæœ¬ï¼Œåå°å›å¤PEæœ‰æƒŠå–œï¼‰ Ultra ISOè½¯ä»¶ï¼ˆè¯•ç”¨ç‰ˆå³å¯ï¼‰ ä¸€ä¸ª8Gä»¥ä¸Šçš„Uç›˜ï¼ˆæ­¤å¤„ä½¿ç”¨ä¸€ä¸ª32Gçš„USB3.0çš„Uç›˜ï¼‰ ä¸€å°èƒ½ç”¨çš„æ­£å¸¸çš„ç”µè„‘ 2ã€åˆ»å½•åŸç‰ˆwin10é•œåƒé¦–å…ˆï¼Œå®‰è£…å¹¶æ‰“å¼€UltraISOï¼Œç‚¹å‡»ä¸Šæ–¹çš„èœå•æ ä¸­çš„ æ–‡ä»¶ â€”&gt; æ‰“å¼€ï¼Œç„¶åé€‰æ‹©win10é•œåƒæ–‡ä»¶ ç„¶åå†ç‚¹å‡»ä¸Šæ–¹çš„èœå•æ ä¸­çš„** å¯åŠ¨ â€”&gt; å†™å…¥ç¡¬ç›˜æ˜ åƒ** åœ¨å¼¹å‡ºçš„ç•Œé¢ä¸­ï¼Œæ£€æŸ¥ä¸‹å›¾çº¢æ¡†çš„ä¸¤é¡¹ï¼š ç¡¬ç›˜é©±åŠ¨å™¨è¦ç¡®å®šæ˜¯è‡ªå·±ç”¨æ¥åˆ¶ä½œçš„Uç›˜ éšè—å¯åŠ¨åˆ†åŒºé‡Œé¢è¦é€‰æ‹©é«˜ç«¯éšè— æ¥ä¸‹æ¥ä¼šæ ¼å¼åŒ–Uç›˜ï¼Œè¯·åŠ¡å¿…è¦å¤‡ä»½Uç›˜ä¸­çš„é‡è¦æ–‡ä»¶ åˆ»å½•å®Œæˆä¹‹åï¼Œæ‰“å¼€æˆ‘çš„ç”µè„‘ï¼Œä¼šå‘ç°Uç›˜å·²ç»è¢«åˆ†æˆä¸¤ä¸ªåˆ†åŒº å¦‚æœä¸éœ€è¦PEå·¥å…·ç®±ï¼Œåˆ°è¿™é‡Œå°±å¯ä»¥åœäº†ï¼Œå› ä¸ºåˆ°è¿™é‡Œå·²ç»åˆ¶ä½œäº†ä¸€ä¸ªæ­£å¸¸çš„win10å®‰è£…ç›˜ï¼Œéœ€è¦é‡è£…ç³»ç»Ÿçš„è¯ï¼Œç”¨è¿™ä¸ªUç›˜å°±å·²ç»OKäº†ã€‚ 3ã€åˆ©ç”¨ç£ç›˜ç®¡ç†è¿›è¡ŒäºŒæ¬¡åˆ†åŒºå³é”®æˆ‘çš„ç”µè„‘ï¼Œç‚¹å‡»ç®¡ç†ï¼Œåœ¨å·¦è¾¹æ‰¾åˆ°ç£ç›˜ç®¡ç†ï¼Œç„¶ååœ¨ä¸‹æ–¹æ‰¾åˆ°è‡ªå·±çš„Uç›˜ï¼Œåˆ é™¤æ‰ä¸Šå›¾ä¸­çš„20å¤šGçš„ç£ç›˜ ç„¶åæ–°å»ºä¸¤ä¸ªç£ç›˜ï¼Œä¸€ä¸ªå¤§å°ä¸º800Mï¼Œæ–‡ä»¶ç³»ç»Ÿç±»å‹è®°å¾—é€‰æ‹©FAT32ï¼Œå¦åˆ™PEå·¥å…·ç®±ä¼šæ— æ³•æ­£å¸¸å¯åŠ¨ å‰©ä¸‹çš„å…¨éƒ¨åˆ†åˆ°å¦ä¸€ä¸ªç›˜ï¼Œæ–‡ä»¶ç³»ç»Ÿç±»å‹éšæ„é€‰æ‹©ï¼ˆå»ºè®®exFATï¼‰ã€‚ æœ€ååº”è¯¥å’Œä¸‹å›¾ç±»ä¼¼ã€‚ 4ã€è§£å‹ISOæ–‡ä»¶åˆ¶ä½œPEå·¥å…·ç®±è§£å‹PEå·¥å…·ç®±çš„ISOæ–‡ä»¶ï¼ŒPEå·¥å…·ç®±çš„æ–‡ä»¶ä¸€èˆ¬éƒ½æ˜¯ä¸¤ä¸‰ç™¾MBï¼Œå°†è§£å‹åçš„æ–‡ä»¶å…¨éƒ¨å¤åˆ¶åˆ°å®¹é‡æ¯”è¾ƒå°çš„ç£ç›˜ä¸­ 5ã€æµ‹è¯•å°†Uç›˜æ’å…¥ç”µè„‘ï¼ŒæŒ‰ä¸‹å¼€æœºé”®çš„æ—¶å€™æŒ‰ESCæˆ–è€…F1/F2/F9/F12ç­‰æŒ‰é”®å³å¯è¿›å…¥å¯åŠ¨é¡¹é€‰æ‹©èœå•ï¼ˆä¸åŒç”µè„‘æƒ…å†µä¸åŒï¼‰ï¼Œå¦‚æœåƒä¸‹å›¾è¿™æ ·å‡ºç°äº†ä¸¤ä¸ªä¸€æ ·çš„å¯åŠ¨é¡¹ï¼Œé‚£ä¹ˆå°±åˆ¶ä½œæˆåŠŸã€‚ æœ€åï¼Œå¦‚ä½•åŒºåˆ†å“ªä¸ªæ‰æ˜¯PEï¼Œå“ªä¸ªæ‰æ˜¯WIN10å‘¢ï¼Ÿ ä½ å¯èƒ½ä¼šè¯´ï¼Œç›´æ¥ç‚¹è¿›å»è¯•ä¸€ä¸‹ä¸å°±è¡Œäº†ã€‚ å¯¹çš„ï¼Œæ²¡é”™è¿™ç¡®å®å¯ä»¥ï¼Œä½†æ˜¯è¿™æ ·çš„è¯å°±å¤ªæ²¡æœ‰æŠ€æœ¯å«é‡äº†ã€‚ æˆ‘ä»¬è¿˜æ˜¯æ‰“å¼€æˆ‘çš„ç”µè„‘ä¸­çš„ç£ç›˜ç®¡ç†ï¼Œä¼šå‘ç°å·¦è¾¹çš„æ˜¯PEï¼Œå³è¾¹çš„æ˜¯WIN10ï¼Œæ‰€ä»¥ä¸Šå›¾çš„ç¬¬ä¸€ä¸ªå°±æ˜¯PEï¼Œç¬¬äºŒä¸ªæ‰æ˜¯win10ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"}]},{"title":"ç¦ç”¨ç¬”è®°æœ¬å†…ç½®é”®ç›˜","slug":"20180225-disable-keyboard","date":"2018-02-25T07:00:00.000Z","updated":"2018-02-25T07:00:00.000Z","comments":true,"path":"20180225-disable-keyboard/","link":"","permalink":"https://tinychen.com/20180225-disable-keyboard/","excerpt":"æœ‰å¾ˆå¤šåŒå­¦ä¼šæœ‰ç»™ç¬”è®°æœ¬ç”µè„‘å¤–æ¥é”®ç›˜çš„éœ€æ±‚ï¼Œ ä½†æ˜¯å¦‚æœç›´æ¥å°†å¤–æ¥é”®ç›˜æ”¾åˆ°å†…ç½®é”®ç›˜ä¸Šé¢å®¹æ˜“è¯¯è§¦ï¼Œå°ä¸ƒåœ¨è¿™é‡Œè·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸ªé€šè¿‡CMDå‘½ä»¤ç¦ç”¨ç¬”è®°æœ¬å†…ç½®é”®ç›˜çš„æ–¹æ³•ã€‚","text":"æœ‰å¾ˆå¤šåŒå­¦ä¼šæœ‰ç»™ç¬”è®°æœ¬ç”µè„‘å¤–æ¥é”®ç›˜çš„éœ€æ±‚ï¼Œ ä½†æ˜¯å¦‚æœç›´æ¥å°†å¤–æ¥é”®ç›˜æ”¾åˆ°å†…ç½®é”®ç›˜ä¸Šé¢å®¹æ˜“è¯¯è§¦ï¼Œå°ä¸ƒåœ¨è¿™é‡Œè·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸ªé€šè¿‡CMDå‘½ä»¤ç¦ç”¨ç¬”è®°æœ¬å†…ç½®é”®ç›˜çš„æ–¹æ³•ã€‚ 1ã€ç¦ç”¨é¦–å…ˆï¼Œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒCMDã€‚ ç„¶åè¾“å…¥è¿™æ¡å‘½ä»¤ï¼š 1sc config i8042prt start= disabled é‡å¯ä¹‹åå°±å¯ä»¥ç¦ç”¨ç¬”è®°æœ¬å†…ç½®é”®ç›˜çš„æœåŠ¡ã€‚ 2ã€æ¢å¤éœ€è¦æ¢å¤çš„è¯ä¹Ÿå¾ˆç®€å•ï¼š 1sc config i8042prt start= auto é‡å¯ä¹‹åå³å¯å¯ç”¨ç¬”è®°æœ¬å†…ç½®é”®ç›˜çš„æœåŠ¡ã€‚ è¿™ä¸ªæ–¹æ³•çš„å¥½å¤„åœ¨äºç®€å•å¿«æ·ç¨³å®šã€‚ä¸éœ€è¦ä»€ä¹ˆæ‹†æœºæ‹”ç¬”è®°æœ¬é”®ç›˜æ’çº¿ï¼Œå¸è½½é”®ç›˜é©±åŠ¨/å®‰è£…é”™è¯¯é”®ç›˜é©±åŠ¨ç­‰ç­‰ä¸€ç³»åˆ—éªšæ“ä½œã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"}]},{"title":"ç¬¬å…­ä»£Wi-Fiåè®®çš„å‰ä¸–ä»Šç”Ÿ","slug":"20180109-wifi-dev","date":"2018-01-09T07:00:00.000Z","updated":"2018-01-09T07:00:00.000Z","comments":true,"path":"20180109-wifi-dev/","link":"","permalink":"https://tinychen.com/20180109-wifi-dev/","excerpt":"æœ¬å‘¨ï¼Œè‹±ç‰¹å°”å®£å¸ƒï¼šå°†ä»ä»Šå¹´ï¼ˆ2018ï¼‰å¼€å§‹æ·»åŠ å¯¹802.11axçš„æ”¯æŒï¼ŒåŒ…æ‹¬è·¯ç”±èŠ¯ç‰‡å’Œæ¶ˆè´¹çº§é›¶å”®äº§å“ã€‚å…¶å®æ—©åœ¨å»å¹´ï¼Œé€šä¿¡è¡Œä¸šå·¨å¤´åšé€šå°±å‘å¸ƒäº†ä¸‰æ¬¾æ”¯æŒ802.11axçš„èŠ¯ç‰‡BCM43684/43694/4375ï¼Œé«˜é€šä¹Ÿå®£å¸ƒäº†IPQ8074/QCA6290ã€‚è‡³æ­¤ï¼Œä¸‰å®¶èŠ¯ç‰‡å·¨å¤´éƒ½è¡¨æ˜äº†å¯¹802.11axåè®®çš„æ”¯æŒï¼Œ802.11axä¹Ÿç»ˆäºæ˜¯åç¨³äº†ç¬¬å…­ä»£Wi-Fiåè®®çš„ä½ç½®äº†ã€‚","text":"æœ¬å‘¨ï¼Œè‹±ç‰¹å°”å®£å¸ƒï¼šå°†ä»ä»Šå¹´ï¼ˆ2018ï¼‰å¼€å§‹æ·»åŠ å¯¹802.11axçš„æ”¯æŒï¼ŒåŒ…æ‹¬è·¯ç”±èŠ¯ç‰‡å’Œæ¶ˆè´¹çº§é›¶å”®äº§å“ã€‚å…¶å®æ—©åœ¨å»å¹´ï¼Œé€šä¿¡è¡Œä¸šå·¨å¤´åšé€šå°±å‘å¸ƒäº†ä¸‰æ¬¾æ”¯æŒ802.11axçš„èŠ¯ç‰‡BCM43684/43694/4375ï¼Œé«˜é€šä¹Ÿå®£å¸ƒäº†IPQ8074/QCA6290ã€‚è‡³æ­¤ï¼Œä¸‰å®¶èŠ¯ç‰‡å·¨å¤´éƒ½è¡¨æ˜äº†å¯¹802.11axåè®®çš„æ”¯æŒï¼Œ802.11axä¹Ÿç»ˆäºæ˜¯åç¨³äº†ç¬¬å…­ä»£Wi-Fiåè®®çš„ä½ç½®äº†ã€‚ æœ¬æ–‡å°†ä»‹ç»å†ä»£Wi-Fiåè®®ï¼ŒæŒ‰ç…§é¡ºåºä¸€æ¬¡ä¸º802.11a/b/g/n/ac/axï¼Œæœ¬æ–‡æ—¨åœ¨è®©ä¸äº†è§£Wi-Fiåè®®çš„è¯»è€…å¯¹å…¶èƒ½æœ‰ä¸€ä¸ªç²—ç•¥çš„è®¤è¯†ï¼Œå¹¶ä¸æ¶‰åŠè¿‡æ·±çš„ä¸“ä¸šçŸ¥è¯†ï¼ŒåŒæ—¶æ–‡ç« æœ¬èº«ä¸çŸ­ï¼Œé˜…è¯»è€—æ—¶è¾ƒé•¿ï¼Œè¯·å„ä½è¯»è€…è€å¿ƒé˜…è¯»ã€‚ å°ä¸ƒæ³¨ï¼š802.11ç³»åˆ—åè®®åº”ç”¨éå¸¸å¹¿æ³›ï¼Œåè®®æœ¬èº«ä¹Ÿéå¸¸å¤æ‚åºå¤§ï¼Œæœ¬æ–‡åªè®¾è®¡ä¸Šè¿°çš„6ç§åè®®å’Œ802.11adåè®®å…±è®¡7ç§ã€‚ 1ã€ä»€ä¹ˆæ˜¯Wi-Fiï¼Ÿæ—¢ç„¶æ˜¯è®²Wi-Fiåè®®ï¼Œé‚£ä¹ˆé¦–å…ˆè®²çš„å¿…ç„¶å°±åº”è¯¥æ˜¯Wi-Fiäº†ã€‚Wi-Fiå…¶å®è¯´ç™½äº†å°±æ˜¯ä¸€ç§è®©åŒ…æ‹¬ç”µè„‘æ‰‹æœºå¹³æ¿åœ¨å†…çš„ç”µå­è®¾å¤‡èƒ½å¤Ÿè¿æ¥åˆ°ä¸€ä¸ªæ— çº¿ç½‘ç»œçš„æŠ€æœ¯ã€‚ä½†å¾ˆå¤šäººéƒ½ä¸çŸ¥é“çš„æ˜¯ï¼ŒWi-Fiå…¶å®æœ¬èº«æ˜¯ä¸€ä¸ªå“ç‰Œæˆ–è€…è¯´æ˜¯å•†æ ‡ï¼Œç”±Wi-Fiè”ç›Ÿæ‰€æŒæœ‰ã€‚Wi-Fiè”ç›Ÿçš„å‰èº«æ˜¯1999å¹´æˆç«‹çš„æ— çº¿ä»¥å¤ªç½‘å…¼å®¹æ€§è”ç›ŸWECAï¼ˆWireless Ethernet Compatibility Allianceï¼‰ã€‚è€ŒWi-Fiè”ç›Ÿä¸€ç›´åœ¨ä½¿ç”¨çš„è¿™ä¸ª802.11ç³»åˆ—çš„æ— çº¿é€šä¿¡åè®®æ ‡å‡†ï¼Œæ˜¯ç”±IEEEä¸‹å±çš„802.11å·¥ä½œç»„æ‰€åˆ¶å®šçš„ã€‚ å°ä¸ƒæ³¨ï¼šç”µæ°”å’Œç”µå­å·¥ç¨‹å¸ˆåä¼š( IEEEï¼Œå…¨ç§°æ˜¯Institute of Electrical and Electronics Engineers)æ˜¯ä¸€ä¸ªå›½é™…æ€§çš„ç”µå­æŠ€æœ¯ä¸ä¿¡æ¯ç§‘å­¦å·¥ç¨‹å¸ˆçš„åä¼šï¼Œæ˜¯ç›®å‰å…¨çƒæœ€å¤§çš„éè¥åˆ©æ€§ä¸“ä¸šæŠ€æœ¯å­¦ä¼šï¼Œå…¶ä¼šå‘˜äººæ•°è¶…è¿‡40ä¸‡äººï¼Œéå¸ƒ160å¤šä¸ªå›½å®¶ã€‚IEEEè‡´åŠ›äºç”µæ°”ã€ç”µå­ã€è®¡ç®—æœºå·¥ç¨‹å’Œä¸ç§‘å­¦æœ‰å…³çš„é¢†åŸŸçš„å¼€å‘å’Œç ”ç©¶ï¼Œåœ¨å¤ªç©ºã€è®¡ç®—æœºã€ç”µä¿¡ã€ç”Ÿç‰©åŒ»å­¦ã€ç”µåŠ›åŠæ¶ˆè´¹æ€§ç”µå­äº§å“ç­‰é¢†åŸŸå·²åˆ¶å®šäº†900å¤šä¸ªè¡Œä¸šæ ‡å‡†ï¼Œç°å·²å‘å±•æˆä¸ºå…·æœ‰è¾ƒå¤§å½±å“åŠ›çš„å›½é™…å­¦æœ¯ç»„ç»‡ã€‚ çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯è§‰å¾—å¾ˆæ‡µï¼Ÿç®€å•æ¥è¯´å°±æ˜¯ç”±IEEEå†…çš„802.11å·¥ä½œç»„åˆ¶å®š802.11ç³»åˆ—æ ‡å‡†ï¼Œè€ŒWi-Fiè”ç›Ÿå¯¹ä½¿ç”¨802.11ç³»åˆ—æ ‡å‡†çš„è®¾å¤‡è¿›è¡Œè®¤å®šï¼Œç¬¦åˆWi-Fiè”ç›Ÿçš„è®¤å®šæ ‡å‡†çš„è®¾å¤‡å°±å¯ä»¥æ‰“ä¸ŠWi-Fiçš„è¿™ä¸ªlogoã€‚ ä¸‹é¢è¿›å…¥æ­£æ–‡ã€‚ 2ã€802.11â€”â€”è¿‡äºå¹³åº¸çš„ä¸€ä»£äºŒæˆ˜ä¹‹åï¼Œä¸–ç•Œç§‘æŠ€è¿›å…¥è¿…çŒ›å‘å±•æ—¶æœŸï¼Œäººä»¬å¯¹äºæ— çº¿é€šè®¯çš„éœ€è¦å¼€å§‹çˆ†å‘æ€§åœ°å¢é•¿ï¼ŒIEEEåœ¨20ä¸–çºª90å¹´ä»£åˆæˆç«‹äº†ä¸“é—¨çš„802.11å·¥ä½œç»„ï¼Œä¸“é—¨ç ”ç©¶å’Œå®šåˆ¶WLAN(æ— çº¿å±€åŸŸç½‘)çš„æ ‡å‡†åè®®ï¼Œå¹¶åœ¨1997å¹´6æœˆæ¨å‡ºäº†ç¬¬ä¸€ä»£WLANåè®®â€”â€”IEEE 802.11-1997ã€‚ å°ä¸ƒæ³¨ï¼šæ­¤å¤„çš„802.11æŒ‡çš„æ˜¯IEEEåˆ¶è®¢çš„ç¬¬ä¸€ä»£åè®®ï¼Œå¹¶éæ˜¯æ•´ä¸ªç³»åˆ—åè®®ï¼Œåœ¨802.11ä¹‹åçš„åè®®éƒ½åŠ å…¥äº†å­—æ¯åç¼€æ¥è¿›è¡ŒåŒºåˆ†ã€‚ ä½œä¸ºIEEEæœ€åˆåˆ¶å®šçš„ä¸€ä¸ªæ— çº¿å±€åŸŸç½‘æ ‡å‡†ï¼Œ802.11åè®®å®šä¹‰äº†ç‰©ç†å±‚å·¥ä½œåœ¨ISMçš„2.4Gé¢‘æ®µï¼Œæ•°æ®ä¼ è¾“é€Ÿç‡è®¾è®¡ä¸º2Mbpsã€‚å¾ˆé—æ†¾çš„æ˜¯ï¼Œç”±äºå®ƒåœ¨ä¼ è¾“é€Ÿåº¦å’Œä¼ è¾“è·ç¦»ä¸Šçš„è¡¨ç°éƒ½ä¸å°½å¦‚äººæ„ï¼Œå› æ­¤å¹¶æœªè¢«è§„æ¨¡ä½¿ç”¨ã€‚ 3ã€802.11aâ€”â€”ç”Ÿä¸é€¢æ—¶çš„ä¸€ä»£1999å¹´ï¼IEEEå¸å–äº†ä¸Šä¸€æ¬¡çš„æ•™è®­ï¼Œè¿™ä¸€æ¬¡å°±ç›´æ¥ä¸‹äº†çŒ›è¯ã€‚åœ¨åˆ¶å®š802.11aæ ‡å‡†çš„æ—¶å€™ï¼Œç›´æ¥å°†é¢‘æ®µå®šåœ¨äº†5GHzï¼ˆé¢‘ç‡è¶Šé«˜æœ€é«˜ä¼ è¾“é€Ÿåº¦è¶Šå¿«ï¼‰ï¼Œç‰©ç†å±‚çš„æœ€é«˜é€Ÿç‡ä¹Ÿéšä¹‹æ°´æ¶¨èˆ¹é«˜åˆ°äº†54Mbpsã€‚ç›¸æ¯”å‰ä¸€ä»£æ¥è¯´ï¼Œä¸å¯è°“ä¸ç»™åŠ›ã€‚ä½†æ˜¯ï¼Œ802.11aåè®®ä¹Ÿå¹¶æ²¡æœ‰è¢«å¸‚åœºè®¤å¯ï¼Œç›¸å¯¹æ¥è¯´è¡¨ç°çš„æ›´å‡ºè‰²çš„åè€Œæ˜¯å‡ ä¹å’Œå®ƒåŒæ—¶åˆ¶è®¢çš„802.11båè®®ã€‚ å°½ç®¡2003ä¸–ç•Œæ— çº¿ç”µé€šä¿¡ä¼šè®®è®©802.11aåœ¨å…¨çƒçš„åº”ç”¨å˜å¾—æ›´å®¹æ˜“ï¼Œä¸åŒçš„å›½å®¶è¿˜æ˜¯æœ‰ä¸åŒçš„è§„å®šæ”¯æŒã€‚ç¾å›½å’Œæ—¥æœ¬ç”šè‡³éƒ½å·²ç»å‡ºç°äº†ç›¸å…³è§„å®šå¯¹802.11aè¿›è¡Œäº†è®¤å¯ï¼Œä½†æ˜¯åœ¨å…¶ä»–åœ°åŒºï¼Œå¦‚æ¬§ç›Ÿå´å› ä¸ºæ ‡å‡†çš„é—®é¢˜è¢«ç¦æ­¢ä½¿ç”¨ã€‚å†åŠ ä¸Š802.11aäº§å“ä¸­5GHzçš„ç»„ä»¶ç ”åˆ¶æˆåŠŸå¤ªæ…¢ï¼Œç­‰å…¶å¼€å§‹å¤§è§„æ¨¡æ¨å¹¿çš„æ—¶å€™ï¼Œå¸‚åœºæ—©å·²è¢«å¤§æ‰¹çš„802.11bäº§å“å é¢†ï¼Œ802.11aæ²¡æœ‰è¢«å¹¿æ³›çš„é‡‡ç”¨ã€‚å†åŠ ä¸Š802.11açš„ä¸€äº›å¼±ç‚¹ï¼Œå’Œä¸€äº›åœ°æ–¹çš„è§„å®šé™åˆ¶ï¼Œä½¿å¾—å®ƒçš„ä½¿ç”¨èŒƒå›´æ›´çª„äº†ã€‚ 4ã€802.11bâ€”â€”å¥ å®šåŸºç¡€çš„ä¸€ä»£802.11båè®®å¯ä»¥è¯´æ˜¯802.11aæ˜¯åŒèƒå…„å¼Ÿäº†ã€‚ä½†å®ƒæœ¬èº«å´æ˜¯åŸºäº2.4GHzé¢‘ç‡ï¼ŒåŒæ—¶æœ€å¤§çš„ä¼ è¾“é€Ÿåº¦ç›¸æ¯”802.11aæ¥è¯´ä¹Ÿåªæœ‰11Mbpsã€‚11Mbpsçš„ä¼ è¾“é€Ÿç‡åœ¨ç°åœ¨çœ‹æ¥è‚¯å®šç®—ä¸äº†ä»€ä¹ˆï¼Œä½†åœ¨2000å¹´çš„æ—¶å€™ï¼Œè™½ç„¶ä¸æ˜¯ç¿˜æ¥šï¼Œä½†ä¹Ÿå·²ç»èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†äººçš„éœ€æ±‚äº†ã€‚ æ›´ä½•å†µåŸºäº2.4GHzçš„802.11båœ¨ä¼ è¾“è·ç¦»å’Œç©¿å¢™èƒ½åŠ›ä¸Šæœ¬æ¥å°±æ¯”åŸºäº5GHzçš„802.11aåè®®è¦æœ‰ä¼˜åŠ¿ï¼ˆé«˜é¢‘ç‡æ³¢ä¼ è¾“è·ç¦»å’Œç©¿å¢™èƒ½åŠ›è¾ƒä½é¢‘ç‡æ³¢å·®ï¼‰ï¼ŒåŠ ä¸Šå½“æ—¶802.11açš„æ ¸å¿ƒèŠ¯ç‰‡ç ”å‘è¿›åº¦ç¼“æ…¢ï¼Œ802.11bå°±æ­¤æŠ“ä½äº†æœºä¼šï¼Œå é¢†äº†å¸‚åœºï¼Œä¸ºæ—¥åç§°éœ¸å¤©ä¸‹æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ã€‚ 5ã€802.11gâ€”â€”èåˆå‰äººçš„ä¸€ä»£æ—¶é—´æ¥åˆ°äº†2003å¹´7æœˆï¼ŒIEEEåˆ¶è®¢äº†ç¬¬ä¸‰ä»£Wi-Fiæ ‡å‡†ï¼š802.11gã€‚ï¼ˆä¸ºä»€ä¹ˆä¸æ˜¯Cå‘¢ï¼Ÿå› ä¸º802.11åè®®è¿˜åº”ç”¨åœ¨å…¶ä»–çš„å¾ˆå¤šé¢†åŸŸï¼Œæœ‰äº›å­—æ¯è¢«ç”¨äº†ï¼Œå°±åªèƒ½æ’åˆ°gäº†ï¼‰ 802.11gç»§æ‰¿äº†802.11bçš„2.4GHzé¢‘æ®µå’Œ802.11açš„æœ€é«˜54Mbpsä¼ è¾“é€Ÿç‡ã€‚åŒæ—¶ï¼Œå®ƒè¿˜ä½¿ç”¨äº†CCKæŠ€æœ¯åå‘å…¼å®¹802.11bäº§å“ã€‚æ­¤æ—¶å¼€å§‹ï¼ŒIEEEåœ¨åˆ¶è®¢æ¯ä¸€ä»£æ–°åè®®çš„æ—¶å€™éƒ½ä¼šå°†åå‘å…¼å®¹è€ƒè™‘è¿›å»ï¼Œæ¯•ç«Ÿæ¢äº†æ–°è·¯ç”±å™¨æ—§æ‰‹æœºå°±å› ä¸ºä¸æ”¯æŒæ–°åè®®è€Œè¿ä¸ä¸ŠWi-Fiè¿™ç§æƒ…å†µè°éƒ½å—ä¸äº†ã€‚ è¯´åˆ°è¿™é‡Œï¼Œå°±è¿˜è¦å†æä¸€ä¸‹åœ¨802.11aå’Œ802.11gä¸Šéƒ½æœ‰ä½¿ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ï¼šOFDMã€‚ OFDM(Orthogonal Frequency Division Multiplexing)å³æ­£äº¤é¢‘åˆ†å¤ç”¨æŠ€æœ¯ï¼Œæ˜¯ç”±MCMï¼ˆMulti-Carrier Modulationï¼Œå¤šè½½æ³¢è°ƒåˆ¶ï¼‰å‘å±•è€Œæ¥çš„ä¸€ç§å®ç°å¤æ‚åº¦ä½ã€åº”ç”¨æœ€å¹¿çš„ä¸€ç§å¤šè½½æ³¢ä¼ è¾“æ–¹æ¡ˆã€‚OFDMä¸»è¦æ€æƒ³æ˜¯ï¼šå°†ä¿¡é“åˆ†æˆè‹¥å¹²æ­£äº¤å­ä¿¡é“ï¼Œå°†é«˜é€Ÿæ•°æ®ä¿¡å·è½¬æ¢æˆå¹¶è¡Œçš„ä½é€Ÿå­æ•°æ®æµï¼Œè°ƒåˆ¶åˆ°åœ¨æ¯ä¸ªå­ä¿¡é“ä¸Šè¿›è¡Œä¼ è¾“ã€‚æ­£äº¤ä¿¡å·å¯ä»¥é€šè¿‡åœ¨æ¥æ”¶ç«¯é‡‡ç”¨ç›¸å…³æŠ€æœ¯æ¥åˆ†å¼€ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å­ä¿¡é“ä¹‹é—´çš„ç›¸äº’å¹²æ‰°(ISI) ã€‚æ¯ä¸ªå­ä¿¡é“ä¸Šçš„ä¿¡å·å¸¦å®½å°äºä¿¡é“çš„ç›¸å…³å¸¦å®½ï¼Œå› æ­¤æ¯ä¸ªå­ä¿¡é“ä¸Šå¯ä»¥çœ‹æˆå¹³å¦æ€§è¡°è½ï¼Œä»è€Œå¯ä»¥æ¶ˆé™¤ç é—´ä¸²æ‰°ï¼Œè€Œä¸”ç”±äºæ¯ä¸ªå­ä¿¡é“çš„å¸¦å®½ä»…ä»…æ˜¯åŸä¿¡é“å¸¦å®½çš„ä¸€å°éƒ¨åˆ†ï¼Œä¿¡é“å‡è¡¡å˜å¾—ç›¸å¯¹å®¹æ˜“ã€‚ ä¸Šé¢è¿™æ®µå¾ˆéš¾ç†è§£ï¼Ÿæ²¡å…³ç³»ï¼Œçœ‹å°ä¸ƒæ‰“ä¸ªæ¯”å–»ä½ ä»¬å°±æ‡‚äº†ã€‚ å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰å¾ˆå¤šè½¦è¦ä»Aåœ°åˆ°Båœ°ï¼Œæ²¡æœ‰ä½¿ç”¨OFDMæŠ€æœ¯ä¹‹å‰ï¼Œè·¯æ˜¯ä¸€æ¡è·¯ï¼Œæ‰€æœ‰çš„è½¦å››å¤„ä¹±å¼€ï¼Œæ¨ªå†²ç›´æ’ï¼Œç»“æœè°éƒ½å¿«ä¸äº†ã€‚ç°åœ¨ä½¿ç”¨äº†OFDMæŠ€æœ¯ï¼Œå°†ä¸€æ¡å¤§è·¯åˆ’åˆ†ä¸ºå¾ˆå¤šä¸ªè½¦é“ï¼Œå¤§å®¶éƒ½æŒ‰ç…§è½¦é“é©¾é©¶ï¼Œè¿™æ ·æ—¢å¯ä»¥æé«˜é€Ÿåº¦ï¼Œåˆèƒ½å‡å°‘è½¦ä¸è½¦ä¹‹é—´çš„å¹²æ‰°ã€‚åŒæ—¶è¿™æ¡é“çš„è½¦å¤šäº†ï¼Œå°±åŒ€ä¸€ç‚¹åˆ°é‚£æ¡è½¦å°‘çš„é“ä¸Šå»ï¼Œç®¡ç†ä¸Šä¹Ÿæ–¹ä¾¿å¾ˆå¤šã€‚ OFDMæŠ€æœ¯ä¹Ÿå› æ­¤è¢«åº”ç”¨åœ¨ä¹‹åçš„æ¯ä¸€ä»£Wi-Fiåè®®ä¸­ã€‚ 6ã€802.11nâ€”â€”åˆéœ²é”‹èŠ’çš„ä¸€ä»£å¦‚æœè¯´802.11bæ˜¯å¥ å®šäº†æ•´ä¸ªå¸å›½çš„åŸºç¡€çš„ä¸€ä»£ï¼Œé‚£ä¹ˆ802.11nä¸€å®šæ˜¯ç»™å¸å›½å¼€ç–†æ‰©åœŸçš„ä¸€ä»£ã€‚ æ—¶é—´ç»§ç»­æ¨è¿›ï¼Œè¿™æ—¶çš„äº’è”ç½‘å·²ç»å¼€å§‹å‡ºç°äº†åœ¨çº¿å›¾ç‰‡ã€è§†é¢‘ã€æµåª’ä½“ç­‰æœåŠ¡ï¼Œè€Œéšç€YouTubeã€æ— çº¿å®¶åº­åª’ä½“ç½‘å…³ã€ä¼ä¸šVoIP Over WLANç­‰åº”ç”¨å¯¹WLANæŠ€æœ¯æå‡ºäº†è¶Šæ¥è¶Šé«˜çš„å¸¦å®½è¦æ±‚ï¼Œä¼ ç»ŸæŠ€æœ¯802.11a/gå·²ç»æ— æ³•æ”¯æ’‘ã€‚ç”¨æˆ·éœ€æ±‚å‘¼å”¤ç€å…¨æ–°ä¸€ä»£WLANæ¥å…¥æŠ€æœ¯ã€‚ 2009å¹´ï¼ŒIEEEå®£å¸ƒäº†æ–°çš„802.11næ ‡å‡†ã€‚ä¼ è¾“é€Ÿç‡æœ€é«˜å¯è¾¾600Mbpsã€‚ ä½†æ˜¯ï¼Œ802.11nåè®®è¿˜æ˜¯åŸºäº2.4GHzé¢‘æ®µï¼Œé€Ÿåº¦æ€ä¹ˆçªç„¶å°±å¿«äº†è¿™ä¹ˆå¤šå‘¢ï¼Ÿæ­£æ‰€è°“äº‹å‡ºåå¸¸å¿…æœ‰å¦–ï¼Œè€Œè¿™èƒŒåçš„â€œå¦–â€ï¼Œå°±æ˜¯MIMOã€æ³¢æŸæˆå½¢å’Œ40Mhzç»‘å®šã€‚ 6.1 MIMOMIMOï¼ˆMultiple-Input Multiple-Outputï¼‰çš„ä¸­æ–‡åç§°ä¸ºå¤šè¾“å…¥å¤šè¾“å‡ºæŠ€æœ¯æ˜¯æŒ‡åœ¨å‘å°„ç«¯å’Œæ¥æ”¶ç«¯åˆ†åˆ«ä½¿ç”¨å¤šä¸ªå‘å°„å¤©çº¿å’Œæ¥æ”¶å¤©çº¿ï¼Œä½¿ä¿¡å·é€šè¿‡å‘å°„ç«¯ä¸æ¥æ”¶ç«¯çš„å¤šä¸ªå¤©çº¿ä¼ é€å’Œæ¥æ”¶ï¼Œä»è€Œæ”¹å–„é€šä¿¡è´¨é‡ã€‚ MIMOæŠ€æœ¯æœ€æ—©æ˜¯ç”±é©¬å¯å°¼äº1908å¹´æå‡ºçš„ï¼Œå®ƒåˆ©ç”¨å‘å°„ç«¯çš„å¤šä¸ªå¤©çº¿å„è‡ªç‹¬ç«‹å‘é€ä¿¡å·ï¼ŒåŒæ—¶åœ¨æ¥æ”¶ç«¯ç”¨å¤šä¸ªå¤©çº¿æ¥æ”¶å¹¶æ¢å¤åŸä¿¡æ¯ï¼Œå°±å¯ä»¥å®ç°ä»¥æ›´å°çš„ä»£ä»·è¾¾åˆ°æ›´é«˜çš„ç”¨æˆ·é€Ÿç‡ã€‚MIMOå¯å¤§å¤§æé«˜ç½‘ç»œä¼ è¾“é€Ÿç‡ã€è¦†ç›–èŒƒå›´å’Œæ€§èƒ½ã€‚å½“åŸºäºMIMOè€ŒåŒæ—¶ä¼ é€’å¤šæ¡ç‹¬ç«‹ç©ºé—´æµæ—¶ï¼Œç³»ç»Ÿçš„ååé‡å¯æˆå€åœ°æé«˜ã€‚ ç®€å•æ¥è¯´ï¼ŒMIMOæŠ€æœ¯å°±æ˜¯åœ¨ä¿¡å·çš„å‘å°„æºå’Œæ¥æ”¶æºéƒ½å®‰è£…äº†å¤šä¸ªå¤©çº¿ï¼Œé€šè¿‡å †å¤©çº¿çš„æ–¹å¼æ¥å®ç°æ›´é«˜çš„ä¼ è¾“é€Ÿç‡ï¼Œå› æ­¤ç°åœ¨çš„ä¹°è·¯ç”±å™¨çœ‹å¤©çº¿æ•°é‡è¿™ä¸€ä¸ªè¯´è¯è™½ç„¶ä¸å¯é ï¼Œä½†ä¹Ÿä¸æ˜¯æ²¡æœ‰å†å²æ¸Šæºçš„ã€‚ â–²é€šè¿‡MIMOä¼ é€’å¤šæ¡ç©ºé—´æµï¼ˆå›¾ç‰‡æ¥è‡ªç½‘ç»œï¼‰ MIMOç³»ç»Ÿæ”¯æŒç©ºé—´æµçš„æ•°é‡å–å†³äºå‘é€å¤©çº¿å’Œæ¥æ”¶å¤©çº¿çš„æœ€å°å€¼ã€‚å¦‚å‘é€å¤©çº¿æ•°é‡ä¸º3,è€Œæ¥æ”¶å¤©çº¿æ•°é‡ä¸º2ï¼Œåˆ™æ”¯æŒçš„ç©ºé—´æµä¸º2ã€‚MIMO/SDMç³»ç»Ÿä¸€èˆ¬ç”¨â€œå‘å°„å¤©çº¿æ•°é‡Ã—æ¥æ”¶å¤©çº¿æ•°é‡â€è¡¨ç¤ºã€‚å¦‚ä¸Šå›¾ä¸º22 MIMO/SDMç³»ç»Ÿã€‚æ˜¾ç„¶ï¼Œå¢åŠ å¤©çº¿å¯ä»¥æé«˜MIMOæ”¯æŒçš„ç©ºé—´æµæ•°ã€‚*ä½†æ˜¯ç»¼åˆæˆæœ¬ã€å®æ•ˆç­‰å¤šæ–¹é¢å› ç´ ï¼Œå½“æ—¶ä¸šç•Œçš„WLAN APéƒ½æ™®éé‡‡ç”¨3Ã—3çš„æ¨¡å¼ã€‚è€Œç°åœ¨çš„æ——èˆ°çº§è·¯ç”±å™¨éƒ½è½»æ¾çš„å †åˆ°8Ã—8æˆ–è€…æ›´é«˜ã€‚ â–²å›¾ä¸º MIMOåˆ©ç”¨å¤šå¾„ä¼ è¾“æ•°æ®ï¼ˆå›¾ç‰‡æ¥è‡ªç½‘ç»œï¼‰ 6.2 æ³¢æŸæˆå½¢è€Œè‡³äºæ³¢æŸæˆå½¢æŠ€æœ¯ï¼Œå®ƒæœ¬èº«å¹¶ä¸æ˜¯ä»€ä¹ˆæ–°åè¯ï¼Œæ³¢æŸæˆå½¢æ˜¯å¤©çº¿æŠ€æœ¯ä¸æ•°å­—ä¿¡å·å¤„ç†æŠ€æœ¯çš„ç»“åˆï¼Œç›®çš„ç”¨äºå®šå‘ä¿¡å·ä¼ è¾“æˆ–æ¥æ”¶ã€‚åœ¨20ä¸–çºª60å¹´ä»£ï¼Œæ³¢æŸæˆå½¢æŠ€æœ¯å°±å·²ç»åœ¨å†›äº‹åº”ç”¨ä¸Šå¾—åˆ°äº†ç›¸å½“é«˜çš„é‡è§†ã€‚ åªä¸è¿‡ï¼Œç”±äºæ—©å¹´åŠå¯¼ä½“æŠ€æœ¯è¿˜å¤„åœ¨å¾®ç±³çº§ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰åœ¨æ°‘ç”¨é€šä¿¡ä¸­å‘æŒ¥åˆ°ç†æƒ³çš„çŠ¶æ€ã€‚ è€Œå‘å±•åˆ°æ— çº¿é€šè®¯é˜¶æ®µï¼Œç‰¹åˆ«æ˜¯åº”ç”¨åœ¨æ¶ˆè´¹çº§äº§å“ä¸­ï¼Œä¿¡å·ä¼ è¾“è·ç¦»å’Œä¿¡é“è´¨é‡ä»¥åŠæ— çº¿é€šä¿¡çš„æŠ—å¹²æ‰°é—®é¢˜ä¾¿æˆä¸ºç“¶é¢ˆã€‚æé«˜ä¼ è¾“é€Ÿç‡æ˜¯WLANæŠ€æœ¯å‘å±•å†ç¨‹çš„å…³é”®ã€‚802.11nä¸»è¦æ˜¯ç»“åˆç‰©ç†å±‚å’ŒMACå±‚çš„ä¼˜åŒ–ï¼Œæ¥å……åˆ†æé«˜WLANæŠ€æœ¯çš„ååã€‚æ­¤æ—¶ï¼Œæ³¢æŸæˆå½¢åˆæœ‰äº†ç”¨æ­¦ä¹‹åœ°ã€‚ æ³¢æŸæˆå½¢æŠ€æœ¯çš„å…·ä½“åŸç†å¾ˆå¤æ‚ï¼Œå°ä¸ƒåœ¨è¿™é‡Œç”¨å›¾ç‰‡ç»™å¤§å®¶ç®€å•å±•ç¤ºä¸€ä¸‹ï¼Œæ³¢æŸæˆå½¢å°±æ˜¯å°†åŸæœ¬å‘æ•£çš„æ³¢èšåˆï¼Œå†å¾€æŒ‡å®šçš„æ–¹å‘å‘é€ï¼Œä»è€Œæé«˜ä¼ è¾“è·ç¦»ã€‚ â–²æ³¢æŸæˆå½¢æŠ€æœ¯å¢åŠ ä¼ è¾“è·ç¦»çš„ç¤ºæ„å›¾ï¼ˆå›¾ç‰‡æ¥è‡ªç½‘ç»œï¼‰ ä½†æ˜¯æ³¢æŸæˆå½¢æŠ€æœ¯å›ºç„¶èƒ½æ”¹å–„ç³»ç»Ÿæ€§èƒ½ï¼Œå¢åŠ æ¥æ”¶è·ç¦»ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ è®¾å¤‡æˆæœ¬å’ŒåŠŸè€—ã€‚åœ¨å¤šå¤©çº¿éƒ½å¤„äºè¿æ¥çš„çŠ¶æ€ä¸‹ï¼Œå³ä½¿åœ¨ä¸¥é‡çš„è¡°è½æƒ…å†µä¸‹ï¼Œå®ƒæä¾›çš„ä¿¡å·å¢ç›Šä¹Ÿå¯è·æé«˜ï¼Œä½†è¦æ±‚ä¿¡å·å¤„ç†èƒ½åŠ›ä¹Ÿè¦å¾ˆå¼ºã€‚æ‰€ä»¥ï¼Œå¤šå¤©çº¿å¸¦æ¥çš„é—®é¢˜æ˜¯è¦æ±‚æ•°æ®å¤„ç†é€Ÿåº¦é«˜ï¼Œæ§åˆ¶æˆæœ¬ï¼Œå¹¶é™ä½åŠŸè€—ã€‚ 6.3 40Mhzç»‘å®šäº‹å®ä¸Šï¼Œ802.11nåè®®è¿˜ä½¿ç”¨äº†40Mhzç»‘å®šæŠ€æœ¯ã€‚è¿™ä¸ªæŠ€æœ¯æœ€å®¹æ˜“ç†è§£ï¼Œå¯¹äºæ— çº¿æŠ€æœ¯æ¥è¯´ï¼Œæé«˜æ‰€ç”¨é¢‘è°±çš„å®½åº¦ï¼Œå¯ä»¥æœ€ä¸ºç›´æ¥åœ°æé«˜ååã€‚å°±å¥½æ¯”æ˜¯é©¬è·¯å˜å®½äº†ï¼Œè½¦è¾†çš„é€šè¡Œèƒ½åŠ›è‡ªç„¶æé«˜ã€‚ä¼ ç»Ÿ802.11a/gä½¿ç”¨çš„é¢‘å®½æ˜¯20MHzï¼Œè€Œ802.11næ”¯æŒå°†ç›¸é‚»ä¸¤ä¸ªé¢‘å®½ç»‘å®šä¸º40MHzæ¥ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥æœ€ç›´æ¥åœ°æé«˜ååã€‚ â–²å›¾å·¦ä¸º802.11a/gï¼Œå›¾å³ä¸º802.11n 6.4 MCS802.11nå¼•è¿›äº†å¦‚æ­¤å¤šçš„æ–°æŠ€æœ¯ï¼Œå¯¼è‡´å®ƒçš„é€Ÿç‡ä¹Ÿä¼šå› ä¸ºé…ç½®æ–¹æ³•ä¸åŒè€Œä¸åŒã€‚åœ¨802.11a/b/gæ—¶ä»£ï¼Œé…ç½®APå·¥ä½œçš„é€Ÿç‡éå¸¸ç®€å•ï¼Œåªè¦æŒ‡å®šç‰¹å®šradioç±»å‹(802.11a/b/g)æ‰€ä½¿ç”¨çš„é€Ÿç‡é›†ï¼Œé€Ÿç‡èŒƒå›´ä»1Mbpsåˆ°54Mbps,ä¸€å…±æœ‰12ç§å¯èƒ½çš„ç‰©ç†é€Ÿç‡ã€‚åˆ°äº†802.11næ—¶ä»£ï¼Œç”±äºç‰©ç†é€Ÿç‡ä¾èµ–äºè°ƒåˆ¶æ–¹æ³•ã€ç¼–ç ç‡ã€ç©ºé—´æµæ•°é‡ã€æ˜¯å¦40MHzç»‘å®šç­‰å¤šä¸ªå› ç´ ã€‚è¿™äº›å½±å“ååçš„å› ç´ ç»„åˆåœ¨ä¸€èµ·ï¼Œå°†äº§ç”Ÿéå¸¸å¤šçš„ç‰©ç†é€Ÿç‡ä¾›é€‰æ‹©ä½¿ç”¨ã€‚ å¯¹æ­¤ï¼ŒIEEEç›´æ¥æ¨å‡ºäº†MCS (Modulation Coding Scheme)ï¼ŒMCSå¯ä»¥ç†è§£ä¸ºå°†ä¸Šè¿°å½±å“é€Ÿç‡å› ç´ çš„å®Œæ•´ç»„åˆï¼Œæ¯ç§ç»„åˆç”¨æ•´æ•°æ¥å”¯ä¸€æ ‡ç¤ºã€‚ç»™æ¯ç§æƒ…å†µæ ‡ç ï¼Œç„¶åç›´æ¥çœ‹å¯¹åº”çš„MCSç å°±å¯ä»¥çŸ¥é“å‡†ç¡®çš„é€Ÿç‡ã€‚ 6.5 802.11nå°ç»“æ€»çš„æ¥è¯´ï¼ŒMIMOå’Œ40Mhzç»‘å®šæŠ€æœ¯ä½¿å¾—ä¼ è¾“é€Ÿç‡å¤§å¤§æå‡ï¼Œè€Œæ³¢æŸæˆå½¢åˆ™å¢å¤§äº†ä¼ è¾“è·ç¦»ã€‚ 7ã€802.11acâ€”â€”é”‹èŠ’æ¯•éœ²çš„ä¸€ä»£ éšç€æ—¶ä»£çš„ç»§ç»­å‘å±•ï¼Œäººä»¬èº«è¾¹æ‹¥æœ‰ç€è¶Šæ¥è¶Šå¤šçš„æ— çº¿è®¾å¤‡ï¼Œè€Œ2.4GHzè¿™ä¸ªé¢‘æ®µï¼Œå› ä¸ºæœ¬èº«çš„ä¼˜è¶Šæ€§ï¼Œè¢«å„ç§åè®®ä½¿ç”¨ï¼ˆå¸¸è§çš„è“ç‰™4.0ç³»åˆ—åè®®ï¼Œæ— çº¿é”®é¼ ç­‰ï¼‰ï¼Œå·²ç»å˜å¾—æ‹¥æŒ¤ä¸å ªï¼ŒIEEEæ­¤æ—¶å°±å°†æ–°çš„ç¬¬äº”ä»£Wi-Fiåè®®åˆ¶è®¢åœ¨äº†5GHzçš„é¢‘æ®µä¸Šã€‚ç°åœ¨è¯´çš„å¾ˆå¤šåŒé¢‘Wi-Fiï¼Œå…¶å®å°±æ˜¯2.4GHzå’Œ5GHzçš„æ··åˆåŒé¢‘Wi-Fiï¼Œè€Œè¿™ç§è·¯ç”±å™¨å¸¸è§çš„å››å¤©çº¿è®¾è®¡ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸¤æ ¹å¤©çº¿åŸºäº2.4GHzï¼Œä¸¤æ ¹åŸºäº5GHzã€‚ 802.11acåœ¨æä¾›è‰¯å¥½çš„åå‘å…¼å®¹æ€§çš„åŒæ—¶ï¼ŒæŠŠæ¯ä¸ªé€šé“çš„å·¥ä½œé¢‘å®½å°†ç”±802.11nçš„40MHzï¼Œæå‡åˆ°80MHzç”šè‡³æ˜¯160MHzï¼Œå†åŠ ä¸Šå¤§çº¦10%çš„å®é™…é¢‘ç‡è°ƒåˆ¶æ•ˆç‡æå‡ï¼Œæœ€ç»ˆç†è®ºä¼ è¾“é€Ÿåº¦å°†ç”±802.11næœ€é«˜çš„600Mbpsè·ƒå‡è‡³1Gbpsã€‚å½“ç„¶ï¼Œå®é™…ä¼ è¾“ç‡å¯èƒ½åœ¨300Mbpsï½400Mbpsä¹‹é—´ï¼Œæ¥è¿‘ç›®å‰802.11nå®é™…ä¼ è¾“ç‡çš„3å€(ç›®å‰802.11næ— çº¿è·¯ç”±å™¨çš„å®é™…ä¼ è¾“ç‡ä¸º75Mbpsï½150Mbpsä¹‹é—´)ï¼Œå®Œå…¨è¶³ä»¥åœ¨ä¸€æ¡ä¿¡é“ä¸ŠåŒæ—¶ä¼ è¾“å¤šè·¯å‹ç¼©è§†é¢‘æµã€‚ 7.1 MU-MIMOå®é™…ä¸Šï¼Œ802.11acåè®®è¿˜åˆ†ä¸ºwave1å’Œwave2ä¸¤ä¸ªé˜¶æ®µ,ä¸¤è€…çš„ä¸»è¦åŒºåˆ«å°±åœ¨äºåè€…æå‡å¤šç”¨æˆ·æ•°æ®å¹¶å‘å¤„ç†èƒ½åŠ›å’Œç½‘ç»œæ•ˆç‡ã€‚è€Œè¿™èƒŒåçš„åŠŸè‡£ï¼Œå°±éMU-MIMOè«å±äº†ã€‚ å‰é¢å·²ç»è·Ÿå¤§å®¶ä»‹ç»è¿‡äº†ï¼ŒIEEEåœ¨802.11nåè®®æ—¶ä»£å°±å¼•å…¥äº†MIMOæŠ€æœ¯ï¼Œè€ŒMU-MIMOæŠ€æœ¯å¯ä»¥ç†è§£ä¸ºå®ƒçš„å‡çº§ç‰ˆæˆ–è€…æ˜¯å¤šç”¨æˆ·ç‰ˆæœ¬ã€‚ ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„å›¾ç‰‡å¤§å®¶å°±æ˜ç™½äº†ã€‚ â–²é«˜é€šå®˜æ–¹å±•ç¤ºMU-MIMOæŠ€æœ¯æ‰€ç”¨çš„å›¾ç‰‡ MU-MIMOæ˜¯Multi-User Multiple-Input Multiple-Outputï¼ˆå¤šç”¨æˆ·-å¤šè¾“å…¥å¤šè¾“å‡ºï¼‰çš„è‹±æ–‡ç¼©å†™ã€‚é¡¾åæ€ä¹‰ï¼ŒMU-MIMOèƒ½è®©è·¯ç”±å™¨åŒæ—¶å’Œå¤šä¸ªè®¾å¤‡è¿›è¡Œæ²Ÿé€šï¼Œè¿™æå¤§çš„æ”¹å–„äº†ç½‘ç»œèµ„æºåˆ©ç”¨ç‡ã€‚ é€šä¿—æ¥è¯´ï¼Œä»¥å‰åœ¨802.11nä¸Šé¢çš„MIMOåªèƒ½è¯´æ˜¯SU-MIMOï¼ˆSingle-Userï¼‰ï¼Œä¼ ç»Ÿçš„SU-MIMOè·¯ç”±å™¨ä¿¡å·å‘ˆç°ä¸€ä¸ªåœ†ç¯ï¼Œä»¥è·¯ç”±å™¨åœ†å¿ƒï¼Œå‘ˆ360åº¦å‘å¤–å‘å°„ä¿¡å·ï¼Œå¹¶ä¾æ®è¿œè¿‘äº²ç–ï¼Œä¾æ¬¡å•ç‹¬ä¸ä¸Šç½‘è®¾å¤‡è¿›è¡Œé€šè®¯ã€‚å½“æ¥å…¥çš„è®¾å¤‡è¿‡å¤šæ—¶ï¼Œå°±ä¼šå‡ºç°è®¾å¤‡ç­‰å¾…é€šè®¯çš„æƒ…å†µï¼Œç½‘ç»œå¡é¡¿çš„æƒ…å†µå°±ç”±æ­¤äº§ç”Ÿï¼›æ›´ä¸ºä¸¥é‡çš„æ˜¯ï¼Œè¿™ç§ä¾æ¬¡å•ç‹¬çš„é€šè®¯ï¼Œæ˜¯åŸºäºè®¾å¤‡å¯¹APï¼ˆè·¯ç”±å™¨æˆ–çƒ­ç‚¹ç­‰ï¼‰æ€»é¢‘å®½çš„å¹³å‡å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ‹¥æœ‰100MHzçš„é¢‘å®½ï¼ŒæŒ‰ç…§â€œä¸€æ¬¡åªèƒ½æœåŠ¡ä¸€ä¸ªâ€çš„åŸç†ï¼Œåœ¨æœ‰3ä¸ªè®¾å¤‡åŒæ—¶æ¥å…¥ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè®¾å¤‡åªèƒ½å¾—åˆ°çº¦33.3MHzé¢‘å®½ï¼Œå¦å¤–çš„66.6MHzåˆ™å¤„äºé—²ç½®çŠ¶æ€ã€‚å³åœ¨åŒä¸€ä¸ªWi-FiåŒºåŸŸå†…ï¼Œè¿æ¥è®¾å¤‡è¶Šå¤šå®½é¢‘è¢«å¹³å‡å¾—è¶Šå°ï¼Œæµªè´¹çš„èµ„æºè¶Šå¤šï¼Œç½‘é€Ÿä¹Ÿå°±è¶Šæ…¢ã€‚ â–²å›¾ä¸ºSU-MIMOï¼ˆå·¦ï¼‰å’ŒMU-MIMOï¼ˆå³ï¼‰çš„å¯¹æ¯” MU-MIMOè·¯ç”±å™¨åˆ™ä¸åŒï¼ŒMU-MIMOè·¯ç”±çš„ä¿¡å·åœ¨æ—¶åŸŸã€é¢‘åŸŸã€ç©ºåŸŸä¸‰ä¸ªç»´åº¦ä¸Šåˆ†æˆä¸‰éƒ¨åˆ†ï¼Œå°±åƒæ˜¯åŒæ—¶å‘å‡ºä¸‰ä¸ªä¸åŒçš„ä¿¡å·ï¼Œèƒ½å¤ŸåŒæ—¶ä¸ä¸‰éƒ¨è®¾å¤‡ååŒå·¥ä½œï¼›å°¤å…¶å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç”±äºä¸‰ä¸ªä¿¡å·äº’ä¸å¹²æ‰°ï¼Œå› æ­¤æ¯å°è®¾å¤‡å¾—åˆ°çš„é¢‘å®½èµ„æºå¹¶æ²¡æœ‰æ‰“æŠ˜æ‰£ï¼Œèµ„æºå¾—åˆ°æœ€å¤§åŒ–çš„åˆ©ç”¨ï¼Œä»è·¯ç”±å™¨è§’åº¦è¡¡é‡ï¼Œæ•°æ®ä¼ è¾“é€Ÿç‡æé«˜äº†3å€ï¼Œæ”¹å–„äº†ç½‘ç»œèµ„æºåˆ©ç”¨ç‡ï¼Œä»è€Œç¡®ä¿Wi-Fiæ— é—´æ–­è¿æ¥ã€‚ MU-MIMOæŠ€æœ¯å°±èµ‹äºˆäº†è·¯ç”±å™¨å¹¶è¡Œå¤„ç†çš„èƒ½åŠ›ï¼Œè®©å®ƒèƒ½å¤ŸåŒæ—¶ä¸ºå¤šå°è®¾å¤‡ä¼ è¾“æ•°æ®ï¼Œæå¤§åœ°æ”¹å–„äº†ç½‘ç»œæ‹¥å µçš„æƒ…å†µã€‚åœ¨ä»Šå¤©è¿™ç§æ— çº¿è”ç½‘è®¾å¤‡æ•°é‡çˆ†å‘å¼å¢é•¿çš„æ—¶ä»£ï¼Œå®ƒæ˜¯æ¯”å•çº¯æé«˜é€Ÿç‡æ›´æœ‰å®é™…æ„ä¹‰çš„ã€‚ ä¸–ç•Œä¸Šé¦–å°æ”¯æŒMU-MIMOçš„è·¯ç”±å™¨æ˜¯Linksys EA8500äº2015å¹´å‘å¸ƒï¼Œé‡‡ç”¨çš„æ˜¯å…¨é«˜é€šçš„MU-MIMOè§£å†³æ–¹æ¡ˆï¼ˆQualcomm MU | EFXï¼‰ã€‚ç°åœ¨MU-MIMOå·²ç»æ˜¯æ——èˆ°çº§è·¯ç”±å™¨çš„æ ‡é…äº†ï¼Œè€Œé‚£äº›å†™ç€acåŒé¢‘è·¯ç”±å™¨å´ä¸æ”¯æŒMU-MIMOæŠ€æœ¯çš„ï¼Œéƒ½åªèƒ½ç®—æ˜¯æ®‹ç¼ºçš„acåŒé¢‘è·¯ç”±å™¨æˆ–è€…æ˜¯ac wave1é˜¶æ®µçš„è·¯ç”±å™¨ã€‚ è¿™é‡Œæ”¾ä¸€å¼ åˆ°acä¸ºæ­¢å„ä»£åè®®çš„ä¸»è¦å‚æ•°å¯¹æ¯”å›¾ï¼ˆå›¾ç‰‡æ¥è‡ªç½‘ç»œï¼‰ï¼š 8ã€802.11adâ€”â€”å…ˆå¤©ä¸è¶³çš„ä¸€ä»£åœ¨ç¡®å®šç¬¬å…­ä»£çš„Wi-Fiåè®®æ ‡å‡†çš„æ—¶å€™ï¼Œæœ‰ä¸€æ®µæ—¶é—´ï¼Œå¤§å®¶éƒ½è®¤ä¸ºä¼šæ˜¯802.11adåè®®ï¼Œè¯´è¿™ä¸ªåå­—å¤§å®¶å¯ä»¥ä¸å¤ªç†Ÿæ‚‰ï¼Œå®ƒå¦ä¸€ä¸ªåå­—å«WiGigã€‚ ç›¸æ¯”æˆ‘ä»¬ç†ŸçŸ¥çš„802.11n(å·¥ä½œåœ¨2.4GHzå’Œ5GHzé¢‘æ®µ)å’Œ802.11ac(å·¥ä½œåœ¨5GHzé¢‘æ®µ)ï¼Œ**802.11adåˆ™æ˜¯å·¥ä½œåœ¨60GHzé¢‘æ®µï¼Œä¸”æ— çº¿ä¼ è¾“é€Ÿç‡å¯é«˜è¾¾7Gbps!**å½“ç„¶ï¼Œ 802.11acæ ‡å‡†ä¹Ÿå¯ä»¥é€šè¿‡å †BUFFï¼ˆ8x8 MIMOã€256 QAMè°ƒåˆ¶å’Œä¿¡é“ç»‘å®š4ä¸ª40 MHzä¿¡é“ï¼‰è¾¾åˆ°7Gbpsçš„ç†è®ºæ— çº¿ä¼ è¾“é€Ÿç‡ï¼›ä½†æ˜¯ï¼Œ11adè¾¾åˆ°7Gbpsçš„é€Ÿåº¦ï¼Œä»…éœ€é€šè¿‡ä¸€ä¸ªç©ºé—´æµã€64QAMè°ƒåˆ¶å’Œå•ä¸ªä¿¡é“å³å¯å®ç°ã€‚æ­¤å¤–ï¼Œ802.11adè¿˜åœ¨å®¹é‡ã€åŠŸè€—å’Œå»¶è¿Ÿæ–¹é¢æœ‰ç€11acæ— æ³•æ¯”æ‹Ÿçš„ä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯åœ¨å»¶è¿Ÿæ–¹é¢ï¼Œå…¶å»¶è¿Ÿé€šå¸¸ä»…æœ‰10å¾®ç§’ï¼Œå ªæ¯”æœ‰çº¿! ä½†å¯æƒœï¼Œ802.11adåè®®æœ‰ç€å®ƒçš„å…ˆå¤©ä¸è¶³â€”â€”60GHzï¼Œè¿™ä¹ˆé«˜çš„é¢‘ç‡æ³¨å®šå®ƒçš„ä¼ è¾“è·ç¦»å’Œç©¿å¢™èƒ½åŠ›å¼±åˆ°ä¸å ªä¸€å‡»ï¼Œè€Œåœ¨ä¸€äº›çŸ¥åè¯„æµ‹åª’ä½“çš„è¯„æµ‹ä¸­ï¼Œäººä»¬æƒŠäººåœ°å‘ç°åªéœ€è¦ä¸€ä¸ªçº¸çš®ç®±å°±èƒ½éš”ç»802.11adåè®®è·¯ç”±å™¨çš„ä¿¡å·ã€‚çœŸæ˜¯å¯è°“æˆä¹Ÿè§ä½•ï¼Œè´¥ä¹Ÿè§ä½•ã€‚ 9ã€802.11axâ€”â€”è‚©è´Ÿä½¿å‘½çš„ä¸€ä»£802.11axåè®®åŸºäº2.4GHzå’Œ5GHzä¸¤ä¸ªé¢‘æ®µï¼Œå¯¹ï¼Œå°±æ˜¯ä¸¤ä¸ªé¢‘æ®µï¼Œå¹¶éæ˜¯acåŒé¢‘è·¯ç”±å™¨é‚£æ ·ä¸åŒçš„é¢‘æ®µå¯¹åº”ä¸åŒçš„åè®®ï¼Œaxåè®®æœ¬èº«å°±æ”¯æŒä¸¤ä¸ªé¢‘æ®µã€‚è¿™æ˜¾ç„¶è¿åˆäº†å½“ä¸‹ç‰©è”ç½‘ã€æ™ºèƒ½å®¶å±…ç­‰å‘å±•æ½®æµã€‚å¯¹äºä¸€äº›å¯¹å¸¦å®½éœ€è¦ä¸é«˜çš„æ™ºèƒ½å®¶å±…è®¾å¤‡ï¼Œå¯ä»¥ä½¿ç”¨2.4GHzé¢‘æ®µå»è¿æ¥ï¼Œä¿è¯è¶³å¤Ÿçš„ä¼ è¾“è·ç¦»ï¼Œè€Œå¯¹äºéœ€è¦é«˜é€Ÿä¼ è¾“çš„è®¾å¤‡ï¼Œå°±ä½¿ç”¨5GHzé¢‘æ®µã€‚è¿™çœ‹èµ·æ¥å’Œç°åœ¨çš„acåŒé¢‘è·¯ç”±å™¨æ˜¯ä¸€æ ·çš„ï¼Œä½†å®é™…ä¸Šï¼Œaxä½œä¸ºç¬¬å…­ä»£Wi-Fiåè®®çš„æ‰›æŠŠå­ï¼Œå¯ä¸åªè¿™ä¸¤æŠŠåˆ·å­ã€‚ 802.11axåˆè¢«ç§°ä¸ºâ€œé«˜æ•ˆç‡æ— çº¿æ ‡å‡†â€ï¼ˆHigh-Efficiency Wirelessï¼ŒHEWï¼‰ï¼Œå°†å¤§å¹…åº¦æå‡ç”¨æˆ·å¯†é›†ç¯å¢ƒä¸­çš„æ¯ä½ç”¨æˆ·çš„å¹³å‡ä¼ è¾“ç‡ï¼Œå³åœ¨é«˜å¯†ç¯å¢ƒä¸‹ä¸ºæ›´å¤šç”¨æˆ·æä¾›ä¸€è‡´ä¸”ç¨³å®šçš„æ•°æ®æµï¼ˆå¹³å‡ä¼ è¾“ç‡ï¼‰ï¼Œå°†æœ‰æ•ˆå‡å°‘ç½‘ç»œæ‹¥å¡ã€å¤§å¹…æå‡æ— çº¿é€Ÿåº¦ä¸è¦†ç›–èŒƒå›´ã€‚å…¶å®ï¼Œè®¾è®¡802.11axçš„é¦–è¦ç›®çš„æ˜¯è§£å†³ç½‘ç»œå®¹é‡é—®é¢˜ï¼Œå› ä¸ºéšç€å…¬å…±Wi-Fiçš„æ™®åŠï¼Œç½‘ç»œå®¹é‡é—®é¢˜å·²æˆä¸ºæœºåœºã€ä½“è‚²èµ›äº‹å’Œæ ¡å›­ç­‰å¯†é›†ç¯å¢ƒä¸­çš„ä¸€ä¸ªå¤§é—®é¢˜ã€‚ æ­¤å¤„è¦ä»‹ç»ä¸¤ä¸ªæ–°æŠ€æœ¯ï¼Œä¸Šè¡ŒMU-MIMOå’ŒOFDMAã€‚ 9.1 ä¸Šè¡ŒMU-MIMOMU-MIMOæŠ€æœ¯åœ¨å‰é¢å·²ç»æåˆ°è¿‡ï¼Œ802.11acåè®®ä¸­çš„MU-MIMOæŠ€æœ¯åªæ˜¯å•çº¯çš„ä¸‹è¡ŒMU-MIMOï¼Œåªæœ‰åœ¨è·¯ç”±å™¨ç»™è®¾å¤‡ä¼ è¾“æ•°æ®çš„æ—¶å€™æ‰å¯ä»¥ç”¨ï¼Œè€Œå¦‚ä»Šéšç€æ™ºèƒ½è®¾å¤‡çš„å‘å±•ï¼Œäººä»¬å¯¹äºä¸Šè¡Œé€Ÿç‡çš„è¦æ±‚ä¹Ÿåœ¨æé«˜ï¼Œä¼ ä¸ªè¶…æ¸…è§†é¢‘å›¾ç‰‡ä»€ä¹ˆçš„å·²ç»æ˜¯å®¶å¸¸ä¾¿é¥­äº†ã€‚ä¸Šè¡ŒMU-MIMOæŠ€æœ¯å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿï¼Œæ”¹å–„äº†è®¾å¤‡åœ¨å‘è·¯ç”±å™¨ä¼ è¾“æ•°æ®æ—¶çš„æ‹¥å µæƒ…å†µï¼Œæé«˜äº†ç½‘ç»œèµ„æºåˆ©ç”¨ç‡ã€‚ 9.2 OFDMA802.11axä¸ä»¥å‰çš„æ— çº¿å±€åŸŸç½‘(WLAN)ç³»ç»Ÿç›¸æ¯”æœ€å¤§çš„å˜åŒ–åœ¨äºå…¶æ˜¯é‡‡ç”¨äº†â€œæ­£äº¤é¢‘åˆ†å¤šå€æ¥å…¥â€(orthogonal frequency division multiple access, OFDMA)ã€‚ åœ¨OFDMç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å ç”¨äº†æ•´ä¸ªä¿¡é“ã€‚éšç€ç”¨æˆ·æ•°é‡çš„å¢å¤šï¼Œç”¨æˆ·ä¹‹é—´çš„æ•°æ®è¯·æ±‚ä¼šå‘ç”Ÿå†²çªï¼Œä»è€Œé€ æˆç“¶é¢ˆï¼Œä»è€Œå¯¼è‡´å½“è¿™äº›ç”¨æˆ·åœ¨è¯·æ±‚æ•°æ®ï¼ˆç‰¹åˆ«æ˜¯åœ¨æµå¼è§†é¢‘ç­‰é«˜å¸¦å®½åº”ç”¨ä¸­ï¼‰æ—¶ï¼ŒæœåŠ¡è´¨é‡è¾ƒå·®ã€‚ è€Œåœ¨OFDMAä¸­ï¼Œç”¨æˆ·ä»…åœ¨è§„å®šæ—¶é—´å†…å ç”¨å­è½½æ³¢çš„ä¸€ä¸ªå­é›†ã€‚OFDMAè¦æ±‚æ‰€æœ‰ç”¨æˆ·åŒæ—¶ä¼ è¾“ï¼Œå› æ­¤æ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦å°†å…¶æ•°æ®åŒ…ç¼“å†²ä¸ºç›¸åŒçš„è§„å®šæ¯”ç‰¹æ•°ï¼Œè¿™æ ·æ— è®ºæ•°æ®é‡æœ‰å¤šå°‘æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½åœ¨æ—¶é—´ä¸Šä¿æŒä¸€è‡´ã€‚æ­¤å¤–ï¼Œ OFDMA APå¯æ ¹æ®ç”¨æˆ·å¯¹å¸¦å®½çš„éœ€æ±‚æ¥åŠ¨æ€åœ°æ”¹å˜ç”¨æˆ·æ‰€å ç”¨é¢‘è°±çš„æ•°é‡ã€‚ä¾‹å¦‚ï¼Œç›¸æ¯”è¾ƒå¯¹å®æ—¶æ€§èƒ½è¦æ±‚ä¸é«˜çš„ç”µå­é‚®ä»¶ï¼Œæµåª’ä½“è§†é¢‘ç”¨æˆ·éœ€è¦æ›´å¤šå­è½½æ³¢ï¼ˆé¢‘è°±ï¼‰ã€‚ ä¸ç†è§£çš„è¯æˆ‘ä»¬çœ‹ä¸‹å›¾ï¼š â–²ç”¨æˆ·åœ¨ODFMä¸­å æ®æ•´ä¸ªä¿¡é“ï¼Œè€Œåœ¨â€œæ­£äº¤é¢‘åˆ†å¤šå€æ¥å…¥â€(OFDMA)ä¸­ä¸æ˜¯ æˆ‘ä»¬è¿˜æ˜¯ç”¨å›é©¬è·¯å¼€è½¦çš„ä¾‹å­ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸€æ¡é©¬è·¯æœ‰ä¸‰æ¡è½¦é“ï¼Œç°åœ¨æœ‰ç”²ä¹™ä¸™ä¸‰ä¸ªè½¦é˜Ÿè¦èµ°è¿™æ¡è·¯ï¼ˆæ¯é˜Ÿéƒ½è¦èµ°ä¸€ä¸ªå°æ—¶ï¼Œèµ°å‰éœ€è¦åŠä¸ªå°æ—¶å‡†å¤‡ï¼‰ï¼Œå¦‚æœæŒ‰ç…§ä¸€æ¬¡èµ°ä¸€ä¸ªè½¦é˜Ÿçš„æ–¹æ³•ï¼Œç”²ä¹™ä¸™ä¾æ¬¡èµ°å®Œéœ€è¦å››ä¸ªåŠå°æ—¶ï¼Œè€Œä½¿ç”¨OFDMAæŠ€æœ¯ï¼Œç»™ä»–ä»¬ä¸€é˜Ÿä¸€æ¡é“ï¼Œåˆ™åªéœ€è¦ä¸‰ä¸ªåŠå°æ—¶ï¼Œçœä¸‹äº†ä¸€ä¸ªå°æ—¶çš„å‡†å¤‡æ—¶é—´ã€‚OFDMå’ŒOFDMAåœ¨ç”¨æˆ·æ•°é‡å°‘çš„æ—¶å€™å·®è·å¯èƒ½ä¸å¤§ï¼Œä½†æ˜¯ä¸€æ—¦ç”¨æˆ·æ•°é‡å¤šäº†èµ·æ¥ï¼Œå·®è·å¯å°±ä¸æ˜¯ä¸€æ˜ŸåŠç‚¹äº†ã€‚ OFDMAä¸€è·¯èµ°æ¥ï¼Œå…¶å®å°±æ˜¯â€œä»æ— åˆ°æœ‰ï¼Œå†ä»æœ‰åˆ°å–„ç”¨â€çš„æ¼”å˜å†ç¨‹ã€‚ 9.3 802.11axå°ç»“å®é™…ä¸Šï¼Œ802.11axç»™æˆ‘ä»¬å¸¦æ¥çš„æå‡è¿œä¸æ­¢æ­¤ï¼Œå…¶ä»–çš„å¦‚æ›´ä½çš„å»¶è¿Ÿã€æ›´ç²¾ç¡®çš„åŠŸè€—æ§åˆ¶ç­‰ç­‰ä¹Ÿæ˜¯ä¸å¯å¿½ç•¥çš„ä¸€ç¯ã€‚ç°åœ¨å¸‚é¢ä¸Šä½¿ç”¨802.11axåè®®çš„äº§å“å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œåªæ˜¯é›¶æ˜Ÿçš„å‡ æ¬¾ï¼Œä½†æ˜¯å¥½åœ¨å®ƒçš„å¤ªå­èº«ä»½å·²ç»ç¡®å®šï¼Œç™»åŸºåªæ˜¯æ—©æ™šçš„é—®é¢˜ã€‚è€ŒæŒ‰ç…§ç›®å‰çš„è¿›åº¦æ¥çœ‹ï¼Œå°ä¸ƒé¢„è®¡2019å¹´802.11axçš„äº§å“å°±èƒ½å®ç°ä¸é”™çš„æ™®åŠç‡ã€‚","categories":[{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"wifi","slug":"wifi","permalink":"https://tinychen.com/tags/wifi/"}]},{"title":"æ±•å¤§è®¡ç»„å¤ä¹ æçº²2017ç‰ˆ","slug":"20171227-computer-arch","date":"2017-12-27T07:00:00.000Z","updated":"2017-12-27T07:00:00.000Z","comments":true,"path":"20171227-computer-arch/","link":"","permalink":"https://tinychen.com/20171227-computer-arch/","excerpt":"æ±•å¤§è®¡ç®—æœºç³»2017å¹´çš„è®¡ç»„è¯¾æœ€åæœŸæœ«çš„å¤ä¹ æçº²ï¼Œæˆ‘ä¸ªäººæ•´ç†å„ç±»èµ„æ–™å’ŒPPTæ€»ç»“ï¼Œæœ‰éƒ¨åˆ†å¯èƒ½ä¼šæœ‰é”™æ¼æˆ–ä¸è¶³ï¼Œè¿™é‡Œåˆ†äº«ç»™æœ‰éœ€è¦çš„åŒå­¦ã€‚","text":"æ±•å¤§è®¡ç®—æœºç³»2017å¹´çš„è®¡ç»„è¯¾æœ€åæœŸæœ«çš„å¤ä¹ æçº²ï¼Œæˆ‘ä¸ªäººæ•´ç†å„ç±»èµ„æ–™å’ŒPPTæ€»ç»“ï¼Œæœ‰éƒ¨åˆ†å¯èƒ½ä¼šæœ‰é”™æ¼æˆ–ä¸è¶³ï¼Œè¿™é‡Œåˆ†äº«ç»™æœ‰éœ€è¦çš„åŒå­¦ã€‚ 01è®²è¯æ±‡ACMï¼šAssociation for Computing Machineryï¼Œç¾å›½è®¡ç®—æœºåä¼š ENIACï¼šElectronic Numerical Integrator And Computerï¼Œç”µå­æ•°å­—ç§¯åˆ†è®¡ç®—æœº ALUï¼šç®—æœ¯é€»è¾‘éƒ¨ä»¶ï¼ŒArithmetic and Logical Unit CPï¼šæ—¶é’Ÿï¼ŒClock Pulse ISAï¼šInstruction Set Architectureï¼ŒæŒ‡ä»¤é›†ä½“ç³»ç»“æ„ï¼ˆæŒ‡ä»¤é›†æ¶æ„ï¼‰ LSICï¼šå¤§è§„æ¨¡é›†æˆç”µè·¯(Large Scale Integrated circuits MOOCï¼šmassive open online courses,å¤§å‹å¼€æ”¾å¼ç½‘ç»œè¯¾ç¨‹ ä¸¤ä¸ªPCï¼šPerson Computer, Program Counter PLCï¼šå¯ç¼–ç¨‹é€»è¾‘æ§åˆ¶å™¨,Programmable Logic Controller é—®é¢˜:1.è®¡ç®—æœºç³»ç»Ÿæ˜¯? è®¡ç®—æœºç³»ç»Ÿï¼ç¡¬ä»¶/å›ºä»¶ï¼‹è½¯ä»¶ 2.å›ºä»¶æ˜¯ä»€ä¹ˆï¼Ÿ â‘  å›ºåŒ–çš„ç¨‹åºï¼ˆfirmwareï¼‰ï¼Œä¾‹å¦‚è®¡ç®—æœºä¸»æ¿ä¸Šçš„BIOSã€‚â‘¡ å›ºä»¶ä¸€èˆ¬å­˜å‚¨äºè®¾å¤‡ä¸­çš„ç”µå¯æ“¦é™¤åªè¯»å­˜å‚¨å™¨EEPROM(Electrically Erasable Programmable ROM)æˆ–FLASHèŠ¯ç‰‡ä¸­ï¼Œä¸€èˆ¬å¯ç”±ç”¨æˆ·é€šè¿‡ç‰¹å®šçš„åˆ·æ–°ç¨‹åºè¿›è¡Œå‡çº§çš„ç¨‹åºã€‚â‘¢ å›ºä»¶å¸¸è§äºï¼šæ‰‹æœºã€æ•°ç ç›¸æœºã€mp3ã€mp4ã€è·¯ç”±å™¨ã€äº¤æ¢æœºã€Uç›˜ã€ä¸»æ¿çš„BIOSï¼ˆBIOSå°±æ˜¯ä¸€ç§å›ºä»¶ï¼‰ã€æ˜¾å¡çš„BIOSã€‚ 3.ä»€ä¹ˆæ˜¯â€œè½¯ä»¶æ‘©å°”å®šå¾‹â€ï¼Ÿ è½¯ä»¶æ‘©å°”å®šå¾‹ï¼šæ¯18ä¸ªæœˆï¼Œè½¯ä»¶ä½“ç§¯å¤§ä¸€å€ï¼Œæ•ˆç‡å·®ä¸€åŠã€‚ 4.å†¯Â·è¯ºä¾æ›¼ä½“ç³»å’Œå“ˆä½›æ€»çº¿ä½“ç³»çš„åŒºåˆ«ï¼Ÿ ç¨‹åºç©ºé—´å’Œæ•°æ®ç©ºé—´æ˜¯å¦æ˜¯ä¸€ä½“çš„ã€‚å†¯Â·è¯ºä¾æ›¼ç»“æ„æ•°æ®ç©ºé—´å’Œåœ°å€ç©ºé—´ä¸åˆ†å¼€ï¼Œå“ˆä½›ç»“æ„æ•°æ®ç©ºé—´å’Œåœ°å€ç©ºé—´æ˜¯åˆ†å¼€çš„ã€‚ 5.å†¯.è¯ºä¾æ›¼è®¡ç®—æœºä½“ç³»çš„ä¸»è¦ç‰¹ç‚¹ ? â‘  è®¡ç®—æœºç”±è¿ç®—å™¨ã€æ§åˆ¶å™¨ã€å­˜å‚¨å™¨ã€è¾“å…¥è®¾å¤‡å’Œè¾“å‡ºè®¾å¤‡äº”éƒ¨åˆ†ç»„æˆï¼›â‘¡ é‡‡ç”¨å­˜å‚¨ç¨‹åºçš„æ–¹å¼ï¼›â‘¢ æ•°æ®ä»¥2è¿›åˆ¶è¡¨ç¤ºã€‚ 6.è®¡ç®—æœºç³»ç»Ÿç»“æ„æ¦‚å¿µçš„å®è´¨? ç¡®å®šè®¡ç®—æœºç³»ç»Ÿä¸­è½¯ç¡¬ä»¶çš„ç•Œé¢ï¼Œç•Œé¢ä¹‹ä¸Šæ˜¯è½¯ä»¶å®ç°çš„åŠŸèƒ½ï¼Œç•Œé¢ä¹‹ä¸‹æ˜¯ç¡¬ä»¶å’Œå›ºä»¶å®ç°çš„åŠŸèƒ½ã€‚ 02è®²ï¼ˆæ•°åˆ¶å’Œç¼–ç ã€æ•´æ•°çš„è¡¨ç¤ºï¼‰é—®é¢˜:1.å®šç‚¹æ•´æ•°çš„åŸã€åã€è¡¥ç è¡¨ç¤º? å°æ•°ç‚¹ä½ç½®çº¦å®šå†å›ºå®šä½ç½®çš„æ•°ç§°ä¸ºå®šç‚¹æ•°ï¼›å°æ•°ç‚¹ä½ç½®çº¦å®šä¸ºå¯æµ®åŠ¨çš„æ•°ç§°ä¸ºæµ®ç‚¹æ•°ã€‚å¯¹äºå®šç‚¹æ•´æ•°ï¼Œå…¶å°æ•°ç‚¹æ€»æ˜¯å›ºå®šåœ¨æ•°çš„æœ€å³è¾¹ï¼Œå› æ­¤å¯ç”¨å®šç‚¹æ•´æ•°æ¥è¡¨ç¤ºæ•´æ•°ã€‚ 03è®²ï¼ˆæµ®ç‚¹æ•°-æ•°æ®çš„å®½åº¦å’Œå­˜å‚¨ï¼‰è¯æ±‡IEEEï¼šInstitute of Electrical and Electronics Engineersï¼Œç”µæ°”å’Œç”µå­å·¥ç¨‹å¸ˆåä¼š MSB(msb)ï¼ŒMost Significant Bitï¼Œæœ€é«˜æœ‰æ•ˆä½ã€‚æˆ–Most Significant Byteï¼Œæœ€é«˜æœ‰æ•ˆå­—èŠ‚ã€‚ LSB(msb)ï¼Œleast significant bitï¼Œæœ€ä½æœ‰æ•ˆä½ã€‚æˆ–least significant byteï¼Œæœ€ä½æœ‰æ•ˆå­—èŠ‚ã€‚ é—®é¢˜:1.IEEE754æ ‡å‡†32ä½æµ®ç‚¹æ•°çš„è¡¨ç¤º? 2.å¤§ç«¯æ–¹å¼ä¸å°ç«¯æ–¹å¼? å¤§ç«¯æ˜¯é«˜ä½ç»“åˆï¼›å¤§ç«¯æ–¹å¼å°†æ•°æ®çš„æœ€é«˜æœ‰æ•ˆå­—èŠ‚å­˜æ”¾åœ¨ä½åœ°å€å•å…ƒä¸­ï¼Œå°†æœ€ä½æœ‰æ•ˆå­—èŠ‚å­˜æ”¾åœ¨é«˜åœ°å€å•å…ƒä¸­ï¼Œå³æ•°æ®çš„åœ°å€å°±æ˜¯MSBæ‰€åœ¨çš„åœ°å€ã€‚ å°ç«¯æ˜¯é«˜é«˜ç»“åˆï¼›å°ç«¯æ–¹å¼å°†æ•°æ®çš„æœ€é«˜æœ‰æ•ˆå­—èŠ‚å­˜æ”¾åœ¨é«˜åœ°å€å•å…ƒä¸­ï¼Œå°†æœ€ä½æœ‰æ•ˆå­—èŠ‚å­˜æ”¾åœ¨ä½åœ°å€å•å…ƒä¸­ï¼Œå³æ•°æ®çš„åœ°å€å°±æ˜¯LSBæ‰€åœ¨çš„åœ°å€ã€‚ æœ€é«˜æœ‰æ•ˆä½æŒ‡æ•°æ®æœ€å·¦è¾¹çš„ä¸€ä½æ•°ï¼Œæœ€ä½æœ‰æ•ˆä½æŒ‡æœ€å³è¾¹çš„é‚£ä¸€ä½æ•° é«˜åœ°å€æ˜¯æ•°å­—å¤§çš„ï¼Œä½åœ°å€æ˜¯æ•°å­—å°çš„ã€‚ 04è®²ï¼ˆæ•°æ®çš„åŸºæœ¬è¿ç®—ï¼‰è¯æ±‡ASCIIï¼ŒASCIIï¼ˆAmerican Standard Code for Information Interchangeï¼Œç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç  ZFï¼Œé›¶æ ‡å¿—ï¼ŒZero Flag OFï¼Œæº¢å‡ºæ ‡å¿—ï¼ŒOverflow Flag CFï¼Œè¿›/å€Ÿä½æ ‡å¿—ï¼ŒCarry Flag SFï¼Œç¬¦å·æ ‡å¿—ï¼ŒSign Flag FAï¼Œå…¨åŠ å™¨ï¼ŒFull Adder HAï¼ŒåŠåŠ å™¨ï¼ŒHalf Adder RCAï¼Œè¡Œæ³¢è¿›ä½åŠ æ³•å™¨ï¼Œripple carry adder CASï¼Œå¯æ§åŠ å‡å•å…ƒï¼ŒControllable Adder Subtracter CLAï¼Œå…ˆè¡Œè¿›ä½å‘ç”Ÿå™¨ï¼Œcarry look-ahead é—®é¢˜:1.ç†è§£å¹¶ç®€å•è§£é‡Šæœ¬è®²ä»‹ç»çš„å…¸å‹ç”µè·¯? 2.è¡¥ç åŠ å‡æ³•ç”µè·¯ç¤ºæ„å›¾? 3.å¯¹2æ±‚è¡¥å™¨ç”µè·¯? 05è®²ï¼ˆç¨‹åºè½¬æ¢æ¦‚è¿°ï¼Œåˆæ­¥è®¤è¯†ISAï¼‰è¯æ±‡MARï¼ˆARï¼‰ï¼šMemory Address Registerï¼Œåœ°å€å¯„å­˜å™¨ MDR(DR)ï¼š Memory Data Registerï¼Œæ•°æ®å¯„å­˜å™¨ IRï¼šInstruction Registerï¼ŒæŒ‡ä»¤å¯„å­˜å™¨ GPRsï¼šGeneral Purpose Registersï¼Œé€šç”¨å¯„å­˜å™¨ ACCï¼šAccumulatorï¼Œç´¯åŠ å™¨ OPï¼šæ“ä½œç ï¼ŒOperation Code CISCï¼šComplex Instruction Set Computerï¼Œå¤æ‚æŒ‡ä»¤ç³»ç»Ÿè®¡ç®—æœº RISCï¼šReduced Instruction Set Computerï¼Œç²¾ç®€æŒ‡ä»¤ç³»ç»Ÿè®¡ç®—æœº RTLï¼šRegister Transfer Levelï¼Œå¯„å­˜å™¨ä¼ è¾“çº§ é—®é¢˜:1.RRã€RMã€MMæ˜¯ä»€ä¹ˆ? RRç»“æ„ï¼šå¯„å­˜å™¨-å¯„å­˜å™¨ç»“æ„ï¼ˆRegister-Registerï¼‰ RMç»“æ„ï¼šå¯„å­˜å™¨-å­˜å‚¨å™¨ç»“æ„ï¼ˆRegister-Memoryï¼‰ MMç»“æ„ï¼šå­˜å‚¨å™¨-å­˜å‚¨å™¨ç»“æ„ï¼ˆMemory-Memoryï¼‰ 06è®²ï¼ˆIA-32æŒ‡ä»¤ç³»ç»Ÿæ¦‚è¿°ï¼‰è¯æ±‡IAï¼šIntel Architectureï¼ŒIntelæ¶æ„ 07è®²ï¼ˆMIPSä½“ç³»ç»“æ„1ï¼‰è¯æ±‡MIPSï¼šMicroprocessor without Interlocked Pipeline Stagesï¼Œæ— å†…éƒ¨äº’é”æµæ°´çº§çš„å¾®å¤„ç†å™¨ MIPSï¼šMillion Instructions Per Second)ï¼Œæ¯ç§’å¤„ç†ç™¾ä¸‡æŒ‡ä»¤æ•° é—®é¢˜:1.ç®€å•MIPSç¨‹åº? 08è®²ï¼ˆMIPSä½“ç³»ç»“æ„2ï¼‰é—®é¢˜:1.ç®€å•MIPSç¨‹åº? 2.ä¼ªæŒ‡ä»¤å’Œä¼ªæ“ä½œçš„åŒºåˆ«? ä¼ªæ“ä½œ(directive)ä¸ä¼šè¢«ç¼–è¯‘å™¨ç¼–è¯‘ä¸ºæœºå™¨æŒ‡ä»¤ï¼Œ ä¼ªæŒ‡ä»¤(pseudo-instruction)ä¼šç¼–è¯‘ä¸ºæœºå™¨æŒ‡ä»¤ã€‚ 09è®²ï¼ˆARMæ±‡ç¼–ï¼‰è¯æ±‡ARMï¼šAdvanced RISC Machineï¼Œé«˜çº§RISCå¤„ç†æœº IPï¼šçŸ¥è¯†äº§æƒï¼Œintellectual property GNUï¼šé€šç”¨å…¬å…±è®¸å¯è¯ï¼ŒGNU General Public License 10è®²ï¼ˆç¨‹åºæ‰§è¡Œæ¦‚è¿°ï¼ŒCPUç»“æ„å’ŒåŠŸèƒ½ï¼‰è¯æ±‡PSWï¼šProgram Status Wordï¼Œç¨‹åºçŠ¶æ€å­— é—®é¢˜:1.ç°ä»£CPUçš„ç»„æˆï¼Ÿ ç°ä»£CPUä¸€èˆ¬ç”±è¿ç®—å™¨ã€æ§åˆ¶å™¨ã€æ•°æ®é€šè·¯ï¼ˆdatapathï¼‰å’Œé«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ï¼ˆCacheï¼‰ç»„æˆã€‚ â€”â€”æ•°æ®é€šè·¯æ˜¯æŒ‡å„éƒ¨ä»¶ä¹‹é—´é€šè¿‡æ•°æ®çº¿çš„ç›¸äº’è¿æ¥ã€‚ â€”â€”é€‰æ‹©ä»€ä¹ˆæ ·çš„æ•°æ®é€šè·¯ï¼Œå¯¹äºCPUçš„æ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“ã€‚ 2.CPUæ§åˆ¶å™¨çš„åŸºæœ¬ç»„æˆï¼Ÿ ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ æŒ‡ä»¤å¯„å­˜å™¨ï¼ˆIRï¼‰ æŒ‡ä»¤è¯‘ç å™¨ï¼ˆIDï¼‰ æ—¶åºå‘ç”Ÿå™¨ æ“ä½œæ§åˆ¶å™¨ 3.è¿ç®—å™¨çš„åŸºæœ¬ç»„æˆï¼Ÿ ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆALUï¼‰ ç´¯åŠ å¯„å­˜å™¨ï¼ˆACï¼‰æˆ–é€šç”¨å¯„å­˜å™¨ æ•°æ®å¯„å­˜å™¨ï¼ˆDRï¼‰ ç¨‹åºçŠ¶æ€å­—å¯„å­˜å™¨ï¼ˆPSWï¼‰ 4. CPUä¸­çš„ä¸»è¦å¯„å­˜å™¨ï¼Ÿ æŒ‡ä»¤å¯„å­˜å™¨ï¼ˆIRï¼‰ ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ åœ°å€å¯„å­˜å™¨ï¼ˆARï¼‰ æ•°æ®å¯„å­˜å™¨ï¼ˆDRï¼‰ ç´¯åŠ å¯„å­˜å™¨ï¼ˆACCï¼‰æˆ–GPRs ç¨‹åºçŠ¶æ€å­—å¯„å­˜å™¨ï¼ˆPSWï¼‰ 5.CPUçš„å…·ä½“åŠŸèƒ½? æŒ‡ä»¤æ§åˆ¶ï¼šæ§åˆ¶ç¨‹åºçš„é¡ºåºæ‰§è¡Œ æ“ä½œæ§åˆ¶ï¼šäº§ç”Ÿå®Œæˆæ¯æ¡æŒ‡ä»¤æ‰€éœ€çš„æ§åˆ¶å‘½ä»¤ æ—¶é—´æ§åˆ¶ï¼šå¯¹å„ç§æ“ä½œåŠ ä»¥æ—¶é—´ä¸Šçš„æ§åˆ¶ æ•°æ®åŠ å·¥ï¼šå¯¹æ•°æ®è¿›è¡Œç®—æœ¯è¿ç®—å’Œé€»è¾‘è¿ç®— ä¸­æ–­å¤„ç†ï¼šå¤„ç†è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸æƒ…å†µå’Œç‰¹æ®Šè¯·æ±‚ 11è®²ï¼ˆdatapathï¼‰é—®é¢˜:æŒ‡ä»¤å‘¨æœŸã€æœºå™¨å‘¨æœŸã€æ—¶é’Ÿå‘¨æœŸ? 1.æŒ‡ä»¤å‘¨æœŸ æŒ‡ä»¤å‘¨æœŸæ˜¯å–å‡ºä¸€æ¡æŒ‡ä»¤å¹¶æ‰§è¡Œè¿™æ¡æŒ‡ä»¤çš„æ—¶é—´ã€‚ä¸€èˆ¬ç”±è‹¥å¹²ä¸ªæœºå™¨å‘¨æœŸç»„æˆï¼Œæ˜¯ä»å–æŒ‡ä»¤ã€è¯‘ç åˆ°æ‰§è¡Œå®Œæ‰€éœ€çš„å…¨éƒ¨æ—¶é—´ã€‚ **ä¸€æ¡æŒ‡ä»¤çš„æ‰§è¡Œè¿‡ç¨‹åŒ…æ‹¬3ä¸ªåŸºæœ¬æ­¥éª¤ï¼š ** å–æŒ‡ä»¤ï¼šä»å­˜å‚¨å™¨å–å‡ºä¸€æ¡æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤çš„åœ°å€ç”±ç¨‹åºè®¡æ•°å™¨PCç»™å‡ºã€‚ è¯‘ç ï¼šå¯¹è¯¥æŒ‡ä»¤çš„æ“ä½œç è¿›è¡Œè¯‘ç åˆ†æï¼Œç¡®å®šæ˜¯å“ªä¸€ç§æŒ‡ä»¤ï¼Œå¹¶è½¬åˆ°è¿™ç§æŒ‡ä»¤å¯¹åº”çš„æ‰§è¡Œé˜¶æ®µã€‚ æ‰§è¡Œï¼šæŒ‰æŒ‡ä»¤æ“ä½œç çš„è¦æ±‚æ‰§è¡Œè¯¥æŒ‡ä»¤ã€‚æ‰§è¡Œè¿‡ç¨‹å¯èƒ½éœ€è¦å¤šæ­¥æ“ä½œï¼Œæ§åˆ¶å™¨å°†ä¸ºä¹‹å½¢æˆå®Œæˆè¯¥æŒ‡ä»¤åŠŸèƒ½æ‰€éœ€è¦çš„æ“ä½œæ§åˆ¶ä¿¡å·ã€‚æ‰§è¡Œå®Œæ¯•åï¼Œå›åˆ°å–æŒ‡ä»¤é˜¶æ®µï¼Œå»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚å¦‚æ­¤åå¤ï¼Œç›´åˆ°æ•´ä¸ªç¨‹åºæ‰§è¡Œå®Œã€‚ 2.æœºå™¨å‘¨æœŸ é€šå¸¸æŠŠä¸€æ¡æŒ‡ä»¤å‘¨æœŸåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæœºå™¨å‘¨æœŸï¼Œæ¯ä¸ªæœºå™¨å‘¨æœŸå®Œæˆä¸€ä¸ªåŸºæœ¬æ“ä½œã€‚ å¯ä»¥ç”¨ä¸»å­˜çš„å·¥ä½œå‘¨æœŸ(å­˜å–å‘¨æœŸ)ä¸ºåŸºç¡€æ¥è§„å®šæœºå™¨å‘¨æœŸï¼Œæ¯”å¦‚ï¼Œå¯ä»¥ç”¨CPUè¯»å–ä¸€ä¸ªæŒ‡ä»¤å­—çš„æœ€çŸ­æ—¶é—´æ¥è§„å®šæœºå™¨å‘¨æœŸ ä¸åŒçš„æŒ‡ä»¤ï¼Œå¯èƒ½åŒ…å«ä¸åŒæ•°ç›®çš„æœºå™¨å‘¨æœŸã€‚ ä¸€ä¸ªæœºå™¨å‘¨æœŸä¸­ï¼ŒåŒ…å«è‹¥å¹²ä¸ªèŠ‚æ‹è„‰å†²æˆ–Tè„‰å†²ã€‚ æœºå™¨å‘¨æœŸçš„å®šä¹‰å’Œè§„å®šï¼Œä¸åŒçš„è®¡ç®—æœºä¸­è§„å®šä¸åŒ 3.æ—¶é’Ÿå‘¨æœŸ åœ¨ä¸€ä¸ªæœºå™¨å‘¨æœŸå†…ï¼Œè¦å®Œæˆè‹¥å¹²ä¸ªå¾®æ“ä½œã€‚è¿™äº›å¾®æ“ä½œæœ‰çš„å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œæœ‰çš„éœ€è¦æŒ‰å…ˆåæ¬¡åºä¸²è¡Œæ‰§è¡Œã€‚å› è€Œéœ€è¦æŠŠä¸€ä¸ªæœºå™¨å‘¨æœŸåˆ†ä¸ºè‹¥å¹²ä¸ªç›¸ç­‰çš„æ—¶é—´æ®µï¼Œæ¯ä¸€ä¸ªæ—¶é—´æ®µç§°ä¸ºä¸€ä¸ªèŠ‚æ‹è„‰å†²æˆ–Tå‘¨æœŸã€‚ æ—¶é’Ÿå‘¨æœŸé€šå¸¸å®šä¹‰ä¸ºæœºå™¨ä¸»é¢‘çš„å€’æ•°ã€‚ 12è®²ï¼ˆå•å‘¨æœŸåŠå¤šå‘¨æœŸCPUæ„é€ ï¼‰ 13è®²ï¼ˆæµæ°´çº¿æŠ€æœ¯1ï¼‰é—®é¢˜:1.ç»™å‡ºäº”æ®µæµæ°´çº¿ç¤ºæ„å›¾ï¼ˆæ®µé‡Œé¢ç»™å‡ºåç§°ï¼‰? 2.æµæ°´çº¿å†²çªæœ‰å“ªå‡ ç§æƒ…å†µï¼ˆç»“æ„,æ•°æ®,æ§åˆ¶ï¼‰? ç»“æ„å†²çªï¼šå› ç¡¬ä»¶èµ„æºæ»¡è¶³ä¸äº†æŒ‡ä»¤é‡å æ‰§è¡Œçš„è¦æ±‚è€Œå‘ç”Ÿçš„å†²çªã€‚ æ•°æ®å†²çªï¼šå½“æŒ‡ä»¤åœ¨æµæ°´çº¿ä¸­é‡å æ‰§è¡Œæ—¶ï¼Œå› éœ€è¦ç”¨åˆ°å‰é¢æŒ‡ä»¤çš„æ‰§è¡Œç»“æœè€Œå‘ç”Ÿçš„å†²çªã€‚ æ§åˆ¶å†²çªï¼šæµæ°´çº¿é‡åˆ°åˆ†æ”¯æŒ‡ä»¤å’Œå…¶ä»–ä¼šæ”¹å˜PCå€¼çš„æŒ‡ä»¤æ‰€å¼•èµ·çš„å†²çªã€‚ 3.æµæ°´çº¿æ—¶ç©ºå›¾ï¼ˆååç‡ã€åŠ é€Ÿæ¯”å’Œæ•ˆç‡ï¼‰? ååç‡ï¼ˆthroughputï¼‰ï¼šåœ¨å•ä½æ—¶é—´å†…æµæ°´çº¿æ‰€å®Œæˆçš„ä»»åŠ¡æ•°é‡æˆ–è¾“å‡ºç»“æœçš„æ•°é‡ã€‚ åŠ é€Ÿæ¯”ï¼šå®ŒæˆåŒæ ·ä¸€æ‰¹ä»»åŠ¡ï¼Œä¸ä½¿ç”¨æµæ°´çº¿æ‰€ç”¨çš„æ—¶é—´ä¸ä½¿ç”¨æµæ°´çº¿æ‰€ç”¨çš„æ—¶é—´ä¹‹æ¯”ã€‚ æµæ°´çº¿çš„æ•ˆç‡ï¼šæµæ°´çº¿ä¸­çš„è®¾å¤‡å®é™…ä½¿ç”¨æ—¶é—´ä¸æ•´ä¸ªè¿è¡Œæ—¶é—´çš„æ¯”å€¼ï¼Œå³æµæ°´çº¿è®¾å¤‡çš„åˆ©ç”¨ç‡ã€‚ 14è®²ï¼ˆæµæ°´çº¿æŠ€æœ¯2ï¼‰è¯æ±‡ILPï¼šInstruction-Level-Parallelismï¼ŒæŒ‡ä»¤çº§å¹¶è¡Œ é—®é¢˜:1.è¶…æ ‡é‡å¤„ç†æœºï¼ˆæ—¶ç©ºå›¾ï¼‰? 2.è¶…æµæ°´çº¿å¤„ç†æœºï¼ˆæ—¶ç©ºå›¾ï¼‰? 3.è¶…æ ‡é‡è¶…æµæ°´çº¿å¤„ç†æœºï¼ˆæ—¶ç©ºå›¾ï¼‰? 15è®²ï¼ˆæ€»çº¿æŠ€æœ¯ï¼‰è¯æ±‡ISAï¼šå·¥ä¸šæ ‡å‡†æ€»çº¿ï¼ŒIndustry Standard Architecture PCIï¼šå¤–éƒ¨è®¾å¤‡éƒ¨ä»¶äº’è¿ï¼ŒPeripheral Component Interconnect é—®é¢˜:1.æ€»çº¿åˆ†ç±»? æ€»çº¿åˆ†ç±»1â‘  å†…éƒ¨æ€»çº¿ï¼šCPUå†…éƒ¨è¿æ¥å„å¯„å­˜å™¨åŠè¿ç®—å™¨éƒ¨ä»¶ä¹‹é—´çš„æ€»çº¿ â‘¡ ç³»ç»Ÿæ€»çº¿ï¼šCPUå’Œè®¡ç®—æœºç³»ç»Ÿä¸­å…¶ä»–é«˜é€ŸåŠŸèƒ½éƒ¨ä»¶ç›¸äº’è¿æ¥çš„æ€»çº¿ â‘¢ I/Oæ€»çº¿ï¼šCPUå’Œä¸­ä½é€ŸI/Oè®¾å¤‡ç›¸äº’è¿æ¥çš„æ€»çº¿ â‘£ é€šä¿¡æ€»çº¿ æ€»çº¿åˆ†ç±»2 â‘  æ•°æ®æ€»çº¿ â‘¡ åœ°å€æ€»çº¿ â‘¢ æ§åˆ¶æ€»çº¿ â‘£ ç”µæºæ€»çº¿ æ€»çº¿åˆ†ç±»3 â‘  å¹¶è¡Œæ€»çº¿ â‘¡ ä¸²è¡Œæ€»çº¿ 2.æ€»çº¿çš„ä¸€æ¬¡ä¿¡æ¯ä¼ é€è¿‡ç¨‹ï¼Œå¤§è‡´åˆ†ä¸ºå“ªå‡ ä¸ªé˜¶æ®µ? è‹¥é‡‡ç”¨åŒæ­¥å®šæ—¶åè®®ï¼Œè¯·ç”»å‡ºè¯»æ•°æ®çš„æ—¶åºå›¾æ¥è¯´æ˜ã€‚ åˆ†äº”ä¸ªé˜¶æ®µï¼šè¯·æ±‚æ€»çº¿ï¼Œæ€»çº¿ä»²è£ï¼Œå¯»å€ï¼ˆç›®çš„åœ°å€ï¼‰ï¼Œä¿¡æ¯ä¼ é€ï¼ŒçŠ¶æ€è¿”å›ï¼ˆé”™è¯¯æŠ¥å‘Šï¼‰ 3.æ€»çº¿å¸¦å®½è®¡ç®—? æ€»çº¿å¸¦å®½æ€»çº¿å¸¦å®½å®šä¹‰ä¸ºæ€»çº¿æœ¬èº«æ‰€èƒ½è¾¾åˆ°çš„æœ€é«˜ä¼ è¾“é€Ÿç‡ï¼Œå®ƒæ˜¯è¡¡é‡æ€»çº¿æ€§èƒ½çš„é‡è¦æŒ‡æ ‡ æ€»çº¿å®½åº¦åˆç§°ä½å®½ï¼ŒæŒ‡çš„æ˜¯æ€»çº¿åŒæ—¶ä¼ é€æ•°æ®çš„ä½æ•° æ€»çº¿é¢‘ç‡ 4.é“¾å¼æŸ¥è¯¢ç”µè·¯å•å…ƒçš„é€»è¾‘å›¾? BG(Bus Granted) BB(Bus Busy) BR(Bus Request) 5.å¹¶è¡Œåˆ¤ä¼˜ç”µè·¯å›¾ 16è®²ï¼ˆå¾®ç¨‹åºä¸ç¡¬å¸ƒçº¿ï¼‰é—®é¢˜:1.å¾®ç¨‹åºæ§åˆ¶å™¨ç»„æˆéƒ¨åˆ†? å¾®ç¨‹åºæ§åˆ¶å™¨ä¸»è¦ç”±æ§åˆ¶å­˜å‚¨å™¨ã€å¾®æŒ‡ä»¤å¯„å­˜å™¨å’Œåœ°å€è½¬ç§»é€»è¾‘ä¸‰å¤§éƒ¨åˆ†ç»„æˆã€‚ 17è®²ï¼ˆåŠå¯¼ä½“å­˜å‚¨å™¨ï¼‰è¯æ±‡ROMï¼ˆRead-Only Memoryï¼Œåªè¯»å­˜å‚¨å™¨ï¼‰ RAMï¼ˆRandom-Access Memoryï¼Œéšæœºå­˜å–å­˜å‚¨å™¨ï¼‰ EPROMï¼ˆErasable Programmable Readï¼Only Memoryï¼Œå¯æ“¦å¯ç¼–ç¨‹åªè¯»å­˜å‚¨å™¨ï¼‰ EEPROMï¼ˆElectrically Erasable Programmable read only memoryï¼Œç”µå¯æ“¦å¯ç¼–ç¨‹åªè¯»å­˜å‚¨å™¨ï¼‰ SRAMï¼ˆStatic Random Access Memoryï¼Œé™æ€éšæœºå­˜å–å­˜å‚¨å™¨ï¼‰ DRAMï¼ˆDynamic Random Access Memoryï¼ŒåŠ¨æ€éšæœºå­˜å–å­˜å‚¨å™¨ï¼‰ é—®é¢˜:1.å­˜å‚¨å™¨çš„ç‰‡ä½æ‰©å±•? å¤æ‚è€Œä¸”é‡è¦ï¼Œçœ‹PPTå§ï¼Œå®åœ¨ä¸è¡Œé—®è€å¸ˆã€‚ 18è®²ï¼ˆç£å­˜å‚¨ä¸å…‰å­˜å‚¨ï¼‰è¯æ±‡CAVï¼Œconstant angular velocityï¼Œæ’å®šè§’é€Ÿåº¦ CLVï¼Œconstant linear velocityï¼Œæ’å®šçº¿é€Ÿåº¦ CRCï¼šå¾ªç¯å†—ä½™æ ¡éªŒç  ECCï¼šError Checking and Correcting é—®é¢˜:1.ç£è®°å½•çš„å‡ ç§æ–¹å¼ï¼ˆåˆ—å‡ºå³å¯ï¼‰? â‘  ä¸å½’é›¶åˆ¶(NRZ0) â‘¡ è§â€œ1â€å°±ç¿»ä¸å½’é›¶åˆ¶(NRZ1) â‘¢ è°ƒç›¸åˆ¶(PM) â‘£ è°ƒé¢‘åˆ¶(FM) â‘¤ æ”¹è¿›è°ƒé¢‘åˆ¶(MFM) 19è®²ï¼ˆé«˜é€Ÿç¼“å†²å­˜å‚¨å™¨1ï¼‰é—®é¢˜:1.ä¸‰ç§æ˜ å°„æ–¹å¼åˆ†æ? â‘  ç›´æ¥ï¼ˆdirectï¼‰ï¼šæ¯ä¸ªä¸»å­˜å—æ˜ å°„åˆ°cacheçš„å›ºå®šè¡Œä¸­ â‘¡ å…¨ç›¸è”ï¼ˆfull associateï¼‰ï¼šæ¯ä¸ªä¸»å­˜å—æ˜ å°„åˆ°cacheçš„ä»»æ„è¡Œä¸­ â‘¢ ç»„ç›¸è”ï¼ˆset associateï¼‰ï¼šæ¯ä¸ªä¸»å­˜å—æ˜ å°„åˆ°cacheçš„å›ºå®šç»„çš„ä»»æ„è¡Œä¸­ 20è®²ï¼ˆé«˜é€Ÿç¼“å†²å­˜å‚¨å™¨2ï¼‰é—®é¢˜:1.cacheå‘½ä¸­ç‡ã€å¹³å‡è®¿é—®æ—¶é—´ã€æ•ˆç‡çš„åˆ†æ? 2.å†™å›ã€å†™ç›´è¾¾çš„åŒºåˆ«? 21è®²ï¼ˆè™šæ‹Ÿå­˜å‚¨å™¨ï¼‰è¯æ±‡VMï¼Œè™šæ‹Ÿå­˜å‚¨å™¨ï¼ŒVirtual Memory VAï¼Œè™šæ‹Ÿåœ°å€ï¼ŒVirtual Address LAï¼Œé€»è¾‘åœ°å€ï¼ŒLogical Address PAï¼Œç‰©ç†åœ°å€ï¼ŒPhysical Address TLBï¼Œå¿«è¡¨ï¼Œtranslation lookaside buffer é—®é¢˜:1.TLBçš„ä½œç”¨ï¼Ÿ ï¼ˆåˆç§°ä¸ºå¿«è¡¨æŠ€æœ¯ã€‚ç”±äºâ€œé¡µè¡¨â€å­˜å‚¨åœ¨ä¸»å­˜å‚¨å™¨ä¸­ï¼ŒæŸ¥è¯¢é¡µè¡¨æ‰€ä»˜å‡ºçš„ä»£ä»·å¾ˆå¤§ï¼Œç”±æ­¤äº§ç”Ÿäº†TLBã€‚TLBæ˜¯ä¸€ä¸ªå°çš„ï¼Œè™šæ‹Ÿå¯»å€çš„ç¼“å­˜ï¼Œå…¶ä¸­æ¯ä¸€è¡Œéƒ½ä¿å­˜ç€ä¸€ä¸ªç”±å•ä¸ªé¡µè¡¨é¡¹ç»„æˆçš„å—ã€‚å¦‚æœæ²¡æœ‰TLBï¼Œåˆ™æ¯æ¬¡å–æ•°æ®éƒ½éœ€è¦ä¸¤æ¬¡è®¿é—®å†…å­˜ï¼Œå³æŸ¥é¡µè¡¨è·å¾—ç‰©ç†åœ°å€å’Œå–æ•°æ®ã€‚TLBå’ŒCPUé‡Œcacheä¹‹é—´ä¸å­˜åœ¨æœ¬è´¨çš„åŒºåˆ«ï¼Œéƒ½æ˜¯åŠå¯¼ä½“ç¡¬ä»¶ï¼Œåªä¸è¿‡å‰è€…ç¼“å­˜é¡µè¡¨æ•°æ®ï¼Œè€Œåä¸¤ä¸ªç¼“å­˜å®é™…æ•°æ®ã€‚ï¼‰ 22è®²ï¼ˆRAIDåŠå…¶å®ƒï¼‰è¯æ±‡RAIDï¼šå»‰ä»·ç£ç›˜å†—ä½™é˜µåˆ—ï¼ŒRedundant Array of Inexpensive Disksï¼›æˆ–Redundant Arrays of Independent Disksï¼Œç‹¬ç«‹ç£ç›˜å†—ä½™é˜µåˆ— SCSIï¼šSmall Computer System Interfaceï¼Œå°å‹è®¡ç®—æœºç³»ç»Ÿæ¥å£ï¼‰ 23è®²ï¼ˆä¸­æ–­ï¼‰é—®é¢˜:1.CPUç®¡ç†å¤–å›´è®¾å¤‡æœ‰å‡ ç§æ–¹å¼? â‘  ç¨‹åºæŸ¥è¯¢æ–¹å¼ï¼šå¥½å¤„æ˜¯ç¡¬ä»¶ç»“æ„ç®€å•ï¼Œä¸è¶³æ˜¯å¤ªæµªè´¹CPUæ—¶é—´ï¼Œç›®å‰é™¤å•ç‰‡æœºå¤–ï¼Œå¾ˆå°‘ä½¿ç”¨æŸ¥è¯¢æ–¹å¼ã€‚ â‘¡ ç¨‹åºä¸­æ–­æ–¹å¼ï¼šæ˜¯ç®¡ç†I/Oæ“ä½œçš„ä¸€ä¸ªæ¯”è¾ƒæœ‰æ•ˆçš„æ–¹æ³•ã€‚ â‘¢ ç›´æ¥å†…å­˜è®¿é—®(DMA)æ–¹å¼ï¼šæ˜¯ä¸€ç§å®Œå…¨ç”±ç¡¬ä»¶æ‰§è¡ŒI/Oäº¤æ¢ï¼ŒDMAæ§åˆ¶å™¨æ¥ç®¡æ€»çº¿çš„æ§åˆ¶ï¼Œæ•°æ®äº¤æ¢ä¸ç»è¿‡CPUï¼Œé€‚ç”¨äºå†…å­˜å’Œé«˜é€Ÿå¤–å›´è®¾å¤‡ä¹‹é—´å¤§æ‰¹æ•°æ®äº¤æ¢çš„åœºåˆã€‚ â‘£ é€šé“æ–¹å¼ï¼šé€šé“æ˜¯ä¸€ä¸ªå…·æœ‰ç‰¹æ®ŠåŠŸèƒ½çš„å¤„ç†å™¨ã€‚ â‘¤ å¤–å›´å¤„ç†æœºï¼ˆPPUï¼ŒPeripheral processing unitï¼‰æ–¹å¼ï¼šPPUåŸºæœ¬ä¸Šç‹¬ç«‹äºä¸»æœºå·¥ä½œï¼Œæ˜¯é€šé“æ–¹å¼çš„è¿›ä¸€æ­¥å‘å±•ã€‚ 2.ç¨‹åºå†…éƒ¨å¼‚å¸¸çš„åŸå› ? 3.ç¨‹åºå¤–éƒ¨ä¸­æ–­çš„åŸå› ? 4.ç®€è¿°ä¸­æ–­æœåŠ¡ç¨‹åºçš„æµç¨‹? 5.ä¸­æ–­å±è”½ç çš„åº”ç”¨? åœ¨CPUçš„ä¸­æ–­ç®¡ç†éƒ¨ä»¶ä¸­å¿…é¡»æœ‰ä¸€ä¸ªä¸­æ–­å±è”½è§¦å‘å™¨ï¼Œå®ƒå¯ä»¥åœ¨ç¨‹åºçš„æ§åˆ¶ä¸‹ç½®â€œ1â€(è®¾ç½®å±è”½)ï¼Œæˆ–ç½®â€œ0â€(å–æ‰å±è”½)ã€‚åªæœ‰åœ¨ä¸­æ–­å±è”½æ ‡å¿—ä¸ºâ€œ0â€æ—¶ï¼ŒCPUæ‰å¯ä»¥å—ç†ä¸­æ–­ã€‚ 24è®²ï¼ˆDMAï¼‰è¯æ±‡DMAï¼šDirect Memory Accessï¼Œç›´æ¥å­˜å‚¨å™¨è®¿é—® é—®é¢˜:1.DMAåŠŸèƒ½ç¤ºæ„å›¾? 2.DMAä¼ é€çš„ä¸‰ç§æ–¹å¼? 25è®²ï¼ˆé€šç”¨IOæ¥å£æ ‡å‡†ï¼ŒèŠ¯ç‰‡ç»„ï¼Œå¤–éƒ¨è®¾å¤‡ï¼‰è¯æ±‡ATAï¼šAT Attachmentï¼ŒATè®¡ç®—æœºé™„åŠ è®¾å¤‡ PATAï¼ˆå¹¶è¡ŒATAï¼ŒParallel ATAï¼‰ SATAï¼ˆä¸²è¡ŒATAï¼ŒSerial ATAï¼‰ VGAï¼šVideo Graphics Arrayï¼Œè§†é¢‘å›¾å½¢é˜µåˆ— DVIï¼šDigital Visual Interfaceï¼Œæ•°å­—è§†é¢‘æ¥å£ HDMIï¼šHigh Definition Multimedia Interfaceï¼Œé«˜æ¸…æ™°åº¦å¤šåª’ä½“æ¥å£ LCDï¼šLiquid Crystal Displayï¼Œæ¶²æ™¶æ˜¾ç¤ºå™¨ LEDï¼šLight Emitting Diodeï¼Œå‘å…‰äºŒæç®¡ 26è®²ï¼ˆå¹¶è¡Œè®¡ç®—ï¼Œè®¡ç®—æœºç³»ç»Ÿæ€§èƒ½è¯„ä»·ï¼‰è¯æ±‡SISDï¼šå•æŒ‡ä»¤æµå•æ•°æ®æµ SIMDï¼šå•æŒ‡ä»¤æµå¤šæ•°æ®æµ MIMDï¼šå¤šæŒ‡ä»¤æµå¤šæ•°æ®æµ HPCï¼šé«˜æ€§èƒ½è®¡ç®—ï¼ŒHigh Performance Computing SCï¼šè¶…çº§è®¡ç®—ï¼ŒSuper Computing COWï¼šå·¥ä½œç«™æœºç¾¤ï¼ŒCluster of Workstation PVPï¼šå¹¶è¡Œå‘é‡æœºï¼ŒParallel Vector Processor UMAï¼šUniform Memory Accessï¼Œå…±äº«å­˜å‚¨å™¨æ¶æ„ SMPï¼šSymmetrical Multi-Processingï¼Œå¯¹ç§°å¤šå¤„ç†å™¨ç»“æ„ NUMAï¼šNon Uniform Memory Access Architectureï¼Œéä¸€è‡´å†…å­˜æ¶æ„ MPPï¼šMassive Parallel Processingï¼Œæµ·é‡å¹¶è¡Œå¤„ç†ç»“æ„ UMAï¼šå‡åŒ€å­˜å‚¨å™¨å­˜å–ï¼ŒUniform Memory Access NUMAï¼šéå‡åŒ€å­˜å‚¨å™¨å­˜å–ï¼ŒNon-uniform Memory Access COMAï¼šåªç”¨é«˜é€Ÿç¼“å­˜çš„å­˜å‚¨å™¨ç»“æ„ï¼ˆCache-Only Memory Architectureï¼‰ï¼Œæ˜¯NUMAçš„ç‰¹ä¾‹ é—®é¢˜:1.ä»ç³»ç»Ÿæ¶æ„æ¥çœ‹ï¼Œç›®å‰çš„å•†ç”¨æœåŠ¡å™¨å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸‰ç±» â‘  å¯¹ç§°å¤šå¤„ç†å™¨ç»“æ„(SMPï¼šSymmetric Multi-Processor) â‘¡ éä¸€è‡´å­˜å‚¨è®¿é—®ç»“æ„(NUMAï¼šNon-Uniform Memory Access) â‘¢ æµ·é‡å¹¶è¡Œå¤„ç†ç»“æ„(MPPï¼šMassive Parallel Processing) 2.å…±äº«å­˜å‚¨å‹å¤šå¤„ç†æœºæœ‰ä¸¤ç§æ¨¡å‹ å‡åŒ€å­˜å‚¨å™¨å­˜å–ï¼ˆUniform Memory Accessï¼Œç®€ç§°UMAï¼‰æ¨¡å‹ éå‡åŒ€å­˜å‚¨å™¨å­˜å–ï¼ˆNonuniform Memory Accessï¼Œç®€ç§°NUMAï¼‰æ¨¡å‹ 27è®²ï¼ˆGPUï¼Œæ ‘è“ç”µè„‘ç¡¬ä»¶æ¢å¯†ï¼‰è¯æ±‡GPUï¼šå›¾å½¢å¤„ç†å™¨ï¼ŒGraphics Processing Unit","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"operatingsystem","slug":"operatingsystem","permalink":"https://tinychen.com/tags/operatingsystem/"},{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"}]},{"title":"BIOSä¸UEFI","slug":"20171007-bios-n-uefi","date":"2017-10-07T07:00:00.000Z","updated":"2017-10-07T07:00:00.000Z","comments":true,"path":"20171007-bios-n-uefi/","link":"","permalink":"https://tinychen.com/20171007-bios-n-uefi/","excerpt":"BIOSå’ŒUEFIè¿™ä¸¤ä¸ªæ¦‚å¿µå¯¹äºåˆšæ¥è§¦è®¡ç®—æœºç¡¬ä»¶çš„æœ‹å‹æ¥è¯´å¯èƒ½æœ‰äº›éš¾ä»¥åŒºåˆ†ï¼Œæœ€è¿‘æ­£å¥½æœ‰ç©ºï¼Œå°±ç¨å¾®æ•´ç†äº†ä¸€ä¸‹æœ‰å…³çŸ¥è¯†å’Œå¤§å®¶åˆ†äº«äº¤æµä¸€ä¸‹ï¼Œå¦‚æ–‡ä¸­æœ‰ä»»ä½•é”™è¯¯ä¸è¶³ï¼Œè¿˜æœ›ä¸åèµæ•™ã€‚","text":"BIOSå’ŒUEFIè¿™ä¸¤ä¸ªæ¦‚å¿µå¯¹äºåˆšæ¥è§¦è®¡ç®—æœºç¡¬ä»¶çš„æœ‹å‹æ¥è¯´å¯èƒ½æœ‰äº›éš¾ä»¥åŒºåˆ†ï¼Œæœ€è¿‘æ­£å¥½æœ‰ç©ºï¼Œå°±ç¨å¾®æ•´ç†äº†ä¸€ä¸‹æœ‰å…³çŸ¥è¯†å’Œå¤§å®¶åˆ†äº«äº¤æµä¸€ä¸‹ï¼Œå¦‚æ–‡ä¸­æœ‰ä»»ä½•é”™è¯¯ä¸è¶³ï¼Œè¿˜æœ›ä¸åèµæ•™ã€‚ 1ã€BIOS â–²å›¾ä¸ºç»å…¸BIOSæ“ä½œç•Œé¢ 1.1 ç®€ä»‹BIOSï¼Œè¯»ä½œ/â€˜baious/ï¼Œå…¨ç§°Basic Input Outpout Systemï¼ˆåŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿï¼‰ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç»„å›ºåŒ–åˆ°è®¡ç®—æœºå†…ä¸»æ¿ä¸Šä¸€ä¸ªROMèŠ¯ç‰‡ä¸Šçš„ç¨‹åºï¼Œå®ƒä¿å­˜ç€è®¡ç®—æœºæœ€é‡è¦çš„åŸºæœ¬è¾“å…¥è¾“å‡ºçš„ç¨‹åºã€å¼€æœºåè‡ªæ£€ç¨‹åºå’Œç³»ç»Ÿè‡ªå¯åŠ¨ç¨‹åºï¼Œå®ƒå¯ä»CMOSä¸­è¯»å†™ç³»ç»Ÿè®¾ç½®çš„å…·ä½“ä¿¡æ¯ã€‚BIOSå’Œæ‰‹æœºçš„Bootloaderæœ‰äº›ç›¸ä¼¼ï¼Œå®é™…ä¸Šï¼Œä¸æ­¢æ˜¯ç”µè„‘å’Œæ‰‹æœºï¼ŒåŸºæœ¬æ‰€æœ‰ç”µå­äº§å“éƒ½æœ‰ä¸BIOS/BootloaderåŠŸèƒ½ç›¸ä¼¼çš„éƒ¨åˆ†ï¼Œå®ƒä»¬å¾€å¾€ä½“ç§¯å¾ˆå°ï¼ˆæœ€å¤§çš„ä¹Ÿæ‰å‡ MBï¼‰ï¼ŒåŠŸèƒ½çœ‹ä¼¼ç®€å•ä½†æ˜¯éå¸¸é‡è¦ã€‚ å­˜å‚¨ä¸Šï¼Œåœ¨ä¸»æ¿ä¸­æœ‰ç€ä¸“é—¨çš„èŠ¯ç‰‡ï¼ˆBIOSèŠ¯ç‰‡/CMOS RAMï¼‰ç”¨äºå­˜å‚¨BIOSï¼Œå› æ­¤å®ƒå¹¶ä¸å­˜å‚¨åœ¨å†…å­˜æˆ–è€…ç¡¬ç›˜ä¸­ï¼Œç¨³å®šæ€§å’Œå¯é æ€§æœ‰è¾ƒå¥½çš„ä¿è¯ã€‚ 1.2 BIOSçš„å­˜å‚¨ä»‹è´¨æ—©æœŸçš„BIOSæ˜¯å­˜å‚¨åœ¨ROMï¼ˆRead-Only-Memoryï¼Œåªè¯»å­˜å‚¨å™¨ï¼‰èŠ¯ç‰‡ä¸­ï¼Œåœ¨ä¸»æ¿å‡ºå‚å‰ï¼Œéœ€è¦é€šè¿‡ç‰¹æ®Šçš„æ‰‹æ®µå°†BIOSçƒ§å½•è¿›BIOSèŠ¯ç‰‡ä¸­ã€‚è€Œä¸”ç”±äºROMçš„åªè¯»ç‰¹æ€§ï¼Œä¸€æ–¹é¢ä¿è¯äº†BIOSä¸ä¼šå—åˆ°è½»æ˜“æ›´æ”¹è€Œä¿è¯ç¡¬ä»¶çš„æ­£å¸¸ç¨³å®šè¿è¡Œï¼Œå¦ä¸€æ–¹é¢ä¹Ÿé™åˆ¶äº†BIOSçš„å‡çº§ï¼ˆROMä¸èƒ½è¢«å†™å…¥æ•°æ®ï¼‰ã€‚ ä¸èƒ½è¢«å‡çº§çš„BIOSæ˜¾ç„¶ä¸èƒ½è¿åˆç§‘æŠ€å‘å±•çš„éœ€è¦ï¼Œäºæ˜¯EPROMèŠ¯ç‰‡å¼€å§‹æ›¿ä»£ROMæˆä¸ºBIOSçš„å­˜å‚¨èŠ¯ç‰‡ã€‚ EPROMå…¨ç¨‹æ˜¯Erasable Programmable ROMï¼Œåä¸ºå¯æ“¦é™¤å¯ç¼–ç¨‹ROMï¼Œè¿™ç§èŠ¯ç‰‡å¯é‡å¤æ“¦é™¤å’Œå†™å…¥ï¼Œè§£å†³äº†ROMèŠ¯ç‰‡åªèƒ½å†™å…¥ä¸€æ¬¡çš„å¼Šç«¯ã€‚EPROMå†…èµ„æ–™çš„å†™å…¥è¦ç”¨ä¸“ç”¨çš„ç¼–ç¨‹å™¨ï¼Œå¹¶ä¸”å¾€èŠ¯ç‰‡ä¸­å†™å†…å®¹æ—¶å¿…é¡»è¦åŠ ä¸€å®šçš„ç¼–ç¨‹ç”µå‹ï¼Œå†™å…¥èµ„æ–™åï¼Œè¿˜è¦ä»¥ä¸é€å…‰çš„è´´çº¸æˆ–èƒ¶å¸ƒæŠŠçª—å£å°ä½ï¼Œä»¥å…å—åˆ°å‘¨å›´çš„ç´«å¤–çº¿ç…§å°„è€Œä½¿èµ„æ–™å—æŸã€‚ å°½ç®¡EPROMå¯ä»¥é‡å¤æ“¦é™¤å’Œå†™å…¥ï¼Œä½†æ˜¯æ“ä½œæ–¹å¼å’Œæ¡ä»¶éƒ½è¿‡äºè‹›åˆ»ï¼Œåæ¥å°±ä½¿ç”¨äº†EEPROMèŠ¯ç‰‡ã€‚EEPROMï¼ˆElectrically Erasable Programmable ROMï¼Œç”µå¯æ“¦é™¤å¯ç¼–ç¨‹ROMï¼‰ã€‚é€šè¿‡è·³çº¿å¼€å…³å’Œç³»ç»Ÿé…å¸¦çš„é©±åŠ¨ç¨‹åºç›˜ï¼Œå¯ä»¥å¯¹EEPROMè¿›è¡Œé‡å†™ï¼Œæ–¹ä¾¿åœ°å®ç°BIOSå‡çº§ã€‚ åˆ°äº†ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è½¯ä»¶è½»æ˜“åœ°å‡çº§BIOSï¼Œæ˜¯å› ä¸ºç°åœ¨çš„BIOSå¤§å¤šæ˜¯ä½¿ç”¨äº†NOR Flashã€‚NOR Flash çš„ç‰¹ç‚¹æ˜¯èŠ¯ç‰‡å†…æ‰§è¡Œï¼ˆXIP ï¼ŒeXecute In Placeï¼‰ï¼Œè¿™æ ·åº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥åœ¨Flashé—ªå­˜å†…è¿è¡Œï¼Œä¸å¿…å†æŠŠä»£ç è¯»åˆ°ç³»ç»ŸRAMä¸­ã€‚ NOR çš„ä¼ è¾“æ•ˆç‡å¾ˆé«˜ï¼Œåœ¨1~4MBçš„å°å®¹é‡æ—¶å…·æœ‰å¾ˆé«˜çš„æˆæœ¬æ•ˆç›Šï¼Œä½†æ˜¯å¾ˆä½çš„å†™å…¥å’Œæ“¦é™¤é€Ÿåº¦å¤§å¤§å½±å“åˆ°å®ƒçš„æ€§èƒ½ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¯¹äºBIOSæ¥è¯´ï¼Œå°å®¹é‡è¶³ä»¥æ»¡è¶³éœ€æ±‚ï¼Œè€ŒBIOSçš„å‡çº§å¹¶éå¸¸äº‹ï¼Œå¶å°”ä¸€æ¬¡å‡çº§ï¼Œç”±å†™å…¥æ“¦é™¤é€Ÿåº¦æ…¢å¯¼è‡´çš„å‡çº§æ—¶é—´å»¶é•¿ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„å½±å“ã€‚ 1.3 BIOSé‡Œé¢æœ‰ä»€ä¹ˆä¸€èˆ¬æ¥è¯´ï¼Œäººä»¬æ™®éè®¤ä¸ºBIOSæ˜¯æ²Ÿé€šè½¯ä»¶ä¸ç¡¬ä»¶çš„æ¡¥æ¢ã€‚è®²å®Œå­˜å‚¨ä»‹è´¨ï¼Œæˆ‘ä»¬å†æ¥äº†è§£ä¸€ä¸‹è¿™ä¸ªå­˜å‚¨èŠ¯ç‰‡ï¼ˆBIOSèŠ¯ç‰‡ï¼‰é‡Œé¢éƒ½å‚¨å­˜ç€ä»€ä¹ˆä¸œè¥¿ã€‚ â—è‡ªè¯Šæ–­ç¨‹åºï¼šé€šè¿‡è¯»å–CMOSRAMä¸­çš„å†…å®¹è¯†åˆ«ç¡¬ä»¶é…ç½®ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè‡ªæ£€å’Œåˆå§‹åŒ–ï¼› è¿™å°±æ˜¯ç”µè„‘å¼€æœºæœ€å¼€å§‹çš„è‡ªæ£€æ­¥éª¤ï¼Œä¸€èˆ¬å‡ºç°é”™è¯¯ä¸»æ¿ä¼šæŠ¥è­¦ï¼Œå‘å‡ºå“å£°ï¼Œä¸€èˆ¬å¯ä»¥æ ¹æ®å“å£°çš„é•¿çŸ­å’Œæ•°é‡æ¥åˆ¤æ–­å‡ºç°é—®é¢˜çš„éƒ¨åˆ†ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸€äº›ä¸»æ¿åœ¨ä¸Šé¢åŠ äº†ä¸€å—å°å‹çš„LEDæ˜¾ç¤ºå±ï¼Œé€šè¿‡ä¸Šé¢çš„æ•°å­—æ¥ç›´æ¥åé¦ˆé”™è¯¯ä¿¡æ¯ã€‚ â— CMOSè®¾ç½®ç¨‹åºï¼šè¿™ä¸ªéƒ¨åˆ†å°±æ˜¯å¤§å®¶é€šå¸¸è§åˆ°çš„BIOSï¼ˆè“è‰²èƒŒæ™¯ç•Œé¢ï¼‰ï¼Œ å¼•å¯¼è¿‡ç¨‹ä¸­ï¼Œç”¨ç‰¹æ®Šçƒ­é”®å¯åŠ¨ï¼ˆä¸€èˆ¬æ˜¯Delã€escã€F9ã€F12ç­‰ï¼‰ï¼Œè¿›è¡Œè®¾ç½®åï¼Œå­˜å…¥CMOS RAMä¸­ï¼› å¤§å¤šæ•°çš„ç”µè„‘åœç•™åœ¨è¿™ä¸ªéƒ¨åˆ†çš„æ—¶é—´å¹¶ä¸é•¿ï¼Œå› æ­¤æƒ³è¦è¿›å…¥BIOSçš„CMOSè®¾ç½®ç¨‹åºï¼Œéœ€è¦åœ¨ä¸€å¼€æœºå°±ä¸åœåœ°æŒ‰å¯¹åº”çš„ç‰¹æ®Šçƒ­é”®ï¼Œé”™è¿‡äº†è¿™ä¸ªæ—¶é—´æ®µå°±åªèƒ½é‡å¯å†æ¥ã€‚ â— ç³»ç»Ÿè‡ªä¸¾è£…è½½ç¨‹åºï¼šåœ¨è‡ªæ£€æˆåŠŸåå°†ç£ç›˜ç›¸å¯¹0é“0æ‰‡åŒºä¸Šçš„å¼•å¯¼ç¨‹åºï¼ˆå³MBRåˆ†åŒºè¡¨ï¼‰è£…å…¥å†…å­˜ï¼Œè®©å…¶è¿è¡Œä»¥è£…å…¥æ“ä½œç³»ç»Ÿã€‚ â— ä¸»è¦I/Oè®¾å¤‡çš„é©±åŠ¨ç¨‹åºå’Œä¸­æ–­æœåŠ¡ï¼šç”±äºBIOSç›´æ¥å’Œç³»ç»Ÿç¡¬ä»¶èµ„æºæ‰“äº¤é“ï¼Œå› æ­¤æ€»æ˜¯é’ˆå¯¹æŸä¸€ç±»å‹çš„ç¡¬ä»¶ç³»ç»Ÿï¼Œè€Œå„ç§ç¡¬ä»¶ç³»ç»Ÿåˆå„æœ‰ä¸åŒï¼Œæ‰€ä»¥å­˜åœ¨å„ç§ä¸åŒç§ç±»çš„BIOSï¼Œéšç€ç¡¬ä»¶æŠ€æœ¯çš„å‘å±•ï¼ŒåŒä¸€ç§BIOSä¹Ÿå…ˆåå‡ºç°äº†ä¸åŒçš„ç‰ˆæœ¬ã€‚ 2ã€UEFI2.1 ç®€ä»‹ç”±äºBIOSæ˜¯ä½¿ç”¨æ±‡ç¼–è¯­è¨€è¿›è¡Œç¼–å†™ï¼Œå› æ­¤åœ¨æ“ä½œç•Œé¢ä¸Šç›¸å¯¹æ¯”è¾ƒç®€é™‹ï¼ˆæ²¡æœ‰åšå‡ºå¤ªå¤šçš„å›¾å½¢åŒ–ç•Œé¢ï¼‰ï¼Œå¯¹äºæŠ€æœ¯äººå‘˜æ¥è¯´ç»´æŠ¤å‡çº§ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œä¸å¯èƒ½ä½¿ç”¨é¼ æ ‡æ“ä½œï¼Œæ›´åŠ åˆ«è¯´æˆªå›¾ä¹‹ç±»çš„åŠŸèƒ½äº†ã€‚ æ›´è‡´å‘½çš„æ˜¯ï¼ŒBIOSå·²ç»å­˜åœ¨äº†äºŒåå¤šå¹´ï¼Œå¯æ˜¯å…¶å‘å±•å´æ˜¯æåº¦ç¼“æ…¢ï¼Œå·²ç»é˜»ç¢åˆ°äº†ä¸å…¶ç›¸å…³çš„ç¡¬ä»¶çš„å‘å±•ï¼Œé¦–å½“å…¶å†²çš„å°±æ˜¯CPUã€‚è‡³æ­¤ï¼Œä¸ªäººPCè¡Œä¸šæ¶ˆè´¹å¸‚åœºçš„é¾™å¤´è€å¤§è‹±ç‰¹å°”åä¸ä½äº†ï¼Œç”±å®ƒä¸»å¯¼ï¼Œå¼€å§‹æ¨å¹¿ä¸€ç§åä¸ºEFIçš„æŠ€æœ¯ï¼Œæ—¨åœ¨ç”¨å…¶å–ä»£ä¼ ç»Ÿçš„BIOSã€‚ å°ä¸ƒæ³¨ï¼šåœ¨x86ç³»åˆ—å¤„ç†å™¨è¿›å…¥32ä½çš„æ—¶ä»£ï¼Œç”±äºå…¼å®¹æ€§çš„åŸå› ï¼Œæ–°çš„å¤„ç†å™¨(i80386)ä¿ç•™äº†16ä½çš„è¿è¡Œæ–¹å¼(å®æ¨¡å¼)ï¼Œæ­¤åå¤šæ¬¡å¤„ç†å™¨çš„å‡çº§æ¢ä»£éƒ½ä¿ç•™äº†è¿™ç§è¿è¡Œæ–¹å¼ã€‚ç”šè‡³åœ¨å«64ä½æ‰©å±•æŠ€æœ¯çš„è‡³å¼ºç³»åˆ—å¤„ç†å™¨ä¸­ï¼Œå¤„ç†å™¨åŠ ç”µå¯åŠ¨æ—¶ä»ç„¶ä¼šåˆ‡æ¢åˆ°16ä½çš„å®æ¨¡å¼ä¸‹è¿è¡Œã€‚è‹±ç‰¹å°”å°†è¿™ç§æƒ…å†µå½’å’äºBIOSæŠ€æœ¯çš„å‘å±•ç¼“æ…¢ã€‚è‡ªä»PCå…¼å®¹æœºå‚å•†é€šè¿‡å‡€å®¤çš„æ–¹å¼å¤åˆ¶å‡ºç¬¬ä¸€å¥—BIOSæºç¨‹åºï¼ŒBIOSå°±ä»¥16ä½æ±‡ç¼–ä»£ç ï¼Œå¯„å­˜å™¨å‚æ•°è°ƒç”¨æ–¹å¼ï¼Œé™æ€é“¾æ¥ï¼Œä»¥åŠ1MBä»¥ä¸‹å†…å­˜å›ºå®šç¼–å€çš„å½¢å¼å­˜åœ¨äº†åå‡ å¹´ã€‚è™½ç„¶ç”±äºå„å¤§BIOSå‚å•†çš„åŠªåŠ›ï¼Œæœ‰è®¸å¤šæ–°å…ƒç´ æ·»åŠ åˆ°äº§å“ä¸­ï¼Œå¦‚PnP BIOSï¼ŒACPIï¼Œä¼ ç»ŸUSBè®¾å¤‡æ”¯æŒç­‰ç­‰ï¼Œä½†BIOSçš„æ ¹æœ¬æ€§è´¨æ²¡æœ‰å¾—åˆ°ä»»ä½•æ”¹å˜ã€‚è¿™è¿«ä½¿è‹±ç‰¹å°”åœ¨å¼€å‘æ›´æ–°çš„å¤„ç†å™¨æ—¶ï¼Œéƒ½å¿…é¡»è€ƒè™‘åŠ è¿›ä½¿æ•ˆèƒ½å¤§å¤§é™ä½çš„å…¼å®¹æ¨¡å¼ã€‚æœ‰äººæ›¾æ‰“äº†ä¸€ä¸ªæ¯”å–»ï¼šè¿™å°±åƒä¿æ—¶æ·æ–°ä¸€ä»£çš„å…¨è‡ªåŠ¨æ¡£è·‘è½¦è¢«äººç”Ÿå¥—ä¸Šå»ä¸€ä¸ªè¹©è„šçš„æŒ‚æ¡£å™¨ã€‚â€”â€”æ‘˜è‡ªç™¾åº¦ç™¾ç§‘ EFIï¼ˆExtensible Firmware Interfaceï¼‰çš„ä¸­æ–‡åä¸€èˆ¬å«åšå¯æ‰©å±•å›ºä»¶æ¥å£ï¼Œæ˜¯ä¸€ç§ç”±è‹±ç‰¹å°”ä¸»å¯¼çš„ç”¨äºæ›¿ä»£BIOSçš„æ–¹æ¡ˆã€‚æœ‰äººç§°EFIæ˜¯â€œæœªæ¥çš„ç±»PCçš„ç”µè„‘ç³»ç»Ÿä¸­æ›¿ä»£BIOSçš„å‡çº§æ–¹æ¡ˆâ€ï¼Œä½†å®é™…ä¸Šï¼Œè¿™ç§è¯´æ³•æœ‰ä¸€äº›ä¸å¤ªä¸¥è°¨ï¼Œå› ä¸ºEFIå·²ç»è¢«å¼ƒç”¨ï¼Œå¦‚ä»Šä½¿ç”¨çš„æ˜¯åŸºäºEFIæ ‡å‡†1.10ç‰ˆæœ¬å‘å±•è€Œæ¥çš„UEFIæ ‡å‡†ã€‚ å¦‚ä»ŠUEFIæ—©å·²ç»æ™®åŠå¼€æ¥ï¼Œè¿‘äº›å¹´å‘å”®çš„ä¸»æ¿ï¼ˆåŒ…æ‹¬ç¬”è®°æœ¬ï¼‰åŸºæœ¬éƒ½æ”¯æŒUEFIå’ŒBIOSä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œå‰è€…ä¸€èˆ¬è¢«ç§°ä¸ºUEFIï¼Œåè€…åˆ™ç§°ä¸ºLegacyã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆEFIçš„å‰é¢ä¼šå¤šäº†ä¸€ä¸ªUï¼Œå˜æˆUEFIäº†å‘¢ï¼Ÿå®é™…ä¸Šï¼ŒEFIå¯ä»¥è¢«ç†è§£ä¸ºæ˜¯åœ¨BIOSå’ŒUEFIè¿‡æ¸¡æ—¶æœŸçš„äº§ç‰©ã€‚ å½“ä¼ ç»Ÿçš„BIOSï¼ˆLegacy BIOSï¼‰é˜»ç¢äº†è®¡ç®—æœºç¡¬ä»¶å‘å±•çš„æ—¶å€™ï¼Œè‹±ç‰¹å°”ä¸»å¯¼æ¨è¡ŒEFIæ ‡å‡†ï¼Œä½†æ˜¯å…¶ä»–ä¼ä¸šè‡ªç„¶ä¸ä¼šé‚£ä¹ˆå‚»ï¼Œè®©è‹±ç‰¹å°”ä¸€äººä¸»å¯¼äº†æ•´ä¸ªEFIæ ‡å‡†ï¼Œæ­£æ‰€è°“â€œä¸€æµä¼ä¸šå–æ ‡å‡†â€ï¼Œç”±Intel, AMD, American Megatrends, Apple, Dell, Hewlett Packard Enterprise, HPï¼ŒIBM, Insyde Software, Lenovo, Microsoft å’ŒPhoenix Technologiesè¿™12å®¶è®¡ç®—æœºè½¯ç¡¬ä»¶å’Œé›¶å”®çš„å·¨å¤´åœ¨2005å¹´è”åˆæˆç«‹äº†ä¸€ä¸ªåä¸ºUnified Extensible Firmware Interface Forumï¼ˆç®€ç§°Uefi Forumï¼‰çš„éè¥åˆ©æ€§ç»„ç»‡ï¼Œä¸“é—¨è´Ÿè´£åˆ¶å®šå’Œç®¡ç†æ–°ä¸€ä»£çš„EFIæ ‡å‡†ï¼Œéšåå°±åŸºäºæœ€åä¸€ç‰ˆçš„EFIæ ‡å‡†ï¼ˆ1.10ï¼‰å‘å¸ƒäº†å…¨æ–°çš„UEFIæ ‡å‡†ï¼ŒEFIä¹Ÿå°±â€œå˜â€æˆäº†UEFIï¼ˆå…¨ç§°â€œç»Ÿä¸€çš„å¯æ‰©å±•å›ºä»¶æ¥å£â€ï¼ŒUnified Extensible Firmware Interfaceï¼‰ã€‚ â–²å›¾ä¸ºUEFIåä¼šçš„Logo 2.2 UEFIçš„ä¼˜åŠ¿é‚£ä¹ˆç›¸å¯¹äºä¼ ç»Ÿçš„BIOSï¼ŒUEFIçš„ä¼˜åŠ¿åœ¨å“ªé‡Œå‘¢ï¼Ÿ é¦–å…ˆï¼Œä¸ä½¿ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ä¼ ç»ŸBIOSä¸åŒï¼ŒUEFIä½¿ç”¨Cè¯­è¨€ç¼–å†™ï¼Œå› æ­¤æ•´ä½“é£æ ¼ä¸Šä¹Ÿå°±å»¶ç»­äº†Cè¯­è¨€é£æ ¼çš„å‚æ•°å †æ ˆä¼ é€’å’ŒåŠ¨æ€é“¾æ¥ï¼Œæ¨¡å—åŒ–ç‰¹å¾æ˜¾è‘—ã€‚ä½¿ç”¨Cè¯­è¨€å¼€å‘å’Œç»´æŠ¤å¯¹äºæŠ€æœ¯äººå‘˜æ¥è¯´ä¹Ÿæ–¹ä¾¿äº†å¾ˆå¤šï¼Œæ›´å®¹æ˜“å®ç°æ›´å¼ºçš„å¥å£®æ€§å’Œå®¹é”™æ€§ã€‚ UEFIå†…ç½®å›¾å½¢é©±åŠ¨åŠŸèƒ½ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªé«˜åˆ†è¾¨ç‡çš„å›¾å½¢åŒ–ç•Œé¢ï¼Œç”¨æˆ·è¿›å…¥åå®Œå…¨å¯ä»¥åƒåœ¨Windowsç³»ç»Ÿä¸‹é‚£æ ·ä½¿ç”¨é¼ æ ‡è¿›è¡Œè®¾ç½®å’Œè°ƒæ•´ï¼Œæ“ä½œä¸Šæ›´ä¸ºç®€å•å¿«æ·ã€‚åŒæ—¶ç”±äºUEFIåœ¨é€»è¾‘ä¸Šå¯åˆ†ä¸ºç¡¬ä»¶æ§åˆ¶ä¸è½¯ä»¶ç®¡ç†ä¸¤éƒ¨åˆ†ï¼Œå‰è€…å±äºæ ‡å‡†åŒ–çš„é€šç”¨è®¾ç½®ï¼Œè€Œåè€…åˆ™æ˜¯å¯ç¼–ç¨‹çš„å¼€æ”¾æ¥å£ï¼Œå› æ­¤ä¸»æ¿å‚å•†å¯ä»¥å€ŸåŠ©åè€…çš„å¼€æ”¾æ¥å£åœ¨è‡ªå®¶äº§å“ä¸Šå®ç°å„ç§ä¸°å¯Œçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æˆªå›¾ã€æ•°æ®å¤‡ä»½ ã€ç¡¬ä»¶æ•…éšœè¯Šæ–­ã€è„±ç¦»æ“ä½œç³»ç»Ÿè¿›è¡ŒUEFIåœ¨çº¿å‡çº§ç­‰ï¼ŒåŠŸèƒ½ä¸Šä¹Ÿè¦æ¯”ä¼ ç»ŸBIOSæ›´å¤šã€æ›´å¼ºã€‚ å°ä¸ƒæ³¨ï¼šUEFIå¯ä»¥è¯†åˆ«FAT/FAT32æ–‡ä»¶ç³»ç»Ÿæ ¼å¼çš„Uç›˜ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç‰¹æ®Šçƒ­é”®å°†æˆªå›¾å­˜å‚¨åœ¨Uç›˜ä¸­æˆ–è€…æ˜¯å°†UEFIçš„è®¾ç½®å¯¼å‡ºåˆ°Uç›˜ä¸­è¿›è¡Œå¤‡ä»½ï¼Œè¿˜å¯ä»¥å°†å‡çº§æ–‡ä»¶æ”¾å…¥Uç›˜ä¸­è¿›è¡ŒUEFIç³»ç»Ÿçš„å‡çº§ï¼Œéƒ¨åˆ†é«˜ç«¯çš„ä¸»æ¿ç”šè‡³å¯ä»¥ç›´æ¥åœ¨UEFIç¯å¢ƒä¸‹è”ç½‘å‡çº§ã€‚ 2.3 UEFIçš„ç»„æˆ â–²UEFIåœ¨é€»è¾‘ä¸Šå¯åˆ†ä¸ºè½¯ä»¶å’Œç¡¬ä»¶ä¸¤ä¸ªéƒ¨åˆ† UEFIåœ¨æ¦‚å¿µä¸Šå¯ä»¥åˆ†ä¸ºå¹³å°åˆå§‹åŒ–æ¡†æ¶å’ŒUEFI Imageä¸¤å¤§éƒ¨åˆ†ï¼Œç»†åˆ†ä¸‹æ¥åˆ™ç”±åˆå§‹åŒ–æ¨¡å—ï¼ˆPre EFIï¼Œç®€ç§°PEIï¼‰ã€é©±åŠ¨æ‰§è¡Œç¯å¢ƒï¼ˆDXEï¼‰ã€é©±åŠ¨ç¨‹åºï¼ˆUEFI Driversï¼‰ã€å…¼å®¹æ€§æ”¯æŒæ¨¡å—ï¼ˆCSMï¼‰ã€UEFIåº”ç”¨ï¼ˆUEFI Applicationsï¼‰å’ŒGUIDç£ç›˜åˆ†åŒºï¼ˆGPTåˆ†åŒºï¼‰/ OS Loadersç»„æˆã€‚ åˆå§‹åŒ–æ¨¡å—å’Œé©±åŠ¨æ‰§è¡Œç¯å¢ƒæ˜¯UEFIçš„è¿è¡ŒåŸºç¡€ï¼Œé€šå¸¸è¢«æ•´åˆåœ¨ä¸»æ¿çš„é—ªå­˜èŠ¯ç‰‡ä¸­ï¼Œè¿™ç‚¹ä¸ä¼ ç»ŸBIOSæ˜¯æ¯”è¾ƒç±»ä¼¼çš„ã€‚è€Œè¿™ä¸¤è€…ä¹Ÿè¢«å½’å±åœ¨UEFIçš„å¹³å°åˆå§‹åŒ–æ¡†æ¶ä¸­ã€‚ é©±åŠ¨ç¨‹åºã€å…¼å®¹æ€§æ”¯æŒæ¨¡å—ã€UEFIåº”ç”¨å’ŒGUIDç£ç›˜åˆ†åŒºåˆ™å½’å±äºUEFI Imageã€‚ â–²å›¾ä¸ºUEFIå„éƒ¨åˆ†ç»„ä»¶ä¹‹é—´çš„äº¤äº’é€»è¾‘ â—åˆå§‹åŒ–æ¨¡å—ï¼šå¼€æœºçš„æ—¶å€™åˆå§‹åŒ–æ¨¡å—é¦–å…ˆå¾—åˆ°æ‰§è¡Œï¼Œè´Ÿè´£CPUã€ä¸»æ¿èŠ¯ç‰‡åŠå­˜å‚¨è®¾å¤‡çš„åˆå§‹åŒ–å·¥ä½œã€‚ â—é©±åŠ¨æ‰§è¡Œç¯å¢ƒï¼šåˆå§‹åŒ–å®Œæˆååˆ™è½½å…¥é©±åŠ¨æ‰§è¡Œç¯å¢ƒï¼Œå³Driver Execution Environmentï¼Œç®€ç§°DXEï¼ŒDXEæ˜¯ç¡¬ä»¶çš„UEFIé©±åŠ¨ç¨‹åºåŠ è½½å’Œè¿è¡Œçš„å¿…è¦åŸºç¡€ç¯å¢ƒã€‚ â—é©±åŠ¨ç¨‹åºï¼šDXEé€šè¿‡æšä¸¾çš„æ–¹å¼åŠ è½½å„ç§æ€»çº¿åŠè®¾å¤‡çš„é©±åŠ¨ï¼Œè€Œè¿™äº›é©±åŠ¨ç¨‹åºåˆ™å¯ä»¥æ”¾ç½®åœ¨ç³»ç»Ÿçš„ä»»æ„ä½ç½®ï¼Œåªè¦ç¡®ä¿å…¶å¯ä»¥æŒ‰é¡ºåºè¢«æ­£ç¡®æšä¸¾å³å¯ã€‚ç¡¬ä»¶çš„UEFIé©±åŠ¨ä¸€èˆ¬æ˜¯æ”¾ç½®åœ¨ç¡¬ç›˜çš„UEFIä¸“ç”¨åˆ†åŒºä¸­ï¼Œåªéœ€è¦ç³»ç»Ÿæ­£ç¡®åŠ è½½è¿™ä¸ªç¡¬ç›˜ï¼Œå¯¹åº”çš„é©±åŠ¨å°±å¯ä»¥æ­£å¸¸è¯»å–å¹¶åº”ç”¨ â—å…¼å®¹æ€§æ”¯æŒæ¨¡å—ï¼šå…¼å®¹æ€§æ”¯æŒæ¨¡å—ï¼ˆCSMï¼‰æ˜¯æœ‰ç‚¹ç‰¹æ®Šçš„è¿‡æ¸¡æ—¶æœŸçš„äº§ç‰©ï¼Œæ˜¯ä¸ºäº†è®©ä¸å…·å¤‡UEFIå¼•å¯¼åŠŸèƒ½çš„æ“ä½œç³»ç»Ÿä¹Ÿèƒ½åœ¨UEFIç¯å¢ƒä¸‹é¡ºåˆ©å®Œæˆå¼•å¯¼å¼€æœºï¼Œè¿™ä¸ªå…¼å®¹æ€§æ”¯æŒæ¨¡å—å°†ä¸ºUEFIæä¾›ç±»ä¼¼äºä¼ ç»ŸBIOSçš„ç³»ç»ŸæœåŠ¡ï¼Œä»¥æ­¤ä¿è¯UEFIåœ¨æŠ€æœ¯ä¸Šèƒ½æœ‰è‰¯å¥½çš„è¿‡æ¸¡ã€‚ å°ä¸ƒæ³¨ï¼šWindowsæ“ä½œç³»ç»Ÿåœ¨vistaä¹‹åå‡å·²æ”¯æŒUEFIå¯åŠ¨ï¼Œè€Œéœ€è¦å®ç°UEFIå¯åŠ¨ï¼Œè¿˜éœ€è¦ä¸»æ¿æ”¯æŒï¼Œä¸”ç¡¬ç›˜åˆ†åŒºè¡¨è¦æ˜¯GPTåˆ†åŒºè¡¨ï¼Œæ­¤ä¸‰è€…ç¼ºä¸€ä¸å¯ï¼Œç¼ºä¸€éƒ½è¦ä½¿ç”¨CSMæ‰å¯ä»¥æ­£å¸¸å¼€æœºè¿›å…¥æ“ä½œç³»ç»Ÿã€‚ â—UEFIåº”ç”¨ï¼šç¡¬ä»¶åˆå§‹åŒ–å®Œï¼Œæ“ä½œç³»ç»Ÿå¯åŠ¨ä¹‹å‰çš„æ ¸å¿ƒåº”ç”¨ï¼Œæ¯”å¦‚ï¼šå¯åŠ¨ç®¡ç†ï¼ˆå¤šç¡¬ç›˜å¤šç³»ç»Ÿçš„å¯åŠ¨é¡ºåºï¼‰ã€BIOSè®¾ç½®ã€UEFI Shellã€è¯Šæ–­ç¨‹å¼ã€è°ƒåº¦å’Œä¾›åº”ç¨‹å¼ã€è°ƒè¯•åº”ç”¨ã€åŒ…æ‹¬CPUçš„è¶…é¢‘ï¼Œä¸»æ¿æ•£çƒ­é£æ‰‡çš„è½¬é€Ÿç­‰ç­‰éƒ½å¯ä»¥åœ¨è¿™é‡Œæ§åˆ¶ã€‚ â–²å›¾ä¸ºUEFI Shell â—GUIDç£ç›˜åˆ†åŒº/ OS Loadersï¼šGPTåˆ†åŒºè¡¨ä½œä¸ºUEFIæ ‡å‡†ä¸­ä¸å¯æˆ–ç¼ºçš„é‡è¦ä¸€ç¯ï¼Œçªç ´äº†è€æ—§çš„MBRåˆ†åŒºè¡¨æœ€å¤§ä»…æ”¯æŒ2TBç¡¬ç›˜ï¼Œå››ä¸ªä¸»åˆ†åŒºã€åˆ†åŒºè¡¨å®¹æ˜“ä¸¢å¤±ç­‰ä¸è¶³ï¼Œè¡¥è¶³äº†UEFIå¯åŠ¨ä¸‰è¦ç´ ï¼ˆä¸»æ¿ã€ç¡¬ç›˜åˆ†åŒºè¡¨ã€æ“ä½œç³»ç»Ÿï¼‰ä¸­ç¡¬ç›˜åˆ†åŒºè¡¨è¿™å…³é”®çš„ä¸€ç¯ã€‚ 2.4 UEFIçš„æœªæ¥UEFIæœ‰ç€å¦‚æ­¤å¤šçš„å¥½å¤„ï¼Œä¸ä»…æ”¶åˆ°äº†å¹¿å¤§ç”µè„‘ç”¨æˆ·çš„å–œçˆ±ï¼ŒåŒæ—¶ä¹Ÿå—åˆ°äº†â€¦â€¦é¢â€¦â€¦ä¸€äº›å±…å¿ƒåµæµ‹çš„äººçš„å–œçˆ±ã€‚ç”±äºUEFIä½¿ç”¨Cè¯­è¨€ç¼–å†™ï¼Œåœ¨éš¾åº¦ä¸Šè¾ƒæ±‡ç¼–è¯­è¨€é™ä½äº†å¾ˆå¤šï¼Œå› æ­¤å®¹æ˜“é­åˆ°é»‘å®¢çš„ç ´è§£æˆ–è€…æ˜¯æ¶æ„è½¯ä»¶çš„æ¤å…¥ï¼ŒåŠ ä¸ŠUEFIå¼ºå¤§çš„åº”ç”¨èƒ½åŠ›ï¼ˆç›¸å¯¹BIOSè€Œè¨€ï¼‰ï¼Œåœ¨UEFIæä¸€ä¸ªæ¶æ„è½¯ä»¶ä»€ä¹ˆçš„ä¸æ˜¯ç¾æ»‹æ»‹ï¼Ÿ å°½ç®¡å¦‚æ­¤ï¼ŒUEFIä¾ç„¶æ˜¯ç›®å‰çš„ä¸»æµè¶‹åŠ¿ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"operatingsystem","slug":"operatingsystem","permalink":"https://tinychen.com/tags/operatingsystem/"}]},{"title":"æ‰‹æœºå……ç”µæŠ€æœ¯å‘å±•å²","slug":"20170814-phone-charging-dev","date":"2017-08-14T07:00:00.000Z","updated":"2017-08-14T07:00:00.000Z","comments":true,"path":"20170814-phone-charging-dev/","link":"","permalink":"https://tinychen.com/20170814-phone-charging-dev/","excerpt":"éšç€ç§‘æŠ€çš„å‘å±•ï¼Œæ™ºèƒ½æ‰‹æœºçš„æ€§èƒ½æ„ˆå‘å¼ºå¤§ï¼Œæ™®åŠåº¦ä¹Ÿæ˜¯è¶Šæ¥è¶Šé«˜ï¼Œè€Œå®ƒåœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­çš„åœ°ä½æ›´æ˜¯æ°´æ¶¨èˆ¹é«˜ã€‚ä½†æ˜¯åœ¨ç”µæ± æŠ€æœ¯æ²¡æœ‰ä»€ä¹ˆçªç ´æ€§å‘å±•çš„ä»Šå¤©ï¼Œç»­èˆªæˆäº†æ‰€æœ‰æ‰‹æœºä¸å¾—ä¸æçš„ä¸€é¡¹å‚æ•°ï¼Œè€Œå……ç”µä½œä¸ºå…¶ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ï¼Œä¹Ÿæ˜¯è¢«å„å¤§æ‰‹æœºå‚å•†ä¸é—ä½™åŠ›åœ°è¿›è¡Œå®£ä¼ ã€‚ä»Šå¤©å°ä¸ƒå°±å¸¦å¤§å®¶æ¥ç®€å•äº†è§£ä¸€ä¸‹æ‰‹æœºå……ç”µæŠ€æœ¯çš„å‘å±•å²ã€‚","text":"éšç€ç§‘æŠ€çš„å‘å±•ï¼Œæ™ºèƒ½æ‰‹æœºçš„æ€§èƒ½æ„ˆå‘å¼ºå¤§ï¼Œæ™®åŠåº¦ä¹Ÿæ˜¯è¶Šæ¥è¶Šé«˜ï¼Œè€Œå®ƒåœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­çš„åœ°ä½æ›´æ˜¯æ°´æ¶¨èˆ¹é«˜ã€‚ä½†æ˜¯åœ¨ç”µæ± æŠ€æœ¯æ²¡æœ‰ä»€ä¹ˆçªç ´æ€§å‘å±•çš„ä»Šå¤©ï¼Œç»­èˆªæˆäº†æ‰€æœ‰æ‰‹æœºä¸å¾—ä¸æçš„ä¸€é¡¹å‚æ•°ï¼Œè€Œå……ç”µä½œä¸ºå…¶ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ï¼Œä¹Ÿæ˜¯è¢«å„å¤§æ‰‹æœºå‚å•†ä¸é—ä½™åŠ›åœ°è¿›è¡Œå®£ä¼ ã€‚ä»Šå¤©å°ä¸ƒå°±å¸¦å¤§å®¶æ¥ç®€å•äº†è§£ä¸€ä¸‹æ‰‹æœºå……ç”µæŠ€æœ¯çš„å‘å±•å²ã€‚ 1ã€å……ç”µçŸ¥è¯†åœ¨ç»§ç»­åé¢çš„æ•…äº‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¡¥å……ä¸€ç‚¹åŸºç¡€çš„å……ç”µæ–¹é¢çš„çŸ¥è¯†ã€‚ 1.1 çŸ¥è¯†ç‚¹ä¸€ï¼šå……ç”µçš„ç”µå‹ä»¥åŠå‘çƒ­ç›®å‰å¤§å¤šæ•°æ‰‹æœºä½¿ç”¨çš„ç”µèŠ¯éƒ½æ˜¯å•é”‚æˆ–è€…å¤šå¹¶é”‚ç»„æˆï¼Œç”µèŠ¯å·¥ä½œç”µå‹åœ¨3.0V4.4Vä¹‹é—´ï¼Œå‡å‹å¹³å°3.6V-3.8Vã€‚å½“è¿›è¡Œå……ç”µè¡Œä¸ºæ—¶ï¼Œç”µèƒ½è¿›å…¥æ‰‹æœºåé€šè¿‡æ‰‹æœºå†…çš„é™å‹ç”µè·¯å¤„ç†åå†è¾“å‡º3.34.5Vå·¦å³çš„ç”µå‹ç»™ç”µæ± å……ç”µã€‚è€Œè¿™ä¸ªç”µå‹è½¬æ¢å‹é™è¿‡ç¨‹ï¼Œå°±æ˜¯ç”±æ‰‹æœºå†…çš„å……ç”µç®¡ç†ICæ¨¡å—è´Ÿè´£ã€‚è¿™ä¸ªç”µå‹è½¬æ¢å‹é™è¿‡ç¨‹ä¼šäº§ç”Ÿå‘çƒ­ï¼Œç”µå‹å·®è·è¶Šå¤§äº§ç”Ÿçš„çƒ­é‡ä¼šè¶Šå¤šã€‚ â–²å›¾ä¸ºå……ç”µå™¨å·¥ä½œåŸç†ç¤ºæ„å›¾ 1.2 çŸ¥è¯†ç‚¹äºŒï¼šå……ç”µçš„ç”µæµä»¥åŠåŠŸç‡æ‰‹æœºå……ç”µæ—¶çš„ç”µæµå¹¶ä¸æ˜¯ä¸€ç›´ä¸å˜çš„ã€‚ä¼˜ç§€çš„å……ç”µæ–¹æ¡ˆåº”è¯¥æ˜¯æ‰‹æœºéœ€è¦å¤šå¤§çš„åŠŸç‡ï¼Œå……ç”µå™¨å°±ç»™å¤šå¤§çš„åŠŸç‡ï¼Œè€Œä¸æ˜¯æ‰‹æœºåªèƒ½è¢«åŠ¨åœ°æ¥å—å……ç”µå™¨ä¸€æˆä¸å˜çš„åŠŸç‡ã€‚å½“æ‰‹æœºå¤„äºä½ç”µé‡çš„æ—¶å€™ï¼Œæ‰‹æœºä¼šè¦æ±‚å……ç”µå™¨ç«åŠ›å…¨å¼€ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å……ç”µå³°å€¼ã€‚åœ¨è¿™ä¸ªæ—¶å€™å……ç”µé€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯æŸè€—å’Œå‘çƒ­ä¹Ÿå¾ˆå¤§ã€‚å……ç”µæ—¶ï¼Œéšç€æ‰‹æœºç”µé‡çš„ä¸Šå‡ï¼Œå……ç”µçš„åŠŸç‡å¾€å¾€æ˜¯é€æ¸ä¸‹é™çš„ã€‚å½“æ‰‹æœºçš„ç”µé‡å……åˆ°60%~80%çš„æ—¶å€™ï¼ˆå…·ä½“çœ‹æ‰‹æœºå‚å•†çš„è®¾å®šï¼‰ï¼Œå……ç”µç”µæµä¼šå‡å°ï¼Œä»¥è¾¾åˆ°å‡å°‘ç”µæ± æŸè€—å’Œæ‰‹æœºå‘çƒ­é‡ç­‰ç›®çš„ã€‚åœ¨åé¢è¿™ä¸ªé˜¶æ®µï¼Œç”µæµå¾€å¾€åªæœ‰å‡ ç™¾æ¯«å®‰ç”šè‡³æ›´å°ï¼Œå……ç”µçš„åŠŸç‡ä¹Ÿå¾ˆå°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ¶“æµå……ç”µã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¶“æµå……ç”µæ˜¯å¤§åŠŸç‡å……ç”µæ—¶ä»£çš„äº§ç‰©ï¼Œå¯¹äº5V/500mAçš„å……ç”µå™¨æ˜¯æ²¡æœ‰æ¶“æµå……ç”µè¿™ä¹ˆä¸€è¯´çš„ã€‚ï¼ˆç”µæµæœ¬æ¥å°±å¾ˆå°ï¼‰ ä¸‹é¢å¼€å§‹æ­£æ–‡ï¼Œæœ¬æ–‡åˆ†ä¸ºâ€œå²å‰â€æ—¶æœŸã€åˆéœ²é”‹èŠ’ã€å¿«å……ç°ä¸–ã€é«˜ä½ä¹‹äº‰å’Œä¸€ç»Ÿå¤©ä¸‹äº”ä¸ªéƒ¨åˆ†ã€‚ 2ã€â€œå²å‰â€æ—¶æœŸæˆ‘ä»¬å…ˆæ¥è¯´ä¸€ä¸‹å½“å¹´åŠŸèƒ½æœºè¿˜ç»Ÿæ²»ç€åœ°çƒçš„æ—¶æœŸï¼Œæ¯”è¾ƒæ—©æœŸçš„å……ç”µå™¨å’Œç°åœ¨çš„å……ç”µå™¨ä¸»è¦æœ‰ä¸‰ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„åŒºåˆ«ï¼š â‘  ä»¥å‰çš„å……ç”µå™¨å¹¶ä¸åƒç°åœ¨è¿™æ ·æ•°æ®çº¿å’Œé€‚é…å™¨ï¼ˆå……ç”µå¤´ï¼‰åˆ†å¼€ï¼Œè€Œæ˜¯ä¸€ä½“çš„ï¼Œä¹Ÿå°±æ˜¯å……ç”µå¤´è¿ç€æ•°æ®çº¿ï¼› â‘¡ ä»¥å‰çš„å……ç”µå™¨åŠŸç‡å…¶å®å¾ˆå°ï¼Œä¸€èˆ¬éƒ½æ˜¯5V/500mA,ä¹Ÿå°±æ˜¯2.5Wï¼ˆç“¦ï¼‰çš„åŠŸç‡ï¼› â‘¢ ä»¥å‰çš„å……ç”µå™¨å•çº¯åªèƒ½å……ç”µï¼Œè€Œç°åœ¨è´Ÿè´£çš„å……ç”µå™¨æŠŠæ•°æ®çº¿æ‹”ä¸‹æ¥æ¥åˆ°ç”µè„‘ä¸Šè¿˜å¯ä»¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼ˆåŒæ—¶ä¹Ÿèƒ½å……ç”µï¼‰ â–²å›¾å·¦ä¸ºè€å¼ä¸€ä½“å……ç”µå™¨ï¼ˆé»‘ï¼‰ï¼Œå³ä¸ºæ–°å¼åˆ†ä½“å¼å……ç”µå™¨ï¼ˆç™½ï¼‰ æ³¨ï¼šæ­¤å¤„å¹¶éæŒ‡åˆ†ä½“çš„å……ç”µå™¨è¦ä¼˜äºä¸€ä½“çš„å……ç”µå™¨ï¼Œå®é™…ä¸Šä¸¤è€…å„æœ‰ä¼˜åŠ£ ä¸ºä»€ä¹ˆå½“æ—¶çš„å……ç”µå™¨åŠŸç‡è¿™ä¹ˆå°å‘¢ï¼Ÿä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼š â‘  æ‰‹æœºç›¸å¯¹åŠŸèƒ½å°‘ï¼Œè€—ç”µå°‘ï¼Œå› æ­¤ç”µæ± ä¹Ÿå°ï¼ˆå¤§å¤šæ•°æ˜¯å‡ ç™¾æ¯«å®‰æ—¶/mAhï¼‰ï¼Œä¸éœ€è¦å¤ªå¤§åŠŸç‡çš„å……ç”µå™¨ï¼› â‘¡ å¤§åŠŸç‡çš„å……ç”µå™¨åˆ¶é€ éš¾åº¦å¤§ï¼Œæˆæœ¬é«˜ï¼Œåœ¨å½“æ—¶çš„ç¯å¢ƒä¸‹æ˜¾ç„¶ä¸åˆ’ç®—ï¼› ä½†æ˜¯éšç€æ‰‹æœºçš„å‘å±•ï¼Œå°¤å…¶æ˜¯å®‰å“æ‰‹æœºçš„å´›èµ·ï¼Œæ‰‹æœºåŠŸèƒ½ä¹Ÿå¼€å§‹å¢å¤šï¼Œè€—ç”µé‡ä¹Ÿå¼€å§‹å¢å¤§ï¼Œç”µæ± å®¹é‡ä¹Ÿå¼€å§‹çªé£çŒ›è¿›ï¼Œåˆ°äº†åŠ¨åˆ™ä¸Šåƒæ¯«å®‰æ—¶çš„æ—¶ä»£ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœè¿˜æ˜¯ç»§ç»­ä½¿ç”¨ç€5V/500mAçš„å……ç”µå™¨ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å……ç”µéå¸¸æ…¢ï¼Œè€Œä¸”ä¼šå‡ºç°è¾¹å……ç”µè¾¹ç©æ‰‹æœºï¼Œç”µé‡è¿˜æ˜¯è¶Šæ¥è¶Šå°‘çš„è¿™ç§â€å…¥ä¸æ•·å‡ºâ€çš„æƒ…å†µã€‚ åœ¨æ™ºèƒ½æ‰‹æœºèŒèŠ½çš„æ—¶å€™ï¼ŒUSBæ¥å£åœ¨æ‰‹æœºä¸Šä¹Ÿéšä¹‹æ™®åŠå¼€æ¥ã€‚è€Œæ‰‹æœºå……ç”µæŠ€æœ¯çš„å˜é©ï¼Œå°±ä»è¿™é‡Œå¼€å§‹äº†ã€‚ 3ã€åˆéœ²é”‹èŠ’æ¯”è¾ƒæ—©å¼€å§‹å‡ºç°çš„å……ç”µæ ‡å‡†æ˜¯USB BC 1.2ï¼ˆBCæ˜¯Battery Chargeçš„ç®€ç§°ï¼‰ã€‚ USBè§„æ ¼ç¬¬ä¸€æ¬¡æ˜¯äº1995å¹´ï¼Œç”±Intelï¼ˆè‹±ç‰¹å°”ï¼‰ã€NECï¼ˆæ—¥æœ¬ç”µæ°”æ ªå¼ä¼šç¤¾ï¼‰ã€Compaqï¼ˆåº·æŸï¼‰ã€DECï¼ˆç¾å›½æ•°å­—è®¾å¤‡å…¬å¸ï¼‰ã€IBMï¼ˆå›½é™…å•†ä¸šæœºå™¨å…¬å¸ï¼‰ã€Microsoftï¼ˆå¾®è½¯ï¼‰ã€Northern Telecomï¼ˆåŒ—æ–¹ç”µä¿¡å…¬å¸ï¼‰ç­‰ä¸ƒå®¶å…¬å¸ç»„æˆçš„USB IFï¼ˆUSB Implement Forumï¼‰å…±åŒæå‡ºã€‚ BC 1.2çš„å‡ºç°ï¼Œè®©åŒæ—¶è¿›è¡Œå……ç”µå’Œæ•°æ®ä¼ è¾“æˆä¸ºäº†ä¸»æµã€‚ USB BC1.2æ ‡å‡†ç”±USB IFåä¼šäº2010å¹´é¢å¸ƒï¼ŒæŒ‡çš„æ˜¯å¯ç›´æ¥ä¸ºå…³é—­çš„ä¾¿æºå¼è®¾å¤‡ç”µæ± å……ç”µï¼Œæˆä¸ºå»ºç«‹é€šè¿‡USBç«¯å£ä¸ºç”µæ± å……ç”µçš„æ­£ç¡®æ–¹å¼çš„å…³é”®æ ‡å‡†ã€‚ è¯´ç™½äº†ï¼ŒBC1.2å°±æ˜¯å¯ä»¥ç»™åŒ…æ‹¬æ‰‹æœºåœ¨å†…çš„ä¾¿æºå¼è®¾å¤‡ä½¿ç”¨USBæ¥å£å……ç”µï¼ˆåŒ…æ‹¬å…³æœºå……ç”µï¼‰çš„ä¸€å¥—å®˜æ–¹æ ‡å‡†ã€‚ BC 1.2å‡ºæ¥ä¹‹å‰ï¼Œé™¤äº†æ—¥æ¸å¼ºå¤§çš„åªèƒ½æ‰‹æœºï¼Œè¯¸å¦‚æ•°ç ç›¸æœºã€DVç­‰ä¾¿æºå¼è®¾å¤‡ä¹Ÿå¼€å§‹é€æ¸å—åˆ°äººä»¬çš„é’çã€‚è¿™äº›ä¾¿æºå¼è®¾å¤‡ä¸ç”µè„‘ä¹‹é—´çš„æ•°æ®äº¤æ¢ä¹Ÿå˜å¾—é¢‘ç¹äº†è®¸å¤šï¼Œå› æ­¤ï¼ŒUSBæ¥å£åœ¨è¿™äº›è®¾å¤‡ä¸Šå¼€å§‹æ™®éèµ·æ¥ã€‚ å°½ç®¡USBæ¥å£å‡ºç°çš„ç›®çš„æ˜¯ä¸ºäº†ä¼ è¾“æ•°æ®å’Œè¿æ¥è¯¸å¦‚é”®ç›˜é¼ æ ‡çš„è®¾å¤‡è€Œå¹¶ä¸æ˜¯å……ç”µï¼Œä½†æ˜¯åœ¨è¿™æ—¶å€™ï¼Œå¦‚æœèƒ½ä½¿ç”¨USBæ¥å£ç»™è¿™äº›è®¾å¤‡å……ç”µï¼Œé‚£ä¹ˆå°±ä¼šæ–¹ä¾¿å¾ˆå¤šï¼ŒUSB BC 1.2ä¹Ÿå°±åº”è¿è€Œç”Ÿäº†ã€‚ ç›®å‰å¸‚é¢ä¸Šä¸»æµçš„USBæ¥å£å¯ä»¥åˆ†ä¸ºUSB 2.0å’ŒUSB 3.0ä¸¤ç§ï¼Œå…¶ä¸­ä¸¤è€…çš„ç”µå‹éƒ½æ˜¯5Vï¼Œè€Œç”µæµæ–¹é¢USB 2.0ä¸º500mAï¼ŒUSB 3.0ä¸º900mAã€‚ æ³¨ï¼š â‘  USB 3.1 gen1å…¶å®å°±æ˜¯USB 3.0ï¼ˆæœ€å¤§ä¼ è¾“é€Ÿç‡ä»ç„¶æ˜¯5Gb/sï¼‰ï¼Œè€ŒUSB 3.1 gen2æ‰æ˜¯å‡çº§ç‰ˆï¼Œæœ€å¤§ä¼ è¾“é€Ÿç‡å¯è¾¾10Gb/sï¼Œæœ€å¤§è¾“å‡ºç”µå‹/ç”µæµå¯è¾¾20V/5Aï¼‰ï¼› â‘¡ ä¼ è¾“æ•°æ®çš„USB 2.0çš„çº¿ç¼†ä¸­åªæœ‰å››æ ¹çº¿ï¼Œå……ç”µçš„MicroUSB 2.0çº¿ç¼†ä¸­æœ‰äº”æ ¹çº¿ï¼Œè€ŒUSB 3.0ä¸­å‡çº§ä¸ºäº†ä¹æ ¹çº¿ï¼› â‘¢ å¸¸è§çš„USBåˆ†çº¿å™¨/é›†çº¿å™¨/HUBç­‰å¯ä»¥å°†ä¸€ä¸ªUSBæ¥å£åˆ†å‡ºå¤šä¸ªUSBæ¥å£çš„è®¾å¤‡ï¼Œåœ¨æ²¡æœ‰ç‹¬ç«‹å¤–æ¥ç”µæºçš„æƒ…å†µä¸‹ï¼Œå¾ˆæœ‰å¯èƒ½å› ä¸ºç»™æ¯ä¸ªUSBæ¥å£æä¾›çš„ç”µæµä¸è¶³è€Œå¯¼è‡´è¿æ¥åœ¨è¯¥USBæ¥å£ä¸Šçš„è®¾å¤‡æ— æ³•æ­£å¸¸ä½¿ç”¨ç”šè‡³æ˜¯æŸåï¼Œå› æ­¤å¤§å®¶åœ¨ä½¿ç”¨è¿™ç±»äº§å“çš„æ—¶å€™ä¸€å®šè¦å°å¿ƒã€‚ USB BC 1.2æœ€å¤§çš„åŠŸåŠ³å°±æ˜¯ä½¿å¾—USBå……ç”µçš„æœ€å¤§ç”µæµèƒ½å¤Ÿè¾¾åˆ°1500mAä¹Ÿå°±æ˜¯1.5Aï¼Œå°½ç®¡å®ƒæ²¡æœ‰æå‡ç”µå‹ï¼ˆå› ä¸ºè¦é€‚é…å…¶ä»–ä¾¿æºè®¾å¤‡ï¼‰ï¼Œä½†æ˜¯å°†ç”µæµæå‡åˆ°1.5Aä¹‹åï¼ŒUSBæ¥å£å……ç”µçš„æœ€å¤§åŠŸç‡å°±èƒ½å¤Ÿè¾¾åˆ°7.5ç“¦ï¼ˆWï¼‰ï¼Œè¿™ä¸ªæ—¶å€™çš„USB BC 1.2å·²ç»è¶³å¤Ÿåº”ä»˜å½“æ—¶çš„æ‰‹æœºå……ç”µäº†ã€‚ USB BC 1.2çš„å‡ºç°ä¸ä»…ä½¿å¾—å½“æ—¶çš„USBå……ç”µè§„èŒƒæ··ä¹±çš„åœºé¢å¾—åˆ°äº†è§„èŒƒï¼Œè€Œä¸”å®ƒå¯¹äºé›†çº¿å™¨/åˆ†çº¿å™¨/HUBä¹Ÿæœ‰ç€å¾ˆå¥½çš„æ”¯æŒï¼Œç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†ä¿è¯æ¯ä¸ªæ¥å£èƒ½æœ‰è¶³å¤Ÿçš„ç”µæµï¼Œæ”¯æŒBC 1.2çš„é›†çº¿å™¨/åˆ†çº¿å™¨/HUBå¾€å¾€éƒ½éœ€è¦å¤–æ¥ç”µæºã€‚ â–²å›¾ä¸ºUSB BC 1.2å·¥ä½œæ–¹æ¡ˆ å‰æ’æç¤ºï¼šåƒä¸‡ä¸è¦å°çœ‹USB IFåä¼šå“¦ 4ã€å¿«å……ç°ä¸–å°½ç®¡USB BC 1.2æ ‡å‡†å·²ç»èƒ½æ»¡è¶³å½“æ—¶çš„å……ç”µéœ€æ±‚ï¼Œä½†æ˜¯ç§‘æŠ€çš„å‘å±•æ˜¯æ— æ­¢å¢ƒçš„ã€‚éšç€æ™ºèƒ½æ‰‹æœºçš„å‘å±•ï¼Œå¯¹å……ç”µçš„é€Ÿåº¦å†æ¬¡æå‡ºäº†æ›´é«˜çš„è¦æ±‚ã€‚è€Œå°±åœ¨è¿™ä¸ªæ—¶å€™ï¼Œå‘å¸ƒUSB BC 1.2æ ‡å‡†çš„USB IFåä¼šå±…ç„¶æ²¡æœ‰ç»™å‡ºä¸€å¥—å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œè€Œè¿™å°±ä¸ºåæ¥çš„å¿«å……æ ‡å‡†å¤§æ··æˆ˜åŸ‹ä¸‹äº†ä¼ç¬”ã€‚ åˆ°äº†2013ï¼Œé«˜é€šå¤§ä½¬å°±å‡ºåœºäº†ã€‚å½“æ—¶é«˜é€šä¸€æ‹æ¡Œå­ï¼ŒæŒ¯è‡‚ä¸€å‘¼ï¼šåŒå¿—ä»¬ï¼Œè·Ÿç€æˆ‘æœ‰è‚‰åƒï¼å®ƒç‡å…ˆçªç ´äº†USB IFåä¼šå…³äºUSB BC 1.2æ ‡å‡†ä¸­çš„1.5Açš„æœ€å¤§ç”µæµé™åˆ¶ï¼Œå°†å…¶æå‡åˆ°äº†2Aä¹Ÿå°±æ˜¯10Wçš„åŠŸç‡ï¼ˆ5V/2Aï¼‰ï¼Œå……ç”µé€Ÿåº¦å¤§å¹…æå‡ã€‚ è¿™å°±æ˜¯é«˜é€šçš„QuickChargeå¿«å……1.0ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯QC 1.0å¿«å……ã€‚ äº†è§£é«˜é€šçš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“ï¼Œé«˜é€šåœ¨æ‰‹æœºèŠ¯ç‰‡å’Œé€šä¿¡ä¸“åˆ©æ–¹é¢å¯è°“æ˜¯ä¸€æ–¹å·¨æ“˜ï¼Œè€Œå‡­å€Ÿç€è¿™ä¸ªéœ¸ä¸»çº§åˆ«çš„åœ°ä½ä¼˜åŠ¿ï¼Œé«˜é€šå¯ä»¥è¿…é€Ÿæ¨å¹¿è‡ªå·±çš„QCå¿«å……æ ‡å‡†ã€‚ç„¶åï¼Œå°±å¯ä»¥åç€æ”¶QCæ ‡å‡†çš„æˆæƒè´¹ã€‚ è€Œåˆ°äº†2014å¹´ï¼Œæƒ…å†µå°±æœ‰äº›ä¸ä¸€æ ·äº†ï¼Œè¿™ä¸ªæ—¶å€™è™½ç„¶Type-Cçš„æ•°æ®çº¿å·²ç»é¢ä¸–ï¼Œä½†å´è¿˜æ²¡æœ‰æ™®åŠï¼Œæ‰‹æœºä¸Šä¾æ—§è¿˜ä½¿ç”¨ç€MicroUSB 2.0æ¥å£çš„æ•°æ®çº¿ï¼ˆä¹Ÿå°±æ˜¯å¤§å®¶å¸¸è¯´çš„å®‰å“çº¿ï¼‰ã€‚å‰é¢æˆ‘ä»¬å·²ç»æåˆ°äº†ï¼Œç”±äºMicroUSB 2.0çš„æ•°æ®çº¿å†…éƒ¨åªæœ‰å››æ ¹çº¿ï¼Œå¯¹ç”µæµçš„æ‰¿è½½èƒ½åŠ›éå¸¸æœ‰é™ï¼Œ2AåŸºæœ¬å°±æ˜¯æé™äº†ï¼Œè€ŒType-Cæ¥å£ä¼˜äºè®¾è®¡çš„ä¼˜è¶Šæ€§ï¼Œæ¥å£çš„è§¦ç‚¹éå¸¸å¤šï¼Œå› æ­¤å†…éƒ¨å¯ä»¥å¢åŠ çš„çº¿æ¯”MicroUSB 2.0è¦å¤šå¾—å¤š,æœ€å¤§å¯æ”¯æŒ5Açš„ç”µæµã€‚æ‰€ä»¥Type-Cæ¥å£ä¸ç”Ÿä¿±æ¥å°±å¯¹å¤§ç”µæµæœ‰ç€æå¤§çš„å‹å¥½ã€‚ â–²å›¾å·¦ä¸ºType-Cå‹æ¥å£ï¼Œå›¾å³ä¸ºMicroUSB 2.0æ¥å£ æ³¨ï¼š â‘  Type-Cæ¥å£åªæ˜¯ä¸€ç§æ¥å£ç±»å‹ï¼Œç”±äºä½“ç§¯å°ï¼Œæ­£åå¯æ’ï¼Œä»¥åŠå¯ä»¥å…¼å®¹è¯¸å¤šåè®®ï¼Œå› æ­¤æœ‰ç€â€œæ•°æ®æ¥å£çš„ç»ˆæå½¢æ€â€ä¹‹ç§°ï¼Œä½†ä¹Ÿå› ä¸ºå…¶å…¼å®¹äº†è¯¸å¤šåè®®ï¼Œå¯ä»¥é›†æˆè§†é¢‘ã€éŸ³é¢‘ã€æ•°æ®ã€ä¾›ç”µç­‰å„ç§æ¥å£å’Œåè®®ï¼ˆå¦‚é›·ç”µä¸‰ï¼‰ï¼Œå¯¼è‡´ç›®å‰å¸‚é¢ä¸Šçš„Type-Cæ¥å£åŠŸèƒ½ä¸ä¸€ï¼Œå¯¹æ–°æ‰‹æ¥è¯´æ¯”è¾ƒä¸å‹å¥½ã€‚ â‘¡ å¸¸è§çš„MicroUSBé™¤äº†2.0ï¼Œè¿˜æœ‰MicroUSB 3.0ï¼Œæ‰‹æœºä¸Šæœ‰ä¸‰æ˜Ÿçš„note3å’Œs5é‡‡ç”¨äº†è¿™ç§æ¥å£ã€‚ä½†æ˜¯ç”±äºMicroUSB 3.0ä½“ç§¯å¤ªå¤§ï¼Œå› æ­¤åæ¥å°±æ²¡æœ‰æ‰‹æœºé‡‡ç”¨è¿™ç§æ¥å£äº†ï¼Œåå€’æ˜¯ç§»åŠ¨ç¡¬ç›˜ç°åœ¨ç”¨çš„æ¯”è¾ƒå¤šã€‚ â–²å›¾ä¸ºMicroUSB 3.0æ•°æ®æ¥å£ æ³¨ï¼šä»¥ä¸‹æåŠçš„MicroUSBå¦‚æ— æ ‡æ³¨åˆ™å‡ä¸ºMicroUSB 2.0 5ã€é«˜ä½ä¹‹äº‰æˆ‘ä»¬ç»§ç»­å›åˆ°å¿«å……å‘å±•å²çš„2014å¹´ã€‚ è€Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœè¿˜è¦ç»§ç»­é€šè¿‡å¢å¤§ç”µæµçš„æ–¹æ³•æ¥æå‡å……ç”µåŠŸç‡ï¼ŒMicroUSBé‚£å­±å¼±çš„èº«èº¯å¯æ‰¿å—ä¸äº†è¿™å·¨å¤§çš„ç”µæµã€‚äºæ˜¯ä¹ï¼Œä»¥é«˜é€šQCä¸ºé¦–çš„é«˜å‹å¿«å……æ–¹æ¡ˆå’Œä»¥OPPO VOOCä¸ºé¦–çš„ä½å‹å¤§ç”µæµå¿«å……æ–¹æ¡ˆå°±æ­¤åˆ†é“æ‰¬é•³ï¼Œè€Œå¿«å……åè®®çš„æ··æˆ˜ä¹Ÿä»æ­¤å±•å¼€ã€‚ å…ˆæ¥è¯´è¯´é«˜é€šè¿™è¾¹çš„é«˜å‹å¿«å……æ–¹æ¡ˆã€‚ æˆ‘ä»¬éƒ½çŸ¥é“Pï¼ˆåŠŸç‡ï¼‰=Uï¼ˆç”µå‹ï¼‰*Iï¼ˆç”µæµï¼‰ï¼Œè€Œæ—¢ç„¶å½“æ—¶å¢å¤§ç”µæµä¸è¡Œï¼Œé‚£å°±å¢å¤§ç”µå‹å‘—ï¼ŒåŒæ ·æ˜¯18WåŠŸç‡çš„å¿«å……ï¼Œå¦‚æœè¦ç”¨5Vç”µå‹çš„è¯ï¼Œç”µæµå·²ç»è¶…è¿‡äº†3Aï¼Œæ­£å¸¸çš„MicroUSBæ˜¯ç»å¯¹å—ä¸äº†çš„ã€‚è€Œä½¿ç”¨12Vçš„ç”µå‹ï¼Œç”µæµå°±åªéœ€è¦1.5Aï¼Œä¸€ä¸‹å­ç”µæµå°±é™ä¸‹æ¥äº†ã€‚è¿™ç§æ–¹æ¡ˆçš„ä¸€å¤§å¥½å¤„å°±æ˜¯æˆæœ¬æ¯”è¾ƒä½ï¼Œè€Œåå¤„å°±æ˜¯å°†å……ç”µå™¨çš„ç”µå‹å‡åˆ°è¿™ä¹ˆé«˜ï¼Œåœ¨äºŒæ¬¡é™å‹è¿‡ç¨‹ä¸­æ‰‹æœºçš„å……ç”µç®¡ç†ICäº§ç”Ÿçš„çƒ­é‡ä¹Ÿæ˜¯æå¤§çš„ï¼Œæ‰€ä»¥é«˜å‹å¿«å……çš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯æ‰‹æœºå‘çƒ­ä¸¥é‡ã€‚ æ³¨æ„ï¼Œ1.5Aæ˜¯QCæ ‡å‡†æ¯”è¾ƒæ¨èçš„ç”µæµï¼Œå› ä¸º2Aæ˜¯Micro USBçš„æé™ï¼Œä¸šç•Œçš„æ™®éå…±è¯†æ˜¯ï¼Œä¸è¦æŠŠå™¨ä»¶ç”¨åˆ°æé™å€¼ï¼Œè€Œæ˜¯è¦é¢„ç•™ä½™é‡ã€‚ â–²å›¾ä¸ºé«˜å‹å¿«å……æ–¹æ¡ˆç¤ºæ„å›¾ æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥è¯´è¯´OPPOçš„VOOCä½å‹å¤§ç”µæµå¿«å……ã€‚ â–²å›¾ä¸ºä½å‹å¤§ç”µæµå¿«å……åŸç†ç¤ºæ„å›¾å’Œé«˜é€šä¸åŒï¼ŒOPPOè¿™è¾¹é‡‡ç”¨çš„æ˜¯å¦å¤–ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ä¸æ˜¯è¯´æ­£å¸¸çš„MicroUSBæ•°æ®çº¿æ‰¿è½½ä¸äº†è¿™ä¹ˆå¤§çš„ç”µæµå˜›ï¼Œé‚£å°±æŠŠå……ç”µå™¨ä»å¤´åˆ°å°¾å½»åº•æ”¹é€ ä¸€ç•ªã€‚OPPOé‡‡ç”¨åœ¨å½“æ—¶æ¥è¯´ç›¸å½“å¦ç±»çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨æ™®é€šçš„MicroUSBæ•°æ®çº¿ä¸­å¢åŠ äº†ä¸¤ä¸ªä¸ªè§¦ç”µï¼Œä½¿å¾—å†…éƒ¨ä»äº”æ ¹çº¿å˜æˆäº†ä¸ƒæ ¹çº¿ï¼Œå……ç”µå¤´ä¹Ÿå› ä¸ºæ•´åˆäº†ICç”µè·¯è€Œå˜å¾—å¥‡å¤§æ— æ¯”ã€‚ â–²å›¾ç‰‡æ¥è‡ªå……ç”µå¤´ç½‘ ä¸ä»…å¦‚æ­¤ï¼Œå› ä¸ºä»å¤´æ”¹é€ ç”µè·¯ï¼Œæ‰€ä»¥æ•°æ®çº¿åªèƒ½ç”¨å®˜æ–¹çš„ç‰¹åˆ¶æ•°æ®çº¿ï¼Œä¸€èˆ¬çš„æ•°æ®çº¿æ— æ³•è¾¾åˆ°å¿«å……çš„æ•ˆæœï¼Œè€Œä¸”è¿™æ ·åšçš„æˆæœ¬ä¹Ÿå¾ˆé«˜ï¼Œå¤§ç”µæµå……ç”µå¯¹äºç”µæ± çš„æŸè€—ä¹Ÿæ›´ä¸ºæ˜æ˜¾ï¼Œå¾ˆå¤šä½¿ç”¨åˆæœŸçš„VOOCå¿«å……çš„æ‰‹æœºåœ¨ä½¿ç”¨å¤§çº¦ä¸€å¹´ä¹‹åï¼Œç”µæ± ç»­èˆªä¸¥é‡ä¸‹é™ã€‚ ä½†æ˜¯ï¼Œä»˜å‡ºäº†å¦‚æ­¤å·¨å¤§çš„ä»£ä»·ï¼ŒOPPOä¹Ÿä¸æ˜¯æ²¡æœ‰æ”¶è·çš„ã€‚ åˆä»£çš„VOOCå¿«å……å°±å‡­å€Ÿç€5V/5Açš„25Wè¶…å¤§åŠŸç‡ï¼Œåœ¨å……ç”µé€Ÿåº¦ä¸Šä¸€éª‘ç»å°˜ï¼Œä½¿å¾—å…¶ä½™æ‰‹æœºéƒ½éš¾ä»¥æœ›å…¶é¡¹èƒŒã€‚è€Œç”±äºå®ƒå°†å‘çƒ­æºå¤–ç½®åˆ°å……ç”µå™¨ä¸­ï¼Œæ‰‹æœºåœ¨å……ç”µæ—¶å‘çƒ­é‡æ˜æ˜¾å°äºé«˜å‹å¿«å……æ–¹æ¡ˆã€‚æ—¢ç„¶VOOCå¿«å……å¦‚æ­¤ä¼˜ç§€ï¼ŒOPPOè‡ªç„¶ä¹Ÿä¸èƒ½è—ç€æ–ç€ï¼Œäºæ˜¯ä¹â€¦â€¦ å……ç”µäº”åˆ†é’Ÿï¼Œé€šè¯ä¸¤å°æ—¶çš„å¹¿å‘Šè¯å“å½»å¤§æ±Ÿå—åŒ—ã€‚ â–²å›¾ä¸ºOPPO R11å®˜æ–¹å®£ä¼ æ–‡æ¡ˆ ä½å‹å¤§ç”µæµæ–¹æ¡ˆè™½ç„¶æˆæœ¬é«˜ï¼Œä¸”å¯¹å……ç”µè®¾å¤‡æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼ˆå°¤å…¶æ˜¯çº¿æï¼‰ï¼Œä½†æ˜¯æ‰‹æœºä¸Šçš„å‘çƒ­é‡å°ï¼Œå……ç”µé€Ÿåº¦æ›´å¿«ã€‚ 6ã€ä¸€ç»Ÿå¤©ä¸‹éšåè”å‘ç§‘ä¹Ÿæ¨å‡ºè‡ªå·±çš„Pump Expressï¼ˆPEï¼‰å’Œåæ¥çš„Pump Express Plusï¼ˆPEPï¼‰å¿«å……ï¼Œè€Œé­…æ—çš„mChargeå¿«å……å°±æ˜¯åŸºäºæ­¤ï¼Œåä¸ºæ—©æœŸæ¨å‡ºäº†Fast Charge Protocolï¼ˆfspï¼‰å¿«å……ï¼Œå›½é™…å·¨å¤´ä¸‰æ˜Ÿä¹Ÿæœ‰è‡ªå·±çš„AFCï¼ˆAdaptive Fast Chargingï¼‰å¿«å……ï¼Œè€Œå°ç±³å’ŒåŠªæ¯”äºšç­‰ä¸€ä¼—ä½¿ç”¨é«˜é€šSoCä½œä¸ºè‡ªå·±æ——èˆ°æ‰‹æœºSoCçš„å‚å•†ä¹Ÿæ˜¯ä½¿ç”¨çš„é«˜é€šçš„QCå¿«å……ã€‚ä»¥ä¸Šæåˆ°çš„è¿™äº›éƒ½æ˜¯ä½¿ç”¨çš„é«˜å‹å¿«å……æ–¹æ¡ˆã€‚ å½“ç„¶ä½å‹å¤§ç”µæµæ–¹æ¡ˆè¿™è¾¹ä¹Ÿä¸æ˜¯æ²¡æœ‰æ´å†›ï¼Œæ¯”å¦‚è¯´ä¸€åŠ ã€‚ä¸€åŠ CEOåˆ˜ä½œè™ä½œä¸ºOPPOå‰é«˜ç®¡ï¼Œå°½ç®¡ä¸€åŠ ä½¿ç”¨çš„æ˜¯é«˜é€šçš„SoCï¼Œä½†æ˜¯åœ¨ä¸€åŠ æ¨å‡ºè‡ªå·±çš„å¿«å……æ–¹æ¡ˆæ—¶ï¼Œè¿˜æ˜¯é€‰æ‹©äº†ä½å‹å¤§ç”µæµæ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ä¸€åŠ Dashé—ªå……ã€‚ çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯è§‰å¾—é«˜å‹å¿«å……æ–¹æ¡ˆå·²ç»èµ¢å¾—äº†èƒœåˆ©ï¼Œä½å‹æ–¹æ¡ˆåªèƒ½åœ¨ä¸€æ—è‹Ÿå»¶æ®‹å–˜ï¼Ÿ å½“ç„¶ä¸æ˜¯ï¼äº‹æƒ…åœ¨2016å¹´å‘ç”Ÿäº†è½¬å˜ã€‚ 2016å¹´ï¼ŒType-Cæ¥å£å·²ç»æ™®åŠå¾—ä¸ƒä¸ƒå…«å…«äº†ï¼Œå®‰å“æ——èˆ°æ‰‹æœºåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨è¿™ç§æ¥å£ï¼Œè¿™å°±ä¸ºä½å‹æ–¹æ¡ˆçš„ç¿»èº«æä¾›äº†æœ‰åˆ©æ¡ä»¶ã€‚ï¼ˆå°½ç®¡Type-Cæ¥å£æ”¯æŒå¤§ç”µæµï¼Œä½†æ˜¯å…¶çº¿æä¾æ—§æ¯”è¾ƒç²—ï¼‰ è¿™ä¸€å¹´ï¼Œåä¸ºæ”¹å˜äº†å¿«å……æ–¹æ¡ˆï¼Œæ¨å‡ºäº†è‡ªå®¶çš„å¦ä¸€ç±»å¿«å……ï¼ˆscpï¼‰ï¼Œå…¨ç§°Super Charge Protocolï¼Œæ­è½½çš„æœºå‹æœ‰è£è€€Magicã€Mate9å’ŒP10/plusï¼Œä½¿ç”¨çš„æ˜¯4.5V/5Açš„ä½å‹å¤§ç”µæµæ–¹æ¡ˆã€‚ è€Œè”å‘ç§‘è¿™è¾¹çš„PEPå¿«å……ï¼Œä¹Ÿè½¬æŠ•äº†ä½å‹æ–¹æ¡ˆï¼Œé­…æ—æœ€æ–°å‘å¸ƒçš„æ——èˆ°Pro7 Plusæ­è½½çš„mCharge4.0ä¹Ÿæ˜¯ä½¿ç”¨äº†ä½å‹æ–¹æ¡ˆï¼Œæ—©å‰çš„mCharge3.0å±äºé«˜å‹å¿«å……æ–¹æ¡ˆï¼ˆ24Wï¼‰ï¼Œå……ç”µå™¨è¾“å‡ºç”µå‹æœ€é«˜å¯è¾¾12Vï¼›è€ŒmCharge4.0ï¼ˆ25Wï¼‰å±äºä½å‹å¤§ç”µæµæ–¹æ¡ˆï¼Œå……ç”µå™¨è¾“å‡ºç”µå‹5Vï¼Œç”µæµå¯è¾¾5Aã€‚ åŠªæ¯”äºšä¹Ÿæ¨å‡ºäº†è‡ªå®¶çš„å¿«å……æ–¹æ¡ˆï¼Œåä¸ºNeoChargeï¼Œä½¿ç”¨çš„æ˜¯5V/5.2Açš„26Wä½å‹å¤§ç”µæµå¿«å……æ–¹æ¡ˆï¼Œæ­è½½åœ¨åŠªæ¯”äºš2017å¹´å‘å¸ƒçš„M2ä¸Šã€‚ è‡³äºå°ç±³â€¦â€¦é¢â€¦â€¦å¥½åƒæ²¡æœ‰ä½å‹å¿«å……æ–¹æ¡ˆï¼Œç›®å‰å·²æœ‰çš„æ¾æ¹ƒS1ä¸Šæ­è½½æœ‰9V/2Açš„18Wçš„æ¾æ¹ƒå¿«å……ï¼Œæ˜¯å…¸å‹çš„é«˜å‹å¿«å……æ–¹æ¡ˆã€‚ä¸çŸ¥é“æ¾æ¹ƒS2ä¼šä¸ä¼šç»™æˆ‘ä»¬å¸¦æ¥æƒŠå–œå‘¢ï¼Ÿ å†è¯´è¯´é«˜é€šï¼Œé«˜é€šä¼¼ä¹ä¹Ÿå‘ç°äº†ä½å‹æ–¹æ¡ˆçš„ä¼˜åŠ¿ï¼Œåœ¨æœ€æ–°çš„QC4å¿«å……ä¸Šï¼Œä¹Ÿä½¿ç”¨äº†ä½å‹å¤§ç”µæµæ–¹æ¡ˆï¼Œä¸è¿‡äºæ­¤åŒæ—¶ä¹Ÿè¿˜æ”¯æŒç€é«˜å‹å¿«å……æ–¹æ¡ˆã€‚ å°½ç®¡ç›®å‰ä½å‹å¤§ç”µæµæ–¹æ¡ˆå·²ç»åŸºæœ¬ç»Ÿæ²»äº†å¿«å……ï¼Œä½†æ˜¯å„å®¶çš„å¿«å……åè®®äº’ä¸å…¼å®¹ï¼Œå¯ä»¥è¯´ç»™æ¶ˆè´¹è€…å¸¦æ¥äº†å¾ˆå¤§çš„è‹¦æ¼ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œåˆåˆ°USB IFåä¼šå‡ºåœºäº†ã€‚ USB IFåä¼šä¹‹å‰å½“ç„¶ä¹Ÿæ²¡æœ‰é—²ç€ï¼Œå‘å¸ƒäº†åŸºäºUSB 3.1ä¸­Type-Cæ¥å£çš„USB Power Deliveryï¼ˆç®€ç§°USB PDï¼‰çš„å……ç”µæ ‡å‡†ï¼Œæœ€é«˜å¯ä»¥æä¾›100Wï¼ˆ20V/5Aï¼‰çš„å……ç”µåŠŸç‡ï¼Œæ—¨åœ¨ç»Ÿä¸€ä¾¿æºç§»åŠ¨è®¾å¤‡çš„å……ç”µæ ‡å‡†ã€‚USB IFçš„æ¢¦æƒ³æ˜¯ç¾å¥½çš„ï¼Œåªæ˜¯ç°å®å¾€å¾€æ¯”è¾ƒæ®‹é…·ã€‚å„å®¶å‚å•†è‡ªå·±åšæ‰‹æœºï¼Œå†åšå¿«å……æ ‡å‡†ï¼Œå½“ç„¶éƒ½æ˜¯é¦–é€‰è‡ªå®¶çš„å¿«å……åè®®ï¼ŒUSB PDæ ‡å‡†ä¹Ÿå°±è¢«æ™¾åˆ°äº†ä¸€è¾¹ã€‚ ä½†æ˜¯æ¢¦æƒ³è¿˜æ˜¯è¦æœ‰çš„ï¼Œä¸‡ä¸€å®ç°äº†å‘¢ï¼Ÿ è¦çŸ¥é“ï¼ŒUSB IFåä¼šçš„èƒŒæ™¯å¯ä¸å¼±ï¼ˆéƒ½æ˜¯è¡Œä¸šå·¨å¤´è”åˆæˆç«‹çš„ï¼‰ï¼Œè€Œè°·æ­Œå®˜æ–¹ä¹Ÿæ˜¯è¡¨ç¤ºå®‰å“ä¸€å®šè¦æ”¯æŒUSB PDåè®®ï¼Œä¸è¦ä¹±æäº›æœ‰çš„æ²¡çš„å¿«å……åè®®ã€‚åŠ ä¸ŠUSB IFåä¼šç§¯æä¸å„å›½ä»¥åŠå„ä¸ªé«˜ç«¯å®éªŒå®¤æ²Ÿé€šï¼Œå…¶æœ€æ–°å‘å¸ƒçš„USB PD3.0å·²ç»æˆåŠŸæ”¶ç¼–é«˜é€šçš„QC4å¿«å……åè®®ï¼Œè‡³æ­¤ï¼Œé«˜é€šQCã€è”å‘ç§‘PEPã€åä¸ºfcpã€scpï¼ŒOPPOçš„VOOCç­‰å¿«å……åè®®åŸºæœ¬è¢«USB PD3.0æ”¶çº³ã€‚è€Œå‚å•†æ—¥åç ”å‘è‡ªå·±çš„å¿«å……æŠ€æœ¯ï¼Œåªè¦åŸºäºUSB PDçš„åè®®å³å¯ã€‚USB PDåè®®æœ‰æœ›ä¸€ç»Ÿæ±Ÿæ¹–ã€‚ â–²å›¾ä¸ºUSB PD3.0åè®® ä½†æ˜¯ï¼Œå°½ç®¡å‰é€”ä¸€ç‰‡å…‰æ˜ï¼Œé“è·¯è¿˜æ˜¯ä¸€ç‰‡å´å²–ï¼Œå¿«å……å¤§ä¸€ç»Ÿï¼Œè¿˜æ˜¯æœ‰ä¸çŸ­çš„è·¯è¦èµ°ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"}]},{"title":"ç‹å¿—ä¸œå’Œæ–°æµª","slug":"20170810-wzd-n-sina","date":"2017-08-10T07:00:00.000Z","updated":"2017-08-10T07:00:00.000Z","comments":true,"path":"20170810-wzd-n-sina/","link":"","permalink":"https://tinychen.com/20170810-wzd-n-sina/","excerpt":"è¯´èµ·æ–°æµªï¼Œå¤§å®¶ç¬¬ä¸€ååº”å¯èƒ½å°±æ˜¯å¾®åšã€‚æ²¡é”™ï¼Œå¾®åšå¦‚ä»Šåœ¨å›½å†…ç¡®å®æœ‰ç€ä¸¾è¶³è½»é‡çš„å½±å“ï¼Œä½†æ˜¯è°åˆèƒ½æƒ³åˆ°ï¼Œåœ¨17å¹´å‰ï¼Œè¿™å®¶å…¬å¸è¿˜å› ä¸ºäº’è”ç½‘å±æœºè€Œè§£é›‡äº†èº«ä¸ºCEOçš„åˆ›å§‹äººï¼Œå¹¶å…å»å…¶è‘£äº‹èº«ä»½ã€‚è€Œè¿™ä¸ªé­é‡äº†ä¹”å¸ƒæ–¯è€çˆ·å­é‚£èˆ¬è¢«æ‰«åœ°å‡ºé—¨çš„å„è¿ä¹‹åï¼Œå†ä¹Ÿæ²¡èƒ½å›åˆ°è‡ªå·±åˆ›åŠçš„å…¬å¸ã€‚","text":"è¯´èµ·æ–°æµªï¼Œå¤§å®¶ç¬¬ä¸€ååº”å¯èƒ½å°±æ˜¯å¾®åšã€‚æ²¡é”™ï¼Œå¾®åšå¦‚ä»Šåœ¨å›½å†…ç¡®å®æœ‰ç€ä¸¾è¶³è½»é‡çš„å½±å“ï¼Œä½†æ˜¯è°åˆèƒ½æƒ³åˆ°ï¼Œåœ¨17å¹´å‰ï¼Œè¿™å®¶å…¬å¸è¿˜å› ä¸ºäº’è”ç½‘å±æœºè€Œè§£é›‡äº†èº«ä¸ºCEOçš„åˆ›å§‹äººï¼Œå¹¶å…å»å…¶è‘£äº‹èº«ä»½ã€‚è€Œè¿™ä¸ªé­é‡äº†ä¹”å¸ƒæ–¯è€çˆ·å­é‚£èˆ¬è¢«æ‰«åœ°å‡ºé—¨çš„å„è¿ä¹‹åï¼Œå†ä¹Ÿæ²¡èƒ½å›åˆ°è‡ªå·±åˆ›åŠçš„å…¬å¸ã€‚ è¿™ä¸ªäººï¼Œå°±æ˜¯ç‹å¿—ä¸œã€‚ 1ã€èä¸­å­¦éœ¸ï¼ŒåŒ—å¤§æ‰å­è®©æˆ‘ä»¬æŠŠæ—¶é—´çš„æŒ‡é’ˆæ‹¨å›äº”åå¹´å‰ã€‚ 1967å¹´ï¼Œé‚£æ—¶ï¼Œæ–‡é©æ‰åˆšåˆšå¼€å§‹ï¼Œå›½å®¶çš„ç»æµè¿˜æ˜¯ä¸€ç‰‡è’èŠœã€‚åœ¨å¹¿ä¸œè™é—¨çš„ä¸€ä¸ªå°å†œæ‘é‡Œï¼Œéšç€å©´å„¿çš„å•¼å“­å£°å“èµ·ï¼Œè¿™ä¸ªä¸–ç•Œåˆè¿æ¥äº†ä¸€ä¸ªæ–°ç”Ÿå‘½ã€‚ ç‹å¿—ä¸œçš„å°‘å¹´æ—¶æœŸï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å›°éš¾äº†ã€‚ä¸è¿‡å¥½åœ¨çˆ¶æ¯ä¸¤äººéƒ½æ˜¯æ•™å¸ˆï¼Œå®¶é‡Œä½çš„æ˜¯å•ä½çš„æˆ¿ï¼Œè™½ç„¶ä¸å¯èƒ½æ¯é¡¿éƒ½æœ‰è‚‰åƒï¼Œä½†æ˜¯èµ¶ä¸Šè¿æ°”å¥½çš„æ—¶å€™ï¼Œæ€åªé¸­å­ï¼Œå…¨å®¶äººå¯ä»¥åƒä¸¤æ˜ŸæœŸã€‚è‡³äºé‚£äº›é«˜æ¡£çš„ç”Ÿæ´»ç”¨å“ï¼Œå°±æ›´åŠ ä¸å¯æƒ³è±¡äº†ã€‚ æ¡å—ç –å¤´ï¼Œæ‹¾ä¸ªæœ¨å—ï¼Œè¿™å°±æ˜¯ç‹å¿—ä¸œå°æ—¶å€™çš„ç©å…·ã€‚å®¶é‡Œåªèƒ½ç»™ä»–ä¸€ä¸ªæ”¾ç“¶ç“¶ç½ç½çš„å°æŸœå­ï¼Œæ¯•ç«Ÿé™¤äº†ä»–ï¼Œè¿˜æœ‰ä¸‰ä¸ªå­©å­ã€‚ å¹¼å¹´çš„è‰°è‹¦å¹¶æ²¡æœ‰å½±å“åˆ°ä»–çš„å­¦ä¸šï¼Œå°å­¦æ—¶å°±å› ä¸ºè¿è·³ä¸¤çº§å‡å…¥åˆä¸­ï¼Œè€Œè·å¾—å­¦æ ¡çš„ç‰¹è®¸ï¼Œèƒ½è‡ªç”±è¿›å…¥å­¦æ ¡çš„å›¾ä¹¦é¦†ã€‚çˆ¶äº²ä¹Ÿå› æ­¤å¥–åŠ±äº†ä»–ä¸€ä¸ªä»–æ¢¦å¯ä»¥æ±‚çš„ç”µçƒ™é“ï¼Œè¿™åœ¨ç‹å¿—ä¸œçš„æ— çº¿ç”µç”Ÿæ¶¯ä¸­ï¼Œå¯è°“æ˜¯æµ“å¢¨é‡å½©çš„ä¸€ç¬”ã€‚ åœ¨å°±è¯»ä¸œèä¸­å­¦ï¼ˆé«˜ä¸­ï¼‰æ—¶ï¼Œä»–ä¸ä»…å‚åŠ äº†å­¦æ ¡çš„æ— çº¿ç”µå…´è¶£ç­ï¼Œåæ¥è¿˜å› è®¾è®¡äº†ä¸€ç§æ•™å­¦æ¼”ç¤ºç”¨çš„é«˜é˜»ç”µå‹è¡¨è€Œè·å¾—äº†ä¸€ä¸ªæ•™å­¦ä»ªå™¨æ¯”èµ›çš„ç¬¬ä¸€åã€‚ 1984å¹´ï¼Œç‹å¿—ä¸œè€ƒå…¥äº†åŒ—å¤§æ— çº¿ç”µç³»ã€‚è¿™åœ¨å½“æ—¶ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å‰å®³äº†ã€‚ è€Œç‹å¿—ä¸œç¬¬ä¸€æ¬¡æ¥è§¦è®¡ç®—æœºï¼Œå°±æœ‰ç‚¹æ„æ€äº†ã€‚ å½“æ—¶åˆšå…¥æ ¡ï¼Œå­¦æ ¡ç»„ç»‡æ–°ç”Ÿå‚è§‚æœºæˆ¿ï¼Œè€å¸ˆä¸€è¾¹æ¼”ç¤ºä¸€è¾¹é—®æœ‰è°å­¦è¿‡ã€‚åœ¨å½“æ—¶çš„ä¸­å›½è®¡ç®—æœºå¯è¿˜æ˜¯ç¨€ç½•ç‰©ä»¶å„¿ï¼Œå‡ºèº«è´«å›°çš„ç‹å¿—ä¸œèº«å¤„åœ¨ä¸œèè¿™æ ·çš„å°åŸå¸‚ï¼ˆå½“æ—¶ï¼‰ï¼Œè‡ªç„¶æ˜¯æ²¡æœ‰è§è¿‡çš„ã€‚ä½†èº«è¾¹å¥½å‡ ä¸ªåŒ—äº¬ä¸Šæµ·çš„åŒå­¦éƒ½è¯´å­¦è¿‡ï¼Œç‹å¿—ä¸œä¸çŸ¥å’‹æ»´å°±è·Ÿç€è¯´å­¦è¿‡ã€‚è€Œä»–åˆæ­£å¥½ç«™åœ¨å‰é¢ï¼Œè€å¸ˆå°±è®©ä»–ä¸Šå»æ“ä½œä¸€ä¸‹ã€‚ä¹‹åå°±æ˜¯è„¸çº¢è„–å­ç²—ï¼Œä»€ä¹ˆéƒ½ä¸çŸ¥é“äº†ã€‚ è¿™ä»¶äº‹ä¸ä½†æ²¡æœ‰æ‰“å‹ç‹å¿—ä¸œçš„æ–—å¿—ï¼Œåè€Œæ¿€èµ·äº†ä»–ä¸æœè¾“çš„ç²¾ç¥ã€‚è‡ªå­¦ä¸€ä¸ªæœˆåï¼Œç‹å¿—ä¸œä»¥ä¸é”™çš„æˆç»©æå‰è€ƒè¯•å¹¶é€šè¿‡è¿™é—¨è¯¾ç¨‹ã€‚åœ¨è®©è€å¸ˆæƒŠè®¶ä¹‹ä½™ï¼Œä¹Ÿå¾—åˆ°äº†è€å¸ˆçš„é‡è§†ã€‚ 1987å¹´ï¼Œç‹å¿—ä¸œè¿˜æ²¡æ¯•ä¸šï¼Œä½†æ˜¯å´å·²ç»åˆ©ç”¨è¯¾ä½™æ—¶é—´åˆ°ä¸­å…³æ‘æäº›å°ä¹°å–ã€‚ è¸ä¸Šä¸­å…³æ‘è¿™ç‰‡å­•è‚²äº†ä¸­å›½äº’è”ç½‘é›å½¢çš„åœŸåœ°ï¼Œæœ¬ä»¥ä¸ºåœ¨å­¦æ ¡å­¦å¾—å·®ä¸å¤šçš„ç‹å¿—ä¸œæ„Ÿè§‰æ‰¾åˆ°äº†ç¬¬äºŒä¸ªå¤§å­¦ã€‚ä»–è¿›å…¥äº†ä¸€å®¶å°å…¬å¸ï¼Œä¸€ä¸ªäººä»å¤´æ‹¼åˆ°å°¾ï¼Œæ‹‰å®¢æˆ·ã€è°ˆåˆ¤ã€è®²ä»·ã€ç­¾åˆåŒã€è£…è´§ã€è°ƒè¯•ã€é…è½¯ä»¶ã€åŸ¹è®­ã€æ”¶è´¹éƒ½è¦è‡ªå·±æ¥ã€‚è€Œæ­£æ˜¯è¿™äº›åœ¨ä»–çš„åŒå­¦çœ¼é‡Œçœ‹æ¥â€œä¸æå­¦é—®ã€èµšç‚¹å°é’±ã€ç‰¹ä¿—â€çš„ç»å†ï¼Œç»™ä»–åœ¨å®¢æˆ·ã€åŒè¡Œå’ŒæŠ€æœ¯ç­‰æ–¹é¢å¤¯å®äº†åŸºç¡€ã€‚ æ¯•ä¸šä¹‹åï¼Œç‹å¿—ä¸œåœ¨æ–¹æ­£å’Œæ–°å¤©åœ°å…¬å¸å¾…äº†ä¸€æ®µæ—¶å€™ï¼Œæœ€åè¿›å…¥äº†å››é€šé›†å›¢ï¼Œæˆä¸ºäº†å››é€šåˆ©æ–¹å…¬å¸çš„æ€»ç»ç†ã€‚ è€Œå››é€šåˆ©æ–¹ï¼Œæ­£æ˜¯æ–°æµªçš„å‰èº«ä¹‹ä¸€ã€‚ 2ã€ç½‘æ™¯ä¸Šå¸‚ï¼Œæ³¡æ²«åˆæ˜¾1995å¹´8æœˆ9æ—¥ï¼Œç¡…è°·ä¸€å®¶åˆ›å§‹èµ„é‡‘åªæœ‰å››ç™¾ä¸‡ç¾å…ƒçš„å°å…¬å¸â€”â€”ç½‘æ™¯ï¼Œåœ¨åå°”è¡—ä¸Šå¸‚çš„å‡ ä¸ªå°æ—¶åï¼Œç¬é—´æˆä¸ºäº†äºŒåäº¿ç¾å…ƒçš„å·¨äººã€‚ç½‘æ™¯çš„ä¸Šå¸‚ï¼Œç¬é—´å¼•çˆ†äº†ç¾å›½å¤§ä¼—å’Œåå°”è¡—ã€‚é€šç”¨åŠ¨åŠ›å…¬å¸èŠ±äº†å››åä¸‰å¹´æ‰ä½¿å¸‚å€¼è¾¾åˆ°äºŒåä¸ƒäº¿ç¾å…ƒï¼Œè€Œç½‘æ™¯ï¼Œåªç”¨äº†ä¸€åˆ†é’Ÿã€‚ ç¾å›½è®¡ç®—æœºå†å²åšç‰©é¦†ç­–å±•äººé©¬å…‹Â·éŸ¦ä¼¯å¦‚æ˜¯è¯´é“ã€‚ â€œç½‘æ™¯å…¬å¸çš„ä¸Šå¸‚è¯æ˜ï¼Œä¸€ä¸ªåŸºäºä¸‡ç»´ç½‘çš„å…¬å¸ï¼Œå¯ä»¥å¼•èµ·å•†ç•Œçš„é‡è§†ï¼Œè¿™æ˜¯äº’è”ç½‘ç¹è£çš„å¼€å§‹ã€‚â€ ç½‘æ™¯ä¸€å¤œå´›èµ·çš„ç¥è¯ï¼Œå†åŠ ä¸Šå½“æ—¶é›…è™çš„æˆåŠŸï¼Œæ¨è‡´è¿œæˆä¸ºæ–°ç¾å›½æ¢¦çš„è±¡å¾ï¼Œäº’è”ç½‘æŠ€æœ¯ç¬¬ä¸€æ¬¡å‘ä¸–äººå±•ç°å‡ºæƒŠäººé€Ÿåº¦ä¸åºå¤§è§„æ¨¡ï¼Œæ•´ä¸ªç¡…è°·éƒ½ä¸ºäº’è”ç½‘è€Œç–¯ç‹‚ã€‚ åœ¨äº’è”ç½‘çš„é£“é£ä¸­ï¼Œæ•´ä¸ªç¡…è°·éƒ½å¿™å¾—äººä»°é©¬ç¿»ï¼Œè„‘å­ä¹Ÿæ²¡åŠæ³•å†ç†æ€§åœ°æ€è€ƒäº†ï¼Œå¾ˆå¤šäººéƒ½å¤±å»äº†æ–¹å‘ã€‚æœæ•¢ä¸ç†æ€§è‘—ç§°çš„é£é™©æŠ•èµ„å®¶ä»¬ï¼Œåœ¨è¿™è‚¡å‰æ‰€æœªæœ‰çš„æ°”æ°›ä¸­ï¼Œå˜å¾—ç›²ç›®è€Œç–¯ç‹‚ã€‚ â€œæˆ‘æƒ³ä¸Šå¸‚ï¼Œåƒè‹¹æœçš„ä¹”å¸ƒæ–¯ä¸€æ ·ã€‚â€œç‹å¿—ä¸œè¯´ã€‚ â€œä½ ç°åœ¨æ²¡åŠæ³•ä¸Šå¸‚ï¼Œè¦ç»è¿‡å‡ ä¸ªæ­¥éª¤ï¼šè°ƒæ•´ä¸šåŠ¡æ–¹å‘ã€ç®¡ç†æ¶æ„ã€èèµ„ç­‰ç­‰ã€‚â€æ‘©æ ¹æ–¯å¦åˆ©é“¶è¡Œçš„ä¸€ä½è‘£äº‹æ€»ç»ç†å›åº”ã€‚ â€œé‚£ä½ ä»¬èƒ½å¸®æˆ‘å—ï¼Ÿâ€ç‹å¿—ä¸œé—®ã€‚ â€œä½ çš„å…¬å¸è¯·ä¸èµ·æˆ‘ä»¬ï¼â€å¯¹æ–¹ç­”é“ã€‚ è¿™æ˜¯1995å¹´7æœˆå‘ç”Ÿçš„ä¸€å¹•ï¼Œå½“æ—¶ç‹å¿—ä¸œæ­£èµ´ç¾å¯»æ±‚é£é™©æŠ•èµ„ã€‚è€Œæ‘©æ ¹æ–¯å¦åˆ©é“¶è¡Œå°±æ˜¯å¸®åŠ©ç½‘æ™¯æˆåŠŸä¸Šå¸‚çš„é‚£å®¶æŠ•è¡Œã€‚ 1995å¹´åº•ï¼Œç‹å¿—ä¸œåº”IBMé‚€è¯·ï¼Œç¬¬ä¸‰æ¬¡è®¿ç¾ã€‚ å‰ä¸¤æ¬¡è®¿ç¾ï¼Œæ¯æ¬¡ä»–éƒ½è¦å¸¦ä¸€å¤§ç®±å­çš„ç§‘æŠ€æ‚å¿—ï¼Œä»–ç”šè‡³è¿˜æƒ³åœ¨ç¡…è°·è®¾ç«‹ä¸€ä¸ªåŠäº‹å¤„ï¼Œè¿™æ ·ä¾¿èƒ½æœ‰ä¸€ä¸ªèƒ½å¤Ÿäº†è§£ä¸–ç•Œçš„é€šé“ã€‚ä½†æ˜¯äº’è”ç½‘æ”¹å˜äº†ä»–çš„æƒ³æ³•ã€‚ ç¬¬ä¸‰æ¬¡è®¿ç¾æ—¶ï¼Œç‹å¿—ä¸œç”¨ä¸€ä¸ªå­˜è´®åœ¨ä¸€ä¸ªé™„åœ¨ç§‘æŠ€æ‚å¿—å°åº•çš„è½¯ç›˜ä¸­çš„ä¸Šç½‘è´¦å·ï¼Œåœ¨ç¾å›½é…’åº—çš„æˆ¿é—´é‡Œåˆ©ç”¨ç”µè¯çº¿ç¬¬ä¸€æ¬¡è¿ä¸Šäº†ç½‘ç»œã€‚ç‹å¿—ä¸œå½“æ—¶å°±æ„è¯†åˆ°ï¼šè¿™æ ·çš„æŠ€æœ¯ä¸€æ—¦è¢«æ¨å¹¿å¼€æ¥ï¼Œäººä»¬çŒå–ä¿¡æ¯çš„é€Ÿåº¦ã€æ•°é‡å’Œä¾¿æ·æ€§ï¼Œéƒ½ä¼šå‘ˆç°çˆ†ç‚¸æ€§çš„å¢é•¿ã€‚å°±åƒç›¸å¯¹è®ºé‡Œæåˆ°çš„â€˜è™«æ´â€™ä¸€æ ·ï¼Œæ—¶é—´ä¸ç©ºé—´çš„è·ç¦»å¯ä»¥è¢«ç¬é—´ç©¿é€ï¼Œè€Œè¿™ä¸€æµ©å¤§çš„å·¥ç¨‹ä¸€æ—¦å±•å¼€ï¼Œè‡ªç„¶ä¼šå¸¦æ¥æ— é™å•†æœºï¼ è‹±ç‰¹å°”åˆ›å§‹äººä¹‹ä¸€çš„å®‰è¿ªÂ·æ ¼ç½—å¤«æ›¾è¯´ï¼š â€œèƒ½å¤Ÿè¯†åˆ«é£å‘çš„è½¬å˜ï¼Œå¹¶åŠæ—¶é‡‡å–æ­£ç¡®çš„è¡ŒåŠ¨ä»¥é¿å…æ²‰èˆ¹ï¼Œå¯¹äºä¸€ä¸ªä¼ä¸šçš„æœªæ¥æ˜¯è‡³å…³é‡è¦çš„ã€‚â€ åœ¨æ¥è§¦äº†äº’è”ç½‘ä¹‹åï¼Œä»åœ¨æ–¹æ­£åšç¨‹åºå‘˜å¼€å§‹å°±åœ¨åšä¸­æ–‡å¹³å°çš„ç‹å¿—ä¸œå¯¹äºè½¯ä»¶æŠ€æœ¯çš„æƒ³æ³•å‘ç”Ÿäº†è£‚å˜ã€‚ä»–è®¤ä¸ºï¼Œå¦‚æœæŠŠè½¯ä»¶å’Œäº’è”ç½‘ç»“åˆèµ·æ¥ï¼Œå°†åœ¨ä¸€ä¸ªæ–°çš„å¹³å°ä¸Šäº§ç”Ÿä¸€ç³»åˆ—æ–°çš„åº”ç”¨ï¼Œè¿™å°±æ˜¯ä¸‹ä¸€ä¸ªé£å£ã€‚ äº‹å®è¯æ˜äº†ç‹å¿—ä¸œçš„é¢„åˆ¤æ˜¯æ­£ç¡®çš„ã€‚ä»Šå¤©ï¼Œé‚£æ€•åªæ˜¯ä½ æ‰‹æœºä¸Šçš„ä¸€ä¸ªè®¡ç®—å™¨APPï¼Œéƒ½å¯èƒ½éœ€è¦è”ç½‘è·å–æ±‡ç‡ä¿¡æ¯æ¥å¸®åŠ©ä½ å®Œæˆè´§å¸è½¬æ¢ã€‚ è€Œå½“æ—¶çš„ç‹å¿—ä¸œè®¤ä¸ºï¼šäº’è”ç½‘ä¼šç»™ä»–ä»¬å¸¦æ¥ä¸€ä¸ªå…¨æ–°çš„æ¸¸æˆè§„åˆ™â€”â€”ä»–ä»¬æœ‰å¯èƒ½å»æ‰“ç ´æ—§çš„ä½“ç³»ã€‚ä¸­å›½ITä¸šæ€ä¹ˆåšéƒ½æ˜¯åœ¨å¾®è½¯çš„é˜´å½±ä¸‹ï¼Œå°±æ˜¯æŠŠå¾®è½¯æ‹¿èµ°è¿˜æœ‰å…¶ä»–å…¬å¸ï¼Œä½œä¸ºä¸€ä¸ªåæ¥è€…ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ç­‰æ–°çš„æ¸¸æˆè§„åˆ™å‡ºæ¥çš„æ—¶å€™ï¼Œè‡ªå·±å’Œç«äº‰å¯¹æ‰‹éƒ½ç«™åœ¨åŒä¸€èµ·è·‘çº¿ä¸Šï¼Œå„è‡ªçš„ä¼˜åŠ¿ä¹Ÿå°±å‘æŒ¥å‡ºæ¥äº†ã€‚ 1996å¹´4æœˆ29æ—¥ï¼Œå››é€šåˆ©æ–¹çš„ www.srsnet.com ä¸­æ–‡ç½‘ç«™æ­£å¼å¼€é€šã€‚ å››é€šåˆ©æ–¹æƒ³æˆä¸ºåäººé¦–é€‰èµ„è®¯ç½‘ç«™çš„æ„æƒ³æ¸æ¸æµ®ç°å‡ºæ¥ã€‚ 3ã€å››é€šåæ¸Šï¼Œæ–°æµªé¢ä¸–â€œå½“æ—¶ç‰¹åˆ«æ‹…å¿ƒï¼Œè¿™è¦æ˜¯åµç¿»äº†ï¼Œäººå®¶ä¸€ç”Ÿæ°”ä¸å¼€è½¦é€æˆ‘ï¼Œææ€•å°±è¦ä¸€ä¸ªäººå®¢æ­»åœ¨ç¾åˆ©åšæ–°å¤§é™†äº†ã€‚â€ åœ¨å›å¿†å½“æ—¶è‡ªå·±èµ´ç¾å’Œåæ¸Šç½‘è°ˆåˆ¤åˆå¹¶äº‹é¡¹æ—¶ï¼Œç‹å¿—ä¸œè°ƒä¾ƒé“ã€‚ å½“æ—¶ï¼Œå››é€šåˆ©æ–¹æƒ³æˆä¸ºåäººé¦–é€‰èµ„è®¯ç½‘ç«™ï¼Œåæ¸Šç½‘ï¼ˆSinanetï¼‰æ˜¯ä¸€ä¸ªä¸å¾—ä¸é¢å¯¹çš„å¼ºåŠ²å¯¹æ‰‹ã€‚ä½†æ˜¯ï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œå››é€šå’Œåæ¸Šå°½ç®¡éƒ½çœ‹å¯¹æ–¹ä¸è¿‡çœ¼ï¼Œæƒ³è¦æ¶ˆç­æ‰å¯¹æ–¹ï¼Œä½†å´è°éƒ½æ²¡æœ‰è¿™ä¸ªèƒ½åŠ›æŠŠå¯¹æ–¹åƒä¸‹ã€‚ 98å¹´9æœˆï¼Œç‹å¿—ä¸œå’Œåæ¸Šç½‘CEOå§œä¸°å¹´åœ¨åŒ—äº¬ä¼šé¢ï¼Œ30åˆ†é’Ÿåï¼Œå§œä¸°å¹´è¿«ä¸åŠå¾…åœ°æå‡ºäº†åˆå¹¶çš„æƒ³æ³•ï¼Œè€Œç‹å¿—ä¸œä¹Ÿè¡¨ç¤ºä¸æ’é™¤ä»»ä½•å½¢å¼çš„åˆä½œã€‚ å®é™…ä¸Šï¼Œå½“æ—¶å æœ‰ä¸­å›½å¤§é™†å¸‚åœºçš„å››é€šæƒ³è¦è¿›å†›ç¾å›½å’Œå°æ¹¾å¸‚åœºï¼Œè€Œå æœ‰ç¾å›½å¸‚åœºçš„åæ¸Šç½‘æƒ³è¦è¿›å†›ä¸­å›½å¤§é™†å¸‚åœºï¼Œç‹­è·¯ç›¸é€¢ï¼Œä¸¤è€…å¿…æœ‰ä¸€æˆ˜ã€‚æ›´ä½•å†µæ—è¾¹è¿˜æœ‰ç€è™è§†çœˆçœˆï¼Œéšæ—¶å¯èƒ½æ€å…¥å±€çš„é›…è™ã€‚ å°½ç®¡åœ¨åˆå¹¶è°ˆåˆ¤è¿‡ç¨‹ä¸­æ³¢æŠ˜é‡é‡ï¼Œä½†æ˜¯ç‹å¿—ä¸œè¿˜æ˜¯å‡­å€Ÿç€ä¸­å›½å¤§é™†å¸‚åœºå·¨å¤§çš„æ½œåŠ›ï¼Œä½¿å¾—åˆå¹¶æ–¹æ¡ˆæŒ‰ç…§ä»–çš„è®¾æƒ³è¿›è¡Œã€‚ å¹¿å‘Šå¤§å¸ˆå…‹åŠ³å¾·Â·éœæ™®é‡‘æ›¾è¯´ï¼šæ°å½“çš„åç§°æœ¬èº«å°±æ˜¯å¹¿å‘Šã€‚ è€Œæ–°æµªï¼Œæ­£æ˜¯å¦‚æ­¤ã€‚ åˆå¹¶åçš„ç½‘ç«™è‹±æ–‡åç¡®å®šä¸ºSinaï¼Œè€Œå½“æ—¶çš„å‘˜å·¥åˆ™æ ¹æ®éŸ³è¯‘ç¡®å®šä¸­æ–‡åä¸ºâ€œèµ›è¯ºç‹â€œã€‚å½“æ—¶å°åˆ·å“å³å°†äº¤ä»˜å°åˆ·ï¼Œè€Œç‹å¿—ä¸œå´å¯¹å§œä¸°å¹´è¯´ï¼šâ€œç­‰ä¸€ä¸‹ï¼Œæ˜å¤©æˆ‘ç»™ä½ å›éŸ³ã€‚â€ç¬¬äºŒå¤©ï¼Œä»–å‘Šè¯‰å¯¹æ–¹ä¸€ä¸ªåç§°ï¼šæ–°æµªã€‚ 4ã€æ–°æµªæ¨¡å¼ï¼Œèµ´ç¾ä¸Šå¸‚1999å¹´ï¼Œæ–°æµªã€æœç‹ã€ç½‘æ˜“ç­‰ä¸­å›½ç¬¬ä¸€æ‰¹äº’è”ç½‘ä¼ä¸šå·²ç»åœ¨çº¢çº¢ç«ç«åœ°è¿è¥ç€ï¼Œæ²¡æœ‰äººæå‡ºå®ƒä»¬çš„ç”Ÿå­˜æœ‰æ³•å¾‹ä¸Šçš„é—®é¢˜ã€‚ä½†åœ¨å®ƒä»¬é…é…¿å‡ºå¢ƒä¸Šå¸‚æ—¶ï¼Œéœ€è¦å¾—åˆ°åŒ…æ‹¬ä¿¡æ¯äº§ä¸šéƒ¨ã€è¯ç›‘ä¼šç­‰éƒ¨é—¨çš„å®¡æ‰¹ï¼Œè€Œè¿™äº›çŠ¹å¦‚æ½œè—çš„å®šæ—¶ç‚¸å¼¹ä¸€èˆ¬çš„åˆè§„é—®é¢˜çªç„¶çˆ†å‘ï¼Œé¦–å½“å…¶å†²çš„å°±æ˜¯æ–°æµªã€‚ åœ¨å½“æ—¶çš„ä¸­å›½ï¼Œæœ‰ç€è¿™ä¹ˆä¸€æ¡è§„å®šï¼šæ”¾å¼€ç»è¥çš„ç”µä¿¡ä¸šåŠ¡ï¼Œä¸€å¾‹ä¸å…è®¸å¢ƒå¤–å„ç±»å›¢ä½“ã€ä¼ä¸šã€ä¸ªäººä»¥åŠåœ¨ä¸­å›½å¢ƒå†…å·²å…´åŠçš„å¤–å•†ç‹¬èµ„ã€ä¸­å¤–åˆèµ„å’Œåˆä½œä¼ä¸šç»è¥æˆ–è€…å‚ä¸ç»è¥ï¼Œä¹Ÿä¸å¾—ä»¥ä»»ä½•å½¢å¼å¸å¼•å¤–èµ„å‚è‚¡ç»è¥ã€‚ å°½ç®¡åœ¨2001å¹´12æœˆ11æ—¥ï¼Œä¸ºäº†é€‚åº”ä¸­å›½åŠ å…¥ä¸–è´¸çš„è¦æ±‚ï¼Œä¿¡æ¯äº§ä¸šéƒ¨å†³å®šåºŸæ­¢ä¸Šè¿°çš„è§„å®šã€‚ä¸è¿‡è¿™äº›éƒ½æ˜¯åè¯äº†ã€‚ åœ¨æ–°æµªç­¹åˆ’èµ´ç¾ä¸Šå¸‚çš„é‚£æ®µæ—¶é—´é‡Œï¼Œç‹å¿—ä¸œç™½å¤©è¦å»ä¿¡æ¯äº§ä¸šéƒ¨çš„åŠå…¬å®¤ç»™ä¸»ç®¡é¢†å¯¼ä»¬è§£é‡Šäº’è”ç½‘å’Œæ–°æµªçš„æƒ…å†µï¼Œæ™šä¸Šè¿˜è¦å›åˆ°å…¬å¸å’Œå¾‹å¸ˆä¸€èµ·ç ”ç©¶æ–°æµªçš„è‚¡æƒç»“æ„ã€èµ„æœ¬ã€ç°é‡‘ã€äººæµã€æ¶æ„ç­‰ç­‰ã€‚ æœ€åç‹å¿—ä¸œæƒ³å‡ºæ¥ä¸€ä¸ªæ¨¡å¼ï¼šä¸€ä¸ªå…¬å¸æ²¡æ³•ä¸Šå¸‚ï¼Œé‚£å°±åˆ†ä¸ºä¸‰ä¸ªï¼Œå…¶ä¸­åšäº’è”ç½‘å†…å®¹æœåŠ¡çš„ç•™åœ¨å›½å†…ï¼Œä¸ä¸Šå¸‚ï¼›ä¸Šå¸‚çš„æ˜¯ç¾å›½å…¬å¸ï¼Œä¸åœ¨ä¸­å›½åšäº’è”ç½‘ä¸šåŠ¡ã€‚ è¿™å°±æ˜¯åæ¥è¢«åŒ…æ‹¬æœç‹ã€ç½‘æ˜“åœ¨å†…çš„å¾ˆå¤šäº’è”ç½‘å…¬å¸ä½¿ç”¨çš„æ–°æµªæ¨¡å¼ã€‚ å½“æ—¶çš„å…·ä½“æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œè¢«åˆæ­¥è®¤å¯çš„æ–¹æ¡ˆæ˜¯ï¼šä¸€æ˜¯è¦æŠŠæä¾›äº’è”ç½‘å†…å®¹æœåŠ¡çš„è¿è¥æƒäº¤åˆ°å›½å†…å…¬å¸æ‰‹é‡Œï¼›äºŒæ˜¯æä¾›äº’è”ç½‘å†…å®¹æœåŠ¡çš„å¿…é¡»æ˜¯ä¸ªå…¨ä¸­èµ„å…¬å¸ï¼Œä¸Šå¸‚å…¬å¸åœ¨å›½å†…å…¬å¸é‡Œä¸å ä»»ä½•è‚¡ä»½ï¼›ä¸‰æ˜¯åˆçº¦æœ¬èº«å¿…é¡»éµå®ˆå›½å†…çš„æ³•å¾‹æ³•è§„ã€‚ è€Œæ ¹æ®æ–°æµªæœ€åæ–‡æœ¬çš„æ‹›è‚¡è¯´æ˜ä¹¦ä¸­ï¼Œä¸Šå¸‚çš„æ˜¯ä¸€å®¶åœ¨å¼€æ›¼ç¾¤å²›æ³¨å†Œçš„æ§è‚¡å…¬å¸ï¼Œæ‹¥æœ‰å››ä¸ªå…¨èµ„å­å…¬å¸ï¼šé¦™æ¸¯æ³¨å†Œçš„åˆ©æ–¹æŠ•èµ„æœ‰é™è´£ä»»å…¬å¸ã€è¿è¡Œé¦™æ¸¯ç½‘ç«™çš„é¦™æ¸¯æ–°æµªæœ‰é™è´£ä»»å…¬å¸ã€ç¾å›½åŠ å·æ³¨å†Œçš„æ–°æµªåœ¨çº¿ï¼ˆOnlineï¼ŒåŒ…æ‹¬åŒ—ç¾å’Œå°æ¹¾ä¸¤ä¸ªç½‘ç«™ï¼‰ã€ä»¥åŠåœ¨è‹±å±ç»´å°”äº¬ç¾¤å²›æ³¨å†Œçš„æ–°æµªæœ‰é™å…¬å¸ã€‚ å…¶ä¸­ä¸Šå¸‚ä¸»ä½“çš„å…¨èµ„å­å…¬å¸ä¹‹ä¸€åˆ©æ–¹æŠ•èµ„æœ‰é™è´£ä»»å…¬å¸æˆç«‹äº1993å¹´3æœˆï¼Œç”±å®ƒæ§è‚¡97.3%å’Œå››é€šé›†å›¢ä¸‹å±çš„åŒ—äº¬å››é€šç”µå­æŠ€æœ¯æœ‰é™è´£ä»»å…¬å¸åˆèµ„å»ºç«‹äº†åŒ—äº¬å››é€šåˆ©æ–¹ä¿¡æ¯æŠ€æœ¯æœ‰é™è´£ä»»å…¬å¸ã€‚åŒ—äº¬å››é€šåˆ©æ–¹ä¿¡æ¯æŠ€æœ¯æœ‰é™è´£ä»»å…¬å¸ä¸ºä¸€ä¸ªæŠ€æœ¯æœåŠ¡å…¬å¸ï¼Œå’Œå›½å†…çš„ICPå…¬å¸ä»…å‘ç”Ÿå•†ä¸šåè®®å…³ç³»ã€‚åŒæ—¶ï¼Œå¦åœ¨å›½å†…æ³¨å†Œæˆç«‹ä¸€å®¶åŒ—äº¬æ–°æµªäº’åŠ¨å¹¿å‘Šæœ‰é™è´£ä»»å…¬å¸ã€‚å››é€šåˆ©æ–¹å‘å›½å†…ICPæä¾›æŠ€æœ¯æœåŠ¡ï¼Œè€Œå›½å†…ICPä»¥åŒæ–¹å•†å®šçš„ä»·æ ¼è´­ä¹°æœåŠ¡ã€‚ ï¼ˆæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥æœç´¢ä¸€ä¸‹æ–°æµªæ¨¡å¼ï¼Œè¿™åœ¨å•†ä¸šä¸Šæ˜¯éå¸¸è‘—åçš„ä¸€ä¸ªä¸Šå¸‚æ¨¡å¼ï¼Œåœ¨è¿™é‡Œç¢äºç¯‡å¹…ï¼Œå°ä¸ƒåªèƒ½ç®€è¿°ä¸€ä¸‹ï¼‰ å®é™…ä¸Šï¼Œæ–°æµªå½“æ—¶çš„æƒ…å†µè¦æ›´å¤æ‚ä¸€äº›ï¼Œæ–°æµªèµ´ç¾ä¸Šå¸‚æ—¶ï¼Œå·²ç»å°†å…³é”®ä¸šåŠ¡å‰¥ç¦»ã€‚è™½ç„¶è¿˜æ˜¯å’Œæ‹†åˆ†å‡ºæ¥çš„å…¬å¸æœ‰ç€åƒä¸ä¸‡ç¼•çš„å…³ç³»ï¼Œä½†å¯¹äºå´‡å°šç®€å•çš„æŠ•èµ„è€…æ¥è¯´è¿˜æ˜¯è¿‡äºå¤æ‚ã€‚è¿™å¿…ç„¶ä¼šå¯¼è‡´å…¶ä¸Šå¸‚ç­¹æªèµ„é‡‘çš„èƒ½åŠ›è¢«å‰Šå¼±ã€‚ä½†ç‹å¿—ä¸œè¡¨ç¤ºï¼šå°½ç®¡å¯¹æŠ•èµ„è€…æ¥è¯´æœ‰é—æ†¾ï¼Œä½†è¿™æ˜¯å½“æ—¶ä»–ä»¬å¯ä»¥æ‹¿å‡ºçš„æœ€å¥½çš„è§£å†³æ–¹æ¡ˆäº†ã€‚ 2000å¹´4æœˆ13æ—¥11ç‚¹ï¼Œæ–°æµªå¼€å§‹æŒ‚ç‰Œäº¤æ˜“ï¼Œæ¯è‚¡å®šä»·ä¸º17ç¾å…ƒã€‚å½“æ—¥ä»¥20.875ç¾å…ƒæ”¶ç›˜ã€‚å½“å¤©äº¤æ˜“é¢å…±è¾¾684.79ä¸‡è‚¡ï¼Œå¤§çº¦ç­¹å¾—èµ„é‡‘6600ä¸‡ç¾å…ƒã€‚ æ–°æµªæ€»ç®—æ˜¯èµ¶ä¸Šäº†èµ´ç¾ä¸Šå¸‚çš„æœ«ç­è½¦ï¼Œè€Œè¿æ¥ä»–ä»¬çš„ï¼Œæ˜¯æ›´å¤§çš„å±éš¾ã€‚ 5ã€æ³¡æ²«ç ´ç­ï¼Œæ‰«åœ°å‡ºé—¨2000å¹´ï¼Œå…¨ä¸–ç•Œéƒ½åœ¨å…´å¥‹åœ°åº†ç¥ç€æ–°åƒå¹´çš„åˆ°æ¥ï¼Œè€Œä¸€åœºæ„æƒ³ä¸åˆ°çš„å±æœºå´æ‚„æ— å£°æ¯åœ°é™ä¸´äº†ã€‚ä»3æœˆ10æ—¥å¼€å§‹ï¼Œçº³æ–¯è¾¾å…‹æŒ‡æ•°åœ¨é•¿è¾¾ä¸¤å¹´æ—¶é—´é‡Œï¼Œç‹‚è·Œç™¾åˆ†ä¹‹ä¸ƒåå…«ã€‚ä¸ƒåƒäº”ç™¾äº¿ç¾å…ƒçš„èµ„äº§å’Œå…­åä¸‡ä¸ªå·¥ä½œå²—ä½è’¸å‘ï¼Œåªæœ‰ä¸åˆ°ä¸€åŠçš„ç½‘ç»œå…¬å¸æ´»è¿‡äº†2004å¹´ã€‚ è¿›å…¥2001å¹´ï¼Œæ–°æµªè‚¡ç¥¨ä»·æ ¼ä¸€è·¯ä¸‹æ»‘ï¼Œè·Œç ´2ç¾å…ƒã€‚è‘£äº‹å±€çš„è‘£äº‹ä»¬çº·çº·æŠ±æ€¨æ–°æµªçš„è´¢ç»çŠ¶å†µï¼Œç§°ç‹å¿—ä¸œåº”è¯¥ä¸ºè¿™ä¸€çŠ¶å†µè´Ÿè´£ã€‚ä½†å…¶å®å½“æ—¶æ•´ä¸ªäº’è”ç½‘æ³¥æ²™ä¿±ä¸‹ï¼Œå¤§å®¶çš„æ—¥å­éƒ½ä¸å¥½è¿‡ï¼Œè®¸å¤šå…¬å¸çš„è‚¡ç¥¨ä»·æ ¼ä¸ä¼ä¸šCEOçš„ç»è¥èƒ½åŠ›å¹¶æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ã€‚ä½†æ€»æœ‰è‚¤æµ…æ— çŸ¥çš„è‘£äº‹ä¼šå¹»æƒ³ç€èƒ½å¤Ÿé€šè¿‡æ¢å¸…ä¹‹ä¸¾æ¥æ‰­è½¬ä¹¾å¤ã€‚ æ®èŠåŠ å“¥å½“æ—¶ä¸€å®¶ç»Ÿè®¡æœºæ„ç»Ÿè®¡ï¼Œè¿›2001å¹´2æœˆä¸€ä¸ªæœˆï¼Œå„å¤§ç§‘æŠ€å…¬å¸ç¦»èŒçš„CEOé«˜è¾¾119äººï¼Œæ¯”å»å¹´åŒæœŸå¢é•¿äº†37%ã€‚æ›¾ç»é«˜é«˜åœ¨ä¸Šçš„CEOä¹Ÿå˜å¾—æœä¸ä¿å¤•ã€‚ è€Œç‹å¿—ä¸œï¼Œä¹Ÿæ²¡æœ‰ä¾‹å¤–ã€‚ 2001å¹´6æœˆ1æ—¥ï¼Œæ–°æµªè‘£äº‹ä»¬å†³å®šå…å»ç‹å¿—ä¸œçš„CEOåŠè‘£äº‹èº«ä»½ã€‚ ç‹å¿—ä¸œäº‹åå›å¿†ï¼šå¾—åˆ°è‡ªå·±è¢«è§£èŒçš„æ¶ˆæ¯ï¼Œæœ‰ä¸‰ä¸ªå¼ºçƒˆçš„æ„Ÿè§‰ã€‚ä¸€æ˜¯éœ‡æƒŠï¼ŒäºŒæ˜¯æ„Ÿè§‰è¢«å‡ºå–äº†ï¼Œä¸‰æ˜¯æƒ³å›å®¶ï¼Œæƒ³å›åˆ°ä¸­å›½ã€‚ â€œäº’è”ç½‘ç”¨å¦‚æ­¤çŸ­çš„æ—¶é—´å†…å°±åˆ›é€ äº†ä¸€åœºäººç±»å†å²ä¸Šå½±å“å…¨çƒçš„æ³¢æ¾œï¼Œå²æ— å‰ä¾‹ã€‚è¾‰ç…Œçš„æ³¡æ²«ç›’ç ´ç¢ï¼Œæ˜¯äº’è”ç½‘è¿™ä¸ªæ–°ç”Ÿå‘½èƒ½é‡çš„å¦ä¸€ç§è¡¨è¾¾ã€‚â€ â€”â€”æ‘˜è‡ªå¤®è§†çºªå½•ç‰‡ã€Šäº’è”ç½‘æ—¶ä»£ã€‹ åæ¥çš„æ–°æµªè¿˜æ˜¯æŒºè¿‡äº†å±æœºï¼Œè€Œç‹å¿—ä¸œå†ä¹Ÿæ²¡æœ‰å›åˆ°æ–°æµªï¼Œè€Œæ˜¯åˆ›åŠäº†ç‚¹å‡»ç§‘æŠ€ã€‚ ç‹å¿—ä¸œè®¤ä¸ºç‚¹å‡»ç§‘æŠ€æ˜¯ä»–çš„å¦ä¸€ä¸ªå­©å­ï¼Œä»–è¯´ï¼šä»¥å‰æ”€ç™»è¿‡å‡ ä¸ªé«˜å³°ï¼Œç°åœ¨ç»ˆäºä½ æœ‰æœºä¼šå»æ”€ç™»ä¸€æ¬¡æ–°çš„é«˜å³°ï¼Œè¿™æ ·äººåè€Œæœ‰ä¸€ç§å¾ˆå…´å¥‹çš„æ„Ÿè§‰ã€‚åˆ°äº†æ˜¥å¤©æ›´é‡è¦çš„æ˜¯ä½ è¦æ›´åŠªåŠ›åœ°å»è€•ä½œï¼Œä½ ä¸æŠŠæ¡å¥½ç°åœ¨è¿™ä¸ªæœºä¼šï¼Œé”™è¿‡è¿™ä¸ªæœºä¼šçš„è¯ï¼Œåˆ°äº†æ”¶è·çš„å­£èŠ‚ï¼Œä½ æœ‰å¯èƒ½å°±ä¸€æ— æ‰€æœ‰ã€‚ ä¸è®ºå¦‚ä½•ï¼Œä½œä¸ºå¦‚ä»Šäº’è”ç½‘çš„å—ç›Šè€…ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥å‘æ›¾ç»çš„äº’è”ç½‘å…ƒè€ä»¬çŒ®ä¸Šæœ€å´‡é«˜çš„æ•¬æ„ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[]},{"title":"MBRåˆ†åŒºè¡¨","slug":"20170808-mbr","date":"2017-08-08T07:00:00.000Z","updated":"2017-08-08T07:00:00.000Z","comments":true,"path":"20170808-mbr/","link":"","permalink":"https://tinychen.com/20170808-mbr/","excerpt":"ç›®å‰æ¥è¯´ï¼Œæ¯”è¾ƒä¸»æµçš„ä¸¤ç§ç¡¬ç›˜çš„åˆ†åŒºè¡¨æ˜¯MBRå’ŒGPTï¼ˆGUIDï¼‰ã€‚ä»Šå¤©å°ä¸ƒå¸¦å¤§å®¶äº†è§£ä¸€ä¸‹æ¯”è¾ƒæ—§ä¸€ç‚¹çš„MBRåˆ†åŒºè¡¨ï¼ˆç›¸å¯¹äºGPTï¼‰ã€‚","text":"ç›®å‰æ¥è¯´ï¼Œæ¯”è¾ƒä¸»æµçš„ä¸¤ç§ç¡¬ç›˜çš„åˆ†åŒºè¡¨æ˜¯MBRå’ŒGPTï¼ˆGUIDï¼‰ã€‚ä»Šå¤©å°ä¸ƒå¸¦å¤§å®¶äº†è§£ä¸€ä¸‹æ¯”è¾ƒæ—§ä¸€ç‚¹çš„MBRåˆ†åŒºè¡¨ï¼ˆç›¸å¯¹äºGPTï¼‰ã€‚ 1ã€ç®€ä»‹MBRè¿™ä¸ªæ¦‚å¿µé¦–æ¬¡å‡ºç°ï¼Œæ˜¯åœ¨1983å¹´çš„IBM PC DOS 2.0æ“ä½œç³»ç»Ÿå½“ä¸­ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºDOSåˆ†åŒºç»“æ„ã€‚å®é™…ä¸Šï¼ŒMBRåˆ†åŒºç»“æ„æ˜¯ä¸€ç§åº”ç”¨éå¸¸å¹¿æ³›çš„ç¡¬ç›˜åˆ†åŒºç»“æ„ï¼Œä¸ä»…ä»…æ˜¯DOSï¼ŒåŒ…æ‹¬windowsç³»åˆ—æ“ä½œç³»ç»Ÿã€Linuxä»¥åŠåŸºäºX86æ¶æ„çš„UNIXæ“ä½œç³»ç»Ÿç­‰å¹³å°å‡æœ‰ä½¿ç”¨ã€‚ MBRçš„è‹±æ–‡å…¨ç§°æ˜¯Main Boot Recordï¼ˆä¸€è¯´Master Boot Recordï¼‰ï¼Œç¿»è¯‘è¿‡æ¥çš„ä¸­æ–‡åç§°æ˜¯ä¸»å¼•å¯¼è®°å½•ã€‚ å®ƒä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š 1ã€åœ¨æˆ‘ä»¬å¸¸è§çš„ç”µè„‘ä¸­ï¼Œä¸€èˆ¬æ˜¯BIOS+MBRã€(U)efi+GPTçš„ç»„åˆï¼› 2ã€MBRåˆ†åŒºè¡¨ä¸­å•ä¸ªåˆ†åŒºæœ€å¤§ä»…æ”¯æŒ2TBï¼Œè€Œæ•´ä¸ªåˆ†åŒºè¡¨æœ€å¤§ä¹Ÿæ˜¯ä»…æ”¯æŒ2TBçš„ç¡¬ç›˜ï¼› 3ã€MBRåˆ†åŒºè¡¨æœ€å¤§åªæ”¯æŒå››ä¸ªä¸»åˆ†åŒºï¼ˆå¯å°‘ä¸å¯å¤šï¼‰ï¼Œå¦‚æœè§‰å¾—å››ä¸ªä¸å¤Ÿç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä¸‰ä¸ªä¸»åˆ†åŒº+ä¸€ä¸ªæ‰©å±•åˆ†åŒºçš„ç»„åˆï¼ˆæ‰©å±•åˆ†åŒºä»…èƒ½å­˜åœ¨ä¸€ä¸ªï¼Œä½†æ‰©å±•åˆ†åŒºä¸‹å¯ä»¥åˆ†å‡ºæ— æ•°ä¸ªé€»è¾‘åˆ†åŒºï¼‰ï¼› â–²å›¾ä¸ºMBRåˆ†åŒºå¸¸è§çš„ä¸¤ç§ç»„æˆ 2ã€ç»“æ„MBRåˆ†åŒºè¡¨å ç”¨ä¸€ä¸ªæ‰‡åŒºï¼Œä½äºç¡¬ç›˜çš„0ç£å¤´ã€0æŸ±é¢ã€1æ‰‡åŒºã€‚ è¿™é‡Œéœ€è¦å¼•ç”¨ä¸€ä¸‹åº¦å¨˜ç™¾ç§‘å¯¹äºç£å¤´æŸ±é¢æ‰‡åŒºè¿™ä¸‰ä¸ªæ¦‚å¿µçš„è§£é‡Šã€‚ **ç£å¤´(Heads)**ï¼šæ¯å¼ ç£ç‰‡çš„æ­£åä¸¤é¢å„æœ‰ä¸€ä¸ªç£å¤´ï¼Œä¸€ä¸ªç£å¤´å¯¹åº”ä¸€å¼ ç£ç‰‡çš„ä¸€ä¸ªé¢ã€‚å› æ­¤ï¼Œç”¨ç¬¬å‡ ç£ å¤´å°±å¯ä»¥è¡¨ç¤ºæ•°æ®åœ¨å“ªä¸ªç£é¢ã€‚ **æŸ±é¢(Cylinder)**ï¼šæ‰€æœ‰ç£ç‰‡ä¸­åŠå¾„ç›¸åŒçš„åŒå¿ƒç£é“æ„æˆâ€œæŸ±é¢â€ï¼Œæ„æ€æ˜¯è¿™ä¸€ç³»åˆ—çš„ç£é“å‚ç›´å åœ¨ä¸€èµ·ï¼Œå°±å½¢æˆä¸€ä¸ªæŸ±é¢çš„å½¢çŠ¶ã€‚ç®€å•åœ°ç†è§£ï¼ŒæŸ±é¢æ•°=ç£é“æ•°ã€‚ **æ‰‡åŒº(Sector)**ï¼šå°†ç£é“åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå°çš„åŒºæ®µï¼Œå°±æ˜¯æ‰‡åŒºã€‚è™½ç„¶å¾ˆå°ï¼Œä½†å®é™…æ˜¯ä¸€ä¸ªæ‰‡å­çš„å½¢çŠ¶ï¼Œæ•…ç§°ä¸ºæ‰‡åŒºã€‚ â–²å›¾ä¸ºç£å¤´ã€æŸ±é¢ã€æ‰‡åŒºç¤ºæ„å›¾ â‘ ä¸ç®¡æ˜¯CHSå¯»å€è¿˜æ˜¯LBAå¯»å€ï¼Œéƒ½éœ€è¦çŸ¥é“ç£å¤´æŸ±é¢å’Œæ‰‡åŒºæ¥å¯¹æ•°æ®è¿›è¡Œå®šä½ï¼› â‘¡é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªæ‰‡åŒºçš„å¤§å°ä¸º512å­—èŠ‚ï¼ˆByteï¼‰ï¼› â‘¢è¯¥æ‰‡åŒºä¸ºéšè—æ‰‡åŒºï¼Œå®é™…ä¸Šï¼Œ0ç£å¤´0æŸ±é¢çš„æ‰‡åŒºå‡ä¸ºéšè—æ‰‡åŒºï¼Œä¸€èˆ¬çš„ç¡¬ç›˜è®¿é—®å‘½ä»¤æ— æ³•è®¿é—®ï¼Œå› æ­¤MBRåˆ†åŒºè¡¨æ”¾åœ¨æ­¤å¤„æ¯”è¾ƒå®‰å…¨ï¼Œä¸å®¹æ˜“é­åˆ°ç ´åï¼ŒåŒç†ï¼Œè®¸å¤šç—…æ¯’ä¹Ÿä¼šéšè—åœ¨è¿™é‡Œï¼Œä¸å®¹æ˜“è¢«æŸ¥æ€ã€‚ ç”±äºMBRæ‰‡åŒºä¸­å¤§éƒ¨åˆ†éƒ½è¢«MBRæ‰€å é¢†ï¼Œå› æ­¤è¿™ä¸ªæ‰‡åŒºå°±è¢«ç§°ä¸ºMBRæ‰‡åŒºã€‚è€ŒMBRæ‰‡åŒºä¸»è¦æ˜¯ç”±MBRã€DPTå’Œç»“æŸæ ‡è¯†ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆã€‚ â–²å›¾ä¸ºæ ‡å‡†MBRç»“æ„ 3ã€å·¥ä½œåŸç†MBRçš„äº§ç”Ÿå¹¶ä¸ä¾èµ–äºä»»ä½•ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œåœ¨ç”µè„‘å¼€æœºé€šç”µåï¼ŒBIOSè¿›è¡Œè‡ªæ£€ï¼Œè‡ªæ£€å®Œæˆåå°±å¼€å§‹æ‰§è¡ŒMBRä¸­çš„å¯åŠ¨ä»£ç ï¼ˆBootloaderï¼‰ï¼Œé€šè¿‡è¯»å–å¯åŠ¨ä»£ç æ¥ç¡®å®šéœ€è¦å¼•å¯¼çš„ç³»ç»Ÿã€‚å› æ­¤ï¼ŒåŒç³»ç»Ÿæˆ–è€…æ˜¯å¤šç³»ç»Ÿå®‰è£…å®Œæˆä¹‹åï¼Œéœ€è¦ä¿®æ”¹å¼•å¯¼å¯åŠ¨é¡¹ï¼Œå³ä¸ºä¿®æ”¹æ­¤å¤„çš„å¯åŠ¨ä»£ç ï¼ˆBootloaderï¼‰ã€‚ æ‰§è¡Œå®Œå¯åŠ¨ä»£ç ä¹‹åï¼Œç³»ç»Ÿä¸‹ä¸€æ­¥å°±ä¼šè¯»å–MBRæ‰‡åŒºä¸­çš„æœ€åä¸¤ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ˜¯55AAï¼Œåˆ™ç»§ç»­è¯»å–ç£ç›˜åˆ†åŒºè¡¨DPTæ¥ç¡®å®šæ˜¯å¦æœ‰æ´»åŠ¨åˆ†åŒºï¼Œä»è€Œå¯åŠ¨ç³»ç»Ÿï¼›å¦‚æœä¸æ˜¯55AAï¼Œç³»ç»Ÿä¼šè®¤ä¸ºè¯¥MBRä¸ºéæ³•MBRï¼Œç³»ç»Ÿå°†åœæ­¢æ“ä½œå¹¶æŠ¥é”™ã€‚ â–²å›¾ä¸ºMBRåˆ†åŒºè¡¨çš„ç¡¬ç›˜å¼€æœºè¿‡ç¨‹ è¿™é‡Œå†é¢å¤–æä¸€ä¸‹ã€‚ MBRä¸­çš„é€‰ç”¨ç£ç›˜æ ‡è¯†ï¼Œè¿™ä¸ªåœ¨MBRåˆ†åŒºä¸­æ¯”è¾ƒé‡è¦ã€‚å¦‚æœå®‰è£…çš„æ˜¯windowsæ“ä½œç³»ç»Ÿçš„è¯ï¼Œç³»ç»Ÿåœ¨å¯åŠ¨æ—¶éœ€è¦ä¾èµ–è¯¥ç£ç›˜ç­¾åæ¥è¯†åˆ«ç¡¬ç›˜å¹¶ç¡®å®šè¯¥ç£ç›˜æ˜¯å¦åˆå§‹åŒ–ã€‚ è€ŒDPTçš„ä½œç”¨å…¶å®éå¸¸ç®€å•ï¼Œå°±æ˜¯ç®¡ç†ç£ç›˜çš„åˆ†åŒºä¿¡æ¯ã€‚å¦‚æœDPTè¢«ç ´åï¼Œé‚£ä¹ˆç³»ç»Ÿå°†æ— æ³•è¯†åˆ«è¯¥ç£ç›˜ä¸Šçš„æ‰€æœ‰åˆ†åŒºï¼Œå¹¶ä¸”æœ‰å¯èƒ½ä¼šæç¤ºéœ€è¦æ ¼å¼åŒ–ç£ç›˜ã€‚ ä¸€èˆ¬å°ç™½é‡åˆ°è¿™ç§æƒ…å†µä¼šæ¯”è¾ƒæ— å¥ˆï¼Œåªèƒ½æ ¼å¼åŒ–ï¼Œå¯¹ç£ç›˜ä¸­å®è´µçš„æ•°æ®è¯´æ‹œæ‹œï¼Œä½†æ˜¯ï¼Œå…¶å®åªè¦ä¿®å¤DPTï¼Œå°±å¯ä»¥è¯»å–åˆ†åŒºï¼Œæ‰¾å›æ•°æ®ï¼Œå®é™…ä¸Šï¼Œç¡¬ç›˜çš„æ•°æ®ä¸€ç›´éƒ½åœ¨é‚£é‡Œã€‚é‚£æ€•æ˜¯å¯¹ç¡¬ç›˜è¿›è¡Œä¸€èˆ¬çš„æ ¼å¼åŒ–æ“ä½œï¼Œä¹Ÿåªæ˜¯å°†DPTä¸­å¯¹åº”çš„åˆ†åŒºçš„æ•°æ®æ¸…ç©ºï¼Œå¹¶æ²¡æœ‰å½±å“åˆ°åŸæ¥çš„åœ¨å…¶ä»–æ‰‡åŒºçš„æ•°æ®ï¼Œæ­¤æ—¶åªè¦ä¸è¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œï¼ˆé˜²æ­¢è¦†ç›–åŸæœ‰æ•°æ®ï¼‰ï¼Œè¿˜æ˜¯æœ‰å¯èƒ½æ‰¾å›ä¸¢å¤±çš„æ•°æ®çš„ã€‚ 4ã€DPTDPTå…¶å®æœ‰æŒºå¤šå¯ä»¥è®²çš„åœ°æ–¹ï¼Œè¿™é‡Œæ‹¿ä¸€ä¸ªåˆ†åŒºï¼ˆ16Byteï¼‰ä¸ºä¾‹ï¼Œè®²è§£ä¸€ä¸‹MBRåˆ†åŒºæœ€å¤§åªèƒ½è¯†åˆ«2TBç¡¬ç›˜çš„åŸå› ã€‚ 5ã€åˆ†åŒºé¡¹è¡¨å†…å®¹åŠå«ä¹‰æ³¨ï¼š1 Byte=8 bit â–²å›¾ä¸ºMBRä¸­çš„DPTçš„åˆ†åŒºé¡¹è¡¨çš„å†…å®¹åŠå«ä¹‰ å†å¯¹å…¶ä½œè¿›ä¸€æ­¥çš„è§£é‡Šï¼š ç¬¬1å­—èŠ‚çš„å¼•å¯¼æ ‡è¯†ï¼šå¦‚æœè¯¥åˆ†åŒºå†…å®‰è£…äº†æ“ä½œç³»ç»Ÿï¼Œåˆ™è¯¥åˆ†åŒºå¿…é¡»ä¸ºæ´»åŠ¨åˆ†åŒºï¼Œæ–¹å¯æˆåŠŸå¼•å¯¼è¯¥åˆ†åŒºå†…çš„æ“ä½œç³»ç»Ÿï¼ˆå³ä¸º80Hï¼‰ï¼› ç¬¬5å­—èŠ‚çš„åˆ†åŒºç±»å‹ç¬¦ï¼šè®°å½•è¯¥åˆ†åŒºçš„ç±»å‹ï¼Œæ¯ä¸€ç§ç±»å‹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å€¼ï¼Œå¦‚00Hâ€”â€”è¡¨ç¤ºè¯¥åˆ†åŒºæœªç”¨ï¼ˆå³æ²¡æœ‰æŒ‡å®šï¼ŒDOSå’Œwinä¸è¯†åˆ«è¯¥ç±»å‹åˆ†åŒºï¼‰ã€06Hâ€”â€”FAT16åˆ†åŒºï¼›0BHâ€”â€”FAT32åˆ†åŒºã€ 07Hâ€”â€”NTFSåˆ†åŒºç­‰ï¼› ç¬¬2ã€3ã€4ã€6ã€7ã€8å­—èŠ‚ï¼šè®°å½•äº†è¿™ä¸ªåˆ†åŒºçš„èµ·å§‹å’Œç»“æŸç£å¤´ã€æ‰‡åŒºã€æŸ±é¢ï¼Œå³å¯ç¡®å®šè¯¥åˆ†åŒºåœ¨ç¡¬ç›˜ä¸­çš„ä½ç½®ä»¥åŠè¯¥åˆ†åŒºçš„å®¹é‡ï¼› æœ€åçš„8ä¸ªå­—èŠ‚å°±æ˜¯MBRåˆ†åŒºä¸ºä½•æœ€å¤§åªèƒ½è¯†åˆ«2TBå®¹é‡çš„åŸå› äº†ã€‚ å‰æçŸ¥è¯†èƒŒæ™¯ï¼š â‘  è®¡ç®—æœºä¸­é‡‡ç”¨2è¿›åˆ¶ï¼Œbitæ˜¯æœ€å°çš„å¤§å°è®¡é‡å•ä½ï¼› â‘¡ 1 Byte=8 bitï¼› â‘¢ ä¸€ä¸ªæ‰‡åŒºçš„å¤§å°æ˜¯512Byteï¼› â‘£ Byteã€KBã€MBã€GBã€TBã€PBè¿™å…­è€…æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼Œä¸”ç›¸é‚»ä¸¤è€…é—´å·®1024å€ï¼ˆå³2^10ï¼‰ï¼› â‘¤ åœ¨ä¸Šé¢çš„ç¼©å†™ä¸­ï¼Œå¤§å†™çš„Bè¡¨ç¤ºByteï¼Œå°å†™çš„bè¡¨ç¤ºbitï¼Œä¸¤è€…ç›¸å·®8å€ï¼› ç”±äºåªæœ‰4 Byteæ¥è®°å½•æœ¬åˆ†åŒºçš„æ€»æ‰‡åŒºæ•°ï¼Œ4 Byte=32 bitï¼Œåœ¨2è¿›åˆ¶å³æœ‰2^32ç§çŠ¶æ€ï¼Œå‡è®¾å…¨éƒ¨ä¸º1ï¼Œåˆ™æœ€å¤šæœ‰2^32ä¸ªæ‰‡åŒºã€‚å³ æ‰€ä»¥MBRåˆ†åŒºä¸­å•ä¸ªåˆ†åŒºæœ€å¤šåªèƒ½è¯†åˆ«2TBå®¹é‡ï¼Œè€Œç”±äºè®°å½•å·²ä½¿ç”¨çš„æ‰‡åŒºçš„å­—èŠ‚æ•°ä¹Ÿæ˜¯4ï¼Œæ‰€ä»¥æ•´ä¸ªåˆ†åŒºæœ€å¤šä¹Ÿåªèƒ½è¯†åˆ«2TBå®¹é‡ã€‚ 6ã€æ‰©å±•åˆ†åŒºå‰é¢æˆ‘ä»¬å·²ç»æåˆ°äº†å½“å››ä¸ªä¸»åˆ†åŒºæ— æ³•æ»¡è¶³éœ€æ±‚çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ä¸‰ä¸ªä¸»åˆ†åŒº+ä¸€ä¸ªæ‰©å±•åˆ†åŒºçš„æ–¹æ³•ï¼Œåœ¨æ‰©å±•åˆ†åŒºä¸‹ï¼Œç†è®ºä¸Šå¯ä»¥åˆ†å‡ºæ— æ•°ä¸ªåˆ†åŒºï¼ˆå®é™…è¿˜è¦çœ‹æ“ä½œç³»ç»Ÿçš„é™åˆ¶ç­‰å…¶ä»–å› ç´ ï¼‰ã€‚ è¿™é‡Œè¿˜è¦ä»‹ç»ä¸€ä¸ªæ¦‚å¿µâ€”â€”EBRï¼ˆExtended Boot Recordï¼‰ï¼Œå³æ‰©å±•åˆ†åŒºå¼•å¯¼è®°å½•ã€‚å…¶åŸç†å’Œå·¥ä½œæ¨¡å¼ä¸MBRéå¸¸ç›¸ä¼¼ï¼Œä½†å®ƒæ˜¯é“¾å¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªEBRä¸å¤Ÿç”¨ï¼Œå¯ä»¥å†å¢åŠ ä¸€ä¸ªï¼Œæ–°å¢åŠ çš„EBRé“¾æ¥åœ¨æ—§çš„EBRä¹‹åï¼Œä¸€ä¸ªé“¾æ¥ç€ä¸€ä¸ªï¼Œå°±åƒé“¾æ¡ä¸€æ ·ã€‚ç†è®ºä¸Šå°±å¯ä»¥å®ç°æ— æ•°ä¸ªåˆ†åŒºã€‚ MBRåˆ†åŒºè¡¨çš„å†…å®¹ä»‹ç»åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¦‚æœå¯¹å®ƒè¿˜æœ‰å…´è¶£çš„è¯ï¼Œæˆ–è€…è§‰å¾—è¿™é‡Œçš„ä»‹ç»å¤ªè¿‡ç®€å•çš„è¯ï¼Œå¯ä»¥å»æŸ¥è¯¢ä¸€äº›ç›¸å…³ä¹¦ç±å’Œè®ºå›ã€‚å¦å¤–ï¼Œå¦‚æœæ–‡ä¸­æœ‰ä»»ä½•é”™è¯¯ï¼Œè¿˜æœ›ä¸åèµæ•™ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"}],"tags":[{"name":"harddisk","slug":"harddisk","permalink":"https://tinychen.com/tags/harddisk/"}]},{"title":"Filqloæ—¶é’Ÿå±ä¿","slug":"20170703-filqlo","date":"2017-07-03T07:00:00.000Z","updated":"2017-07-03T07:00:00.000Z","comments":true,"path":"20170703-filqlo/","link":"","permalink":"https://tinychen.com/20170703-filqlo/","excerpt":"ä¸çŸ¥é“å¤§å®¶ç°åœ¨è¿˜æœ‰æ²¡æœ‰ä½¿ç”¨å±ä¿çš„ä¹ æƒ¯ï¼Œåæ­£å°ä¸ƒæ˜¯æœ‰çš„ã€‚æ¯•ç«Ÿåœ¨æŒ‚æœºä¸‹è½½ï¼Œæˆ–è€…æ˜¯å†™ä½œä¸šéœ€è¦å¼€ç€ç”µè„‘çš„æ—¶å€™ï¼Œå¼€ç€å±ä¿è¿˜æ˜¯ç›¸å½“ä¸é”™çš„ã€‚ ä»Šå¤©å°ä¸ƒå°±ç»™å¤§å®¶å®‰åˆ©ä¸€æ¬¾åœ¨Windowså¹³å°ä¸Šå…è´¹çš„å±ä¿è½¯ä»¶å§ã€‚ï¼ˆè‹¹æœç³»è²Œä¼¼ç°åœ¨ä¹Ÿå…è´¹äº†ï¼‰","text":"ä¸çŸ¥é“å¤§å®¶ç°åœ¨è¿˜æœ‰æ²¡æœ‰ä½¿ç”¨å±ä¿çš„ä¹ æƒ¯ï¼Œåæ­£å°ä¸ƒæ˜¯æœ‰çš„ã€‚æ¯•ç«Ÿåœ¨æŒ‚æœºä¸‹è½½ï¼Œæˆ–è€…æ˜¯å†™ä½œä¸šéœ€è¦å¼€ç€ç”µè„‘çš„æ—¶å€™ï¼Œå¼€ç€å±ä¿è¿˜æ˜¯ç›¸å½“ä¸é”™çš„ã€‚ ä»Šå¤©å°ä¸ƒå°±ç»™å¤§å®¶å®‰åˆ©ä¸€æ¬¾åœ¨Windowså¹³å°ä¸Šå…è´¹çš„å±ä¿è½¯ä»¶å§ã€‚ï¼ˆè‹¹æœç³»è²Œä¼¼ç°åœ¨ä¹Ÿå…è´¹äº†ï¼‰ è¯ä¸å¤šè¯´ï¼Œå’±ä»¬è¿›å…¥æ­£æ–‡ã€‚ 1ã€Filqloç®€ä»‹ FliqloåŸæœ¬æ˜¯ä¸€æ¬¾åœ¨iOSåº”ç”¨å•†åº—é‡Œé¢çš„ä»˜è´¹æ—¶é’Ÿå±ä¿è½¯ä»¶ï¼Œä½†æ˜¯ç”±äºå…¶å¤å¤ç®€å•çš„è®¾è®¡ï¼Œè¿…é€Ÿå¸å¼•äº†ä¸€å¤§æ³¢ç²‰ä¸ï¼Œç°åœ¨ä¹Ÿæœ‰äº†Windowsç‰ˆæœ¬å’ŒMacç‰ˆæœ¬ã€‚ ä»–ä»¬çš„å®˜ç½‘æ˜¯fliqlo.comï¼Œéœ€è¦ç§‘å­¦ä¸Šç½‘æ‰èƒ½æ­£å¸¸è®¿é—®ã€‚æœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥å»ä»–ä»¬çš„å®˜ç½‘çœ‹çœ‹ã€‚ ä¸‹é¢æ¬è¿ä¸€å°éƒ¨åˆ†ä»–ä»¬å®˜ç½‘çš„ä»‹ç»ã€‚ Fliqlo for iOS is a clock app that allows you to make your mobile/tablet device screen look like a flip clockã€Thanks to its visibility, you can read the time even from a distance. 1.1 FeaturesEnlarge/reduce to any size Switch between 12/24 hour clock (* without a leading zero) Switch between portrait and landscape mode 1.2 Price$0.00 Free for charge å°ä¸ƒæ³¨ï¼šwindowså¹³å°çš„ç‰ˆæœ¬å¹¶ä¸éœ€è¦æ”¶è´¹ï¼Œå› æ­¤å¤§å®¶å¯ä»¥æ”¾å¿ƒä¸‹è½½ï¼Œå¦‚æœæƒ³æ”¯æŒå¼€å‘è€…çš„è¯ï¼Œå¯ä»¥é€šè¿‡å®ƒä»¬ç½‘ç«™ä¸‹æ–¹çš„paypalæ¥è¿›è¡Œæèµ ã€‚ 2ã€è®¾ç½®æ•™ç¨‹2.1 Mac &amp; IOSå¯¹äºiOSå’ŒMacå¹³å°çš„ç”¨æˆ·ï¼Œç›´æ¥æ‰“å¼€AppStoreè¾“å…¥å…³é”®å­—Fliqloä¸‹è½½å®‰è£…å³å¯ä½¿ç”¨ã€‚Macç”¨æˆ·ä¹Ÿå¯ä»¥å»å®˜ç½‘ä¸‹è½½ã€‚ 2.2 Windowsè‡³äºWindowsçš„ç”¨æˆ·å°±ç¨ç¨éº»çƒ¦ä¸€äº›ï¼Œéœ€è¦ç§‘å­¦ä¸Šç½‘åˆ°ä»–ä»¬çš„å®˜ç½‘è¿›è¡Œä¸‹è½½ã€‚ ä¸ºäº†æ–¹ä¾¿å¤§å®¶ä½¿ç”¨ï¼Œå°ä¸ƒå·²ç»å°†windowsç‰ˆæœ¬ä»å®˜ç½‘æ¬è¿è¿‡æ¥ï¼Œç‚¹å‡»è¿™é‡Œå³å¯ä¸‹è½½ã€‚ é“¾æ¥ï¼šhttps://pan.baidu.com/s/1eROCql0 å¯†ç ï¼š7w2w ä¸‹è½½å®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç›´æ¥åŒå‡»æ‰“å¼€ã€‚å°±ä¼šå¼¹å‡ºwindowsä¸­çš„å±å¹•ä¿æŠ¤ç¨‹åºçš„è®¾ç½®ç•Œé¢ã€‚ æˆ‘ä»¬ç‚¹å‡»è®¾ç½®ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å‡ ä¸ªç®€å•çš„å‚æ•°å¯ä»¥è¿›è¡Œä¿®æ”¹ã€‚ å®ƒä»¬åˆ†åˆ«æ˜¯è°ƒèŠ‚12/24å°æ—¶åˆ¶ï¼Œæ”¾å¤§å’Œç¼©å°ï¼ˆæœ€å¤§125%ï¼‰å’Œæ¢å¤é»˜è®¤è®¾ç½®ã€‚ â–²é»˜è®¤è®¾ç½® â–²æ”¾å¤§åˆ°125%ï¼ˆæœ€å¤§ï¼‰ â–²åˆ‡æ¢ä¸º24å°æ—¶åˆ¶ å°ä¸ƒæ³¨ï¼šç”±äºwindowså¹³å°æ˜¯å…è´¹çš„ï¼Œæ‰€ä»¥BUGçš„å­˜åœ¨ä¹Ÿæ˜¯ä¸å¯é¿å…çš„ï¼Œåˆæ¬¡è®¾ç½®çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°å´©æºƒçš„æƒ…å†µï¼Œä½†æ˜¯åªè¦é‡å¯ä¸€ä¸‹ç”µè„‘å°±å¯ä»¥è§£å†³ã€‚ï¼ˆåªæ˜¯åˆæ¬¡è®¾ç½®æ—¶å¯èƒ½éœ€è¦é‡å¯ï¼Œä¸æ˜¯æ¯æ¬¡éƒ½è¦é‡å¯ï¼‰ è™½ç„¶Fliqloåœ¨åŠŸèƒ½ä¸Šæ²¡æœ‰ä¹‹å‰å¾ˆç«çš„Wallpaper Engineé‚£ä¹ˆå¼ºå¤§ï¼Œä½†æ˜¯å®ƒå‡ ä¹ä¸å ç”¨ç³»ç»Ÿèµ„æºä¸”åœ¨å®‰è£…ä¸Šè¦ç®€å•ä¸å°‘ã€‚ ç©è…»äº†Wallpaper Engineçš„åŒå­¦ï¼Œç¡®å®šä¸æ¥ä¸€ä¸ªFliqloè¯•è¯•å—ï¼Ÿ","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"}]},{"title":"ç”µè„‘çš„ABç›˜å»å“ªäº†ï¼Ÿ","slug":"20170512-disk-a-b-introduction","date":"2017-05-12T07:00:00.000Z","updated":"2017-05-12T07:00:00.000Z","comments":true,"path":"20170512-disk-a-b-introduction/","link":"","permalink":"https://tinychen.com/20170512-disk-a-b-introduction/","excerpt":"ä»Šå¤©èŠä¸€ä¸ªå¾ˆæ€€æ—§çš„è¯é¢˜ã€‚ ç›¸ä¿¡å¾ˆå¤šäººéƒ½çŸ¥é“æˆ‘ä»¬çš„ç”µè„‘æ˜¯ä»Cç›˜å¼€å§‹çš„ï¼ŒCç›˜ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„ç³»ç»Ÿç›˜ã€‚ å¾ˆå¤šäººå¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆè¦ä»Cç›˜å¼€å§‹ï¼Œè€Œä¸æ˜¯ä»Aç›˜å¼€å§‹ï¼ŸAç›˜å’ŒBç›˜å»å“ªäº†ï¼Ÿ","text":"ä»Šå¤©èŠä¸€ä¸ªå¾ˆæ€€æ—§çš„è¯é¢˜ã€‚ ç›¸ä¿¡å¾ˆå¤šäººéƒ½çŸ¥é“æˆ‘ä»¬çš„ç”µè„‘æ˜¯ä»Cç›˜å¼€å§‹çš„ï¼ŒCç›˜ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„ç³»ç»Ÿç›˜ã€‚ å¾ˆå¤šäººå¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆè¦ä»Cç›˜å¼€å§‹ï¼Œè€Œä¸æ˜¯ä»Aç›˜å¼€å§‹ï¼ŸAç›˜å’ŒBç›˜å»å“ªäº†ï¼Ÿ å…¶å®è¦è§£é‡Šçš„è¯ï¼Œä¸€å¥è¯å°±å¤Ÿäº†ã€‚ABè¿™ä¸¤ä¸ªç›˜ç¬¦æ˜¯é¢„ç•™ç»™è½¯é©±çš„ã€‚æ¢å¥è¯è¯´ï¼Œ ABç›˜æ˜¯è®¡ç®—æœºå‘å±•åˆæœŸç»™è½¯é©±ç•™çš„ä½ç½®ã€‚ ä¸‹é¢æ˜¯è®²æ•…äº‹æ—¶é—´ã€‚ 1ã€System 370å¤§æ¦‚æ˜¯åœ¨20ä¸–çºª70å¹´ä»£åˆï¼Œå‡†ç¡®æ¥è¯´æ˜¯1970å¹´6æœˆ30æ—¥çš„æ ·å­ï¼ŒIBMæ¨å‡ºäº†System360çš„ç»§ä»»è€…â€”â€”System 370ã€‚ ![](https://resource.tinychen.com/ç”µè„‘çš„ABç›˜å»å“ªäº†ï¼Ÿ (1).jpg) â–²System/370 Model 145ï¼ˆå›¾ç‰‡æ¥æºäºIBMå®˜ç½‘ï¼‰ å…³äºSystem370çš„åŠŸèƒ½è¿›æ­¥å°ä¸ƒå°±ä¸åœ¨è¿™é‡Œèµ˜è¿°ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥æ‰“å¼€IBMå®˜ç½‘è¾“å…¥System370è¿›è¡Œæœç´¢æ—¢å¯æŸ¥çœ‹ç›¸å…³ä¿¡æ¯ã€‚ ä½†æ˜¯IBMçš„System370è®¡ç®—æœºé¢ä¸´è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿™ç§è®¡ç®—æœºçš„æ“ä½œæŒ‡ä»¤å­˜å‚¨åœ¨åŠå¯¼ä½“å†…å­˜ä¸­ï¼Œä¸€æ—¦è®¡ç®—æœºå…³æœºï¼ŒæŒ‡ä»¤ä¾¿ä¼šè¢«æŠ¹å»ã€‚ è¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ è¯´ç™½äº†å°±æ˜¯è¿™ç§ç”µè„‘å¹¶æ²¡æœ‰æˆ‘ä»¬ç°åœ¨æ„ä¹‰ä¸Šçš„ç¡¬ç›˜ï¼ˆROMï¼‰ï¼Œå®ƒåªæœ‰åŠå¯¼ä½“å†…å­˜ï¼ˆRAMï¼‰ï¼Œå› æ­¤åªèƒ½å°†æ•°æ®éƒ½å­˜å‚¨åˆ°åŠå¯¼ä½“å†…å­˜ä¸­ã€‚è€Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒRAMæ˜¯æ–­ç”µä¸ä¿å­˜æ•°æ®çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‡ä¸€ä¸€ä¸ªä¸å°å¿ƒé‡å¯ä¸€ä¸‹ç”µè„‘æˆ–è€…æ˜¯æ–­ç”µäº†ï¼Œä½ è¾›è¾›è‹¦è‹¦å†™äº†å‡ å¤©å‡ å¤œçš„ä»£ç å°±æ²¡äº†â€¦â€¦ æƒ³è±¡ä¸€ä¸‹ä½ åœ¨åŠå…¬å®¤å¥‹æˆ˜å‡ å¤©å‡ å¤œï¼Œèµ¶åœ¨DDLä¹‹å‰æŠŠä»£ç å†™äº†å‡ºæ¥ï¼Œç„¶åç´¯åˆ°åœ¨åŠå…¬å®¤ç¡ç€äº†ï¼Œç»“æœé‚£æ™šå°±æ–­ç”µäº†ï¼Œç¬¬äºŒå¤©PMæ‰¾ä½ è¦ä»£ç ï¼Œå¥½å®¶ä¼™ï¼Œä½ è¦æ€ä¹ˆåŠï¼Ÿ 2ã€8è‹±å¯¸è½¯ç›˜IBMå½“ç„¶ä¹Ÿæ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æ—©åœ¨1967å¹´ï¼ŒIBMçš„SanJoseå®éªŒå®¤çš„å­˜å‚¨å°ç»„å—å‘½å¼€å‘ä¸€ç§å»‰ä»·çš„è®¾å¤‡ï¼Œä¸ºå¤§å‹æœºå¤„ç†å™¨å’Œæ§åˆ¶å•å…ƒä¿å­˜å’Œä¼ é€å¾®ä»£ç ã€‚è¿™ç§è®¾å¤‡æˆæœ¬å¿…é¡»åœ¨5ç¾å…ƒä»¥ä¸‹ï¼Œä»¥ä¾¿æ˜“äºæ›´æ¢ï¼Œè€Œä¸”å¿…é¡»æºå¸¦æ–¹ä¾¿ï¼Œäºæ˜¯è½¯ç›˜çš„ç ”åˆ¶ä¹‹è·¯å¼€å§‹äº†ã€‚ ç ”å‘ç»„ï¼šåˆè¦ä¾¿å®œåˆè¦ä¾¿æºï¼Œä½ å’‹ä¸ä¸Šå¤©å‘¢ï¼Ÿ è¿™ä¸ªå…¶å®å¯ä»¥ç®—æ˜¯ç°ä»£çš„è½¯ç›˜é©±åŠ¨å™¨çš„é¼»ç¥–ï¼Œä½†æ˜¯åœ¨æºå¸¦å½¢å¼ä¸Šåˆæœ‰ç‚¹åƒUç›˜ç­‰ç§»åŠ¨å­˜å‚¨ä»‹è´¨ã€‚äº‹å®ä¸Šï¼Œåœ¨å½“æ—¶è®¡ç®—æœºçš„ä½“ç§¯æ²¡æœ‰è¾¾åˆ°è¶³å¤Ÿå°ä»¥è‡³äºèƒ½æ»¡è¶³äººä»¬ä¾¿æºçš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼ç¡®å®æ˜¯æœ€é è°±ä¹Ÿæ˜¯æœ€ä¿é™©çš„ã€‚æƒ³è±¡ä¸€ä¸‹ï¼šä¸€ä¸ªç¨‹åºçŒ¿æŠŠè‡ªå·±èŠ±é«˜ä»·ä¹°æ¥çš„DOSç³»ç»Ÿè£…åˆ°è½¯é©±é‡Œé¢ï¼Œç„¶åå†æŠŠè‡ªå·±èŠ±äº†æ¯•ç”Ÿç²¾åŠ›å†™çš„ä»£ç æ”¾åˆ°è½¯é©±é‡Œé¢ï¼Œç„¶åè¿™å¾ˆå¯èƒ½å°±æ˜¯è¿™ä¸ªç¨‹åºçŒ¿æœ€å¤§çš„è´¢å¯Œäº†ã€‚ ä¹ä¸€æƒ³ï¼Œæ€ä¹ˆæœ‰ç‚¹æ­¦åŠŸç§˜è¯€çš„æ„Ÿè§‰ï¼Ÿ 1971å¹´ï¼Œè¿˜åœ¨IBMæ¨å‡ºäº†ç¬¬ä¸€æ¬¾8è‹±å¯¸çš„è½¯ç›˜ï¼Œè¿™æ˜¯ä¸€ç§ç›´å¾„8è‹±å¯¸çš„è¡¨é¢æ¶‚æœ‰é‡‘å±æ°§åŒ–ç‰©çš„å¡‘æ–™è´¨ç£ç›˜ï¼Œè¿™ä¸ªå°±æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç°ä»£è½¯ç›˜é©±åŠ¨å™¨çš„é¼»ç¥–äº†ã€‚ â–²å›¾ä¸º8è‹±å¯¸è½¯ç›˜ï¼ˆå›¾ç‰‡æ¥æºè§æ°´å°ï¼‰ 3ã€ç£ç›˜ä¹‹çˆ¶â€”â€”Alan Shugartäº‹å®ä¸Šï¼Œè½¯ç›˜çš„æˆåŠŸæ¨å‡ºå¹¶æ²¡æœ‰æˆ‘ä»¬å­—é¢ä¸Šç†è§£çš„è¿™ä¹ˆç®€å•ï¼Œå…¶å®æ—©åœ¨20ä¸–çºª50å¹´ä»£æ—¶ï¼ŒIBMå…¬å¸è‘£äº‹é•¿å°æ‰˜é©¬æ–¯Â·æ²ƒæ£®è¿…é€ŸæŠŠäº‹ä¸šæ‰©å±•åˆ°ç¾å›½è¥¿æµ·å²¸ï¼Œä¸‹ä»¤åœ¨åŠ åˆ©ç¦å°¼äºšåœ£ä½•å¡å¸‚é™„è¿‘æ–°å»ºå®éªŒå®¤å’Œå·¥å‚ã€‚çº¦ç¿°é€Šå¸¦é¢†ç€30å¤šåé’å¹´å·¥ç¨‹å¸ˆï¼Œåœ¨ä¸åˆ°ä¸‰å¹´æ—¶é—´ï¼Œå°±ä¸ºIBMåˆ›é€ äº†å¼•äººæ³¨ç›®çš„æŠ€æœ¯æˆæœâ€”â€”ç£ç›˜å­˜å‚¨å™¨ã€‚åœ¨çº¦ç¿°é€Šé¢†å¯¼IBMåœ£ä½•å¡å®éªŒå®¤ç ”åˆ¶ç¡¬ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä½åå«Alan Shugartçš„é’å¹´å·¥ç¨‹å¸ˆå‘æŒ¥äº†å…³é”®ä½œç”¨ã€‚ å®é™…ä¸Šï¼ŒAlan Shugartä¹Ÿæ˜¯ä¸€ä¸ªç¡…è°·çš„ä¼ å¥‡äººç‰©ï¼Œå¹´å¹¼å®¶è´«çš„ä»–æ›¾ç»ä¸‰åº¦åˆ›ä¸šï¼Œå¹¶ä¸”ä¸¤åº¦è¢«è‡ªå·±å…¬å¸çš„è‘£äº‹ä¼šæ‰«åœ°å‡ºé—¨ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†è‘—åçš„å¸Œæ·å…¬å¸ï¼ˆå…¨çƒæœ€å¤§çš„PCç¡¬ç›˜åˆ¶é€ å•†ä¹‹ä¸€ï¼‰ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™ä½ä»¤äººæ•¬ä½©çš„å‰è¾ˆè¿˜æ˜¯ä¿æŒç€å¯¹ç”Ÿæ´»çš„çƒ­çˆ±ï¼Œå®åœ¨æ˜¯å€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚ åæ¥å› ä¸ºAlan Shugartå¯¹äºç£ç›˜çš„æ°å‡ºè´¡çŒ®ï¼Œäººä»¬äº²åˆ‡åœ°ç§°å‘¼ä»–ä¸ºç£ç›˜ä¹‹çˆ¶ã€‚ â–²Alan Shugart 4ã€5.25è‹±å¯¸è½¯ç›˜ä¸Šé¢è¯´åˆ°çš„Alan Shugartï¼Œä¸ä¹…åå°±ç¦»å¼€äº†IBMï¼Œå¹¶ä¸”åˆ›åŠäº†ä¸€å®¶åä¸ºShugart Associatesçš„å…¬å¸ã€‚æ²¡é”™ï¼Œå°±æ˜¯ç”¨ä»–è‡ªå·±çš„åå­—å‘½åçš„å…¬å¸ã€‚ å½“æ—¶Alan Shugartå’Œå…¶ä»–å‡ ä½è”åˆåˆ›å§‹äººçš„ç›®æ ‡å°±æ˜¯æ‰“é€ ä¸€å®¶å‡ºè‰²çš„å…«è‹±å¯¸è½¯ç›˜é©±åŠ¨å™¨åˆ¶é€ å…¬å¸ã€‚å› ä¸ºï¼Œå½“æ—¶è½¯ç›˜é©±åŠ¨å™¨åˆ¶é€ å·¥ä¸šåˆšåˆšèµ·æ­¥ï¼Œè€Œä¸”è¿™é¡¹æŠ€æœ¯æ˜¯IBMå…¬å¸çš„è–„å¼±ç¯èŠ‚ã€‚äºæ˜¯ï¼Œä»–ä»¬å°±å†³å®šä»¥æ­¤ä¸ºå¥‘æœºå¤§å¹²ä¸€åœºã€‚ ä½†æ˜¯ï¼Œ8è‹±å¯¸è½¯ç›˜è™½ç„¶ä¾¿æºï¼Œå§‹ç»ˆè¿˜æ˜¯å¤§äº†äº›ã€‚åæ¥ä»–ä»¬å°±æ¨å‡ºäº†5.25è‹±å¯¸çš„è½¯ç›˜ã€‚ â–²å¦‚å›¾ä»å·¦å¾€å³ä»¥æ­¤ä¸º3.5/5.25/8è‹±å¯¸è½¯ç›˜ï¼ˆå›¾ç‰‡æ¥æºè§æ°´å°ï¼‰ 5ã€3.5è‹±å¯¸è½¯ç›˜5.25è‹±å¯¸çš„è½¯ç›˜è™½ç„¶ä»ä½“ç§¯åˆ°å®¹é‡ä¸Šéƒ½æœ‰äº†ä¸€å®šçš„è¿›æ­¥ï¼Œä½†å®ƒè¿˜æ˜¯æœ‰å¾ˆå¤šç¼ºç‚¹ï¼Œæ¯”å¦‚è½¯ç›˜é‡‡ç”¨çš„å¤–åŒ…è£…æ¯”è¾ƒè„†å¼±ï¼Œå®¹æ˜“æŸåï¼Œä½“ç§¯ä¹Ÿæ¯”è¾ƒå¤§ã€‚å› æ­¤å¾ˆå¤šå‚å®¶å¹¶æ²¡æœ‰æ»¡è¶³äºè¿™ç§è½¯ç›˜ï¼Œä»–ä»¬éƒ½åœ¨ä¸æ–­åœ°è¿›è¡Œæ¢ç´¢ï¼Œä»¥å¯»æ±‚æ›´ä¸ºå…ˆè¿›çš„è½¯ç›˜ã€‚ æ–°ä¸€ä»£è½¯ç›˜çš„å¼€å‘ç»ˆäºè¢«æ—¥æœ¬çš„ç´¢å°¼å…¬å¸æ‹”å¾—å¤´ç­¹ã€‚ 1980å¹´ï¼Œç´¢å°¼å…¬å¸ç‡å…ˆæ¨å‡ºä½“ç§¯æ›´å°ã€å®¹é‡æ›´å¤§çš„3.5è‹±å¯¸è½¯é©±å’Œè½¯ç›˜ï¼Œä¸è¿‡åˆšæ¨å‡ºçš„æ—¶å€™åœ¨å½“æ—¶å¹¶æ²¡æœ‰è¢«ä¸€äº›ä¸»è¦PCå‚å®¶æ‰€æ¥å—ï¼Œå¸‚é¢ä¸Šæµè¡Œçš„ä¾æ—§æ˜¯5.25è‹±å¯¸çš„è½¯ç›˜ã€‚ 1982å¹´ï¼Œå¾®è½¯åŸºäºç´¢å°¼çš„3.5è‹±å¯¸è½¯ç›˜æ ‡å‡†åˆ¶å®šäº†ç»Ÿä¸€çš„è¡Œä¸šæ ‡å‡†ã€‚ ä½†æ˜¯æ ‡å‡†åˆ¶å®šäº†æ˜¯ä¸€å›äº‹å„¿ï¼Œäººå®¶ç”¨ä¸ç”¨å°±æ˜¯å¦å¤–ä¸€å›äº‹å„¿äº†ã€‚å…³äº3.5è‹±å¯¸è½¯ç›˜çš„æ™®åŠï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜è¦æä¸€ä¸‹è‹¹æœå…¬å¸ã€‚ 1984å¹´ï¼Œè‹¹æœæ¨å‡ºçš„éº¦é‡‘å¡”ï¼ˆMacintoshï¼‰ç”µè„‘ï¼Œæ ¹æœ¬å°±ä¸å­˜åœ¨5.25è‹±å¯¸è½¯ç›˜æ¥å£è¿™ç§ä¸œè¥¿ï¼Œç›´æ¥å°±ä¸Šäº†3.5è‹±å¯¸çš„è½¯ç›˜æ¥å£ã€‚è¿™ä¸ªèƒ½ä¸èƒ½ç®—æ˜¯å¸®å¿™æ™®åŠå°ä¸ƒè¿˜çœŸçš„è¯´ä¸å‡†ï¼Œä½†æ˜¯è‡³å°‘å¯ä»¥è¯´æ˜è‹¹æœåœ¨æ¢æ¥å£è¿™ä»¶äº‹ä¸Šè¿˜æ˜¯ä¸é—ä½™åŠ›çš„ã€‚ 2016æ¬¾MacBookProï¼šå–µå–µå–µï¼Ÿ ä¸ºä»€ä¹ˆè¦å ç”¨ABä¸¤ä¸ªç›˜ç¬¦è€Œä¸æ˜¯Aä¸€ä¸ªï¼Ÿ è¿™ä¸ªè¯´èµ·æ¥å°±æœ‰ç‚¹æ‰å¿ƒäº†ã€‚å½“å¹´çš„è½¯ç›˜å®¹é‡æ™®éä¸å¤§ï¼Œä¸€èˆ¬éƒ½æ˜¯å‡ åKBã€‚åæ¥å¤§çš„æœ‰å‡ MBã€‚ é‚£ä¹ˆæˆ‘ä»¬è¯´å›ä¸€å¼€å§‹è½¯ç›˜å®¹é‡è¿˜æ˜¯å‡ åKBçš„æ—¶å€™ã€‚å‡è®¾åªæœ‰ä¸€ä¸ªè½¯ç›˜æ¥å£ï¼Œç„¶åä½ éœ€è¦ä»ä¸€å¼ è½¯ç›˜å¤åˆ¶æ•°æ®åˆ°å¦ä¸€å¼ è½¯ç›˜ä¸Šï¼Œä½ åªèƒ½å…ˆå°†æ•°æ®å¤åˆ¶åˆ°åŠå¯¼ä½“å†…å­˜ï¼ˆRAMï¼‰ä¸­ï¼Œç„¶åæ‹”å‡ºç¬¬ä¸€å¼ è½¯ç›˜å†æ’å…¥å¦ä¸€å¼ è½¯ç›˜å®Œæˆå¤åˆ¶ã€‚ é‚£ä¹ˆç°åœ¨é—®é¢˜æ¥äº†ï¼š å‡è®¾æˆ‘è¦ä¸€æ¬¡å¤åˆ¶60KBçš„æ•°æ®ï¼Œè€ŒRAMåªæœ‰32KBé‚£æ€ä¹ˆåŠï¼Ÿ é¢â€¦â€¦å¥½å§ï¼Œé‚£å°±ç»™ä½ ä¸¤ä¸ªè½¯ç›˜æ¥å£å§ã€‚ è¿˜æœ‰ä¸€è¯´æ˜¯éšç€æ“ä½œç³»ç»Ÿçš„å‘å±•ï¼Œä¸€äº›æŒ‡ä»¤ä¸èƒ½åƒä»¥å‰é‚£æ ·å°†å…¶ä»è½¯ç›˜ä¸­å­˜æ”¾åˆ°RAMä¸­æ“ä½œï¼Œå› æ­¤éœ€è¦é¢å¤–è¯»å–æ“ä½œæ•°æ®çš„æ—¶å€™åªèƒ½å†å¤šåŠ ä¸€ä¸ªè½¯ç›˜æ¥å£ã€‚ ä¸ç®¡æ€ä¹ˆè¯´ï¼Œä¸¤ä¸ªè½¯ç›˜æ¥å£åœ¨æŸäº›æ—¶å€™æ€»æ˜¯æ¯”ä¸€ä¸ªè¦æ–¹ä¾¿å¾ˆå¤šçš„ã€‚ 6ã€ç¡¬ç›˜é©±åŠ¨å™¨äººçš„é‡å¿ƒæ˜¯æ°¸è¿œæ²¡æœ‰åŠæ³•æ»¡è¶³çš„ï¼Œä¸ç„¶å°±ä¸ä¼šæœ‰ç§‘æŠ€çš„è¿›æ­¥è¿™ä¸€å›äº‹å„¿äº†ã€‚ç¡¬ç›˜å½“ç„¶æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œå¾ˆå¿«äººä»¬å°±å‘æ˜äº†å­˜å‚¨å®¹é‡æ›´å¤§çš„ç¡¬ç›˜é©±åŠ¨å™¨ï¼ˆå³ä¸ºæˆ‘ä»¬ç°åœ¨ç”¨çš„æœºæ¢°ç¡¬ç›˜ï¼‰ï¼Œç¡¬ç›˜é©±åŠ¨å™¨ä¹Ÿå¾ˆå¿«å‡­å€Ÿå…¶å®¹é‡å¤§ï¼Œé€Ÿåº¦å¿«çš„ä¼˜åŠ¿è·å¾—äº†å¹¿å¤§äººæ°‘ç¾¤ä¼—çš„å–œçˆ±å’Œæ”¯æŒã€‚ ä½†æ˜¯ï¼Œæ—©æœŸçš„ç¡¬ç›˜é©±åŠ¨å™¨åªèƒ½ä½œä¸ºè½¯ç›˜çš„â€œä»å±â€ã€‚ è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯è¯´ç¡¬ç›˜é©±åŠ¨å™¨åˆšå‡ºæ¥çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿè¿˜æ˜¯è£…åœ¨è½¯ç›˜ä¸Šé¢çš„ï¼Œå¼€æœºè¿˜æ˜¯å¾—è¦åƒä¹‹å‰é‚£æ ·ï¼Œå…ˆæ’å…¥è½¯ç›˜ï¼Œç„¶åå¼€æœºï¼Œç”µè„‘ä»è½¯ç›˜ä¸­è¯»å–æ•°æ®è¿›è¡Œæ“ä½œï¼Œç¡¬ç›˜è¿˜æ˜¯ä¸èƒ½å½“ä½œå¯åŠ¨ç›˜çš„ã€‚æ‰€ä»¥ç¡¬ç›˜é©±åŠ¨å™¨çš„ç›˜ç¬¦å°±æ˜¯ä»Cå¼€å§‹çš„ã€‚ ç„¶è€Œéšç€æŠ€æœ¯çš„å‘å±•ï¼Œåˆ°äº†MS-DOS 5.0æ—¶ä»£ï¼Œå¾®è½¯å®˜æ–¹é’¦å®šäº†Cç›˜ä½œä¸ºç³»ç»Ÿçš„å¯åŠ¨ç›˜/ä¸»ç¡¬ç›˜ã€‚ éšåï¼Œè½¯ç›˜æ¸æ¸åœ°è¢«æ·˜æ±°ï¼Œä½†æ˜¯ABè¿™ä¸¤ä¸ªç›˜ç¬¦è¿˜æ˜¯ä¸ºä»–ä»¬ç©ºå‡ºæ¥äº†ã€‚ 2006å¹´ï¼ŒAlan Shugartå› å¿ƒè„ç—…æ‰‹æœ¯å¤±è´¥è€Œæ°¸è¿œç¦»å¼€äº†æˆ‘ä»¬ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"operatingsystem","slug":"operatingsystem","permalink":"https://tinychen.com/tags/operatingsystem/"}]},{"title":"é©±åŠ¨å¤‡ä»½(å…ç¬¬ä¸‰æ–¹)","slug":"20170509-backup-drivers","date":"2017-05-09T07:00:00.000Z","updated":"2017-05-09T07:00:00.000Z","comments":true,"path":"20170509-backup-drivers/","link":"","permalink":"https://tinychen.com/20170509-backup-drivers/","excerpt":"ç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªç”¨win10è‡ªå¸¦å‘½ä»¤å®Œæˆé©±åŠ¨å¤‡ä»½çš„æ–¹æ³•ã€‚","text":"ç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªç”¨win10è‡ªå¸¦å‘½ä»¤å®Œæˆé©±åŠ¨å¤‡ä»½çš„æ–¹æ³•ã€‚ 1ã€ä»€ä¹ˆæ˜¯é©±åŠ¨ï¼Ÿé©±åŠ¨çš„è‹±æ–‡åç§°å«åšdriverï¼Œä¸€è¯´åˆ°driverï¼Œå¤§å®¶å°±æ‡‚äº†ï¼Œå¸æœºå˜›ã€‚ æ²¡é”™ï¼Œé©±åŠ¨å°±æ˜¯å¸æœºï¼Œåªä¸æ˜¯é©±åŠ¨æ˜¯é©¾é©­ç¡¬ä»¶çš„å¸æœºï¼Œè€Œé©±åŠ¨æ˜¯å¬ä»äºç³»ç»Ÿå’Œè½¯ä»¶çš„è°ƒé…çš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œé©±åŠ¨æ˜¯æ²Ÿé€šç¡¬ä»¶å’Œè½¯ä»¶çš„æ¡¥æ¢ã€‚ é‚£ä¹ˆåœ¨è£…ç³»ç»Ÿä¹‹åï¼Œä¸€å®šè¦å¹²çš„ä¸€ä»¶äº‹å°±æ˜¯è£…é©±åŠ¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè£…é©±åŠ¨æœ‰ä¸‰ç§æ–¹æ³•ï¼š ä¸€æ˜¯æ‰“å¼€ç³»ç»Ÿæ›´æ–°ï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨æœç´¢å®‰è£…ï¼› äºŒæ˜¯è‡ªå·±æ‰‹åŠ¨ä¸‹è½½ï¼Œå»å®˜ç½‘ç­‰æ¯”è¾ƒå¯é çš„ç½‘ç«™ä¸‹è½½ç„¶åæ‰‹åŠ¨å®‰è£…ï¼› ä¸‰æ˜¯ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œä¸‹ä¸ªé©±åŠ¨ç²¾çµé©±åŠ¨äººç”Ÿä»€ä¹ˆçš„ä¸€é”®å®‰è£…ã€‚ è¿™ä¸‰ç§æ–¹æ³•éƒ½å„æœ‰ä¼˜åŠ£ï¼Œä½†æ˜¯ï¼Œæœ‰ä¸€ç‚¹å®ƒä»¬æ˜¯ä¸€æ ·çš„ï¼Œé‚£å°±æ˜¯éƒ½éœ€è¦è”ç½‘ä¸‹è½½ã€‚ä¸€äº›å°çš„é©±åŠ¨è¿˜å¥½ï¼Œå‡ MBæˆ–è€…å‡ åMBï¼Œå¤§çš„è½»æ¾è¾¾åˆ°å››äº”ç™¾MBï¼Œä¸‹è½½èµ·æ¥è´¹æ—¶è´¹åŠ›ï¼Œå› æ­¤æœ€å¥½çš„æ–¹æ³•å½“ç„¶æ˜¯äº‹å…ˆå¤‡ä»½ã€‚ è€Œå¯¹äºå¤§å¤šæ•°äººæ¥è¯´ï¼Œå¤‡ä»½å°±æ˜¯ä¸‹è½½ä¸€ä¸ªé©±åŠ¨ç²¾çµ/é©±åŠ¨äººç”Ÿä»€ä¹ˆçš„è½¯ä»¶ï¼Œç„¶åå†ä¸€é”®å¤‡ä»½ï¼Œæ¢å¤çš„æ—¶å€™å†å®‰è£…è¿™ä¸ªè½¯ä»¶æ¥æ¢å¤ã€‚ å°ä¸ƒä¸ªäººè¿˜æ˜¯æ¯”è¾ƒå–œæ¬¢ç”¨ç³»ç»Ÿè‡ªå¸¦çš„å‘½ä»¤æ¥å®Œæˆå¤‡ä»½è¿™ä¸ªæ“ä½œã€‚ 2ã€æ–¹æ³•2.1 æ–°å»ºå¤‡ä»½ç›®å½•æˆ‘ä»¬é¦–å…ˆåœ¨éCç›˜çš„ç£ç›˜é©±åŠ¨å™¨é‡Œé¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå‘½åçš„è¯éšæ„ï¼Œè‡ªå·±èƒ½è®°ä½å°±è¡Œï¼Œå»ºè®®ç›´æ¥æ–°å»ºåœ¨æ ¹ç›®å½•ï¼Œè¿™æ ·åé¢ä¼šæ¯”è¾ƒæ–¹ä¾¿æ“ä½œï¼ˆè¿™é‡Œå°ä¸ƒåœ¨Xç›˜æ ¹ç›®å½•ä¸‹æ–°å»ºäº†ä¸€ä¸ªåä¸ºdriversçš„æ–‡ä»¶å¤¹ï¼‰ï¼› 2.2 æ‰¾åˆ°CMD/Powershellç”±äºæ¥ä¸‹æ¥çš„æ“ä½œéœ€è¦ç³»ç»Ÿç®¡ç†å‘˜çš„æƒé™ï¼Œè€Œä¸€èˆ¬åœ¨è¿è¡Œèœå•ä¸­è¿è¡ŒCMDæ˜¯æ²¡æœ‰ç³»ç»Ÿç®¡ç†å‘˜æƒé™çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰¾åˆ°CMDï¼Œå¹¶ä¸”å°†ä»–å‘é€åˆ°æ¡Œé¢å¿«æ·æ–¹å¼ä»¥ä¾¿äºä»¥åæ“ä½œï¼Œç›®å½•ï¼šC:\\Windows\\System32 å°ä¸ƒæ³¨ï¼šæ¸©é¦¨æç¤ºï¼šå¾®è½¯åœ¨Win10åˆ›æ„è€…ç‰ˆæœ¬ä¹‹åå·²ç»ä½¿ç”¨äº†åŠŸèƒ½æ›´åŠ å¼ºå¤§çš„Powershellæ¥æ›¿ä»£CMDæˆä¸ºç³»ç»Ÿçš„é»˜è®¤å‘½ä»¤æ‰§è¡Œå·¥å…·ï¼Œä½†æ˜¯CMDä¾æ—§å¯ç”¨ï¼ˆå°±æ˜¯ç›¸å½“äºä½ çš„é»˜è®¤éŸ³ä¹æ’­æ”¾å™¨ä»é…·ç‹—éŸ³ä¹å˜æˆäº†ç½‘æ˜“äº‘éŸ³ä¹ï¼‰ï¼Œå› æ­¤å¹¶ä¸å½±å“æœ¬æ¬¡æ“ä½œã€‚ å› æ­¤æ‰€æœ‰èƒ½å¤Ÿç”¨CMDå®Œæˆçš„æ“ä½œï¼Œç”¨POWERSHELLä¹Ÿèƒ½å¤Ÿå®Œæˆï¼Œå…·ä½“ä½¿ç”¨å“ªä¸ªçœ‹ç«¥é‹ä»¬è‡ªå·±çš„çˆ±å¥½ã€‚ä¸å«Œéº»çƒ¦çš„åŒå­¦å¯ä»¥ç›´æ¥å¿½ç•¥ä¸Šä¸€æ­¥ï¼Œæ‰¾åˆ°CMDåï¼Œå³é”®é€‰æ‹©ä»¥ç³»ç»Ÿç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼› 2.3 å¼€å§‹å¤‡ä»½ç„¶åæˆ‘ä»¬åœ¨CMDçª—å£ä¸­è¾“å…¥ä¸‹åˆ—å‘½ä»¤ï¼š 1dism /online /export-driver /destination:X:\\drivers æ³¨æ„ï¼šXï¼šdriverséƒ¨åˆ†ä¸ºé©±åŠ¨çš„å¤‡ä»½ç›®å½•ï¼Œæ ¹æ®æƒ…å†µä¸åŒæ­¤å¤„ä¹Ÿæœ‰æ‰€ä¸åŒã€‚ ç„¶åç¨ç­‰ç‰‡åˆ»ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤‡ä»½æ‰€æœ‰çš„é©±åŠ¨ï¼› é©±åŠ¨çš„å…·ä½“æ•°é‡å› ç”µè„‘è€Œå¼‚ï¼Œé©±åŠ¨çš„æ•°é‡å¤šå°‘ä¸ç”µè„‘çš„è´¨é‡å¹¶æ²¡æœ‰å¿…ç„¶è”ç³»ã€‚ æ“ä½œå®Œæˆä¹‹åæˆ‘ä»¬å†æ‰“å¼€åˆšåˆšé€‰æ‹©çš„å¤‡ä»½æ–‡ä»¶å¤¹çœ‹çœ‹ï¼Œä¼šå‘ç°å¤šäº†å¾ˆå¤šæ–‡ä»¶å¤¹ã€‚ æ¯ä¸ªæ–‡ä»¶å¤¹éƒ½å¯¹åº”ç€ä¸€ä¸ªé©±åŠ¨ã€‚çœ‹åˆ°è¿™é‡Œå¯èƒ½æœ‰äº›ç«¥é‹å°±æ‡µäº†ï¼Œè¿™å‘½åï¼Œæˆ‘æ€ä¹ˆçŸ¥é“å“ªä¸ªæ–‡ä»¶å¤¹æ˜¯å“ªä¸ªé©±åŠ¨å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šä¸éœ€è¦çŸ¥é“ã€‚ 2.4 æ¢å¤é©±åŠ¨å½“æˆ‘ä»¬éœ€è¦å®‰è£…é©±åŠ¨çš„æ—¶å€™ï¼Œç›´æ¥æ‰“å¼€è®¾å¤‡ç®¡ç†å™¨ ç‚¹å‡»å·¦ä¸Šè§’çš„è®¾å¤‡ç®¡ç†å™¨ â‘ æ‰¾åˆ°éœ€è¦å®‰è£…çš„é©±åŠ¨ï¼ˆä¸€èˆ¬é©±åŠ¨ç¨‹åºæœ‰é—®é¢˜çš„ç¡¬ä»¶è®¾å¤‡éƒ½ä¼šæœ‰ä¸€ä¸ªé»„è‰²çš„æ„Ÿå¹å·ï¼‰ â‘¡å³é”®ç‚¹å‡»æˆ‘ä»¬éœ€è¦å®‰è£…é©±åŠ¨ç¨‹åºçš„ç¡¬ä»¶ï¼Œé€‰æ‹©æ›´æ–°é©±åŠ¨ç¨‹åºè½¯ä»¶ â‘¢é€‰æ‹©ä¸‹é¢çš„æµè§ˆè®¡ç®—æœºä»¥æŸ¥æ‰¾é©±åŠ¨ç¨‹åºè½¯ä»¶ â‘£ç„¶åé€‰æ‹©åˆšåˆšå¤‡ä»½çš„ç›®å½•ï¼Œå¹¶é»˜è®¤å‹¾é€‰ä¸‹é¢çš„åŒ…æ‹¬å­æ–‡ä»¶å¤¹ï¼Œç„¶åç³»ç»Ÿä¼šè‡ªåŠ¨å¸®ä½ æœç´¢å®‰è£…é©±åŠ¨ç¨‹åº â‘¤æœ€åå®‰è£…å®Œæˆ è¿™ä¸ªæ“ä½œéš¾åº¦ä¸å¤§ï¼Œåªè¦è®°ä½ä¸€æ¡å‘½ä»¤å³å¯ã€‚é€‚ç”¨äºé‚£äº›ä¸å–œæ¬¢ä½¿ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶å®‰è£…å¤‡ä»½é©±åŠ¨çš„äººç¾¤ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"}]},{"title":"å®‰å“åˆ·æœºåŸºç¡€","slug":"20170507-android","date":"2017-05-07T07:00:00.000Z","updated":"2017-05-07T07:00:00.000Z","comments":true,"path":"20170507-android/","link":"","permalink":"https://tinychen.com/20170507-android/","excerpt":"å› æ­¤å°ä¸ƒæ•´ç†äº†ä¸€äº›å¸¸è§çš„å®‰å“åˆ·æœºç›¸å…³çš„åŸºç¡€æ¦‚å¿µï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶ä¸€äº›å¸®åŠ©ã€‚","text":"å› æ­¤å°ä¸ƒæ•´ç†äº†ä¸€äº›å¸¸è§çš„å®‰å“åˆ·æœºç›¸å…³çš„åŸºç¡€æ¦‚å¿µï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶ä¸€äº›å¸®åŠ©ã€‚ 1ã€ä»€ä¹ˆæ˜¯å®‰å“åˆ·æœºï¼Ÿåˆ·æœºï¼Œå°±æ˜¯é€šè¿‡ä¸€å®šçš„æŠ€æœ¯æ‰‹æ®µå‘å®‰å“æ‰‹æœºä¸­åˆ·å…¥ROMçš„è¿‡ç¨‹ã€‚é‚£ä¹ˆéšç€åˆ·æœºçš„ä¸æ–­å‘å±•ï¼Œåˆ·å…¥çš„ä¸œè¥¿ç±»å‹ä¹Ÿåœ¨é€æ¸å¢å¤šï¼ŒåŒ…æ‹¬RECã€ROMã€å†…æ ¸ç”šè‡³æ˜¯åŸºå¸¦å›ºä»¶ç­‰ç­‰ã€‚ 2ã€åˆ·æœºæ–¹å¼éƒ½æœ‰å“ªäº›ï¼Ÿç›®å‰æ¥è¯´ï¼Œä¸»æµçš„åˆ·æœºæ–¹å¼åŸºæœ¬å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šçº¿åˆ·å’Œå¡åˆ·ã€‚çº¿åˆ·å’Œå¡åˆ·æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼šçº¿åˆ·åˆ·æœºæ—¶éœ€è¦é€šè¿‡USBæ•°æ®çº¿æ“ä½œ,è€Œå¡åˆ·æ˜¯é€šè¿‡å†…å­˜å¡è¿›è¡Œæ“ä½œã€‚ 2.1 å…³äºå¡åˆ·å› ä¸ºåœ¨æ—©æœŸï¼Œå®‰å“æ‰‹æœºçš„å†…å­˜æ™®éåå°ï¼Œå› æ­¤ä¸€èˆ¬ä¼šé€šè¿‡æ”¯æŒå†…å­˜å¡çš„æ–¹å¼æ¥è®©ç”¨æˆ·è·å¾—æ›´å¤§çš„å­˜å‚¨ç©ºé—´ã€‚è€Œåˆ·æœºåŒ…ç›¸å¯¹äºæ—©æœŸçš„æ‰‹æœºæ¥è¯´ï¼Œç®—æ˜¯æ¯”è¾ƒå¤§çš„äº†ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯å°†åˆ·æœºåŒ…å¤åˆ¶è¿›å…¥å†…å­˜å¡ä¸­ï¼Œå†é€šè¿‡RECå°†åˆ·æœºåŒ…åˆ·å…¥ï¼Œæœ€ç»ˆå®Œæˆæ•´ä¸ªåˆ·æœºæ“ä½œã€‚è¿™é‡Œæä¸€ä¸‹ï¼Œæˆ‘ä»¬å¹³æ—¶çš„æ­£å¸¸æƒ…å†µä¸‹çš„æ‰‹æœºç³»ç»Ÿå‡çº§ï¼Œå…¶å®å°±æ˜¯å¡åˆ·çš„ä¸€ç§ã€‚ç³»ç»Ÿå°†ç³»ç»Ÿæ›´æ–°æ–‡ä»¶ä¸‹è½½åˆ°æ‰‹æœºå­˜å‚¨ç©ºé—´ä¸­ï¼Œç„¶åé‡å¯é€šè¿‡RECåˆ·å…¥æ›´æ–°çš„å¢é‡åŒ…æˆ–è€…æ˜¯å®Œæ•´çš„åˆ·æœºåŒ…ã€‚ æ¸©é¦¨æç¤ºï¼š 1ã€å¢é‡åŒ…æŒ‡çš„æ˜¯åœ¨æŸä¸ªç‰¹å®šçš„ç³»ç»Ÿç‰ˆæœ¬ä¸Šæ›´æ–°åŠ å…¥æŸäº›åŠŸèƒ½çš„æ›´æ–°åŒ…ï¼Œå®ƒæ˜¯ä¸å¸¦æœ‰å®Œæ•´çš„æ•´ä¸ªæ‰‹æœºæ“ä½œç³»ç»Ÿçš„ï¼Œå› æ­¤åœ¨åˆ·æœºçš„æ—¶å€™æ˜¯ä¸èƒ½å½“ä½œåˆ·æœºåŒ…ä½¿ç”¨çš„ã€‚ 2ã€æœ‰äº›æ‰‹æœºå°½ç®¡ä¸æ”¯æŒå†…å­˜å¡ï¼Œä½†æ˜¯ä¼šå°†æ‰‹æœºè‡ªå¸¦çš„å­˜å‚¨ç©ºé—´åˆ’åˆ†ä¸€éƒ¨åˆ†å‡ºæ¥å½“ä½œå†…å­˜å¡ï¼Œè¿™éƒ¨åˆ†çš„ç©ºé—´åœ¨åœ°ä½ä¸Šè·Ÿå†…å­˜å¡æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ä¸èƒ½åƒå†…å­˜å¡é‚£æ ·å–å‡ºæ‰‹æœºè¿›è¡Œè¯»å†™æ“ä½œã€‚è¿™ç§æƒ…å†µå‰ä¸¤å¹´è¿˜æ¯”è¾ƒå¸¸è§ï¼Œç°åœ¨è¿™ä¹ˆæ“ä½œçš„æ‰‹æœºå¥½åƒæ¯”è¾ƒå°‘äº†ã€‚ 2.2 å…³äºçº¿åˆ·çº¿åˆ·æœ€æ˜æ˜¾çš„ç‰¹ç‚¹å°±æ˜¯éœ€è¦é€šè¿‡æ•°æ®çº¿æ¥æ“ä½œï¼Œå› æ­¤åœ¨çº¿åˆ·çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦éå¸¸æ³¨æ„æ•°æ®çº¿å’Œæ‰‹æœºçš„è¿æ¥æƒ…å†µï¼Œåƒä¸‡ä¸èƒ½æ–­å¼€æ•°æ®çº¿æˆ–è€…æ˜¯å…³é—­è®¡ç®—æœºæˆ–è€…æ˜¯å…³é—­æ‰‹æœºç­‰ã€‚ åŒæ ·åœ°ï¼Œç”±äºçº¿åˆ·éœ€è¦ä½¿ç”¨æ•°æ®çº¿çš„ç‰¹ç‚¹ï¼Œå®ƒæ‰€èƒ½å¤Ÿè¿›è¡Œçš„æ“ä½œä¹Ÿå°±æ¯”å¡åˆ·æ›´å¤šï¼ŒåŒæ—¶ä¹Ÿæ›´å±é™©ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ä¹‹å‰çš„åˆ·å…¥RECï¼Œå°±æ˜¯é€šè¿‡çº¿åˆ·æ“ä½œçš„ã€‚è€Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ‰‹æœºä¸å°å¿ƒåˆ·æˆç –äº†ï¼Œæ•‘ç –æ“ä½œä¹Ÿæ˜¯éœ€è¦é€šè¿‡çº¿åˆ·è¿›è¡Œçš„ã€‚ è€Œç°åœ¨å¾ˆå¤šæ‰‹æœºå‚å•†æä¾›çš„å®˜æ–¹åˆ·æœºåŠ©æ‰‹ï¼Œéƒ½æ˜¯éœ€è¦è¿æ¥æ•°æ®çº¿æ¥è¿›è¡Œæ“ä½œï¼Œå› æ­¤ä¹Ÿæ˜¯å±äºçº¿åˆ·ã€‚ ç”±äºç°åœ¨æ‰‹æœºå·²ç»æœ‰å–æ¶ˆæ”¯æŒSDå¡æ‹“å±•çš„è¿™ä¸ªè¶‹åŠ¿ï¼Œå› æ­¤çº¿åˆ·çš„é‡è¦æ€§ä¹Ÿå°±å‡¸ç°å‡ºæ¥äº†ã€‚ä½†æ˜¯æœªæ¥çº¿åˆ·å’Œå¡åˆ·åº”è¯¥æ˜¯ä¼šå¹¶å­˜çš„ï¼ŒåŸå› å¾ˆç®€å•ï¼šå¡åˆ·å¯ä»¥è¿›è¡Œç®€å•çš„åˆ·æœºå’Œç³»ç»Ÿæ›´æ–°ç­‰æ“ä½œï¼Œçº¿åˆ·åˆ™å¯ä»¥è¿›è¡Œæ›´æ·±åº¦æ›´æ•æ„Ÿçš„æ“ä½œã€‚ 3ã€ä»€ä¹ˆæ˜¯ROM imageï¼Ÿå¯¹äºå®‰å“åˆ·æœºæ¥è¯´ï¼Œè¿™ä¸ªROM imageè·Ÿæˆ‘ä»¬ä¸€èˆ¬è¯´çš„ROMæ˜¯ä¸¤ä¸ªä¸œè¥¿ã€‚è¿™é‡Œæˆ‘ä»¬ç®€å•åœ°è®²ä¸€ä¸‹ROMå’ŒRAMè¿™å¯¹åŒå­æ˜Ÿã€‚ 3.1 RAMRAMçš„å…¨ç§°æ˜¯Random Access Memoryï¼Œä¸­æ–‡åæ˜¯éšæœºå­˜å–å­˜å‚¨å™¨ï¼Œæˆ‘ä»¬æ—¥å¸¸ç§°ä¹‹ä¸ºè¿è¡Œå†…å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ä¸èƒ½å¤Ÿæ–­ç”µä¿å­˜æ•°æ®çš„ï¼Œä¸»è¦æ˜¯åœ¨æˆ‘ä»¬çš„ç”µå­äº§å“å·¥ä½œçš„æ—¶å€™ï¼Œå°†éœ€è¦è°ƒç”¨çš„æ–‡ä»¶é¢„å…ˆä»ROMä¸­è¯»å–å‡ºæ¥ï¼Œæ”¾å…¥åˆ°RAMä¸­ï¼ˆå› ä¸ºä¸€èˆ¬æ¥è¯´RAMçš„è¯»å†™é€Ÿåº¦è¦æ¯”ROMå¿«ï¼‰ï¼Œä»¥ä¾¿äºæˆ‘ä»¬çš„CPU/GPUæˆ–è€…æ˜¯SoCç­‰è°ƒç”¨ã€‚ 3.2 ROMROMçš„å…¨ç§°æ˜¯Read-Only Memoryï¼Œä¸­æ–‡åæ˜¯åªè¯»å†…å­˜ï¼Œå°±æ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„æ‰‹æœºå­˜å‚¨ç©ºé—´ï¼ˆç”¨æ¥æ”¾éŸ³ä¹å›¾ç‰‡è§†é¢‘ç­‰ç­‰çš„é‚£ä¸ªï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å¯ä»¥æ–­ç”µä¿å­˜æ•°æ®ï¼Œä¸»è¦æ˜¯ç”¨æ¥é•¿æœŸå­˜å‚¨æ•°æ®çš„ã€‚ 3.3 ROM imageROM imageçš„å…¨ç§°æ˜¯Read-Only Memory imageï¼Œç®€ç§°æ˜¯ROMï¼Œä¸­æ–‡åç§°å«åªè¯»å†…å­˜é•œåƒï¼Œå› æ­¤ä¼šæœ‰äº›å®¹æ˜“è·Ÿä¸Šé¢çš„ROMæ··æ·†ã€‚è¿™é‡Œæ³¨æ„ï¼ŒROM imageçš„å­˜åœ¨å½¢å¼æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç›¸å½“äºæˆ‘ä»¬ç”µè„‘å¹³æ—¶è£…ç³»ç»Ÿçš„é•œåƒæ–‡ä»¶ã€‚ é‚£ä¹ˆåœ¨å®‰å“åˆ·æœºä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ç”¨ROMæ¥æŒ‡ä»£è‡ªå·±è¦åˆ·å…¥çš„æ“ä½œç³»ç»Ÿã€‚ 4ã€ä»€ä¹ˆæ˜¯OSå’ŒUIï¼ŸOSå°±æ˜¯Operating Systemï¼Œä¸­æ–‡åå«åšæ“ä½œç³»ç»Ÿã€‚æ¯”å¦‚è¯´æˆ‘ä»¬çš„Windowsæ“ä½œç³»ç»Ÿï¼Œå®‰å“ï¼ˆAndroidï¼ŒåŸºäºLinuxï¼‰æ“ä½œç³»ç»Ÿï¼Œè‹¹æœæ“ä½œç³»ç»Ÿï¼ˆiOSï¼Œå…¨ç§°å«iPhone Operating Systemï¼‰éƒ½å¯ä»¥å«åšOSã€‚ è€Œå¯¹äºç§»åŠ¨ç«¯æ¥è¯´ï¼Œé™¤äº†æ¯”è¾ƒå¸¸è§çš„Androidå’Œ iOSï¼Œè¿˜æœ‰æ¯”è¾ƒå°ä¼—çš„WindowsMobileï¼ŒSailfishï¼ˆæ——é±¼ï¼‰ï¼ŒUbuntuï¼ˆä¹Œç­å›¾ï¼‰ï¼ŒBlackBerry OSï¼ˆé»‘è“ï¼‰ç­‰ç­‰ã€‚ UIå°±æ˜¯User Interfaceï¼Œä¸­æ–‡åå«åšç”¨æˆ·ç•Œé¢ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å¸¸è§çš„MIUIï¼ˆå°ç±³ï¼‰ï¼ŒEMUIï¼ˆåä¸ºï¼Œå…¨ç§°Emotion UIï¼‰ï¼ŒFlymeï¼ˆé­…æ—ï¼‰ç­‰ç­‰éƒ½æ˜¯UIã€‚ è€Œä¸€èˆ¬æ¥è¯´ï¼Œå›½å†…çš„å®‰å“å‚å•†ä¸ºäº†åšå‡ºè‡ªå·±çš„ç‰¹è‰²ï¼Œéƒ½ä¼šæœ‰å±äºè‡ªå·±çš„UIï¼Œç”±äºä»–ä»¬è¿™äº›UIéƒ½æ˜¯åŸºäºå®‰å“ï¼Œå› æ­¤ç§°ä¸ä¸Šæ˜¯OSï¼Œåªèƒ½ç®—ä½œUIã€‚å¦‚æœä½ è§åˆ°åå­—å½“ä¸­æœ‰OSçš„ï¼ˆæ²¡é”™è¯´çš„å°±æ˜¯é”¤å­çš„Smartisan OSï¼‰ï¼Œå°½ç®¡åå­—é‡Œé¢æœ‰OSï¼Œä½†æ˜¯è¿˜æ˜¯å±äºUIã€‚ ç”±äºæ‰‹æœºå‚å•†åœ¨UIçš„å‘åŠ›ç¨‹åº¦è¶Šæ¥è¶Šé«˜ï¼Œä¿®æ”¹çš„ä¸œè¥¿ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œæ‰€ä»¥å°±æœ‰ä¸€ç§å¾ˆå°´å°¬çš„æƒ…å†µå‡ºç°äº†ï¼Œè¯´å®ƒä»¬æ˜¯UIå§ï¼Œå¥½åƒåˆä¸æ­¢ï¼Œè¯´æ˜¯OSå§ï¼Œå¥½åƒåˆä¸å¤Ÿæ ¼ï¼Œç„¶åå°±æå‡ºäº†ä¸€äº›åè¯ï¼Œæ¯”å¦‚è¯´æ·±åº¦å®šåˆ¶UIç­‰ç­‰ã€‚ åˆ·æœºçš„æ—¶å€™ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¥è¯´æ˜¯ç»Ÿä¸€ä½¿ç”¨ROMæˆ–è€…æ˜¯åˆ·æœºåŒ…æ¥æŒ‡ä»£è¿™äº›ä¸œè¥¿ã€‚ 5ã€ä»€ä¹ˆæ˜¯ç –ï¼Ÿè¿™é‡Œçš„ç –è·Ÿæˆ‘ä»¬å¹³æ—¶è¯´çš„æ¬ç –çš„ç –ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚è¿™é‡Œçš„ç –æŒ‡çš„æ˜¯åœ¨åˆ·æœºè¿‡ç¨‹ä¸­å› ä¸ºæ“ä½œä¸å½“è€Œæ— æ³•æ­£å¸¸ä½¿ç”¨çš„æ‰‹æœºï¼Œç”¨ä¸äº†çš„æ‰‹æœºè·Ÿç –å¤´æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå› æ­¤äººä»¬å¾ˆå½¢è±¡åœ°ç§°ä¹‹ä¸ºç –ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç –ä¹Ÿä¼šæ ¹æ®æ‰‹æœºâ€œå—å†…ä¼¤â€çš„ç¨‹åº¦è¿›è¡Œåˆ’åˆ†ï¼Œä¸€äº›å—ä¼¤è¾ƒè½»çš„ç –è¿˜æ˜¯å¯ä»¥æ•‘å›æ¥çš„ï¼Œè€Œé‚£äº›å—ä¼¤è¾ƒé‡çš„â€¦â€¦ 6ã€ä»€ä¹ˆæ˜¯BLï¼Ÿ6.1 BLç®€ä»‹BLçš„å…¨ç§°å«åšBootloaderï¼Œä¸­æ–‡åå­—å«åšï¼ˆå°ä¸ƒä¹Ÿä¸çŸ¥é“å«ä»€ä¹ˆï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¤§å®¶éƒ½è®¤ä¸ºBootloaderæ˜¯åµŒå…¥å¼ç³»ç»Ÿåœ¨é€šç”µåæ‰§è¡Œçš„ç¬¬ä¸€æ®µä»£ç ã€‚ åœ¨è¿™é‡Œç”¨äººè¯æ¥è¯´å°±æ˜¯ï¼šæ‰‹æœºå¼€æœºè¦å¹²çš„ç¬¬ä¸€ä»¶äº‹ã€‚ BLåœ¨åŠŸèƒ½ä¸Šæœ‰äº›ç±»ä¼¼äºæˆ‘ä»¬ç”µè„‘çš„BIOSï¼Œä½†æ˜¯å®é™…ä¸Šä¸¤è€…å¹¶ä¸å®Œå…¨ä¸€æ ·ï¼Œæ‰‹æœºä¸­æ˜¯ä¸å­˜åœ¨BIOSè¿™ä¸€ä¸ªè¯´æ³•çš„ã€‚ 6.2 BLèƒ½å¹²ä»€ä¹ˆé‚£ä¹ˆè¦æ‰‹æœºåœ¨é€šç”µä¹‹åï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬æŒ‰ä¸‹å¼€æœºé”®ä¹‹åï¼‰ï¼Œéœ€è¦å¹²çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ‰“ä¸ªæ¯”æ–¹æ¥è¯´ï¼Œå°†å†›è·Ÿå£«å…µä»¬è¯´è¦å‡ºå¾äº†ï¼Œé‚£ä¹ˆå£«å…µä»¬è¦å¹²çš„ç¬¬ä¸€ä»¶äº‹å½“ç„¶æ˜¯æ£€æŸ¥ä¸€ä¸‹è‡ªå·±çš„è£…å¤‡ã€èº«ä½“çŠ¶å†µå’Œç²¾ç¥çŠ¶æ€æœ‰æ²¡æœ‰é—®é¢˜ã€‚ è€Œå¯¹äºæ‰‹æœºæ¥è¯´ï¼Œè¿™é‡Œè¦å¹²çš„äº‹æƒ…å°±æ˜¯åˆå§‹åŒ–å„ä¸ªç»„ä»¶ï¼ˆå±å¹•ã€é—ªå­˜ã€SoCã€å„ä¸ªä¼ æ„Ÿå™¨ç­‰ç­‰ï¼‰ï¼Œæ£€æŸ¥å³å°†è¿è¡Œçš„å›ºä»¶ã€ç³»ç»Ÿç­‰ç­‰æ˜¯å¦æ­£å¸¸ã€‚ 6.2.1 ä»€ä¹ˆå«é”BLæ—¢ç„¶BLèƒ½å¤Ÿæ£€æŸ¥å³å°†è¿è¡Œçš„å›ºä»¶å’Œç³»ç»Ÿï¼Œé‚£ä¹ˆæ‰‹æœºå‚å•†å°±èƒ½åœ¨BLä¸ŠåŠ¨æ‰‹ï¼Œç›´æ¥é”æ­»BLï¼Œä½¿å¾—å®ƒåªèƒ½è¯†åˆ«å®˜æ–¹çš„å›ºä»¶å’Œç³»ç»Ÿï¼Œä»è€Œç¡®å®šæ‰‹æœºçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä¸èƒ½åˆ·æœºäº†ï¼Œå› ä¸ºå¾ˆå¤šå®˜æ–¹çš„RECåªæ”¯æŒå®˜æ–¹çš„ROMï¼Œå› æ­¤åˆ·æœºå¾ˆå¤šæ—¶å€™ç¬¬ä¸€æ­¥è¦åšçš„äº‹æƒ…å°±æ˜¯è§£é”BLï¼Œè€Œå¯¹äºå¾ˆå¤šå‚å•†æ¥è¯´ï¼Œè§£é”BLæ„å‘³ç€æ”¾å¼ƒä¿ä¿®ï¼Œå› æ­¤åˆ·æœºçš„ç«¥é‹ä¸€å®šè¦æ³¨æ„ã€‚ 6.2.2 æ€ä¹ˆè§£é”BLï¼Ÿè§£é”BLçš„æ–¹æ³•æˆ‘ä»¬å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œå®˜æ–¹è§£é”å’Œæš´åŠ›è§£é”ã€‚ å®˜æ–¹è§£é”çš„æ„æ€å°±æ˜¯é€šè¿‡å®˜æ–¹æ¸ é“è§£é”ï¼Œä¸€èˆ¬æ˜¯å»å®˜ç½‘æˆ–è€…æ˜¯å®˜æ–¹è®ºå›ï¼Œæä¾›æ‰‹æœºçš„IMEIç ç­‰è¿›è¡Œç”³è¯·ï¼Œç„¶åå°±å¯ä»¥è·å¾—è§£é”BLçš„è§£é”ç ã€‚ æš´åŠ›è§£é”çš„æ„æ€å°±æ˜¯éå®˜æ–¹æ¸ é“è§£é”ï¼Œå¯¹äºä¸€äº›å‚å•†æ¥è¯´ï¼Œå®ƒä»¬æ˜¯ä¸ä¼šæä¾›BLçš„è§£é”æ–¹å¼çš„ï¼Œå› æ­¤éœ€è¦ä¸€äº›æ°‘é—´çš„å¤§ç¥ç ´è§£BLï¼Œç ´è§£çš„é€”å¾„ä¸€èˆ¬æ˜¯åˆ©ç”¨å„ç§æ¼æ´ï¼Œå› æ­¤è¿™ç§æš´åŠ›ç ´è§£çš„æ–¹æ³•éš¾åº¦è¦æ›´å¤§ä¸€äº›ã€‚ ç”±äºå®‰å“æœºå‹ä¼—å¤šï¼Œå°ä¸ƒéš¾å…ä¼šæœ‰ç–æ¼ï¼Œå°ä¸ƒå»ºè®®ç«¥é‹ä»¬å¯ä»¥å»è‡ªå·±æ‰‹æœºå¯¹åº”çš„è®ºå›æˆ–è€…æ˜¯è´´å§äº†è§£è¯¦ç»†æƒ…å†µã€‚ 7ã€ä»€ä¹ˆæ˜¯RECï¼ŸRECçš„å…¨ç§°å«åšRecoveryï¼Œç›´è¯‘ä¸­æ–‡åå«åšæ¢å¤ï¼Œç™¾åº¦ç™¾ç§‘æœ‰ä¸ªå¾ˆå¥‡æ€ªçš„ç¿»è¯‘å«åšï¼šAndroidæ‰‹æœºå¤‡ä»½åŠŸèƒ½ã€‚ å®é™…ä¸Šï¼ŒRECçš„åŠŸèƒ½è¿œä¸æ­¢å¤‡ä»½è¿™ä¹ˆç®€å•ã€‚è¿›å…¥RECæ¨¡å¼åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¡åˆ·æ¥å‡çº§æ“ä½œç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥æ“¦é™¤ï¼ˆwipeï¼‰æ‰‹æœºæ•°æ®ï¼Œè¿˜å¯ä»¥æ¢å¤å‡ºå‚è®¾ç½®ï¼Œå¤‡ä»½å½“å‰æ•°æ®ç­‰ç­‰ã€‚ ç”±äºå®‰å“ç³»ç»Ÿçš„å¤æ‚åŸç†ï¼ŒRECæ‰€å¤„äºçš„åˆ†åŒºå’Œæˆ‘ä»¬æ‰‹æœºç³»ç»Ÿæ‰€å¤„çš„åˆ†åŒºä¸åŒï¼Œå› æ­¤ï¼Œå¦‚æœä½ ä¸å°å¿ƒæŠŠç³»ç»Ÿæå´©äº†ï¼Œå¯ä»¥è¿›å…¥RECå¯¹å…¶è¿›è¡Œä¸€å®šçš„ä¿®å¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå› ä¸ºRECå’Œæ‰‹æœºçš„ROMå¤„äºä¸åŒåˆ†åŒºï¼Œè€Œä¸åŒåˆ†åŒºä¹‹é—´æ˜¯ä¸ä¼šäº’ç›¸å½±å“çš„ï¼Œç”¨RECå¯ä»¥è¿›è¡Œä¸€å®šç¨‹åº¦çš„åˆ·æœºã€‚ æœ‰äº›äººä¼šå°†RECæ¯”ä½œæˆ‘ä»¬ä¿®ç”µè„‘æ—¶å¸¸ç”¨åˆ°çš„PEï¼Œå®é™…ä¸Šä¸¤è€…åœ¨åœ°ä½ä¸Šæœ‰äº›ç›¸ä¼¼ï¼Œä½†æ˜¯åœ¨åŠŸèƒ½ä¸Šè¿˜æ˜¯æœ‰ä¸€å®šçš„å·®è·çš„ã€‚ å®˜æ–¹çš„RECä¸€èˆ¬é™åˆ¶è¾ƒå¤šï¼ˆåªèƒ½åˆ·å…¥å®˜æ–¹çš„å›ºä»¶ã€è¡¥ä¸ã€æ›´æ–°ç­‰ç­‰ï¼‰ï¼Œè€Œç¬¬ä¸‰æ–¹çš„RECåˆ™åœ¨åŠŸèƒ½ä¸Šè¦æ›´åŠ ä¸°å¯Œä¸€äº›ï¼Œé™¤äº†èƒ½å¤Ÿä»»æ„åˆ·å…¥ç¬¬ä¸‰æ–¹çš„ROMä¹‹å¤–ï¼Œæœ‰äº›ç”šè‡³èƒ½å¤Ÿæ”¯æŒè°ƒæ•´åˆ†åŒºå¤§å°ã€åœ¨æ‰‹æœºä¸Šå®ç°åŒç³»ç»Ÿï¼ˆæ—©æœŸçš„å°ç±³æ‰‹æœºæœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œç°åœ¨çš„ä¸å¤ªæ¸…æ¥šï¼‰ã€‚ ä»¥å‰æ¯”è¾ƒæ—§çš„ç‰ˆæœ¬çš„RECåœ¨åˆ·æœºçš„æ—¶å€™åªèƒ½é€šè¿‡éŸ³é‡é”®å’Œç”µæºé”®æ“ä½œï¼Œå¹¶ä¸”åœ¨å¡åˆ·çš„æ—¶å€™åªæ”¯æŒå°†åˆ·æœºåŒ…ä»¥updateçš„æ–‡ä»¶åï¼Œzipçš„æ–‡ä»¶æ ¼å¼æ”¾å…¥SDå¡çš„æ ¹ç›®å½•ä¸‹è¿›è¡Œæ“ä½œï¼Œç°åœ¨çš„RECåˆ™è¦å¥½å¾ˆå¤šï¼Œé™¤äº†èƒ½å¤Ÿæ”¯æŒè§¦æ§æ“ä½œï¼Œè¿˜èƒ½åˆ·å…¥ä»»æ„å‘½åçš„åˆ·æœºåŒ…ã€‚ 8ã€ä»€ä¹ˆæ˜¯fastbootï¼ŸFastbootçš„åŠŸèƒ½ä¸RECç›¸ä¼¼ï¼Œä½†æ˜¯è¦æ›´ä¸ºé«˜çº§ï¼Œæ›´ä¸ºæ¥è¿‘ç³»ç»Ÿçš„åº•å±‚ã€‚ è¿™å¥è¯å¯èƒ½æ¯”è¾ƒéš¾ç†è§£ï¼Œè¿™é‡Œç®€å•åœ°è§£é‡Šä¸€ä¸‹ã€‚æ›´ä¸ºé«˜çº§çš„æ„æ€å°±æ˜¯Fastbootèƒ½å¤Ÿæ‰§è¡Œçš„æ“ä½œè¦æ¯”RECæ›´å¤šï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰çš„ä½¿ç”¨ADBåˆ·å…¥RECå°±æ˜¯è¿›å…¥äº†fastbootæ¨¡å¼æ‰§è¡Œçš„æ“ä½œã€‚ è€Œæ›´ä¸ºæ¥è¿‘ç³»ç»Ÿçš„åº•å±‚åˆ™æ„å‘³ç€ä¼˜åŠ£å…±å­˜ã€‚æ¯”å¦‚è¯´ï¼Œå½“ä½ æŠ˜è…¾æ‰‹æœºçš„æ—¶å€™ï¼Œä¸å°å¿ƒæŠŠRECæå´©äº†ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿè¿›å…¥fastbootæ¨¡å¼è¿›è¡Œåˆ·æœºï¼Œé‡æ–°åˆ·å…¥RECï¼Œç„¶åç»§ç»­æ„‰å¿«åœ°åˆ·æœºã€‚å› æ­¤ï¼Œå‡ ä¹æ‰€æœ‰çš„æ•‘ç –æ“ä½œéƒ½æ˜¯åœ¨fastbootæ¨¡å¼ä¸‹è¿›è¡Œï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ è¿fastbootéƒ½è¿›ä¸å»ï¼Œé‚£å°±æ„å‘³ç€ä½ çš„æ‰‹æœºå¾ˆæœ‰å¯èƒ½çœŸçš„å˜ç –äº†ã€‚ æ³¨æ„ï¼Œæˆ‘ä»¬å¦‚æœä½¿ç”¨ç¬¬ä¸‰æ–¹åˆ·æœºè½¯ä»¶ï¼ˆåˆ·æœºç²¾çµã€åˆ·æœºå¤§å¸ˆè¿™äº›ï¼‰è¿›è¡Œä¸€é”®åˆ·æœºæ“ä½œçš„æ—¶å€™ï¼Œæ˜¯å±äºçº¿åˆ·ï¼Œå®ƒä»¬ä¼šè®©ä½ çš„æ‰‹æœºè¿›å…¥fastbootæ¨¡å¼ï¼Œç„¶ååˆ·å…¥è¿™äº›åˆ·æœºè½¯ä»¶è‡ªå·±çš„RECï¼Œå†è¿›è¡Œåˆ·å…¥ROMçš„æ“ä½œã€‚ 9ã€ä»€ä¹ˆæ˜¯æ¢å¤å‡ºå‚è®¾ç½®/åŒæ¸…/ä¸‰æ¸…ï¼Ÿ9.1 æ¢å¤å‡ºå‚è®¾ç½®é¡¾åæ€ä¹‰ï¼Œæ¢å¤å‡ºå‚è®¾ç½®å°±æ˜¯å°†ä½ çš„æ‰‹æœºæ¢å¤åˆ°å‡ºå‚çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æ‰‹æœºåˆšä»å·¥å‚é‡Œé¢åŠ å·¥ç»„è£…å®Œæˆï¼ŒåŒ…è£…åˆ°åŒ…è£…ç›’é‡Œé¢çš„çŠ¶æ€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä½ çš„æ‰‹æœºå‡çº§äº†ç³»ç»Ÿï¼ˆå®‰å“ç‰ˆæœ¬æ›´æ–°æˆ–è€…æ˜¯UIçš„å¤§ç‰ˆæœ¬æ›´æ–°ï¼‰ï¼Œé‚£ä¹ˆæ¢å¤å‡ºå‚è®¾ç½®ä¹‹åä¸€èˆ¬æ˜¯ä¸ä¼šå›é€€ä½ å·²ç»æ›´æ–°çš„ç‰ˆæœ¬çš„ã€‚åŒæ—¶ï¼Œæ¢å¤å‡ºå‚è®¾ç½®é»˜è®¤ä¸æ¸…é™¤å‚¨å­˜å¡ä¸Šçš„æ–‡ä»¶ï¼Œä¸”ä½ å…ˆå‰åšçš„å…³äºè®¾ç½®çš„æ›´æ”¹éƒ½ä¸ä¼šä¿å­˜ã€‚ 9.2 åŒæ¸…åŒæ¸…å’Œä¸‰æ¸…å¾€å¾€éœ€è¦è¿›å…¥RECæˆ–è€…æ˜¯fastbootæˆ–è€…æ˜¯ä½¿ç”¨ADBè¿›è¡Œæ“ä½œã€‚åœ¨RECä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯wipe dataå’Œwipe cacheã€‚ wipe data/factory reset: æ¸…é™¤ç”¨æˆ·æ•°æ®å¹¶æ¢å¤å‡ºå‚è®¾ç½®(åˆ·æœºå‰å¿…é¡»æ‰§è¡Œçš„é€‰é¡¹)wipe cache partition: æ¸…é™¤ç³»ç»Ÿç¼“å­˜(åˆ·æœºå‰æ‰§è¡Œï¼Œç³»ç»Ÿå‡ºé—®é¢˜ä¹Ÿå¯å°è¯•æ­¤é€‰é¡¹,ä¸€èˆ¬èƒ½å¤Ÿè§£å†³) 9.3 ä¸‰æ¸…ä¸‰æ¸…æ¯”åŒæ¸…å¤šäº†ä¸€ä¸ªæ¸…é™¤è™šæ‹Ÿæœºç¼“å­˜ï¼ŒåŸºæœ¬ä¸Šä¸‰æ¸…å·²ç»æ˜¯æœ€å½»åº•çš„æ¸…é™¤æ‰‹æœºæ•°æ®çš„æ“ä½œäº†ã€‚ wipe data/factory reset: æ¸…é™¤ç”¨æˆ·æ•°æ®å¹¶æ¢å¤å‡ºå‚è®¾ç½®(åˆ·æœºå‰å¿…é¡»æ‰§è¡Œçš„é€‰é¡¹)wipe cache partition: æ¸…é™¤ç³»ç»Ÿç¼“å­˜(åˆ·æœºå‰æ‰§è¡Œï¼Œç³»ç»Ÿå‡ºé—®é¢˜ä¹Ÿå¯å°è¯•æ­¤é€‰é¡¹,ä¸€èˆ¬èƒ½å¤Ÿè§£å†³)wipe dalvik cache: æ¸…ç©ºè™šæ‹Ÿæœºç¼“å­˜(å¯ä»¥è§£å†³ä¸€äº›ç¨‹åºfcçš„é—®é¢˜) å¾ˆå¤šäººåœ¨åˆ·æœºå‰éƒ½ä¼šæœ‰åŒæ¸…æˆ–è€…æ˜¯ä¸‰æ¸…çš„ä¹ æƒ¯ï¼Œè¿™æ ·ä¸€æ¥å¯ä»¥ä½¿æ‰‹æœºåˆ·æœºæ›´åŠ çº¯å‡€ï¼ŒäºŒæ¥ä¹Ÿå¯ä»¥é¿å…ä¹‹å‰æ®‹ç•™çš„ç¼“å­˜æ–‡ä»¶å¯¹æ–°åˆ·å…¥çš„ROMäº§ç”Ÿå„ç§è«åå…¶å¦™çš„å½±å“ï¼Œå¯¼è‡´å‡ºç°ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼ˆæ¯”å¦‚è€—ç”µé‡æš´å¢ï¼Œç»å¸¸å¡é¡¿ç­‰ç­‰ï¼‰ã€‚ç°åœ¨ä¸€èˆ¬ä¸‰æ¸…ç”¨çš„ä¸å¤šï¼ŒåŒæ¸…è¦æ›´åŠ å¤šä¸€äº›ï¼ŒåŸå› å°±æ˜¯ä¸‰æ¸…ä¼šæ¯”è¾ƒå¤æ‚ï¼Œé£é™©ä¹Ÿæ¯”è¾ƒå¤§ã€‚ 10ã€ä»€ä¹ˆæ˜¯OTAå‡çº§ï¼ŸOTAï¼Œå…¨ç§°ä¸ºOn-The-Airï¼Œä¸­æ–‡åä¸è¯¦ã€‚OTAæ›´æ–°çš„åŸç†æ˜¯é€šè¿‡ç½‘ç»œä¸‹è½½æ›´æ–°åŒ…ï¼Œå­˜å‚¨åœ¨æ‰‹æœºçš„å­˜å‚¨ç©ºé—´ä¸­ï¼Œç„¶åå†é‡å¯è¿›è¡Œå‡çº§ã€‚OTAå‡çº§åœ¨åŸç†ä¸Šæ˜¯å±äºå¡åˆ·çš„ã€‚ é‚£ä¹ˆæˆ‘ä»¬åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­å“ªé‡Œä¼šæ¥è§¦åˆ°OTAå‡çº§å‘¢ï¼Ÿå®é™…ä¸Šï¼Œæˆ‘ä»¬æ‰€æœ‰çš„å®˜æ–¹æ¨é€çš„æ‰‹æœºæ›´æ–°ï¼Œéƒ½æ˜¯å±äºOTAæ›´æ–°ã€‚è€Œèƒ½è¿›è¡ŒOTAå‡çº§çš„å‰ææ¡ä»¶ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨çš„å®˜æ–¹REC+å®˜æ–¹ROM+æ²¡æœ‰ROOTã€‚æ˜¯å¦è§£é”BLå¹¶ä¸å½±å“ã€‚ 11ã€ä»€ä¹ˆæ˜¯åº•åŒ…ï¼Ÿä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œå‚å•†å¯ä»¥é€šè¿‡é”BLçš„å½¢å¼ï¼Œä½¿å¾—æ‰‹æœºåªèƒ½è¯†åˆ«å®˜æ–¹çš„å›ºä»¶ã€ROMç­‰ç­‰ã€‚é‚£ä¹ˆè¿™æ˜¯ä¸æ˜¯æ„å‘³ç€æˆ‘ä»¬å°±ä¸èƒ½åˆ·æœºäº†å‘¢ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œè¦ç›¸ä¿¡é«˜æ‰‹åœ¨æ°‘é—´ï¼Œæ—¢ç„¶å®ƒè¦ï¼Œæˆ‘ä»¬å°±ç»™å®ƒã€‚ åº•åŒ…å°±æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹è¯ç”Ÿçš„äº§ç‰©ï¼Œå®ƒçš„ä¸»è¦ç›®çš„å°±æ˜¯ä½¿å¾—æ‰‹æœºèƒ½å¤Ÿå…ˆè¯†åˆ«è¿™ä¸ªå®˜æ–¹çš„ROMï¼Œç„¶åæˆ‘ä»¬å†åœ¨è¿™ä¸ªROMä¸Šé¢åˆ·å…¥æˆ‘ä»¬è‡ªå·±åˆ¶ä½œçš„ç¬¬ä¸‰æ–¹ROMã€‚ æ­¤å¤„æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯åä¸ºçš„EMUIï¼Œå› ä¸ºåä¸ºæ‰‹æœºçš„ç‰¹ç‚¹ï¼Œå¾ˆå¤šåŸºäºEMUIçš„ç¬¬ä¸‰æ–¹åˆ·æœºåŒ…éƒ½éœ€è¦åŸºäºæŸä¸ªç‰¹å®šçš„EMUIç‰ˆæœ¬æ‰èƒ½åˆ·å…¥ã€‚å› æ­¤æœ‰ä¸€éƒ¨åˆ†å¤§ç¥åœ¨åˆ¶ä½œç¬¬ä¸‰æ–¹çš„ROMçš„æ—¶å€™ï¼Œä¼šåŸºäºå®˜æ–¹çš„ROMè¿›è¡Œä¿®æ”¹å’Œç²¾ç®€ï¼Œå¹¶ä¸”åŠ å…¥ä¸€å®šçš„æ–°åŠŸèƒ½ã€‚è€Œè¿™äº›åˆ¶ä½œå‡ºæ¥çš„åˆ·æœºåŒ…ï¼Œå°±æ˜¯éœ€è¦å…ˆåˆ·å…¥åº•åŒ…çš„ã€‚ç”±äºåä¸ºå¯¹äºåˆ·æœºçš„æ”¯æŒå¹¶ä¸å‹å¥½ï¼Œè€Œä¸”åä¸ºçš„ä¸»è¦ç”¨æˆ·ç¾¤ä½“å¹¶éæ˜¯è¿™ä¸€ç±»çš„åˆ·æœºå‘çƒ§å‹ï¼Œå› æ­¤å¾ˆå¤šåä¸ºçš„æœºå‹çš„åˆ·æœºåŒ…éƒ½æ˜¯å±äºä¸Šè¿°ç±»å‹ã€‚ è¿™é‡Œå†é¢å¤–è¡¥å……ä¸€ä¸‹ã€‚å¦‚æœä½ çš„åä¸ºæ‰‹æœºåŸæ¥å°±æ˜¯å®˜æ–¹çš„ROMï¼Œåœ¨åˆ·å…¥è¿™ä¸€ç±»çš„åˆ·æœºåŒ…çš„æ—¶å€™ï¼Œåªè¦ä½ çš„EMUIç‰ˆæœ¬ç¬¦åˆè¿™ä¸ªç¬¬ä¸‰æ–¹çš„åˆ·æœºåŒ…çš„è¦æ±‚ï¼Œæ˜¯ä¸éœ€è¦åˆ·å…¥åº•åŒ…çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ çš„æ‰‹æœºå·²ç»åˆ·å…¥äº†ç¬¬ä¸‰æ–¹çš„ROMï¼Œå†éœ€è¦åˆ·å›è¿™ä¸€ç±»çš„ROMçš„æ—¶å€™ï¼Œå°±éœ€è¦äº‹å…ˆåˆ·å…¥åº•åŒ…äº†ã€‚ 12ã€ä»€ä¹ˆæ˜¯ADBï¼ŸADBçš„å…¨ç§°æ˜¯Android Debug Bridgeï¼Œä¸­æ–‡åå°±æ˜¯â€œå®‰å“è°ƒè¯•æ¡¥â€ï¼Œä¹Ÿå°±æ˜¯èµ·åˆ°äº†ä¸€ä¸ªè¿æ¥å®‰å“æ‰‹æœºå’Œç”µè„‘çš„æ¡¥æ¢çš„ä½œç”¨ï¼Œå¯ä»¥å®ç°è®¸å¤šå®‰å“æ‰‹æœºçš„è°ƒè¯•åŠŸèƒ½ï¼ˆæ­¤å¤„ä¸ä¸€ä¸€åˆ—ä¸¾ï¼‰ï¼Œå› æ­¤å¾ˆå½¢è±¡åœ°è¢«ç§°å‘¼ä¸ºAndroid Debug Bridgeã€‚ ADBå…¶å®å¹¶éæ˜¯ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå®ƒæ˜¯è°·æ­Œå®˜æ–¹å‡ºå“çš„å·¥å…·ï¼Œå› æ­¤æœ€çº¯å‡€çš„ä¸‹è½½æ–¹å¼å°±æ˜¯å»è°·æ­Œå®˜ç½‘ä¸‹è½½ï¼ˆéœ€è¦ç§‘å­¦ä¸Šç½‘ï¼‰ã€‚ å¦‚æœä½ å«Œå»å®˜ç½‘éº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥æ‰“å¼€æœç´¢å¼•æ“ä¸‹è½½ï¼Œå°å¿ƒä¸€äº›ä¸è¦ä¸‹åˆ°æµæ°“è½¯ä»¶åˆ™é—®é¢˜ä¸å¤§ã€‚ 13ã€ä»€ä¹ˆæ˜¯å†…æ ¸ï¼Ÿå†…æ ¸ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æˆ‘ä»¬æ‰‹æœºçš„æ ¸å¿ƒï¼Œå‡†ç¡®çš„æ¥è¯´æ˜¯æˆ‘ä»¬æ‰‹æœºçš„æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒã€‚äº‹å®ä¸Šä¸ä»…æ˜¯æ‰‹æœºçš„æ“ä½œç³»ç»Ÿï¼Œæ¯ä¸ªæ“ä½œç³»ç»Ÿéƒ½æœ‰å¯¹åº”çš„æ ¸å¿ƒã€‚ é‚£ä¹ˆæ ¸å¿ƒä¸»è¦è´Ÿè´£ä»€ä¹ˆå‘¢ï¼ŸåŸºæœ¬ä¸Šï¼Œæ‰€æœ‰æ²Ÿé€šç¡¬ä»¶å’Œåº•å±‚é©±åŠ¨çš„ä»»åŠ¡éƒ½æ˜¯ç”±æ ¸å¿ƒæ¥è´Ÿè´£çš„ã€‚è€Œä¸åŒçš„æ ¸å¿ƒä¼šæœ‰ä¸åŒçš„ç‰¹æ€§ã€‚æ¯”å¦‚è¯´ï¼šå¦‚æœä½ çš„æ‰‹æœºè€—ç”µé‡æ¯”è¾ƒä¸¥é‡ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥åˆ·å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹ä¼˜åŒ–è¿‡çš„å†…æ ¸ï¼Œæ¥è¾¾åˆ°çœç”µçš„æ•ˆæœã€‚ 14ã€ä»€ä¹ˆæ˜¯ROOTï¼ŸROOTåœ¨è‹±è¯­é‡Œé¢æœ‰æ ¹æºçš„æ„æ€ï¼Œè€Œåœ¨å®‰å“æ‰‹æœºä¸­ï¼ŒROOTåˆ™æ„å‘³ç€è·å–æ‰‹æœºç³»ç»Ÿçš„æœ€é«˜æƒé™ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæ‰‹æœºç³»ç»Ÿçš„è¶…çº§ç®¡ç†å‘˜ï¼Œèƒ½å¤Ÿæ‰§è¡Œä¸€åˆ‡æ“ä½œï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä¿®æ”¹ç³»ç»Ÿåº•å±‚æ–‡ä»¶ï¼Œåå°å®‰è£…åº”ç”¨ç¨‹åºï¼Œè‡ªåŠ¨å‘é€æ‰£è´¹çŸ­ä¿¡ç­‰ç­‰ï¼Œå› æ­¤å¯¹äºä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ROOTæƒé™çš„å°ç™½æ¥è¯´é£é™©è¿˜æ˜¯ç›¸å½“å¤§çš„ã€‚ ä½†æ˜¯ROOTä½œä¸ºä¸€æŠŠåŒåˆƒå‰‘ï¼Œæœ‰åä¹Ÿæœ‰å¥½ã€‚ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶è™½ç„¶æœ‰å¯èƒ½å¯¼è‡´ç³»ç»ŸæŸåï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è§£é”ä¸€äº›æ‰‹æœºåœ¨å‡ºå‚æ—¶å› ä¸ºå„ç§åŸå› è¢«æ‰‹æœºå‚å•†é”æ­»çš„åŠŸèƒ½ï¼Œåˆæˆ–è€…æ˜¯å¸è½½ä¸€äº›æ²¡ç”¨çš„ç³»ç»Ÿè½¯ä»¶ï¼Œè®©æ‰‹æœºä»è‡ƒè‚¿å˜å¾—æ¸…çˆ½ã€‚ å› æ­¤å…³é”®è¿˜æ˜¯çœ‹ä½ æ€ä¹ˆä½¿ç”¨å®ƒã€‚ 15ã€ä»€ä¹ˆæ˜¯Xposedï¼ŸXposedæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒæœ¬èº«æ˜¯ä¸å…·å¤‡å…·ä½“çš„åŠŸèƒ½çš„ã€‚ä½†æ˜¯æœ‰å¾ˆå¤šæ¨¡å—å¯ä»¥é€šè¿‡åœ¨Xposedæ¡†æ¶ä¸Šè¿è¡Œï¼Œå®ç°ä¸€äº›å¾ˆæœ‰æ„æ€çš„åŠŸèƒ½å¦‚å„ç§ä¸ªæ€§åŒ–çš„æ‰‹æœºå®šåˆ¶ã€‚ å› æ­¤ï¼Œæ‰“ä¸ªæ¯”æ–¹æ¥è¯´å°±æ˜¯ï¼šXposedæœ¬èº«ç›¸å½“äºæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæ˜¯ç”¨æ¥è£…ä¸œè¥¿çš„ï¼Œæ”¾ç±³å°±æˆäº†ç±³ç¼¸ï¼Œæ”¾æ°´å°±æˆäº†æ°´ç¼¸ï¼Œæ”¾æœ¨ç‚­ç¡«ç£ºç¡é…¸é’¾å°±æˆäº†ç‚¸å¼¹ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"}]},{"title":"è™šæ‹Ÿå†…å­˜","slug":"20170504-pagefiles","date":"2017-05-04T07:00:00.000Z","updated":"2017-05-04T07:00:00.000Z","comments":true,"path":"20170504-pagefiles/","link":"","permalink":"https://tinychen.com/20170504-pagefiles/","excerpt":"è™šæ‹Ÿå†…å­˜ï¼Œåˆ†é¡µæ–‡ä»¶ï¼Œäº¤æ¢ç©ºé—´ç­‰ç­‰ï¼Œå®ƒä»¬æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚","text":"è™šæ‹Ÿå†…å­˜ï¼Œåˆ†é¡µæ–‡ä»¶ï¼Œäº¤æ¢ç©ºé—´ç­‰ç­‰ï¼Œå®ƒä»¬æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚ 1ã€ç¡¬ç›˜å†…å­˜åŸºæœ¬æ¦‚å¿µ1.1 ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ è™šæ‹Ÿå†…å­˜æ˜¯è®¡ç®—æœºç³»ç»Ÿå†…å­˜ç®¡ç†çš„ä¸€ç§æŠ€æœ¯ã€‚å®ƒä½¿å¾—åº”ç”¨ç¨‹åºè®¤ä¸ºå®ƒæ‹¥æœ‰è¿ç»­çš„å¯ç”¨çš„å†…å­˜ï¼ˆä¸€ä¸ªè¿ç»­å®Œæ•´çš„åœ°å€ç©ºé—´ï¼‰ï¼Œè€Œå®é™…ä¸Šï¼Œå®ƒé€šå¸¸æ˜¯è¢«åˆ†éš”æˆå¤šä¸ªç‰©ç†å†…å­˜ç¢ç‰‡ï¼Œè¿˜æœ‰éƒ¨åˆ†æš‚æ—¶å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œæ•°æ®äº¤æ¢ã€‚ç›®å‰ï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½ä½¿ç”¨äº†è™šæ‹Ÿå†…å­˜ï¼Œå¦‚Windowså®¶æ—çš„â€œè™šæ‹Ÿå†…å­˜â€ï¼›Linuxçš„â€œäº¤æ¢ç©ºé—´â€ç­‰ã€‚ è¿™ä¹ˆä¸“ä¸šçš„è§£é‡Šå¯¹äºå¤§å®¶æ¥è¯´ä¼°è®¡æ˜¯æœ‰ç‚¹éš¾ç†è§£çš„ï¼Œé‚£ä¹ˆå°ä¸ƒç®€å•åœ°æ¥è¯´ä¸€ä¸‹ï¼š å°ä¸ƒæ³¨ï¼šè™šæ‹Ÿå†…å­˜å°±æ˜¯åœ¨ç¡¬ç›˜ä¸­â€œå‰²äº†ä¸€å—åœ°â€å½“ä½œå†…å­˜ç”¨ã€‚æ˜¯å¾ˆå…¸å‹çš„å†…å­˜ä¸å¤Ÿï¼Œç¡¬ç›˜æ¥å‡‘çš„è¡Œä¸ºã€‚ å†æ¥ç®€å•åœ°è§£é‡Šä¸€ä¸‹å†…å­˜å’Œç¡¬ç›˜ï¼š å‡ºäºæˆæœ¬å’ŒæŠ€æœ¯çš„è€ƒè™‘ï¼Œç”µè„‘çš„å­˜å‚¨ç©ºé—´å…¶å®æ˜¯åˆ†ä¸ºä¸¤ç§çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å†…å­˜ï¼ˆRAMï¼‰å’Œç¡¬ç›˜ï¼ˆROMï¼‰ã€‚ä¸¤è€…æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ«å°±æ˜¯ï¼Œå†…å­˜æ˜¯æ–­ç”µä¸ä¿å­˜æ•°æ®ï¼Œè€Œç¡¬ç›˜æ˜¯æ–­ç”µå¯ä»¥ä¿å­˜æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„éœ€è¦é•¿æœŸä¿å­˜çš„æ•°æ®ï¼Œæ¯”å¦‚å„ç§ç…§ç‰‡è§†é¢‘æ¸¸æˆï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜å½“ä¸­ã€‚ é‚£ä¹ˆæˆ‘ä»¬çš„ç”µè„‘å’Œæ‰‹æœºåœ¨å¤„ç†ä»»åŠ¡çš„æ—¶å€™ï¼Œæ•°æ®çš„æ˜¯æ€ä¹ˆæµé€šçš„å‘¢ï¼Ÿå‰é¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œæ•°æ®æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜é‡Œé¢ï¼Œä½†æ˜¯å¤„ç†æ•°æ®çš„æ˜¯å¤„ç†å™¨ï¼Œå› æ­¤è¿™é‡Œå°±æœ‰ä¸€ä¸ªè¿‡æ¸¡çš„ä»‹è´¨ï¼Œä¹Ÿå°±æ˜¯å†…å­˜ã€‚ åŸç†å¤§æ¦‚æ˜¯è¿™æ ·ï¼šç¡¬ç›˜â†’å†…å­˜â†’CPU å†æ¥çœ‹ä¸€ä¸‹æ›´æ·±ä¸€ç‚¹çš„è§£é‡Šã€‚ 1.2 å†…å­˜ï¼ˆRAMï¼‰RAMçš„å…¨ç§°æ˜¯Random Access Memoryï¼Œä¸­æ–‡åæ˜¯éšæœºå­˜å–å­˜å‚¨å™¨ï¼Œæˆ‘ä»¬æ—¥å¸¸ç§°ä¹‹ä¸ºè¿è¡Œå†…å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ä¸èƒ½å¤Ÿæ–­ç”µä¿å­˜æ•°æ®çš„ï¼Œä¸»è¦æ˜¯åœ¨æˆ‘ä»¬çš„ç”µå­äº§å“å·¥ä½œçš„æ—¶å€™ï¼Œå°†éœ€è¦è°ƒç”¨çš„æ–‡ä»¶é¢„å…ˆä»ROMä¸­è¯»å–å‡ºæ¥ï¼Œæ”¾å…¥åˆ°RAMä¸­ï¼ˆå› ä¸ºä¸€èˆ¬æ¥è¯´RAMçš„è¯»å†™é€Ÿåº¦è¦æ¯”ROMå¿«ï¼‰ï¼Œä»¥ä¾¿äºæˆ‘ä»¬çš„CPU/GPUæˆ–è€…æ˜¯SoCç­‰è°ƒç”¨ã€‚ 1.3 ç¡¬ç›˜ï¼ˆROMï¼‰ROMçš„å…¨ç§°æ˜¯Read-Only Memoryï¼Œä¸­æ–‡åæ˜¯åªè¯»å†…å­˜ï¼Œå°±æ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„æ‰‹æœºå­˜å‚¨ç©ºé—´ï¼ˆç”¨æ¥æ”¾éŸ³ä¹å›¾ç‰‡è§†é¢‘ç­‰ç­‰çš„é‚£ä¸ªï¼‰ï¼Œç”µè„‘ç¡¬ç›˜ç­‰ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å¯ä»¥æ–­ç”µä¿å­˜æ•°æ®ï¼Œä¸»è¦æ˜¯ç”¨æ¥é•¿æœŸå­˜å‚¨æ•°æ®çš„ã€‚ 2ã€è™šæ‹Ÿå†…å­˜ä¸ºä½•è€Œç”Ÿåœ¨ç”µè„‘åˆšåˆšå¼€å§‹æ™®åŠçš„æ—¶å€™ï¼Œå†…å­˜è¿˜æ²¡æœ‰æˆ‘ä»¬ç°åœ¨é‚£ä¹ˆå¤§ï¼ˆç¨å¾®æ—§ä¸€ç‚¹çš„ç”µè„‘ä¼šæ˜¯2Gï¼Œç°åœ¨çš„æ–°ç”µè„‘åŸºæœ¬4G/8Gèµ·æ­¥ï¼Œä¸€äº›é«˜ç«¯ç‚¹çš„æ¸¸æˆæœ¬åˆ™æ˜¯16G/32G/64Gï¼ŒåœŸè±ªä¸€èˆ¬éƒ½æ˜¯128Gèµ·æ­¥ï¼‰ï¼Œå†…å­˜å¦‚æœä¸å¤Ÿï¼Œåœ¨è¿è¡Œä¸€äº›å¯¹å†…å­˜éœ€æ±‚å¾ˆâ€œæ—ºç››â€çš„ç¨‹åºçš„æ—¶å€™ï¼Œç”µè„‘å°±ä¼šåƒä¸æ¶ˆï¼Œäºæ˜¯æœºæ™ºçš„ç¨‹åºçŒ¿å°±æƒ³åˆ°äº†ç”¨ç¡¬ç›˜æ¥å½“â€œæ›¿è¡¥â€œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå†…å­˜ä¸å¤Ÿï¼Œç¡¬ç›˜æ¥å‡‘ã€‚ è¿™æ ·ä¸€æ¥ï¼Œè™½ç„¶è§£å†³äº†å†…å­˜å¤§å°ä¸å¤Ÿç”¨çš„é—®é¢˜ï¼Œä½†æ˜¯å´æ²¡æœ‰è§£å†³å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯é€Ÿåº¦ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå†…å­˜çš„è¯»å†™é€Ÿåº¦è¦è¿œé«˜äºç¡¬ç›˜ï¼ˆå³ä¾¿æ˜¯ç°åœ¨å·²ç»æ™®åŠçš„SSDä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ï¼Œé‚£ä¹ˆåœ¨è®¾ç½®ç”µè„‘çš„è™šæ‹Ÿå†…å­˜çš„æ—¶å€™ï¼Œå¦‚æœè®¾ç½®è¿‡å°ï¼Œå¯èƒ½ä¼šä¸å¤Ÿç”¨ï¼Œå¦‚æœè®¾ç½®è¿‡å¤§ï¼Œåˆ™ä¼šæ‹–ä½ç”µè„‘çš„è¿è¡Œé€Ÿåº¦ã€‚ æ‰€ä»¥åˆç†è®¾ç½®è™šæ‹Ÿå†…å­˜ï¼Œä¹Ÿæ˜¯ä¸€é—¨â€œè‰ºæœ¯â€ã€‚ 3ã€åˆç†è®¾ç½®è™šæ‹Ÿå†…å­˜3.1 æ‰¾åˆ°è™šæ‹Ÿå†…å­˜è®¾ç½®é¡µé¢â‘ å³é”®æ­¤ç”µè„‘ï¼Œç‚¹å‡»å±æ€§ï¼› â‘¡ç‚¹å‡»å·¦è¾¹çš„é«˜çº§ç³»ç»Ÿè®¾ç½®ï¼› â‘¢ç‚¹å‡»é«˜çº§ï¼Œæ‰¾åˆ°æ€§èƒ½ï¼Œç‚¹å‡»è®¾ç½®ï¼› â‘£ç»§ç»­æ‰¾åˆ°é«˜çº§ï¼Œæ‰¾åˆ°è™šæ‹Ÿå†…å­˜ï¼Œç‚¹å‡»æ›´æ”¹ï¼› å°ä¸ƒæ³¨ï¼šè™šæ‹Ÿå†…å­˜ä¼šä»¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªéšè—æ–‡ä»¶pagefile.sysçš„å½¢å¼å­˜åœ¨äºç¡¬ç›˜ä¸­ï¼Œå› æ­¤ä¹Ÿå«åšåˆ†é¡µæ–‡ä»¶ã€‚ 3.2 è®¾ç½®è™šæ‹Ÿå†…å­˜çš„ä¸‰ç§æƒ…å†µç¬¬ä¸€ç§ï¼šç³»ç»Ÿè‡ªåŠ¨è®¾ç½®ï¼Œå¦‚ä¸‹å›¾ä¸­çš„è‡ªåŠ¨ç®¡ç†æ‰€æœ‰é©±åŠ¨å™¨çš„åˆ†é¡µæ–‡ä»¶å¤§å°ï¼› ç¬¬äºŒç§ï¼šæ‰‹åŠ¨è®¾ç½®æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œå¦‚ä¸‹å›¾ä¸­çš„è‡ªå®šä¹‰å¤§å°ï¼› ç¬¬ä¸‰ç§ï¼šå…³é—­è™šæ‹Ÿå†…å­˜ï¼Œå¦‚ä¸‹å›¾çš„æ— åˆ†é¡µæ–‡ä»¶ï¼› 3.3 æ‰‹åŠ¨è®¾ç½®è™šæ‹Ÿå†…å­˜å¤§å°â‘ å¦‚æœæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®¾ç½®è™šæ‹Ÿå†…å­˜çš„å¤§å°ï¼Œåˆ™å–æ¶ˆå‹¾é€‰è‡ªåŠ¨ç®¡ç†æ‰€æœ‰é©±åŠ¨å™¨çš„åˆ†é¡µæ–‡ä»¶å¤§å°ï¼Œç„¶åç‚¹å‡»è‡ªå®šä¹‰å¤§å°ï¼› å¡«å†™å¥½æ•°å€¼ä¹‹åï¼Œæˆ‘ä»¬è¦ç‚¹å‡»ä¸‹æ–¹çš„è®¾ç½®ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œä¸ç‚¹å‡»è®¾ç½®æ˜¯ä¸ä¼šä¿å­˜ä½ çš„æ›´æ”¹çš„ã€‚ å°ä¸ƒæ³¨ï¼šåœ¨é©±åŠ¨å™¨è¿™ä¸€æ é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è®¾ç½®è™šæ‹Ÿå†…å­˜æ‰€å ç”¨çš„ç¡¬ç›˜ç©ºé—´ä½äºå“ªä¸€ä¸ªåˆ†åŒºã€‚ç”±äºå°ä¸ƒçš„ç”µè„‘åªæœ‰Cç›˜ä¸€ä¸ªç›˜ï¼Œå› æ­¤æ— æ³•ç»™å¤§å®¶åšç¤ºèŒƒã€‚æœ‰éœ€è¦çš„åŒå­¦å¯ä»¥å°†è™šæ‹Ÿå†…å­˜è®¾ç½®åœ¨Cç›˜ä¹‹å¤–çš„å…¶ä»–ç›˜ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæœ¬èº«å†…å­˜å¤Ÿç”¨çš„æƒ…å†µä¸‹è™šæ‹Ÿå†…å­˜ä¸å®œè®¾ç½®è¿‡å¤§ã€‚ â‘¡ç„¶åæˆ‘ä»¬ç‚¹å‡»ç¡®å®šï¼Œæ¥ç€é‡å¯è®¡ç®—æœºå³å¯ã€‚ 3.4 è®¾ç½®å‰åå¯¹æ¯”æœ€åå°ä¸ƒé™„ä¸Šä¸¤å¼ ç¦ç”¨è™šæ‹Ÿå†…å­˜å’Œè®¾ç½®è™šæ‹Ÿå†…å­˜çš„ç¡¬ç›˜ç©ºé—´å·®è·çš„å¯¹æ¯”çš„å›¾ç‰‡ã€‚ â–²ç¦ç”¨è™šæ‹Ÿå†…å­˜æ—¶çš„å¯ç”¨ç¡¬ç›˜ç©ºé—´ä¸º44.8G â–²å¯ç”¨åå˜ä¸º40.7Gï¼ˆå·®è·å¯å¿½ç•¥ï¼‰ æœ€åå°ä¸ƒä¸å¾—ä¸æä¸€ä¸‹ï¼Œå°½ç®¡ç°åœ¨å†…å­˜çš„ä»·æ ¼é£æ¶¨ï¼Œä½†æ˜¯æƒ³è¦è§£å†³å†…å­˜ä¸å¤Ÿç”¨çš„é—®é¢˜ï¼Œé è™šæ‹Ÿå†…å­˜æ˜¯ä¸å®é™…çš„ï¼Œæœ€å¥½çš„åŠæ³•è¿˜æ˜¯ç›´æ¥ä¹°ä¸€æ ¹å†…å­˜åŠ ä¸Šã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"operatingsystem","slug":"operatingsystem","permalink":"https://tinychen.com/tags/operatingsystem/"}]},{"title":"CHKDSKä½¿ç”¨æ–¹æ³•","slug":"20170503-chkdsk","date":"2017-05-03T07:00:00.000Z","updated":"2017-05-03T07:00:00.000Z","comments":true,"path":"20170503-chkdsk/","link":"","permalink":"https://tinychen.com/20170503-chkdsk/","excerpt":"å‰é¢å°ä¸ƒç»™ç«¥é‹ä»¬ä»‹ç»äº†å…³é—­ç¡¬ç›˜å¼€æœºè‡ªæ£€çš„æ–¹æ³•ï¼Œé‚£ä¹ˆé‡åˆ°ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥ç¡¬ç›˜çš„å¥åº·çŠ¶å†µï¼Œæœ‰æ²¡æœ‰ä¸€äº›ç®€å•çš„æ–¹æ³•å‘¢ï¼Ÿ é‚£ä¹ˆåœ¨è¿™é‡Œå°ä¸ƒç»™ç«¥é‹ä»¬ä»‹ç»ä¸€ä¸‹Windowsè‡ªå¸¦çš„ç¡¬ç›˜æ£€æµ‹å’Œä¿®å¤å·¥å…·CHKDSKã€‚","text":"å‰é¢å°ä¸ƒç»™ç«¥é‹ä»¬ä»‹ç»äº†å…³é—­ç¡¬ç›˜å¼€æœºè‡ªæ£€çš„æ–¹æ³•ï¼Œé‚£ä¹ˆé‡åˆ°ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥ç¡¬ç›˜çš„å¥åº·çŠ¶å†µï¼Œæœ‰æ²¡æœ‰ä¸€äº›ç®€å•çš„æ–¹æ³•å‘¢ï¼Ÿ é‚£ä¹ˆåœ¨è¿™é‡Œå°ä¸ƒç»™ç«¥é‹ä»¬ä»‹ç»ä¸€ä¸‹Windowsè‡ªå¸¦çš„ç¡¬ç›˜æ£€æµ‹å’Œä¿®å¤å·¥å…·CHKDSKã€‚ 1ã€CHKDSKæ˜¯ä»€ä¹ˆï¼ŸCHKDSKï¼Œå°±æ˜¯CHECK DISKçš„ç¼©å†™ï¼Œä¸­æ–‡åå°±æ˜¯ç£ç›˜æ£€æŸ¥ã€‚ è¿™ä¸ªå·¥å…·æ˜¯Windowsç³»ç»Ÿä¸­è‡ªå¸¦çš„ä¸€ä¸ªç®€å•å®ç”¨çš„ç¡¬ç›˜æ£€é”™å’Œä¿®å¤å·¥å…·ï¼Œç”¨äºéªŒè¯æ–‡ä»¶ç³»ç»Ÿçš„é€»è¾‘å®Œæ•´æ€§ã€‚ å¦‚æœ CHKDSK åœ¨æ–‡ä»¶ç³»ç»Ÿæ•°æ®ä¸­å‘ç°å­˜åœ¨é€»è¾‘ä¸ä¸€è‡´æ€§ï¼ŒCHKDSK å°†æ‰§è¡Œå¯ä¿®å¤è¯¥æ–‡ä»¶ç³»ç»Ÿæ•°æ®çš„æ“ä½œï¼ˆå‰ææ˜¯è¿™äº›æ•°æ®æœªå¤„äºåªè¯»æ¨¡å¼ï¼‰ã€‚ å°ä¸ƒæ³¨ï¼šåªè¯»æ¨¡å¼å³åªèƒ½å¯¹æ–‡ä»¶è¿›è¡Œè¯»å–æ“ä½œè€Œæ— æ³•å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ 2ã€å¦‚ä½•ä½¿ç”¨CHKDSKæ£€æµ‹ç£ç›˜ï¼Ÿæ³¨æ„äº‹é¡¹ â‘ ä¸è¦ä¸­æ–­CHKDSKçš„è¿è¡Œ åŸå› å¾ˆç®€å•ï¼šåŒ»ç”Ÿåœ¨ç»™ç—…äººåšæ‰‹æœ¯çš„æ—¶å€™ä¸èƒ½è¢«ä¸­æ–­ã€‚CHKDSKåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè§†ç£ç›˜çš„æƒ…å†µä¸åŒï¼Œæ‰€éœ€æ—¶é—´é•¿çŸ­ä¹Ÿå¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œå› æ­¤è¯·ä¿æŒè€å¿ƒã€‚ â‘¡å¦‚æœéœ€è¦ä¿®å¤ç£ç›˜é”™è¯¯ï¼Œç¡®ä¿è¢«ä¿®å¤çš„ç£ç›˜æ²¡æœ‰æ–‡ä»¶è¢«æ‰“å¼€ å¦‚æœæœ‰æ–‡ä»¶è¢«æ‰“å¼€äº†ï¼Œåœ¨ä¿®å¤ä¹‹å‰CHKDSKä¼šæŠ¥é”™ã€‚å› æ­¤å¦‚æœä¸èƒ½ç¡®å®šæ˜¯ä»€ä¹ˆæ–‡ä»¶è¢«æ‰“å¼€ï¼Œæœ€å¥½è¿›å…¥DOSç¯å¢ƒæ“ä½œã€‚ 3ã€æ­¥éª¤å¦‚ä¸‹3.1 ä»¥ç³»ç»Ÿç®¡ç†å‘˜èº«ä»½è¿è¡ŒCMDç”±äºå¯¹ç¡¬ç›˜çš„æ£€æµ‹æ“ä½œéœ€è¦ç³»ç»Ÿç®¡ç†å‘˜çš„æƒé™ï¼Œè€Œä¸€èˆ¬åœ¨è¿è¡Œçª—å£ä¸­è¿è¡ŒCMDæ˜¯æ²¡æœ‰ç³»ç»Ÿç®¡ç†å‘˜æƒé™çš„ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰¾åˆ°CMDï¼Œå¹¶ä¸”å°†ä»–å‘é€åˆ°æ¡Œé¢å¿«æ·æ–¹å¼ä»¥ä¾¿äºæ“ä½œï¼Œç›®å½•ï¼šC:\\Windows\\System32ã€‚ è¿è¡Œçš„æ—¶å€™ï¼Œä¸è¦ç›´æ¥åŒå‡»è¿è¡Œï¼Œå³é”®èœå•ç‚¹å‡»ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€‚ 3.2 è¾“å…¥å‘½ä»¤â‘ ç›´æ¥è¾“å…¥ 1chkdsk Xï¼š/f å°ä¸ƒæ³¨ï¼šXä¸ºæ‰€éœ€è¦æ£€æµ‹ä¿®å¤çš„ç¡¬ç›˜ç›˜ç¬¦ï¼Œchkdskå’Œç›˜ç¬¦Xä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œå…¶ä½™å‡æ— ç©ºæ ¼ï¼Œæ‰€æœ‰ç¬¦å·è¯·åœ¨è‹±æ–‡åŠè§’ä¸‹è¾“å…¥ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨è‹±æ–‡é”®ç›˜ï¼Œä¸è¦ä½¿ç”¨ä¸­æ–‡è¾“å…¥æ³•ã€‚ â‘¡ç›´æ¥æŒ‰ä¸‹å›è½¦ï¼Œå³ä¼šè‡ªåŠ¨å¼€å§‹æ£€æµ‹å¦‚æœæ£€æµ‹å‡ºç£ç›˜é”™è¯¯ï¼Œä¼šè‡ªåŠ¨ä¿®å¤(ä¸€èˆ¬ä¿®å¤åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ£€æµ‹å‡ºé—®é¢˜ï¼Œåˆ™å¦‚ä¸‹å›¾ï¼šï¼ˆå›¾ä¸­çš„Dç›˜æ˜¯å°ä¸ƒçš„ä¸€ä¸ªUç›˜ï¼‰ 3.3 å¦‚ä½•æ£€æµ‹ç³»ç»Ÿç›˜ï¼Ÿç‰¹åˆ«çš„ï¼Œå½“ä½ æ£€æµ‹çš„æ˜¯ç³»ç»Ÿç›˜Cç›˜æ—¶ï¼Œç”±äºæ­¤æ—¶æ­£å¤„äºæ“ä½œç³»ç»Ÿç•Œé¢ä¸‹ï¼Œæ— æ³•è¿›è¡Œæ£€æµ‹æ“ä½œï¼Œæ‰€ä»¥è¯¢é—®ä½ æ˜¯å¦åœ¨ä¸‹æ¬¡å¯åŠ¨ç³»ç»Ÿæ—¶è¿›è¡Œæ£€æµ‹ã€‚ è¾“å…¥Yåå›è½¦ï¼Œç„¶åé‡å¯å³å¯ã€‚ 4ã€ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ç”¨åˆ°CHKDSKï¼Ÿç”±äºæƒ…å†µè¾ƒå¤šï¼Œä¸‹é¢åªåˆ—ä¸¾ä¸‰ç§æ¯”è¾ƒå¸¸è§çš„æƒ…å†µã€‚ 4.1 ç³»ç»Ÿç›´æ¥æé†’ç³»ç»Ÿç›´æ¥æé†’ä½ çš„æ—¶å€™ï¼Œè¿™ç§æƒ…å†µä¼šæ¯”è¾ƒä¸¥é‡ï¼Œå¦‚æœä½ çš„ç³»ç»ŸæŸä¸ªæˆ–è€…æŸäº›æ–‡ä»¶å‡ºç°äº†é—®é¢˜ï¼Œç³»ç»Ÿå¼¹å‡ºæç¤ºæ¡†è®©ä½ è¿è¡Œchkdskå·¥å…·è¿›è¡Œæ£€æµ‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç…§ç€ä¸Šé¢çš„æ•™ç¨‹è¿›è¡Œæ“ä½œ 4.2 ç§»åŠ¨è®¾å¤‡æç¤ºæœ‰é”™è¯¯ç§»åŠ¨è®¾å¤‡ï¼ˆUç›˜ï¼Œç§»åŠ¨ç¡¬ç›˜ç­‰ï¼‰æ’å…¥ç”µè„‘æ—¶æç¤ºæœ‰å‡ºç°é”™è¯¯ï¼Œç³»ç»Ÿè¯¢é—®ä½ æ˜¯å¦éœ€è¦æ‰«æå¹¶ä¿®å¤æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥è®©ç³»ç»Ÿæ¥æ‰§è¡Œï¼› 4.3 éæ³•æ“ä½œä¹‹åä½ çš„ç¡¬ç›˜å…³é—­äº†å¼€æœºè‡ªæ£€è€Œä¸”ä½ å¯¹ç³»ç»Ÿè¿›è¡Œäº†éæ³•æ“ä½œï¼ˆå¼ºåˆ¶å…³æœºç­‰ï¼‰çš„æ—¶å€™ï¼Œç³»ç»Ÿç›˜æ—¢æœ‰å¯èƒ½ä¼šå‡ºç°é”™è¯¯æˆ–è€…æ˜¯å†—ä½™æ–‡ä»¶ã€‚è¿™ä¸ªæ—¶å€™è¿è¡Œchkdskå·¥å…·ï¼Œåˆ™ä¼šå¸®ä½ å¤„ç†æ‰è¿™äº›å†—ä½™æ–‡ä»¶ï¼Œæ‰€ä»¥æœ‰äº›ç«¥é‹åœ¨æœ‰æ—¶å€™åœ¨è¿è¡Œå®Œchkdskå·¥å…·åä¼šå‘ç°è‡ªå·±çš„ç¡¬ç›˜çš„å¯ç”¨ç©ºé—´å¢å¤šäº†ï¼Œå°±æ˜¯è¿™ä¸ªåŸå›  5ã€CHKDSKå…¨éƒ¨æŒ‡ä»¤æœ€åæ”¾å‡ºCHKDSKçš„å…¨éƒ¨å‘½ä»¤ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥ç ”ç©¶ç ”ç©¶ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"operatingsystem","slug":"operatingsystem","permalink":"https://tinychen.com/tags/operatingsystem/"}]},{"title":"å…³é—­ç¡¬ç›˜å¼€æœºè‡ªæ£€","slug":"20170502-disable-disk-onboot-check","date":"2017-05-02T07:00:00.000Z","updated":"2017-05-02T07:00:00.000Z","comments":true,"path":"20170502-disable-disk-onboot-check/","link":"","permalink":"https://tinychen.com/20170502-disable-disk-onboot-check/","excerpt":"ç›¸ä¿¡æœ‰å¾ˆå¤šç”µè„‘éƒ½å¯èƒ½ä¼šå‡ºç°å¼€æœºç¡¬ç›˜è‡ªæ£€çš„æƒ…å†µï¼Œé‚£ä¹ˆå…¶å®å¯¹äºå¤§éƒ¨åˆ†åŒå­¦æ¥è¯´ï¼Œå¼€æœºè‡ªæ£€æœ‰æ²¡æœ‰å¿…è¦å‘¢ï¼Ÿ","text":"ç›¸ä¿¡æœ‰å¾ˆå¤šç”µè„‘éƒ½å¯èƒ½ä¼šå‡ºç°å¼€æœºç¡¬ç›˜è‡ªæ£€çš„æƒ…å†µï¼Œé‚£ä¹ˆå…¶å®å¯¹äºå¤§éƒ¨åˆ†åŒå­¦æ¥è¯´ï¼Œå¼€æœºè‡ªæ£€æœ‰æ²¡æœ‰å¿…è¦å‘¢ï¼Ÿ 1ã€å¼•è¨€å…¶å®ï¼Œå¼€æœºç¡¬ç›˜è‡ªæ£€çš„å­˜åœ¨æ˜¯æœ‰ä¸€å®šçš„é“ç†çš„ï¼Œå› ä¸ºå¾ˆå¤šç”µè„‘çš„ç¡¬ç›˜ï¼ˆå°¤å…¶æ˜¯æœºæ¢°ç¡¬ç›˜ï¼‰å¯èƒ½ç”±äºä½¿ç”¨è€…çš„ä¸€äº›ä¸å½“æ“ä½œï¼Œè€Œäº§ç”Ÿå„ç§å„æ ·å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œç¡¬ç›˜çš„å¼€æœºè‡ªæ£€å°±èƒ½å¤Ÿå‘æŒ¥ä½œç”¨ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£è¿™äº›é—®é¢˜ï¼Œæˆ–è€…è¯´æ˜¯ï¼Œé¢„é˜²è¿™äº›é—®é¢˜ã€‚ å› æ­¤å°ä¸ƒçš„å»ºè®®æ˜¯ï¼šç¡¬ç›˜è‡ªæ£€ï¼Œèƒ½ä¸å…³å°±ä¸å…³ã€‚ å°ä¸ƒæ³¨ï¼šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜åŒ…æ‹¬ä½†ä¸é™äºï¼šç³»ç»Ÿæ–‡ä»¶ä¸¢å¤±ã€å¼•å¯¼æ–‡ä»¶ä¸¢å¤±ã€ç¡¬ç›˜äº§ç”Ÿåé“ç­‰ç­‰ã€‚ç¡¬ç›˜åé“æ˜¯ç‰©ç†çº§åˆ«çš„æŸä¼¤ï¼Œåªèƒ½å±è”½åé“æˆ–è€…æ˜¯æ›´æ¢ç¡¬ç›˜ï¼Œæ— æ³•ä¿®å¤ã€‚ ä½†æ˜¯æ€»ä¼šå› ä¸ºå„ç§éœ€è¦è€Œè¦å…³é—­ç¡¬ç›˜è‡ªæ£€ï¼Œå°ä¸ƒåœ¨è¿™é‡Œç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªé€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥å…³é—­ç¡¬ç›˜å¼€æœºè‡ªæ£€çš„æ–¹æ³•ã€‚ â–²å¦‚å›¾æ‰€ç¤ºä¸ºæˆ´å°”ç¬”è®°æœ¬çš„å¼€æœºç¡¬ç›˜è‡ªæ£€ 2ã€æ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨â‘ åœ¨ä»»æ„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥åŒæ—¶æŒ‰ä¸‹windowsé”®ï¼ˆå¼€å§‹èœå•é”®ï¼‰å’Œå­—æ¯é”®Rï¼Œæ­¤æ—¶ä¼šå‡ºç°ä¸€ä¸ªè¿è¡Œçª—å£ â‘¡ç„¶åæˆ‘ä»¬åœ¨é‡Œé¢è¾“å…¥regeditï¼ˆå¦‚ä¸Šå›¾æ‰€ç¤ºï¼‰ï¼Œå›è½¦å³å¯æ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ å°ä¸ƒæ³¨ï¼š æ³¨å†Œè¡¨ç¼–è¾‘å™¨ä¸­åŒ…å«æœ‰å…¨éƒ¨ç³»ç»Ÿè®¾ç½®åŠè½¯ä»¶çš„æœ‰å…³ä¿¡æ¯ï¼Œåœ¨ä¸ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œè¯·ä¸è¦éšæ„è¿›è¡Œæ›´æ”¹ï¼Œæ³¨å†Œè¡¨ä¸€æ—¦æŸåä¸”å¦‚æ— äº‹å…ˆå¤‡ä»½ï¼Œåæœä¸å ªè®¾æƒ³ Win+Ræ˜¯ç³»ç»Ÿçº§åˆ«çš„å¿«æ·é”®ï¼Œå¯ä»¥ç›´æ¥æ‰“å¼€è¿è¡Œçª—å£ï¼Œå› æ­¤æ— è®ºä½ å¤„äºä»»ä½•åº”ç”¨çª—å£éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨æ­¤å¿«æ·é”®ã€‚ 3ã€å®šä½åˆ° BootExecuteâ‘ æ ¹æ®è¿™ä¸ªåœ°å€ï¼Œæ‰¾åˆ°Session Managerä¸­çš„BootExecute HKEY_LOCAL_MACHINE â†’ SYSTEM â†’ ControlSet001 â†’ Control â†’ Session Manager â‘¡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå³é”®BootExecuteï¼Œç‚¹å‡»ä¿®æ”¹ 4ã€æ¸…ç©ºæ•°å€¼â‘ æ¸…ç©ºé‡Œé¢çš„æ•°å€¼autocheck autochk * â‘¡ç‚¹å‡»ç¡®å®š *åˆ°è¿™é‡Œï¼Œç¡¬ç›˜è‡ªæ£€å°±å·²ç»è¢«å…³é—­äº†ï¼Œå¦‚æœæƒ³è¦é‡æ–°å¼€å¯ï¼Œåªéœ€è¦å°†æ•°å€¼é‡æ–°ä¿®æ”¹ä¸ºautocheck autochk å³å¯ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"}]},{"title":"FAT32æ— æŸè½¬æ¢ä¸ºNTFS","slug":"20170418-fat32-to-ntfs","date":"2017-04-18T07:00:00.000Z","updated":"2017-04-18T07:00:00.000Z","comments":true,"path":"20170418-fat32-to-ntfs/","link":"","permalink":"https://tinychen.com/20170418-fat32-to-ntfs/","excerpt":"ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªç°åœ¨å¯èƒ½ä¸å¤ªä¼šç”¨åˆ°çš„å°æŠ€å·§ï¼Œå°†FAT32çš„ç£ç›˜æ— æŸè½¬æ¢ä¸ºNTFSæ ¼å¼ã€‚ ä¸ºä»€ä¹ˆè¯´ä¸å¤ªä¼šç”¨åˆ°å‘¢ï¼Œå› ä¸ºfat32æ ¼å¼ç°åœ¨å·²ç»å¾ˆå°‘æœ‰äººåœ¨ç”¨ï¼ŒåŸºæœ¬è¦è¢«æ·˜æ±°äº†ã€‚å½“ç„¶ï¼Œä¸æ’é™¤ä¼šæœ‰è¿™ç§æƒ…å†µå‡ºç°ï¼Œå› æ­¤å°ä¸ƒè¿˜æ˜¯å†³å®šåˆ†äº«ä¸€ä¸‹è§£å†³æ–¹æ³•ã€‚","text":"ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªç°åœ¨å¯èƒ½ä¸å¤ªä¼šç”¨åˆ°çš„å°æŠ€å·§ï¼Œå°†FAT32çš„ç£ç›˜æ— æŸè½¬æ¢ä¸ºNTFSæ ¼å¼ã€‚ ä¸ºä»€ä¹ˆè¯´ä¸å¤ªä¼šç”¨åˆ°å‘¢ï¼Œå› ä¸ºfat32æ ¼å¼ç°åœ¨å·²ç»å¾ˆå°‘æœ‰äººåœ¨ç”¨ï¼ŒåŸºæœ¬è¦è¢«æ·˜æ±°äº†ã€‚å½“ç„¶ï¼Œä¸æ’é™¤ä¼šæœ‰è¿™ç§æƒ…å†µå‡ºç°ï¼Œå› æ­¤å°ä¸ƒè¿˜æ˜¯å†³å®šåˆ†äº«ä¸€ä¸‹è§£å†³æ–¹æ³•ã€‚ ä¸‹é¢è¿›å…¥æ­£æ–‡ã€‚ 1ã€ç¤ºèŒƒä¸‹å›¾æ˜¯å°ä¸ƒè‡ªå·±çš„ä¸€ä¸ª64Gçš„Uç›˜ï¼Œç”±äºå°ä¸ƒè‡ªå·±çš„ç²—å¿ƒï¼Œæ ¼å¼åŒ–çš„æ—¶å€™é€‰ç”¨äº†FAT32æ ¼å¼ï¼Œè¿™ç§æ ¼å¼æ˜¯æ¯”è¾ƒæ—§çš„ä¸€ç§æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œæœ€æ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯ï¼šå³ä½¿ä½ çš„ç£ç›˜æœ‰å¤§äº4Gçš„ç©ºä½™ç©ºé—´ï¼Œä¹Ÿæ— æ³•å‘é‡Œé¢å¤åˆ¶å¤§äº4Gçš„æ–‡ä»¶ã€‚ â–²å¦‚å›¾ï¼Œå°ä¸ƒçš„Uç›˜æœ‰å°†è¿‘20Gçš„ç©ºä½™ç©ºé—´ã€‚ ä¸‹é¢å¤åˆ¶ä¸€ä¸ª4.02Gçš„æ–‡ä»¶ã€‚ è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸç†å…¶å®æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯ç½ªé­ç¥¸é¦–å°±æ˜¯è¿™ä¸ªFAT32çš„æ–‡ä»¶ç³»ç»Ÿã€‚ å°ä¸ƒçš„å»ºè®®æ˜¯ï¼Œå¦‚æœä½ çš„ç£ç›˜æ˜¯Uç›˜ï¼Œé‚£ä¹ˆå…ˆæŠŠé‡Œé¢çš„æ•°æ®å¤‡ä»½å‡ºæ¥ï¼Œç„¶åæ ¼å¼åŒ–ï¼Œé€‰æ‹©æ–‡ä»¶ç³»ç»Ÿä¸ºexFATæ ¼å¼ï¼Œå°±å¯ä»¥è§£å†³é—®é¢˜ã€‚ æ¸©é¦¨æç¤ºï¼šNTFSæ ¼å¼çš„æ–‡ä»¶ç³»ç»Ÿç”±äºå…¶åŸç†çš„ç‰¹æ®Šæ€§ï¼Œä¼šå¯¹Uç›˜äº§ç”Ÿä¸€å®šçš„æŸä¼¤ï¼Œå› æ­¤ä¸å»ºè®®å¯¹Uç›˜ä½¿ç”¨NTFSæ ¼å¼ã€‚ 2ã€æ–¹æ³•2.1 Uç›˜** æ–¹æ³•å¦‚ä¸‹ï¼š **â‘  å³é”®ç‚¹å‡»Uç›˜ï¼Œé€‰æ‹©æ ¼å¼åŒ–ï¼› â‘¡ åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­é€‰æ‹©exFATï¼Œç„¶åé€‰ä¸­å¿«é€Ÿæ ¼å¼åŒ–ï¼Œæ¥ç€ç‚¹å‡»ç¡®å®šå³å¯ã€‚ 2.2 ç¡¬ç›˜å¦‚æœä½ çš„ç£ç›˜æ˜¯å›ºæ€ç¡¬ç›˜æˆ–è€…æ˜¯æœºæ¢°ç¡¬ç›˜ï¼Œé‚£ä¹ˆå°ä¸ƒå»ºè®®å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹æ³•ï¼Œæ— æŸè½¬æ¢ä¸ºNTFSï¼Œæ–¹ä¾¿å¿«æ·ã€‚** æ–¹æ³•å¦‚ä¸‹ï¼š **â‘  åŒæ—¶æŒ‰ä¸‹win+Ré”®ï¼Œè¾“å…¥CMDï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼› â‘¡ æˆ‘ä»¬åœ¨CMDçª—å£ä¸­è¾“å…¥ä¸‹åˆ—å‘½ä»¤ï¼š 1convert X:/FS:NTFS ï¼ˆå…¶ä¸­Xä¸ºæ‰€éœ€è½¬æ¢çš„ç£ç›˜ç›˜ç¬¦ï¼Œç¬¦å·éœ€è¦åœ¨è‹±æ–‡åŠè§’ä¸‹è¾“å…¥ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼‰ç„¶åç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ç£ç›˜æ˜¯å¦å­˜åœ¨é—®é¢˜å¹¶ä¸”å¼€å§‹è½¬æ¢æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ â‘¢ å½“ç„¶ï¼Œå¦‚æœä½ åƒå°ä¸ƒè¿™æ ·å‡ºäº†é”™è¯¯ï¼Œä¸è¦æ€¥ï¼Œå¯èƒ½æ˜¯ç£ç›˜æœ‰äº›å°é—®é¢˜ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨chkdskå·¥å…·å¯¹ç£ç›˜è¿›è¡Œæ£€æµ‹å’Œä¿®å¤ï¼ˆchkdskå·¥å…·çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥ç‚¹è¿™é‡Œï¼‰ â‘£ æœ€åæˆ‘ä»¬å†æ¬¡è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ 1convert X:/FS:NTFS å°±æˆåŠŸåœ°è½¬æ¢æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ä¸ºNTFSäº†ã€‚ â–²æ³¨æ„ï¼å°ä¸ƒæ­¤å¤„å°†Uç›˜è½¬æ¢ä¸ºNTFSæ˜¯ä¼šæŸä¼¤Uç›˜çš„ï¼Œåœ¨è¿™é‡Œä»…ä»…æ˜¯ä½œä¸ºç¤ºèŒƒã€‚ å½“ç„¶ï¼Œæœ€åæˆ‘ä»¬å†æ¥è¯•ä¸€ä¸‹èƒ½ä¸èƒ½å¤åˆ¶å¤§äº4Gçš„å•ä¸ªæ–‡ä»¶ã€‚ â–²æˆäº†ï¼ æœ€åå°ä¸ƒè¯´ä¸€ä¸‹ï¼Œå¾ˆå¤šæ—¶å€™ç”µå­è®¾å¤‡å‡ºäº†é—®é¢˜ï¼Œå•ä¸€çš„æ•™ç¨‹æˆ–æ–¹æ³•å¯èƒ½å¹¶ä¸é€‚ç”¨ï¼Œè¿™å°±å¾ˆå¯èƒ½ä¼šç”¨åˆ°å¤šç§æ–¹æ³•æˆ–è€…æ˜¯ç¨å¾®å¤æ‚ä¸€ç‚¹çš„çŸ¥è¯†ï¼Œè¿™ä¸ªæ—¶å€™å°ä¸ƒå¸Œæœ›ç«¥é‹ä»¬ä¸è¦æ°”é¦ï¼Œå¤šå°è¯•ã€‚æ¯•ç«Ÿåƒä¸€å ‘é•¿ä¸€æ™ºå˜›ã€‚","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"}]},{"title":"win10æ—¶é—´æ æ˜¾ç¤ºç§’","slug":"20170414-win10-show-seconds","date":"2017-04-14T07:00:00.000Z","updated":"2017-04-14T07:00:00.000Z","comments":true,"path":"20170414-win10-show-seconds/","link":"","permalink":"https://tinychen.com/20170414-win10-show-seconds/","excerpt":"å¯¹äºWin10æ¥è¯´ï¼Œç›´æ¥ç‚¹å¼€ä»»åŠ¡æ çš„æ—¶é—´å°±å¯ä»¥çœ‹åˆ°å…·ä½“çš„ç§’ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•è®©ç§’è¿™ä¸€ä¸ªé€‰é¡¹å¸¸é©»åœ¨ä»»åŠ¡æ çš„æ—¶é—´é‡Œé¢ï¼Œä¸ç”¨ç‚¹å¼€å°±èƒ½æŸ¥çœ‹å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ³¨å†Œè¡¨ä¸­è¿›è¡Œç®€å•åœ°æ“ä½œå°±å¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½å•¦ã€‚","text":"å¯¹äºWin10æ¥è¯´ï¼Œç›´æ¥ç‚¹å¼€ä»»åŠ¡æ çš„æ—¶é—´å°±å¯ä»¥çœ‹åˆ°å…·ä½“çš„ç§’ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•è®©ç§’è¿™ä¸€ä¸ªé€‰é¡¹å¸¸é©»åœ¨ä»»åŠ¡æ çš„æ—¶é—´é‡Œé¢ï¼Œä¸ç”¨ç‚¹å¼€å°±èƒ½æŸ¥çœ‹å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ³¨å†Œè¡¨ä¸­è¿›è¡Œç®€å•åœ°æ“ä½œå°±å¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½å•¦ã€‚ 1ã€BATæ–‡ä»¶å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•åœ°è¯´æ˜ä¸€ä¸‹è¿™ä¸ªbatæ–‡ä»¶ã€‚ batæ–‡ä»¶æ˜¯DOSä¸‹çš„æ‰¹å¤„ç†æ–‡ä»¶ï¼Œæ˜¯ä¸€ç§æ–‡æœ¬æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨è®°äº‹æœ¬ç¼–è¾‘ï¼‰ã€‚å®ƒèƒ½å¤Ÿå°†ä½ å†™å¥½çš„å‘½ä»¤å¹¶å­˜å‚¨åœ¨é‡Œé¢çš„å‘½ä»¤ç›´æ¥è°ƒç”¨cmd.exeè¿™ä¸ªç¨‹åºå¸®ä½ æ“ä½œï¼Œçœå»äº†ä½ é‡å¤æ“ä½œçš„éº»çƒ¦ã€‚ æ–¹æ³•å¦‚ä¸‹ï¼š æˆ‘ä»¬æ‰“å¼€windowsé‡Œé¢çš„è®°äº‹æœ¬ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨notepad++è¿™æ¬¾è½¯ä»¶ï¼Œå¦‚æœå·²ç»å®‰è£…äº†çš„è¯ï¼‰ï¼Œåœ¨é‡Œé¢è¾“å…¥ä¸‹åˆ—ä»£ç ï¼Œç„¶åå³é”®å¦å­˜ä¸ºbatæ–‡ä»¶ï¼Œè¿è¡Œçš„æ—¶å€™è¦ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œå¦åˆ™å¯èƒ½ä¸èµ·ä½œç”¨ã€‚ 2ã€æ˜¾ç¤ºç§’12345678@echo offreg add &quot;HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v ShowSecondsInSystemClock /t REG_DWORD /d 1 /fTASKKILL /F /IM explorer.exeecho.echo é‡å¯explorer.exeSTART %windir%\\explorer.exeecho.pause 3ã€åˆ é™¤ç§’12345678@echo offreg delete &quot;HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced&quot; /v ShowSecondsInSystemClock /t REG_DWORD /d 1 /fTASKKILL /F /IM explorer.exeecho.echo é‡å¯explorer.exeSTART %windir%\\explorer.exeecho.pause 4ã€å±•ç¤ºæœ€åä¸Šä¸€å¼ æ•ˆæœå›¾","categories":[{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"}]}],"categories":[{"name":"cloudnative","slug":"cloudnative","permalink":"https://tinychen.com/categories/cloudnative/"},{"name":"network","slug":"network","permalink":"https://tinychen.com/categories/network/"},{"name":"linux","slug":"linux","permalink":"https://tinychen.com/categories/linux/"},{"name":"â€Œvirtualization","slug":"â€Œvirtualization","permalink":"https://tinychen.com/categories/%E2%80%8Cvirtualization/"},{"name":"web","slug":"web","permalink":"https://tinychen.com/categories/web/"},{"name":"sre","slug":"sre","permalink":"https://tinychen.com/categories/sre/"},{"name":"others","slug":"others","permalink":"https://tinychen.com/categories/others/"},{"name":"storage","slug":"storage","permalink":"https://tinychen.com/categories/storage/"}],"tags":[{"name":"centos","slug":"centos","permalink":"https://tinychen.com/tags/centos/"},{"name":"k8s","slug":"k8s","permalink":"https://tinychen.com/tags/k8s/"},{"name":"docker","slug":"docker","permalink":"https://tinychen.com/tags/docker/"},{"name":"cilium","slug":"cilium","permalink":"https://tinychen.com/tags/cilium/"},{"name":"calico","slug":"calico","permalink":"https://tinychen.com/tags/calico/"},{"name":"flannel","slug":"flannel","permalink":"https://tinychen.com/tags/flannel/"},{"name":"dns","slug":"dns","permalink":"https://tinychen.com/tags/dns/"},{"name":"coredns","slug":"coredns","permalink":"https://tinychen.com/tags/coredns/"},{"name":"queryperf","slug":"queryperf","permalink":"https://tinychen.com/tags/queryperf/"},{"name":"unbound","slug":"unbound","permalink":"https://tinychen.com/tags/unbound/"},{"name":"dnstap","slug":"dnstap","permalink":"https://tinychen.com/tags/dnstap/"},{"name":"loadbalance","slug":"loadbalance","permalink":"https://tinychen.com/tags/loadbalance/"},{"name":"nat","slug":"nat","permalink":"https://tinychen.com/tags/nat/"},{"name":"lvs","slug":"lvs","permalink":"https://tinychen.com/tags/lvs/"},{"name":"keepalived","slug":"keepalived","permalink":"https://tinychen.com/tags/keepalived/"},{"name":"dpdk","slug":"dpdk","permalink":"https://tinychen.com/tags/dpdk/"},{"name":"dpvs","slug":"dpvs","permalink":"https://tinychen.com/tags/dpvs/"},{"name":"http","slug":"http","permalink":"https://tinychen.com/tags/http/"},{"name":"nginx","slug":"nginx","permalink":"https://tinychen.com/tags/nginx/"},{"name":"rockylinux","slug":"rockylinux","permalink":"https://tinychen.com/tags/rockylinux/"},{"name":"prometheus","slug":"prometheus","permalink":"https://tinychen.com/tags/prometheus/"},{"name":"bind","slug":"bind","permalink":"https://tinychen.com/tags/bind/"},{"name":"kvm","slug":"kvm","permalink":"https://tinychen.com/tags/kvm/"},{"name":"openresty","slug":"openresty","permalink":"https://tinychen.com/tags/openresty/"},{"name":"tls","slug":"tls","permalink":"https://tinychen.com/tags/tls/"},{"name":"tomcat","slug":"tomcat","permalink":"https://tinychen.com/tags/tomcat/"},{"name":"powerdns","slug":"powerdns","permalink":"https://tinychen.com/tags/powerdns/"},{"name":"ssh","slug":"ssh","permalink":"https://tinychen.com/tags/ssh/"},{"name":"fail2ban","slug":"fail2ban","permalink":"https://tinychen.com/tags/fail2ban/"},{"name":"ubuntu","slug":"ubuntu","permalink":"https://tinychen.com/tags/ubuntu/"},{"name":"bash","slug":"bash","permalink":"https://tinychen.com/tags/bash/"},{"name":"shell","slug":"shell","permalink":"https://tinychen.com/tags/shell/"},{"name":"grubby","slug":"grubby","permalink":"https://tinychen.com/tags/grubby/"},{"name":"wsl","slug":"wsl","permalink":"https://tinychen.com/tags/wsl/"},{"name":"windows","slug":"windows","permalink":"https://tinychen.com/tags/windows/"},{"name":"hardware","slug":"hardware","permalink":"https://tinychen.com/tags/hardware/"},{"name":"harddisk","slug":"harddisk","permalink":"https://tinychen.com/tags/harddisk/"},{"name":"code","slug":"code","permalink":"https://tinychen.com/tags/code/"},{"name":"wireshark","slug":"wireshark","permalink":"https://tinychen.com/tags/wireshark/"},{"name":"mail","slug":"mail","permalink":"https://tinychen.com/tags/mail/"},{"name":"imap","slug":"imap","permalink":"https://tinychen.com/tags/imap/"},{"name":"linux","slug":"linux","permalink":"https://tinychen.com/tags/linux/"},{"name":"pop3","slug":"pop3","permalink":"https://tinychen.com/tags/pop3/"},{"name":"smtp","slug":"smtp","permalink":"https://tinychen.com/tags/smtp/"},{"name":"ipv6","slug":"ipv6","permalink":"https://tinychen.com/tags/ipv6/"},{"name":"database","slug":"database","permalink":"https://tinychen.com/tags/database/"},{"name":"iptables","slug":"iptables","permalink":"https://tinychen.com/tags/iptables/"},{"name":"graduation","slug":"graduation","permalink":"https://tinychen.com/tags/graduation/"},{"name":"ceph","slug":"ceph","permalink":"https://tinychen.com/tags/ceph/"},{"name":"jmeter","slug":"jmeter","permalink":"https://tinychen.com/tags/jmeter/"},{"name":"openstack","slug":"openstack","permalink":"https://tinychen.com/tags/openstack/"},{"name":"gnome","slug":"gnome","permalink":"https://tinychen.com/tags/gnome/"},{"name":"yum","slug":"yum","permalink":"https://tinychen.com/tags/yum/"},{"name":"python","slug":"python","permalink":"https://tinychen.com/tags/python/"},{"name":"grub","slug":"grub","permalink":"https://tinychen.com/tags/grub/"},{"name":"mysql","slug":"mysql","permalink":"https://tinychen.com/tags/mysql/"},{"name":"socks","slug":"socks","permalink":"https://tinychen.com/tags/socks/"},{"name":"ntp","slug":"ntp","permalink":"https://tinychen.com/tags/ntp/"},{"name":"chrony","slug":"chrony","permalink":"https://tinychen.com/tags/chrony/"},{"name":"cockpit","slug":"cockpit","permalink":"https://tinychen.com/tags/cockpit/"},{"name":"ansible","slug":"ansible","permalink":"https://tinychen.com/tags/ansible/"},{"name":"os","slug":"os","permalink":"https://tinychen.com/tags/os/"},{"name":"haproxy","slug":"haproxy","permalink":"https://tinychen.com/tags/haproxy/"},{"name":"zabbix","slug":"zabbix","permalink":"https://tinychen.com/tags/zabbix/"},{"name":"monitor","slug":"monitor","permalink":"https://tinychen.com/tags/monitor/"},{"name":"acl","slug":"acl","permalink":"https://tinychen.com/tags/acl/"},{"name":"cron","slug":"cron","permalink":"https://tinychen.com/tags/cron/"},{"name":"selinux","slug":"selinux","permalink":"https://tinychen.com/tags/selinux/"},{"name":"frp","slug":"frp","permalink":"https://tinychen.com/tags/frp/"},{"name":"stu","slug":"stu","permalink":"https://tinychen.com/tags/stu/"},{"name":"dhcp","slug":"dhcp","permalink":"https://tinychen.com/tags/dhcp/"},{"name":"router","slug":"router","permalink":"https://tinychen.com/tags/router/"},{"name":"sdn","slug":"sdn","permalink":"https://tinychen.com/tags/sdn/"},{"name":"iperf3","slug":"iperf3","permalink":"https://tinychen.com/tags/iperf3/"},{"name":"android","slug":"android","permalink":"https://tinychen.com/tags/android/"},{"name":"jdk","slug":"jdk","permalink":"https://tinychen.com/tags/jdk/"},{"name":"ip","slug":"ip","permalink":"https://tinychen.com/tags/ip/"},{"name":"operatingsystem","slug":"operatingsystem","permalink":"https://tinychen.com/tags/operatingsystem/"},{"name":"wifi","slug":"wifi","permalink":"https://tinychen.com/tags/wifi/"}]}